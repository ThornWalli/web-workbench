(window.webpackJsonp=window.webpackJsonp||[]).push([[13,16,28,37,38],{307:function(t,e,n){"use strict";n.r(e);var r=n(141),h=n(142),o=n(296),c=n(297),d=(n(76),n(333)),l=Object(c.a)("red"),f=Object(c.a)("green"),v=Object(c.a)("blue"),m=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255;Object(r.a)(this,t),Object.defineProperty(this,l,{writable:!0,value:0}),Object.defineProperty(this,f,{writable:!0,value:0}),Object.defineProperty(this,v,{writable:!0,value:0}),this.set(e,n,h,o)}return Object(h.a)(t,[{key:"set",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255;Array.isArray(t)&&(r=t[3],n=t[2],e=t[1],t=t[0]),this.red=t,this.green=e,this.blue=n,this.alpha=void 0===r?255:r}},{key:"r",get:function(){return Object(o.a)(this,l)[l]}},{key:"red",get:function(){return Object(o.a)(this,l)[l]},set:function(t){Object(o.a)(this,l)[l]=Object(d.b)(t,0,255)}},{key:"g",get:function(){return this._green}},{key:"green",get:function(){return this._green},set:function(t){this._green=Object(d.b)(t,0,255)}},{key:"blue",get:function(){return this._blue},set:function(t){this._blue=Object(d.b)(t,0,255)}},{key:"b",get:function(){return this._blue}},{key:"a",get:function(){return this._alpha}},{key:"alpha",get:function(){return this._alpha},set:function(t){this._alpha=Object(d.b)(t,0,255)}},{key:"sum",get:function(){return Object(o.a)(this,l)[l]+this._blue+this._green+this._alpha}},{key:"toRGB",value:function(){return"rgb(".concat(Object(o.a)(this,l)[l],",").concat(this._green,",").concat(this._blue,")")}},{key:"toRGBA",value:function(){return"rgba(".concat(Object(o.a)(this,l)[l],",").concat(this._green,",").concat(this._blue,",").concat(this._alpha/255,")")}},{key:"toJSON",value:function(){return{red:this.red,green:this.green,blue:this.blue,alpha:this.alpha}}},{key:"is",value:function(t){return this.red===t.red&&this.blue===t.blue&&this.green===t.green&&this.alpha===t.alpha}},{key:"invert",value:function(){return Object(o.a)(this,l)[l]=255-Object(o.a)(this,l)[l],this._green=255-this._green,this._blue=255-this._blue,this}},{key:"add",value:function(t){this.red=Object(d.b)(this.red+t.red,0,255),this.green=Object(d.b)(this.green+t.green,0,255),this.blue=Object(d.b)(this.blue+t.blue,0,255)}},{key:"subtract",value:function(t){this.red=Object(d.b)(this.red-t.red,0,255),this.green=Object(d.b)(this.green-t.green,0,255),this.blue=Object(d.b)(this.blue-t.blue,0,255)}},{key:"multiply",value:function(t){this.red=Object(d.b)(this.red*t.red,0,255),this.green=Object(d.b)(this.green*t.green,0,255),this.blue=Object(d.b)(this.blue*t.blue,0,255)}},{key:"divide",value:function(t){this.red=Object(d.b)(this.red/t.red,0,255),this.green=Object(d.b)(this.green/t.green,0,255),this.blue=Object(d.b)(this.blue/t.blue,0,255)}}]),t}();m.COLOR_BLACK=[0,0,0,255],m.COLOR_WHITE=[255,255,255,255],m.COLOR_TRANSPARENT=[0,0,0,0],e.default=m},333:function(t,e,n){"use strict";n.d(e,"b",(function(){return h})),n.d(e,"d",(function(){return o})),n.d(e,"c",(function(){return c})),n.d(e,"a",(function(){return d}));var r=n(295);function h(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(t,e),n)}function o(t){return Math.atan2(t.y,t.x)+Math.PI}function c(t){var e=window.getComputedStyle(t).transform,n=new DOMMatrix(e);return Math.atan2(n.b,n.a)}function d(t,e){var n=Math.cos(e)*t.x-Math.sin(e)*t.y,h=Math.sin(e)*t.x+Math.cos(e)*t.y;return new r.c(n,h)}},337:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return o}));var r=n(141),h=n(295),o=function t(e,n){Object(r.a)(this,t),this.min=Object(h.e)(0,0),this.max=Object(h.e)(0,0),this.min=e||this.min,this.max=n||this.max}},352:function(t,e,n){"use strict";n.r(e),function(t){var r=n(141),h=n(142),o=(n(40),n(298),n(14),n(439),n(440),n(441),n(442),n(443),n(445),n(446),n(447),n(448),n(449),n(450),n(451),n(452),n(453),n(454),n(455),n(456),n(457),n(458),n(459),n(460),n(461),n(462),n(463),n(29),n(295)),c=n(307),d=n(353),l=function(){function e(t){Object(r.a)(this,e),this._app=t;var n=t.options.size;this._bitmapData=new d.default(n.width,n.height),this._renderActions=[],this._passiveRenderActions=[],this.clearStack()}return Object(h.a)(e,[{key:"getActiveContext",value:function(){return this._app.display.context}},{key:"getDisplayContexts",value:function(){return this._app.displays.map((function(t){return t.context}))}},{key:"setSize",value:function(t,e){this._bitmapData=new d.default(t,e),this.clearStack(),this.render(),this._app.refresh()}},{key:"loadImage",value:function(image){var t=this.getImageDataFromImage(image);this._bitmapData=new d.default(t.width,t.height),this.clearStack(),this._stacks.push(t),this.render(),this._app.refresh()}},{key:"getImageDataFromImage",value:function(image){var canvas=document.createElement("canvas");canvas.width=image.width,canvas.height=image.height;var t=canvas.getContext("2d");t.drawImage(image,0,0);for(var n=e.createImageData(image.width,image.height),data=t.getImageData(0,0,canvas.width,canvas.height),i=0;i<data.length;i++)n.data[Number(i)]=data[Number(i)];return data}},{key:"getColorFromPixel",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=n?this._renderImageData:this._stacks[this._stacks.length-1||0],data=r.data,h=e*(4*r.width)+4*t;return new c.default(data[Number(h)],data[h+1],data[h+2],data[h+3])}},{key:"getPixel",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=n?this._renderImageData:this._stacks[this._stacks.length-1||0],data=r.data,h=e*(4*r.width)+4*t;return data[Number(h)]+data[h+1]+data[h+2]+data[h+3]}},{key:"setPixel",value:function(t,e,n){n=n||this._app.primaryColor;var i=4*(t+e*this._renderImageData.width);this._renderImageData.data[i+0]=n.red,this._renderImageData.data[i+1]=n.green,this._renderImageData.data[i+2]=n.blue,this._renderImageData.data[i+3]=n.alpha>=0?n.alpha:255}},{key:"putImageData",value:function(t,e,n){for(var r,h,o=0;o<t.width;o++)for(var c=0;c<t.height;c++)r=4*(c*t.width+o),h=4*((n+c)*this._renderImageData.width+(e+o)),f(r,t.data,h,this._renderImageData.data)}},{key:"fillPixels",value:function(t,e,n,r,h){for(var o=e;o<Math.min(e+r,this._renderImageData.width);o++)for(var c=n;c<Math.min(n+h,this._renderImageData.height);c++)this.setPixel(o,c,t)}},{key:"addRenderAction",value:function(t){this._renderActions.push(t)}},{key:"addPassiveRenderAction",value:function(t){this._passiveRenderActions.push(t)}},{key:"cleanPassiveRenderActions",value:function(){this._passiveRenderActions=[]}},{key:"getTmpStack",value:function(){return e.createImageData(this._stacks[this._stacks.length-1].width,this._stacks[this._stacks.length-1].height,this._stacks[this._stacks.length-1].data)}},{key:"render",value:function(){var e=this;this._renderImageData=this.getTmpStack(),O(this._renderActions),O(this._passiveRenderActions,!0),t.cancelAnimationFrame(this._renderWait),this._renderWait=t.setTimeout((function(){m.bind(e)(!0),e._renderWait=null}),1e3/30),t.clearTimeout(this._renderWaitDisplays),this._renderWaitDisplays=t.setTimeout((function(){m.bind(e)()}),300)}},{key:"size",get:function(){return Object(o.e)(this._renderImageData.width,this._renderImageData.height)}},{key:"width",get:function(){return this._renderImageData.width}},{key:"height",get:function(){return this._renderImageData.height}},{key:"stacks",get:function(){return this._stacks}},{key:"renderImageData",get:function(){return this._renderImageData}},{key:"clearStack",value:function(){this._renderImageData=e.createImageData(this._bitmapData.width,this._bitmapData.height),this._stacks=[this._renderImageData],this.render()}},{key:"saveStack",value:function(){this._renderImageData=this.getTmpStack(),O(this._renderActions,!0),this._stacks.push(this._renderImageData),this.render()}},{key:"revertStack",value:function(){this._stacks.length>1&&(this._renderImageData=this._stacks.pop(),this.render())}},{key:"toBlob",value:function(){var t=this;return new Promise((function(e){v(t._renderImageData).toBlob(e)}))}},{key:"toBase64",value:function(){var t=this;return new Promise((function(e){e(v(t._renderImageData).toDataURL())}))}}],[{key:"invertImageData",value:function(t){for(var i=0,e=0;e<t.width;e++)for(var n=0;n<t.height;n++)i=4*(e+n*t.width),t.data[Number(i)]=255-t.data[Number(i)],t.data[i+1]=255-t.data[i+1],t.data[i+2]=255-t.data[i+2]}},{key:"createImageData",value:function(e,n,data){return new t.ImageData(new t.Uint8ClampedArray(data||4*e*n),e,n)}},{key:"resizeImageData",value:function(t){for(var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=t.data,c=t.width,h1=t.height,d=c*r,h2=h1*r,l=Array(d*h2*4),v=Object(o.e)(parseInt((c<<16)/d)+1,parseInt((h1<<16)/h2)+1),i=0;i<h2;i++)for(var m=0;m<d;m++)n=m*v.x>>16,f(4*((i*v.y>>16)*c+n),h,4*(i*d+m),l);return e.createImageData(d,h2,l)}},{key:"cropImageData",value:function(t,n,r,h,o){for(var c=t.data,d=Array(h*o*4),i=0;i<h;i++)for(var l=0;l<o;l++){f(4*(r*t.width+n)+4*(l*t.width+i),c,4*(l*h+i),d)}return e.createImageData(h,o,d)}}]),e}();function f(t,e,n,r){r[Number(n)]=e[Number(t)],r[n+1]=e[t+1],r[n+2]=e[t+2],r[n+3]=e[t+3]}function v(t){var canvas=document.createElement("canvas");return canvas.width=t.width,canvas.height=t.height,canvas.getContext("2d").putImageData(t,0,0),canvas}function m(t){var e=this;t?this._app.display&&(this._app.display.imageData=this._renderImageData):this._app.displays.forEach((function(t){t.imageData=e._renderImageData}))}function O(t,e){if(e)for(;t.length>0;)t.shift()();else t.forEach((function(t){t()}))}e.default=l}.call(this,n(39))},353:function(t,e,n){"use strict";n.r(e);var r=n(141),h=n(142),o=n(296),c=n(297),d=n(295),l=Object(c.a)("size"),f=function(){function t(e,n){Object(r.a)(this,t),Object.defineProperty(this,l,{writable:!0,value:Object(d.e)(0,0)}),Object(o.a)(this,l)[l]=Object(d.e)(e,n)}return Object(h.a)(t,[{key:"width",get:function(){return Object(o.a)(this,l)[l].x}},{key:"height",get:function(){return Object(o.a)(this,l)[l].y}},{key:"size",get:function(){return Object(o.a)(this,l)[l]}}]),t}();e.default=f},413:function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"default",(function(){return A}));var r=n(21),h=n(141),o=n(142),c=n(296),d=n(297),l=(n(29),n(363),n(962)),f=n(637),v=n(295),m=n(349),O=n(352),j=n(307),y=n(337),k=Object(d.a)("id"),_=Object(d.a)("bounds"),w=Object(d.a)("cropBounds"),D=Object(d.a)("imageData"),I=Object(d.a)("tmpImageData"),z=Object(d.a)("el"),x=Object(d.a)("canvas"),C=Object(d.a)("context"),A=function(){function e(t){Object(h.a)(this,e),Object.defineProperty(this,k,{writable:!0,value:Object(l.a)()}),this.events=new f.a,Object.defineProperty(this,_,{writable:!0,value:new y.default}),this.size=Object(v.e)(),this.canvasLayout={size:Object(v.e)(),naturalSize:Object(v.e)(),position:Object(v.e)()},Object.defineProperty(this,w,{writable:!0,value:new y.default}),Object.defineProperty(this,D,{writable:!0,value:null}),Object.defineProperty(this,I,{writable:!0,value:null}),Object.defineProperty(this,z,{writable:!0,value:void 0}),Object.defineProperty(this,x,{writable:!0,value:void 0}),Object.defineProperty(this,C,{writable:!0,value:void 0}),this.zoomFactor=1,this.zoomPosition=Object(v.e)(.5,.5),this.zoomBounds=new y.default,this.offset=Object(v.f)(),this.cursorVisible=!1,this.app=t,this.cursorColor=new j.default(j.default.COLOR_BLACK),this.resetZoom()}return Object(o.a)(e,[{key:"showCursor",value:function(){this.cursorVisible=!0}},{key:"hideCursor",value:function(){this.cursorVisible=!1,this.renderImageData()}},{key:"setElement",value:function(element){Object(c.a)(this,z)[z]=element}},{key:"setCanvas",value:function(canvas){var t=this;Object(c.a)(this,x)[x]=canvas,Object(c.a)(this,C)[C]=canvas.getContext("2d"),Object.values(this.app.inputs).forEach((function(input){input.registerDisplay(t)}))}},{key:"destroy",value:function(){var t=this;this.events.next(new m.a("destroy")),Object.values(this.app.inputs).forEach((function(input){input.unregisterDisplay(t)}))}},{key:"canvas",get:function(){return Object(c.a)(this,x)[x]}},{key:"id",get:function(){return Object(c.a)(this,k)[k]}},{key:"bounds",get:function(){return Object(c.a)(this,_)[_]}},{key:"imageData",get:function(){return Object(c.a)(this,D)[D]},set:function(t){Object(c.a)(this,I)[I]=Object(c.a)(this,D)[D]=t,this.maxZoomFactor=20,this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.renderImageData()}},{key:"canvasSize",get:function(){return Object(v.e)(Object(c.a)(this,x)[x].width,Object(c.a)(this,x)[x].height)}},{key:"naturalSize",get:function(){return Object(v.e)(Object(c.a)(this,x)[x].width,Object(c.a)(this,x)[x].height)}},{key:"naturalWidth",get:function(){return Object(c.a)(this,D)[D].width}},{key:"naturalHeight",get:function(){return Object(c.a)(this,D)[D].height}},{key:"width",get:function(){return this.zoomBounds.max.x-this.zoomBounds.min.x}},{key:"height",get:function(){return this.zoomBounds.max.y-this.zoomBounds.min.y}},{key:"zoomFactorWidth",get:function(){return Object(c.a)(this,x)[x].width/this.zoomFactor}},{key:"setSize",value:function(t,e){var n;n="object"===Object(r.a)(t)?t:Object(v.e)(t,e),this.size=n,this.events.next(new m.a("change:size",n)),this.canvasAdjustment()}},{key:"canvasAdjustment",value:function(){var t=this;this.canvasLayout.size=Object(v.e)((function(){return Math.min(Math.max(t.app.canvas.size*t.zoomFactor,0),t.size)})),this.canvasLayout.naturalSize=this.app.canvas.size,this.canvasLayout.position=Object(v.e)(0,0)}},{key:"setZoom",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(v.e)();(n=Math.min(n,this.maxZoomFactor))>=0&&(this.zoomFactor=n,this.canvasAdjustment(),this.zoomPosition=Object(v.e)((function(){return r/e.canvasLayout.naturalSize})),this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.resetOffset(),t.requestAnimationFrame((function(){e.renderImageData(),e.events.next(new m.a("change:zoomFactor",n))})))}},{key:"zoom",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(v.e)();this.zoomFactor+t>=0&&this.setZoom(this.zoomFactor+t,e)}},{key:"renderImageData",value:function(){var t=this;Object(c.a)(this,I)[I]=Object(c.a)(this,D)[D];var e=Object(v.e)((function(){return t.zoomBounds.max-t.zoomBounds.min})),n=Object(v.e)((function(){return Object(v.e)(t.offset)+t.zoomBounds.min}));Object(c.a)(this,I)[I]=O.default.cropImageData(Object(c.a)(this,I)[I],n.x,n.y,e.x,e.y),Object(c.a)(this,I)[I]=O.default.resizeImageData(Object(c.a)(this,I)[I],this.zoomFactor),this.renderCanvas()}},{key:"cursorColor",get:function(){return this._cursorColor},set:function(t){this._cursorColorRGBA=t.toRGBA(),this._cursorColor=t}},{key:"renderCanvas",value:function(){Object(c.a)(this,I)[I]&&(Object(c.a)(this,C)[C].putImageData(Object(c.a)(this,I)[I],-this.offset.x,-this.offset.y),this.renderRaster())}},{key:"reset",value:function(){this.resetZoom(),this.resetOffset(),this.renderCanvas()}},{key:"resetOffset",value:function(){this.offset=Object(v.f)(0,0)}},{key:"resetZoom",value:function(){Object(c.a)(this,D)[D]&&this.setZoom(1)}},{key:"renderRaster",value:function(){var t=this,e=[];this.zoomFactor>this.maxZoomFactor-3&&e.push({size:Object(v.e)(1,1),width:1,color:"#CCCCCC"});var n=Object(c.a)(this,C)[C];n.globalCompositeOperation="destination-over",e.forEach((function(e){var r=Object(v.e)((function(){return t.canvasLayout.naturalSize/e.size}));n.lineWidth=e.width,n.beginPath();for(var h=0;h<r.x+1;h++){var o=Math.floor(h*e.size.x*t.zoomFactor)+e.width/2;n.moveTo(o,0),n.lineTo(o,Object(c.a)(t,x)[x].height);for(var d=0;d<r.y+1;d++){var l=Math.floor(d*e.size.y*t.zoomFactor)+e.width/2;n.moveTo(0,l),n.lineTo(Object(c.a)(t,x)[x].width,l)}}n.strokeStyle=e.color,n.stroke()}))}},{key:"refresh",value:function(){var rect={left:Object(c.a)(this,x)[x].offsetLeft+Object(c.a)(this,z)[z].offsetLeft,top:Object(c.a)(this,x)[x].offsetTop+Object(c.a)(this,z)[z].offsetTop,width:Object(c.a)(this,x)[x].offsetWidth,height:Object(c.a)(this,x)[x].offsetHeight};Object(c.a)(this,_)[_]=new y.default(Object(v.e)(rect.left,rect.top),Object(v.e)(rect.left+rect.width,rect.top+rect.height)),Object(c.a)(this,D)[D]&&this.renderImageData()}},{key:"setOffset",value:function(t){this.offset=Object(v.f)(t.x,t.y)}},{key:"calculateZoomBounds",value:function(t,e){var n=this;e=e||1;var r=this.app.canvas.size;t=Object(v.e)((function(){return Math.floor(t*r)}));var h=Object(v.e)((function(){return n.size/r})),o=Object(v.e)((function(){return Math.ceil(Math.min(h/e*r,r))})),c=Object(v.e)((function(){return Math.min(Math.max(t-Math.ceil(o/2),0),r-o)})),d=Object(v.e)((function(){return c+o}));return new y.default(c,d)}}]),e}()}.call(this,n(39))}}]);