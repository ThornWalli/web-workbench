import{g as I,w,j as A,k as O,u as x,C as D,r as H,q as d}from"./index.eb95d3b6.js";import{N as E,j as U,g as M,C as s,k as Y,I as N,l as Z,m as V,M as L}from"./index.c407afae.js";import{W as B}from"./ContextMenu.1751e8b2.js";import{_ as C,f as y,k as r,l as c,m as h,q as k,N as g,O as P,L as T,M as S,t as R,C as _,S as K,Z as $,W as b,E as z,I as v,z as W,H as f,a3 as F}from"./entry.211f2c5a.js";import{N as j,T as G,u as q,c as X}from"./Navigation.bc026fba.js";import{T as J}from"./TimelineCanvas.fbba13c1.js";import"./index.56665add.js";import"./viewport.be0c4ff7.js";import"./math.2c224f08.js";import"./async.a8557e7e.js";const Q={components:{WbEnvMoleculeContextMenu:B},props:{parentLayout:{type:Object,default(){return{size:I(window.innerWidth,window.innerHeight)}}},title:{type:String,default:"Web-Workbench release. Version 1.3"},items:{type:Array,default(){return w.modules.windows.contextMenu.activeItems.items}}},emits:["inputContextMenu"],data(){return{cover:!1}},methods:{onUpdateModelValueContextMenu(...e){this.$emit("inputContextMenu",...e)}}},ee={class:"wb-env-molecule-footer"},te={ref:"menu",class:"menu"};function se(e,n,o,a,i,t){const l=y("wb-env-molecule-context-menu");return r(),c("footer",ee,[h("nav",te,[k(l,{direction:"top",items:o.items,"parent-layout":o.parentLayout,"onUpdate:modelValue":t.onUpdateModelValueContextMenu},null,8,["items","parent-layout","onUpdate:modelValue"])],512)])}const ne=C(Q,[["render",se],["__scopeId","data-v-f49caf4e"]]);const ae=9,oe={props:{selectedNote:{type:E,default:null},size:{type:String,validator:e=>["small","medium","large"].includes(e),default:"large"},showNoteLabels:{type:Boolean,default:!1},startOctave:{type:Number,default:4},octaveCount:{type:Number,default:6}},emits:["down","up"],data:function(){return{keys:[],dimension:I()}},computed:{selectedNotes(){var e;return this.selectedNote&&U((e=this.selectedNote)==null?void 0:e.name)||[]},height(){return{small:140,medium:210,large:280}[this.size]},octaveRange(){const e=[],n=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];for(let o=0;o<this.octaveCount;o++)e.push(...n.map(a=>{const i=`${a}${this.startOctave+o}`;return{note:i,black:this.isBlackKey(i)}}));return this.startOctave+this.octaveCount<=ae&&e.push({note:n[0]+(this.startOctave+this.octaveCount),black:!1}),e},styleClasses(){return{...this.dimension.toCSSVars("dimension"),"--height":this.height,"--keys":this.octaveRange.filter(({black:e})=>!e).length,"--white-keys":this.octaveRange.filter(({black:e})=>!e).length,"--black-keys":this.octaveRange.filter(({black:e})=>e).length}}},mounted(){this.dimension=I(this.$el.offsetWidth,0)},methods:{isBlackKey(e){return/^[a-zA-Z]{2}\d+/.test(e)},onPointerDown(e){this.$emit("down",e)},onPointerUp(e){this.$emit("up",e)}}},ie={class:"keys white"},re=["onPointerdown","onPointerup"],le={key:0},ce={key:0},de={class:"keys black"},ue=["onPointerdown","onPointerup"],he={key:0},me={key:0};function _e(e,n,o,a,i,t){return r(),c("div",{style:S(t.styleClasses),class:"wb-disks-debug-synthesizer-keyboard"},[h("div",null,[h("div",ie,[(r(!0),c(g,null,P(t.octaveRange,({note:l,black:u},m)=>(r(),c("div",{key:m,class:T(["key",{black:u,white:!u,selected:t.selectedNotes.includes(l)}]),style:S({"--index":m}),onPointerdown:p=>t.onPointerDown(l),onPointerup:p=>t.onPointerUp(l)},[u?_("",!0):(r(),c("span",le,[o.showNoteLabels?(r(),c("i",ce,R(l),1)):_("",!0)]))],46,re))),128))]),h("div",de,[(r(!0),c(g,null,P(t.octaveRange,({note:l,black:u},m)=>(r(),c("div",{key:m,class:T(["key",{black:u,white:!u,selected:t.selectedNotes.includes(l)}]),style:S({"--index":m}),onPointerdown:p=>t.onPointerDown(l),onPointerup:p=>t.onPointerUp(l)},[u?(r(),c("span",he,[o.showNoteLabels?(r(),c("i",me,R(l),1)):_("",!0)])):_("",!0)],46,ue))),128))])])],4)}const pe=C(oe,[["render",_e],["__scopeId","data-v-4e246311"]]);const ye={components:{WbEnvMoleculeFooter:ne,Navigation:j,Keyboard:pe,SynthesizerTimelineCanvas:J},props:{...A,model:{type:Object,default:M()},toneDestination:{type:Object,default:null}},emits:[...O],setup(e,n){const o=K(e,"model"),a=x(e,n);$(o,()=>{a.setContextMenu(X,{model:o.value,preserveContextMenu:a.preserveContextMenu})},{immediate:!0,deep:!0});const i=b(o.value[s.SYNTHESIZER_TRACK]),t=b(new G(i));return{...a,...q(),track:i,trackPlayer:t}},data(){return{CONFIG_NAMES:s,currentSequence:null,synth:null,maxLength:11,playing:!1,footerModel:{},windowsModule:z(this.core.modules.windows)}},computed:{selectedNoteIndex(){return this.track.selectedIndex},styleClasses(){return{[`keyboard-alignment-${this.model[s.SYNTHESIZER_KEYBOARD_ALIGNMENT]}`]:!0}},notes:{get(){return this.track.notes},set(e){this.track.notes=e}},showKeyboard(){return this.model[s.SYNTHESIZER_SHOW_KEYBOARD]},keybordData(){return{size:this.model[s.SYNTHESIZER_KEYBOARD_SIZE],showNoteLabels:this.model[s.SYNTHESIZER_SHOW_NOTE_LABELS],selectedNote:this.notes[this.selectedNoteIndex],startOctave:this.model[s.SYNTHESIZER_START_OCTAVE],octaveCount:this.model[s.SYNTHESIZER_OCTAVE_COUNT]}},bpm(){return Number(this.model[s.SYNTHESIZER_BPM])},masterVolume(){return this.core.config.observable[D.SCREEN_CONFIG].soundVolume},decibelValue(){return Y(this.masterVolume)},isMaxLength(){return this.track.octaveCount>=this.maxLength},duration(){return this.model[s.SYNTHESIZER_DURATION]},noteDiagramControlNavigation(){var e;return{model:this.model,items:[[this.trackPlayer.playing?{selected:!0,title:"Pause",disabled:!this.trackPlayer.currentSequence||!this.trackPlayer.playing,onClick:()=>this.onClickPlause()}:{title:"Play",disabled:this.trackPlayer.playing||this.track.notes.length===0,onClick:()=>this.onClickPlay()},{title:"Stop",disabled:!this.trackPlayer.currentSequence,onClick:()=>this.onClickStop()},{title:"Restart",disabled:this.selectedNoteIndex<0,onClick:()=>this.onClickRestart()},{title:"Reset",disabled:this.track.notes.length===0,onClick:()=>this.onClickReset()}],[{disabled:!((e=this.track.getCurrentNote())!=null&&e.isPaused),title:"Duration",onClick:async()=>{const n=this.track.getCurrentNote();this.preserveContextMenu(!0);const o="Set Duration:",a=await this.core.executeCommand(`openDialog -title="${o}" -prompt -prompt-type=number -prompt-step=0.01 -prompt-value="${n.toSeconds()/2}" -apply="Save" -abort="Cancel"`);a&&(console.log(n),console.log(a),n.duration=Number(a*2),n.time=null),this.preserveContextMenu(!1),this.window.focus()}},{disabled:this.selectedNoteIndex===-1,title:"Replace",name:s.SYNTHESIZER_INPUT_OPERATION,value:N.REPLACE},{disabled:this.selectedNoteIndex===-1,title:"Add",name:s.SYNTHESIZER_INPUT_OPERATION,value:N.ADD},{disabled:this.selectedNoteIndex===-1,title:"Remove",onClick:()=>{this.track.removeNote(this.selectedNoteIndex)}},{spacer:!0},{title:"Prev",disabled:this.selectedNoteIndex<0,onClick:()=>{this.track.selectPrevNote()}},{title:"Next",disabled:this.selectedNoteIndex>=this.track.notes.length-1,onClick:()=>{this.track.selectNextNote()}}]]}},footer(){const e=this.track,n=this.model,o=e.getDuration();return{items:H([{type:d.TEXT,text:`${this.track.selectedIndex}/${this.notes.length}`},{type:d.DEFAULT,title:`Instrument: ${this.track.type}`,items:Object.entries(Z()).map(([a,i])=>({type:d.RADIO,title:i,model:e,name:"type",value:a}))},{type:d.SEPARATOR},{title:`Octave: ${n[s.SYNTHESIZER_START_OCTAVE]}-${n[s.SYNTHESIZER_START_OCTAVE]+n[s.SYNTHESIZER_OCTAVE_COUNT]-1}`,items:[{type:d.DEFAULT,title:"Start Octave",items:Array(9).fill({}).map((a,i)=>({type:d.RADIO,title:String(i+1),model:n,name:s.SYNTHESIZER_START_OCTAVE,value:i+1,action(t){if(t=Number(t),t+n[s.SYNTHESIZER_OCTAVE_COUNT]>9){debugger;n[s.SYNTHESIZER_OCTAVE_COUNT]=10-t}}}))},{type:d.DEFAULT,title:"Octave Count",items:Array(10-n[s.SYNTHESIZER_START_OCTAVE]).fill({}).map((a,i)=>({type:d.RADIO,title:String(i+1),model:n,name:s.SYNTHESIZER_OCTAVE_COUNT,value:i+1}))}]},{type:d.SPACER},{type:d.TEXT,text:`Dur.: ${o}`},{type:d.TEXT,text:`BPM: ${this.bpm}`},{type:d.TEXT,text:`${this.decibelValue.toFixed(2)} db`}])}},noteNavigation(){return{model:this.model,items:[[{fill:!0,title:"Pause",onClick:()=>this.addPause()},...Object.entries(V(!0)).map(([e,n])=>({title:`${n} Note`,name:s.SYNTHESIZER_DURATION,value:e}))],[{fill:!0,title:"Dot",name:s.SYNTHESIZER_INPUT_DOT},{fill:!0,title:"Triplet",name:s.SYNTHESIZER_INPUT_TRIPLET},{fill:!0,title:"Sharp",name:s.SYNTHESIZER_INPUT_SHARP},{fill:!0,title:"2x Sharp",name:s.SYNTHESIZER_INPUT_DOUBLE_SHARP}]]}}},watch:{"trackPlayer.noteIndex"(e){this.track.selectedIndex=e},bpm(){var e;(e=this.trackPlayer)==null||e.stop()},masterVolume:{handler(){L.volume.value=this.decibelValue},immediate:!0},"track.type":{handler(){this.trackPlayer.createInstrument(this.track.type)},immediate:!0}},mounted(){console.log("TRACK",this.track)},unmounted(){this.trackPlayer.destroy()},methods:{async setup(){this.tone.ready||(await this.tone.start(),this.trackPlayer.createInstrument(this.track.type))},onClickReset(){this.trackPlayer.reset(),this.track.selectedIndex=-1},async onClickPlay(){await this.setup(),this.trackPlayer.play(this.selectedNoteIndex)},onClickPlause(){this.trackPlayer.pause()},onClickStop(){this.trackPlayer.stop()},onClickRestart(){this.trackPlayer.restart()},async onClickNote({note:e,selected:n}){await this.setup(),n&&e.name&&this.trackPlayer.instrument.triggerAttackRelease(e.name,e.time)},addPause(){this.noteInput()},noteInput(e,n){const o=new E.Note({name:n,sharp:this.model[s.SYNTHESIZER_INPUT_SHARP],doubleSharp:this.model[s.SYNTHESIZER_INPUT_DOUBLE_SHARP]}),a=new E.Time(this.duration);a.dot=this.model[s.SYNTHESIZER_INPUT_DOT],a.triplet=this.model[s.SYNTHESIZER_INPUT_TRIPLET];const i=new E({note:o,time:a});console.log("noteInput",o.toString(),a.toString());const t=this.track.selectedIndex;if(t>-1)switch(e){case N.ADD:return this.track.addNoteTo(t,i);case N.REPLACE:return this.track.replaceNote(t,i)}return this.track.addNote(i)},async onDownKeyboard(e){await this.setup(),this.noteInput(this.model[s.SYNTHESIZER_INPUT_OPERATION],e),this.trackPlayer.instrument.triggerAttack(e)},async onUpKeyboard(){await this.tone.awaitReady,this.trackPlayer.instrument.triggerRelease()}}},ke={key:0,class:"keyboard"},Ne={class:"panel"},Ee={key:0,class:"test"},Te={class:"sheet"};function Se(e,n,o,a,i,t){const l=y("keyboard"),u=y("navigation"),m=y("synthesizer-timeline-canvas"),p=y("wb-env-molecule-footer");return r(),c("div",{class:T(["wb-disks-extras13-synthesizer-track",t.styleClasses])},[h("div",null,[h("div",null,[t.showKeyboard?(r(),c("div",ke,[k(l,v(t.keybordData,{onDown:t.onDownKeyboard,onUp:t.onUpKeyboard}),null,16,["onDown","onUp"]),h("span",{class:T(["message",{show:t.isMaxLength}])},"Octave length is to large…",2)])):_("",!0),t.showKeyboard?(r(),W(u,f(v({key:1},t.noteNavigation)),null,16)):_("",!0)]),h("div",Ne,[t.showKeyboard?(r(),c("div",Ee)):_("",!0),k(u,f(F(t.noteDiagramControlNavigation)),null,16),h("div",Te,[h("div",null,[k(m,{clickable:"",track:a.trackPlayer.track,"onNote:click":t.onClickNote},null,8,["track","onNote:click"])])])])]),k(p,v(t.footer,{"parent-layout":i.windowsModule.contentWrapper.layout}),null,16,["parent-layout"])],2)}const Oe=C(ye,[["render",Se],["__scopeId","data-v-d28fe873"]]);export{Oe as default};
