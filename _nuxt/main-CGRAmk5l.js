(function(){"use strict";var Dt=function(t,e){return Dt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},Dt(t,e)};function At(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Dt(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function Qn(t,e,r,n){function i(o){return o instanceof r?o:new r(function(s){s(o)})}return new(r||(r=Promise))(function(o,s){function c(h){try{l(n.next(h))}catch(_){s(_)}}function u(h){try{l(n.throw(h))}catch(_){s(_)}}function l(h){h.done?o(h.value):i(h.value).then(c,u)}l((n=n.apply(t,e||[])).next())})}function Er(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=c(0),s.throw=c(1),s.return=c(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(l){return function(h){return u([l,h])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(r=0)),r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(h){l=[6,h],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Ne(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function xe(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(c){s={error:c}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}function tt(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}function Ee(t){return this instanceof Ee?(this.v=t,this):new Ee(t)}function Yn(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(p){return function(k){return Promise.resolve(k).then(p,_)}}function c(p,k){n[p]&&(i[p]=function(y){return new Promise(function(ve,le){o.push([p,y,ve,le])>1||u(p,y)})},k&&(i[p]=k(i[p])))}function u(p,k){try{l(n[p](k))}catch(y){S(o[0][3],y)}}function l(p){p.value instanceof Ee?Promise.resolve(p.value.v).then(h,_):S(o[0][2],p)}function h(p){u("next",p)}function _(p){u("throw",p)}function S(p,k){p(k),o.shift(),o.length&&u(o[0][0],o[0][1])}}function Wn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Ne=="function"?Ne(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=t[o]&&function(s){return new Promise(function(c,u){s=t[o](s),i(c,u,s.done,s.value)})}}function i(o,s,c,u){Promise.resolve(u).then(function(l){o({value:l,done:c})},s)}}typeof SuppressedError=="function"&&SuppressedError;function C(t){return typeof t=="function"}function Cr(t){var e=function(n){Error.call(n),n.stack=new Error().stack},r=t(e);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var kt=Cr(function(t){return function(r){t(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function Dr(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var Mt=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,r,n,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var c=Ne(s),u=c.next();!u.done;u=c.next()){var l=u.value;l.remove(this)}}catch(y){e={error:y}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}else s.remove(this);var h=this.initialTeardown;if(C(h))try{h()}catch(y){o=y instanceof kt?y.errors:[y]}var _=this._finalizers;if(_){this._finalizers=null;try{for(var S=Ne(_),p=S.next();!p.done;p=S.next()){var k=p.value;try{kr(k)}catch(y){o=o??[],y instanceof kt?o=tt(tt([],xe(o)),xe(y.errors)):o.push(y)}}}catch(y){n={error:y}}finally{try{p&&!p.done&&(i=S.return)&&i.call(S)}finally{if(n)throw n.error}}}if(o)throw new kt(o)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)kr(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(e)}},t.prototype._hasParent=function(e){var r=this._parentage;return r===e||Array.isArray(r)&&r.includes(e)},t.prototype._addParent=function(e){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(e),r):r?[r,e]:e},t.prototype._removeParent=function(e){var r=this._parentage;r===e?this._parentage=null:Array.isArray(r)&&Dr(r,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&Dr(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}();Mt.EMPTY;function Ar(t){return t instanceof Mt||t&&"closed"in t&&C(t.remove)&&C(t.add)&&C(t.unsubscribe)}function kr(t){C(t)?t():t.unsubscribe()}var Kn={Promise:void 0},ei={setTimeout:function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,tt([t,e],xe(r)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Mr(t){ei.setTimeout(function(){throw t})}function Tr(){}function ti(t){t()}var Tt=function(t){At(e,t);function e(r){var n=t.call(this)||this;return n.isStopped=!1,r?(n.destination=r,Ar(r)&&r.add(n)):n.destination=ii,n}return e.create=function(r,n,i){return new Rt(r,n,i)},e.prototype.next=function(r){this.isStopped||this._next(r)},e.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(r){this.destination.next(r)},e.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Mt),ri=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var r=this.partialObserver;if(r.next)try{r.next(e)}catch(n){rt(n)}},t.prototype.error=function(e){var r=this.partialObserver;if(r.error)try{r.error(e)}catch(n){rt(n)}else rt(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(r){rt(r)}},t}(),Rt=function(t){At(e,t);function e(r,n,i){var o=t.call(this)||this,s;return C(r)||!r?s={next:r??void 0,error:n??void 0,complete:i??void 0}:s=r,o.destination=new ri(s),o}return e}(Tt);function rt(t){Mr(t)}function ni(t){throw t}var ii={closed:!0,next:Tr,error:ni,complete:Tr},Ot=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Rr(t){return t}function oi(t){return t.length===0?Rr:t.length===1?t[0]:function(r){return t.reduce(function(n,i){return i(n)},r)}}var J=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(e,r,n){var i=this,o=ai(e)?e:new Rt(e,r,n);return ti(function(){var s=i,c=s.operator,u=s.source;o.add(c?c.call(o,u):u?i._subscribe(o):i._trySubscribe(o))}),o},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(r){e.error(r)}},t.prototype.forEach=function(e,r){var n=this;return r=Or(r),new r(function(i,o){var s=new Rt({next:function(c){try{e(c)}catch(u){o(u),s.unsubscribe()}},error:o,complete:i});n.subscribe(s)})},t.prototype._subscribe=function(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)},t.prototype[Ot]=function(){return this},t.prototype.pipe=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return oi(e)(this)},t.prototype.toPromise=function(e){var r=this;return e=Or(e),new e(function(n,i){var o;r.subscribe(function(s){return o=s},function(s){return i(s)},function(){return n(o)})})},t.create=function(e){return new t(e)},t}();function Or(t){var e;return(e=t??Kn.Promise)!==null&&e!==void 0?e:Promise}function si(t){return t&&C(t.next)&&C(t.error)&&C(t.complete)}function ai(t){return t&&t instanceof Tt||si(t)&&Ar(t)}function ci(t){return C(t?.lift)}function Ce(t){return function(e){if(ci(e))return e.lift(function(r){try{return t(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function He(t,e,r,n,i){return new li(t,e,r,n,i)}var li=function(t){At(e,t);function e(r,n,i,o,s,c){var u=t.call(this,r)||this;return u.onFinalize=s,u.shouldUnsubscribe=c,u._next=n?function(l){try{n(l)}catch(h){r.error(h)}}:t.prototype._next,u._error=o?function(l){try{o(l)}catch(h){r.error(h)}finally{this.unsubscribe()}}:t.prototype._error,u._complete=i?function(){try{i()}catch(l){r.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,u}return e.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},e}(Tt);function ui(t){return t&&C(t.schedule)}function hi(t){return t[t.length-1]}function di(t){return ui(hi(t))?t.pop():void 0}var zt=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function zr(t){return C(t?.then)}function Br(t){return C(t[Ot])}function Fr(t){return Symbol.asyncIterator&&C(t?.[Symbol.asyncIterator])}function Ir(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function _i(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Vr=_i();function Ur(t){return C(t?.[Vr])}function Pr(t){return Yn(this,arguments,function(){var r,n,i,o;return Er(this,function(s){switch(s.label){case 0:r=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,Ee(r.read())];case 3:return n=s.sent(),i=n.value,o=n.done,o?[4,Ee(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,Ee(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function Gr(t){return C(t?.getReader)}function De(t){if(t instanceof J)return t;if(t!=null){if(Br(t))return fi(t);if(zt(t))return pi(t);if(zr(t))return gi(t);if(Fr(t))return Nr(t);if(Ur(t))return yi(t);if(Gr(t))return wi(t)}throw Ir(t)}function fi(t){return new J(function(e){var r=t[Ot]();if(C(r.subscribe))return r.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function pi(t){return new J(function(e){for(var r=0;r<t.length&&!e.closed;r++)e.next(t[r]);e.complete()})}function gi(t){return new J(function(e){t.then(function(r){e.closed||(e.next(r),e.complete())},function(r){return e.error(r)}).then(null,Mr)})}function yi(t){return new J(function(e){var r,n;try{for(var i=Ne(t),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(c){r={error:c}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}e.complete()})}function Nr(t){return new J(function(e){mi(t,e).catch(function(r){return e.error(r)})})}function wi(t){return Nr(Pr(t))}function mi(t,e){var r,n,i,o;return Qn(this,void 0,void 0,function(){var s,c;return Er(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),r=Wn(t),u.label=1;case 1:return[4,r.next()];case 2:if(n=u.sent(),!!n.done)return[3,4];if(s=n.value,e.next(s),e.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=u.sent(),i={error:c},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function pe(t,e,r,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var o=e.schedule(function(){r(),i?t.add(this.schedule(null,n)):this.unsubscribe()},n);if(t.add(o),!i)return o}function xr(t,e){return e===void 0&&(e=0),Ce(function(r,n){r.subscribe(He(n,function(i){return pe(n,t,function(){return n.next(i)},e)},function(){return pe(n,t,function(){return n.complete()},e)},function(i){return pe(n,t,function(){return n.error(i)},e)}))})}function Hr(t,e){return e===void 0&&(e=0),Ce(function(r,n){n.add(t.schedule(function(){return r.subscribe(n)},e))})}function bi(t,e){return De(t).pipe(Hr(e),xr(e))}function Si(t,e){return De(t).pipe(Hr(e),xr(e))}function vi(t,e){return new J(function(r){var n=0;return e.schedule(function(){n===t.length?r.complete():(r.next(t[n++]),r.closed||this.schedule())})})}function Li(t,e){return new J(function(r){var n;return pe(r,e,function(){n=t[Vr](),pe(r,e,function(){var i,o,s;try{i=n.next(),o=i.value,s=i.done}catch(c){r.error(c);return}s?r.complete():r.next(o)},0,!0)}),function(){return C(n?.return)&&n.return()}})}function $r(t,e){if(!t)throw new Error("Iterable cannot be null");return new J(function(r){pe(r,e,function(){var n=t[Symbol.asyncIterator]();pe(r,e,function(){n.next().then(function(i){i.done?r.complete():r.next(i.value)})},0,!0)})})}function Ei(t,e){return $r(Pr(t),e)}function Ci(t,e){if(t!=null){if(Br(t))return bi(t,e);if(zt(t))return vi(t,e);if(zr(t))return Si(t,e);if(Fr(t))return $r(t,e);if(Ur(t))return Li(t,e);if(Gr(t))return Ei(t,e)}throw Ir(t)}function jr(t,e){return e?Ci(t,e):De(t)}function nt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=di(t);return jr(t,r)}var Di=Cr(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function Ai(t,e){return new Promise(function(r,n){var i=!1,o;t.subscribe({next:function(s){o=s,i=!0},error:n,complete:function(){i?r(o):n(new Di)}})})}function B(t,e){return Ce(function(r,n){var i=0;r.subscribe(He(n,function(o){n.next(t.call(e,o,i++))}))})}var ki=Array.isArray;function Mi(t,e){return ki(e)?t.apply(void 0,tt([],xe(e))):t(e)}function Ti(t){return B(function(e){return Mi(t,e)})}function Ri(t,e,r,n,i,o,s,c){var u=[],l=0,h=0,_=!1,S=function(){_&&!u.length&&!l&&e.complete()},p=function(y){return l<n?k(y):u.push(y)},k=function(y){l++;var ve=!1;De(r(y,h++)).subscribe(He(e,function(le){e.next(le)},function(){ve=!0},void 0,function(){if(ve)try{l--;for(var le=function(){var U=u.shift();s||k(U)};u.length&&l<n;)le();S()}catch(U){e.error(U)}}))};return t.subscribe(He(e,p,function(){_=!0,S()})),function(){}}function Ae(t,e,r){return r===void 0&&(r=1/0),C(e)?Ae(function(n,i){return B(function(o,s){return e(n,o,i,s)})(De(t(n,i)))},r):(typeof e=="number"&&(r=e),Ce(function(n,i){return Ri(n,i,t,r)}))}function Oi(t){return Ae(Rr,t)}function zi(){return Oi(1)}var Bi=["addListener","removeListener"],Fi=["addEventListener","removeEventListener"],Ii=["on","off"];function Bt(t,e,r,n){if(C(r)&&(n=r,r=void 0),n)return Bt(t,e,r).pipe(Ti(n));var i=xe(Pi(t)?Fi.map(function(c){return function(u){return t[c](e,u,r)}}):Vi(t)?Bi.map(qr(t,e)):Ui(t)?Ii.map(qr(t,e)):[],2),o=i[0],s=i[1];if(!o&&zt(t))return Ae(function(c){return Bt(c,e,r)})(De(t));if(!o)throw new TypeError("Invalid event target");return new J(function(c){var u=function(){for(var l=[],h=0;h<arguments.length;h++)l[h]=arguments[h];return c.next(1<l.length?l:l[0])};return o(u),function(){return s(u)}})}function qr(t,e){return function(r){return function(n){return t[r](e,n)}}}function Vi(t){return C(t.addListener)&&C(t.removeListener)}function Ui(t){return C(t.on)&&C(t.off)}function Pi(t){return C(t.addEventListener)&&C(t.removeEventListener)}function Gi(t,e,r,n,i){return function(o,s){var c=r,u=e,l=0;o.subscribe(He(s,function(h){var _=l++;u=c?t(u,h,_):(c=!0,h)},function(){c&&s.next(u),s.complete()}))}}function Ni(t,e){return Ce(Gi(t,e,arguments.length>=2,!1,!0))}var xi=function(t,e){return t.push(e),t};function Hi(){return Ce(function(t,e){Ni(xi,[])(t).subscribe(e)})}function Ft(t,e){return C(e)?Ae(t,e,1):Ae(t,1)}function it(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Jr(t,e){const{x:r,y:n,z:i}=e,{x:o,y:s,z:c,w:u}=t,l=u*r+s*i-c*n,h=u*n+c*r-o*i,_=u*i+o*n-s*r,S=-o*r-s*n-c*i,p=l*u+S*-o+h*-c-_*-s,k=h*u+S*-s+_*-o-l*-c,y=_*u+S*-c+l*-s-h*-o;return new e.constructor(p,k,y)}const It=Math.PI,Vt=Math.PI*2;function $e(t){let e=t%Vt;return e<-It?e+=Vt:e>It&&(e-=Vt),e}function $i(t){return t>-1?t<1?Math.acos(t):0:It}function ji(t,[e,r,n]){const[i,o,s]=t;return new t.constructor(new i.constructor(i.x*e.x+o.x*e.y+s.x*e.z,i.y*e.x+o.y*e.y+s.y*e.z,i.z*e.x+o.z*e.y+s.z*e.z),new i.constructor(i.x*r.x+o.x*r.y+s.x*r.z,i.y*r.x+o.y*r.y+s.y*r.z,i.z*r.x+o.z*r.y+s.z*r.z),new i.constructor(i.x*n.x+o.x*n.y+s.x*n.z,i.y*n.x+o.y*n.y+s.y*n.z,i.z*n.x+o.z*n.y+s.z*n.z))}function qi(t,{x:e,y:r,z:n}){const[i,o,s]=t;return new i.constructor(i.x*e+o.x*r+s.x*n,i.y*e+o.y*r+s.y*n,i.z*e+o.z*r+s.z*n)}function Ji(t,[e,r,n]){return new t.constructor(t.dot(e),t.dot(r),t.dot(n))}function ue(t){return typeof t=="number"||t?.constructor===Number}const Zi=t=>{try{Me(t),Je(t,4)}catch(e){console.error("error while hijackDOMPoint"),console.error(e)}},je=0,Ut=1,Pt=2,Gt=3,ot=9999999999999,st=void 0,Zr=Symbol("vector length"),at=Symbol("get source"),Xr=Symbol("checked");let $=st,he,ke;const Xi=[0,1,2,6,24,120,720,5760,51840,518400,5702400,68428800,889574400,12454041600,186810624e3],Nt=[];let re=-1,xt=!1;const ct=[];function Ht(t,e,r){$=t,re=-1,ke=1;const n=e(r);if(!ue(n))throw new Error(`
      your assigned progress did not not return a primitive!
      calc() does not support logical operators (|| && ==) directly

      instead of calc(() => v1 || v2);
      use        calc(() => +v1 || +v2);

      instead of calc(() => v1);
      use        calc(v1);
      `);return n}function lt(t){const e=t[at];return e?e(t).length:t[Zr]||3}function Qi(t,e){return lt(t)>lt(e)?t:e}function Yi(t,e){if(ke+=1,e===ot)return ke;if(e>=lt(t))return 0;const r=t[at];if(r)return 1*r(t)[e];if(e===je)return 1*t.x;if(e===Ut)return 1*t.y;if(e===Pt)return 1*t.z;if(e===Gt)return 1*t.w}function Qr(t,e,r){const n=t[at];if(n){n(t)[e]=r;return}if(e===je){t.x=r;return}if(e===Ut){t.y=r;return}e===Pt&&(t.z=r),e===Gt&&(t.w=r)}function qe(t,e=void 0){if(typeof t!="function")throw new Error("no function assigned");if($!==st)throw new Error("something wrong, do you use calc() inside calc?");try{const r=typeof e>"u",n=typeof e=="function",i=!n&&!r?e:void 0,o=Ht(je,t,i);if(r&&typeof he>"u")return o;const s=he?lt(he):0;if(s===ot){if(!t[Xr]){const h=Ht(ot,t),_=Xi[ke];if(Math.abs(h-_)>Number.EPSILON)throw new Error(`
            algebraic multiplication works only in calls with *

            calc(() => v * m);
            calc(() => m * v);
            calc(() => m * m);
            calc(() => m * m * v);

            `);t[Xr]=!0}let l=Nt[0];for(let h=1;h<ke-1;h+=1){const _=Nt[h];if(!l.multiply)throw new Error(`cannot find method multiply() on ${l}`);l=l.multiply(_)}return l}let c=n?e.length:s;if(c||(c=s),c<s)throw new Error("Your assigned result Vector cant use higher space Operands than it has");const u=new Array(c);u[0]=o,i&&Qr(i,$,u[0]);for(let l=1;l<c;l+=1){const h=Ht(l,t,i);u[l]=h,i&&Qr(i,$,h)}return r?new he.constructor(...u):n?e(...u):i}finally{$=st,he=void 0}}function Me(t,e){const r=t.prototype;r[at]=e;const n=r[Symbol.toPrimitive]||function(i){return i==="string"?this.toString():this.valueOf()};r[Symbol.toPrimitive]=function(i){return $===je&&(he=he?Qi(he,this):this,Nt[ke-1]=this),$===st?n.call(this,i):Yi(this,$)}}function $t(t){return function(...e){if($===je){if(xt)return t.apply(this,e);try{xt=!0,re+=1;const r=t.apply(this,e);return ct[re]=r,r}finally{xt=!1}}return $===Ut||$===Pt||$===Gt?(re+=1,ct[re]):t.apply(this,e)}}function P(t,e){const r=t.prototype,n=r[e];r[e]=$t(n)}function ut(t,e){const r=t.prototype,n=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(r,e,{get:$t(function(){return n.get.call(this)})})}function Je(t,e){const r=t.prototype;Object.defineProperty(r,Zr,{value:e})}function Yr(t){Je(t,ot)}function ht(t){return $t(t)}typeof DOMPoint<"u"&&Zi(DOMPoint);function Wi(t){let e="";return t&&(e=`${t}-`),e}function Ze(t,e,r={}){const n=Wi(t);return Object.entries(e).forEach(([i,o])=>{r[`--${n}${i}`]=o}),r}const jt=0,qt=1,Z=Symbol("axes");function Ki(t,e,r,n){const i=Math.atan2(t,e),o=Math.atan2(r,n);return $e(i-o)}function Wr(t){return t*t}class X{constructor(...e){typeof e[0]=="function"?qe(e[0],(r,n)=>{this[Z]=[r,n]}):it(e[0])?this[Z]=[...e[0]]:e[0]&&ue(e[0].x)?this[Z]=[e[0].x||0,e[0].y||0]:this[Z]=[e[0]||0,e[1]||0]}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}normalize(){const{length:e}=this;return new this.constructor(this.x/e,this.y/e)}norm(){return this.normalize()}dot(e){return this.x*e.x+this.y*e.y}getRad(){return $e(Math.atan2(this.y,this.x))}angleTo(e){return Ki(this.y,this.x,e.y,e.x)}rotate(e){const r=Math.sin(e),n=Math.cos(e),i=this.x*n-this.y*r,o=this.x*r+this.y*n;return new this.constructor(i,o)}distance(e){return Math.sqrt(Wr(this.x-e.x)+Wr(this.y-e.y))}dist(e){return this.distance(e)}toArray(){return[this.x,this.y]}calc(e){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(e){return this.x===e.x&&this.y===e.y}toJSON(){return{x:this.x,y:this.y}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(e,r={}){return Ze(e,this.toJSON(),r)}get lengthSq(){return this.dot(this)}get length(){return Math.sqrt(this.lengthSq)}get lensq(){return this.lengthSq}get len(){return this.length}get x(){return this[Z][jt]}set x(e){throw new Error("set x() not implemented")}get y(){return this[Z][qt]}set y(e){throw new Error("set y() not implemented")}get z(){throw new Error("get z() not implemented")}set z(e){throw new Error("set z() not implemented")}[Symbol.iterator](){return this[Z].values()}}Me(X),Je(X,2),P(X,"dot"),P(X,"angleTo"),P(X,"distance"),P(X,"toArray"),P(X,"getRad"),ut(X,"length"),ut(X,"lengthSq");let Kr=class Xn extends X{set x(e){this[Z][jt]=e}set y(e){this[Z][qt]=e}get x(){return this[Z][jt]}get y(){return this[Z][qt]}calc(e){return qe(e,this)}clone(){return new Xn(this.x,this.y)}};class Te extends X{toPoint(){return new Kr(this.x,this.y)}}const eo=ht((t,e)=>new Kr(t,e)),Xe=(t,e)=>eo(t,e),to=ht((t,e)=>new Te(t,e)),d=(t,e)=>to(t,e);d(0,0),d(0,-1),d(-1,0);const Re=0,Oe=1,ze=2,T=Symbol("axes");function Jt(t){return t*t}class G{constructor(...e){typeof e[0]=="function"?qe(e[0],(r,n,i)=>{this[T]=[r,n,i]}):it(e[0])?this[T]=[...e[0]]:e[0]&&ue(e[0].x)?this[T]=[e[0].x||0,e[0].y||0,e[0].z||0]:this[T]=[e[0]||0,e[1]||0,e[2]||0]}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}normalize(){const{length:e}=this;return new this.constructor(this.x/e,this.y/e,this.z/e)}norm(){return this.normalize()}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}cross(e){return new this.constructor(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}crossNormalize(e){const r=this.cross(e),{length:n}=r;return r[T][Re]/=n,r[T][Oe]/=n,r[T][ze]/=n,r}cn(e){return this.crossNormalize(e)}toAngles(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length)}}angleTo(e){return $e($i(this.dot(e)/(this.length*e.length)))}multiply(e){return e.x===void 0?this.multiplyMat3(e):e.w===void 0?this.multiplyVec3(e):Jr(e,this)}multiplyMat3(e){return Ji(this,e)}multiplyVec3({x:e,y:r,z:n}){return new this.constructor(this.x*e,this.y*r,this.z*n)}distance(e){return Math.sqrt(Jt(this.x-e.x)+Jt(this.y-e.y)+Jt(this.z-e.z))}dist(e){return this.distance(e)}toArray(){return[this.x,this.y,this.z]}swizzle(e){const r=e.split("").map(n=>this[n]);return r.length===2?new Te(r[0],r[1]):new this.constructor(r[0],r[1],r[2])}calc(e){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}toJSON(){return{x:this.x,y:this.y,z:this.z}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(e,r={}){return Ze(e,this.toJSON(),r)}get lengthSq(){return this.dot(this)}set lengthSq(e){throw new Error("set lengthSq() not implemented")}get length(){return Math.sqrt(this.lengthSq)}set length(e){throw new Error("set length() not implemented")}get lensq(){return this.lengthSq}set lensq(e){throw new Error("set lensq() not implemented")}get len(){return this.length}set len(e){throw new Error("set len() not implemented")}get x(){return this[T][Re]}set x(e){throw new Error("set x() not implemented")}get y(){return this[T][Oe]}set y(e){throw new Error("set y() not implemented")}get z(){return this[T][ze]}set z(e){throw new Error("set z() not implemented")}get xy(){return new Te(this[T][Re],this[T][Oe])}set xy(e){throw new Error("set xz() not implemented")}get xz(){return new Te(this[T][Re],this[T][ze])}set xz(e){throw new Error("set xz() not implemented")}get yz(){return new Te(this[T][Oe],this[T][ze])}set yz(e){throw new Error("set yz() not implemented")}[Symbol.iterator](){return this[T].values()}}Me(G),Je(G,3),P(G,"dot"),P(G,"cross"),P(G,"crossNormalize"),P(G,"toAngles"),P(G,"angleTo"),P(G,"rotate"),P(G,"distance"),P(G,"toArray"),ut(G,"length"),ut(G,"lengthSq");class Zt extends G{set x(e){this[T][Re]=e}set y(e){this[T][Oe]=e}set z(e){this[T][ze]=e}get x(){return this[T][Re]}get y(){return this[T][Oe]}get z(){return this[T][ze]}calc(e){return qe(e,this)}clone(){return new Zt(this.x,this.y,this.z)}}class ro extends G{toVector(){return new Zt(this.x,this.y,this.z)}clone(){return this}}const no=ht((t,e,r)=>new ro(t,e,r)),de=(t,e,r)=>no(t,e,r);de(0,0,0);const en=de(0,0,-1);de(0,0,1);const Xt=de(-1,0,0);de(1,0,0);const tn=de(0,1,0);de(0,-1,0),de(1,1,1);const ne=Symbol("angle rad"),rn=Math.PI/180;class Be{constructor(e){e instanceof Be?this[ne]=e[ne]:this[ne]=$e(e*rn)}valueOf(){return this[ne]}toJSON(){return{angle:this[ne]}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(e,r={}){return Ze(e,this.toJSON(),r)}}class nn extends Be{set(e){e instanceof Be?this[ne]=e[ne]:this[ne]=$e((e||0)*rn)}}class io extends Be{toDegree(){return new nn(this[ne])}}new io(0);function oo(t){return new nn(t)}function so(t){return ue(t)||t instanceof Be}const ge=0,ye=1,we=2,me=3,Fe=Symbol("axes"),ao=Symbol("forward cache"),co=Symbol("left cache"),lo=Symbol("up cache"),uo=Symbol("inverse cache");function ho([t,e,r,n]){return Math.sqrt(t*t+e*e+r*r+n*n)}function _o(t){const e=ho(t);t[ge]/=e,t[ye]/=e,t[we]/=e,t[me]/=e}function fo(t,e){const r=t.normalize(),n=e.crossNormalize(r),i=r.crossNormalize(n),o=n.x,s=n.y,c=n.z,u=i.x,l=i.y,h=i.z,_=r.x,S=r.y,p=r.z,k=o+l+p,y=new Array(4);if(k>0){let U=Math.sqrt(k+1);return y[me]=U*.5,U=.5/U,y[ge]=(h-S)*U,y[ye]=(_-c)*U,y[we]=(s-u)*U,y}if(o>=l&&o>=p){const U=Math.sqrt(1+o-l-p),Le=.5/U;return y[ge]=.5*U,y[ye]=(s+u)*Le,y[we]=(c+_)*Le,y[me]=(h-S)*Le,y}if(l>p){const U=Math.sqrt(1+l-o-p),Le=.5/U;return y[ge]=(u+s)*Le,y[ye]=.5*U,y[we]=(S+h)*Le,y[me]=(_-c)*Le,y}const ve=Math.sqrt(1+p-o-l),le=.5/ve;return y[ge]=(_+c)*le,y[ye]=(S+h)*le,y[we]=.5*ve,y[me]=(s-u)*le,y}function po(t,e){const r=new Array(4),n=e*.5,i=Math.sin(n),o=Math.cos(n);return r[ge]=i*t.x,r[ye]=i*t.y,r[we]=i*t.z,r[me]=o,r}function Qt(t,e,r,n){if(ue(t))return[t,e,r,n];if(it(t))return[...t];if(so(e))return po(t,e);if(t&&e)return fo(t,e)}function go(t,e,r,n){return t&&ue(t.w)?Qt(t.x,t.y,t.z,t.w):Qt(t,e,r,n)||[0,0,0,1]}class Yt{constructor(e,r,n,i){this[Fe]=go(e,r,n,i),_o(this[Fe])}set(e,r,n,i){throw new Error("set x() not implemented")}multiply(e,r,n,i){if(ue(e.w))return this.multiplyQuaternion(e);const o=Qt(e,r,n,i);return o?this.multiplyQuaternion(new this.constructor(o)):this.multiplyVector(e)}multiplyVector(e){return Jr(this,e)}multiplyQuaternion(e){const r=this.x,n=this.y,i=this.z,o=this.w,s=e.x,c=e.y,u=e.z,l=e.w,h=o*s+r*l+n*u-i*c,_=o*c+n*l+i*s-r*u,S=o*u+i*l+r*c-n*s,p=o*l-r*s-n*c-i*u;return new this.constructor(h,_,S,p)}mul(e,r,n,i){return this.multiply(e,r,n,i)}get inverse(){const{x:e,y:r,z:n,w:i}=this;return this.constructor(e*-1,r*-1,n*-1,i)}get inv(){return this.inverse}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}get left(){return this.multiplyVector(Xt)}get dir(){return this.multiplyVector(en)}get up(){return this.multiplyVector(tn)}get 0(){return this.left}get 1(){return this.dir}get 2(){return this.up}get x(){return this[Fe][ge]}set x(e){throw new Error("set x() not implemented")}get y(){return this[Fe][ye]}set y(e){throw new Error("set y() not implemented")}get z(){return this[Fe][we]}set z(e){throw new Error("set z() not implemented")}get w(){return this[Fe][me]}set w(e){throw new Error("set w() not implemented")}toJSON(){const{x:e,y:r,z:n,w:i}=this;return{x:e,y:r,z:n,w:i,a1:1-r*r*2-n*n*2,a2:e*r*2-n*i*2,a3:e*n*2+r*i*2,b1:e*r*2+n*i*2,b2:1-e*e*2-n*n*2,b3:r*n*2-e*i*2,c1:e*n*2-r*i*2,c2:r*n*2+e*i*2,c3:1-e*e*2-r*r*2}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(e,r={}){return Ze(e,this.toJSON(),r)}}Me(Yt),Yr(Yt);function dt(t,e,r){let n=t[e];return n||(n=r(),t[e]=n),n}class on extends Yt{get left(){return dt(this,co,()=>this.multiplyVector(Xt))}get dir(){return dt(this,ao,()=>this.multiplyVector(en))}get up(){return dt(this,lo,()=>this.multiplyVector(tn))}get inverse(){return dt(this,uo,()=>{const{x:e,y:r,z:n,w:i}=this;return this.constructor(e*-1,r*-1,n*-1,i)})}}const yo=ht((t,e,r,n)=>new on(t,e,r,n)),wo=(t,e,r,n)=>yo(t,e,r,n);new on(Xt,oo(90)),wo(0,0,0,1);const mo=0,bo=1,So=2,vo=3,ie=Symbol("axes");class Wt{constructor(e,r,n,i){typeof e=="function"?qe(e,(o,s,c,u)=>{this[ie]=[o,s,c,u]}):it(e)?this[ie]=[...e]:e&&ue(e.x)?this[ie]=[e.x||0,e.y||0,e.z||0,e.w||0]:this[ie]=[e||0,r||0,n||0,i||0]}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}toArray(){return[this.x,this.y,this.z,this.w]}calc(e){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}toJSON(){return{x:this.x,y:this.y,z:this.z,w:this.w}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(e,r={}){return Ze(e,this.toJSON(),r)}get x(){return this[ie][mo]}set x(e){throw new Error("set x() not implemented")}get y(){return this[ie][bo]}set y(e){throw new Error("set y() not implemented")}get z(){return this[ie][So]}set z(e){throw new Error("set z() not implemented")}get w(){return this[ie][vo]}set w(e){throw new Error("set w() not implemented")}[Symbol.iterator](){return this[ie].values()}}Me(Wt),Je(Wt,4),P(Wt,"toArray");const Qe=Symbol("data");class _t{constructor(...e){this[Qe]=e}get 0(){return this[Qe][0]}set 0(e){throw new Error("set [0] not implemented")}get 1(){return this[Qe][1]}set 1(e){throw new Error("set [1] not implemented")}get 2(){return this[Qe][2]}set 2(e){throw new Error("set [2] not implemented")}multiplyMat(e){return ji(this,e)}multiplyVec(e){return qi(this,e)}multiply(e){if(e instanceof _t)return this.multiplyMat(e);const{x:r,y:n,z:i}=e;if(r===void 0||n===void 0||i===void 0)throw new Error(`multiply only works with mat3 and vec3, not supported ${e}`);return this.multiplyVec(e)}[Symbol.iterator](){return this[Qe].values()}}Me(_t),Yr(_t);const Lo=[{validator:()=>!0,handler:()=>t=>t.pipe(B(e=>e))}];class K{validator;handler;constructor(e,r){this.validator=e,this.handler=r}}const Eo=(t=[])=>[...t,...Lo],Co=[{validator:()=>!0,handler:()=>t=>t.pipe(B(e=>e))}],Do=(t=[])=>[...t,...Co],sn={[Object.prototype.constructor.name]:t=>e=>e.pipe(B(Object.entries),Ie(t),B(Object.fromEntries)),[Array.prototype.constructor.name]:t=>e=>e.pipe(zi(),Ie(t),Hi()),[Promise.prototype.constructor.name]:t=>e=>e.pipe(Ft(r=>jr(r)),Ie(t)),[J.prototype.constructor.name]:t=>e=>e.pipe(Ft(r=>r),Ie(t)),[void 0]:()=>t=>t};function Ao(t=[]){return e=>e.pipe(Ie(Eo(t)))}function ko(t=[]){return e=>e.pipe(Ie(Do(t)))}function Ie(t){return e=>e.pipe(Ae(r=>{const n=Mo(r),i=n&&sn[n];return i?nt(r).pipe(i(t)):nt(r)}),To(t))}function Mo(t){if(t==null)return;const e=t.constructor;if(e){const r=e.name;if(Object.prototype.hasOwnProperty.call(sn,r))return r}}function To(t){return e=>e.pipe(Ft(r=>nt(r).pipe(Ro(t,r).handler())))}const Ro=(t,e)=>{const r=t.find(({validator:n})=>n(e));return r||{validator:()=>!0,handler:n=>n}};function Oo(t,e,r){let n,i,o;if(e===0)n=i=o=r;else{const s=(l,h,_)=>(_<0&&(_+=1),_>1&&(_-=1),_<.16666666666666666?l+(h-l)*6*_:_<.5?h:_<.6666666666666666?l+(h-l)*(.6666666666666666-_)*6:l),c=r<.5?r*(1+e):r+e-r*e,u=2*r-c;n=s(u,c,t/360+1/3),i=s(u,c,t/360),o=s(u,c,t/360-1/3)}return{r:Math.round(n*255),g:Math.round(i*255),b:Math.round(o*255)}}let A=class W{constructor(e,r=0,n=0,i=255){if(this.g=r,this.b=n,this.a=i,Array.isArray(e))[this.r,this.g,this.b,this.a]=e;else if(typeof e=="string"){const o=W.fromHex(e);this.r=o.r,this.g=o.g,this.b=o.b,this.a=o.a}else typeof e=="object"?(this.r=e.r||0,this.g=e.g||0,this.b=e.b||0,this.a=e.a!==void 0?e.a:255):(this.r=e,this.g=r||0,this.b=n||0,this.a=i===void 0?255:i);this.r=Math.min(Math.max(this.r,0),255),this.g=Math.min(Math.max(this.g,0),255),this.b=Math.min(Math.max(this.b,0),255),this.a=Math.min(Math.max(this.a,0),255)}static TRANSPARENT=new W(0,0,0,0);static TYPE="Color";static fromHex(e){e.length===4&&(e=`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`);const r=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16),o=parseInt(e.slice(7,9),16);return new W(r,n,i,isNaN(o)?255:o)}static fromHsl(e,r,n,i=255){const{r:o,g:s,b:c}=Oo(e,r,n);return new W(o,s,c,i)}static isValidHex(e){return/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(e)}r;toInverted(){return new W(255-this.r,255-this.g,255-this.b,this.a)}toJSON(){return{_type:W.TYPE,r:this.r,g:this.g,b:this.b,a:this.a}}toHex(){return`#${this.toRGBA().map(e=>e.toString(16).padStart(2,"0")).join("")}`}toRGB(){return[this.r,this.g,this.b]}toRGBA(){return[...this.toRGB(),this.a]}toCSSRGB(){return[...this.toRGB()]}toCSSRGBA(){return[...this.toRGB(),this.a/255]}toHsl(){const e=this.r/255,r=this.g/255,n=this.b/255,i=Math.max(e,r,n),o=Math.min(e,r,n);let s=0,c=0;const u=(i+o)/2;if(i===o)s=c=0;else{const l=i-o;switch(c=u>.5?l/(2-i-o):l/(i+o),i){case e:s=(r-n)/l+(r<n?6:0);break;case r:s=(n-e)/l+2;break;case n:s=(e-r)/l+4;break}s/=6}return[Math.round(s*360),c,u]}toHsla(){const[e,r,n]=this.toHsl();return[e,r,n,this.a]}toHsv(){const e=this.r/255,r=this.g/255,n=this.b/255,i=Math.max(e,r,n),o=Math.min(e,r,n);let s=0,c=0;const u=i,l=i-o;if(i!==0)c=l/i;else return[0,0,0];if(i===o)s=0;else{switch(i){case e:s=(r-n)/l+(r<n?6:0);break;case r:s=(n-e)/l+2;break;case n:s=(e-r)/l+4;break}s/=6}return[Math.round(s*360),c,u]}toHsva(){const[e,r,n]=this.toHsv();return[e,r,n,this.a]}getHslaHue(){const[e]=this.toHsl();return e}getHslaSaturation(){const[e]=this.toHsl();return e}getHslaLightness(){const[e]=this.toHsl();return e}setHslaHue(e){const[r,n,i]=this.toHsl();return W.fromHsl(r+e,n,i,this.a)}setHslaSaturation(e){const[r,n,i]=this.toHsl();return W.fromHsl(r,n+e,i,this.a)}setHslaLightness(e){const[r,n,i]=this.toHsl();return W.fromHsl(r,n,i+e,this.a)}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}clone(){return new W(this.r,this.g,this.b,this.a)}};var Q=(t=>(t.TOP_LEFT="top_left",t.TOP_CENTER="top_center",t.TOP_RIGHT="top_right",t.CENTER_LEFT="center_left",t.CENTER="center",t.CENTER_RIGHT="center_right",t.BOTTOM_LEFT="bottom_left",t.BOTTOM_CENTER="bottom_center",t.BOTTOM_RIGHT="bottom_right",t))(Q||{});class Ye{static TYPE="DisplayOptions";origin;position;colors;pixelGrid;grid;zoomLevel;precision;constructor(e){const{origin:r,position:n,colors:i,pixelGrid:o,grid:s,zoomLevel:c}=e||{};this.origin=r||Q.CENTER,this.position=n?d(n.x,n.y):d(0,0),this.colors={background:i?.background?new A(i.background):new A(0,0,0),foreground:i?.foreground?new A(i.foreground):new A(255,255,255)},this.pixelGrid={color:o?.color?new A(o.color):new A(0,0,0,255*.2),lineWidth:o?.lineWidth??1,visibleCount:o?.visibleCount??10},this.grid={active:s?.active??!1,colors:{primary:s?.colors?new A(s.colors.primary):new A(0,221,204,255*.6),secondary:s?.colors?new A(s.colors.secondary):new A(0,221,204,255*.4)},position:s?.position?d(s.position.x,s.position.y):d(0,0),dimension:s?.dimension?d(s.dimension.x,s.dimension.y):d(1,1)},this.zoomLevel=c||1,this.precision=3}toJSON(){return{_type:Ye.TYPE,origin:this.origin,position:this.position.toJSON(),colors:{background:this.colors.background.toJSON(),foreground:this.colors.foreground.toJSON()},pixelGrid:{color:this.pixelGrid.color.toJSON(),lineWidth:this.pixelGrid.lineWidth,visibleCount:this.pixelGrid.visibleCount},grid:{active:this.grid.active,colors:{primary:this.grid.colors.primary.toJSON(),secondary:this.grid.colors.secondary.toJSON()},position:this.grid.position.toJSON(),dimension:this.grid.dimension.toJSON()},zoomLevel:this.zoomLevel,precision:this.precision}}}Q.TOP_LEFT+"",d(-1,-1),Q.TOP_CENTER+"",d(0,-1),Q.TOP_RIGHT+"",d(1,-1),Q.CENTER_LEFT+"",d(-1,0),Q.CENTER+"",d(0,0),Q.CENTER_RIGHT+"",d(1,0),Q.BOTTOM_LEFT+"",d(-1,1),Q.BOTTOM_CENTER+"",d(0,1),Q.BOTTOM_RIGHT+"",d(1,1);class j{static TYPE="PaletteColor";id;color;constructor(e){const{id:r,color:n}=e||{};this.id=r||crypto.randomUUID(),this.color=n?new A(n):new A(0,0,0)}setColor(e){this.color=e}equal(e){return this.id===e?.id}toJSON(){return{_type:j.TYPE,id:this.id,color:this.color.toJSON()}}clone(){return new j({id:this.id,color:this.color.clone()})}}class M{static TYPE="Palette";id;name;description;colors;locked;constructor(e){const{id:r,name:n,description:i,colors:o,locked:s}=e||{};this.id=r||crypto.randomUUID(),this.name=n||"",this.description=i,this.colors=(o||[]).map(c=>new j(c)),this.locked=s}clone(){return new M({id:this.id,name:this.name,description:this.description,colors:this.colors.map(e=>e.clone()),locked:this.locked})}toJSON(){return{_type:M.TYPE,id:this.id,name:this.name,description:this.description,colors:this.colors.map(e=>e.toJSON()),locked:this.locked}}}const zo=[new K(t=>t&&t instanceof Te,()=>t=>t.pipe(B(e=>({__type:"IPoint",...e.toJSON()})))),new K(t=>t&&t instanceof Ye,()=>t=>t.pipe(B(e=>e.toJSON()))),new K(t=>t&&t instanceof A,()=>t=>t.pipe(B(e=>e.toJSON()))),new K(t=>t&&t instanceof j,()=>t=>t.pipe(B(e=>e.toJSON()))),new K(t=>t&&t instanceof M,()=>t=>t.pipe(B(e=>e.toJSON())))],Bo=[new K(t=>typeof t=="object"&&"__type"in t&&t.__type==="IPoint",()=>t=>t.pipe(B(e=>d(e.x,e.y)))),new K(t=>t&&Ye.TYPE===t._type,()=>t=>t.pipe(B(e=>new Ye(e)))),new K(t=>t&&A.TYPE===t._type,()=>t=>t.pipe(B(e=>new A(e)))),new K(t=>t&&j.TYPE===t._type,()=>t=>t.pipe(B(e=>new j(e)))),new K(t=>t&&M.TYPE===t._type,()=>t=>t.pipe(B(e=>new M(e))))];function Fo(){return t=>t.pipe(Ao(zo))}function Io(){return t=>t.pipe(ko(Bo))}const N={fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},an={silent:{level:-1},fatal:{level:N.fatal},error:{level:N.error},warn:{level:N.warn},log:{level:N.log},info:{level:N.info},success:{level:N.success},fail:{level:N.fail},ready:{level:N.info},start:{level:N.info},box:{level:N.info},debug:{level:N.debug},trace:{level:N.trace},verbose:{level:N.verbose}};function Kt(t){if(t===null||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.iterator in t?!1:Symbol.toStringTag in t?Object.prototype.toString.call(t)==="[object Module]":!0}function er(t,e,r=".",n){if(!Kt(e))return er(t,{},r);const i=Object.assign({},e);for(const o in t){if(o==="__proto__"||o==="constructor")continue;const s=t[o];s!=null&&(Array.isArray(s)&&Array.isArray(i[o])?i[o]=[...s,...i[o]]:Kt(s)&&Kt(i[o])?i[o]=er(s,i[o],(r?`${r}.`:"")+o.toString()):i[o]=s)}return i}function Vo(t){return(...e)=>e.reduce((r,n)=>er(r,n,""),{})}const Uo=Vo();function Po(t){return Object.prototype.toString.call(t)==="[object Object]"}function Go(t){return!(!Po(t)||!t.message&&!t.args||t.stack)}let tr=!1;const cn=[];class F{options;_lastLog;_mockFn;constructor(e={}){const r=e.types||an;this.options=Uo({...e,defaults:{...e.defaults},level:rr(e.level,r),reporters:[...e.reporters||[]]},{types:an,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const n in r){const i={type:n,...this.options.defaults,...r[n]};this[n]=this._wrapLogFn(i),this[n].raw=this._wrapLogFn(i,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(e){this.options.level=rr(e,this.options.types,this.options.level)}prompt(e,r){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(e,r)}create(e){const r=new F({...this.options,...e});return this._mockFn&&r.mockTypes(this._mockFn),r}withDefaults(e){return this.create({...this.options,defaults:{...this.options.defaults,...e}})}withTag(e){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+e:e})}addReporter(e){return this.options.reporters.push(e),this}removeReporter(e){if(e){const r=this.options.reporters.indexOf(e);if(r!==-1)return this.options.reporters.splice(r,1)}else this.options.reporters.splice(0);return this}setReporters(e){return this.options.reporters=Array.isArray(e)?e:[e],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const e in this.options.types)console["__"+e]||(console["__"+e]=console[e]),console[e]=this[e].raw}restoreConsole(){for(const e in this.options.types)console["__"+e]&&(console[e]=console["__"+e],delete console["__"+e])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(e,r){e&&(e.__write||(e.__write=e.write),e.write=n=>{this[r].raw(String(n).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(e){e&&e.__write&&(e.write=e.__write,delete e.__write)}pauseLogs(){tr=!0}resumeLogs(){tr=!1;const e=cn.splice(0);for(const r of e)r[0]._logFn(r[1],r[2])}mockTypes(e){const r=e||this.options.mockFn;if(this._mockFn=r,typeof r=="function")for(const n in this.options.types)this[n]=r(n,this.options.types[n])||this[n],this[n].raw=this[n]}_wrapLogFn(e,r){return(...n)=>{if(tr){cn.push([this,e,n,r]);return}return this._logFn(e,n,r)}}_logFn(e,r,n){if((e.level||0)>this.level)return!1;const i={date:new Date,args:[],...e,level:rr(e.level,this.options.types)};!n&&r.length===1&&Go(r[0])?Object.assign(i,r[0]):i.args=[...r],i.message&&(i.args.unshift(i.message),delete i.message),i.additional&&(Array.isArray(i.additional)||(i.additional=i.additional.split(`
`)),i.args.push(`
`+i.additional.join(`
`)),delete i.additional),i.type=typeof i.type=="string"?i.type.toLowerCase():"log",i.tag=typeof i.tag=="string"?i.tag:"";const o=(c=!1)=>{const u=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&u>0){const l=[...this._lastLog.object.args];u>1&&l.push(`(repeated ${u} times)`),this._log({...this._lastLog.object,args:l}),this._lastLog.count=1}c&&(this._lastLog.object=i,this._log(i))};clearTimeout(this._lastLog.timeout);const s=this._lastLog.time&&i.date?i.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=i.date,s<this.options.throttle)try{const c=JSON.stringify([i.type,i.tag,i.args]),u=this._lastLog.serialized===c;if(this._lastLog.serialized=c,u&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin)){this._lastLog.timeout=setTimeout(o,this.options.throttle);return}}catch{}o(!0)}_log(e){for(const r of this.options.reporters)r.log(e,{options:this.options})}}function rr(t,e={},r=3){return t===void 0?r:typeof t=="number"?t:e[t]&&e[t].level!==void 0?e[t].level:r}F.prototype.add=F.prototype.addReporter,F.prototype.remove=F.prototype.removeReporter,F.prototype.clear=F.prototype.removeReporter,F.prototype.withScope=F.prototype.withTag,F.prototype.mock=F.prototype.mockTypes,F.prototype.pause=F.prototype.pauseLogs,F.prototype.resume=F.prototype.resumeLogs;function No(t={}){return new F(t)}class xo{options;defaultColor;levelColorMap;typeColorMap;constructor(e){this.options={...e},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(e){return e<1?console.__error||console.error:e===1?console.__warn||console.warn:console.__log||console.log}log(e){const r=this._getLogFn(e.level),n=e.type==="log"?"":e.type,i=e.tag||"",s=`
      background: ${this.typeColorMap[e.type]||this.levelColorMap[e.level]||this.defaultColor};
      border-radius: 0.5em;
      color: white;
      font-weight: bold;
      padding: 2px 0.5em;
    `,c=`%c${[i,n].filter(Boolean).join(":")}`;typeof e.args[0]=="string"?r(`${c}%c ${e.args[0]}`,s,"",...e.args.slice(1)):r(c,s,...e.args)}}function Ho(t={}){return No({reporters:t.reporters||[new xo({})],prompt(r,n={}){return n.type==="confirm"?Promise.resolve(confirm(r)):Promise.resolve(prompt(r))},...t})}const nr=Ho().withTag("webPaint");nr.withTag("workerManager"),nr.withTag("display");const ln=nr.withTag("worker"),ir=ln.withTag("main");ln.withTag("display");var g=(t=>(t.DEFAULT="default",t.REFRESH="refresh",t.REFRESH_SUCCESS="refreshSuccess",t.DEBUG="debug",t.INIT="init",t.INIT_SUCCESS="initSuccess",t.SYNC_STATE="syncState",t.SYNC_STATE_SUCCESS="syncStateSuccess",t.ADD_RENDER_WORKER_PORT="addRenderWorkerPort",t.ADD_RENDER_WORKER_PORT_SUCCESS="addRenderWorkerPortSuccess",t.LOAD_IMAGE="loadImage",t.LOAD_IMAGE_SUCCESS="loadImageSuccess",t.UPDATE_CANVAS="updateCanvas",t.UPDATE_BUFFER="updateBuffer",t.UPDATE_BUFFER_SUCCESS="updateBufferSuccess",t.STACK="stack",t.STACK_SUCCESS="stackSuccess",t.UNDO_STACK="undoStack",t.UNDO_STACK_SUCCESS="undoStackSuccess",t.REDO_STACK="redoStack",t.REDO_STACK_SUCCESS="redoStackSuccess",t.CLEAR="clear",t.CLEAR_SUCCESS="clearSuccess",t.SET_ZOOM="setZoom",t.SET_ZOOM_SUCCESS="setZoomSuccess",t.ZOOM_FIT="zoomFit",t.ZOOM_FIT_SUCCESS="zoomFitSuccess",t.SET_POSITION="setPosition",t.SET_POSITION_SUCCESS="setPositionSuccess",t.USE_TOOL="useTool",t.USE_TOOL_SUCCESS="useToolSuccess",t.SET_SELECT_OPTIONS="setSelectOptions",t.SET_SELECT_OPTIONS_SUCCESS="setSelectOptionsSuccess",t.GET_DATA="getData",t.GET_DATA_SUCCESS="getDataSuccess",t.RESIZE="resize",t.RESIZE_SUCCESS="resizeSuccess",t.RESIZE_CANVAS="resizeCanvas",t.RESIZE_CANVAS_SUCCESS="resizeCanvasSuccess",t.GET_COLORS="getColors",t.GET_COLORS_SUCCESS="getColorsSuccess",t.IMAGE_OPERATION="imageOperation",t.IMAGE_OPERATION_SUCCESS="imageOperationSuccess",t.COLOR_PICKER="colorPicker",t.COLOR_PICKER_SUCCESS="colorPickerSuccess",t.SET_OPTIONS="setOptions",t.SET_OPTIONS_SUCCESS="setOptionsSuccess",t.INSERT_IMAGE="insertImage",t.INSERT_IMAGE_SUCCESS="insertImageSuccess",t.ROTATE="rotate",t.ROTATE_SUCCESS="rotateSuccess",t.FLIP="flip",t.FLIP_SUCCESS="flipSuccess",t.SELECT_LAYER="selectLayer",t.SELECT_CURRENT_SUCCESS="selectLayerSuccess",t.UPDATE_LAYER="updateLayer",t.UPDATE_LAYER_SUCCESS="updateLayerSuccess",t.ADD_LAYER="addLayer",t.ADD_LAYER_SUCCESS="addLayerSuccess",t.REMOVE_LAYER="removeLayer",t.REMOVE_LAYER_SUCCESS="removeLayerSuccess",t.MOVE_LAYERS="moveLayer",t.MOVE_LAYER_SUCCESS="moveLayerSuccess",t.GET_LAYERS="getLayers",t.GET_LAYERS_SUCCESS="getLayersSuccess",t.LOAD_DOCUMENT="loadDocument",t.LOAD_DOCUMENT_SUCCESS="loadDocumentSuccess",t.DUPLICATE_LAYER="duplicateLayer",t.DUPLICATE_LAYER_SUCCESS="duplicateLayerSuccess",t.MERGE_LAYERS="mergeLayers",t.MERGE_LAYERS_SUCCESS="mergeLayersSuccess",t.SET_LAYERS="setLayers",t.SET_LAYERS_SUCCESS="setLayersSuccess",t))(g||{});function $o(t,e){const r=e.payload;return r.port&&(t.displayWorkerPorts.push(r.port),t.debug&&ir.withTag("action").success("Added zoom worker port. Total ports:",t.displayWorkerPorts.length),t.setupDisplays(),t.update({layers:!0})),{type:g.ADD_RENDER_WORKER_PORT_SUCCESS}}let a,We=null;function or(){return(We===null||We.byteLength===0)&&(We=new Uint8Array(a.memory.buffer)),We}function _e(t,e){return t=t>>>0,or().subarray(t/1,t/1+e)}function un(t){const e=a.__externref_table_alloc();return a.__wbindgen_export_2.set(e,t),e}function jo(t,e){try{return t.apply(this,e)}catch(r){const n=un(r);a.__wbindgen_exn_store(n)}}const hn=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&hn.decode();function sr(t,e){return t=t>>>0,hn.decode(or().subarray(t,t+e))}let L=0;function E(t,e){const r=e(t.length*1,1)>>>0;return or().set(t,r/1),L=t.length,r}const ar=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}};ar.encodeInto;function I(t){const e=a.__wbindgen_export_2.get(t);return a.__externref_table_dealloc(t),e}function fe(t){return t==null}function f(t,e){if(!(t instanceof e))throw new Error(`expected instance of ${e.name}`)}function cr(t,e,r,n){var i=E(t,a.__wbindgen_malloc),o=L;f(e,b);var s=e.__destroy_into_raw();f(r,z);var c=r.__destroy_into_raw();const u=a.drawBrush(i,o,t,s,c,n);if(u[1])throw I(u[0])}function qo(t,e,r,n,i,o,s){var c=E(t,a.__wbindgen_malloc),u=L;f(e,b);var l=e.__destroy_into_raw();f(r,z);var h=r.__destroy_into_raw();f(n,z);var _=n.__destroy_into_raw();f(i,z);var S=i.__destroy_into_raw();f(o,z);var p=o.__destroy_into_raw();let k=0;fe(s)||(f(s,Sn),k=s.__destroy_into_raw());const y=a.drawBezier(c,u,t,l,h,_,S,p,k);if(y[1])throw I(y[0])}function lr(t,e,r,n,i){var o=E(t,a.__wbindgen_malloc),s=L;f(e,b);var c=e.__destroy_into_raw();f(r,z);var u=r.__destroy_into_raw();f(n,z);var l=n.__destroy_into_raw();let h=0;fe(i)||(f(i,x),h=i.__destroy_into_raw());const _=a.drawLine(o,s,t,c,u,l,h);if(_[1])throw I(_[0])}let be=null;function dn(){return(be===null||be.buffer.detached===!0||be.buffer.detached===void 0&&be.buffer!==a.memory.buffer)&&(be=new DataView(a.memory.buffer)),be}function _n(t,e){const r=e(t.length*4,4)>>>0;for(let n=0;n<t.length;n++){const i=un(t[n]);dn().setUint32(r+4*n,i,!0)}return L=t.length,r}function Jo(t,e,r,n){var i=E(t,a.__wbindgen_malloc),o=L;f(e,b);var s=e.__destroy_into_raw();const c=_n(r,a.__wbindgen_malloc),u=L;f(n,An);var l=n.__destroy_into_raw();const h=a.drawPolygon(i,o,t,s,c,u,l);if(h[1])throw I(h[0])}function Zo(t,e,r,n,i){var o=E(t,a.__wbindgen_malloc),s=L;f(e,b);var c=e.__destroy_into_raw();f(r,z);var u=r.__destroy_into_raw();f(n,b);var l=n.__destroy_into_raw();f(i,Mn);var h=i.__destroy_into_raw();const _=a.drawRectangle(o,s,t,c,u,l,h);if(_[1])throw I(_[0])}function Xo(t,e,r,n,i){var o=E(t,a.__wbindgen_malloc),s=L;f(e,b);var c=e.__destroy_into_raw();f(r,z);var u=r.__destroy_into_raw();f(n,b);var l=n.__destroy_into_raw();f(i,En);var h=i.__destroy_into_raw();const _=a.drawEllipse(o,s,t,c,u,l,h);if(_[1])throw I(_[0])}function Qo(t,e,r,n){var i=E(t,a.__wbindgen_malloc),o=L;f(e,b);var s=e.__destroy_into_raw();f(r,z);var c=r.__destroy_into_raw();f(n,oe);var u=n.__destroy_into_raw();const l=a.drawFill(i,o,t,s,c,u);if(l[1])throw I(l[0])}function Yo(t,e,r,n,i,o){var s=E(t,a.__wbindgen_malloc),c=L;f(e,b);var u=e.__destroy_into_raw();f(r,z);var l=r.__destroy_into_raw();f(n,b);var h=n.__destroy_into_raw();f(i,oe);var _=i.__destroy_into_raw();f(o,mn);var S=o.__destroy_into_raw();const p=a.drawAirBrush(s,c,t,u,l,h,_,S);if(p[1])throw I(p[0])}function ur(t,e){var r=E(t,a.__wbindgen_malloc),n=L;f(e,b);var i=e.__destroy_into_raw();a.invert(r,n,t,i)}function Wo(t,e){var r=E(t,a.__wbindgen_malloc),n=L;f(e,b);var i=e.__destroy_into_raw();a.grayScale(r,n,t,i)}function Ko(t,e){var r=E(t,a.__wbindgen_malloc),n=L;f(e,b);var i=e.__destroy_into_raw();a.sepia(r,n,t,i)}function es(t,e,r){var n=E(t,a.__wbindgen_malloc),i=L;f(e,b);var o=e.__destroy_into_raw();a.adjustBrightness(n,i,t,o,r)}function ts(t,e,r){var n=E(t,a.__wbindgen_malloc),i=L;f(e,b);var o=e.__destroy_into_raw();a.adjustContrast(n,i,t,o,r)}function rs(t,e,r){var n=E(t,a.__wbindgen_malloc),i=L;f(e,b);var o=e.__destroy_into_raw();a.adjustSaturation(n,i,t,o,r)}function ns(t,e,r,n){var i=E(t,a.__wbindgen_malloc),o=L;f(e,b);var s=e.__destroy_into_raw();a.sharpen(i,o,t,s,r,n)}function is(t,e,r){var n=E(t,a.__wbindgen_malloc),i=L;f(e,b);var o=e.__destroy_into_raw();a.blur(n,i,t,o,r)}function os(t,e,r){var n=E(t,a.__wbindgen_malloc),i=L;f(e,b);var o=e.__destroy_into_raw();a.emboss(n,i,t,o,r)}function ss(t){return a.__wbindgen_export_2.get(t)}function as(t,e){return t===0?ss(e):sr(t,e)}function fn(t,e,r,n){var i=E(t,a.__wbindgen_malloc),o=L;f(e,b);var s=e.__destroy_into_raw();const c=_n(r,a.__wbindgen_malloc),u=L,l=a.mergeLayers(i,o,t,s,c,u,n);if(l[1])throw I(l[0])}function cs(t,e,r,n,i){f(n,oe);var o=n.__destroy_into_raw();f(i,oe);var s=i.__destroy_into_raw();const c=a.initBrush(t,e,r,o,s);if(c[1])throw I(c[0])}function ls(t,e,r,n,i){f(n,oe);var o=n.__destroy_into_raw();f(i,oe);var s=i.__destroy_into_raw();const c=a.setBrushSolid(t,e,r,o,s);if(c[1])throw I(c[0])}function pn(t,e,r,n){var i=E(t,a.__wbindgen_malloc),o=L;f(e,b);var s=e.__destroy_into_raw();f(r,z);var c=r.__destroy_into_raw();f(n,b);var u=n.__destroy_into_raw();const l=a.getPixels(i,o,t,s,c,u);if(l[3])throw I(l[2]);var h=_e(l[0],l[1]).slice();return a.__wbindgen_free(l[0],l[1]*1,1),h}function gn(t,e,r,n,i,o){var s=E(t,a.__wbindgen_malloc),c=L;f(e,b);var u=e.__destroy_into_raw();f(r,z);var l=r.__destroy_into_raw();const h=E(n,a.__wbindgen_malloc),_=L;f(i,b);var S=i.__destroy_into_raw();const p=a.setPixels(s,c,t,u,l,h,_,S,o);if(p[1])throw I(p[0])}function ft(t,e,r,n){var i=E(t,a.__wbindgen_malloc),o=L;f(e,b);var s=e.__destroy_into_raw();f(r,b);var c=r.__destroy_into_raw();const u=a.resize(i,o,t,s,c,n);if(u[3])throw I(u[2]);var l=_e(u[0],u[1]).slice();return a.__wbindgen_free(u[0],u[1]*1,1),l}function us(t,e,r,n,i){var o=E(t,a.__wbindgen_malloc),s=L;f(e,b);var c=e.__destroy_into_raw();f(r,z);var u=r.__destroy_into_raw();const l=E(n,a.__wbindgen_malloc),h=L;f(i,b);var _=i.__destroy_into_raw();const S=a.insertImage(o,s,t,c,u,l,h,_);if(S[1])throw I(S[0])}function hs(t,e){var r=E(t,a.__wbindgen_malloc),n=L;f(e,b);var i=e.__destroy_into_raw();const o=a.clear(r,n,t,i);if(o[1])throw I(o[0])}function ds(t,e){t=t>>>0;const r=dn(),n=[];for(let i=t;i<t+4*e;i+=4)n.push(a.__wbindgen_export_2.get(r.getUint32(i,!0)));return a.__externref_drop_slice(t,e),n}function _s(t){var e=E(t,a.__wbindgen_malloc),r=L;const n=a.getColors(e,r,t);if(n[3])throw I(n[2]);var i=ds(n[0],n[1]).slice();return a.__wbindgen_free(n[0],n[1]*4,4),i}function fs(t,e,r){var n=E(t,a.__wbindgen_malloc),i=L;f(e,b);var o=e.__destroy_into_raw();const s=a.flip(n,i,t,o,r);var c=_e(s[0],s[1]).slice();return a.__wbindgen_free(s[0],s[1]*1,1),c}function ps(t,e,r){var n=E(t,a.__wbindgen_malloc),i=L;f(e,b);var o=e.__destroy_into_raw();const s=a.rotate(n,i,t,o,r);return yt.__wrap(s)}const q=Object.freeze({Normal:0,0:"Normal",Multiply:1,1:"Multiply",Screen:2,2:"Screen",Overlay:3,3:"Overlay",Darken:4,4:"Darken",Lighten:5,5:"Lighten",ColorDodge:6,6:"ColorDodge",ColorBurn:7,7:"ColorBurn",HardLight:8,8:"HardLight",SoftLight:9,9:"SoftLight",Difference:10,10:"Difference",Exclusion:11,11:"Exclusion"}),O=Object.freeze({Normal:0,0:"Normal",Replace:1,1:"Replace",Multiply:2,2:"Multiply",Screen:3,3:"Screen",Overlay:4,4:"Overlay",SoftLight:5,5:"SoftLight",HardLight:6,6:"HardLight",Difference:7,7:"Difference",Exclusion:8,8:"Exclusion",ColorBurn:9,9:"ColorBurn",LinearBurn:10,10:"LinearBurn",ColorDodge:11,11:"ColorDodge",LinearDodge:12,12:"LinearDodge",VividLight:13,13:"VividLight",LinearLight:14,14:"LinearLight",PinLight:15,15:"PinLight",HardMix:16,16:"HardMix",Substract:17,17:"Substract",Divide:18,18:"Divide"}),yn=Object.freeze({Horizontal:0,0:"Horizontal",Vertical:1,1:"Vertical"}),pt=Object.freeze({NearestNeighbor:0,0:"NearestNeighbor",Bilinear:1,1:"Bilinear",Bicubic:2,2:"Bicubic",Lanczos3:3,3:"Lanczos3"}),hr=Object.freeze({Rotate90Degrees:0,0:"Rotate90Degrees",Rotate180Degrees:1,1:"Rotate180Degrees",Rotate270Degrees:2,2:"Rotate270Degrees"}),dr=Object.freeze({Round:0,0:"Round",Square:1,1:"Square",Dots:2,2:"Dots"}),wn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>a.__wbg_airburshoptions_free(t>>>0,1));class mn{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,wn.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_airburshoptions_free(e,0)}get is_round(){return a.__wbg_get_airburshoptions_is_round(this.__wbg_ptr)!==0}set is_round(e){a.__wbg_set_airburshoptions_is_round(this.__wbg_ptr,e)}get num_dots(){return a.__wbg_get_airburshoptions_num_dots(this.__wbg_ptr)>>>0}set num_dots(e){a.__wbg_set_airburshoptions_num_dots(this.__wbg_ptr,e)}get max_alpha_factor(){return a.__wbg_get_airburshoptions_max_alpha_factor(this.__wbg_ptr)}set max_alpha_factor(e){a.__wbg_set_airburshoptions_max_alpha_factor(this.__wbg_ptr,e)}get seed(){const e=a.__wbg_get_airburshoptions_seed(this.__wbg_ptr);return BigInt.asUintN(64,e)}set seed(e){a.__wbg_set_airburshoptions_seed(this.__wbg_ptr,e)}constructor(e,r,n,i){const o=a.airburshoptions_new(e,r,n,i);return this.__wbg_ptr=o>>>0,wn.register(this,this.__wbg_ptr,this),this}}const bn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>a.__wbg_bezieroptions_free(t>>>0,1));class Sn{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,bn.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_bezieroptions_free(e,0)}get segment_length(){return a.__wbg_get_airburshoptions_max_alpha_factor(this.__wbg_ptr)}set segment_length(e){a.__wbg_set_airburshoptions_max_alpha_factor(this.__wbg_ptr,e)}get gap_length(){return a.__wbg_get_bezieroptions_gap_length(this.__wbg_ptr)}set gap_length(e){a.__wbg_set_bezieroptions_gap_length(this.__wbg_ptr,e)}get interpolate_segments(){return a.__wbg_get_bezieroptions_interpolate_segments(this.__wbg_ptr)!==0}set interpolate_segments(e){a.__wbg_set_bezieroptions_interpolate_segments(this.__wbg_ptr,e)}get seed(){const e=a.__wbg_get_bezieroptions_seed(this.__wbg_ptr);return BigInt.asUintN(64,e)}set seed(e){a.__wbg_set_bezieroptions_seed(this.__wbg_ptr,e)}constructor(e,r,n,i){const o=a.bezieroptions_new(e,r,n,i);return this.__wbg_ptr=o>>>0,bn.register(this,this.__wbg_ptr,this),this}}const vn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>a.__wbg_color_free(t>>>0,1));class oe{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,vn.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_color_free(e,0)}get r(){return a.__wbg_get_color_r(this.__wbg_ptr)}set r(e){a.__wbg_set_color_r(this.__wbg_ptr,e)}get g(){return a.__wbg_get_color_g(this.__wbg_ptr)}set g(e){a.__wbg_set_color_g(this.__wbg_ptr,e)}get b(){return a.__wbg_get_color_b(this.__wbg_ptr)}set b(e){a.__wbg_set_color_b(this.__wbg_ptr,e)}get a(){return a.__wbg_get_color_a(this.__wbg_ptr)}set a(e){a.__wbg_set_color_a(this.__wbg_ptr,e)}constructor(e,r,n,i){const o=a.color_new(e,r,n,i);return this.__wbg_ptr=o>>>0,vn.register(this,this.__wbg_ptr,this),this}equals(e){return f(e,oe),a.color_equals(this.__wbg_ptr,e.__wbg_ptr)!==0}to_data(){const e=a.color_to_data(this.__wbg_ptr);var r=_e(e[0],e[1]).slice();return a.__wbindgen_free(e[0],e[1]*1,1),r}to_hex(){const e=a.color_to_hex(this.__wbg_ptr);var r=as(e[0],e[1]);return e[0]!==0&&a.__wbindgen_free(e[0],e[1],1),r}}const _r=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>a.__wbg_dimension_free(t>>>0,1));class b{static __wrap(e){e=e>>>0;const r=Object.create(b.prototype);return r.__wbg_ptr=e,_r.register(r,r.__wbg_ptr,r),r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,_r.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_dimension_free(e,0)}get x(){return a.__wbg_get_dimension_x(this.__wbg_ptr)>>>0}set x(e){a.__wbg_set_dimension_x(this.__wbg_ptr,e)}get y(){return a.__wbg_get_dimension_y(this.__wbg_ptr)>>>0}set y(e){a.__wbg_set_dimension_y(this.__wbg_ptr,e)}constructor(e,r){const n=a.dimension_new(e,r);return this.__wbg_ptr=n>>>0,_r.register(this,this.__wbg_ptr,this),this}to_viewport_dimension(){const e=a.dimension_to_viewport_dimension(this.__wbg_ptr);return gt.__wrap(e)}}const Ln=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>a.__wbg_ellipseoptions_free(t>>>0,1));class En{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ln.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_ellipseoptions_free(e,0)}get style(){return a.__wbg_get_ellipseoptions_style(this.__wbg_ptr)}set style(e){a.__wbg_set_ellipseoptions_style(this.__wbg_ptr,e)}get line_options(){const e=a.__wbg_get_ellipseoptions_line_options(this.__wbg_ptr);return e===0?void 0:x.__wrap(e)}set line_options(e){let r=0;fe(e)||(f(e,x),r=e.__destroy_into_raw()),a.__wbg_set_ellipseoptions_line_options(this.__wbg_ptr,r)}get interpolate_segments(){return a.__wbg_get_ellipseoptions_interpolate_segments(this.__wbg_ptr)!==0}set interpolate_segments(e){a.__wbg_set_ellipseoptions_interpolate_segments(this.__wbg_ptr,e)}get seed(){const e=a.__wbg_get_ellipseoptions_seed(this.__wbg_ptr);return BigInt.asUintN(64,e)}set seed(e){a.__wbg_set_ellipseoptions_seed(this.__wbg_ptr,e)}constructor(e,r,n,i){let o=0;fe(r)||(f(r,x),o=r.__destroy_into_raw());const s=a.ellipseoptions_new(e,o,n,i);return this.__wbg_ptr=s>>>0,Ln.register(this,this.__wbg_ptr,this),this}}const fr=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>a.__wbg_lineoptions_free(t>>>0,1));class x{static __wrap(e){e=e>>>0;const r=Object.create(x.prototype);return r.__wbg_ptr=e,fr.register(r,r.__wbg_ptr,r),r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,fr.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_lineoptions_free(e,0)}get segment_length(){return a.__wbg_get_lineoptions_segment_length(this.__wbg_ptr)>>>0}set segment_length(e){a.__wbg_set_lineoptions_segment_length(this.__wbg_ptr,e)}get gap_length(){return a.__wbg_get_lineoptions_gap_length(this.__wbg_ptr)>>>0}set gap_length(e){a.__wbg_set_lineoptions_gap_length(this.__wbg_ptr,e)}get seed(){const e=a.__wbg_get_lineoptions_seed(this.__wbg_ptr);return BigInt.asUintN(64,e)}set seed(e){a.__wbg_set_lineoptions_seed(this.__wbg_ptr,e)}constructor(e,r,n){const i=a.lineoptions_new(e,r,n);return this.__wbg_ptr=i>>>0,fr.register(this,this.__wbg_ptr,this),this}}const Cn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>a.__wbg_point_free(t>>>0,1));class z{static __unwrap(e){return e instanceof z?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Cn.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_point_free(e,0)}get x(){return a.__wbg_get_dimension_x(this.__wbg_ptr)>>>0}set x(e){a.__wbg_set_dimension_x(this.__wbg_ptr,e)}get y(){return a.__wbg_get_dimension_y(this.__wbg_ptr)>>>0}set y(e){a.__wbg_set_dimension_y(this.__wbg_ptr,e)}constructor(e,r){const n=a.dimension_new(e,r);return this.__wbg_ptr=n>>>0,Cn.register(this,this.__wbg_ptr,this),this}to_render_point(){const e=a.dimension_to_viewport_dimension(this.__wbg_ptr);return yr.__wrap(e)}}const Dn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>a.__wbg_polygonoptions_free(t>>>0,1));class An{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Dn.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_polygonoptions_free(e,0)}get style(){return a.__wbg_get_polygonoptions_style(this.__wbg_ptr)}set style(e){a.__wbg_set_polygonoptions_style(this.__wbg_ptr,e)}get line_options(){const e=a.__wbg_get_ellipseoptions_line_options(this.__wbg_ptr);return e===0?void 0:x.__wrap(e)}set line_options(e){let r=0;fe(e)||(f(e,x),r=e.__destroy_into_raw()),a.__wbg_set_ellipseoptions_line_options(this.__wbg_ptr,r)}get seed(){const e=a.__wbg_get_ellipseoptions_seed(this.__wbg_ptr);return BigInt.asUintN(64,e)}set seed(e){a.__wbg_set_ellipseoptions_seed(this.__wbg_ptr,e)}constructor(e,r,n){let i=0;fe(r)||(f(r,x),i=r.__destroy_into_raw());const o=a.polygonoptions_new(e,i,n);return this.__wbg_ptr=o>>>0,Dn.register(this,this.__wbg_ptr,this),this}}const kn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>a.__wbg_rectangleoptions_free(t>>>0,1));class Mn{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,kn.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_rectangleoptions_free(e,0)}get style(){return a.__wbg_get_polygonoptions_style(this.__wbg_ptr)}set style(e){a.__wbg_set_polygonoptions_style(this.__wbg_ptr,e)}get line_options(){const e=a.__wbg_get_ellipseoptions_line_options(this.__wbg_ptr);return e===0?void 0:x.__wrap(e)}set line_options(e){let r=0;fe(e)||(f(e,x),r=e.__destroy_into_raw()),a.__wbg_set_ellipseoptions_line_options(this.__wbg_ptr,r)}get stroke_align(){return a.__wbg_get_ellipseoptions_style(this.__wbg_ptr)}set stroke_align(e){a.__wbg_set_ellipseoptions_style(this.__wbg_ptr,e)}get seed(){const e=a.__wbg_get_ellipseoptions_seed(this.__wbg_ptr);return BigInt.asUintN(64,e)}set seed(e){a.__wbg_set_ellipseoptions_seed(this.__wbg_ptr,e)}constructor(e,r,n,i){let o=0;fe(n)||(f(n,x),o=n.__destroy_into_raw());const s=a.rectangleoptions_new(e,r,o,i);return this.__wbg_ptr=s>>>0,kn.register(this,this.__wbg_ptr,this),this}}const pr=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>a.__wbg_renderdimension_free(t>>>0,1));class gt{static __wrap(e){e=e>>>0;const r=Object.create(gt.prototype);return r.__wbg_ptr=e,pr.register(r,r.__wbg_ptr,r),r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,pr.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_renderdimension_free(e,0)}get x(){return a.__wbg_get_renderdimension_x(this.__wbg_ptr)}set x(e){a.__wbg_set_dimension_x(this.__wbg_ptr,e)}get y(){return a.__wbg_get_renderdimension_y(this.__wbg_ptr)}set y(e){a.__wbg_set_dimension_y(this.__wbg_ptr,e)}constructor(e,r){const n=a.dimension_new(e,r);return this.__wbg_ptr=n>>>0,pr.register(this,this.__wbg_ptr,this),this}abs(){const e=a.renderdimension_abs(this.__wbg_ptr);return gt.__wrap(e)}}const gr=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>a.__wbg_renderposition_free(t>>>0,1));class yr{static __wrap(e){e=e>>>0;const r=Object.create(yr.prototype);return r.__wbg_ptr=e,gr.register(r,r.__wbg_ptr,r),r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,gr.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_renderposition_free(e,0)}get x(){return a.__wbg_get_renderdimension_x(this.__wbg_ptr)}set x(e){a.__wbg_set_dimension_x(this.__wbg_ptr,e)}get y(){return a.__wbg_get_renderdimension_y(this.__wbg_ptr)}set y(e){a.__wbg_set_dimension_y(this.__wbg_ptr,e)}constructor(e,r){const n=a.dimension_new(e,r);return this.__wbg_ptr=n>>>0,gr.register(this,this.__wbg_ptr,this),this}}const Tn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>a.__wbg_rotatedescription_free(t>>>0,1));class yt{static __wrap(e){e=e>>>0;const r=Object.create(yt.prototype);return r.__wbg_ptr=e,Tn.register(r,r.__wbg_ptr,r),r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Tn.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_rotatedescription_free(e,0)}get dimension(){const e=a.__wbg_get_rotatedescription_dimension(this.__wbg_ptr);return b.__wrap(e)}set dimension(e){f(e,b);var r=e.__destroy_into_raw();a.__wbg_set_rotatedescription_dimension(this.__wbg_ptr,r)}static new(e,r){f(e,b);var n=e.__destroy_into_raw();const i=E(r,a.__wbindgen_malloc),o=L,s=a.rotatedescription_new(n,i,o);return yt.__wrap(s)}get data(){const e=a.rotatedescription_data(this.__wbg_ptr);var r=_e(e[0],e[1]).slice();return a.__wbindgen_free(e[0],e[1]*1,1),r}}const Rn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>a.__wbg_wasmlayer_free(t>>>0,1));class Ke{static __unwrap(e){return e instanceof Ke?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Rn.unregister(this),e}free(){const e=this.__destroy_into_raw();a.__wbg_wasmlayer_free(e,0)}get blend_mode(){return a.__wbg_get_wasmlayer_blend_mode(this.__wbg_ptr)}set blend_mode(e){a.__wbg_set_wasmlayer_blend_mode(this.__wbg_ptr,e)}get opacity(){return a.__wbg_get_wasmlayer_opacity(this.__wbg_ptr)}set opacity(e){a.__wbg_set_wasmlayer_opacity(this.__wbg_ptr,e)}constructor(e,r,n){const i=E(e,a.__wbindgen_malloc),o=L,s=a.wasmlayer_new(i,o,r,n);return this.__wbg_ptr=s>>>0,Rn.register(this,this.__wbg_ptr,this),this}get data(){const e=a.wasmlayer_data(this.__wbg_ptr);var r=_e(e[0],e[1]).slice();return a.__wbindgen_free(e[0],e[1]*1,1),r}}async function gs(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(n){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const r=await t.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{const r=await WebAssembly.instantiate(t,e);return r instanceof WebAssembly.Instance?{instance:r,module:t}:r}}function ys(){const t={};return t.wbg={},t.wbg.__wbg_buffer_609cc3eee51ed158=function(e){return e.buffer},t.wbg.__wbg_getRandomValues_3c9c0d586e575a16=function(){return jo(function(e,r){globalThis.crypto.getRandomValues(_e(e,r))},arguments)},t.wbg.__wbg_log_c222819a41e063d3=function(e){console.log(e)},t.wbg.__wbg_new_a12002a7f91c75be=function(e){return new Uint8Array(e)},t.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(e,r,n){return new Uint8Array(e,r>>>0,n>>>0)},t.wbg.__wbg_point_unwrap=function(e){return z.__unwrap(e)},t.wbg.__wbg_wasmlayer_unwrap=function(e){return Ke.__unwrap(e)},t.wbg.__wbindgen_copy_to_typed_array=function(e,r,n){new Uint8Array(n.buffer,n.byteOffset,n.byteLength).set(_e(e,r))},t.wbg.__wbindgen_init_externref_table=function(){const e=a.__wbindgen_export_2,r=e.grow(4);e.set(0,void 0),e.set(r+0,void 0),e.set(r+1,null),e.set(r+2,!0),e.set(r+3,!1)},t.wbg.__wbindgen_memory=function(){return a.memory},t.wbg.__wbindgen_string_new=function(e,r){return sr(e,r)},t.wbg.__wbindgen_throw=function(e,r){throw new Error(sr(e,r))},t}function ws(t,e){return a=t.exports,On.__wbindgen_wasm_module=e,be=null,We=null,a.__wbindgen_start(),a}async function On(t){if(a!==void 0)return a;typeof t<"u"&&(Object.getPrototypeOf(t)===Object.prototype?{module_or_path:t}=t:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof t>"u"&&(t=new URL(""+new URL("wasm_bg-m6L8X2HL.wasm",self.location.href).href,self.location.href));const e=ys();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:r,module:n}=await gs(await t,e);return ws(r,n)}var D=(t=>(t.NORMAL="normal",t.MULTIPLY="multiply",t.SCREEN="screen",t.OVERLAY="overlay",t.DARKEN="darken",t.LIGHTEN="lighten",t.COLOR_DODGE="colorDodge",t.COLOR_BURN="colorBurn",t.HARD_LIGHT="hardLight",t.SOFT_LIGHT="softLight",t.DIFFERENCE="difference",t.EXCLUSION="exclusion",t))(D||{}),w=(t=>(t.NORMAL="normal",t.REPLACE="replace",t.MULTIPLY="multiply",t.SCREEN="screen",t.OVERLAY="overlay",t.SOFT_LIGHT="soft_light",t.HARD_LIGHT="hard_light",t.DIFFERENCE="difference",t.EXCLUSION="exclusion",t.COLOR_BURN="color_burn",t.LINEAR_BURN="linear_burn",t.COLOR_DODGE="color_dodge",t.LINEAR_DODGE="linear_dodge",t.VIVID_LIGHT="vivid_light",t.LINEAR_LIGHT="linear_light",t.PIN_LIGHT="pin_light",t.HARD_MIX="hard_mix",t.SUBSTRACT="substract",t.DIVIDE="divide",t))(w||{}),H=(t=>(t.FILLED="filled",t.STROKED="stroked",t.STROKED_FILLED="stroked_filled",t))(H||{}),Y=(t=>(t.CIRCLE="circle",t.SQUARE="square",t.DOTS="dots",t))(Y||{}),v=(t=>(t.NONE="none",t.DOTTED_FREEHAND="dotted_freehand",t.CONTINUOUS_FREEHAND="continuous_freehand",t.STRAIGHT_LINE="straight_line",t.CURVE_LINE="curve_line",t.FILL_TOOL="fill_tool",t.AIR_BRUSH="airbrush",t.RECTANGLE="rectangle",t.CIRCLE="circle",t.ELLIPSE="ellipse",t.POLYGON="polygon",t.CROP="crop",t.TEXT="text",t.GRID="grid",t.SPLIT_SCREEN="splitScreen",t.MAGNIFY="magnify",t.ZOOM="zoom",t.STACK_REDO="stack_redo",t.STACK_UNDO="stack_undo",t.CLEAR="clear",t.ZOOM_FIT="zoom_fit",t.COLOR_PICKER="color_picker",t.IMAGE_OPERATION="image_operation",t.ERASER="eraser",t))(v||{});class wr{promise;resolve=()=>{};reject=()=>{};state;constructor(){this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r,this.state=0}).then(e=>(this.state=1,e)).catch(e=>{throw this.state=2,new Error(e)})}static create(){return new wr}}var wt=(t=>(t.START="START",t.MOVE="MOVE",t.STOP="STOP",t))(wt||{}),mt=(t=>(t[t.CENTER=0]="CENTER",t[t.INSIDE=1]="INSIDE",t[t.OUTSIDE=2]="OUTSIDE",t))(mt||{});function ms(t,e,r){switch(r.state){case wt.START:t.layerManager.currentLayer.createTmpView();break;case wt.STOP:t.layerManager.currentLayer.removeTmpView(),zn(t,e,r);break;case wt.MOVE:t.layerManager.currentLayer.tmpView&&zn(t,e,r,t.layerManager.currentLayer.tmpView);break}}function zn(t,e,r,n){const i=t.useOptions.tool.shapeStyle||H.STROKED,o=t.brushDescription.getScaledSize(!0),s=t.getTargetDimension(r.dimension,e),c=d(()=>Math.min(s,0)),u=d(()=>Math.sign(c)),l=d(()=>-o*u);let h=t.getTargetPosition(r.position,e);i!==H.FILLED&&(h=d(()=>Math.round(h+l))),n&&t.layerManager.currentLayer.view.set(n),h=d(()=>Math.round(h+c)),Zo(t.layerManager.currentLayer.view,m(t.getDimension()),R(h),m(d(()=>Math.abs(s))),Cs({style:i,strokeAlign:2,fillColor:t.useOptions.color.secondaryColor.color,segmentLength:t.useOptions.tool.segmentLength||0,gapLength:t.useOptions.tool.gapLength||0,seed:e.seed}))}var Ve=(t=>(t[t.ROTATE_90_DEGRESS=0]="ROTATE_90_DEGRESS",t[t.ROTATE_180_DEGRESS=1]="ROTATE_180_DEGRESS",t[t.ROTATE_270_DEGRESS=2]="ROTATE_270_DEGRESS",t))(Ve||{}),mr=(t=>(t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t))(mr||{}),se=(t=>(t.NEAREST_NEIGHBOR="nearestNeighbor",t.BILINEAR="bilinear",t.BICUBIC="bicubic",t.LANCZOS="lanczos",t))(se||{}),ee=(t=>(t.GRAYSCALE="grayscale",t.INVERT="invert",t.SEPIA="sepia",t.BRIGHTNESS="brightness",t.CONTRAST="contrast",t.SATURATION="saturation",t.SHARPEN="sharpen",t.BLUR="blur",t.EMBOSS="emboss",t.ROTATE="rotate",t.FLIP="flip",t.EDGE_DETECT="edge_detect",t.THRESHOLD="threshold",t.COLORIZE="colorize",t.CUSTOM="custom",t))(ee||{});function R(t){return new z(t.x,t.y)}function m(t){return new b(t.x,t.y)}function Ue(t){return new oe(t.r,t.g,t.b,t.a)}function Pe(t){return new x(t.segmentLength||1,t.gapLength||0,BigInt(t.seed??0))}function bs(t){return new Sn(t.segmentLength||1,t.gapLength||0,t.interpolateSegments??!1,BigInt(t.seed??0))}function Ss(t){return new mn(t.round??!0,t.strength??100,t.weight??1,BigInt(t.seed??0))}function br(t){switch(t){case H.FILLED:return 0;case H.STROKED:return 1;case H.STROKED_FILLED:return 2;default:throw new Error(`Unknown shape style: ${t}`)}}function vs(t){switch(t){case mt.INSIDE:return 0;case mt.CENTER:return 1;case mt.OUTSIDE:return 2;default:throw new Error(`Unknown stroke align: ${t}`)}}function Ls(t){switch(t){case Ve.ROTATE_90_DEGRESS:return hr.Rotate90Degrees;case Ve.ROTATE_180_DEGRESS:return hr.Rotate180Degrees;case Ve.ROTATE_270_DEGRESS:return hr.Rotate270Degrees;default:throw new Error(`Unknown rotate type: ${t}`)}}function Es(t){switch(t){case mr.HORIZONTAL:return yn.Horizontal;case mr.VERTICAL:return yn.Vertical;default:throw new Error(`Unknown flip type: ${t}`)}}function Bn(t){switch(t){case D.NORMAL:return q.Normal;case D.MULTIPLY:return q.Multiply;case D.SCREEN:return q.Screen;case D.OVERLAY:return q.Overlay;case D.DARKEN:return q.Darken;case D.LIGHTEN:return q.Lighten;case D.COLOR_DODGE:return q.ColorDodge;case D.COLOR_BURN:return q.ColorBurn;case D.HARD_LIGHT:return q.HardLight;case D.SOFT_LIGHT:return q.SoftLight;case D.DIFFERENCE:return q.Difference;case D.EXCLUSION:return q.Exclusion;default:throw new Error(`Unknown blend mode: ${t}`)}}function bt(t){switch(t){case w.NORMAL:return O.Normal;case w.REPLACE:return O.Replace;case w.MULTIPLY:return O.Multiply;case w.SCREEN:return O.Screen;case w.OVERLAY:return O.Overlay;case w.SOFT_LIGHT:return O.SoftLight;case w.HARD_LIGHT:return O.HardLight;case w.DIFFERENCE:return O.Difference;case w.EXCLUSION:return O.Exclusion;case w.COLOR_BURN:return O.ColorBurn;case w.LINEAR_BURN:return O.LinearBurn;case w.COLOR_DODGE:return O.ColorDodge;case w.LINEAR_DODGE:return O.LinearDodge;case w.VIVID_LIGHT:return O.VividLight;case w.LINEAR_LIGHT:return O.LinearLight;case w.PIN_LIGHT:return O.PinLight;case w.HARD_MIX:return O.HardMix;case w.SUBSTRACT:return O.Substract;case w.DIVIDE:return O.Divide;default:throw new Error(`Unknown brush mode: ${t}`)}}function Cs(t){return new Mn(br(t.style),vs(t.strokeAlign),Pe({segmentLength:t.segmentLength,gapLength:t.gapLength,seed:t.seed}),BigInt(t.seed??0))}function Ds(t){return new En(br(t.style),Pe({segmentLength:t.segmentLength,gapLength:t.gapLength}),t.interpolateSegments??!1,BigInt(t.seed??0))}function As(t){return new An(br(t.style),Pe({segmentLength:t.segmentLength,gapLength:t.gapLength,seed:t.seed}),BigInt(t.seed??0))}let St;async function ks(){return St||(St=new wr,On().then(()=>St?.resolve())),St.promise}async function Ms(t,e){return t.debug=e.payload.debug,await ks(),t.updateClient(),{type:g.INIT_SUCCESS}}async function Ts(t,e){const{imageBitmap:r}=e.payload,n=r.width,i=r.height,o=n*i*4,s=new SharedArrayBuffer(o);return await Rs(r,s,n,i),r.close(),t.setSharedBuffer(s,d(n,i)),t.setupDisplays(),t.update({layers:!0}),{type:g.LOAD_IMAGE_SUCCESS}}async function Rs(t,e,r,n){const o=new OffscreenCanvas(r,n).getContext("2d");o.drawImage(t,0,0,r,n);const s=o.getImageData(0,0,r,n);new Uint8ClampedArray(e).set(s.data)}class Fn{layerManager;order;locked;id=crypto.randomUUID();name;opacity;visible;blendMode;buffer;tmpBuffer;view;lastView;tmpView;constructor(e){const r=e.buffer||new SharedArrayBuffer(e.dimension.x*e.dimension.y*4),n=e.dimension;this.order=e.order??0,this.locked=e.locked??!1,this.id=e.id??this.id,this.name=e.name??"Layer",this.opacity=e.opacity??1,this.visible=e.visible??!0,this.blendMode=e.blendMode??D.NORMAL,this.tmpBuffer={...this.buffer},this.buffer={buffer:r,dimension:n},this.tmpBuffer={buffer:r.slice(0),dimension:n},this.view=new Uint8Array(this.buffer.buffer),this.lastView=this.view.slice(0)}get dimension(){return this.buffer.dimension}refreshTmpBuffer(){this.tmpBuffer={buffer:this.buffer.buffer.slice(0),dimension:this.buffer.dimension}}setSharedBuffer(e,r){this.buffer={buffer:e,dimension:r},this.tmpBuffer={buffer:e.slice(0),dimension:r},this.view=new Uint8Array(e),this.lastView=this.view.slice(0),this.tmpView=void 0}setView(e){e instanceof Uint8Array&&(this.view?.set(e),this.tmpView?.set(e))}createTmpView(){if(!this.tmpView)if(this.buffer)this.lastView=this.view?.slice(0),this.tmpView=new Uint8Array(this.buffer.buffer.slice(0));else throw new Error("Shared buffer is not set.");return this.tmpView}updateTmpView(){this.view&&this.tmpView?.set(this.view)}removeTmpView(){this.tmpView&&this.view&&this.lastView&&this.view?.set(this.lastView),this.tmpView=void 0}toJSON(){return{id:this.id,name:this.name,order:this.order,opacity:this.opacity,visible:this.visible,blendMode:this.blendMode}}}async function Os(t,e){const{layers:r}=e.payload,n=await Promise.all(r.map(async i=>{const o=i.imageBitmap,s=o.width,c=o.height,u=s*c*4,l=new SharedArrayBuffer(u);return await zs(o,l,s,c),o.close(),new Fn({...i,dimension:d(s,c),buffer:l})}));return t.layerManager.setLayers(n),t.setupDisplays(),t.update({client:!0,layers:!0}),{type:g.LOAD_IMAGE_SUCCESS}}async function zs(t,e,r,n){const o=new OffscreenCanvas(r,n).getContext("2d");o.drawImage(t,0,0,r,n);const s=o.getImageData(0,0,r,n);new Uint8ClampedArray(e).set(s.data)}async function Bs(t,e){return await t.setSelectOptions(e.payload),{type:g.SET_SELECT_OPTIONS_SUCCESS}}var Se=(t=>(t.DRAW="DRAW",t.RESET="RESET",t.MOVE="MOVE",t))(Se||{});function Fs(t,e,r){const n=t.layerManager.currentLayer,i=t.getTargetPosition(e.position,e);switch(r.state){case Se.DRAW:n.removeTmpView(),In(t,e,r,void 0,!1,!0);break;case Se.MOVE:t.isIntersect(i)?(n.createTmpView(),In(t,e,r,n.tmpView,!0,!0)):n.removeTmpView();break;case Se.RESET:n.removeTmpView();break}}function In(t,e,r,n,i=!1,o=!1){const s=t.layerManager.currentLayer.view;n&&s.set(n);let c=t.getTargetPosition(e.position,e);c=d(()=>Math.round(c-t.useOptions.brush.size/2));const u=t.getDimension();let l=t.getTargetPosition(r.lastPosition,{...e});l=d(()=>Math.round(l-t.useOptions.brush.size/2)),(o||!c.equals(l))&&(i?cr(s,m(u),R(c),BigInt(e.seed??0)):lr(s,m(u),R(l),R(c),Pe({segmentLength:t.useOptions.tool.segmentLength,gapLength:t.useOptions.tool.gapLength,seed:e.seed})))}function Is(t,e,r){const n=t.layerManager.currentLayer,i=t.getTargetPosition(e.position,e);switch(r.state){case Se.DRAW:n.removeTmpView(),Vn(t,e,r,{force:!0,hover:!1},t.layerManager.currentLayer.tmpView);break;case Se.MOVE:t.isIntersect(i)?(n.createTmpView(),Vn(t,e,r,{force:!0,hover:!0},t.layerManager.currentLayer.tmpView)):n.removeTmpView();break;case Se.RESET:n.removeTmpView();break}}function Vn(t,e,r,{force:n,hover:i},o){o&&t.layerManager.currentLayer.view.set(o);let s=t.getTargetPosition(e.position,e);s=d(()=>Math.round(s-t.useOptions.brush.size/2));const c=t.getDimension();t.getTargetPosition(r.lastPosition,{...e}),i?cr(t.layerManager.currentLayer.view,m(c),R(s),BigInt(e.seed??0)):Sr<1?(Sr=r.gap??2,cr(t.layerManager.currentLayer.view,m(c),R(s),BigInt(e.seed??0))):Sr--}let Sr=0;var te=(t=>(t.START="start",t.MOVE="move",t.STOP="stop",t))(te||{});function Vs(t,e,r){switch(r.state){case te.START:t.layerManager.currentLayer.createTmpView();break;case te.STOP:t.layerManager.currentLayer.removeTmpView(),Un(t,e,r);break;case te.MOVE:t.layerManager.currentLayer.tmpView&&Un(t,e,r,t.layerManager.currentLayer.tmpView);break}}function Un(t,e,r,n){const{position:i}=e;if(r.anchorPositions&&r.anchorPositions.length>1){const[o,s]=r.anchorPositions,c=t.brushDescription.getSize(),u=d(-c/2,-c/2);let l=t.getTargetPosition(o,e);l=d(()=>Math.round(l+u));let h=t.getTargetPosition(s||i,e);h=d(()=>Math.round(h+u)),n&&t.layerManager.currentLayer.view.set(n),lr(t.layerManager.currentLayer.view,m(t.getDimension()),R(l),R(h),Pe({segmentLength:t.useOptions.tool.segmentLength||1,gapLength:t.useOptions.tool.gapLength||0,seed:e.seed}))}}function Us(t,e,r){switch(r.state){case te.START:t.layerManager.currentLayer.createTmpView();break;case te.STOP:t.layerManager.currentLayer.removeTmpView(),Pn(t,e,r);break;case te.MOVE:t.layerManager.currentLayer.tmpView&&Pn(t,e,r,t.layerManager.currentLayer.tmpView);break}}function Pn(t,e,r,n){const{position:i}=e;if(r.anchorPositions&&r.anchorPositions.length>1){const[o,s,c,u]=r.anchorPositions;if(r.anchorPositions.length>1){n&&t.layerManager.currentLayer.view?.set(n);const l=t.brushDescription.getSize(),h=d(-l/2,-l/2);let _=t.getTargetPosition(o,e);_=d(()=>Math.round(_+h));let S=t.getTargetPosition(s||i,e);S=d(()=>Math.round(S+h));let p=t.getTargetPosition(c,e);p=d(()=>Math.round(p+h));let k=t.getTargetPosition(u,e);k=d(()=>Math.round(k+h)),r.anchorPositions.length>2?qo(t.layerManager.currentLayer.view,m(t.getDimension()),R(_),R(p),R(S),R(k),bs({segmentLength:t.useOptions.tool.segmentLength||1,gapLength:t.useOptions.tool.gapLength||0,interpolateSegments:t.useOptions.tool.interpolateSegments||!1,seed:e.seed})):lr(t.layerManager.currentLayer.view,m(t.getDimension()),R(_),R(S),Pe({segmentLength:t.useOptions.tool.segmentLength||1,gapLength:t.useOptions.tool.gapLength||0,seed:e.seed}))}}}function Ps(t,e,r){const n=t.getTargetPosition(e.position,e),i=t.brushDescription?.getSize()||1,o=d(i,i);Yo(t.layerManager.currentLayer.view,m(t.getDimension()),R(d(n.x,n.y)),m(o),Ue(t.brushDescription.primaryColor),Ss({round:r.round,strength:t.useOptions.tool.airBrushStrength||100,weight:t.useOptions.tool.airBrushWeight||100,seed:e.seed})),t.layerManager.currentLayer.updateTmpView()}var vt=(t=>(t.START="START",t.MOVE="MOVE",t.STOP="STOP",t))(vt||{});function Gn(t,e,r){switch(r.state){case vt.START:t.layerManager.currentLayer.createTmpView();break;case vt.STOP:t.layerManager.currentLayer.removeTmpView(),Nn(t,e,r);break;case vt.MOVE:t.layerManager.currentLayer.tmpView&&Nn(t,e,r,t.layerManager.currentLayer.tmpView);break}}function Nn(t,e,r,n){const i=t.useOptions.tool.shapeStyle||H.STROKED,o=t.brushDescription.getScaledSize(!0),s=t.getTargetDimension(r.dimension,e),c=d(()=>Math.min(s,0)),u=d(()=>Math.sign(c)),l=d(()=>-o*u);let h=t.getTargetPosition(r.position,e);i!==H.FILLED&&(h=d(()=>Math.round(h+l))),h=d(()=>Math.round(h+c));const _=d(()=>Math.abs(s));!_.x||!_.y||(n&&t.layerManager.currentLayer.view.set(n),Xo(t.layerManager.currentLayer.view,m(t.getDimension()),R(h),m(_),Ds({style:i,fillColor:t.brushDescription.secondaryColor,segmentLength:t.useOptions.tool.segmentLength||0,gapLength:t.useOptions.tool.gapLength||0,interpolateSegments:t.useOptions.tool.interpolateSegments,seed:e.seed})))}function Gs(t,e,r){switch(r.state){case te.START:t.layerManager.currentLayer.createTmpView();break;case te.STOP:t.layerManager.currentLayer.removeTmpView(),xn(t,e,r);break;case te.MOVE:t.layerManager.currentLayer.tmpView&&xn(t,e,r,t.layerManager.currentLayer.tmpView);break}}function xn(t,e,r,n){if(r.anchorPositions&&r.anchorPositions.length>1){const i=d(0,0),o=s=>{const c=t.getTargetPosition(s,e);return d(()=>Math.round(c+i))};n&&t.layerManager.currentLayer.view.set(n),Jo(t.layerManager.currentLayer.view,m(t.getDimension()),r.anchorPositions.map(o).map(R),As({style:t.useOptions.tool.shapeStyle||H.STROKED,segmentLength:t.useOptions.tool.segmentLength||0,gapLength:t.useOptions.tool.gapLength||0,seed:e.seed}))}}var et=(t=>(t.START="START",t.MOVE="MOVE",t.STOP="STOP",t.ABORT="ABORT",t))(et||{});let ae;function Ns(t,e,r){switch(r.state){case et.START:{const{position:n,dimension:i}=r,o=d(()=>Math.min(i,0)),s=d(()=>n+o),c=Math.abs(i.x),u=Math.abs(i.y),l=t.getTargetDimension(d(c,u),e);ae=pn(t.layerManager.currentLayer.view,m(t.getDimension()),R(t.getTargetPosition(s,e)),m(l)),ur(ae,m(l)),r.cut&&gn(t.layerManager.currentLayer.view,m(t.getDimension()),R(t.getTargetPosition(s,e)),new Uint8Array(Array(ae.length/4).fill([0,0,0,0]).flat()),m(l),bt(w.REPLACE)),t.layerManager.currentLayer.createTmpView()}break;case et.STOP:{const n=Math.abs(r.dimension.x),i=Math.abs(r.dimension.y),o=t.getTargetDimension(d(n,i),e);ur(ae,m(o)),t.layerManager.currentLayer.removeTmpView(),Hn(t,e,r,ae),ae=void 0}break;case et.ABORT:t.layerManager.currentLayer.removeTmpView(),ae=void 0;break;case et.MOVE:ae&&Hn(t,e,r,ae,t.layerManager.currentLayer.tmpView);break}}function Hn(t,e,r,n,i){i&&t.layerManager.currentLayer.view&&t.layerManager.currentLayer.view.set(i);const o=d(()=>Math.abs(r.dimension)),s=d(()=>Math.min(r.dimension,0)),c=d(()=>r.position+s),u=t.getTargetPosition(c,e,{round:!0});gn(t.layerManager.currentLayer.view,m(t.getDimension()),R(d(()=>Math.round(u))),n,m(t.getTargetDimension(o,e)),bt(w.NORMAL))}function xs(t){hs(t.layerManager.currentLayer.view,m(t.getDimension())),t.layerManager.currentLayer.updateTmpView()}function Hs(t,e,r){const n=t.getTargetPosition(e.position,e),i=t.getDimension();t.layerManager.currentLayer.removeTmpView(),Qo(t.layerManager.currentLayer.view,m(i),R(n),Ue(t.brushDescription.primaryColor))}function $s(t,e){const r=t.getTargetPosition(e.position,e);return{type:g.COLOR_PICKER_SUCCESS,payload:{position:r,color:t.isIntersect(r)?t.getColorAtPosition(r):void 0}}}function js(t,e){const r=m(t.getDimension());switch(e.type){case ee.GRAYSCALE:Wo(t.layerManager.currentLayer.view,r);break;case ee.INVERT:ur(t.layerManager.currentLayer.view,r);break;case ee.SEPIA:Ko(t.layerManager.currentLayer.view,r);break;case ee.BRIGHTNESS:es(t.layerManager.currentLayer.view,r,e.value/100);break;case ee.CONTRAST:ts(t.layerManager.currentLayer.view,r,e.value/100);break;case ee.SATURATION:rs(t.layerManager.currentLayer.view,r,e.value/100);break;case ee.SHARPEN:{const{radius:n,threshold:i}=e;ns(t.layerManager.currentLayer.view,r,n,i)}break;case ee.BLUR:is(t.layerManager.currentLayer.view,r,e.value);break;case ee.EMBOSS:os(t.layerManager.currentLayer.view,r,e.value/100);break}t.layerManager.currentLayer.updateTmpView()}async function qs(t,e){const{payload:r}=e,{tool:n,meta:i,toolOptions:o}=r;r.toolOptions.stackable&&t.actionStack.active&&t.addActionStack(n,r);const s=await Lt(t,{tool:n,meta:i,toolOptions:o});return t.update(),s||{type:g.USE_TOOL_SUCCESS}}function Lt(t,{tool:e,meta:r,toolOptions:n}){switch(e){case v.CLEAR:xs(t);break;case v.DOTTED_FREEHAND:Is(t,r,n);break;case v.CONTINUOUS_FREEHAND:Fs(t,r,n);break;case v.STRAIGHT_LINE:Vs(t,r,n);break;case v.CURVE_LINE:Us(t,r,n);break;case v.AIR_BRUSH:Ps(t,r,n);break;case v.RECTANGLE:ms(t,r,n);break;case v.CIRCLE:Gn(t,r,n);break;case v.ELLIPSE:Gn(t,r,n);break;case v.POLYGON:Gs(t,r,n);break;case v.FILL_TOOL:Hs(t,r);break;case v.CROP:Ns(t,r,n);break;case v.IMAGE_OPERATION:js(t,n);break;case v.COLOR_PICKER:return $s(t,r);default:console.warn(`Tool ${e} is not implemented or not supported in this context.`)}}var Ge=(t=>(t.START="start",t.STOP="stop",t.ABORT="abort",t.FORWARD="forward",t.BACKWARD="backward",t))(Ge||{});async function Js(t,e){switch(e.payload.action){case Ge.START:t.actionStack.start();break;case Ge.STOP:t.actionStack.stop();break;case Ge.ABORT:t.actionStack.abort();break;case Ge.FORWARD:await t.actionStack.forward();break;case Ge.BACKWARD:await t.actionStack.backward()}return{type:g.STACK_SUCCESS}}async function Zs(t,e){return[{type:g.GET_DATA_SUCCESS,payload:{dimension:t.getDimension(),buffer:new Uint8ClampedArray(t.layerManager.getTotalView())}},[]]}async function Xs(t,e){const{payload:r}=e;return t.layerManager.layers.forEach(n=>{const i=new SharedArrayBuffer(r.dimension.x*r.dimension.y*4);new Uint8Array(i).set($n(n.view,n.buffer.dimension,r.dimension,r.type),0),n.setSharedBuffer(i,r.dimension)}),t.setupDisplays(),t.update({layers:!0}),[{type:g.RESIZE_CANVAS_SUCCESS,payload:{dimension:t.getDimension()}},[]]}const Qs={[se.NEAREST_NEIGHBOR]:(t,e,r)=>ft(t,m(e),m(r),pt.NearestNeighbor),[se.BILINEAR]:(t,e,r)=>ft(t,m(e),m(r),pt.Bilinear),[se.LANCZOS]:(t,e,r)=>ft(t,m(e),m(r),pt.Lanczos3),[se.BICUBIC]:(t,e,r)=>ft(t,m(e),m(r),pt.Bicubic)};function $n(t,e,r,n){return Qs[n](new Uint8Array(t),e,r)}var V=(t=>(t.LEFT_TOP="left_top",t.TOP="top",t.RIGHT_TOP="right_top",t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.LEFT_BOTTOM="left_bottom",t.BOTTOM="bottom",t.RIGHT_BOTTOM="right_bottom",t))(V||{});async function Ys(t,e){const{payload:r}=e,n=t.getDimension(),i=$n(r.buffer,r.bufferDimension,r.dimension,r.type);let o;switch(r.origin){case V.LEFT_TOP:o=d(0,0);break;case V.TOP:o=d((n.x-r.dimension.x)/2,0);break;case V.RIGHT_TOP:o=d(n.x-r.dimension.x,0);break;case V.LEFT:o=d(0,(n.y-r.dimension.y)/2);break;case V.RIGHT:o=d(n.x-r.dimension.x,(n.y-r.dimension.y)/2);break;case V.LEFT_BOTTOM:o=d(0,n.y-r.dimension.y);break;case V.BOTTOM:o=d((n.x-r.dimension.x)/2,n.y-r.dimension.y);break;case V.RIGHT_BOTTOM:o=d(n.x-r.dimension.x,n.y-r.dimension.y);break;default:o=d((n.x-r.dimension.x)/2,(n.y-r.dimension.y)/2)}return us(t.layerManager.currentLayer.view,m(n),R(d(()=>o+r.position)),new Uint8Array(i),m(r.dimension)),t.layerManager.currentLayer.updateTmpView(),t.setupDisplays(),t.update({layers:!0}),[{type:g.INSERT_IMAGE_SUCCESS},[]]}async function Ws(t,e){const{payload:r}=e;return t.layerManager.layers.forEach(n=>{const i=new SharedArrayBuffer(r.dimension.x*r.dimension.y*4);new Uint8ClampedArray(i).set(Ks(n.view,n.buffer.dimension,r.dimension,r.origin),0),n.setSharedBuffer(i,r.dimension)}),t.setupDisplays(),t.update({layers:!0}),[{type:g.RESIZE_CANVAS_SUCCESS,payload:{dimension:t.getDimension()}},[]]}function Ks(t,e,r,n){const i=new Uint8ClampedArray(r.x*r.y*4);let o=Xe(0,0);[V.RIGHT,V.RIGHT_TOP,V.RIGHT_BOTTOM].includes(n)&&(o.x=r.x-e.x),[V.BOTTOM,V.LEFT_BOTTOM,V.RIGHT_BOTTOM].includes(n)&&(o.y=r.y-e.y),[V.CENTER].includes(n)&&(o=Xe(()=>(r-e)/2));const s=Xe(()=>Math.floor(o)),c=Xe(()=>Math.min(s,0)),u=Xe(()=>Math.max(s,0)),l=Math.min(t.length/(e.x*4),r.y);for(let h=0;h<l;h++){const _=h*e.x*4+Math.abs(c.y)*e.x*4,S=new Uint8ClampedArray(r.x*4);console.log("y",JSON.stringify({y_:_,offsetN:c,offsetP:u,offset:o,x:[_,_+Math.min(e.x,r.x)*4]},null,2)),S.set(t.subarray(_+Math.abs(c.x*4),_+Math.min(e.x,r.x)*4+Math.abs(c.x*4)),u.x*4),i.set(S,h*r.x*4+u.y*r.x*4)}return i}async function ea(t,e){const r=t.layerManager.currentLayer.view,n=_s(r);return[{type:g.GET_DATA_SUCCESS,payload:{colors:Array.from(n).map(i=>A.fromHex(i))}},[]]}async function ta(t,e){const{payload:r}=e,n=t.getDimension(),i=fs(t.layerManager.currentLayer.view,m(n),Es(r.type));return t.layerManager.currentLayer.view.set(i),t.setupDisplays(),t.update({layers:!0}),[{type:g.FLIP_SUCCESS},[]]}async function ra(t,e){const{payload:r}=e,n=t.getDimension();let i=t.getDimension();switch(r.type){case Ve.ROTATE_90_DEGRESS:i=d(n.y,n.x);break;case Ve.ROTATE_270_DEGRESS:i=d(n.y,n.x);break}const{dimension:o,data:s}=ps(t.layerManager.currentLayer.view,m(n),Ls(r.type)),c=new SharedArrayBuffer(o.x*o.y*4);return new Uint8Array(c).set(s),t.setSharedBuffer(c,i),t.setupDisplays(),t.update({layers:!0}),[{type:g.ROTATE_SUCCESS,payload:{dimension:t.getDimension()}},[]]}async function na(t,e){return await t.layerManager.selectLayer(e.payload.id),await t.update({client:!0,layers:!0}),{type:g.SELECT_CURRENT_SUCCESS}}async function ia(t,e){const r=t.layerManager.addLayer();return await t.layerManager.selectLayer(r.id),await t.update({client:!0}),{type:g.ADD_LAYER_SUCCESS}}async function oa(t,e){return t.layerManager.removeLayer(e.payload.id),await t.update({client:!0,layers:!0}),{type:g.ADD_LAYER_SUCCESS}}async function sa(t,e){const r=t.layerManager.layers.map(n=>{const{dimension:i,buffer:o}=n.buffer;return{...n.toJSON(),buffer:new Uint8ClampedArray(o),dimension:i}});return await t.update({client:!0}),[{type:g.GET_LAYERS,payload:{layers:r}},[]]}async function aa(t,e){const r=e.payload.data,n=t.layerManager.getLayerById(r.id);return n.blendMode=r.blendMode,n.name=r.name,n.opacity=r.opacity,n.visible=r.visible,await t.update({client:!0,layers:!0}),{type:g.DUPLICATE_LAYER_SUCCESS}}async function ca(t,e){const r=new Map(e.payload.layers.map(n=>[n.id,n]));return t.layerManager.layers.forEach(n=>{const i=r.get(n.id);i&&(n.order=i.order)}),t.layerManager.layers.sort((n,i)=>n.order-i.order),await t.update({client:!0,layers:!0}),[{type:g.MOVE_LAYER_SUCCESS},[]]}async function la(t,e){const r=t.layerManager.layerMap.get(e.payload.id);if(!r)return;const n=t.layerManager.addLayer({name:`${r.name} (copy)`,buffer:r.buffer.buffer,dimension:r.dimension});return t.layerManager.selectLayer(n.id),await t.update({client:!0}),{type:g.DUPLICATE_LAYER_SUCCESS}}async function ua(t,e){return await ha(t,e.payload.ids),await t.update({client:!0}),{type:g.DUPLICATE_LAYER_SUCCESS}}function ha(t,e){const r=e.map(i=>t.layerManager.layerMap.get(i)).filter(Boolean);if(r.length<2)throw new Error("At least two layers are required to merge");const n=t.layerManager.addLayer({name:`Merged Layer (${e.join(", ")})`,dimension:r[0].dimension});fn(n.view,m(n.dimension),r.map(i=>new Ke(i.view,Bn(i.blendMode),i.opacity)),!0),t.layerManager.selectLayer(n.id),e.forEach(i=>t.layerManager.removeLayer(i))}async function da(t,e){const{type:r}=e,n=ir.withTag("Incoming").withTag("action");switch(t.debug&&n.withTag(r).start(e),r){case g.INIT:return Ms(t,e);case g.ADD_RENDER_WORKER_PORT:return $o(t,e);case g.SET_SELECT_OPTIONS:return Bs(t,e);case g.USE_TOOL:return qs(t,e);case g.LOAD_IMAGE:return Ts(t,e);case g.LOAD_DOCUMENT:return Os(t,e);case g.STACK:return Js(t,e);case g.GET_DATA:return Zs(t);case g.INSERT_IMAGE:return Ys(t,e);case g.RESIZE:return Xs(t,e);case g.RESIZE_CANVAS:return Ws(t,e);case g.GET_COLORS:return ea(t);case g.FLIP:return ta(t,e);case g.ROTATE:return ra(t,e);case g.SELECT_LAYER:return na(t,e);case g.ADD_LAYER:return ia(t);case g.REMOVE_LAYER:return oa(t,e);case g.GET_LAYERS:return sa(t);case g.UPDATE_LAYER:return aa(t,e);case g.MOVE_LAYERS:return ca(t,e);case g.DUPLICATE_LAYER:return la(t,e);case g.MERGE_LAYERS:return ua(t,e);default:t.debug&&n.warn("Unknown message type from Creator Thread:",r)}}var _a=new M({locked:!0,id:"aap64-palette",name:"AAP-64",description:"A large, versatile palette with 64 colors that provides a wide range of tones for almost any type of scene or object. Ideal if you want a richer and more detailed color scheme without being overwhelmed.",colors:[{id:"aap64-c0",name:"Darkest Grey",color:"#161320"},{id:"aap64-c1",name:"Dark Grey",color:"#2a2139"},{id:"aap64-c2",name:"Medium Dark Grey",color:"#473b4f"},{id:"aap64-c3",name:"Medium Grey",color:"#63586f"},{id:"aap64-c4",name:"Light Grey",color:"#817b96"},{id:"aap64-c5",name:"Pale Grey",color:"#a8a8bb"},{id:"aap64-c6",name:"White",color:"#d0d2dd"},{id:"aap64-c7",name:"Bright White",color:"#f8f7f9"},{id:"aap64-c8",name:"Deep Red",color:"#330000"},{id:"aap64-c9",name:"Dark Red",color:"#680000"},{id:"aap64-c10",name:"Red",color:"#a20000"},{id:"aap64-c11",name:"Bright Red",color:"#d70000"},{id:"aap64-c12",name:"Light Red",color:"#ff3838"},{id:"aap64-c13",name:"Pink",color:"#ff7575"},{id:"aap64-c14",name:"Pale Pink",color:"#ffb2b2"},{id:"aap64-c15",name:"Lightest Pink",color:"#ffecec"},{id:"aap64-c16",name:"Dark Brown",color:"#3f1a00"},{id:"aap64-c17",name:"Brown",color:"#7e3300"},{id:"aap64-c18",name:"Orange Brown",color:"#bb4e00"},{id:"aap64-c19",name:"Dark Orange",color:"#ed6900"},{id:"aap64-c20",name:"Orange",color:"#ff9e3b"},{id:"aap64-c21",name:"Bright Orange",color:"#ffba78"},{id:"aap64-c22",name:"Light Orange",color:"#ffd7b5"},{id:"aap64-c23",name:"Pale Orange",color:"#ffefe6"},{id:"aap64-c24",name:"Dark Yellow",color:"#3f3000"},{id:"aap64-c25",name:"Yellow Brown",color:"#7e6000"},{id:"aap64-c26",name:"Mustard Yellow",color:"#bbaa00"},{id:"aap64-c27",name:"Bright Yellow",color:"#edde00"},{id:"aap64-c28",name:"Yellow",color:"#fff04d"},{id:"aap64-c29",name:"Light Yellow",color:"#fff68b"},{id:"aap64-c30",name:"Pale Yellow",color:"#fffcc8"},{id:"aap64-c31",name:"Lightest Yellow",color:"#fffee0"},{id:"aap64-c32",name:"Dark Green Blue",color:"#002a20"},{id:"aap64-c33",name:"Green Blue",color:"#005540"},{id:"aap64-c34",name:"Teal",color:"#008060"},{id:"aap64-c35",name:"Bright Teal",color:"#00aa80"},{id:"aap64-c36",name:"Cyan",color:"#00ffc0"},{id:"aap64-c37",name:"Light Cyan",color:"#4dffdb"},{id:"aap64-c38",name:"Pale Cyan",color:"#80ffe6"},{id:"aap64-c39",name:"Lightest Cyan",color:"#e6fff4"},{id:"aap64-c40",name:"Dark Blue Green",color:"#001a2f"},{id:"aap64-c41",name:"Blue Green",color:"#00335f"},{id:"aap64-c42",name:"Medium Blue Green",color:"#004d8e"},{id:"aap64-c43",name:"Bright Blue Green",color:"#0066bd"},{id:"aap64-c44",name:"Blue",color:"#0088ff"},{id:"aap64-c45",name:"Light Blue",color:"#4daaff"},{id:"aap64-c46",name:"Pale Blue",color:"#80ccff"},{id:"aap64-c47",name:"Lightest Blue",color:"#e6f4ff"},{id:"aap64-c48",name:"Dark Violet",color:"#0a0026"},{id:"aap64-c49",name:"Violet",color:"#14004c"},{id:"aap64-c50",name:"Medium Violet",color:"#230075"},{id:"aap64-c51",name:"Bright Violet",color:"#330099"},{id:"aap64-c52",name:"Purple",color:"#5e00ff"},{id:"aap64-c53",name:"Light Purple",color:"#8f4dff"},{id:"aap64-c54",name:"Pale Purple",color:"#bf80ff"},{id:"aap64-c55",name:"Lightest Purple",color:"#f2e6ff"},{id:"aap64-c56",name:"Dark Magenta",color:"#260026"},{id:"aap64-c57",name:"Magenta",color:"#4c004c"},{id:"aap64-c58",name:"Medium Magenta",color:"#750075"},{id:"aap64-c59",name:"Bright Magenta",color:"#990099"},{id:"aap64-c60",name:"Fuchsia",color:"#ff00ff"},{id:"aap64-c61",name:"Light Fuchsia",color:"#ff4dff"},{id:"aap64-c62",name:"Pale Fuchsia",color:"#ff80ff"},{id:"aap64-c63",name:"Lightest Fuchsia",color:"#ffe6ff"}]}),fa=new M({locked:!0,name:"Apple II High-Res Palette",description:"The characteristic colors of the Apple II High-Resolution graphics mode.",colors:[{id:"apple2-0",color:"#000000"},{id:"apple2-1",color:"#FFFFFF"},{id:"apple2-2",color:"#00FF00"},{id:"apple2-3",color:"#FF00FF"},{id:"apple2-4",color:"#FFA500"},{id:"apple2-5",color:"#0000FF"}]}),pa=new M({locked:!0,id:"arne-16",name:"Arne16",description:"Another well-known 16-color palette by Arne Niklas Jansson (Skeddles), often with a slightly cooler color scheme than DB16, but also very versatile and balanced for various pixel art projects.",colors:[{id:"arne16-c0",name:"Deep Blue",color:"#1a1c2c"},{id:"arne16-c1",name:"Dark Purple",color:"#43283c"},{id:"arne16-c2",name:"Dark Green",color:"#4a444a"},{id:"arne16-c3",name:"Dark Cyan",color:"#633c58"},{id:"arne16-c4",name:"Dark Brown",color:"#76425a"},{id:"arne16-c5",name:"Forest Green",color:"#945c56"},{id:"arne16-c6",name:"Gray Blue",color:"#bc4a4a"},{id:"arne16-c7",name:"Light Brown",color:"#de7b72"},{id:"arne16-c8",name:"Orange Red",color:"#efb28e"},{id:"arne16-c9",name:"Pale Yellow",color:"#fecf65"},{id:"arne16-c10",name:"Bright Yellow",color:"#fff79c"},{id:"arne16-c11",name:"Light Green",color:"#227772"},{id:"arne16-c12",name:"Medium Green",color:"#28a773"},{id:"arne16-c13",name:"Teal",color:"#54d3ed"},{id:"arne16-c14",name:"Sky Blue",color:"#80f0c0"},{id:"arne16-c15",name:"White",color:"#b8f7ed"}]}),ga=new M({locked:!0,id:"bob-ross-palette",name:"Bob Ross Inspired",description:"A color palette inspired by the typical colors Bob Ross used in his 'The Joy of Painting' shows. Ideal for serene nature landscapes with mountains, trees, and water.",colors:[{id:"br-c0",name:"Midnight Black (Alizarin Crimson/Prussian Blue-like)",color:"#140c1c"},{id:"br-c1",name:"Dark Umber (Dark Sienna/Van Dyke Brown-like)",color:"#2a1e1b"},{id:"br-c2",name:"Forest Green (Dark Phthalo Green-like)",color:"#1f3a2c"},{id:"br-c3",name:"Mountain Blue (Prussian Blue-like)",color:"#2c2a3f"},{id:"br-c4",name:"Deep Red (Alizarin Crimson-like)",color:"#5b1e2c"},{id:"br-c5",name:"Warm Brown (Burnt Umber-like)",color:"#6d372c"},{id:"br-c6",name:"Moss Green (Sap Green-like)",color:"#4a6d38"},{id:"br-c7",name:"Sky Blue (Phthalo Blue-like)",color:"#4b6c8d"},{id:"br-c8",name:"Bright Red (Cadmium Red Light-like)",color:"#9b3c4f"},{id:"br-c9",name:"Golden Yellow (Cadmium Yellow-like)",color:"#e0a656"},{id:"br-c10",name:"Bright Green (Bright Sap Green-like)",color:"#76c04f"},{id:"br-c11",name:"Soft Blue (Light Phthalo Blue-like)",color:"#81a2cc"},{id:"br-c12",name:"Cream (Titanium White with a hint of color)",color:"#d6cec2"},{id:"br-c13",name:"Off-White (Liquid White-like)",color:"#f0f0e8"},{id:"br-c14",name:"Cloud Grey (Grey Mix-like)",color:"#b0b0b0"},{id:"br-c15",name:"Pure White (Titanium White-like)",color:"#ffffff"}]}),ya=new M({locked:!0,id:"bubblegum-16",name:"Bubblegum 16",description:"A vibrant and cheerful 16-color palette, well-suited for bright, friendly, or 'cute' aesthetics. Ideal for characters, UI elements, or colorful environments.",colors:[{id:"bubblegum-c0",name:"Dark Purple",color:"#2e203c"},{id:"bubblegum-c1",name:"Dark Blue",color:"#4b3064"},{id:"bubblegum-c2",name:"Medium Blue",color:"#6d5494"},{id:"bubblegum-c3",name:"Light Blue",color:"#8a7ba7"},{id:"bubblegum-c4",name:"Dark Pink",color:"#a75276"},{id:"bubblegum-c5",name:"Pink",color:"#d284ae"},{id:"bubblegum-c6",name:"Pale Pink",color:"#ffadd8"},{id:"bubblegum-c7",name:"Light Yellow",color:"#fffefb"},{id:"bubblegum-c8",name:"Dark Green",color:"#366e44"},{id:"bubblegum-c9",name:"Green",color:"#5cb064"},{id:"bubblegum-c10",name:"Lime Green",color:"#94d682"},{id:"bubblegum-c11",name:"Yellow Green",color:"#d2f7ae"},{id:"bubblegum-c12",name:"Orange",color:"#de7061"},{id:"bubblegum-c13",name:"Red Orange",color:"#ff9e7f"},{id:"bubblegum-c14",name:"Light Orange",color:"#ffbe9c"},{id:"bubblegum-c15",name:"Cream",color:"#ffe8c6"}]}),wa=new M({locked:!0,name:"Commodore 64 (C64) Palette",description:"The characteristic 16 colors of the C64, generated by the VIC-II chip.",colors:[{id:"c64-0",color:"#000000"},{id:"c64-1",color:"#FFFFFF"},{id:"c64-2",color:"#68372B"},{id:"c64-3",color:"#70A4B2"},{id:"c64-4",color:"#6F3D86"},{id:"c64-5",color:"#588D43"},{id:"c64-6",color:"#352879"},{id:"c64-7",color:"#B8C76F"},{id:"c64-8",color:"#6F4F25"},{id:"c64-9",color:"#433900"},{id:"c64-10",color:"#9A6759"},{id:"c64-11",color:"#444444"},{id:"c64-12",color:"#6F6F6F"},{id:"c64-13",color:"#9AD284"},{id:"c64-14",color:"#6565EB"},{id:"c64-15",color:"#787878"}]}),ma=new M({locked:!0,name:"CGA 0 (High Intensity)",description:"The most well-known 4-color palette of the IBM PC Color Graphics Adapter.",colors:[{id:"cga-p0-0",color:"#000000"},{id:"cga-p0-1",color:"#00AA00"},{id:"cga-p0-2",color:"#AA0000"},{id:"cga-p0-3",color:"#AA5500"}]}),ba=new M({locked:!0,name:"CGA 1 (High Intensity)",description:"Another iconic 4-color palette of the CGA, often responsible for the cyan-magenta look.",colors:[{id:"cga-p1-0",color:"#000000"},{id:"cga-p1-1",color:"#00AAAA"},{id:"cga-p1-2",color:"#AA00AA"},{id:"cga-p1-3",color:"#AAAAAA"}]}),Sa=new M({locked:!0,id:"cga-palette",name:"CGA Palette (Mode 4 High Intensity)",description:"A historical 16-color palette inspired by the IBM CGA graphics standard. Known for its bright, sometimes unsaturated colors and distinctive retro computer look. Challenging but very characteristic.",colors:[{id:"cga-c0",name:"Black",color:"#000000"},{id:"cga-c1",name:"Dark Blue",color:"#0000aa"},{id:"cga-c2",name:"Dark Green",color:"#00aa00"},{id:"cga-c3",name:"Dark Cyan",color:"#00aaaa"},{id:"cga-c4",name:"Dark Red",color:"#aa0000"},{id:"cga-c5",name:"Dark Magenta",color:"#aa00aa"},{id:"cga-c6",name:"Brown",color:"#aa5500"},{id:"cga-c7",name:"Light Gray",color:"#aaaaaa"},{id:"cga-c8",name:"Dark Gray",color:"#555555"},{id:"cga-c9",name:"Blue",color:"#5555ff"},{id:"cga-c10",name:"Green",color:"#55ff55"},{id:"cga-c11",name:"Cyan",color:"#55ffff"},{id:"cga-c12",name:"Red",color:"#ff5555"},{id:"cga-c13",name:"Magenta",color:"#ff55ff"},{id:"cga-c14",name:"Yellow",color:"#ffff55"},{id:"cga-c15",name:"White",color:"#ffffff"}]}),va=new M({locked:!0,id:"db16-palette",name:"Dawnbringer 16 (DB16)",description:"A versatile and balanced palette by Arne Niklas Jansson, ideal for various moods and scenarios. Known for its earthy and muted tones.",colors:[{id:"db16-c0",name:"Dark Plum",color:"#140c1c"},{id:"db16-c1",name:"Dark Blue",color:"#442434"},{id:"db16-c2",name:"Dark Green",color:"#30346d"},{id:"db16-c3",name:"Brown",color:"#4e4a68"},{id:"db16-c4",name:"Dark Red",color:"#69512c"},{id:"db16-c5",name:"Dark Orange",color:"#636357"},{id:"db16-c6",name:"Gray Blue",color:"#6f6451"},{id:"db16-c7",name:"Light Brown",color:"#76864d"},{id:"db16-c8",name:"Red Orange",color:"#816d56"},{id:"db16-c9",name:"Light Green",color:"#7b707c"},{id:"db16-c10",name:"Light Blue",color:"#80a254"},{id:"db16-c11",name:"Sand",color:"#a8b97d"},{id:"db16-c12",name:"Light Yellow",color:"#a2d28f"},{id:"db16-c13",name:"Pale Yellow",color:"#c6f5d0"},{id:"db16-c14",name:"Sky Blue",color:"#e0f6ee"},{id:"db16-c15",name:"White",color:"#f8f8f8"}]}),La=new M({locked:!0,id:"edg20-palette",name:"EDG20",description:"An Endesga-created 20-color palette. It offers a good selection of rich colors with various ramps for lights and shadows, ideal for more detailed scenes and illustrations.",colors:[{id:"edg20-c0",name:"Dark Grey",color:"#181425"},{id:"edg20-c1",name:"Deep Violet",color:"#241d3b"},{id:"edg20-c2",name:"Dark Violet",color:"#382552"},{id:"edg20-c3",name:"Medium Violet",color:"#5b3164"},{id:"edg20-c4",name:"Bright Violet",color:"#81396f"},{id:"edg20-c5",name:"Dark Blue",color:"#114c62"},{id:"edg20-c6",name:"Medium Blue",color:"#316f7c"},{id:"edg20-c7",name:"Light Blue",color:"#5e9a93"},{id:"edg20-c8",name:"Cyan",color:"#85c596"},{id:"edg20-c9",name:"Light Green",color:"#a8eb9b"},{id:"edg20-c10",name:"Dark Green",color:"#2c726f"},{id:"edg20-c11",name:"Olive Green",color:"#58916d"},{id:"edg20-c12",name:"Yellow Green",color:"#90c57c"},{id:"edg20-c13",name:"Dark Brown",color:"#4a2a4f"},{id:"edg20-c14",name:"Brown",color:"#793c66"},{id:"edg20-c15",name:"Light Brown",color:"#ae4f6b"},{id:"edg20-c16",name:"Dark Red",color:"#dd6e6c"},{id:"edg20-c17",name:"Red",color:"#ff9a8a"},{id:"edg20-c18",name:"Orange",color:"#ffca9a"},{id:"edg20-c19",name:"White",color:"#fff5ea"}]}),Ea=new M({locked:!0,id:"gameboy-palette",name:"Game Boy (Original)",description:"The iconic 4-color palette of the classic Game Boy. Perfect for an authentic retro monochrome look with greenish tones.",colors:[{id:"gb-c0",name:"Darkest Green",color:"#0f380f"},{id:"gb-c1",name:"Dark Green",color:"#306230"},{id:"gb-c2",name:"Light Green",color:"#8bed81"},{id:"gb-c3",name:"Pale Green",color:"#9bbc0f"}]}),Ca=new M({locked:!0,id:"lospec500-palette",name:"LoSpec500",description:"A compact 5-color palette created by LoSpec. Perfect for a very limited, highly stylized look, ideal for small icons, simple sprites, or monochrome game concepts.",colors:[{id:"lospec500-c0",name:"Dark Grey",color:"#242424"},{id:"lospec500-c1",name:"Medium Grey",color:"#5b5b5b"},{id:"lospec500-c2",name:"Light Grey",color:"#939393"},{id:"lospec500-c3",name:"Lighter Grey",color:"#c4c4c4"},{id:"lospec500-c4",name:"White",color:"#fcfcfc"}]}),Da=new M({locked:!0,name:"NES",description:"A selection of the fixed colors from the Nintendo Entertainment System.",colors:[{id:"nes-0",color:"#6F6F6F"},{id:"nes-1",color:"#000080"},{id:"nes-2",color:"#20008E"},{id:"nes-3",color:"#400078"},{id:"nes-4",color:"#800000"},{id:"nes-5",color:"#A00000"},{id:"nes-6",color:"#881400"},{id:"nes-7",color:"#604000"},{id:"nes-8",color:"#206000"},{id:"nes-9",color:"#007400"},{id:"nes-10",color:"#006C20"},{id:"nes-11",color:"#006464"},{id:"nes-12",color:"#004080"},{id:"nes-13",color:"#000000"},{id:"nes-14",color:"#000000"},{id:"nes-15",color:"#000000"}]}),Aa=new M({locked:!0,id:"pico8-palette",name:"PICO-8",description:"The classic 16-color palette of the PICO-8 Fantasy Console. Known for its vibrant and slightly 'retro' Lo-Fi look, ideal for stylized games.",colors:[{id:"pico8-c0",name:"Black",color:"#000000"},{id:"pico8-c1",name:"Dark Blue",color:"#1d2b53"},{id:"pico8-c2",name:"Dark Purple",color:"#7e2553"},{id:"pico8-c3",name:"Dark Green",color:"#008751"},{id:"pico8-c4",name:"Brown",color:"#ab5236"},{id:"pico8-c5",name:"Dark Gray",color:"#5f574f"},{id:"pico8-c6",name:"Light Gray",color:"#c2c3c7"},{id:"pico8-c7",name:"White",color:"#fff1e8"},{id:"pico8-c8",name:"Red",color:"#ff004d"},{id:"pico8-c9",name:"Orange",color:"#ffa300"},{id:"pico8-c10",name:"Yellow",color:"#ffec27"},{id:"pico8-c11",name:"Green",color:"#00e436"},{id:"pico8-c12",name:"Blue",color:"#29adff"},{id:"pico8-c13",name:"Indigo",color:"#83769c"},{id:"pico8-c14",name:"Pink",color:"#ff77a8"},{id:"pico8-c15",name:"Peach",color:"#ffccaa"}]});function ka(){const t=[],e=[[0,0,0],[128,0,0],[0,128,0],[128,128,0],[0,0,128],[128,0,128],[0,128,128],[192,192,192],[128,128,128],[255,0,0],[0,255,0],[255,255,0],[0,0,255],[255,0,255],[0,255,255],[255,255,255],[0,0,0,0],[0,0,0,0]];t.push(...e);const r=[0,51,102,153,204,255];for(let n=0;n<6;n++)for(let i=0;i<6;i++)for(let o=0;o<6;o++){const s=r[n],c=r[i],u=r[o];t.push([s,c,u])}for(let n=0;n<24;n++){const i=8+n*10;t.push([i,i,i])}return t.map(n=>new A(n[0],n[1],n[2]))}var Ma=new M({locked:!0,name:"Windows 256 Color",description:"A palette inspired by the classic Windows 256 color set, including VGA colors, web-safe colors, and grayscale.",colors:ka().map(t=>new j({color:t}))}),Ta=new M({locked:!0,name:"ZX Spectrum Palette",description:"The 15 colors of the ZX Spectrum, including bright variants.",colors:[{id:"zx-0",color:"#000000"},{id:"zx-1",color:"#0000D7"},{id:"zx-2",color:"#D70000"},{id:"zx-3",color:"#D700D7"},{id:"zx-4",color:"#00D700"},{id:"zx-5",color:"#00D7D7"},{id:"zx-6",color:"#D7D700"},{id:"zx-7",color:"#D7D7D7"},{id:"zx-8",color:"#000000"},{id:"zx-9",color:"#0000FF"},{id:"zx-10",color:"#FF0000"},{id:"zx-11",color:"#FF00FF"},{id:"zx-12",color:"#00FF00"},{id:"zx-13",color:"#00FFFF"},{id:"zx-14",color:"#FFFF00"},{id:"zx-15",color:"#FFFFFF"}]});const Ra={aap_64:_a,apple_2:fa,arne_16:pa,bob_ross:ga,bubblegum_16:ya,c64:wa,cga_0:ma,cga_1:ba,cga_2:Sa,db_16:va,edg_20:La,game_boy:Ea,lospec_500:Ca,nes:Da,pico_8:Aa,win_256:Ma,zx_spectrum:Ta};function Oa(t){return Ra[t]}function za(){const{colors:t}=Oa("aap_64");return new M({id:"default",name:"Default Palette",colors:[new j({id:"black",color:new A(0,0,0,255)}),new j({id:"white",color:new A(255,255,255,255)}),...t]})}se.NEAREST_NEIGHBOR+"",se.BICUBIC+"",se.BILINEAR+"",se.LANCZOS+"",D.NORMAL+"",D.MULTIPLY+"",D.SCREEN+"",D.OVERLAY+"",D.DARKEN+"",D.LIGHTEN+"",D.COLOR_DODGE+"",D.COLOR_BURN+"",D.HARD_LIGHT+"",D.SOFT_LIGHT+"",D.DIFFERENCE+"",D.EXCLUSION+"",w.NORMAL+"",w.REPLACE+"",w.MULTIPLY+"",w.SCREEN+"",w.OVERLAY+"",w.SOFT_LIGHT+"",w.HARD_LIGHT+"",w.DIFFERENCE+"",w.EXCLUSION+"",w.COLOR_BURN+"",w.LINEAR_BURN+"",w.COLOR_DODGE+"",w.LINEAR_DODGE+"",w.VIVID_LIGHT+"",w.LINEAR_LIGHT+"",w.PIN_LIGHT+"",w.HARD_MIX+"",w.SUBSTRACT+"",w.DIVIDE+"",v.DOTTED_FREEHAND+"",v.CONTINUOUS_FREEHAND+"",v.STRAIGHT_LINE+"",v.CURVE_LINE+"",v.FILL_TOOL+"",v.AIR_BRUSH+"",v.RECTANGLE+"",v.CIRCLE+"",v.ELLIPSE+"",v.POLYGON+"",v.COLOR_PICKER+"",v.CROP+"",v.GRID+"",v.ZOOM_FIT+"",v.MAGNIFY+"",v.ZOOM+"",v.STACK_UNDO+"",v.STACK_REDO+"",v.CLEAR+"",Y.CIRCLE+"",Y.SQUARE+"",Y.DOTS+"",Y.CIRCLE+"",Y.SQUARE+"",Y.DOTS+"",H.STROKED+"",H.FILLED+"",H.STROKED_FILLED+"";function Ba(){return{type:Y.CIRCLE,size:1,mode:w.NORMAL}}function Fa(){return{shapeStyle:H.STROKED_FILLED,value:v.CONTINUOUS_FREEHAND,dottedGap:2,segmentLength:1,gapLength:0,interpolateSegments:!0,airBrushStrength:50,airBrushWeight:.5,airBrushInterval:50}}function Ia(){return{primaryColor:new j({color:new A(0,0,0)}),secondaryColor:new j({color:new A(255,255,255)}),palette:za()}}function Va(t){return{tool:{...t.tool},brush:{...t.brush},color:{primaryColor:t.color.primaryColor.clone(),secondaryColor:t.color.secondaryColor.clone(),palette:t.color.palette.clone()}}}class vr{size;primaryColor;secondaryColor;scale=1;constructor(e={}){const{size:r,primaryColor:n,secondaryColor:i}=e;this.size=r!==void 0?r:1,this.primaryColor=n||new A(0,0,0),this.secondaryColor=i||new A(255,255,255)}getSize(){return this.size}async setSize(e){this.size=e}getScaledSize(e=!1){const r=this.getSize();return e?r*this.scale:r}}class Ua extends vr{getScaledSize(e=!1){const r=this.getSize();return e?r*this.scale:r}}class jn extends vr{}class qn extends vr{getScaledSize(e=!1){const r=this.getSize();return e?r*this.scale:r}}function Pa(t){switch(t){case Y.CIRCLE:return Ua;case Y.SQUARE:return jn;case Y.DOTS:return qn;default:throw new Error(`Unknown brush type: ${t}`)}}class Ga{maxStackSize=20;stack=[];subStack;onAdd;onForward;onBackward;onComplete;onLimitReached;index=-1;constructor({maxStackSize:e,onForward:r,onBackward:n,onComplete:i,onLimitReached:o}){e&&(this.maxStackSize=e),this.onForward=r,this.onBackward=n,this.onComplete=i,this.onLimitReached=o}start(){this.index<this.stack.length-1&&(this.stack=this.getStackAtIndex(this.index)),this.subStack=[]}async add(e){if(!this.subStack)throw new Error("Stack not started. Call start() before adding items.");e=await this.onAdd?.(e)||e,this.subStack.push(e)}stop(){if(this.subStack&&(this.stack.push(this.subStack),this.subStack=void 0),this.stack.length>this.maxStackSize){const e=this.stack.shift();this.onLimitReached&&e&&this.onLimitReached(e)}this.index=this.stack.length-1,this.onComplete?.()}abort(){this.subStack=void 0,this.index=this.stack.length-1}async forward(){if(this.index<this.stack.length-1){const e=this.index;this.index++,await this.onForward?.(this,this.index,e)}}async backward(){if(this.index>-1){const e=this.index;this.index--,await this.onBackward?.(this,this.index,e)}}getStackAtIndex(e){return this.stack.slice(0,Math.max(e+1,0))}getStack(){return this.stack}get active(){return this.subStack!==void 0}get length(){return this.stack.length}get subStackLength(){return this.stack.reduce((e,r)=>e+r.length,0)}clear(){this.stack=[],this.subStack=void 0,this.index=-1}}class Na{buffer;view;layers=[];layerMap=new Map;_currentLayerId;onChange;constructor(e){this.onChange=e?.onChange}get beforeView(){throw new Error("Method not implemented.")}get afterView(){throw new Error("Method not implemented.")}getCurrentLayerId(){return this._currentLayerId}setCurrentLayerId(e){this._currentLayerId=e,this.onChange?.()}get currentLayer(){if(this._currentLayerId)return this.layerMap.get(this._currentLayerId)}addLayer(e){const r=this.layers.length===0;if(r&&!e?.dimension)throw new Error("First layer must have a dimension");const n=e?.dimension||this.layers[0]?.buffer.dimension,i=new Fn({...e,dimension:e?.dimension??n,order:this.layers.length});return i.layerManager=this,this.layers.push(i),this.layerMap.set(i.id,i),r&&(this.setBuffer(i.buffer.dimension),this._currentLayerId=i.id),i}removeLayer(e){this.layerMap.get(e)&&(this.layers=this.layers.filter(n=>n.id!==e),this.layerMap.delete(e),this._currentLayerId===e&&(this._currentLayerId=this.layers.length?this.layers[0].id:void 0),this.layers.forEach((n,i)=>{n.order=i}))}selectLayer(e){this.setCurrentLayerId(e)}getLayerById(e){return this.layerMap.get(e)}setLayers(e){this.layers=e,this.layerMap.clear(),this._currentLayerId=void 0,e.length&&(this.setBuffer(e[0].buffer.dimension),this.layers.forEach(r=>{r.layerManager=this,this.layerMap.set(r.id,r),this._currentLayerId||(this._currentLayerId=r.id)}))}async update(){if(!this.currentLayer)throw new Error("No current layer to update");this.view.set(this.currentLayer.view)}setBuffer(e){const r=new SharedArrayBuffer(e.x*e.y*4),n=new Uint8Array(r);this.view=n,this.buffer={buffer:r,dimension:e}}getTotalView(){const e=this.currentLayer;if(!e)throw new Error("No current layer to get total view");const r=new Uint8Array(Array(e.dimension.x*e.dimension.y*4).fill(0));return fn(r,m(e.dimension),this.layers.map(n=>new Ke(n.view,Bn(n.blendMode),n.opacity)),!0),r}}let Jn=!0,ce;class Et{debug;displayWorkerPorts=[];useOptions={tool:Fa(),brush:Ba(),color:Ia()};brushDescription;actionStack;layerManager;constructor(e){if(e){const{debug:r=!1,displayWorkerPorts:n=[],useOptions:i={},brushDescription:o}=e;Object.assign(this,{debug:r,displayWorkerPorts:n,useOptions:i,brushDescription:o})}this.layerManager=e?.layerManager??new Na({onChange:async()=>{this.layerManager.currentLayer?.refreshTmpBuffer(),this.actionStack.clear(),await this.update({layers:!0})}}),this.actionStack=e?.actionStack||new Ga({maxStackSize:1/0,onForward:async(r,n)=>{ce=this.useOptions,this.removeTmpView(),this.setView(new Uint8Array(this.layerManager.currentLayer?.tmpBuffer.buffer));for(const{payload:i,selectOptions:o}of r.getStackAtIndex(n).flat())this.setBrush(o.brush,o.color),await Lt(new Et({...this,useOptions:o}),i);await this.update({client:!0}),ce&&this.setSelectOptions(ce)},onBackward:async(r,n)=>{ce=this.useOptions,this.removeTmpView(),this.setView(new Uint8Array(this.layerManager.currentLayer?.tmpBuffer.buffer));for(const{payload:i,selectOptions:o}of r.getStackAtIndex(n).flat())this.setBrush(o.brush,o.color),await Lt(new Et({...this,useOptions:o}),i);await this.update({client:!0}),ce&&this.setSelectOptions(ce)},onComplete:async()=>{this.update({client:!0})},onLimitReached:r=>{if(this.layerManager.currentLayer.tmpBuffer?.buffer){const n=this.layerManager.currentLayer.tmpBuffer?.buffer,i=new Uint8Array(n);ce=this.useOptions,r.forEach(async({payload:o,selectOptions:s})=>{const{tool:c,meta:u,toolOptions:l}=o;this.setBrush(s.brush,s.color),await Lt({...this,useOptions:s,view:i},{tool:c,meta:u,toolOptions:l}),await this.update({client:!0})}),ce&&this.setSelectOptions(ce)}}})}async addActionStack(e,r){await this.actionStack.add({name:e,payload:r,selectOptions:Va(this.useOptions)})}setBrush(e,r){const n=Pa(e.type),i=new n({size:e.size||1,primaryColor:r.primaryColor.color,secondaryColor:r.secondaryColor.color}),o=i.getScaledSize(!0),s=e.mode||w.NORMAL;let c;i instanceof jn?c=dr.Square:i instanceof qn?c=dr.Dots:c=dr.Round,Jn?(cs(bt(s),c,o,Ue(i.primaryColor),Ue(i.secondaryColor)),Jn=!1):ls(bt(s),c,o,Ue(i.primaryColor),Ue(i.secondaryColor)),this.brushDescription=i}setSelectOptions({tool:e,brush:r,color:n}){if(r){const i=n||this.useOptions.color;this.setBrush(r,i)}e&&(this.useOptions.tool=e),r&&(this.useOptions.brush=r),n&&(this.useOptions.color=n)}setSharedBuffer(e,r){this.layerManager.currentLayer?.setSharedBuffer(e,r)}getColorByPosition(e){const r=pn(this.layerManager.currentLayer.view,m(this.getDimension()),R(e),m(d(1,1)));if(r.length<4)throw new Error(`Data length is too short: ${r.length}. Expected at least 4 bytes for RGBA.`);return new A(r[0],r[1],r[2],r[3])}setView(e){this.layerManager.currentLayer?.setView(e)}createTmpView(){return this.layerManager.currentLayer?.createTmpView()}updateTmpView(){this.layerManager.currentLayer?.updateTmpView()}removeTmpView(){this.layerManager.currentLayer?.removeTmpView()}getDimension(){return d(this.layerManager.currentLayer.buffer.dimension.x,this.layerManager.currentLayer.buffer.dimension.y)}getTargetPosition(e,{dimension:r,displayPosition:n,zoomLevel:i},o){const s=this.getDimension();let c=d(()=>n*s+s/2+e/i*r/2);return c=d(()=>Math[o?.round?"round":"floor"](c)),c}getTargetDimension(e,{dimension:r,zoomLevel:n}){return d(()=>Math.round(e/n*r))}getColorAtPosition(e){if(!this.layerManager.currentLayer.view||!this.layerManager.currentLayer.buffer)throw new Error("No image data available.");const r=Math.floor(e.x),i=(Math.floor(e.y)*this.layerManager.currentLayer?.buffer.dimension.x+r)*4,o=this.layerManager.currentLayer.view;if(o[i]!==void 0)return new A(o[i],o[i+1],o[i+2],o[i+3])}isIntersect(e){const r=this.getDimension();return e.x>=0&&e.y>=0&&e.x<=r.x-1&&e.y<=r.y-1}action(e,r){return Ct(self,e,r)}actionDisplay(){this.displayWorkerPorts.forEach(e=>(r,n)=>Ct(e,r,n))}async update(e){const{layers:r,client:n}=e||{};return await this.layerManager.update(),n&&await this.updateClient(),r&&this.setDisplayLayers(),this.updateDisplays()}async setupDisplays(){await xa(this.displayWorkerPorts,this.layerManager.buffer)}async updateDisplays(){return Zn(this.displayWorkerPorts,{id:crypto.randomUUID(),data:{type:g.UPDATE_CANVAS,payload:void 0}})}async setDisplayLayers(){return Zn(this.displayWorkerPorts,{id:crypto.randomUUID(),data:{type:g.SET_LAYERS,payload:{layers:this.layerManager.layers.map(e=>({...e.toJSON(),current:e.id===this.layerManager.currentLayer.id,buffer:e.buffer}))}}})}updateClient(){const e={id:crypto.randomUUID(),data:{type:g.SYNC_STATE,payload:{stackMaxSize:this.actionStack.maxStackSize,stackCount:this.actionStack.length,stackIndex:this.actionStack.index,layers:this.layerManager.layers.map(r=>({order:r.order,id:r.id,name:r.name,opacity:r.opacity,visible:r.visible,blendMode:r.blendMode,dimension:r.dimension})),currentLayerId:this.layerManager.getCurrentLayerId()}}};return this.action(e)}}const Lr=new Et;Lr.layerManager.addLayer({name:"Default",dimension:d(800,600)});async function Ct(t,e,r){const n=await Ai(nt(e).pipe(Fo()));t.postMessage(n,r||[])}async function xa(t,e){const r={id:crypto.randomUUID(),data:{type:g.UPDATE_BUFFER,payload:{sharedBuffer:e}}};await Promise.all(t.map(n=>Ct(n,r)))}async function Zn(t,e){await Promise.all(t.map(r=>Ct(r,e)))}Bt(self,"message").pipe(B(t=>t.data),Io()).subscribe(async({id:t,data:e,transfer:r})=>{try{let n=await da(Lr,e);Array.isArray(n)&&(r=n[1],n=n[0]),n&&Lr.action({id:t,data:n},r)}catch(n){ir.error("Error processing action:",n)}})})();
