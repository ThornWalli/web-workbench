import{a8 as y,j as $,k as N,u as k}from"./index.69ac9e5a.js";import{N as R,T as u}from"./index.01a5c491.js";import{S,N as h,T as x}from"./TimelineCanvas.dec8cd2e.js";import{_,k as r,l as a,N as C,O as f,m as o,f as d,q as p,z as T,x as B,y as E}from"./entry.e14887ae.js";import"./index.56665add.js";import"./viewport.b344546e.js";import"./math.2df7af34.js";import"./async.59d11cc0.js";const D={emits:["refresh"],data:function(){return{noteRenderer:null,svgNode:null,notes:[[["C#","2m"],["C#2","2m"],["C#2","2m."],["C#","1m"],["C#2","1m"],["C#2","1m."],["C#","2n."],["C#2","2n"],["C#2","2n."],["C#2","4n."]],[["","2m"],["","1m"],["","2n"],["","4n"],["","8n"],["","16n"],["","32n"]],[["C4","2m"],["C4","1m"],["C4","2n"],["C4","4n"],["C4","8n"],["C4","16n"],["C4","32n"]],[["C4","2m."],["C4","1m."],["C4","2n."],["C4","4n."],["C4","8n."],["C4","16n."],["C4","32n."]]].flat().map(([e,n])=>new R({note:e,time:n})),durations:[["1m","2m","2n","4n","8n","16n","32n"],["1m","2m","2n","4n.","8n.","16n.","32n."]].flat()}},computed:{visibleNotes(){return this.noteRenderer?this.notes:[]}},mounted(){const e=new DOMParser;window.svgNode=this.svgNode=e.parseFromString(S,"image/svg+xml").querySelector("svg"),this.noteRenderer=new h(this.svgNode),this.$nextTick(async()=>{const n=Array.from(this.$el.querySelectorAll("canvas"));await Promise.all(n.map((t,s)=>this.render(t,this.notes[Number(s)]))),this.$emit("refresh")})},methods:{async render(e,n){const t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);const s=await this.noteRenderer.render(n,{colors:{primary:"#ffffff",secondary:"#000000",tertiary:"#ff0000"}});e.width=s.canvas.width,e.height=s.canvas.height,t.drawImage(s.canvas,0,0)}}},I=["width","height"];function P(e,n,t,s,v,c){return r(),a("ul",null,[(r(!0),a(C,null,f(c.visibleNotes,i=>(r(),a("li",{key:i},[o("canvas",{width:e.noteRenderer.dimension.x,height:e.noteRenderer.dimension.y},null,8,I)]))),128))])}const F=_(D,[["render",P],["__scopeId","data-v-299820b6"]]);const q={components:{NoteCanvas:F,TimelineCanvas:x,WbButton:y},props:{...$},emits:[...N,"refresh"],setup(e,n){return{...k(e,n)}},data:function(){return{tracks:z(),noteRenderer:new h}},mounted(){console.log("DEBUG",{noteRenderer:this.noteRenderer}),this.$nextTick(()=>{this.$emit("refresh")})}},z=()=>[new u({name:"Pause",type:"Synth",notes:[{name:"",duration:.25},{name:"",duration:.25},{name:"",duration:.25},{name:"",duration:.25},{name:"",duration:1},{name:"",duration:1},{name:"",duration:1},{name:"",duration:1}],beatCount:4}),new u({name:"Pause",type:"Synth",notes:[{name:"C#5 ",time:"16n"},{name:"Db4",time:"16n"},{name:"Eb4",time:"16n"},{name:"Gb4",time:"16n"},{name:"Ab4",time:"16n"},{name:"C4",time:"16n"},{name:"E4",time:"16n"},{name:"F4",time:"16n"},{name:"C5",time:"16n"},{name:"C5",time:"16n"},{name:"F4",time:"16n"},{name:"E4",time:"16n"},{name:"C4",time:"16n"}],beatCount:2})],l=e=>(B("data-v-1014939d"),e=e(),E(),e),A={class:"wb-disks-extras13-synthesizer-debug"},G=l(()=>o("legend",null,"Timelines",-1)),O=l(()=>o("legend",null,"Note Cache",-1)),V=l(()=>o("legend",null,"Notes",-1));function W(e,n,t,s,v,c){const i=d("timeline-canvas"),w=d("wb-button"),g=d("note-canvas");return r(),a("div",A,[o("fieldset",null,[G,(r(!0),a(C,null,f(e.tracks,(m,b)=>(r(),T(i,{key:b,track:m,onRefresh:n[0]||(n[0]=j=>e.$emit("refresh"))},null,8,["track"]))),128))]),o("fieldset",null,[O,p(w,{label:`Clear Cache (${e.noteRenderer.cache.size} Bitmaps)`,onClick:n[1]||(n[1]=m=>e.noteRenderer.cache.clear())},null,8,["label"])]),o("fieldset",null,[V,p(g,{onRefresh:n[2]||(n[2]=m=>e.$emit("refresh"))})])])}const Y=_(q,[["render",W],["__scopeId","data-v-1014939d"]]);export{Y as default};
