(window.webpackJsonp=window.webpackJsonp||[]).push([[1,9,43,44],{103:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));var n=r(77);class o extends n.default{onPointerDown(t){var e=t.x,r=t.y,data=[].concat(this._brush.data);return this._app.canvas.addRenderAction((()=>{n.default.drawBrush({color:this._brush.primaryColor,x:e,y:r,data:data,app:this._app})})),{save:!0,render:!0}}}},104:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return c}));var n=r(76),o=r(77),h=r(83);class c extends h.default{constructor(t){super(t),this._proportinalScale=!1}onPointerMove(t){var e=(t.x-this.startEvent.x)/2,r=(t.y-this.startEvent.y)/2;if(this._proportinalScale&&(r=e<0&&r>0||e>0&&r<0?-1*e:e),0!==e&&0!==r)return this._app.canvas.addPassiveRenderAction((()=>{Object(n.ellipse)(((t,e,r)=>{var data=[].concat(this._brush.data);o.default.drawBrush({color:r?this._brush.secondaryColor:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})}),Math.floor(this.startEvent.x+e),Math.floor(this.startEvent.y+r),e,r,{filled:this.filled})})),{render:!0}}onPointerUp(t){var e=(t.x-this.startEvent.x)/2,r=(t.y-this.startEvent.y)/2;if(this._proportinalScale&&(r=e<0&&r>0||e>0&&r<0?-1*e:e),0!==e&&0!==r)return this._app.canvas.addRenderAction((()=>{Object(n.ellipse)(((t,e,r)=>{var data=[].concat(this._brush.data);o.default.drawBrush({color:r?this._brush.secondaryColor:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})}),Math.floor(this.startEvent.x+e),Math.floor(this.startEvent.y+r),e,r,{strokeSize:this._brush.data.length,filled:this.filled})})),{save:!0,render:!0}}}},109:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));var n=r(75);class o extends n.b{}},119:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return h}));var n=r(76),o=r(77);class h extends o.default{onPointerDown(t){return c.bind(this)(t)}onPointerMove(t){return c.bind(this)(t)}onPointerUp(){return this.last=null,{save:!0}}}function c(t){var e=(this.last||t).x,r=(this.last||t).y;return Object(n.line)(((t,e)=>{var data=[].concat(this._brush.data);this._app.canvas.addRenderAction((()=>{o.default.drawBrush({color:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})}))}),e,r,t.x,t.y,{}),this.last=t,{render:!0}}},120:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return h}));var n=r(76),o=r(83);class h extends o.default{onPointerDown(t){if(this.selectedAnchor){var e=this.getAnchorByPosition(t.x,t.y);if(!e)return this._app.canvas.addRenderAction((()=>{this.render(!1),this.reset()})),{save:!0,render:!0};this.selectedAnchor=e,this._app.canvas.addPassiveRenderAction((()=>{this.render(!0)}))}return{render:!0}}onPointerMove(t,e){if(e.pressed)return this.anchors.length<1&&(this.addAnchor(t.x,t.y),this.selectedAnchor=this.addAnchor(t.x,t.y)),this.selectedAnchor.x=t.x,this.selectedAnchor.y=t.y,this._app.canvas.addPassiveRenderAction((()=>{this.render(!0)})),{render:!0}}render(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.anchors.length&&(Object(n.line)(((t,e)=>{var data=[].concat(this._brush.data);o.default.drawBrush({color:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})}),this.anchors[0].x,this.anchors[0].y,this.anchors[1].x,this.anchors[1].y,{}),t&&this.drawAnchors())}}},121:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return l}));var n=r(81),o=r(76),h=r(77),c=r(83);class l extends c.default{constructor(t){super(t),this.status=0,this.locked=!1}refreshHelperOffset(){this.primaryHelper&&(this.primaryHelperOffset=[this.primaryHelper.x-this.primaryAnchor.x,this.primaryHelper.y-this.primaryAnchor.y]),this.secondaryHelper&&(this.secondaryHelperOffset=[this.secondaryHelper.x-this.secondaryAnchor.x,this.secondaryHelper.y-this.secondaryAnchor.y])}onPointerDown(t){if(this.moved||this.reset(),!this.locked){this.locked=!0,1===this.anchors.length&&this.reset();var e=this.getAnchorByPosition(t.x,t.y);if(e&&this.selectedAnchor!==e)this.selectedAnchor=e;else{if(2===this.status&&!e)return f.bind(this)();1===this.status?d.bind(this)():this.selectedAnchor||(this.addAnchor(t.x,t.y),this.selectedAnchor=this.addAnchor(t.x,t.y))}return this._app.canvas.addPassiveRenderAction((()=>{this.render(!0),this.locked=!1})),{render:!0}}}get primaryAnchor(){return this.anchors[0]}get secondaryAnchor(){return this.anchors[1]}get primaryHelper(){return this.anchors[2]}get secondaryHelper(){return this.anchors[3]}onPointerUp(){if(this.status<3&&0===this.status)return this.selectedAnchor=null,this.status++,this._app.canvas.addPassiveRenderAction((()=>{this.render(!0)})),{render:!0}}onPointerMove(t,e){if(e.pressed&&this.selectedAnchor)return this.moved=!0,this.selectedAnchor.x=t.x,this.selectedAnchor.y=t.y,this.selectedAnchor===this.primaryAnchor&&this.primaryHelper?(this.primaryHelper.x=this.selectedAnchor.x+this.primaryHelperOffset[0],this.primaryHelper.y=this.selectedAnchor.y+this.primaryHelperOffset[1]):this.selectedAnchor===this.secondaryAnchor&&this.secondaryHelper?(this.secondaryHelper.x=this.selectedAnchor.x+this.secondaryHelperOffset[0],this.secondaryHelper.y=this.selectedAnchor.y+this.secondaryHelperOffset[1]):this.selectedAnchor!==this.primaryHelper&&this.selectedAnchor!==this.secondaryHelper||this.refreshHelperOffset(),this._app.canvas.addPassiveRenderAction((()=>{this.render(!0)})),{render:!0}}addPoints(t){t.forEach((t=>{this.points[Object(n.b)(t[0]-1,0,this._app.canvas.width-1)][Object(n.b)(t[1]-1,0,this._app.canvas.height-1)]=!0}))}render(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.status>1?Object(o.curve)(((t,e)=>{var data=[].concat(this._brush.data);h.default.drawBrush({color:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})}),this.primaryAnchor.x,this.primaryAnchor.y,this.primaryHelper.x,this.primaryHelper.y,this.secondaryHelper.x,this.secondaryHelper.y,this.secondaryAnchor.x,this.secondaryAnchor.y):Object(o.line)(((t,e)=>{var data=[].concat(this._brush.data);c.default.drawBrush({color:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})}),this.primaryAnchor.x,this.primaryAnchor.y,this.secondaryAnchor.x,this.secondaryAnchor.y,{}),t&&(this.primaryHelper&&Object(o.line)(((t,e)=>{var r=this._app.canvas.getColorFromPixel(t,e);0===r.alpha?r=this.anchorBrush.primaryColor:r.invert();var data=[].concat(this.anchorBrush.data);c.default.drawBrush({color:r,data:data,x:t,y:e,app:this._app})}),this.primaryAnchor.x,this.primaryAnchor.y,this.primaryHelper.x,this.primaryHelper.y,{}),this.secondaryHelper&&Object(o.line)(((t,e)=>{var r=this._app.canvas.getColorFromPixel(t,e);0===r.alpha?r=this.anchorBrush.primaryColor:r.invert();var data=[].concat(this.anchorBrush.data);c.default.drawBrush({color:r,data:data,x:t,y:e,app:this._app})}),this.secondaryAnchor.x,this.secondaryAnchor.y,this.secondaryHelper.x,this.secondaryHelper.y,{}),this.drawAnchors())}reset(){c.default.prototype.reset.apply(this,arguments),this.status=0,this.locked=!1}intersect(t,e){for(var r=[[0,0],[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]],i=0;i<r.length;i++)if(this.points[t+r[Number(i)][0]][e+r[Number(i)][1]])return!0;return!1}}function d(){var t=v(this.primaryAnchor,this.secondaryAnchor);this.addAnchor(t[0],t[1]),t=v(this.secondaryAnchor,this.primaryAnchor),this.addAnchor(t[0],t[1]),this.refreshHelperOffset(),this._app.canvas.addPassiveRenderAction((()=>{this.render(!0),this.locked=!1})),this.status++}function f(){return this._app.canvas.addRenderAction((()=>{this.render(!1),this.reset()})),{events:!1,save:!0,render:!0}}function v(t,e){var r=Object(o.getLinePoints)(t.x,t.y,e.x,e.y);return r[Math.floor(r.length/4)]}},122:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));var n=r(78);class o extends n.default{fill(t,e,r){for(var n,i,o,h,c,l=[[t,e]],d=0,f=this._app.canvas.getColorFromPixel(t,e,!0),a=[[-1,0],[1,0],[0,-1],[0,1]];l.length;){if(d>2e6)throw new Error("FILL OVERFLOW");for(t=(n=l.pop())[0],e=n[1],this._app.canvas.setPixel(t,e,r,!0),i=0;i<a.length;i++)o=t+a[Number(i)][0],h=e+a[Number(i)][1],o>=0&&o<this._app.canvas.width&&h>=0&&h<this._app.canvas.height&&(c=this._app.canvas.getColorFromPixel(o,h,!0)).is(f)&&!r.is(c)&&l.push([o,h]);d++}}onPointerDown(t){if(!this._filling){this._filling=!0;var e=t.x,r=t.y,n=this._app.primaryColor;return this._app.canvas.addRenderAction((()=>{this.fill(e,r,n),this._filling=!1})),{save:!0,render:!0}}return{events:!1}}}},123:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));var n=r(103);class o extends n.default{constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.pointerDownHold=!0,super(t)}}},124:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return c}));var n=r(76),o=r(77),h=r(83);class c extends h.default{onPointerMove(t){var e=t.x-this.startEvent.x,r=t.y-this.startEvent.y;return this._app.canvas.addPassiveRenderAction((()=>{Object(n.rectangle)(((t,e,r)=>{var data=[].concat(this._brush.data);o.default.drawBrush({color:r?this._brush.secondaryColor:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})}),this.startEvent.x,this.startEvent.y,e,r,{strokeSize:this.filled?0:this._brush.data.length,filled:this.filled})})),{render:!0}}onPointerUp(t){var e=t.x-this.startEvent.x,r=t.y-this.startEvent.y;return this._app.canvas.addRenderAction((()=>{Object(n.rectangle)(((t,e,r)=>{var data=[].concat(this._brush.data);o.default.drawBrush({color:r?this._brush.secondaryColor:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})}),this.startEvent.x,this.startEvent.y,e,r,{strokeSize:this.filled?0:this._brush.data.length,filled:this.filled})})),{save:!0,render:!0}}}},125:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return h}));var n=r(76),o=r(104);class h extends o.default{constructor(t){super(t),this._proportinalScale=!0,this._func=n.ellipse}}},126:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return c}));var n=r(76),o=r(77),h=r(83);class c extends h.default{constructor(t){super(t),this.status=0}onPointerMove(t,e){if(e.pressed&&this.selectedAnchor)return this.selectedAnchor.x=t.x,this.selectedAnchor.y=t.y,this._app.canvas.addPassiveRenderAction((()=>{this.render(!0)})),{render:!0}}onPointerDown(t){var e=this.getAnchorByPosition(t.x,t.y);switch(this.status){case 1:if(!e)return this.status=2,this._app.canvas.addRenderAction((()=>{this.render(!1),this.reset()})),{save:!0,render:!0};this.selectedAnchor=e;break;default:e&&this.anchors[0]===e?(this.status=1,this.selectedAnchor=e):this.selectedAnchor=e||this.addAnchor(t.x,t.y)}return this._app.canvas.addPassiveRenderAction((()=>{this.render(this.status<2)})),{render:!0}}isClosed(){return this.status>0}render(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(n.polygon)(((t,e)=>{var data=[].concat(this._brush.data);o.default.drawBrush({color:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})}),this.anchors,this.status>0,{filled:this.filled}),t&&this.drawAnchors()}reset(){h.default.prototype.reset.apply(this,arguments),this.status=0}}},127:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return v}));var n=r(75),o=r(76),h=r(80),c=r(84),l=r(100),d=r(83),f=r(77);class v extends d.default{constructor(t){super(t),this.brushPrimaryColor=new h.default(h.default.COLOR_BLACK),this.brushSecondaryColor=new h.default(h.default.COLOR_WHITE),this.brush=new(Object(c.getBrushByIndex)(0))({app:this.app,size:1,primaryColor:this.brushPrimaryColor,secondaryColor:this.brushSecondaryColor}),this._moving=!1}onPointerMove(t){var e=t.x-this.startEvent.x,r=t.y-this.startEvent.y;return this._moving||(this._moving=!0,this._app.canvas.addPassiveRenderAction((()=>{Object(o.rectangle)(((t,e)=>{var data=[].concat(this._brush.data),r=this._app.canvas.getColorFromPixel(t,e);0===r.alpha?r=this.brushPrimaryColor:r.invert(),f.default.drawBrush({color:r,data:data,x:t,y:e,app:this._app})}),this.startEvent.x,this.startEvent.y,e,r,{strokeSize:this._brush.data.length,filled:!1}),this._moving=!1}))),{render:!0}}onPointerUp(t){this._app.canvas.cleanPassiveRenderActions();var e=Object(n.e)(t),r=Object(n.e)(this.startEvent),o=Object(n.d)((()=>Math.floor(e-r)));if(o.x>0&&o.y>0){var h=new l.default(r,e),c=this.app.display,d=Object(n.d)((()=>Math.floor(c.canvasLayout.naturalSize/o*c.zoomFactor))),f=Object(n.d)((()=>h.min+o/2));this.app.display.setZoom(d.x>d.y?d.x:d.y,f)}return{render:!0}}}},128:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return c}));var n=r(86),o=r(109),h=r(78);class c extends h.default{onPointerDown(t){var e=this.app.display,r=2;return e.maxZoomFactor-5<e.zoomFactor&&(r=1),r=n.a.altActive?-r:r,this.app.display.zoom(r,new o.default(t.x,t.y)),{events:!1}}}},129:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));var n=r(78);class o extends n.default{constructor(t){super(t),this.passive=!0}onActive(){this.app.canvas.revertStack()}}},130:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));var n=r(78);class o extends n.default{constructor(t){super(t),this.passive=!0}onActive(){this.app.canvas.clearStack()}}},134:function(t,e,r){"use strict";r.d(e,"b",(function(){return v})),r.d(e,"a",(function(){return y}));var n=r(85),o=function(t){function e(e,r){return t.call(this)||this}return Object(n.e)(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(r(151).b),h={setInterval:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=h.delegate;return((null==r?void 0:r.setInterval)||setInterval).apply(void 0,Object(n.h)([],Object(n.g)(t)))},clearInterval:function(t){var e=h.delegate;return((null==e?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},c=r(156),l=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.scheduler=e,n.work=r,n.pending=!1,n}return Object(n.e)(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this},e.prototype.requestAsyncId=function(t,e,r){return void 0===r&&(r=0),h.setInterval(t.flush.bind(t,this),r)},e.prototype.recycleAsyncId=function(t,e,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return e;h.clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(t,e);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var r,n=!1;try{this.work(t)}catch(t){n=!0,r=t||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r},e.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,r=this.scheduler,n=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Object(c.a)(n,this),null!=e&&(this.id=this.recycleAsyncId(r,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(o),d=r(181),f=function(){function t(e,r){void 0===r&&(r=t.now),this.schedulerActionCtor=e,this.now=r}return t.prototype.schedule=function(t,e,r){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(r,e)},t.now=d.a.now,t}(),v=new(function(t){function e(e,r){void 0===r&&(r=f.now);var n=t.call(this,e,r)||this;return n.actions=[],n._active=!1,n._scheduled=void 0,n}return Object(n.e)(e,t),e.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var r;this._active=!0;do{if(r=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,r){for(;t=e.shift();)t.unsubscribe();throw r}}},e}(f))(l),y=v},143:function(t,e,r){"use strict";r.r(e),r.d(e,"DISPLAY_SPLIT_VALUES",(function(){return A})),r.d(e,"default",(function(){return B}));var n=r(353),o=r(75),h=r(220),c=r(110),l=r(117),d=r(80),f=r(195),v=r(187),y=r(188),m=r(84),x=r(162);function w(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var _=0;function O(t){return"__private_"+_+++"_"+t}var A={FULL:0,HALF:1,THIRD:2,QUARTER:3},j=O("globalBounds"),z=O("density"),P=O("canvas"),C=O("inputs");class B{setDisplaysElement(t){this.displaysEl=t}refresh(){this.displaysLayout={size:Object(o.e)(this.displaysEl.offsetWidth,this.displaysEl.offsetHeight)},this.refreshDisplayPositions(),this.refreshDisplays()}setDisplay(t){this.display&&this.display.hideCursor(),this.display=t,this.display.showCursor()}updateGlobalBounds(t){w(this,j)[j]=t}constructor(t){this.events=new n.a,Object.defineProperty(this,j,{writable:!0,value:void 0}),this.fsItem=void 0,this.options={size:{width:300,height:200},display:{foreground:"#FFFFFF",background:"#000000"}},Object.defineProperty(this,z,{writable:!0,value:1}),this.displaySplit=A.FULL,this.displays=[],this.displaysEl=void 0,this.displaysLayout={size:Object(o.e)()},this.display=void 0,Object.defineProperty(this,P,{writable:!0,value:void 0}),this.primaryColor=void 0,this.secondaryColor=void 0,Object.defineProperty(this,C,{writable:!0,value:void 0}),this.brush=void 0,this.brushSelect={size:1,index:0},this.colorSelect={index:0,primaryColor:new d.default(d.default.COLOR_BLACK),secondaryColor:new d.default(d.default.COLOR_WHITE),paletteSteps:new d.default(2,1,1)},this.tool=void 0,this.toolSelect={value:"",index:1,filled:!1},this.cursorCanvas=null,w(this,j)[j]=t,w(this,P)[P]=new l.default(this),this.primaryColor=this.colorSelect.primaryColor,this.secondaryColor=this.colorSelect.secondaryColor,this.setBrush(this.brushSelect),this.setTool(this.toolSelect),this.subscriptions=[h.a.resize.subscribe(this.onViewportRefresh.bind(this))],w(this,C)[C]={keyboard:new f.default(this),mouse:new v.default(this)},Object.values(w(this,C)[C]).forEach((input=>{input.register()}))}reset(){this.canvas.clearStack(),this.displays.forEach((t=>t.reset()))}destroy(){this.subscriptions.forEach((t=>t.unsubscribe()))}refreshDisplays(){this.displays.forEach((t=>{t.refresh()}))}onViewportRefresh(){this.refreshDisplays()}addDisplay(t){return t=t||new x.default(this),this.displays.push(t),t.app=this,this.events.next(new c.a("addDisplay",t,this)),this.canvas.render(),t}clearDisplays(){this.displays.forEach((t=>{t.destroy(),this.events.next(new c.a("removeDisplay",t,this))})),this.displays=[]}getDisplay(t){return this.displays.find((e=>e.id===t&&e))}get inputs(){return w(this,C)[C]}get globalBounds(){return w(this,j)[j]}get canvas(){return w(this,P)[P]}get density(){return w(this,z)[z]}set density(t){w(this,z)[z]=t}setBrush(t){var{index:e,size:r}=t;this.brush=new(Object(m.getBrushByIndex)(e))({app:this,size:r}),this.tool&&(this.tool.brush=this.brush),this.events.next(new c.a("change:brush",this.brush,this))}setBrushSize(t){this.brush.size=t}setTool(t){var{index:e}=t,r=new(Object(y.getToolByIndex)(e))({app:this,brush:this.brush});this.tool=r,this.tool.onActive(),this.events.next(new c.a("change:tool",this.tool,this))}get paletteSteps(){return this.colorSelect.paletteSteps}set paletteSteps(t){this.colorSelect.paletteSteps=t}refreshDisplayPositions(){var t=this.displaysLayout.size.x,e=this.displaysLayout.size.y,r=[[[1,1]],[[.5,1],[.5,1]],[[1,.5],[1,.5]],[[1,.5],[.5,.5],[.5,.5]],[[.5,.5],[.5,.5],[1,.5]],[[.5,.5],[.5,.5],[.5,.5],[.5,.5]]].filter((t=>t.length===this.displays.length&&t));r=r[0],this.displays.forEach(((n,i)=>{n.setSize(Object(o.f)(Math.floor(t*r[Number(i)][0]),Math.floor(e*r[Number(i)][1]))),r[Number(i)][0],r[Number(i)][1]}))}}},162:function(t,e,r){"use strict";r.r(e),function(t){r.d(e,"default",(function(){return C}));var n=r(658),o=r(353),h=r(75),c=r(110),l=r(117),d=r(80),f=r(100);function v(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var y=0;function m(t){return"__private_"+y+++"_"+t}var x=m("id"),w=m("bounds"),_=m("cropBounds"),O=m("imageData"),A=m("tmpImageData"),j=m("el"),z=m("canvas"),P=m("context");class C{constructor(t){Object.defineProperty(this,x,{writable:!0,value:Object(n.a)()}),this.events=new o.a,Object.defineProperty(this,w,{writable:!0,value:new f.default}),this.size=Object(h.e)(),this.canvasLayout={size:Object(h.e)(),naturalSize:Object(h.e)(),position:Object(h.e)()},Object.defineProperty(this,_,{writable:!0,value:new f.default}),Object.defineProperty(this,O,{writable:!0,value:null}),Object.defineProperty(this,A,{writable:!0,value:null}),Object.defineProperty(this,j,{writable:!0,value:void 0}),Object.defineProperty(this,z,{writable:!0,value:void 0}),Object.defineProperty(this,P,{writable:!0,value:void 0}),this.zoomFactor=1,this.zoomPosition=Object(h.e)(.5,.5),this.zoomBounds=new f.default,this.offset=Object(h.f)(),this.cursorVisible=!1,this.app=t,this.cursorColor=new d.default(d.default.COLOR_BLACK),this.resetZoom()}showCursor(){this.cursorVisible=!0}hideCursor(){this.cursorVisible=!1,this.renderImageData()}setElement(element){v(this,j)[j]=element}setCanvas(canvas){v(this,z)[z]=canvas,v(this,P)[P]=canvas.getContext("2d"),Object.values(this.app.inputs).forEach((input=>{input.registerDisplay(this)}))}destroy(){this.events.next(new c.a("destroy")),Object.values(this.app.inputs).forEach((input=>{input.unregisterDisplay(this)}))}get canvas(){return v(this,z)[z]}get id(){return v(this,x)[x]}get bounds(){return v(this,w)[w]}get imageData(){return v(this,O)[O]}set imageData(t){v(this,A)[A]=v(this,O)[O]=t,this.maxZoomFactor=20,this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.renderImageData()}get canvasSize(){return Object(h.e)(v(this,z)[z].width,v(this,z)[z].height)}get naturalSize(){return Object(h.e)(v(this,z)[z].width,v(this,z)[z].height)}get naturalWidth(){return v(this,O)[O].width}get naturalHeight(){return v(this,O)[O].height}get width(){return this.zoomBounds.max.x-this.zoomBounds.min.x}get height(){return this.zoomBounds.max.y-this.zoomBounds.min.y}get zoomFactorWidth(){return v(this,z)[z].width/this.zoomFactor}setSize(t,e){var r;r="object"==typeof t?t:Object(h.e)(t,e),this.size=r,this.events.next(new c.a("change:size",r)),this.canvasAdjustment()}canvasAdjustment(){this.canvasLayout.size=Object(h.e)((()=>Math.min(Math.max(this.app.canvas.size*this.zoomFactor,0),this.size))),this.canvasLayout.naturalSize=this.app.canvas.size,this.canvasLayout.position=Object(h.e)(0,0)}setZoom(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(h.e)();(e=Math.min(e,this.maxZoomFactor))>=0&&(this.zoomFactor=e,this.canvasAdjustment(),this.zoomPosition=Object(h.e)((()=>r/this.canvasLayout.naturalSize)),this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.resetOffset(),t.requestAnimationFrame((()=>{this.renderImageData(),this.events.next(new c.a("change:zoomFactor",e))})))}zoom(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(h.e)();this.zoomFactor+t>=0&&this.setZoom(this.zoomFactor+t,e)}renderImageData(){v(this,A)[A]=v(this,O)[O];var t=Object(h.e)((()=>this.zoomBounds.max-this.zoomBounds.min)),e=Object(h.e)((()=>Object(h.e)(this.offset)+this.zoomBounds.min));v(this,A)[A]=l.default.cropImageData(v(this,A)[A],e.x,e.y,t.x,t.y),v(this,A)[A]=l.default.resizeImageData(v(this,A)[A],this.zoomFactor),this.renderCanvas()}get cursorColor(){return this._cursorColor}set cursorColor(t){this._cursorColorRGBA=t.toRGBA(),this._cursorColor=t}renderCanvas(){v(this,A)[A]&&(v(this,P)[P].putImageData(v(this,A)[A],-this.offset.x,-this.offset.y),this.renderRaster())}reset(){this.resetZoom(),this.resetOffset(),this.renderCanvas()}resetOffset(){this.offset=Object(h.f)(0,0)}resetZoom(){v(this,O)[O]&&this.setZoom(1)}renderRaster(){var t=[];this.zoomFactor>this.maxZoomFactor-3&&t.push({size:Object(h.e)(1,1),width:1,color:"#CCCCCC"});var e=v(this,P)[P];e.globalCompositeOperation="destination-over",t.forEach((t=>{var r=Object(h.e)((()=>this.canvasLayout.naturalSize/t.size));e.lineWidth=t.width,e.beginPath();for(var n=0;n<r.x+1;n++){var o=Math.floor(n*t.size.x*this.zoomFactor)+t.width/2;e.moveTo(o,0),e.lineTo(o,v(this,z)[z].height);for(var c=0;c<r.y+1;c++){var l=Math.floor(c*t.size.y*this.zoomFactor)+t.width/2;e.moveTo(0,l),e.lineTo(v(this,z)[z].width,l)}}e.strokeStyle=t.color,e.stroke()}))}refresh(){var rect={left:v(this,z)[z].offsetLeft+v(this,j)[j].offsetLeft,top:v(this,z)[z].offsetTop+v(this,j)[j].offsetTop,width:v(this,z)[z].offsetWidth,height:v(this,z)[z].offsetHeight};v(this,w)[w]=new f.default(Object(h.e)(rect.left,rect.top),Object(h.e)(rect.left+rect.width,rect.top+rect.height)),v(this,O)[O]&&this.renderImageData()}setOffset(t){this.offset=Object(h.f)(t.x,t.y)}calculateZoomBounds(t,e){e=e||1;var r=this.app.canvas.size;t=Object(h.e)((()=>Math.floor(t*r)));var n=Object(h.e)((()=>this.size/r)),o=Object(h.e)((()=>Math.ceil(Math.min(n/e*r,r)))),c=Object(h.e)((()=>Math.min(Math.max(t-Math.ceil(o/2),0),r-o))),l=Object(h.e)((()=>c+o));return new f.default(c,l)}}}.call(this,r(8))},187:function(t,e,r){"use strict";r.r(e),function(t){r.d(e,"default",(function(){return c}));var n,o=r(75),h=r(86);class c{constructor(t){this.subscriptions=[],this.displaySubscriptions=new Map,this.runSubscriptions=[],this._app=t,this._pressed=!1}registerDisplay(t){this.displaySubscriptions.set(t,[h.a.get("mousedown",t.canvas).subscribe(this.onPointerDown(t).bind(this)),h.a.get("mouseenter",t.canvas).subscribe(this.onPointerEnter(t).bind(this))])}unregisterDisplay(t){this.displaySubscriptions.has(t)&&(this.displaySubscriptions.get(t).forEach((t=>t.unsubscribe())),this.displaySubscriptions.delete(t))}register(){}unregister(){}onContextMenu(t){return e=>{this.runActionResult(m.bind(this)(e,t))}}onPointerEnter(t){return e=>{this.app.setDisplay(t);var r=h.a.get("mouseleave",e.target).subscribe((e=>{r.unsubscribe(),this.onPointerLeave(t)(e)}))}}onPointerLeave(t){return t=>{}}onPointerDown(t){return e=>{this.app.setDisplay(t),this._pointerEvent=d.bind(this)(e,t),this._pressed=!0,this.runActionResult(f.bind(this)(e,t),e,t),this.app.display.renderCanvas()}}onPointerLeaveAndUp(t){return e=>{l(),this.runActionResult(v.bind(this)(e,t))}}onPointerMove(t){return e=>{this.runActionResult(y.bind(this)(e,t))}}get app(){return this._app}get pressed(){return this._pressed}runActionResult(t,e,r){t&&(t.events&&(this.runSubscriptions=[h.a.get("contextmenu",e.target).subscribe(this.onContextMenu(r).bind(this)),h.a.get("mouseleave",e.target).subscribe(this.onPointerLeaveAndUp(r).bind(this)),h.a.get("mousemove",e.target).subscribe(this.onPointerMove(r).bind(this)),h.a.get("mouseup",e.target).subscribe(this.onPointerLeaveAndUp(r).bind(this))]),t.save&&this.app.canvas.saveStack(),t.revert&&this.app.canvas.revertStack(),t.render&&this.app.canvas.render())}unsubscribeRun(){this.runSubscriptions.filter((t=>!t.unsubscribe()))}}function l(){t.clearInterval(n),n=null}function d(t,e){var r=e.canvasLayout,n=Object(o.e)(t.clientX-e.bounds.min.x,t.clientY-e.bounds.min.y),c=Object(o.e)((()=>n-r.position));this.app.globalBounds&&(console.log(this.app.globalBounds.min.toString()),n=Object(o.e)((()=>n-this.app.globalBounds.min)),c=Object(o.e)((()=>c-this.app.globalBounds.min)));var l=Object(o.e)((()=>Math.round(c))),d=Object(o.e)((()=>Math.round(c/e.zoomFactor+e.zoomBounds.min)));return{position:d,origin:l,app:this.app,x:d.x,y:d.y,originX:l.x,originY:l.y,leftClick:2!==t.button,rightClick:2===t.button,holdAlt:h.a.altActive,holdCtrl:h.a.cmdActive}}function f(){var e,r={events:!0};return this.app.tool.pointerDownHold?(e=()=>{this.runActionResult(this.app.tool.onPointerDown(this._pointerEvent,this)),this.app.canvas.render()},l(),n=t.setInterval(e,20),r):Object.assign(r,this.app.tool.onPointerDown(this._pointerEvent,this))}function v(t,e){return this._pressed=!1,this._pointerEvent=null,this.unsubscribeRun(),this.app.tool.onPointerUp(d.bind(this)(t,e),this)}function y(t,e){return this._pointerEvent=d.bind(this)(t,e),this.app.tool.onPointerMove(this._pointerEvent,this)}function m(t,e){return t.preventDefault(),t.stopPropagation(),this.app.tool.onContextMenu(d.bind(this)(t,e),this)}}.call(this,r(8))},188:function(t,e,r){"use strict";r.r(e),r.d(e,"getToolByIndex",(function(){return P}));var n=r(78);r.d(e,"Tool",(function(){return n.default}));var o=r(77);r.d(e,"Brush",(function(){return o.default}));var h=r(103);r.d(e,"DottedFreehand",(function(){return h.default}));var c=r(119);r.d(e,"ContinuousFreehand",(function(){return c.default}));var l=r(120);r.d(e,"StraightLine",(function(){return l.default}));var d=r(121);r.d(e,"Curve",(function(){return d.default}));var f=r(122);r.d(e,"Fill",(function(){return f.default}));var v=r(123);r.d(e,"AirBrush",(function(){return v.default}));var y=r(124);r.d(e,"UnfilledFilledRectangle",(function(){return y.default}));var m=r(125);r.d(e,"UnfilledFilledCircle",(function(){return m.default}));var x=r(104);r.d(e,"UnfilledFilledEllipse",(function(){return x.default}));var w=r(126);r.d(e,"UnfilledFilledPolygon",(function(){return w.default}));var _=r(144);r.d(e,"BrushSelector",(function(){return _.default}));var O=r(127);r.d(e,"Magnifier",(function(){return O.default}));var A=r(128);r.d(e,"Zoom",(function(){return A.default}));var j=r(129);r.d(e,"Undo",(function(){return j.default}));var z=r(130);function P(t){return[h.default,c.default,l.default,d.default,f.default,v.default,y.default,m.default,x.default,w.default,_.default,n.default,n.default,n.default,O.default,A.default,j.default,z.default][Number(t)]}r.d(e,"Clear",(function(){return z.default}))},195:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return _}));var n=r(134),o=r(99),h=r(107),c=r(116),l={leading:!0,trailing:!1};var d=r(113),f=r(97);function v(t,e,r){void 0===t&&(t=0),void 0===r&&(r=n.a);var o,h=-1;return null!=e&&((o=e)&&Object(f.a)(o.schedule)?r=e:h=e),new d.a((function(e){var n=function(t){return t instanceof Date&&!isNaN(t)}(t)?+t-r.now():t;n<0&&(n=0);var o=0;return r.schedule((function(){e.closed||(e.next(o++),0<=h?this.schedule(void 0,h):e.complete())}),n)}))}function y(t,e,r){void 0===e&&(e=n.b),void 0===r&&(r=l);var d=v(t,e);return function(t,e){return void 0===e&&(e=l),Object(o.a)((function(source,r){var n=e.leading,o=e.trailing,l=!1,d=null,f=null,v=!1,y=function(){null==f||f.unsubscribe(),f=null,o&&(w(),v&&r.complete())},m=function(){f=null,v&&r.complete()},x=function(e){return f=Object(c.a)(t(e)).subscribe(Object(h.a)(r,y,m))},w=function(){if(l){l=!1;var t=d;d=null,r.next(t),!v&&x(t)}};source.subscribe(Object(h.a)(r,(function(t){l=!0,d=t,(!f||f.closed)&&(n?w():x(t))}),(function(){v=!0,(!(o&&l&&f)||f.closed)&&r.complete()})))}))}((function(){return d}),r)}var m=r(81),x=r(86),w=r(109);class _{constructor(t){this.subscriptions=[],this._app=t}register(){this.subscriptions.push(x.a.keydown.pipe(y(200)).subscribe(A.bind(this)),x.a.keyup.subscribe(O.bind(this)))}unregister(){this.subscriptions.forEach((t=>t.unsubscribe()))}registerDisplay(t){}unregisterDisplay(t){}}function O(t){switch(t.keyCode){case 17:t.preventDefault(),this.holdCrtl=!1;break;case 18:t.preventDefault(),this.holdAlt=!1}}function A(t){if(this._app.display){var e=1;switch(this.holdAlt&&(e*=10),t.keyCode){case 17:t.preventDefault(),this.holdCrtl=!0;break;case 18:t.preventDefault(),this.holdAlt=!0;break;case 37:t.preventDefault(),this._app.display.offset.x-=e;break;case 38:t.preventDefault(),this._app.display.offset.y-=e;break;case 39:t.preventDefault(),this._app.display.offset.x+=e;break;case 40:t.preventDefault(),this._app.display.offset.y+=e}var r=this._app.display;this._app.display.offset=new w.default(Object(m.b)(r.offset.x,-r.zoomBounds.min.x,r.canvasLayout.naturalSize.x-r.zoomBounds.max.x),Object(m.b)(r.offset.y,-r.zoomBounds.min.y,r.canvasLayout.naturalSize.y-r.zoomBounds.max.y)),this._app.display.renderImageData()}}},220:function(t,e,r){"use strict";(function(t){var n=r(75),o=r(654);var h=0;function c(t){return"__private_"+h+++"_"+t}var l,d=c("resize");e.a=l||(l=new class{constructor(){this.screenSize=Object(n.e)(0,0),Object.defineProperty(this,d,{writable:!0,value:new o.a(0)}),t.addEventListener("resize",this.onResize.bind(this),!1)}destroy(){t.removeEventListener("resize",this.onResize.bind(this),!1)}onResize(){this.screenSize=Object(n.e)(window.innerWidth,window.innerHeight)}getElementSize(t){return Object(n.e)(t.offsetWidth,t.offsetHeight)}get resize(){return function(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}(this,d)[d]}})}).call(this,r(8))}}]);