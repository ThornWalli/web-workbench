const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DrLItpjK.js","./CVVDEXDJ.js"])))=>i.map(i=>d[i]);
import{d as e,ab as l,r as a,k as o,o as t,W as n,F as s,z as u,D as i,A as r,C as d,y as c,X as v,Y as p,G as m,B as b,S as y,ac as f,P as C,K as k,_ as j}from"./BfpYGSxR.js";import{W as P}from"./Dnkwg0NB.js";import{W as w}from"./CnxF4DWy.js";import{W as _}from"./Caob76XJ.js";import{W as g}from"./CP7cPb5u.js";import{C as x,P as A,j as h,k as I,l as E,c as D}from"./Bx5hh_92.js";import{W}from"./BD_7eT_q.js";import{d as B}from"./DdO-3S9B.js";import{a as T}from"./Cy0zoxeo.js";import{S as U}from"./CrNGlbV0.js";import{f as F}from"./D3xLGof4.js";import"./BWKGU6Bw.js";import"./D1WZfvAb.js";import"./jSR9Z_uS.js";import"./BHmTNEz3.js";import"./DL1FsYWj.js";import"./B-meQdOw.js";import"./Caivkp23.js";import"./D7Us3e3D.js";import"./tbUmQ5LT.js";import"./CS1Zomql.js";import"./CcnVWkhV.js";import"./CY5IK1Gp.js";import"./Dw-z6kis.js";import"./ytSRQE8W.js";import"./B15fucc8.js";import"./BteAwo4N.js";import"./BVLmgizW.js";import"./BENg2Ku2.js";import"./CJFEEUyp.js";import"./C98WWl5r.js";import"./CVVDEXDJ.js";import"./CxZzHJhT.js";import"./BSzGBLGV.js";import"./D3MPJlJW.js";import"./GLWL0ZEA.js";import"./Cah-phv7.js";import"./DAKnsb8o.js";import"./I81pZH22.js";import"./CV0dHcg-.js";import"./B1k18Rg6.js";import"./CIasQYz1.js";const M={class:"colors style-scrollbar"},N=["id","name","value","checked","onInput"],S=["for"],q={class:"info"},L={class:"font-bit-font"},V={class:"font-bit-font"},R=j(e({__name:"ColorPalette",props:{core:{},model:{}},setup(e){const j=l(),R=a(),G=o(()=>R.value?R.value.colors:[]),J=a(),K=a(null),O=e;const z=a(D()),H=o(()=>[...z.value,...Y.value]),Y=o({get:()=>(O.core.config.get(x.WEB_PAINT_PALETTES)||[]).map(e=>new A(e)),set:e=>{O.core.config.set(x.WEB_PAINT_PALETTES,e)}});function saveColorPalette(){Y.value=[...Y.value]}const X=o(()=>({label:"Colors from Palette",hideLabel:!0,modelValue:"","onUpdate:model-value":e=>{const l=H.value.find(l=>l.id===e);R.value&&l&&(R.value.colors.push(...l.colors),saveColorPalette())},options:[{label:"Colors from Palette",value:""},...Y.value.length>0?[{label:"Custom Palettes",options:Y.value.map(e=>({label:e.name,value:e.id}))}]:[],{label:"Built-in Palettes",options:z.value.map(e=>({label:e.name,value:e.id}))}]})),$=o(()=>{var e;return{label:"Palette",hideLabel:!0,modelValue:null==(e=R.value)?void 0:e.id,"onUpdate:model-value":e=>R.value=H.value.find(l=>l.id===e),options:[{label:"New Palette",value:""},...Y.value.length>0?[{label:"Custom Palettes",options:Y.value.map(e=>({label:e.name,value:e.id,group:"custom"}))}]:[],{label:"Built-in Palettes",options:z.value.map(e=>({label:e.name,value:e.id,group:"test"}))}]}}),Q=new U;function onClickMoveColorBackward(){if(!J.value)return;const e=G.value.findIndex(e=>e.equal(J.value));if(e>0){const l=G.value[e-1];G.value[e-1]=G.value[e],G.value[e]=l}}function onClickMoveColorForward(){if(!J.value)return;const e=G.value.findIndex(e=>e.equal(J.value));if(e<G.value.length-1){const l=G.value[e+1];G.value[e+1]=G.value[e],G.value[e]=l}}function onClickAddPalette(){Y.value=[...Y.value,new A({name:"New Palette",colors:[]})],R.value=Y.value[Y.value.length-1]}function onClickDeletePalette(){if(!R.value)return;const e=Y.value.findIndex(e=>e.id===R.value.id);-1!==e&&(Y.value.splice(e,1),R.value=void 0),R.value=Y.value[Math.max(e-1,0)]}async function onClickRenamePalette(){var e;if(R.value){const l=null==(e=await O.model.actions.prompt({text:"Rename Palette",type:"text",value:R.value.name||""}))?void 0:e.value;R.value.name=l,saveColorPalette()}}function onClickAddColor(){G.value.push(new E),J.value=G.value[G.value.length-1]}function onClickDeleteColor(){if(!J.value)return;const e=G.value.findIndex(e=>e.equal(J.value));-1!==e&&(G.value.splice(e,1),J.value=void 0),J.value=G.value[Math.max(e-1,0)]}async function onUploadImport(e){if(e&&e[0]){const l=new A(JSON.parse(await e[0].text()));Y.value.find(({id:e})=>l.id===e)?Y.value=Y.value.map(e=>e.id===l.id?l:e):Y.value=[...Y.value,l]}}async function onClickExport(){const e=await k(()=>import("./DrLItpjK.js").then(e=>e.F),__vite__mapDeps([0,1]),import.meta.url).then(e=>e.default);try{await e.saveAs(new Blob([JSON.stringify(R.value)]),Date.now()+"-palette.json")}catch(l){console.error("An error occurred during export.",l)}}async function onClickGetPaletteFromImage(){var e;const{payload:l}=await O.model.app.actions.getColors();l.colors.length>1e3&&console.warn("Palette must not exceed 100 colors."),(null==(e=R.value)?void 0:e.colors)&&(R.value.colors=l.colors.slice(0,1e3).map(e=>new E({color:e})))}function onClickApply(){R.value&&O.model.app.setColorPalette(R.value)}return t(()=>{R.value=h(I.WIN_256),Q.add(B.keyDown.pipe(F(e=>e.key===T.BACKSPACE)).subscribe(()=>{onClickDeleteColor()}))}),n(()=>{Q.unsubscribe()}),(e,l)=>(u(),s(P,{class:"wb-disks-extras13-web-paint-color-palette"},{default:i(()=>{var e;return[r("div",M,[r("ul",{ref_key:"itemsEl",ref:K},[(u(!0),c(v,null,p(G.value,e=>(u(),c("li",{key:e.id},[r("input",{id:e.id,type:"radio",name:`${m(j)}-palette-color`,value:e.id,checked:e.equal(J.value),onInput:l=>J.value=e},null,40,N),r("label",{for:e.id},[(u(),s(W,{key:e.color.toHex(),selected:e.equal(J.value),readonly:!e.equal(J.value),embed:"","model-value":e.color,"onUpdate:modelValue":l=>function onUpdateModelValue(e,l){l.setColor(e),saveColorPalette()}(l,e)},null,8,["selected","readonly","model-value","onUpdate:modelValue"]))],8,S)]))),128))],512)]),r("div",q,[r("span",L,"Total: "+b(G.value.flat().length),1),r("span",V,b(null==(e=J.value)?void 0:e.color.toHex()),1)]),d(g,y(f($.value)),null,16),d(w,null,{default:i(()=>{var e,l,a,o;return[d(_,{disabled:null==(e=R.value)?void 0:e.locked,type:"button","style-type":"secondary",label:"Add",onClick:onClickAddColor},null,8,["disabled"]),d(_,{disabled:null==(l=R.value)?void 0:l.locked,type:"button","style-type":"secondary",label:"Del",onClick:onClickDeleteColor},null,8,["disabled"]),d(_,{disabled:null==(a=R.value)?void 0:a.locked,type:"button","style-type":"secondary",label:"<",onClick:onClickMoveColorBackward},null,8,["disabled"]),d(_,{disabled:null==(o=R.value)?void 0:o.locked,type:"button","style-type":"secondary",label:">",onClick:onClickMoveColorForward},null,8,["disabled"])]}),_:1}),d(w,null,{default:i(()=>{var e,l;return[d(g,C({disabled:null==(e=R.value)?void 0:e.locked},X.value),null,16,["disabled"]),d(_,{style:{flex:"0"},type:"button","style-type":"secondary",label:"Colors From Image",disabled:null==(l=R.value)?void 0:l.locked,onClick:onClickGetPaletteFromImage},null,8,["disabled"])]}),_:1}),d(w,null,{default:i(()=>{var e,l;return[d(_,{type:"button","style-type":"secondary",label:"Add Palette",onClick:onClickAddPalette}),d(_,{disabled:null==(e=R.value)?void 0:e.locked,type:"button","style-type":"secondary",label:"Del Palette",onClick:onClickDeletePalette},null,8,["disabled"]),d(_,{disabled:null==(l=R.value)?void 0:l.locked,type:"button","style-type":"secondary",label:"Rename Palette",onClick:onClickRenamePalette},null,8,["disabled"])]}),_:1}),d(w,null,{default:i(()=>[d(_,{type:"upload","style-type":"secondary",label:"Import",onUpload:onUploadImport}),d(_,{type:"button","style-type":"secondary",label:"Export",onClick:onClickExport}),d(_,{disabled:!R.value,type:"button","style-type":"secondary",label:"Apply Palette",onClick:onClickApply},null,8,["disabled"])]),_:1})]}),_:1}))}}),[["__scopeId","data-v-33138c09"]]);export{R as default};
