import{G as H,H as L,J as w,S as T,b as d,j as g,f as v,t as y,k as M}from"./index.0ea94ad0.js";import{_,k as u,l as o,m as i,N as f,C as h,P as k,a3 as b,L as C}from"./entry.80972074.js";import{a as E}from"./async.0f707439.js";function K(l,t){return t===void 0&&(t=E),H(function(r,c){var n=null,e=null,s=null,m=function(){if(n){n.unsubscribe(),n=null;var a=e;e=null,c.next(a)}};function S(){var a=s+l,p=t.now();if(p<a){n=this.schedule(void 0,a-p),c.add(n);return}m()}r.subscribe(L(c,function(a){e=a,s=t.now(),n||(n=t.schedule(S,l),c.add(n))},function(){m(),c.complete()},void 0,function(){e=n=null}))})}const I={props:{rootElement:{type:HTMLElement,default(){return null}},options:{type:Object,default(){return{focused:!1}}},readonly:{type:Boolean,required:!1,default:!1},multiline:{type:Boolean,required:!1,default:!0},name:{type:String,default:"value"},model:{type:Object,required:!1,default(){return{value:"Input Value"}}}},emits:["input","refresh","keydown","keyup","enter"],data(){return{escapeHtml:w,selectionLength:null,selectionStart:null,selectionEnd:null,controlShiftActive:!1,controlCapsLockActive:!1,focusedSubscriptions:new T,refreshFrame:null}},computed:{focused(){return this.options.focused},value:{get(){return this.model[this.name]},set(l){this.model[this.name]=l}},styleClasses(){return{readonly:this.readonly,multiline:this.multiline,"selection-empty":!this.selectionLength,focused:this.focused,"shift-active":this.controlShiftActive,"caps-lock-active":this.controlCapsLockActive}}},watch:{focused(l){l?(this.focusedSubscriptions.add(d.get("click").pipe(g(({target:t})=>!M(t,this.rootElement||this.$parent.$el)),v()).subscribe(this.blur.bind(this)),d.get("keypress").subscribe(function(){this.$refs.input.focus()}.bind(this)),d.get("keydown").subscribe(({keyCode:t})=>{switch(t){case 16:this.controlShiftActive=!0;break;case 20:this.controlCapsLockActive=!this.controlCapsLockActive;break}}),d.get("keyup").subscribe(({keyCode:t})=>{switch(t){case 16:this.controlShiftActive=!1;break}this.$emit("keyup",t)})),this.$refs.input.focus()):(this.focusedSubscriptions.unsubscribe(),this.$refs.input.blur())}},unmounted(){window.cancelAnimationFrame(this.refreshFrame),this.focusedSubscriptions.unsubscribe()},mounted(){this.$refs.input.setSelectionRange(this.value.length,this.value.length),this.refresh(),this.focused&&this.$refs.input.focus()},methods:{focus(){this.setFocus(!0)},blur(){this.setFocus(!1)},resetSelection(){const l=this.$refs.input;this.selectionStart=l.selectionStart=0,this.selectionEnd=l.selectionEnd=0,this.selectionLength=0},refresh(){const l=this.$refs.input;this.selectionStart=l.selectionStart,this.selectionEnd=l.selectionEnd,this.selectionLength=this.selectionEnd-this.selectionStart,this.$emit("refresh")},setFocus(l){this.options.focused=l},onPointerDown(l){const t=d.pointerMove.pipe(K(128)).subscribe(r=>{y(r),this.refresh()});d.pointerUp.pipe(v()).subscribe(r=>{y(r),t.unsubscribe()})},onInput(){this.refresh(),this.$emit("input")},onClick(){this.focused?this.refresh():this.setFocus(!0)},onKeydown(l){!this.multiline&&l.keyCode===13?(l.preventDefault(),l.stopPropagation(),this.$emit("enter",this.model[this.name]),this.refresh()):(this.$emit("keydown",l),this.refresh())},onKeyup(l){this.$emit("keyup",l.keyCode),this.refresh()}}},x={class:"result"},A=["innerHTML"],F=["innerHTML"],P=["innerHTML"],D=["innerHTML"],V=["innerHTML"],B=["innerHTML"],j=["innerHTML"],q=["innerHTML"],N={key:1,class:"selected"},O=["innerHTML"],U=["innerHTML"],z={class:"input"},G=["readonly"],J=["readonly"];function R(l,t,r,c,n,e){return u(),o("div",{class:C(["wb-env-atom-input-text",e.styleClasses])},[i("div",null,[i("div",x,[e.value.length>0&&n.selectionEnd>0?(u(),o(f,{key:0},[n.selectionStart>=0&&n.selectionEnd===e.value.length?(u(),o(f,{key:0},[i("span",{innerHTML:n.escapeHtml(e.value.slice(0,n.selectionStart))},null,8,A),i("span",{class:"selected",innerHTML:n.escapeHtml(e.value.slice(n.selectionStart,n.selectionEnd+1))||" "},null,8,F)],64)):n.selectionStart&&n.selectionStart===n.selectionEnd?(u(),o(f,{key:1},[i("span",{innerHTML:n.escapeHtml(e.value.slice(0,n.selectionStart))},null,8,P),i("span",{class:"selected",innerHTML:n.escapeHtml(e.value.slice(n.selectionStart,n.selectionStart+1))||" "},null,8,D),i("span",{innerHTML:n.escapeHtml(e.value.slice(n.selectionStart+1,e.value.length))},null,8,V)],64)):(u(),o(f,{key:2},[i("span",{innerHTML:n.escapeHtml(e.value.slice(0,n.selectionStart))},null,8,B),i("span",{class:"selected",innerHTML:n.escapeHtml(e.value.slice(n.selectionStart,n.selectionEnd))},null,8,j),i("span",{innerHTML:n.escapeHtml(e.value.slice(n.selectionEnd,e.value.length))},null,8,q)],64))],64)):h("",!0),!n.selectionStart&&e.value===""?(u(),o("span",N," ")):e.value.length>0&&!n.selectionStart&&n.selectionStart===n.selectionEnd?(u(),o(f,{key:2},[i("span",{class:"selected",innerHTML:n.escapeHtml(e.value.slice(0,1))},null,8,O),i("span",{innerHTML:n.escapeHtml(e.value.slice(1,e.value.length))},null,8,U)],64)):h("",!0)]),i("div",z,[r.multiline?k((u(),o("textarea",{key:0,ref:"input","onUpdate:modelValue":t[0]||(t[0]=s=>e.value=s),readonly:r.readonly,onPointerdown:t[1]||(t[1]=(...s)=>e.onPointerDown&&e.onPointerDown(...s)),onInput:t[2]||(t[2]=(...s)=>e.onInput&&e.onInput(...s)),onClick:t[3]||(t[3]=(...s)=>e.onClick&&e.onClick(...s)),onKeydown:t[4]||(t[4]=(...s)=>e.onKeydown&&e.onKeydown(...s)),onKeyup:t[5]||(t[5]=(...s)=>e.onKeyup&&e.onKeyup(...s)),onFocus:t[6]||(t[6]=(...s)=>e.onClick&&e.onClick(...s))},null,40,G)),[[b,e.value]]):h("",!0),r.multiline?h("",!0):k((u(),o("input",{key:1,ref:"input","onUpdate:modelValue":t[7]||(t[7]=s=>e.value=s),type:"text",readonly:r.readonly,onPointerdown:t[8]||(t[8]=(...s)=>e.onPointerDown&&e.onPointerDown(...s)),onInput:t[9]||(t[9]=(...s)=>e.onInput&&e.onInput(...s)),onClick:t[10]||(t[10]=(...s)=>e.onClick&&e.onClick(...s)),onKeydown:t[11]||(t[11]=(...s)=>e.onKeydown&&e.onKeydown(...s)),onKeyup:t[12]||(t[12]=(...s)=>e.onKeyup&&e.onKeyup(...s)),onFocus:t[13]||(t[13]=(...s)=>e.onClick&&e.onClick(...s))},null,40,J)),[[b,e.value]])])])],2)}const Y=_(I,[["render",R],["__scopeId","data-v-0779cc2c"]]);export{Y as A};
