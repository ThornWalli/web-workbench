const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./PS5SoCZn.js","./Cd9UeY_V.js","./BJiuxSj1.js","./2o4skMhU.js","./AyGIKDDV.js"])))=>i.map(i=>d[i]);
var Ce=Object.defineProperty;var De=(u,n,s)=>n in u?Ce(u,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[n]=s;var N=(u,n,s)=>De(u,typeof n!="symbol"?n+"":n,s);import{M as Re}from"./viZ09Zwr.js";import{a as T,b as ne,D as se,T as Z,F as Ae,R as Ne,c as Oe}from"./BTKCLhcY.js";import{i as xe}from"./2o4skMhU.js";import{d as ce,A as f,T as q}from"./CiKic5u-.js";import{s as j,f as Me,b as ie}from"./BZctIkfj.js";import{W as ee}from"./DqSaF2M6.js";import{W as C}from"./CNA4gcoN.js";import{W as J}from"./Dnf49bBg.js";import{W as Pe}from"./BuycF2Vh.js";import{e as Ve,q as We,u as Te,y as Ue,I as h,S as Q,F as Ye,h as v,g as ge,w as he}from"./DhoRlVJU.js";import{d as z,j as w,r as D,I as E,$ as Be,o as me,a0 as ze,t as $,v as k,x as F,z as b,M as P,aa as V,A as O,C as Y,F as R,_ as X,J as U,D as oe,Y as le,Z as re,y as de,a8 as Xe,T as we,H as te}from"./JDFt9gvC.js";import{W as B}from"./DdPQDu4V.js";import{u as ue}from"./Coby9kZn.js";import{u as pe,d as He,M as K}from"./DDYNGWqS.js";import{A as Ge}from"./D5ZRmSpd.js";import{C as je}from"./ey0azPGz.js";import{a as $e}from"./C5mdboMC.js";import{W as Ee}from"./BLa7cp7S.js";import{a as be}from"./Cxo2HVeK.js";import{S as Je,C as Ze}from"./DSSEMlfr.js";import"./C6aID195.js";import"./Cpj98o6Y.js";import"./DRFQJhI_.js";import"./CNkvSXuu.js";import"./BY0KaPQX.js";import"./CGk7t0fz.js";import"./ChPn0pbG.js";import"./DlxYR4Yt.js";import"./CV0dHcg-.js";const Ke={class:"wb-module-files-atoms-file-select"},qe=z({__name:"FileSelect",props:{modelValue:{},fileSystem:{},fsItem:{},backLabel:{},upLabel:{},downLabel:{},maxVisibleItems:{}},emits:["update:model-value","select","refresh"],setup(u,{emit:n}){const s=n,a=u,e=w(()=>a.backLabel||"../"),t=w(()=>a.upLabel||"Up"),i=w(()=>a.downLabel||"Down"),l=w(()=>({title:"",items:c.value,modelValue:a.modelValue,"onUpdate:model-value":_=>{typeof _=="string"&&s("update:model-value",_)}})),o=w(()=>a.maxVisibleItems||5),m=D(a.fsItem||E(a.fileSystem.root)),p=D([]),g=D(0),r=w(()=>({back:!m.value.parent,up:g.value-1<0,down:g.value+1>p.value.length-o.value})),d=w(()=>a.modelValue),c=w(()=>{const _=p.value.slice(g.value,g.value+o.value).map(y=>({label:y.id,value:y.getPath()})).concat(Array(Math.max(o.value-p.value.length,0)).fill({label:"&nbsp;",disabled:!0}));return p.value.length<1&&(_[Math.floor(_.length/2)]={label:"Empty",disabled:!0}),_});Be(()=>d.value,async()=>{typeof a.modelValue=="string"&&(m.value=E(await a.fileSystem.get(a.modelValue)),m.value instanceof T&&(p.value=Array.from((await m.value.getItems()).values()).map(E),g.value=0),(m.value instanceof Ve||m.value instanceof T)&&s("select",m.value))}),me(async()=>{var _;p.value=Array.from((await((_=m.value)==null?void 0:_.getItems())||[]).values()).map(y=>E(y)),ze(()=>{s("refresh",{reset:!0,resize:!1,scroll:!1})})});const S=()=>{var y,L,I,A,M,fe;let _;if(!(m.value instanceof T)&&((L=(y=m.value)==null?void 0:y.parent)!=null&&L.parent)?_=(M=(A=(I=m.value)==null?void 0:I.parent)==null?void 0:A.parent)==null?void 0:M.getPath():m.value.parent&&(_=(fe=m.value.parent)==null?void 0:fe.getPath()),_)s("update:model-value",_);else throw new Error("No parent found")},x=()=>{g.value=Math.max(g.value-1,0)},W=()=>{g.value=Math.min(g.value+1,p.value.length-o.value)};return(_,y)=>(k(),$("div",Ke,[F("div",null,[b(Pe,P(V(l.value)),null,16)]),F("div",null,[b(J,{align:"outer",full:"",direction:"vertical"},{default:O(()=>[b(C,{"style-type":"secondary",label:e.value,disabled:r.value.back,onClick:S},null,8,["label","disabled"]),b(C,{"style-type":"secondary",label:t.value,disabled:r.value.up,onClick:x},null,8,["label","disabled"]),i.value?(k(),Y(C,{key:0,"style-type":"secondary",label:i.value,disabled:r.value.down,onClick:W},null,8,["label","disabled"])):R("",!0)]),_:1})])]))}}),Le=X(qe,[["__scopeId","data-v-9db94bb9"]]),Qe={class:"wb-module-files-save"},et=z({__name:"Save",props:{fsItem:{},id:{},model:{}},emits:["close"],setup(u,{emit:n}){var _,y,L;const{core:s}=ue();if(!((_=s.value)!=null&&_.modules.files))throw new Error("Files module not found");const a=u,e=n,t=D({...a.model}),i=((y=s.value)==null?void 0:y.modules.files)&&E((L=s.value)==null?void 0:L.modules.files),l={cancel:"Cancel",save:"Save"},o=w(()=>({label:null,placeholder:"Path…",modelValue:t.value.path})),m=w(()=>({label:null,placeholder:"Filename…",modelValue:t.value.filename,"onUpdate:model-value":I=>{t.value.filename=I}})),p=w(()=>({name:"path",modelValue:t.value.path,"onUpdate:model-value":I=>{t.value.path=I},onSelect:S})),g=D(a.fsItem||E(i.fs.root)),r=w(()=>{var I,A,M;return a.fsItem?a.fsItem:(A=(I=s.value)==null?void 0:I.modules.files)!=null&&A.fs.root?(M=s.value)==null?void 0:M.modules.files.fs.root:null}),d=w(()=>g.value?g.value.locked:!1),c=w(()=>!t.value.filename),S=I=>{g.value=E(I),I instanceof T?t.value.path=I.getPath():I.name&&(t.value.filename=I.name)};me(()=>{a.id&&(t.value.filename=a.id)});const x=()=>{e("close")},W=()=>{const I=We(t.value.path,t.value.filename);e("close",I)};return(I,A)=>(k(),$("div",Qe,[b(ee,{onSubmit:W},{default:O(()=>[b(B,U(o.value,{readonly:""}),null,16),b(Le,U(p.value,{"file-system":oe(i).fileSystem,"fs-item":r.value}),null,16,["file-system","fs-item"]),b(B,P(V(m.value)),null,16),b(J,{align:"outer",full:""},{default:O(()=>[b(C,{"style-type":"secondary",label:l.cancel,onClick:x},null,8,["label"]),b(C,{"style-type":"primary",label:l.save,type:"submit",disabled:d.value||c.value},null,8,["label","disabled"])]),_:1})]),_:1})]))}}),tt=X(et,[["__scopeId","data-v-c0f296dd"]]),at={class:"wb-module-files-open"},nt=z({__name:"Open",props:{fsItem:{},model:{}},emits:["close"],setup(u,{emit:n}){var S,x,W,_;const{core:s}=ue();if(!((S=s.value)!=null&&S.modules.files))throw new Error("Files module not found");pe();const a=u,e=n,t=D({...a.model,path:((x=a.model)==null?void 0:x.path)||a.fsItem.getPath()}),i={cancel:"Cancel",open:"Open"},l=w(()=>({label:null,placeholder:"Path…",modelValue:t.value.path})),o=w(()=>({name:"path",modelValue:t.value.path,"onUpdate:model-value":y=>{t.value.path=y},onSelect:r})),m=D(a.fsItem||((_=(W=s.value)==null?void 0:W.modules.files)==null?void 0:_.fs.root)),p=w(()=>m.value instanceof T),g=w(()=>{var y,L,I;return a.fsItem?a.fsItem:(L=(y=s.value)==null?void 0:y.modules.files)!=null&&L.fs.root?(I=s.value)==null?void 0:I.modules.files.fs.root:null}),r=y=>{m.value=E(y),y instanceof T&&(t.value.path=y.getPath())},d=()=>{e("close")},c=()=>{e("close",t.value.path)};return(y,L)=>(k(),$("div",at,[b(ee,{onSubmit:c},{default:O(()=>{var I,A,M;return[b(B,U(l.value,{readonly:""}),null,16),(A=(I=oe(s))==null?void 0:I.modules.files)!=null&&A.fileSystem?(k(),Y(Le,U({key:0},o.value,{"file-system":(M=oe(s))==null?void 0:M.modules.files.fileSystem,"fs-item":g.value}),null,16,["file-system","fs-item"])):R("",!0),b(J,{align:"outer",full:""},{default:O(()=>[b(C,{"style-type":"secondary",label:i.cancel,onClick:d},null,8,["label"]),b(C,{"style-type":"primary",label:i.open,type:"submit",disabled:p.value},null,8,["label","disabled"])]),_:1})]}),_:1})]))}}),st=X(nt,[["__scopeId","data-v-a4938b03"]]),it={class:"wb-module-files-preview"},ot={key:0,class:"basic"},lt=["innerHTML"],rt=["src"],dt=z({__name:"Preview",props:{type:{},content:{}},setup(u){const{core:n}=ue(),s=u;pe();const a=D([]);return me(()=>{s.type==="basic"&&window.requestAnimationFrame(()=>{var e,t;a.value=[],(t=(e=n.value)==null?void 0:e.modules.parser)==null||t.parseBasic(s.content,async(i,l)=>{var m;const o=await((m=n.value)==null?void 0:m.executeCommand(i,l));return l.message!==void 0&&a.value.push(Te(String(l.message))),o})})}),(e,t)=>(k(),$("div",it,[e.type==="basic"?(k(),$("ul",ot,[(k(!0),$(le,null,re(a.value,(i,l)=>(k(),$("li",{key:l},de(i),1))),128))])):R("",!0),e.type==="markdown"&&typeof e.content=="string"?(k(),Y(Ge,{key:1,content:e.content},null,8,["content"])):R("",!0),e.type==="html"?(k(),$("div",{key:2,innerHTML:e.content},null,8,lt)):R("",!0),e.type==="image"&&typeof e.content=="string"?(k(),$("img",{key:3,src:e.content},null,8,rt)):R("",!0)]))}}),ct=X(dt,[["__scopeId","data-v-0d9fb6ad"]]);async function mt(u,n,s){const a=await u.executeCommand(`exist "${n}"`);let e=!1;a&&(e=await u.executeCommand('openDialog "File exist, overwrite?" --confirm'));const t=[`makefile "${n}"`];return s&&t.push(`--data="${s}"`),e?t.push("--override"):t.push("--ignore"),u.executeCommand(t.join(" "))}async function ut(u,n){var e;const s=await((e=u.modules.files)==null?void 0:e.fs.get(n)),a=await u.executeCommand(`readfile "${n}"`);return{fsItem:s,value:a}}const pt=ce(({module:u,core:n})=>{const{fileSystem:s}=u;return[{name:"openPreview",args:[new f({index:0,name:"path",description:"Path to the file"}),new f({name:"maximized",description:"If set, window is maximized."})],async action({path:a,maximized:e}){var m,p;const t=await s.get(a),{type:i,content:l,openMaximized:o}=t.data;i==="basic"&&!t.data[je.HAS_WINDOW_OUTPUT]?await((m=n.modules.parser)==null?void 0:m.parseBasic(l,async(g,r)=>await n.executeCommand(g,r))):(p=n.modules.windows)==null||p.addWindow({component:ct,componentData:{type:i,content:l},options:{title:t.name,scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0},layout:{size:xe(420,360)}},{full:o||e||!1})}},{name:"saveFileDialog",args:[new f({index:0,name:"data",description:"File Content"}),new f({index:1,name:"id",description:"File Id"}),new f({index:2,name:"extension",description:"File Extension"})],async action({data:a,id:e,extension:t}){var l;const i=(l=n.modules.windows)==null?void 0:l.addWindow({component:tt,componentData:{fsItem:s.root&&E(s.root),id:e},options:{title:"Save File",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}});if(i){const{value:o}=await i.awaitClose();if(o){const m=Ue(o,t),p=await mt(n,m,a);if(p)return E(Xe(p))}}}},{name:"openFileDialog",args:[],async action(){var e;const a=(e=n.modules.windows)==null?void 0:e.addWindow({component:st,componentData:{fsItem:s.root&&E(s.root)},options:{title:"Open File",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}});if(a){const{value:t}=await a.awaitClose();return t&&ut(n,t)}}},{name:"fileinfo",description:"Get info from File or Directory",args:[new f({index:0,name:"path",description:"Path to the file"}),new f({index:1,name:"name",description:"Name from the Info"}),new f({index:2,name:["list","ls"],flag:!0,description:"List all Infos"})],async action({path:a,name:e,list:t},i){const l=await s.getItemMetaList(a);if(t){const o=new q;o.addColumns([{value:"Name",align:"left",minWidth:20},{value:"Value",align:"left",minWidth:20}]),o.addRows(l.map(({name:m,value:p})=>{let g=p;return Array.isArray(p)&&(g=p.join(" ")),[m,g]})),i.message([o])}else return l.find(o=>o.name===e)}},{name:["info","i"],args:[new f({index:0,name:"path",description:"Path to the file"})],async action({path:a},e){let t=s.root;a&&(t=await s.get(a)),t!=null&&t.parent&&(t=t.parent);const i=await(t==null?void 0:t.getItems()),l=new q;l.addColumns([{value:"Unit",align:"left",minWidth:8},{value:"Size",align:"right",minWidth:6},{value:"Used",align:"right",minWidth:6},{value:"Free",align:"right",minWidth:6},{value:"Full",minWidth:4},{value:"Errs",align:"center",minWidth:4},{value:"Status",align:"center",minWidth:10},{value:"Name",align:"right",minWidth:14}]);const o=Array.from((i==null?void 0:i.values())||[]).filter(p=>p instanceof ne);l.addRows(o.map(p=>{let g=0;return(p.size>0||p.maxSize>0)&&(g=p.size/p.maxSize*100),[`${p.id}:`,j(p.maxSize),j(p.size),j(p.maxSize-p.size),`${g}%`,"0",p.locked?"Read":"Read/Write",`${p.name||""}`]}));const m=["","Mounted disks:",l,"","Volumes available:"];o.forEach(p=>{m.push(`${p.name}: [Mounted]`)}),m.push(""),e.message(m)}},{name:["list","ls"],args:[new f({index:0,name:"path",description:"Path to the file"}),new f({name:"dir-size",flag:!0,description:"Show Directory Size."})],async action({path:a,dirSize:e},t){let i=s.currentItem;a&&(i=await s.get(a));const l=Array.from((await(i==null?void 0:i.getItems())||[]).values()),o=new q;o.addColumns([{value:"Name",align:"left",minWidth:26},{value:"Size",align:"right",minWidth:8},{value:"Access",align:"center",minWidth:12},{value:"Date / Time",align:"center",minWidth:18}]),o.addRows(l.reduce((g,r)=>{let d;r instanceof T&&!e?d="DIR":d=Me(j(r.size),8,!0,"0");const c=r.isLocked()?"Read":"Read/Write";return g.push([`${r.id}:`,d,c,r.createdDate?ie("D-mm-y H:I:S",r.createdDate):""]),g},[]));const m=l.reduce((g,r)=>(r instanceof se&&g++,g),0),p=l.reduce((g,r)=>(g+=r.size,g),0);return t.message([o,`${l.length} files - ${m} directories - ${p} blocks used`]),Promise.resolve()}}]}),ft={class:"wb-module-files-edit"},gt={class:"cols"},ht={class:"col-2"},wt={class:"col-2"},ve="Cancel",ye="Save",bt=z({__name:"Edit",props:{fsItem:{},model:{}},emits:["close"],setup(u,{emit:n}){const s=u,a=n,e=D({...s.model}),t=w(()=>({disabled:s.fsItem.locked,label:"Others",name:"",items:[{label:"Symbol Visible",name:h.VISIBLE},{label:"Ignore Symbol Rearrange ",name:h.IGNORE_SYMBOL_REARRANGE}],modelValue:e.value,"onUpdate:modelValue":r=>{e.value=r}})),i=w(()=>({disabled:s.fsItem.locked,label:"Window Settings",name:"",items:[{label:"Has Scale ?",name:h.WINDOW_SCALE},{label:"Has Scroll-X ?",name:h.WINDOW_SCROLL_X},{label:"Has Scroll-Y ?",name:h.WINDOW_SCROLL_Y},{label:"Is Full-Size ?",name:h.WINDOW_FULL_SIZE},{label:"Sort Symbols (Directory)",name:h.WINDOW_SYMBOL_REARRANGE},{label:"Has Sidebar?",name:h.WINDOW_SIDEBAR}],modelValue:e.value,"onUpdate:modelValue":r=>{e.value=r}})),l=w(()=>({disabled:s.fsItem.locked,label:"Symbol",name:"symbol",options:Object.keys(Q).map(r=>({title:$e(r),value:Q[r]})),modelValue:String(e.value.symbol),"onUpdate:modelValue":r=>{e.value.symbol=r}})),o=w(()=>({disabled:s.fsItem.locked,label:"Id",name:"id",modelValue:e.value.id,"onUpdate:modelValue":r=>{e.value.id=r}})),m=w(()=>({disabled:s.fsItem.locked,label:"Name",name:"name",modelValue:e.value.name,"onUpdate:modelValue":r=>{e.value.name=r}})),p=()=>{a("close")},g=async()=>{s.fsItem.locked||await s.model.actions.save(e.value,s.fsItem),a("close")};return(r,d)=>(k(),$("div",ft,[b(ee,{class:"form",onSubmit:g},{default:O(()=>[F("div",null,[b(B,P(V(o.value)),null,16),b(B,P(V(m.value)),null,16),b(Ee,P(V(l.value)),null,16),F("div",gt,[F("div",ht,[b(be,P(V(t.value)),null,16)]),F("div",wt,[b(be,P(V(i.value)),null,16)])])]),b(J,{align:"outer",full:""},{default:O(()=>[ve?(k(),Y(C,{key:0,"style-type":"secondary",label:ve,onClick:p})):R("",!0),ye?(k(),Y(C,{key:1,"style-type":"primary",label:ye,type:"submit"})):R("",!0)]),_:1})]),_:1})]))}}),vt=X(bt,[["__scopeId","data-v-85518eb7"]]),yt={class:"wb-module-files-web-link"},_e="Cancel",Ie="Save",_t=z({__name:"WebLink",props:{fsItem:{},model:{}},emits:["close"],setup(u,{emit:n}){const s=u,a=n,e=D((s.fsItem||{}).locked),t=D({...s.model}),i=w(()=>({disabled:e.value,placeholder:"Name",label:"Name"})),l=w(()=>({disabled:e.value,placeholder:"http://…",label:"Url"})),o=w(()=>({disabled:e.value,label:"Symbol",options:Object.keys(Q).map(r=>({title:$e(r),value:Q[r]}))})),m=w(()=>!t.value.name||!t.value.url||!t.value.symbol);function p(){a("close")}async function g(){await s.model.actions.save(t.value,s.fsItem)&&a("close")}return(r,d)=>(k(),$("div",yt,[b(ee,{onSubmit:g},{default:O(()=>[b(B,U(i.value,{modelValue:t.value.name,"onUpdate:modelValue":d[0]||(d[0]=c=>t.value.name=c)}),null,16,["modelValue"]),b(B,U(l.value,{modelValue:t.value.url,"onUpdate:modelValue":d[1]||(d[1]=c=>t.value.url=c),type:"url"}),null,16,["modelValue"]),b(Ee,U(o.value,{modelValue:t.value.symbol,"onUpdate:modelValue":d[2]||(d[2]=c=>t.value.symbol=c)}),null,16,["modelValue"]),b(J,{align:"outer",full:""},{default:O(()=>[_e?(k(),Y(C,{key:0,"style-type":"secondary",label:_e,onClick:p})):R("",!0),Ie?(k(),Y(C,{key:1,"style-type":"primary",label:Ie,type:"submit",disabled:m.value},null,8,["disabled"])):R("",!0)]),_:1})]),_:1})]))}}),Se=X(_t,[["__scopeId","data-v-badea87b"]]),It={class:"wb-module-files-info"},St=["innerHTML"],kt=["innerHTML"],xt=z({__name:"Info",props:{fsItem:{}},setup(u){const n=u;pe();const s=w(()=>n.fsItem?Array.from(n.fsItem.meta).map(([e,t])=>{if(typeof t=="object")try{t=JSON.stringify(t)}catch(i){console.error(i)}return{title:e,value:t}}):[]),a=w(()=>{const e=n.fsItem;return e?[{title:"Id",value:e.id},{title:"Name",value:e.name},{title:"Type",value:e.type},{title:"Path",value:e.getPath()},{title:"Size",value:j(e.size)},{title:"Locked",value:e.locked?"Yes":"No"},{title:"Created Date",value:`<nobr>${ie("H:I:S D.M.Y",e.createdDate)}</nobr>`},{title:"Modified Date",value:`<nobr>${ie("H:I:S D.M.Y",e.editedDate)}</nobr>`}]:[]});return(e,t)=>(k(),$("div",It,[F("table",null,[(k(!0),$(le,null,re(a.value,({title:i,value:l},o)=>(k(),$("tr",{key:o},[F("td",null,de(i)+":",1),F("td",{innerHTML:l},null,8,St)]))),128))]),F("fieldset",null,[t[0]||(t[0]=F("legend",null,"Meta:",-1)),F("table",null,[(k(!0),$(le,null,re(s.value,({title:i,value:l},o)=>(k(),$("tr",{key:o},[F("td",null,de(i)+":",1),F("td",{innerHTML:l},null,8,kt)]))),128))])])]))}}),Wt=X(xt,[["__scopeId","data-v-8c55d858"]]),$t=He(({core:u})=>{const n=u.modules.symbols||{},s=u.modules.windows||{},a=we({open:{disabled:!1},edit:{disabled:!1},duplicate:{disabled:!1},container:{disabled:!1},emptyTrashcan:{disabled:!1},discard:{disabled:!1},info:{disabled:!1},webLink:{disabled:!1},webLinkNew:{disabled:!1},webLinkEdit:{disabled:!1}});function e(){const r=n.getSelectedItems()||[],d=n.getPrimaryWrapper();a.info.disabled=r.length<1,a.open.disabled=r.length<1,a.edit.disabled=r.length<1||!!r.find(c=>(c==null?void 0:c.locked)||c instanceof Z),a.duplicate.disabled=r.length<1||!!r.find(({fsItem:c})=>(c==null?void 0:c.locked)||c instanceof Z||c instanceof ne),a.container.disabled=!a.open.disabled||d instanceof Ae&&d.fsItem&&(d.fsItem instanceof Ne||d.fsItem.locked)||!d,a.webLinkEdit.disabled=r.length<1||!!r.find(c=>{var S;return!((S=c==null?void 0:c.fsItem)!=null&&S.meta.get(h.WEB_URL))}),a.webLinkNew.disabled=a.container.disabled,a.webLink.disabled=a.webLinkNew.disabled&&a.webLinkEdit.disabled,a.emptyTrashcan.disabled=r.length<1||!!r.find(c=>!((c==null?void 0:c.fsItem)instanceof Z)),a.discard.disabled=r.length<1||!!r.find(({fsItem:c})=>(c==null?void 0:c.locked)||c instanceof Z||c instanceof ne)}return n.events.subscribe(()=>e()),e(),[{order:1,title:"File",items:[{title:"Open",options:a.open,action:t},{title:"Edit",options:a.edit,action:m},{type:K.SEPARATOR},{title:"Web Link",options:a.webLink,items:[{title:"New",options:a.webLinkNew,action:l},{title:"Edit",options:a.webLinkEdit,action:o}]},{type:K.SEPARATOR},{title:"Duplicate",options:a.duplicate,action(){const r=n.getSelectedItems()||[];return Promise.all(r.filter(d=>d.fsItem).map(async({fsItem:d})=>{const c=await(d==null?void 0:d.getPath());return u.executeCommand(`copy "${c}" "${c}" -ignore`)}))}},{title:"Make Dir",options:a.container,async action(){var d;const r=(d=n.getPrimaryWrapper())==null?void 0:d.fsItem;if(r){const c=We(await r.getPath(),"Directory");return console.log(`makedir "${c}" -ignore`),u.executeCommand(`makedir "${c}" -ignore`)}else throw new Error("No item found")}},{type:K.SEPARATOR},{title:"Discard",options:a.discard,action(){const r=n.getSelectedItems()||[];return Promise.all(r.filter(d=>d.fsItem).map(async({fsItem:d})=>{const c=await(d==null?void 0:d.getPath());return u.executeCommand(`remove "${c}" -r`)}))}},{title:"Empty Trashcan",options:a.emptyTrashcan,action(){const r=n.getSelectedItems()||[];return Promise.all(r.filter(d=>d.fsItem).map(async({fsItem:d})=>{const c=await(d==null?void 0:d.getItems())||[];return Promise.all(Array.from(c.values()).map(async S=>{const x=await S.getPath();return u.executeCommand(`remove "${x}" -r -ignore`)}))}))}},{type:K.SEPARATOR},{title:"Info",options:a.info,action(){(n.getSelectedItems()||[]).filter(d=>d.fsItem).forEach(d=>{if(d.fsItem)s.addWindow({component:Wt,componentData:{fsItem:E(d.fsItem)},layout:{size:xe(460,280)},options:{title:`Info File ${d.fsItem.name}`,scaleX:!0,scaleY:!0,prompt:!1,scrollX:!0,scrollY:!0}});else throw new Error(`Item has no fsItem. ${d.id}`)})}}]}];function t(){(n.getSelectedItems()||[]).filter(d=>d.fsItem).forEach(d=>{if(d.command){const c={showCommand:!1,show:!0};return u.executeCommand(d.command,c)}})}async function i({name:r,url:d,symbol:c},S){if(S||(S=await u.executeCommand(`saveFileDialog --id="${Ye(r)}"`)),S){const x=u.addExecution();try{const W=S.getPath();await u.executeCommand(`rename "${W}" "${r}" -n`),await u.executeCommand(`editfilemeta "${W}" "${h.WEB_URL}" "${d}"`),await u.executeCommand(`editfilemeta "${W}" "${h.SYMBOL}" "${c}"`)}catch(W){throw x(),W}return x(),!0}return!1}function l(){return s.addWindow({component:Se,componentData:{model:{actions:{save:i},name:null,url:null,symbol:"default"}},options:{title:"Make Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}function o(){n.getSelectedItems().filter(d=>d.fsItem).forEach(d=>{const c=d.fsItem;if(c)s.addWindow({component:Se,componentData:{fsItem:E(c),model:{actions:{save:i},name:c.name,url:c.meta.get(h.WEB_URL),symbol:c.meta.get(h.SYMBOL)}},options:{title:"Edit Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}});else throw new Error(`Item has no fsItem. ${d.id}`)})}function m(){n.getSelectedItems().filter(d=>d.fsItem).forEach(d=>{const c=d.fsItem;if(c){const S=we({actions:{save:g},id:c.id,name:c.name});[h.SYMBOL,h.VISIBLE,h.IGNORE_SYMBOL_REARRANGE,h.WINDOW_SCALE,h.WINDOW_SCROLL_X,h.WINDOW_SCROLL_Y,h.WINDOW_FULL_SIZE,h.WINDOW_SYMBOL_REARRANGE,h.WINDOW_SIDEBAR].forEach(x=>{S[x]=c.meta.has(x)?c.meta.get(x):!1}),s.addWindow({component:vt,componentData:{fsItem:E(c),model:S},options:{title:`Edit File ${c.name}`,prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}else throw new Error(`Item has no fsItem. ${d.id}`)})}function p(){return[h.SYMBOL,h.VISIBLE,h.IGNORE_SYMBOL_REARRANGE,h.WINDOW_SCALE,h.WINDOW_SCROLL_X,h.WINDOW_SCROLL_Y,h.WINDOW_FULL_SIZE,h.WINDOW_SYMBOL_REARRANGE,h.WINDOW_SIDEBAR]}async function g(r,d){const{id:c,name:S}=r,x=d.getPath();if(!c)throw new Error("Id is emoty!");let W;const _=u.addExecution();try{await Promise.all(p().map(y=>{let L=r[y];return typeof L=="string"&&(L=`"${L}"`),u.executeCommand(`editfilemeta "${x}" "${y}" ${L}`)})),S&&c!==S?await u.executeCommand(`rename "${x}" "${S}" -n`):W=u.executeCommand(`rename "${x}" "${c}" -rn`),W=u.executeCommand(`rename "${x}" "${c}"`)}catch(y){throw _(),y}return _(),W}}),Et=ce(({module:u})=>{const{fileSystem:n,core:s,disks:a}=u;return[{name:["mountDisk"],description:"Mount Disk",args:[new f({index:0,name:"id",description:"Disk ID"})],async action({id:e},t){const i=s.addExecution(),l=await a[e]();try{const o=await n.addFloppyDisk(()=>l({core:s}));t.message(`Mount Disk <strong>${o.name}</strong> <strong>(${o.id})</strong> successful!`),i()}catch(o){throw console.error(o),v.get("cant_find_disk",e)}}},{name:["changeDirectory","cd"],description:"cd %path%",args:[new f({index:0,name:"path",description:"Directory path"})],async action({path:e}){if(!e)throw v.get("bad_args");try{await n.changeDirectory(e)}catch(t){throw console.error(t),v.get("cant_find",e)}}},{name:["exist"],description:"Check if file exists.",args:[new f({index:0,name:"path",description:"Filename"})],async action({path:e},t){if(!e)throw v.get("bad_args");const i=ge(e),l=await n.exist(e);return l?t.message(`File ${i} exists`):t.message(`File ${i} does not exist`),l}},{name:["makedir","mkdir"],args:[new f({index:0,name:"path",description:"Filename"}),new f({index:1,name:"name",description:"Name"}),new f({name:"ignore",flag:!0,description:"Ignore file exist."})],async action({path:e,name:t,ignore:i},l){if(!e)throw v.get("bad_args");const o=await n.makedir(e,t||ge(e),{override:i});return l.message(`Directory "${o.name}" created`),o}},{name:["remove","rm"],args:[new f({index:0,name:"path",description:"Filename"}),new f({name:["recursive","r"],flag:!0,description:"Remove Directory Items and Directories."}),new f({name:["ignore"],flag:!0,description:"Ignore the specified file is deleted."})],async action({path:e,recursive:t,ignore:i},l){if(!e)throw v.get("bad_args");return(await n.remove(e,t,{ignore:i})||[]).map(m=>{const p=m.type===se.TYPE?"Directory":"File";return l.message(`Removed ${p}: ${m.name}`),m})}},{name:["readfile","getfile"],description:"Get file content",args:[new f({index:0,name:"path",description:"Filename"})],async action({path:e}){if(!e)throw v.get("bad_args");return(await n.get(e)).data}},{name:["makefile","mkfile"],description:"Creates a file with the specified attributes.",args:[new f({index:0,name:"path",description:"Filename"}),new f({index:1,name:"name",description:"Name"}),new f({index:3,name:"data",description:"Data"}),new f({name:"override",flag:!0,description:"Deletes existing file and recreates."})],async action({path:e,name:t,data:i,override:l=!1},o){if(!e)throw v.get("bad_args");typeof i=="string"&&(i=he(i));const m=await n.makefile(e,t,i,{override:l||!1,meta:[]});return o.message(`File "${m.name}" created`),m}},{name:["editfile"],description:"Edits file with specified attributes.",args:[new f({index:0,name:"path",description:"Filename"}),new f({index:1,name:"data",description:"Data"})],async action({path:e,data:t},i){if(!e)throw v.get("bad_args");typeof t=="string"&&(t=he(t));const l=await n.editfile(e,t);return i.message(`File "${l.name}" edited`),l}},{name:["editfilemeta"],description:"Edits file with specified attributes.",args:[new f({index:0,name:"path",description:"Filename"}),new f({index:1,name:"name",description:"Name"}),new f({index:2,name:"value",description:"Value"})],async action({path:e,name:t,value:i},l){if(!e)throw v.get("bad_args");const o=await n.editfileMeta(e,t,i);return l.message(`File  "${o.name}" Meta edited`),o}},{name:["makelink","mklink"],description:"Creates a link to the specified path.",args:[new f({index:0,name:"ref",description:"Reference path with id (example.ext)."}),new f({index:1,name:"name",description:"Displayed Name"}),new f({index:2,name:"dest",description:"Destination directory."})],async action({ref:e,name:t,dest:i},l){if(!e)throw v.get("bad_args");i=i||".";const o=await n.get(e),m=await n.makelink(o,t);return await n.get(i)!==n.currentItem&&await n.move(m,i,{override:!0}),l.message(`Created link "${t}" with "${await o.getPath()}"`),m}},{name:["editlink"],description:"",args:[new f({index:0,name:"path",description:"Reference filepath with id (example.ext)."}),new f({index:1,name:"ref",description:"Destination directory."})],async action({path:e,ref:t},i){if(!(e&&t))throw v.get("bad_args");const l=await n.get(t),o=await n.editlink(e,l);return i.message(`Edited link "${name}" with "${await l.getPath()}"`),o}},{name:"rename",description:"Renamed a file",args:[new f({index:0,name:"path",description:"Filepath with id (example.ext)."}),new f({index:1,name:"value",description:"Value for id or displayed name."}),new f({name:["name","n"],flag:!0,description:"When set, changes the display name."}),new f({name:["removeName","rn"],flag:!0,description:"When set, removes the display name."})],async action({path:e,value:t,name:i,removeName:l},o){if(!l&&(!e||!t))throw v.get("bad_args");const m=await n.get(e),p=i?m.name:m.id;return await n.rename(e,t,{name:i,removeName:l}),o.message(`Renamed from "${p}" to "${t}"`),m}},{name:["cp","copy"],args:[new f({index:0,name:"from",description:"Source Filepath with id (example.ext)."}),new f({index:1,name:"dest",description:"Destination Filepath with id (example.ext)."}),new f({name:["ignore","i"],flag:!0,description:"When sets, creates a new file if exists."})],async action({from:e,dest:t,ignore:i},l){let o=t;if(!o&&i&&(o=e),!o||!e)throw v.get("bad_args");const m=await n.copy(e,o,{ignore:i});return l.message(`Copied from "${e}" to "${o}"`),m}},{name:["mv","move"],description:"move %from% %to%",args:[new f({index:0,name:"from",description:"From path"}),new f({index:1,name:"to",description:"To path"}),new f({index:2,name:"item-position",description:"Sets the position in the Icon view. (x,y)"})],async action({from:e,to:t,itemPosition:i},l){if(!t||!e)throw v.get("bad_args");const o=await n.move(e,t);i&&o.meta.set(h.POSITION,[0,0].map((p,g)=>{const r=i.split(",");return parseInt(r[Number(g)]||"0")})),o.save();let m;return o instanceof se?m="Directory":m="File",l.message(`${m} moved ${o.name}`),o}},{name:["executeFile"],description:"Execute file.",args:[new f({index:0,name:"path",description:"Path to the file"})],async action({path:e}){if(!e)throw v.get("bad_args");const t=await n.get(e);if(typeof t.action=="function")return t.action(s);throw v.get("cant_find_action",e)}}]});v.add("cant_find_action","Can't find action %1");v.add("cant_find_disk","Can't find disk %1");const Lt=new class{constructor(){N(this,"firebase",null)}get(){return this.firebase||(this.firebase=this.getImports())}getImports(){return Promise.all([te(()=>import("./PS5SoCZn.js"),__vite__mapDeps([0,1]),import.meta.url).then(n=>n.default||n),te(()=>import("./BJiuxSj1.js"),__vite__mapDeps([2,1,3]),import.meta.url).then(n=>n.default||n),te(()=>import("./AyGIKDDV.js"),__vite__mapDeps([4,1]),import.meta.url).then(n=>n.default||n)]).then(([n,s,a])=>({app:n,auth:s,database:a}))}},ae=new Map;class Ft extends Je{constructor(){super(...arguments);N(this,"modules");N(this,"services");N(this,"app")}get name(){var s;return(s=this.app)==null?void 0:s.name}async connect(s,{apiKey:a,url:e}){if(this.modules=await Lt.get(),this.app)ae.has(s)&&(this.app=ae.get(s));else{const t=this.modules.app.initializeApp({apiKey:a,databaseURL:e},s);ae.set(t.name,t),this.app=t}return this.app}async disconnect(){var s;if(!this.app)throw v.get("FirebaseWrapper_noApp");H(this),await this.logout(),await((s=this.modules)==null?void 0:s.app.deleteApp(this.app)),this.app=void 0}get locked(){return!!this.app&&!this.isLogged()}get currentUser(){var s;if((s=this.modules)!=null&&s.auth){const{getAuth:a}=this.modules.auth;return a(this.app).currentUser}}isLogged(){return!!this.app&&!!this.currentUser}login(s,a){var e;if((e=this.modules)!=null&&e.auth){const{getAuth:t,signInWithEmailAndPassword:i}=this.modules.auth,l=t(this.app);return H(this),i(l,s,a)}}logout(){var s;if(this.app&&((s=this.modules)!=null&&s.auth)){const{getAuth:a,signOut:e}=this.modules.auth,t=a(this.app);return e(t)}else throw v.get("FirebaseWrapper_notConnected")}remove(s){var a;if(H(this),(a=this.modules)!=null&&a.database){const{remove:e,ref:t,getDatabase:i}=this.modules.database,l=i(this.app),o=t(l,s);return e(o)}}get(s){var a;if(H(this),(a=this.modules)!=null&&a.database){const{ref:e,onValue:t,getDatabase:i}=this.modules.database,l=i(this.app),o=e(l,s);return new Promise(m=>{t(o,p=>m(p.val()))})}}async set(s,a){var e;if(H(this),(e=this.modules)!=null&&e.database){const{ref:t,set:i,getDatabase:l}=this.modules.database,o=l(this.app),m=t(o,s);return await i(m,a),a}}}function H(u){if(!u.app)throw v.get("FirebaseWrapper_notConnected")}v.add([["FirebaseWrapper_notConnected",["Not connected","Not connected"]],["FirebaseWrapper_noApp",["No app available","No app available"]],["FirebaseWrapper_hasApp",["App already available",'App "%1" already available']]]);class Ct extends Ze{constructor(n){super({...n,storage:new Ft})}async mount(n){if(n.onDisconnect=()=>{this.unmount()},this.storage)return await this.storage.connect(n.id,{apiKey:n.apiKey,url:n.url}),this;throw new Error("no storage")}async unmount(){if(this.storage)return await this.storage.disconnect(),this;throw new Error("no storage")}async load(){if(this.storage){let n=await this.storage.get(this.name);return n||(n={},this.storage.locked||await this.storage.set(this.name,n)),this.data=n,n}else throw new Error("no storage")}async save(n){if(this.storage)return n=Fe(n),this.data=n||this.data,await this.storage.set(this.name,n),this.data;throw new Error("no storage")}get locked(){var n;return((n=this.storage)==null?void 0:n.locked)||!1}}function Fe(u){return Object.fromEntries(Object.entries(u).filter(([,n])=>n).map(([n,s])=>(s&&typeof s=="object"&&(s=Fe(s)),[n,s])))}const G=new Map,Dt=ce(({module:u,core:n})=>{const{fileSystem:s}=u;return[{name:"cloudList",args:[new f({name:"json",flag:!0,description:"Get JSON Export"})],action({json:a},e){const t=Array.from(G.values());if(a)return Promise.resolve(t);{const i=new q;return i.addColumns([{value:"Storage (Id)",align:"left",minWidth:15},{value:"Name",align:"left",minWidth:15},{value:"Logged In",align:"center",minWidth:9}]),i.addRows(t.reduce((l,o)=>(l.push([o.id,o.name,o.storage.storage.isLogged()?"yes":"no"]),l),[])),e.message([i]),Promise.resolve()}}},{name:"cloudMount",args:[new f({index:0,name:"id",flag:!0,description:"Id from Storage."}),new f({index:1,name:"apiKey",description:"Firebase Api-Key."}),new f({index:2,name:"url",description:"Firebase Database-Url."})],async action({id:a,apiKey:e,url:t},i){if(!e||!t)throw v.get("bad_args");const l=n.addExecution(),o=await s.connect(Ct,{id:a,apiKey:e,url:t});return G.set(o.id,o),i.message(`Mount <strong>${o.name}</strong> <strong>(${o.id})</strong> successful!`),l(),o}},{name:"cloudUnmount",args:[new f({index:0,name:"id",flag:!0,description:"Id from Storage."})],async action({id:a},e){if(!a)throw v.get("bad_args");const t=n.addExecution();try{const i=G.get(a);await s.disconnect(i),G.delete(i.id),e.message(`Unmount "${i.name}" successful!`),t()}catch(i){throw t(),i}}},{name:"cloudAuth",args:[new f({name:"login",flag:!0,description:"Storage Login"}),new f({name:"logout",flag:!0,description:"Logout from Storage."}),new f({name:"email",description:"Email for Login."}),new f({name:"password",description:"Password for Login."}),new f({name:"storage",description:"Specifies which drive is logged on."})],async action({email:a,password:e,storage:t,login:i,logout:l},o){const m=t;if(!m)throw v.get("bad_args");const p=n.addExecution(),g=G.get(m);let r;if(g)try{if(i){if(!a||!e)throw v.get("bad_args");r=await g.storage.storage.login(a,e),o.message(`Login with ${g.id} (${g.id}) successful!`)}else l&&(r=await g.storage.storage.logout(),o.message(`Logout from ${g.id} (${g.id}) successful!`))}catch(d){if(p(),d instanceof Error&&"code"in d){switch(d.code){case"auth/user-not-found":case"auth/wrong-password":return d}throw d}}else throw new Error(`${m} is not mounted.`);return p(),r}}]}),ke=E(new Oe("web_workbench_FS"));class Rt extends Re{constructor({core:s}){super({name:"Files",commands:({module:a,core:e})=>[...pt({module:a,core:e}),...Et({module:a}),...Dt({module:a,core:e})],contextMenu:$t,core:s});N(this,"fileSystem",ke);N(this,"fs",ke);N(this,"disks",{})}async addDisks(s){Object.entries(s).forEach(([a,e])=>{this.disks[String(a)]=e})}}N(Rt,"NAME","Files");export{Rt as default,ke as fileSystem};
