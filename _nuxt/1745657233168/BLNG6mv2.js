var g=Object.defineProperty;var v=(i,e,s)=>e in i?g(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var p=(i,e,s)=>v(i,typeof e!="symbol"?e+"":e,s);import{i as l}from"./2o4skMhU.js";import{a as x,E as u,I as d}from"./DhoRlVJU.js";import{v as E}from"./C6aID195.js";import{f as y}from"./DNGU8wv-.js";import{T as z,I as c,a8 as R}from"./JDFt9gvC.js";import{F as b}from"./BTKCLhcY.js";const L=l(0,0);class h{constructor({sidebarComponent:e,sidebarComponentData:s,component:t,componentData:r,options:o,wrapper:a,layout:n,parentWindow:f}){p(this,"events",new x);p(this,"id",E());p(this,"component");p(this,"componentData");p(this,"sidebarComponent");p(this,"sidebarComponentData");p(this,"parentWindow");p(this,"options",z({title:"Unnamed",scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0,clampX:!0,clampY:!1,freeze:!1,focused:!1,center:!0,close:!0,overlay:!0,embed:!1,borderless:!1,hideRootHeader:!1,sidebar:!0,prompt:!1}));p(this,"group");p(this,"wrapper");p(this,"layout",z({focused:!1,position:l(0,0),size:L,scrollOffset:l(0,0),zIndex:0}));this.parentWindow=f,e&&(this.sidebarComponent=c(e)),s&&(this.sidebarComponentData=c(s)),t&&(this.component=c(t)),this.componentData={window:this,...r||{}},a&&(this.wrapper=c(a)),this.options=Object.assign(this.options,o),this.layout=Object.assign(this.layout,n)}setLayout(e){e.position&&(this.layout.position=l(e.position.x,e.position.y)),e.size&&(this.layout.size=l(e.size.x,e.size.y)),e.scrollOffset&&(this.layout.scrollOffset=l(e.scrollOffset.x,e.scrollOffset.y)),e.focused&&(this.layout.focused=e.focused)}ready(){this.options.ready=!0,this.events.next(new u({name:"ready"}))}focus(){this.options.focused=!0,this.events.next(new u({name:"focus"}))}unfocus(){this.options.focused=!1,this.events.next(new u({name:"unfocus"}))}close(e){this.wrapper&&(this.events.next(new u({name:"close",value:e})),this.wrapper.remove(this.id),this.wrapper=void 0)}setWrapper(e){this.wrapper=c(e)}setGroup(e){this.group=e}awaitClose(){return new Promise(e=>{const s=this.events.pipe(y(({name:t})=>t==="close")).subscribe(t=>{s.unsubscribe(),e(t)})})}awaitReady(){return new Promise(e=>{if(this.options.ready)e(this);else{const s=this.events.pipe(y(({name:t})=>t==="ready")).subscribe((...t)=>{s.unsubscribe(),e(...t)})}})}}const A=20;var M=(i=>(i[i.CENTER=0]="CENTER",i[i.ORDER_HORIZONTAL=1]="ORDER_HORIZONTAL",i[i.ORDER_VERTICAL=2]="ORDER_VERTICAL",i[i.ORDER_DIAGONAL_LEFT=3]="ORDER_DIAGONAL_LEFT",i[i.ORDER_DIAGONAL_RIGHT=4]="ORDER_DIAGONAL_RIGHT",i[i.SPLIT_HORIZONTAL=5]="SPLIT_HORIZONTAL",i[i.SPLIT_VERTICAL=6]="SPLIT_VERTICAL",i[i.FULL=7]="FULL",i))(M||{});class U{constructor(e,s=[]){p(this,"events",c(new x));p(this,"id",E());p(this,"core");p(this,"layout",{size:l(0,0),position:l(0,0)});p(this,"groups",new Map);p(this,"modelMap",new Map);p(this,"models",[]);p(this,"_activeWindow");this.core=e,s.forEach(t=>this.add(t))}setLayout(e){e.position&&(this.layout.position=l(e.position.x,e.position.y)),e.size&&(this.layout.size=l(e.size.x,e.size.y))}getActiveWindow(){return this.models.find(e=>e.options.focused)}setActiveWindow(e){this.models.forEach(s=>{s.options.focused=e===s.id,e===s.id&&(this._activeWindow=s,this.events.next(new u({name:"setActiveWindow",value:s})))})}hasEmbbedWindow(){return!!this.models.find(e=>e.options.embed)}isHeaderVsible(){return!this.models.find(e=>e.options.embed&&e.options.hideRootHeader)}add(e,s){const{full:t,maximize:r,active:o,group:a}={full:!1,maximize:!1,active:!0,group:null,...s||{}};let n;if(e instanceof h?n=e:n=new h(e),n.setWrapper(this),r?n.layout.size=l(this.layout.size.x,this.layout.size.y):t&&(n.layout.size=l(()=>l(this.layout.size.x,this.layout.size.y)+l(0,A))),a){let f;this.groups.has(a)?(f=this.groups.get(a),f.windows.push(n)):(f={primary:n,windows:[],name:a},this.groups.set(a,f)),n.setGroup(f)}return n.layout.zIndex=this.models.length,this.models.push(n),this.events.next(new u({name:"add",value:n})),this.modelMap.set(n.id,n),o&&this.setActiveWindow(n.id),n}remove(e){let s;e instanceof h?s=e:s=this.get(e),s!==void 0&&(s.group&&(s.group.primary===e?(s.group.windows.forEach(t=>t.close()),this.groups.delete(s.group.name)):s.group.primary.focus()),this.models.splice(this.models.indexOf(s),1),this.modelMap.delete(s.id))}get(e){return this.modelMap.get(e)}clear(){this.models=[].splice(0,this.models.length),this.modelMap.clear()}setWindowUpDown(e,s){const t=this.models,r=Array.from(t).filter(a=>!a.options.embed).sort((a,n)=>(a.layout.zIndex||0)-(n.layout.zIndex||0)).map(R),o=this.get(e);if(o){const a=r.indexOf(o),n=r[s?a-1:a+1];if(n){const f=o.layout.zIndex;o.layout.zIndex=n.layout.zIndex,n.layout.zIndex=f}}}centerWindow(e){let s;e instanceof h?s=e:s=this.get(e),s&&m(s,this.layout)}setWindowPositions(e,s=[],t){const{embed:r}={embed:!1,...t};switch(s.length<1&&s.push(...this.models),r||(s=s.filter(o=>!o.options.embed)),e){case 7:s.forEach(o=>{D(o,this.layout)});break;case 0:s.forEach(o=>{m(o,this.layout)});break;case 3:case 4:H(s,this.layout,e===4);break;case 5:case 6:w(s,this.layout,e===6);break}}saveSize(e,s){var r,o,a,n;const t=this.get(e);if(t&&(r=t.componentData)!=null&&r.symbolWrapper&&((o=t.componentData)==null?void 0:o.symbolWrapper)instanceof b){const f=(a=t.componentData)==null?void 0:a.symbolWrapper.fsItem;f&&(f.meta.set(d.WINDOW_SIZE,s),(n=this.core.modules.files)==null||n.fs.saveItem(f))}}savePosition(e,s){var r,o,a,n;const t=this.get(e);if(t&&(r=t.componentData)!=null&&r.symbolWrapper&&((o=t.componentData)==null?void 0:o.symbolWrapper)instanceof b){const f=(a=t.componentData)==null?void 0:a.symbolWrapper.fsItem;f&&(f.meta.set(d.WINDOW_POSITION,s),(n=this.core.modules.files)==null||n.fs.saveItem(f))}}}function D(i,e){i.layout.size=e.size}function m(i,e){i.layout.position=l(()=>(l(e.size.x,e.size.y)-l(i.layout.size.x,i.layout.size.y))/2)}function H(i,e,s){const t=1/i.length;i.forEach((r,o)=>{m(r,e),o=-Math.floor(i.length/2)+o;const a=l(r.layout.position.x+(s?-1:1)*(t*r.layout.size.x)*o,r.layout.position.y+t*r.layout.size.y*o),n=l(()=>l(e.size.x,e.size.y)-l(r.layout.size.x,r.layout.size.y));r.layout.position=l(()=>Math.max(Math.min(a,n),0))})}function w(i,e,s){let t;const r=i.length;s?(t=l(e.size.x,e.size.y/r),i.forEach((o,a)=>{o.layout.position=l(0,a*t.y),o.layout.size=t})):(t=l(e.size.x/r,e.size.y),i.forEach((o,a)=>{o.layout.position=l(a*t.x,0),o.layout.size=t}))}export{A as H,M as W,U as a,h as b};
