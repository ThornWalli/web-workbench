import{i as t,S as se,p as re}from"./2o4skMhU.js";import{S as ae,a as le,C as ne}from"./BTKCLhcY.js";import{n as ie,d as R}from"./Cdp1pQ9Q.js";import ue from"./DlgZJE6Q.js";import{u as ce}from"./Coby9kZn.js";import{f as pe}from"./CkllZCFh.js";import{d as J,r as b,T as me,j as i,$ as M,o as K,V as Q,t as H,v as g,W as ee,X as te,C as $,L as X,M as fe,aa as de,A as ve,F as ye,x as N,D as be,_ as oe,I as we,a0 as Z,Y as Se,Z as he}from"./JDFt9gvC.js";const Ie=["data-id"],ge={key:0},xe=["innerHTML"],ze=J({__name:"Item",props:{parentLayout:{type:Object,default(){return null}},clampGlobal:{type:Boolean,default:!1},container:{type:Boolean,default(){return!1}},item:{type:ae,default(){return{id:null,command:null,model:{title:"Item Title",url:null,symbol:ue,used:!1,visible:!0},layout:{position:t(0,0),size:t(50,50)}}}},scrollOffset:{type:Object,default(){return t(0,0)}},wrapper:{type:Object,default:null}},emits:["click"],setup(k,{emit:j}){var q,G;const s=k,{core:x}=ce(),O=j,o=b(s.wrapper.selectedItems),l=b(null),h=b(!1),u=me({start:t(0,0),move:t(0,0),lastPosition:t(0,0),offset:t(0,0),scrollOffset:t(0,0)}),B=new se,W=b(null),z=b(null),C=(q=x.value)==null?void 0:q.modules.screen,f=(G=x.value)==null?void 0:G.modules.symbols,F=i(()=>s.item.command),v=i(()=>s.item.id),c=i(()=>s.item.model),d=i(()=>s.item.layout),A=i(()=>c.value.url?"a":"span"),V=i(()=>c.value.url?{href:c.value.url,target:c.value.url?"_blank":null,title:c.value.title}:{}),_=i(()=>(C==null?void 0:C.contentLayout)||{position:t(0,0),size:t(0,0)}),L=i(()=>o.value.includes(v.value)),D=i(()=>({moving:h.value,selected:L.value,"symbol-used":c.value.used}));M(()=>c.value,()=>{e()},{deep:!0}),K(()=>{var r;z.value=(r=W.value)==null?void 0:r.parentElement,e()}),Q(()=>{B.unsubscribe(),s.wrapper.unselectItem(v)});function I(r){s.item.setLayout(r)}let E;function e(){I({size:t(200,200)}),window.cancelAnimationFrame(E),E=window.requestAnimationFrame(()=>{var a;const r=(a=W.value)==null?void 0:a.children[0];r&&r instanceof HTMLElement&&I({size:t(r.offsetWidth||0,r.offsetHeight||0)})})}function n(r){const{width:a,height:p,left:y,top:m}=r.getBoundingClientRect();return{position:t(y,m),size:t(a,p)}}function w(r){var p;r=ie(r);const a=v.value;if(!(c.value.url&&L.value)&&(r.preventDefault(),!c.value.used)){if(F.value&&L.value){const y={showCommand:!1,show:!0};return s.wrapper.unselectItem(a),c.value.used=!0,(p=x.value)==null?void 0:p.executeCommand(F.value,y).then(()=>c.value.used=!1)}R.shiftActive?s.wrapper.isSelectedItem(a)?s.wrapper.unselectItem(a):s.wrapper.selectItem(a):(f&&f.getSelectedItems().length>0&&f.clearSelectedItems(),s.wrapper.selectItem(a)),T(t(r.x,r.y)),O("click")}}function S(){if(f){const r=f.getSelectedItems().filter(p=>p.id!==v.value),a=s.wrapper.get(v.value);r.length>0&&a.fsItem instanceof le&&r.forEach(p=>s.wrapper.moveItemToItem(p.fsItem,a.fsItem))}}function T(r){if(z.value){const a=n(z.value);u.lastPosition=t(d.value.position.x,d.value.position.y),u.scrollOffset=t(s.scrollOffset.x,s.scrollOffset.y),u.start=r,u.offset=t(()=>u.start-d.value.position),P(r,a,!0),h.value=!0;let p=r;const y=R.pointerMove.subscribe(m=>{p=t(m.x,m.y),P(t(m.x,m.y),a,!0)});B.add(R.pointerUp.pipe(pe()).subscribe(()=>{if(y.unsubscribe(),f&&f.getSecondaryWrapper().id!==s.wrapper.id)return s.wrapper.moveItem(v.value,f.getSecondaryWrapper()).then(m=>{var U,Y;return m||I({position:t((U=u.lastPosition)==null?void 0:U.x,(Y=u.lastPosition)==null?void 0:Y.y)}),l.value=null,h.value=!1,m});if(h.value=!1,P(p,a),!d.value.position.equals(t(()=>u.start-u.offset)))return s.wrapper.savePosition(v.value,d.value.position)}))}}function P(r,a,p=!1){const y={min:t(0,0),max:t(()=>a.size-d.value.size)};u.move=t(()=>r-u.start);let m=t(()=>Math.round(u.start+u.move-u.offset));p?(y.min=a.position,y.max=t(()=>y.max+_.value.position),m=t(()=>Math.round(m+y.min)),s.clampGlobal?l.value=t(()=>Math.max(Math.min(m,_.value.position+s.wrapper.size-d.value.size),y.min)):l.value=m):(s.wrapper.root?I({position:t(()=>Math.max(Math.min(m,s.wrapper.size-d.value.size),0))}):I({position:t(()=>Math.max(m,0))}),l.value=null)}return(r,a)=>(g(),H("figure",{ref_key:"rootEl",ref:W,"data-id":v.value,class:te(["wb-env-atom-symbol-wrapper-item",D.value]),style:ee([d.value.size.toCSSVars("item-size"),(l.value||d.value.position).toCSSVars("item-position")]),"touch-action":"none",onPointerdown:w,onPointerup:S},[(g(),$(X(A.value),fe(de(V.value)),{default:ve(()=>{var p;return[c.value.symbol?(g(),H("i",ge,[(g(),$(X((p=be(f))==null?void 0:p.symbols.get(c.value.symbol))))])):ye("",!0),N("figcaption",{innerHTML:c.value.title},null,8,xe)]}),_:1},16))],46,Ie))}}),_e=oe(ze,[["__scopeId","data-v-54a9e1d0"]]),Pe=J({__name:"SymbolWrapper",props:{core:{type:Object,default:null},parentLayout:{type:Object,default(){return{size:t(window.innerWidth,window.innerHeight)}}},parentScrollable:{type:Boolean,default:!0},parentFocused:{type:Boolean,default:!1},clampSymbols:{type:Boolean,default:!1},wrapperId:{type:String,required:!0}},emits:["ready","refresh"],setup(k,{emit:j}){var E;const s=b(null),x=b(null),O=b(null),o=k,l=b((E=o.core.modules.symbols)==null?void 0:E.get(o.wrapperId)),h=j,u=i(()=>l.value.items.value),B=b(l.value.selectedItems),W=we(o.core.config.observable),z=i(()=>l.value.layout),C=i(()=>{var e;return{"parent-scrollable":o.parentScrollable,active:(((e=o.core.modules.symbols)==null?void 0:e.primaryWrapper)||{}).id===l.value.id}}),f=i(()=>o.parentLayout&&"scrollOffset"in o.parentLayout?o.parentLayout.scrollOffset:t(0,0)),F=i(()=>{const e=[f.value.toCSSVars("symbol-wrapper-scroll-offset")];return o.parentScrollable?e.push(v.value.toCSSVars("symbol-wrapper-size")):e.push(z.value.size.toCSSVars("symbol-wrapper-size")),e}),v=i(()=>u.value.map(e=>({item:e,index:B.value.indexOf(e.id)+1})).sort((e,n)=>e.index>n.index?1:e.index<n.index?-1:0).reduce((e,{item:n})=>{const w=n.layout.position.x+n.layout.size.x,S=n.layout.position.y+n.layout.size.y;return e.x=e.x<w?w:e.x,e.y=e.y<S?S:e.y,e},re(0,0))),c=i(()=>W[ne.SHOW_INVISIBLE_SYMBOLS]),d=i(()=>u.value.filter(L)),A=i(()=>(o.parentLayout||{}).size);M(()=>o.parentFocused,e=>{V(e)}),M(()=>o.wrapperId,e=>{var n;(n=o.core.modules.symbols)==null||n.get(e),_()}),M(()=>A,()=>{_()}),M(()=>v,()=>{Z(()=>{h("refresh",{scroll:!0})})}),K(()=>{Z(()=>{_(),V(o.parentFocused),h("ready")})}),Q(()=>{var e,n,w,S,T,P;(e=o.core.modules.symbols)!=null&&e.getPrimaryWrapper()&&((n=o.core.modules.symbols)==null?void 0:n.getPrimaryWrapper().id)===l.value.id&&((w=o.core.modules.symbols)==null||w.setPrimaryWrapper(null)),(S=o.core.modules.symbols)!=null&&S.getSecondaryWrapper()&&((T=o.core.modules.symbols)==null?void 0:T.getSecondaryWrapper().id)===l.value.id&&((P=o.core.modules.symbols)==null||P.setSecondaryWrapper(null))});function V(e=!1){o.core.modules.symbols&&(e?o.core.modules.symbols.setPrimaryWrapper(l.value):o.core.modules.symbols.getPrimaryWrapper()&&o.core.modules.symbols.getPrimaryWrapper().id===l.value.id&&o.core.modules.symbols.setPrimaryWrapper(null))}function _(){if(s.value){const{left:e,top:n}=s.value.getBoundingClientRect();l.value.setLayout({position:t(e,n),size:o.parentLayout.size}),l.value.setSize(t(s.value.offsetWidth,s.value.offsetHeight)),l.value.setParentSize(o.parentLayout.size)}}function L(e){return c.value||!c.value&&e.model.visible}function D(){var e;(e=o.core.modules.symbols)==null||e.setSecondaryWrapper(l.value)}function I(e){(e.target===x.value||e.target===O.value)&&l.value.clearSelectedItems()}return(e,n)=>(g(),H("div",{ref_key:"rootEl",ref:s,class:te(["wb-env-symbol-wrapper",C.value]),style:ee(F.value),onPointerdown:I,onPointermove:D},[N("div",{ref_key:"helperEl",ref:x,class:"helper"},null,512),N("div",{ref_key:"itemsEl",ref:O,class:"items"},[(g(!0),H(Se,null,he(d.value,(w,S)=>(g(),$(_e,{key:S,item:w,"clamp-global":k.clampSymbols,wrapper:l.value,"parent-layout":z.value,"scroll-offset":f.value},null,8,["item","clamp-global","wrapper","parent-layout","scroll-offset"]))),128))],512)],38))}}),Be=oe(Pe,[["__scopeId","data-v-0de2d623"]]);export{Be as W};
