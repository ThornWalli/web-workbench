const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DjuzsVuG.js","./Dz_GYwrf.js","./JDFt9gvC.js","./BZctIkfj.js","./Cdp1pQ9Q.js","./2o4skMhU.js","./C59C2sh_.js","./1qXVShGN.js","./CNtMeql4.js","./DNGU8wv-.js","./Cb3nzVUd.js","./DhoRlVJU.js","./CkllZCFh.js","./BmNMd0Sh.js","./SdfA2v9k.js","./CV0dHcg-.js","./m87iYVjZ.css","./DDYNGWqS.js","./C6aID195.js","./D5ZRmSpd.js","./BOXo5Fuj.css","./ey0azPGz.js","./BdxTbgrk.js","./BY0KaPQX.js","./C5mdboMC.js","./BLNG6mv2.js","./BTKCLhcY.js","./DSSEMlfr.js","./CpF9_xX9.js","./DlxYR4Yt.js","./BASt1W81.js","./FUWZzGg5.js","./cePB7ZwW.js","./BNsE65nd.css","./CuO0qJHa.js","./CBh-4V7U.css","./BcdXOdZr.js","./DFBIHTvk.js","./BXvnyj-V.js","./DqSaF2M6.js","./C3zvzGZe.css","./CNA4gcoN.js","./iKMg5t-_.css","./Dnf49bBg.js","./8q2Z1dNm.css","./DdPQDu4V.js","./DRFQJhI_.js","./x2UXwtQn.css","./Xth4XJGJ.css","./BDd3nL9Z.css","./BqDxP7KI.js","./SwcfTki6.css"])))=>i.map(i=>d[i]);
var bt=Object.defineProperty;var J=r=>{throw TypeError(r)};var gt=(r,t,e)=>t in r?bt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var p=(r,t,e)=>gt(r,typeof t!="symbol"?t+"":t,e),Q=(r,t,e)=>t.has(r)||J("Cannot "+e);var M=(r,t,e)=>(Q(r,t,"read from private field"),e?e.call(r):t.get(r)),tt=(r,t,e)=>t.has(r)?J("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),et=(r,t,e,s)=>(Q(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e);import{i as d,P as yt,S as lt,o as $,p as F}from"./2o4skMhU.js";import{I as b,S as y,a as ct,E as B}from"./DhoRlVJU.js";import{T as q,H as z,I as H}from"./JDFt9gvC.js";import{t as Tt}from"./BdxTbgrk.js";import{W as st}from"./BLNG6mv2.js";import{C as A}from"./ey0azPGz.js";import{c as rt,f as It}from"./DNGU8wv-.js";import{v as At}from"./CpF9_xX9.js";import{c as T}from"./BASt1W81.js";import{d as P}from"./Cdp1pQ9Q.js";import{a as Nt}from"./SdfA2v9k.js";import{o as vt}from"./CNtMeql4.js";import{i as Et}from"./1qXVShGN.js";import{t as Dt}from"./FUWZzGg5.js";import{v as Pt}from"./C6aID195.js";function xt(r,t){return vt(function(e,s){var i=t??{},a=i.leading,n=a===void 0?!0:a,o=i.trailing,u=o===void 0?!1:o,c=!1,m=null,l=null,h=!1,f=function(){l==null||l.unsubscribe(),l=null,u&&(D(),h&&s.complete())},N=function(){l=null,h&&s.complete()},C=function(I){return l=Et(r(I)).subscribe(rt(s,f,N))},D=function(){if(c){c=!1;var I=m;m=null,s.next(I),!h&&C(I)}};e.subscribe(rt(s,function(I){c=!0,m=I,!(l&&!l.closed)&&(n?D():C(I))},function(){h=!0,!(u&&c&&l&&!l.closed)&&s.complete()}))})}function St(r,t,e){t===void 0&&(t=Nt);var s=Dt(r,t);return xt(function(){return s},e)}function wt(r){const t=r.modules.windows||{},e=r.modules.screen||{};return async({modules:s},i)=>{var h;const a=r.addExecution();let n;const o=q({actions:{},value:it(),fsItem:void 0,output:[],openValue:void 0});if(i)if(n=await((h=s.files)==null?void 0:h.fs.get(i)),n&&"content"in n.data){const f={...n.data,content:[].concat(n.data.content).join(`
`)};o.fsItem=n,o.value=f}else throw new Error("Can't read file content");const[u,c]=await Promise.all([z(()=>import("./DjuzsVuG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]),import.meta.url).then(f=>f.default),z(()=>import("./CuO0qJHa.js"),__vite__mapDeps([34,17,18,2,5,11,22,23,24,25,9,8,26,27,21,28,29,15,30,4,6,7,10,14,31,32,35]),import.meta.url).then(f=>f.default)]),m=t.addWindow({component:u,componentData:{model:o,setValue:f=>o.value=f},options:{title:"WebBasic - Extras 1.3",scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0,center:!1,embed:!1,borderless:!0},layout:{size:d(540,360)}},{group:"extras13WebBasic"});Object.assign(o.actions,{close:()=>{m.close()},focus:()=>{m.focus()},reset:()=>{o.value=it(),o.fsItem=void 0,o.output=[],o.openValue=void 0}});let l;return o.actions.togglePreview=(f=!0)=>{f?(l=t.addWindow({component:c,componentData:{model:o},options:{title:"Preview - WebBasic - Extras 1.3",scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0,center:!1,close:!1,embed:!1,borderless:!0},layout:{size:d(540,360)}},{group:"extras13WebBasic",active:!1}),window.requestAnimationFrame(()=>{t.contentWrapper.setWindowPositions(st.SPLIT_HORIZONTAL,[m,l],{embed:!0})})):l&&(m.unfocus(),l.close(),window.requestAnimationFrame(()=>{t.contentWrapper.setWindowPositions(st.SPLIT_HORIZONTAL,[m],{embed:!0}),m.focus()}))},e.setTheme(Tt),new Promise(f=>{a(),m.events.pipe(It(({name:N})=>N==="close")).subscribe(()=>{l&&l.close(),e.setTheme(void 0),f(!0)})})}}const Ot={WEB_BASIC_SHOW_PREVIEW:"extras13_web_basic_show_preview"},Ct={[Ot.WEB_BASIC_SHOW_PREVIEW]:!0};var _=(r=>(r.CONTENT="content",r.OUTPUT_TYPE="type",r))(_||{});function it(){return{[A.HAS_WINDOW_OUTPUT]:!1,content:"",type:"basic"}}const Rt={meta:[[b.SYMBOL,y.DIRECTORY],[b.WINDOW_SIZE,d(380,200)],[b.WINDOW_SYMBOL_REARRANGE,!0]],id:"BasicDemos",name:"Basic Demos",createdDate:new Date(2017,7,5).getTime(),editedDate:new Date(2020,3,14).getTime(),items:[{meta:[[b.SYMBOL,y.BASIC]],id:"TEST.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:['PRINT USING "# #"; 1,2']}},{meta:[[b.SYMBOL,y.BASIC]],id:"FunctionTest.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:['PRINT USING "LEN(\\"ABC\\") #"; LEN("ABC")','PRINT USING "ASC(\\"D\\") ##"; ASC("D")','PRINT USING "CHR$(68) ##"; CHR$(68)','PRINT USING "LEFT$(\\"XYZ\\", LEN(\\"XYZ\\")-1) #"; LEFT$("XYZ", LEN("XYZ")-1)','PRINT USING "RIGHT$(\\"XYZ\\", LEN(\\"XYZ\\")-1) #"; RIGHT$("XYZ", LEN("XYZ")-1)']}},{meta:[[b.SYMBOL,y.BASIC]],id:"Fibonacci.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["CLS","READ max","DIM fib%(max)","LET fib(1) = 1","LET fib(2) = 2","FOR i=3 TO max","LET fib(i) = fib(i - 2) + fib(i -1)","NEXT i","FOR i=1 TO max","PRINT fib(i)","NEXT i","DATA 10","END"]}},{meta:[[b.SYMBOL,y.BASIC]],id:"Area.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["CLS","DIM w%,h%,a%","LET w%=12","LET h%=4","LET a%=w%*h%",'PRINT "With the width " + w%','PRINT " and the height " + h%','PRINT " you have the area " + a%']}},{meta:[[b.SYMBOL,y.BASIC]],id:"Circle.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["CLS","DIM r,a","LET r=5","READ pi","LET a=r*r*pi",'PRINT USING "With the radius ##.##"; r','PRINT USING "we have the area ##.##"; a',"DATA 3.14","END"]}},{meta:[[b.SYMBOL,y.BASIC]],id:"Your_Name.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["CLS",'PRINT "What is your name?"',"INPUT n$",'PRINT "What is your shoe size?"',"INPUT size",'PRINT "Hello "; n$','PRINT USING "your shoe size is ##.##"; size',"END"]}},{meta:[[b.SYMBOL,y.BASIC]],id:"GuessTheNumber.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["GuessTheNumber","CLS","READ max%","DIM number%, guess%, guesses%, message$",'LET message$ =  ""','PRINT "The number is between 1-1000."',"LET number% = INT(RND * max%) + 1","LET guess% = 1","LET guesses% = 0","WHILE guess%<>number%",'PRINT "Guess the number"',"PRINT message$","INPUT message$ guess%","IF (guess%<>number%) THEN","IF (guess%>number%) THEN",'LET message$ = "Your guess was too high"',"ELSE",'LET message$ =  "Your guess was too low"',"ENDIF","ENDIF","LET guesses% = guesses% + 1","WEND",'PRINT USING "You found the number in # tries"; guesses%',"DATA 1000","END"]}},{meta:[[b.SYMBOL,y.BASIC]],id:"Factorial.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["DIM result, n",'PRINT "Calculate the factorial of"',"INPUT n","LET result = 1","FOR i = n TO 1 STEP -1","LET result = result * i","NEXT i",'PRINT USING "#! = #"; n, result',"END"]}},{meta:[[b.SYMBOL,y.BASIC]],id:"Pyramid.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["CLS","DIM stars$",'PRINT "Enter the height of the pyramid"',"INPUT height",'LET stars$ = ""',"FOR i = 1 TO height",'LET stars$ = ""',"FOR j = 1 TO (i+i-1)",'LET stars$ = stars$ + "*"',"NEXT j","PRINT SPC(height - i) + stars","NEXT i","END"]}},{meta:[[b.SYMBOL,y.BASIC]],id:"Bubble_Sort.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["CLS","READ max","DIM SHARED numbers(max)","SUB CreateList(max) STATIC","FOR i=1 TO max","LET numbers(i) = INT(RND * 100)","NEXT i","END SUB","SUB PrintList(max) STATIC","FOR i=1 TO max","PRINT numbers(i)","NEXT i","END SUB","SUB SwapValues(i%, j%) STATIC","LET numbers(i%) = numbers(i%) XOR numbers(j%)","LET numbers(j%) = numbers(i%) XOR numbers(j%)","LET numbers(i%) = numbers(i%) XOR numbers(j%)","END SUB","SUB Sort(max) STATIC","FOR i%=1 TO (max - 1)","FOR j%=i% TO max","IF numbers(i%)>numbers(j%) THEN","CALL SwapValues(i, j)","END IF","NEXT j%","NEXT i%","END SUB","CreateList(max)","Sort(max)","PrintList(max)","DATA 10","END"]}},{meta:[[b.SYMBOL,y.BASIC]],id:"Goto.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:['PRINT "Step 1"','PRINT "Step 2"','PRINT "Step 3"',"GOTO ignore",'PRINT "Step 4"',"ignore:",'PRINT "Step 5"']}},{meta:[[b.SYMBOL,y.BASIC]],id:"Vars.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["DIM A, B","LET A = 2000",'LET B = "Hello World"','PRINT USING "A: #"; A','PRINT USING "B: #"; B']}},{meta:[[b.SYMBOL,y.BASIC]],id:"If.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["DIM A, B","LET A = 1","LET B = 2","IF A == B THEN",'PRINT "true"',"ELSE",'PRINT "false"',"END","IF (A < B) THEN",'PRINT "true"',"END"]}},{meta:[[b.SYMBOL,y.BASIC]],id:"For.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["DIM i%","FOR i% = 1 TO 5",'PRINT USING "For Number #"; i%',"NEXT i%"]}},{meta:[[b.SYMBOL,y.BASIC]],id:"For_Step.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["CLS","FOR i% = 0 TO 6 STEP 2",'PRINT "For Step Number #"; i%',"NEXT i%"]}},{meta:[[b.SYMBOL,y.BASIC]],id:"While.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["DIM i%","LET i%=0","WHILE i% < 5",'PRINT USING "While Number #"; i%',"LET i% = i% + 1","WEND"]}},{meta:[[b.SYMBOL,y.BASIC]],id:"Pause.bas",data:{[A.HAS_WINDOW_OUTPUT]:!0,[_.OUTPUT_TYPE]:"basic",[_.CONTENT]:["DIM duration","LET duration = 2500",'PRINT USING "Start with Pause #ms"; duration',"PAUSE duration",'PRINT "End Pause"','PRINT USING "Start with Sleep #ms"; duration',"PAUSE duration",'PRINT "End Sleep"']}}]};class g{constructor(t=0,e=0,s=0,i=255){p(this,"_red",0);p(this,"_green",0);p(this,"_blue",0);this.set(t,e,s,i)}set(t=0,e=0,s=0,i=255){Array.isArray(t)&&(i=t[3],s=t[2],e=t[1],t=t[0]),this.red=t,this.green=e,this.blue=s,this.alpha=i===void 0?255:i}get r(){return this._red}get red(){return this._red}set red(t){this._red=T(t,0,255)}get g(){return this._green}get green(){return this._green}set green(t){this._green=T(t,0,255)}get blue(){return this._blue}get b(){return this._blue}set blue(t){this._blue=T(t,0,255)}get a(){return this._alpha}get alpha(){return this._alpha}set alpha(t){this._alpha=T(t,0,255)}get sum(){return this._red+this._blue+this._green+this._alpha}toRGB(){return`rgb(${this._red},${this._green},${this._blue})`}toRGBA(){return`rgba(${this._red},${this._green},${this._blue},${this._alpha/255})`}toJSON(){return{red:this.red,green:this.green,blue:this.blue,alpha:this.alpha}}is(t){return this.red===t.red&&this.blue===t.blue&&this.green===t.green&&this.alpha===t.alpha}invert(){return this._red=255-this._red,this._green=255-this._green,this._blue=255-this._blue,this}add(t){this.red=T(this.red+t.red,0,255),this.green=T(this.green+t.green,0,255),this.blue=T(this.blue+t.blue,0,255)}subtract(t){this.red=T(this.red-t.red,0,255),this.green=T(this.green-t.green,0,255),this.blue=T(this.blue-t.blue,0,255)}multiply(t){this.red=T(this.red*t.red,0,255),this.green=T(this.green*t.green,0,255),this.blue=T(this.blue*t.blue,0,255)}divide(t){this.red=T(this.red/t.red,0,255),this.green=T(this.green/t.green,0,255),this.blue=T(this.blue/t.blue,0,255)}}g.COLOR_BLACK=[0,0,0,255];g.COLOR_WHITE=[255,255,255,255];g.COLOR_TRANSPARENT=[0,0,0,0];var L;class Z{constructor(t,e){tt(this,L,d(0,0));et(this,L,d(t,e))}get width(){return M(this,L).x}get height(){return M(this,L).y}get size(){return M(this,L)}}L=new WeakMap;class x{static invertImageData(t){let e=0;for(let s=0;s<t.width;s++)for(let i=0;i<t.height;i++)e=(s+i*t.width)*4,t.data[Number(e)]=255-t.data[Number(e)],t.data[e+1]=255-t.data[e+1],t.data[e+2]=255-t.data[e+2]}static createImageData(t,e,s){return new window.ImageData(new window.Uint8ClampedArray(s||4*t*e),t,e)}static resizeImageData(t,e=1){const s=t.data,i=t.width,a=t.height,n=i*e,o=a*e,u=Array(n*o*4),c=d(parseInt((i<<16)/n)+1,parseInt((a<<16)/o)+1);let m,l;for(let h=0;h<o;h++)for(let f=0;f<n;f++)m=f*c.x>>16,l=h*c.y>>16,j((l*i+m)*4,s,(h*n+f)*4,u);return x.createImageData(n,o,u)}static cropImageData(t,e,s,i,a){const n=t.data,o=Array(i*a*4);for(let u=0;u<i;u++)for(let c=0;c<a;c++){const m=(s*t.width+e)*4+(c*t.width+u)*4;j(m,n,(c*i+u)*4,o)}return x.createImageData(i,a,o)}getActiveContext(){return this._app.display.context}getDisplayContexts(){return this._app.displays.value.map(t=>t.context)}constructor(t){this._app=t;const e=t.options.size;this._bitmapData=new Z(e.width,e.height),this._renderActions=[],this._passiveRenderActions=[],this.clearStack()}setSize(t,e){this._bitmapData=new Z(t,e),this.clearStack(),this.render(),this._app.refresh()}loadImage(t){const e=this.getImageDataFromImage(t);this._bitmapData=new Z(e.width,e.height),this.clearStack(),this._stacks.push(e),this.render(),this._app.refresh()}getImageDataFromImage(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0);const i=x.createImageData(t.width,t.height),a=s.getImageData(0,0,e.width,e.height);for(let n=0;n<a.length;n++)i.data[Number(n)]=a[Number(n)];return a}getColorFromPixel(t,e,s=!1){const i=s?this._renderImageData:this._stacks[this._stacks.length-1||0],a=i.data,n=e*(i.width*4)+t*4;return new g(a[Number(n)],a[n+1],a[n+2],a[n+3])}getPixel(t,e,s=!1){const i=s?this._renderImageData:this._stacks[this._stacks.length-1||0],a=i.data,n=e*(i.width*4)+t*4;return a[Number(n)]+a[n+1]+a[n+2]+a[n+3]}setPixel(t,e,s){s=s||this._app.colorSelect.primaryColor;const i=(t+e*this._renderImageData.width)*4;this._renderImageData.data[i+0]=s.red,this._renderImageData.data[i+1]=s.green,this._renderImageData.data[i+2]=s.blue,this._renderImageData.data[i+3]=s.alpha>=0?s.alpha:255}putImageData(t,e,s){let i,a;for(let n=0;n<t.width;n++)for(let o=0;o<t.height;o++)i=(o*t.width+n)*4,a=((s+o)*this._renderImageData.width+(e+n))*4,j(i,t.data,a,this._renderImageData.data)}fillPixels(t,e,s,i,a){for(let n=e;n<Math.min(e+i,this._renderImageData.width);n++)for(let o=s;o<Math.min(s+a,this._renderImageData.height);o++)this.setPixel(n,o,t)}addRenderAction(t){this._renderActions.push(t)}addPassiveRenderAction(t){this._passiveRenderActions.push(t)}cleanPassiveRenderActions(){this._passiveRenderActions=[]}getTmpStack(){return x.createImageData(this._stacks[this._stacks.length-1].width,this._stacks[this._stacks.length-1].height,this._stacks[this._stacks.length-1].data)}render(){this._renderImageData=this.getTmpStack(),V(this._renderActions),V(this._passiveRenderActions,!0),window.cancelAnimationFrame(this._renderWait),this._renderWait=window.setTimeout(()=>{nt.bind(this)(!0),this._renderWait=null},1e3/30),window.clearTimeout(this._renderWaitDisplays),this._renderWaitDisplays=window.setTimeout(()=>{nt.bind(this)()},300)}get size(){return d(this._renderImageData.width,this._renderImageData.height)}get width(){return this._renderImageData.width}get height(){return this._renderImageData.height}get stacks(){return this._stacks}get renderImageData(){return this._renderImageData}clearStack(){this._renderImageData=x.createImageData(this._bitmapData.width,this._bitmapData.height),this._stacks=[this._renderImageData],this.render()}saveStack(){this._renderImageData=this.getTmpStack(),V(this._renderActions,!0),this._stacks.push(this._renderImageData),this.render()}revertStack(){this._stacks.length>1&&(this._renderImageData=this._stacks.pop(),this.render())}toBlob(){return new Promise(t=>{at(this._renderImageData).toBlob(t)})}toBase64(){return new Promise(t=>{t(at(this._renderImageData).toDataURL())})}}function j(r,t,e,s){s[Number(e)]=t[Number(r)],s[e+1]=t[r+1],s[e+2]=t[r+2],s[e+3]=t[r+3]}function at(r){const t=document.createElement("canvas");return t.width=r.width,t.height=r.height,t.getContext("2d").putImageData(r,0,0),t}function nt(r){r?this._app.display&&this._app.display.setImageData(this._renderImageData):this._app.displays.forEach(t=>{t.setImageData(this._renderImageData)})}function V(r,t){if(t){let e;for(;r.length>0;)e=r.shift(),e()}else r.forEach(e=>{e()})}class ut extends yt{}class Bt{constructor(t){p(this,"subscription",new lt);this._app=t}register(){this.subscription.add(P.keyDown.pipe(St(200)).subscribe(Ut.bind(this)),P.keyUp.subscribe(Lt.bind(this)))}unregister(){this.subscription.unsubscribe()}registerDisplay(t){}unregisterDisplay(t){}}function Lt(r){switch(r.keyCode){case 17:r.preventDefault(),this.holdCrtl=!1;break;case 18:r.preventDefault(),this.holdAlt=!1;break}}function Ut(r){if(this._app.display){let t=1;switch(this.holdAlt&&(t*=10),r.keyCode){case 17:r.preventDefault(),this.holdCrtl=!0;break;case 18:r.preventDefault(),this.holdAlt=!0;break;case 37:r.preventDefault(),this._app.display.offset.x-=t;break;case 38:r.preventDefault(),this._app.display.offset.y-=t;break;case 39:r.preventDefault(),this._app.display.offset.x+=t;break;case 40:r.preventDefault(),this._app.display.offset.y+=t;break}const e=this._app.display;this._app.display.offset=new ut(T(e.offset.x,-e.zoomBounds.min.x,e.canvasLayout.naturalSize.x-e.zoomBounds.max.x),T(e.offset.y,-e.zoomBounds.min.y,e.canvasLayout.naturalSize.y-e.zoomBounds.max.y)),this._app.display.renderImageData()}}const Wt=20;class Mt{constructor(t){p(this,"subscriptions",[]);p(this,"displaySubscriptions",new Map);p(this,"runSubscriptions",[]);this._app=t,this._pressed=!1}registerDisplay(t){this.displaySubscriptions.set(t,[P.get("mousedown",t.canvas).subscribe(this.onPointerDown(t).bind(this)),P.get("mouseenter",t.canvas).subscribe(this.onPointerEnter(t).bind(this))])}unregisterDisplay(t){this.displaySubscriptions.has(t)&&(this.displaySubscriptions.get(t).forEach(e=>e.unsubscribe()),this.displaySubscriptions.delete(t))}register(){}unregister(){}onContextMenu(t){return e=>{this.runActionResult(kt.bind(this)(e,t))}}onPointerEnter(t){return e=>{this.app.setDisplay(t);const s=P.get("mouseleave",e.target).subscribe(i=>{s.unsubscribe(),this.onPointerLeave(t)(i)})}}onPointerLeave(){return()=>{}}onPointerDown(t){return e=>{this.app.setDisplay(t),this._pointerEvent=G.bind(this)(e,t),this._pressed=!0,this.runActionResult(Ht.bind(this)(e,t),e,t),this.app.display.renderCanvas()}}onPointerLeaveAndUp(t){return e=>{dt(),this.runActionResult(zt.bind(this)(e,t))}}onPointerMove(t){return e=>{this.runActionResult(Yt.bind(this)(e,t))}}get app(){return this._app}get pressed(){return this._pressed}runActionResult(t,e,s){t&&(t.events&&(this.runSubscriptions=[P.get("contextmenu",e.target).subscribe(this.onContextMenu(s).bind(this)),P.get("mouseleave",e.target).subscribe(this.onPointerLeaveAndUp(s).bind(this)),P.get("mousemove",e.target).subscribe(this.onPointerMove(s).bind(this)),P.get("mouseup",e.target).subscribe(this.onPointerLeaveAndUp(s).bind(this))]),t.save&&this.app.canvas.saveStack(),t.revert&&this.app.canvas.revertStack(),t.render&&this.app.canvas.render())}unsubscribeRun(){this.runSubscriptions.filter(t=>!t.unsubscribe())}}let K;function dt(){window.clearInterval(K),K=null}function Ft(r){dt(),K=window.setInterval(r,Wt)}function G(r,t){const e=t.canvasLayout;let s=d(r.clientX-t.bounds.min.x,r.clientY-t.bounds.min.y),i=d(()=>s-e.position);this.app.globalBounds&&(s=d(()=>s-this.app.globalBounds.min),i=d(()=>i-this.app.globalBounds.min));const a=d(()=>Math.round(i)),n=d(()=>Math.round(i/t.zoomFactor+t.zoomBounds.min));return{position:n,origin:a,app:this.app,x:n.x,y:n.y,originX:a.x,originY:a.y,leftClick:r.button!==2,rightClick:r.button===2,holdAlt:P.altActive,holdCtrl:P.cmdActive}}function Ht(){const r={events:!0};if(this.app.tool.pointerDownHold)Ft(()=>{this.runActionResult(this.app.tool.onPointerDown(this._pointerEvent,this)),this.app.canvas.render()});else return Object.assign(r,this.app.tool.onPointerDown(this._pointerEvent,this));return r}function zt(r,t){return this._pressed=!1,this._pointerEvent=null,this.unsubscribeRun(),this.app.tool.onPointerUp(G.bind(this)(r,t),this)}function Yt(r,t){return this._pointerEvent=G.bind(this)(r,t),this.app.tool.onPointerMove(this._pointerEvent,this)}function kt(r,t){return r.preventDefault(),r.stopPropagation(),this.app.tool.onContextMenu(G.bind(this)(r,t),this)}class O{constructor(t){p(this,"_pointerDownHold",!1);this._app=t.app,this.passive=t.passive||!1,this._pointerDownHold=t.pointerDownHold||!1}get pointerDownHold(){return this._pointerDownHold}deconstructor(){}onActive(){}onPointerDown(){}onPointerUp(){}onPointerMove(){}onContextMenu(){}get app(){return this._app}get setPixel(){return this._app.activeDisplay.setPixel}}class E extends O{constructor(t){super(t),this._brush=t.brush}get brush(){return this._brush}set brush(t){this._brush=t}static drawBrush({x:t,y:e,data:s,app:i,color:a}){t=Math.floor(t-s[0].length/2+1),e=Math.floor(e-s.length/2);const n=[];for(let o=0;o<s[0].length;o++)for(let u=0;u<s.length;u++)s[Number(u)][Number(o)]>0&&a.alpha?(i.canvas.setPixel(t+o,e+u,a),n.push([t+o,e+u])):s[Number(u)][Number(o)]<0&&i.canvas.setPixel(t+o,e+u);return n}}class pt extends E{onPointerDown(t){const e=t.x,s=t.y,i=[].concat(this._brush.data);return this._app.canvas.addRenderAction(()=>{E.drawBrush({color:this._brush.primaryColor,x:e,y:s,data:i,app:this._app})}),{save:!0,render:!0}}}function mt(r,t,e,s,i=0){const a=Math.abs(e-r),n=r<e?1:-1,o=Math.abs(s-t),u=t<s?1:-1;let c=(a>o?a:-o)/2;const m=[];let l=0;for(;i===0||l>=1?(m.push([r,t]),l=0):l+=1/i,!(r===e&&t===s);){const h=c;h>-a&&(c-=o,r+=n),h<o&&(c+=a,t+=u)}return m}function S(r,t,e,s,i,{density:a=0}){mt(t,e,s,i,a).forEach(n=>{r(n[0],n[1])})}function Gt(r,t,e,s,i,a,n,o,u,c=.001){let m=0,l=0,h=0;for(h=0;h<=1;h+=c)m=(1-h)**3*t+3*h*(1-h)**2*s+3*h**2*(1-h)*a+h**3*o,l=(1-h)**3*e+3*h*(1-h)**2*i+3*h**2*(1-h)*n+h**3*u,r(parseInt(m),parseInt(l))}function U(r,t,e,s,i,{strokeSize:a=0,filled:n=!1,density:o}){if(n){const u=(c,m)=>r(c,m,!0);for(let c=(i<0,e);i<0?c>=e+i:c<=e+i;i<0?c--:c++)S(u,(s<0,t),c,t+s,c,{density:o})}if(a>0){a=Math.floor(a/2),a=[s<0?-a:a,i<0?-a:a];let u=[t-a[0],e-a[1]];[[t-a[0],e-a[1]],[t-a[0],e+i+a[1]],[t+s+a[0],e+i+a[1]],[t+s+a[0],e-a[1]],u].forEach(c=>{S(r,u[0],u[1],c[0],c[1],{density:o}),u=c})}}function Y(r,t,e,s,i,{filled:a=!1,density:n=0}){s<0&&(s=Math.abs(s)),i<0&&(i=Math.abs(i));const o=s*s,u=i*i,c=4*o,m=4*u;let l,h,f,N=0;const C=(I,R)=>r(I,R,!0),D=[];for(l=0,h=i,f=2*u+o*(1-2*i);u*l<=o*h;l++)!n||N>=1?(D.push([t+l,e+h]),D.push([t-l,e-h]),D.push([t-l,e+h]),D.push([t+l,e-h]),N=0):N+=1/n,f>=0&&(f+=c*(1-h),h--),f+=u*(4*l+6);for(N=0,l=s,h=0,f=2*o+u*(1-2*s);o*h<=u*l;h++)!n||N>=1?(D.push([t+l,e+h]),D.push([t-l,e+h]),D.push([t+l,e-h]),D.push([t-l,e-h]),N=0):N+=1/n,f>=0&&(f+=m*(1-l),l--),f+=o*(4*h+6);if(a)for(let I=-i;I<=i;I++)for(let R=-s;R<=s;R++)R*R*i*i+I*I*s*s<=i*i*s*s&&C(t+R,e+I);D.forEach(I=>{r(I[0],I[1])})}function Xt(r,t,e,{strokeSize:s=0,filled:i=!1,density:a=0}){let n,o=Number.MAX_VALUE,u=Number.MAX_VALUE,c=Number.MIN_VALUE,m=Number.MIN_VALUE;if(t.forEach(l=>{n&&(l.x>c&&(c=l.x),l.y>m&&(m=l.y),l.x<o&&(o=l.x),l.y<u&&(u=l.y),S(r,n.x,n.y,l.x,l.y,{density:a})),n=l}),e){const l=t[0];n&&(l.x>c&&(c=l.x),l.y>m&&(m=l.y),l.x<o&&(o=l.x),l.y<u&&(u=l.y),S(r,n.x,n.y,l.x,l.y,{density:a}))}i&&$t((h,f)=>r(h,f,!0),t,{IMAGE_LEFT:o,IMAGE_TOP:u,IMAGE_RIGHT:c,IMAGE_BOTTOM:m})}function $t(r,t,{IMAGE_LEFT:e=0,IMAGE_TOP:s=0,IMAGE_RIGHT:i,IMAGE_BOTTOM:a}){const n=[],o=[];t.forEach(C=>{n.push(C.y),o.push(C.x)});let u;const c=Array(t.length);let m,l,h,f,N;for(l=s;l<a;l++){for(u=0,f=t.length-1,h=0;h<t.length;h++)(n[Number(h)]<l&&n[Number(f)]>=l||n[Number(f)]<l&&n[Number(h)]>=l)&&(c[u++]=Math.round(o[Number(h)]+(l-n[Number(h)])/(n[Number(f)]-n[Number(h)])*(o[Number(f)]-o[Number(h)]))),f=h;for(h=0;h<u-1;)c[Number(h)]>c[h+1]?(N=c[Number(h)],c[Number(h)]=c[h+1],c[h+1]=N,h&&h--):h++;for(h=0;h<u&&!(c[Number(h)]>=i);h+=2)if(c[h+1]>e)for(c[Number(h)]<e&&(c[Number(h)]=e),c[h+1]>i&&(c[h+1]=i),m=c[Number(h)];m<c[h+1];m++)r(m,l)}}class Zt extends E{onPointerDown(t){return ot.bind(this)(t)}onPointerMove(t){return ot.bind(this)(t)}onPointerUp(){return this.last=null,{save:!0}}}function ot(r){const t=(this.last||r).x,e=(this.last||r).y;return S((s,i)=>{const a=[].concat(this._brush.data);this._app.canvas.addRenderAction(()=>{E.drawBrush({color:this._brush.primaryColor,data:a,x:s,y:i,app:this._app})})},t,e,r.x,r.y,{}),this.last=r,{render:!0}}class W{constructor({app:t,size:e=1,lowres:s=!0,primaryColor:i,secondaryColor:a}){this._app=t,this._size=e,this._lowres=s,this._data=this.getScaledData(this._size),this._primaryColor=i,this._secondaryColor=a}get lowres(){return this._lowres}get data(){return this._data}get size(){return this._size}set size(t=1){this._size=t,this._data=this.getScaledData(this._size)}get primaryColor(){return this._primaryColor||this._app.colorSelect.primaryColor}get secondaryColor(){return this._secondaryColor||this._app.colorSelect.secondaryColor}getData(t){return W.scale([],t)}getScaledData(t=1){return W.scale(this.getData(t),this._app.density)}static scale(t,e){const s=[];for(let i=0;i<t.length*e;i++){s.push([]);for(let a=0;a<t[0].length*e;a++)s[Number(i)].push(t[Math.floor(i/e)][Math.floor(a/e)])}return s}static scaleAsCopy(t,e){const s=[];for(let i=0;i<t.length*e;i++){s.push([]);for(let a=0;a<t[0].length*e;a++)s[Number(i)].push(t[i%t.length][a%t[0].length])}return s}}class jt extends W{getData(t){return t>1?ft(t):t?[[1]]:[]}}function ft(r){r=(r-1)*2;const t=Array(r+1);for(let e=0;e<r+1;e++)t[Number(e)]=Array(r+1).fill(0);return Y((e,s)=>{t[Math.round(e)][Math.round(s)]=1},r/2,r/2,r/2,r/2,{filled:!0}),t}function Vt(r){const t=ft(r+2);for(let e=0;e<t.length;e++)for(let s=0;s<t[Number(e)].length;s++)t[Number(e)][Number(s)]>0&&Math.random()<.15/r?t[Number(e)][Number(s)]=1:t[Number(e)][Number(s)]=0;return t}function Kt(r){const t=Array(r+1);for(let e=0;e<r+1;e++)t[Number(e)]=Array(r+1).fill(0);return U((e,s)=>{t[Math.round(e)][Math.round(s)]=1},0,0,r,r,{filled:!0}),t}class qt extends W{getData(t){return Kt(t)}}class Jt extends W{getData(t){return Vt(t)}get data(){return this._data=this.getScaledData(this._size),this._data}}function X(r){return[jt,qt,Jt][Number(r)]}class v extends E{constructor(t){super(t),this.COLOR_TRANSPARENT=new g(g.COLOR_TRANSPARENT),this.filled=!1,this.selectedAnchor=null,this.anchors=[],this.anchorBrush=new(X(0))({app:this._app,size:1,primaryColor:new g(g.COLOR_BLACK),secondaryColor:new g(g.COLOR_WHITE)})}onPointerDown(t){this.startEvent=t}drawAnchors(){const t=[].concat(this.anchorBrush.data);this.anchors.forEach(e=>{this.drawAnchor(e,t)})}drawAnchor(t,e){t.intersectMap={},U((s,i,a)=>{let n=this._app.canvas.getColorFromPixel(s,i);n.alpha===0?n=a?this.anchorBrush.secondaryColor:this.anchorBrush.primaryColor:n.invert(),t.intersectMap[Number(s)]=t.intersectMap[Number(s)]||{},t.intersectMap[Number(s)][Number(i)]=!0,E.drawBrush({color:n,data:e,x:s,y:i,app:this._app})},t.x-5,t.y-5,10,10,{strokeSize:1,filled:!0})}getAnchorByPosition(t,e){return this.anchors.find(s=>s.intersectAnchor(t,e)?s:!1)}addAnchor(t,e){const s=new Qt(t,e,this.anchorBrush);return this.anchors.push(s),s}reset(){this.anchors=[],this.selectedAnchor=null}}class Qt{constructor(t,e,s){this.x=t,this.y=e,this.brush=s}intersectAnchor(t,e){return this.intersectMap&&this.intersectMap[Number(t)]&&this.intersectMap[Number(t)][Number(e)]}}class te extends v{onPointerDown(t){if(this.selectedAnchor){const e=this.getAnchorByPosition(t.x,t.y);if(e)this.selectedAnchor=e;else return this._app.canvas.addRenderAction(()=>{this.render(!1),this.reset()}),{save:!0,render:!0};this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)})}return{render:!0}}onPointerMove(t,e){if(e.pressed)return this.anchors.length<1&&(this.addAnchor(t.x,t.y),this.selectedAnchor=this.addAnchor(t.x,t.y)),this.selectedAnchor.x=t.x,this.selectedAnchor.y=t.y,this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}}render(t=!1){this.anchors.length&&(S((e,s)=>{const i=[].concat(this._brush.data);v.drawBrush({color:this._brush.primaryColor,data:i,x:e,y:s,app:this._app})},this.anchors[0].x,this.anchors[0].y,this.anchors[1].x,this.anchors[1].y,{}),t&&this.drawAnchors())}}class ee extends v{constructor(t){super(t),this.status=0,this.locked=!1}refreshHelperOffset(){this.primaryHelper&&(this.primaryHelperOffset=[this.primaryHelper.x-this.primaryAnchor.x,this.primaryHelper.y-this.primaryAnchor.y]),this.secondaryHelper&&(this.secondaryHelperOffset=[this.secondaryHelper.x-this.secondaryAnchor.x,this.secondaryHelper.y-this.secondaryAnchor.y])}onPointerDown(t){if(this.moved||this.reset(),this.locked)return;this.locked=!0,this.anchors.length===1&&this.reset();const e=this.getAnchorByPosition(t.x,t.y);if(e&&this.selectedAnchor!==e)this.selectedAnchor=e;else{if(this.status===2&&!e)return re.bind(this)();this.status===1?se.bind(this)():this.selectedAnchor||(this.addAnchor(t.x,t.y),this.selectedAnchor=this.addAnchor(t.x,t.y))}return this._app.canvas.addPassiveRenderAction(()=>{this.render(!0),this.locked=!1}),{render:!0}}get primaryAnchor(){return this.anchors[0]}get secondaryAnchor(){return this.anchors[1]}get primaryHelper(){return this.anchors[2]}get secondaryHelper(){return this.anchors[3]}onPointerUp(){if(this.status<3&&this.status===0)return this.selectedAnchor=null,this.status++,this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}}onPointerMove(t,e){if(e.pressed&&this.selectedAnchor)return this.moved=!0,this.selectedAnchor.x=t.x,this.selectedAnchor.y=t.y,this.selectedAnchor===this.primaryAnchor&&this.primaryHelper?(this.primaryHelper.x=this.selectedAnchor.x+this.primaryHelperOffset[0],this.primaryHelper.y=this.selectedAnchor.y+this.primaryHelperOffset[1]):this.selectedAnchor===this.secondaryAnchor&&this.secondaryHelper?(this.secondaryHelper.x=this.selectedAnchor.x+this.secondaryHelperOffset[0],this.secondaryHelper.y=this.selectedAnchor.y+this.secondaryHelperOffset[1]):(this.selectedAnchor===this.primaryHelper||this.selectedAnchor===this.secondaryHelper)&&this.refreshHelperOffset(),this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}}addPoints(t){t.forEach(e=>{this.points[T(e[0]-1,0,this._app.canvas.width-1)][T(e[1]-1,0,this._app.canvas.height-1)]=!0})}render(t=!1){this.status>1?Gt((e,s)=>{const i=[].concat(this._brush.data);E.drawBrush({color:this._brush.primaryColor,data:i,x:e,y:s,app:this._app})},this.primaryAnchor.x,this.primaryAnchor.y,this.primaryHelper.x,this.primaryHelper.y,this.secondaryHelper.x,this.secondaryHelper.y,this.secondaryAnchor.x,this.secondaryAnchor.y):S((e,s)=>{const i=[].concat(this._brush.data);v.drawBrush({color:this._brush.primaryColor,data:i,x:e,y:s,app:this._app})},this.primaryAnchor.x,this.primaryAnchor.y,this.secondaryAnchor.x,this.secondaryAnchor.y,{}),t&&(this.primaryHelper&&S((e,s)=>{let i=this._app.canvas.getColorFromPixel(e,s);i.alpha===0?i=this.anchorBrush.primaryColor:i.invert();const a=[].concat(this.anchorBrush.data);v.drawBrush({color:i,data:a,x:e,y:s,app:this._app})},this.primaryAnchor.x,this.primaryAnchor.y,this.primaryHelper.x,this.primaryHelper.y,{}),this.secondaryHelper&&S((e,s)=>{let i=this._app.canvas.getColorFromPixel(e,s);i.alpha===0?i=this.anchorBrush.primaryColor:i.invert();const a=[].concat(this.anchorBrush.data);v.drawBrush({color:i,data:a,x:e,y:s,app:this._app})},this.secondaryAnchor.x,this.secondaryAnchor.y,this.secondaryHelper.x,this.secondaryHelper.y,{}),this.drawAnchors())}reset(){v.prototype.reset.apply(this,arguments),this.status=0,this.locked=!1}intersect(t,e){const s=[[0,0],[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]];for(let i=0;i<s.length;i++)if(this.points[t+s[Number(i)][0]][e+s[Number(i)][1]])return!0;return!1}}function se(){let r=ht(this.primaryAnchor,this.secondaryAnchor);this.addAnchor(r[0],r[1]),r=ht(this.secondaryAnchor,this.primaryAnchor),this.addAnchor(r[0],r[1]),this.refreshHelperOffset(),this._app.canvas.addPassiveRenderAction(()=>{this.render(!0),this.locked=!1}),this.status++}function re(){return this._app.canvas.addRenderAction(()=>{this.render(!1),this.reset()}),{events:!1,save:!0,render:!0}}function ht(r,t){const e=mt(r.x,r.y,t.x,t.y);return e[Math.floor(e.length/4)]}class ie extends O{fill(t,e,s){const i=[[t,e]];let a=0,n,o,u,c,m;const l=this._app.canvas.getColorFromPixel(t,e,!0),h=[[-1,0],[1,0],[0,-1],[0,1]];for(;i.length;){if(a>2e6)throw new Error("FILL OVERFLOW");for(n=i.pop(),t=n[0],e=n[1],this._app.canvas.setPixel(t,e,s,!0),o=0;o<h.length;o++)u=t+h[Number(o)][0],c=e+h[Number(o)][1],u>=0&&u<this._app.canvas.width&&c>=0&&c<this._app.canvas.height&&(m=this._app.canvas.getColorFromPixel(u,c,!0),m.is(l)&&!s.is(m)&&i.push([u,c]));a++}}onPointerDown(t){if(!this._filling){this._filling=!0;const e=t.x,s=t.y,i=this._app.colorSelect.primaryColor;return this._app.canvas.addRenderAction(()=>{this.fill(e,s,i),this._filling=!1}),{save:!0,render:!0}}return{events:!1}}}class ae extends pt{constructor(t={}){t.pointerDownHold=!0,super(t)}}class ne extends v{onPointerMove(t){const e=t.x-this.startEvent.x,s=t.y-this.startEvent.y;return this._app.canvas.addPassiveRenderAction(()=>{U((i,a,n)=>{const o=[].concat(this._brush.data);E.drawBrush({color:n?this._brush.secondaryColor:this._brush.primaryColor,data:o,x:i,y:a,app:this._app})},this.startEvent.x,this.startEvent.y,e,s,{strokeSize:this.filled?0:this._brush.data.length,filled:this.filled})}),{render:!0}}onPointerUp(t){const e=t.x-this.startEvent.x,s=t.y-this.startEvent.y;return this._app.canvas.addRenderAction(()=>{U((i,a,n)=>{const o=[].concat(this._brush.data);E.drawBrush({color:n?this._brush.secondaryColor:this._brush.primaryColor,data:o,x:i,y:a,app:this._app})},this.startEvent.x,this.startEvent.y,e,s,{strokeSize:this.filled?0:this._brush.data.length,filled:this.filled})}),{save:!0,render:!0}}}class _t extends v{constructor(t){super(t),this._proportinalScale=!1}onPointerMove(t){const e=(t.x-this.startEvent.x)/2;let s=(t.y-this.startEvent.y)/2;if(this._proportinalScale&&(e<0&&s>0||e>0&&s<0?s=e*-1:s=e),e!==0&&s!==0)return this._app.canvas.addPassiveRenderAction(()=>{Y((i,a,n)=>{const o=[].concat(this._brush.data);E.drawBrush({color:n?this._brush.secondaryColor:this._brush.primaryColor,data:o,x:i,y:a,app:this._app})},Math.floor(this.startEvent.x+e),Math.floor(this.startEvent.y+s),e,s,{filled:this.filled})}),{render:!0}}onPointerUp(t){const e=(t.x-this.startEvent.x)/2;let s=(t.y-this.startEvent.y)/2;if(this._proportinalScale&&(e<0&&s>0||e>0&&s<0?s=e*-1:s=e),e!==0&&s!==0)return this._app.canvas.addRenderAction(()=>{Y((i,a,n)=>{const o=[].concat(this._brush.data);E.drawBrush({color:n?this._brush.secondaryColor:this._brush.primaryColor,data:o,x:i,y:a,app:this._app})},Math.floor(this.startEvent.x+e),Math.floor(this.startEvent.y+s),e,s,{strokeSize:this._brush.data.length,filled:this.filled})}),{save:!0,render:!0}}}class oe extends _t{constructor(t){super(t),this._proportinalScale=!0,this._func=Y}}class he extends v{constructor(t){super(t),this.status=0}onPointerMove(t,e){if(e.pressed&&this.selectedAnchor)return this.selectedAnchor.x=t.x,this.selectedAnchor.y=t.y,this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}}onPointerDown(t){const e=this.getAnchorByPosition(t.x,t.y);switch(this.status){case 1:if(e)this.selectedAnchor=e;else return this.status=2,this._app.canvas.addRenderAction(()=>{this.render(!1),this.reset()}),{save:!0,render:!0};break;default:e&&this.anchors[0]===e?(this.status=1,this.selectedAnchor=e):this.selectedAnchor=e||this.addAnchor(t.x,t.y)}return this._app.canvas.addPassiveRenderAction(()=>{this.render(this.status<2)}),{render:!0}}isClosed(){return this.status>0}render(t=!1){Xt((s,i)=>{const a=[].concat(this._brush.data);E.drawBrush({color:this._brush.primaryColor,data:a,x:s,y:i,app:this._app})},this.anchors,this.status>0,{filled:this.filled}),t&&this.drawAnchors()}reset(){v.prototype.reset.apply(this,arguments),this.status=0}}class w{constructor(t,e){p(this,"min",d(0,0));p(this,"max",d(0,0));this.min=t||this.min,this.max=e||this.max}}class le extends v{constructor(t){super(t),this.brushPrimaryColor=new g(g.COLOR_BLACK),this.brushSecondaryColor=new g(g.COLOR_WHITE),this.brush=new(X(0))({app:this.app,size:1,primaryColor:this.brushPrimaryColor,secondaryColor:this.brushSecondaryColor}),this.reset()}intersect(t){return this.bounds?t.x>this.bounds.min.x&&t.x<this.bounds.max.x&&t.y>this.bounds.min.y&&t.y<this.bounds.max.y:!1}reset(){this.status=0,this.bounds=null,this.intersectedStartEvent=null,this.croppedImageData=null,this.startEvent=null}onPointerDown(t){let e;switch(this.status){case 3:break;case 2:if(this.croppedImageData&&(this.intersectedStartEvent||this.intersect(t)))if(this.intersectedStartEvent=t,t.rightClick)this.status++;else return{events:!0,render:!1};break;case 1:if(e=d(this.bounds.max-this.bounds.min),this.status++,t.rightClick){const s=this.bounds.min.x,i=this.bounds.min.y;this.app.canvas.addRenderAction(()=>{this.app.canvas.fillPixels(this._brush.secondaryColor,s,i,e.x,e.y)})}return this.app.canvas.addPassiveRenderAction(()=>{this.render(this.startEvent.x,this.startEvent.y,!0)}),{events:!0,render:!0};default:return v.prototype.onPointerDown.apply(this,arguments)}}onPointerMove(t,e){if(this.intersectedStartEvent&&e.pressed){const s=this.getRectInfo(t);return this._app.canvas.addPassiveRenderAction(()=>{this.render(s.x,s.y,!0)}),{render:!0}}else if(this.status===0)return this._app.canvas.addPassiveRenderAction(()=>{this.render(t.x,t.y,!0)}),{render:!0}}getRectInfo(t){return{width:this.bounds.max.x-this.bounds.min.x,height:this.bounds.max.y-this.bounds.min.y,x:this.startEvent.x+t.x-this.intersectedStartEvent.x,y:this.startEvent.y+t.y-this.intersectedStartEvent.y}}onPointerUp(t){if(this.status===3)return this.app.canvas.addRenderAction(()=>{const e=this.getRectInfo(t);x.invertImageData(this.croppedImageData),this.render(e.x,e.y,!1),this.reset()}),{save:!0,render:!0};if(this.intersectedStartEvent&&this.status===2){const e=this.getRectInfo(t);return this.startEvent.x=e.x,this.startEvent.y=e.y,this.bounds=new w(d(e.x,e.y),d(e.x+e.width,e.y+e.height)),this._app.canvas.addPassiveRenderAction(()=>{this.render(e.x,e.y,!0)}),{render:!0}}else if(this.startEvent&&this.status===0){const e=t.x-this.startEvent.x,s=t.y-this.startEvent.y;return e>0&&s>0&&(this.bounds=new w(d(this.startEvent.x,this.startEvent.y),d(t.x,t.y)),this.status++,this._app.canvas.addPassiveRenderAction(()=>{this.croppedImageData=x.cropImageData(this.app.canvas.renderImageData,this.bounds.min.x,this.bounds.min.y,e,s),x.invertImageData(this.croppedImageData),this.render(this.startEvent.x,this.startEvent.y,!0)})),{render:!0}}}render(t,e,s){let i=d(0,0),a=d(t,e);this.bounds?i=d(()=>this.bounds.max-this.bounds.min):(i=d(()=>a-this.startEvent.position),a=this.startEvent.position),this.croppedImageData&&this.app.canvas.putImageData(this.croppedImageData,a.x,a.y),s&&U((n,o)=>{const u=[].concat(this._brush.data);let c=this._app.canvas.getColorFromPixel(n,o);c.alpha===0?c=this.brushPrimaryColor:c.invert(),E.drawBrush({color:c,data:u,x:n,y:o,app:this._app})},a.x,a.y,i.x,i.y,{strokeSize:this._brush.data.length,filled:this.filled,density:3})}}class ce extends v{constructor(t){super(t),this.brushPrimaryColor=new g(g.COLOR_BLACK),this.brushSecondaryColor=new g(g.COLOR_WHITE),this.brush=new(X(0))({app:this.app,size:1,primaryColor:this.brushPrimaryColor,secondaryColor:this.brushSecondaryColor}),this._moving=!1}onPointerMove(t){const e=t.x-this.startEvent.x,s=t.y-this.startEvent.y;return this._moving||(this._moving=!0,this._app.canvas.addPassiveRenderAction(()=>{U((i,a)=>{const n=[].concat(this._brush.data);let o=this._app.canvas.getColorFromPixel(i,a);o.alpha===0?o=this.brushPrimaryColor:o.invert(),E.drawBrush({color:o,data:n,x:i,y:a,app:this._app})},this.startEvent.x,this.startEvent.y,e,s,{strokeSize:this._brush.data.length,filled:!1}),this._moving=!1})),{render:!0}}onPointerUp(t){this._app.canvas.cleanPassiveRenderActions();const e=d(t),s=d(this.startEvent),i=$(()=>Math.floor(e-s));if(i.x>0&&i.y>0){const a=new w(s,e),n=this.app.display,o=$(()=>Math.floor(n.canvasLayout.naturalSize/i*n.zoomFactor)),u=$(()=>a.min+i/2);this.app.display.setZoom(o.x>o.y?o.x:o.y,u)}return{render:!0}}}class ue extends O{onPointerDown(t){const e=this.app.display;let s=2;return e.maxZoomFactor-5<e.zoomFactor&&(s=1),s=P.altActive?-s:s,this.app.display.zoom(s,new ut(t.x,t.y)),{events:!1}}}class de extends O{constructor(t){super(t),this.passive=!0}onActive(){this.app.canvas.revertStack()}}class pe extends O{constructor(t){super(t),this.passive=!0}onActive(){this.app.canvas.clearStack()}}function me(r){return[pt,Zt,te,ee,ie,ae,ne,oe,_t,he,le,O,O,O,ce,ue,de,pe][Number(r)]}class fe{constructor(t){p(this,"id",Pt());p(this,"events",new ct);p(this,"bounds",new w);p(this,"size",d());p(this,"canvasLayout",q({size:H(d()),naturalSize:H(d()),position:H(d())}));p(this,"imageData",null);p(this,"tmpImageData",null);p(this,"el");p(this,"canvas");p(this,"context");p(this,"zoomFactor",1);p(this,"maxZoomFactor",20);p(this,"zoomPosition",d(.5,.5));p(this,"zoomBounds",new w);p(this,"offset",F());p(this,"cursorVisible",!1);this.app=t,this.cursorColor=new g(g.COLOR_BLACK),this.resetZoom()}showCursor(){this.cursorVisible=!0}hideCursor(){this.cursorVisible=!1,this.renderImageData()}setElement(t){this.el=t}setCanvas(t){this.canvas=t,this.context=t.getContext("2d"),Object.values(this.app.inputs).forEach(e=>{e.registerDisplay(this)})}destroy(){this.events.next(new B({name:"destroy"})),Object.values(this.app.inputs).forEach(t=>{t.unregisterDisplay(this)})}setImageData(t){this.tmpImageData=this.imageData=t,this.maxZoomFactor=20,this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.renderImageData()}get canvasSize(){return d(this.canvas.width,this.canvas.height)}get naturalSize(){return d(this.canvas.width,this.canvas.height)}get naturalWidth(){return this.imageData.width}get naturalHeight(){return this.imageData.height}get width(){return this.zoomBounds.max.x-this.zoomBounds.min.x}get height(){return this.zoomBounds.max.y-this.zoomBounds.min.y}get zoomFactorWidth(){return this.canvas.width/this.zoomFactor}setSize(t,e){let s;"x"in t?s=t:s=d(t,e),this.size=s,this.events.next(new B({name:"change:size",value:s})),this.canvasAdjustment()}canvasAdjustment(){this.canvasLayout.size=d(()=>Math.min(Math.max(this.app.canvas.size*this.zoomFactor,0),this.size)),this.canvasLayout.naturalSize=this.app.canvas.size,this.canvasLayout.position=d(0,0)}setZoom(t=1,e=d()){t=Math.min(t,this.maxZoomFactor),t>=0&&(this.zoomFactor=t,this.canvasAdjustment(),this.zoomPosition=d(()=>e/this.canvasLayout.naturalSize),this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.resetOffset(),window.requestAnimationFrame(()=>{this.renderImageData(),this.events.next(new B({name:"change:zoomFactor",value:t}))}))}zoom(t=1,e=d()){this.zoomFactor+t>=0&&this.setZoom(this.zoomFactor+t,e)}renderImageData(){this.tmpImageData=this.imageData;const t=d(()=>this.zoomBounds.max-this.zoomBounds.min),e=d(()=>d(this.offset)+this.zoomBounds.min);this.tmpImageData=x.cropImageData(this.tmpImageData,e.x,e.y,t.x,t.y),this.tmpImageData=x.resizeImageData(this.tmpImageData,this.zoomFactor),this.renderCanvas()}get cursorColor(){return this._cursorColor}set cursorColor(t){this._cursorColorRGBA=t.toRGBA(),this._cursorColor=t}renderCanvas(){this.tmpImageData&&(this.context.putImageData(this.tmpImageData,-this.offset.x,-this.offset.y),this.renderRaster())}reset(){this.resetZoom(),this.resetOffset(),this.renderCanvas()}resetOffset(){this.offset=F(0,0)}resetZoom(){this.imageData&&this.setZoom(1)}renderRaster(){const t=[];this.zoomFactor>this.maxZoomFactor-3&&t.push({size:d(1,1),width:1,color:"#CCCCCC"});const e=this.context;e.globalCompositeOperation="destination-over",t.forEach(s=>{const i=d(()=>this.canvasLayout.naturalSize/s.size);e.lineWidth=s.width,e.beginPath();for(let a=0;a<i.x+1;a++){const n=Math.floor(a*s.size.x*this.zoomFactor)+s.width/2;e.moveTo(n,0),e.lineTo(n,this.canvas.height);for(let o=0;o<i.y+1;o++){const u=Math.floor(o*s.size.y*this.zoomFactor)+s.width/2;e.moveTo(0,u),e.lineTo(this.canvas.width,u)}}e.strokeStyle=s.color,e.stroke()})}refresh(){if(this.canvas){const t={left:this.canvas.offsetLeft+this.el.offsetLeft,top:this.canvas.offsetTop+this.el.offsetTop,width:this.canvas.offsetWidth,height:this.canvas.offsetHeight};this.bounds=new w(d(t.left,t.top),d(t.left+t.width,t.top+t.height)),this.imageData&&this.renderImageData()}}setOffset(t){this.offset=F(t.x,t.y)}calculateZoomBounds(t,e){e=e||1;const s=this.app.canvas.size;t=d(()=>Math.floor(t*s));const i=d(()=>this.size/s),a=d(()=>Math.ceil(Math.min(i/e*s,s))),n=d(()=>Math.min(Math.max(t-Math.ceil(a/2),0),s-a)),o=d(()=>n+a);return new w(n,o)}}const _e={FULL:0,HALF:1,THIRD:2,QUARTER:3};class be{constructor(t){p(this,"subscription",new lt);p(this,"events",new ct);p(this,"globalBounds");p(this,"fsItem");p(this,"options",{size:{width:300,height:200},display:{foreground:"#FFFFFF",background:"#000000"}});p(this,"density",1);p(this,"displaySplit",_e.FULL);p(this,"displays",[]);p(this,"displaysEl");p(this,"displaysLayout",{size:d()});p(this,"display");p(this,"canvas");p(this,"inputs");p(this,"brush");p(this,"brushSelect",{size:1,index:0});p(this,"colorSelect",{primaryColor:new g(g.COLOR_BLACK),secondaryColor:new g(g.COLOR_WHITE),paletteSteps:new g(2,1,1)});p(this,"tool");p(this,"toolSelect",{value:"",index:1,filled:!1});p(this,"cursorCanvas",null);this.globalBounds=t,this.canvas=new x(this),this.setBrush(this.brushSelect),this.setTool(this.toolSelect),this.subscription.add(At.resize.subscribe(this.onViewportRefresh.bind(this))),this.inputs={keyboard:new Bt(this),mouse:new Mt(this)},Object.values(this.inputs).forEach(e=>{e.register()})}setColorSelect(t){this.colorSelect={...this.colorSelect,...t}}setBrushSelect(t){this.brushSelect={...this.brushSelect,...t}}setToolSelect(t){this.toolSelect={...this.toolSelect,...t}}setDisplaysElement(t){this.displaysEl=t}refresh(){this.displaysLayout={size:d(this.displaysEl.offsetWidth,this.displaysEl.offsetHeight)},this.refreshDisplayPositions(),this.refreshDisplays()}setDisplay(t){this.display&&this.display.hideCursor(),this.display=t,this.display.showCursor()}updateGlobalBounds(t){this.globalBounds=t}reset(){this.canvas.clearStack(),this.displays.forEach(t=>t.reset())}destroy(){this.subscription.unsubscribe()}refreshDisplays(){this.displays.forEach(t=>{t.refresh()})}onViewportRefresh(){this.refreshDisplays()}addDisplay(t){return t=H(t||new fe(this)),this.displays.push(t),t.app=this,this.events.next(new B({name:"addDisplay",value:t,scope:this})),this.canvas.render(),t}clearDisplays(){this.displays.forEach(t=>{t.destroy(),this.events.next(new B({name:"removeDisplay",value:t,scope:this}))}),this.displays=[]}getDisplay(t){return this.displays.find(e=>e.id===t?e:!1)}setBrush({index:t,size:e}){this.brush=new(X(t))({app:this,size:e}),this.tool&&(this.tool.brush=this.brush),this.events.next(new B({name:"change:brush",value:this.brush,scope:this}))}setBrushSize(t){this.brush.size=t}setTool({index:t}){const e=new(me(t))({app:this,brush:this.brush});this.tool=e,this.tool.onActive(),this.events.next(new B({name:"change:tool",value:this.tool,scope:this}))}get paletteSteps(){return this.colorSelect.paletteSteps}set paletteSteps(t){this.colorSelect.paletteSteps=t}refreshDisplayPositions(){const t=this.displaysLayout.size.x,e=this.displaysLayout.size.y;let s=[[[1,1]],[[.5,1],[.5,1]],[[1,.5],[1,.5]],[[1,.5],[.5,.5],[.5,.5]],[[.5,.5],[.5,.5],[1,.5]],[[.5,.5],[.5,.5],[.5,.5],[.5,.5]]].filter(i=>i.length===this.displays.length?i:!1);s=s[0],this.displays.forEach((i,a)=>{i.setSize(F(Math.floor(t*s[Number(a)][0]),Math.floor(e*s[Number(a)][1]))),s[Number(a)][0]<1,s[Number(a)][1]<1})}}function ge(r){const t=r.modules.windows;return async()=>{const e=r.addExecution(),[s]=await Promise.all([z(()=>import("./BcdXOdZr.js"),__vite__mapDeps([36,5,4,6,7,8,9,10,11,2,37,38,24,17,18,19,20,39,40,41,42,43,44,45,46,47,48,22,23,25,26,27,21,28,29,15,30,14,31,32,49]),import.meta.url).then(u=>u.default)]),i=r.modules.screen.contentLayout,a=new be(new w(i.position,d(()=>i.position+i.size)));a.options.display.background=r.config.get(k.WEB_PAINTING_DISPLAY_BACKGROUND),a.options.display.foreground=r.config.get(k.WEB_PAINTING_DISPLAY_FOREGROUND);const n=q({fsItem:null,app:a}),o=t.addWindow({title:"WebPainting - Extras 1.3",component:s,componentData:{model:n,setApp:u=>{n.app=u}},options:{scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1,embed:!0}},{group:"extras13WebPainting",full:!0});n.actions={close:()=>{o.close()},focus:()=>{o.focus()}},e()}}const k={WEB_PAINTING_DISPLAY_BACKGROUND:"extras13_web_painting_display_background",WEB_PAINTING_DISPLAY_FOREGROUND:"extras13_web_painting_display_foreground"},ye={[k.WEB_PAINTING_DISPLAY_BACKGROUND]:"#CCCCCC",[k.WEB_PAINTING_DISPLAY_FOREGROUND]:"#FFFFFF"},Me={CONTENT:"content",OUTPUT_TYPE:"type"};function Te(r){return async({modules:t})=>{const e=r.addExecution(),[s]=await Promise.all([z(()=>import("./BqDxP7KI.js"),__vite__mapDeps([50,2,19,20,17,18,39,40,45,46,47,48,41,42,51]),import.meta.url).then(i=>i.default)]);t.windows.addWindow({component:s,componentData:{},options:{title:"Base64 Converter",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}},{group:"extras13Base64Converter"}),e()}}const Ie=({core:r})=>(r.config.setDefaults(ye),r.config.setDefaults(Ct),{locked:!0,meta:[[b.SYMBOL,y.DISK_WORKBENCH13],[b.WINDOW_SIZE,d(320,220)],[b.WINDOW_POSITION,d(310,10)],[b.WINDOW_SYMBOL_REARRANGE,!0]],name:"Extras 1.3",items:[{id:"Tools",name:"Tools",meta:[[b.WINDOW_SIZE,d(160,120)],[b.WINDOW_SYMBOL_REARRANGE,!0]],createdDate:new Date(2024,8,9).getTime(),editedDate:new Date(2024,8,9).getTime(),items:[{meta:[[b.SYMBOL,y.DEFAULT]],id:"Base64Converter.app",name:"Base64Converter",createdDate:new Date(2023,8,4).getTime(),editedDate:new Date(2023,8,4).getTime(),action:Te(r)}]},{meta:[[b.SYMBOL,y.WEB_PAINTING]],id:"WebPainting.app",name:"WebPainting",createdDate:new Date(2017,7,5).getTime(),editedDate:new Date(2020,3,14).getTime(),action:ge(r)},{meta:[[b.SYMBOL,y.WEB_BASIC],[b.WINDOW_SIZE,d(360,200)]],id:"WebBasic.app",name:"WebBasic",createdDate:new Date(2017,7,5).getTime(),editedDate:new Date(2020,3,14).getTime(),action:wt(r)},Rt]}),Fe=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"}));export{be as A,w as B,g as C,_e as D,Me as P,k as a,fe as b,Ot as c,_ as d,it as g,Fe as i};
