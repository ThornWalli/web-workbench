var ae=Object.defineProperty;var re=(a,r,n)=>r in a?ae(a,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[r]=n;var H=(a,r,n)=>re(a,typeof r!="symbol"?r+"":r,n);import{I as se,a as ue,C as ie}from"./Br_8hjjw.js";import{T as ce,C as fe}from"./Bu9-HbQ4.js";import{v as me,x as pe,u as de}from"./ZHhSaUdj.js";import{E as ve}from"./Cz6ozejB.js";import{K as C}from"./B2exwp0w.js";import{u as he}from"./Dq_gnHze.js";import{d as Ce,r as l,O as $,L as we,k as N,a0 as S,o as ye,U as ge,a1 as U,W as Re,y as Ee,z as Se,A as _,C as _e,G as Ie,$ as Oe,_ as Ae}from"./Bx1Gqxs7.js";import"./9V19AFUE.js";import"./Cpj98o6Y.js";import"./CpIyErmU.js";import"./RAasLaaH.js";import"./D4lI5vpz.js";import"./DdQrQ7-5.js";import"./6C4StZv5.js";import"./DNvW6rqi.js";import"./6jpuwjT2.js";import"./jI0uH-Zs.js";import"./A4CL5M2A.js";import"./DG6QdPnO.js";import"./On0xenC3.js";import"./CZZPvNTk.js";import"./djI3_XgP.js";import"./Ce6njBYG.js";import"./BE-N3i2n.js";import"./DI3A0fxi.js";import"./BlhZwPhK.js";import"./DLyaWjaL.js";import"./BWR5uye1.js";import"./CV0dHcg-.js";class Te extends se{constructor(n={}){const{onAdd:i}={onAdd:null,...n};super(n);H(this,"onAdd");this.onAdd=i||(()=>{})}add(n,i){let f="",w=!1;typeof n=="string"&&me(n)?w=!0:(n instanceof ce&&(f=n.toColumnify().split(/\n/g)),typeof n=="string"&&pe(n)&&(f=de(n))),typeof n=="string"&&/^> \w+/.test(n)?this.onAdd(n,i):(w||f.length)&&this.onAdd(f,i)}}const Le={class:"wrapper"},xe={class:"input"},ke=["innerHTML"],be=Ce({__name:"Console",props:{rootElement:{type:HTMLElement,default(){return null}},showIntroduction:{type:Boolean,default(){return!1}},delimiterPrefix:{type:String,default:"1.SYS"},readonly:{type:Boolean,default:!1},startCommands:{type:[Array,String],default:null},preRows:{type:Array,default(){return[]}}},emits:["freeze","unfreeze","startCommandsComplete","refresh"],setup(a,{emit:r}){const{window:n,core:i,parentFocused:f,parentLayout:w}=he();let I=1;const O=l(null),y=l(null),V=l(null),A=l(null),m=a,g=r,P=$(new ue);P.add([new fe({name:["CLS","CLEAR"],action(){Z()}})]);const K=l($(new Te({core:i,consoleInterface:new ie,onAdd:D}))),d=l({value:"",focused:!1}),p=l([]),c=l(0),R=l(0),v=l([`[CLI ${I}]`]),s=l(-1),j=l(18),E=l({value:m.delimiterPrefix,prompt:!1,confirm:!1}),F=l(null),W=l(null),T=l(null),L=l(!1),Y=we({show:!0,logger:K,showCommand:!0,commandBucket:P}),G=N(()=>({"js--prompt":T.value,"js--focused":f.value})),q=N(()=>{let e=E.value.value;const{confirm:t,prompt:o}=E.value;return t?e="(y/n) ?":o?e="?":e&&(e=`${e}:&gt`),e&&(e=`${e}&nbsp;`),e}),J=N(()=>w.value.size);let B;S(()=>J.value,()=>{window.clearTimeout(B),B=window.setTimeout(()=>{h()},200)}),S(()=>F.value,()=>{b({value:""})}),S(()=>W.value,()=>{b({value:m.delimiterPrefix,confirm:W.value})}),S(()=>T.value,()=>{b({value:m.delimiterPrefix,prompt:T.value})}),v.value.unshift(...m.preRows),ye(async()=>{const e=ge();if(e&&e.parent&&"console"in e.parent&&(e.parent.console=this),I++,m.showIntroduction){const t=X();t&&await t.then(()=>x('basic "TMP:CONSOLE_INSTRUCTIONS.basic"',{showCommand:!1}))}U(async()=>{if(m.startCommands){const t=Array().concat(m.startCommands),o=u=>x(u.shift()||"",{showCommand:!1}).then(()=>{if(u.length>0)return o(u)});await o(t),g("startCommandsComplete")}})}),Re(()=>{I--});function Q(e){d.value.value=e}async function x(e,t){s.value=-1,c.value=0,R.value=0,g("freeze");const o=await i.executeCommand(e,{...Y,...t});o&&(typeof o=="number"||typeof o=="string")&&D(o),g("unfreeze"),h(),k(!0)}function X(){var t;const e=["#basic","CLS",'PRINT "Scroll (Up/Down): <strong>Shift+Up</strong> / <strong>Shift+Down</strong>"','PRINT "Enter <strong>commands</strong> to show all commands."'];return(t=i.modules.files)==null?void 0:t.fs.createTmpFile("CONSOLE_INSTRUCTIONS.basic","CONSOLE_INSTRUCTIONS.basic",{type:"basic",content:e})}function Z(){R.value=v.value.length,h()}function h(){if(O.value&&y.value){y.value.innerHTML="";const e=Math.floor(O.value.offsetHeight/j.value)-2;let t=0;for(;c.value+t<c.value+e;){const o=v.value[Math.max(v.value.length-e-c.value,0)+t];if(o!==void 0){const u=document.createElement("li");u.innerHTML=String(o).replace(/[\\]?\\n/,"<br>")+`
`,y.value.appendChild(u)}else break;t++}}}function k(e){U(()=>{e&&(L.value={scroll:!0},g("refresh",L.value),U(()=>{L.value=null}))})}function ee(e){let t=!1;e?R.value>0?(R.value=0,t=!0):c.value<v.value.length&&(c.value++,t=!0):c.value>0&&(c.value--,t=!0),t&&h()}function b(e,t=!1,o=!1){E.value={...E,value:e,prompt:t,confirm:o}}function D(e){const t=[];Array.isArray(e)?t.push(...e):t.push(String(e)),v.value.push(...t),h()}function te(){d.value.focused=!0}function ne(e){return p.value[p.value.length-1]!==e&&p.value.push(e),d.value.value="",x(e)}function oe(){d.value.focused=!1,k(),n.unfocus()}function le(e){var u,z;const t=e.code;let o=!1;if(((u=A.value)!=null&&u.controlCapsLockActive||(z=A.value)!=null&&z.controlShiftActive)&&(t===C.ARROW_UP||t===C.ARROW_DOWN))e.preventDefault(),ee(t===C.ARROW_UP);else{switch(t){case C.ARROW_UP:s.value++,s.value=Math.min(s.value,p.value.length-1),o=!0;break;case C.ARROW_DOWN:s.value--,s.value=Math.max(s.value,-1),o=!0;break}if(o&&p.value.length>0){let M;s.value<0?M="":M=p.value[p.value.length-1-s.value],d.value.value=M}k()}}return(e,t)=>(Se(),Ee("div",{ref_key:"rootEl",ref:O,class:Oe(["wb-env-console",G.value]),onClick:te},[_("div",Le,[_("ul",{ref_key:"consoleOutputEl",ref:y,class:"output typo-style"},null,512),_("div",xe,[_("span",{ref_key:"consoleCommandDelimiterEl",ref:V,class:"prefix",innerHTML:q.value},null,8,ke),_e(ve,{ref_key:"inputEl",ref:A,"root-element":a.rootElement||e.$el,class:"element",multiline:!1,"override-focused":Ie(f),readonly:a.readonly,"model-value":d.value.value,onBlur:oe,"onUpdate:modelValue":Q,onEnter:ne,onKeydown:le},null,8,["root-element","override-focused","readonly","model-value"])])])],2))}}),it=Ae(be,[["__scopeId","data-v-20124ac2"]]);export{it as default};
