var ce=Object.defineProperty;var me=(y,a,t)=>a in y?ce(y,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):y[a]=t;var L=(y,a,t)=>me(y,typeof a!="symbol"?a+"":a,t);import{P as pe,D as de}from"./BY0KaPQX.js";import{C as I}from"./BJmh0rUk.js";import{g as fe,c as Z}from"./DB5cYTSw.js";import{C as ve}from"./C9SoOunh.js";import{i as s,p as ye}from"./BGIFtisS.js";import{t as he,j as be,I as j,q as _e}from"./DcEGgYs5.js";import{d as U}from"./DtRunxS3.js";import{n as ge}from"./DYHHCWM9.js";import{t as A,v as E,x as C,d as te,r as g,I as Se,j as u,a0 as k,o as se,W as oe,X as re,Y as ae,C as q,N as J,O as we,aa as Ie,A as Ee,F as xe,D as ne,_ as le,K as Me,a1 as ee,Z as Ce,$ as ze}from"./DepUWdG1.js";import{u as Oe}from"./hgdfUW9W.js";import{S as Pe}from"./6C4StZv5.js";import{f as We}from"./DIR0ob6O.js";const Ze=2e3;function Je(){return{[I.SCREEN_1084_FRAME]:!0,[I.SCREEN_REAL_LOOK]:!0,[I.SCREEN_SCAN_LINES]:!0,[I.SCREEN_ACTIVE_ANIMATION]:!0,[I.BOOT_WITH_SEQUENCE]:!0,[I.BOOT_WITH_WEBDOS]:!0,[I.THEME]:pe[de],[I.FILE_EXTENSION_ASSIGNMENT]:[["md","DF0:DocumentReader.app"],["bas","DF1:WebBasic.app"],["basic","DF1:WebBasic.app"]],[I.SCREEN_CONFIG]:{contrast:.5,brightness:.5,color:.5,sharpness:0,horizontalCentering:.5,soundVolume:.5}}}const et="web_workbench_CONFIG";class tt{constructor({name:a,core:t,config:h={},commands:z,contextMenu:o}){L(this,"config");L(this,"commands");L(this,"name");L(this,"core");L(this,"contextMenu");this.name=a||"Module",this.core=t,this.config=h,this.commands=z,this.contextMenu=o}beforeSetup(){var t,h;const a=this.core;a.config.setDefaults(this.config),typeof this.commands=="function"&&(this.commands=fe(this.commands({core:a,module:this})),Z.add(this.commands)),typeof this.contextMenu=="function"&&(this.contextMenu=new ve(this.contextMenu,{core:a,module:this}),(h=(t=this.core.modules.windows)==null?void 0:t.contextMenu)==null||h.addDefaultItems(this.contextMenu))}setup(){this.log(this.name)}destroy(){Array.isArray(this.commands)&&Z.remove(this.commands)}log(a){this.core.logger.add(a,{namespace:this.name})}}const Le={xmlns:"http://www.w3.org/2000/svg",width:"31",height:"30",class:"wb_symbol_disk_1"};function ie(y,a){return E(),A("svg",Le,a[0]||(a[0]=[C("path",{d:"M0 0h25v2h2v2h2v2h2v24H0z",class:"svg-secondary"},null,-1),C("path",{fill:"#FFF",d:"M2 2v26h27V6h-2V4h-2V2",class:"svg-primary"},null,-1),C("path",{fill:"#FA5",d:"M7 2h13v10H7z",class:"svg-tertiary"},null,-1),C("path",{d:"M11 2h5v8h-5z",class:"svg-secondary"},null,-1)]))}const ue={render:ie},st=Object.freeze(Object.defineProperty({__proto__:null,default:ue,render:ie},Symbol.toStringTag,{value:"Module"})),Ne=["data-id"],Te={key:0},Fe=["innerHTML"],Be=te({__name:"Item",props:{parentLayout:{type:Object,default(){return null}},clampGlobal:{type:Boolean,default:!1},container:{type:Boolean,default(){return!1}},item:{type:he,default(){return{id:null,command:null,model:{title:"Item Title",url:null,symbol:ue,used:!1,visible:!0},layout:{position:s(0,0),size:s(50,50)}}}},scrollOffset:{type:Object,default(){return s(0,0)}},wrapper:{type:Object,default:null}},emits:["click"],setup(y,{emit:a}){var K,X;const t=y,{core:h}=Oe(),z=a,o=g(t.wrapper.selectedItems),n=g(null),x=g(!1),c=Se({start:s(0,0),move:s(0,0),lastPosition:s(0,0),offset:s(0,0),scrollOffset:s(0,0)}),D=new Pe,N=g(null),O=g(null),T=(K=h.value)==null?void 0:K.modules.screen,f=(X=h.value)==null?void 0:X.modules.symbols,R=u(()=>t.item.command),b=u(()=>t.item.id),m=u(()=>t.item.model),v=u(()=>t.item.layout),G=u(()=>m.value.url?"a":"span"),V=u(()=>m.value.url?{href:m.value.url,target:m.value.url?"_blank":null,title:m.value.title}:{}),P=u(()=>(T==null?void 0:T.contentLayout)||{position:s(0,0),size:s(0,0)}),F=u(()=>o.value.includes(b.value)),$=u(()=>({moving:x.value,selected:F.value,"symbol-used":m.value.used}));k(()=>m.value,()=>{e()},{deep:!0}),se(()=>{var r;O.value=(r=N.value)==null?void 0:r.parentElement,e()}),oe(()=>{D.unsubscribe(),t.wrapper.unselectItem(b)});function M(r){t.item.setLayout(r)}let B;function e(){M({size:s(200,200)}),window.cancelAnimationFrame(B),B=window.requestAnimationFrame(()=>{var i;const r=(i=N.value)==null?void 0:i.children[0];r&&r instanceof HTMLElement&&M({size:s(r.offsetWidth||0,r.offsetHeight||0)})})}function l(r){const{width:i,height:p,left:_,top:d}=r.getBoundingClientRect();return{position:s(_,d),size:s(i,p)}}function S(r){var p;r=ge(r);const i=b.value;if(!(m.value.url&&F.value)&&(r.preventDefault(),!m.value.used)){if(R.value&&F.value){const _={showCommand:!1,show:!0};return t.wrapper.unselectItem(i),m.value.used=!0,(p=h.value)==null?void 0:p.executeCommand(R.value,_).then(()=>m.value.used=!1)}U.shiftActive?t.wrapper.isSelectedItem(i)?t.wrapper.unselectItem(i):t.wrapper.selectItem(i):(f&&f.getSelectedItems().length>0&&f.clearSelectedItems(),t.wrapper.selectItem(i)),H(s(r.x,r.y)),z("click")}}function w(){if(f){const r=f.getSelectedItems().filter(p=>p.id!==b.value),i=t.wrapper.get(b.value);r.length>0&&i.fsItem instanceof be&&r.forEach(p=>t.wrapper.moveItemToItem(p.fsItem,i.fsItem))}}function H(r){if(O.value){const i=l(O.value);c.lastPosition=s(v.value.position.x,v.value.position.y),c.scrollOffset=s(t.scrollOffset.x,t.scrollOffset.y),c.start=r,c.offset=s(()=>c.start-v.value.position),W(r,i,!0),x.value=!0;let p=r;const _=U.pointerMove.subscribe(d=>{p=s(d.x,d.y),W(s(d.x,d.y),i,!0)});D.add(U.pointerUp.pipe(We()).subscribe(()=>{if(_.unsubscribe(),f&&f.getSecondaryWrapper().id!==t.wrapper.id)return t.wrapper.moveItem(b.value,f.getSecondaryWrapper()).then(d=>{var Y,Q;return d||M({position:s((Y=c.lastPosition)==null?void 0:Y.x,(Q=c.lastPosition)==null?void 0:Q.y)}),n.value=null,x.value=!1,d});if(x.value=!1,W(p,i),!v.value.position.equals(s(()=>c.start-c.offset)))return t.wrapper.savePosition(b.value,v.value.position)}))}}function W(r,i,p=!1){const _={min:s(0,0),max:s(()=>i.size-v.value.size)};c.move=s(()=>r-c.start);let d=s(()=>Math.round(c.start+c.move-c.offset));p?(_.min=i.position,_.max=s(()=>_.max+P.value.position),d=s(()=>Math.round(d+_.min)),t.clampGlobal?n.value=s(()=>Math.max(Math.min(d,P.value.position+t.wrapper.size-v.value.size),_.min)):n.value=d):(t.wrapper.root?M({position:s(()=>Math.max(Math.min(d,t.wrapper.size-v.value.size),0))}):M({position:s(()=>Math.max(d,0))}),n.value=null)}return(r,i)=>(E(),A("figure",{ref_key:"rootEl",ref:N,"data-id":b.value,class:ae(["wb-env-atom-symbol-wrapper-item",$.value]),style:re([v.value.size.toCSSVars("item-size"),(n.value||v.value.position).toCSSVars("item-position")]),"touch-action":"none",onPointerdown:S,onPointerup:w},[(E(),q(J(G.value),we(Ie(V.value)),{default:Ee(()=>{var p;return[m.value.symbol?(E(),A("i",Te,[(E(),q(J((p=ne(f))==null?void 0:p.symbols.get(m.value.symbol))))])):xe("",!0),C("figcaption",{innerHTML:m.value.title},null,8,Fe)]}),_:1},16))],46,Ne))}}),ke=le(Be,[["__scopeId","data-v-92c10949"]]),Ae=te({__name:"SymbolWrapper",props:{core:{},parentLayout:{},parentScrollable:{type:Boolean},parentFocused:{type:Boolean},clampSymbols:{type:Boolean},wrapperId:{}},emits:["ready","refresh"],setup(y,{emit:a}){var B;const t=g(null),h=g(null),z=g(null),o=y,n=g((B=o.core.modules.symbols)==null?void 0:B.get(o.wrapperId))||g(new j(o.core)),x=a,c=u(()=>n.value.items.value),D=g(n.value.selectedItems),N=Me(o.core.config.observable),O=u(()=>n.value.layout),T=u(()=>{var e;return{"parent-scrollable":o.parentScrollable,active:(((e=o.core.modules.symbols)==null?void 0:e.primaryWrapper)||{}).id===n.value.id}}),f=u(()=>o.parentLayout&&"scrollOffset"in o.parentLayout?o.parentLayout.scrollOffset:s(0,0)),R=u(()=>{var l;const e=[(l=f.value)==null?void 0:l.toCSSVars("symbol-wrapper-scroll-offset")];return o.parentScrollable?e.push(b.value.toCSSVars("symbol-wrapper-size")):e.push(O.value.size.toCSSVars("symbol-wrapper-size")),e}),b=u(()=>c.value.map(e=>({item:e,index:D.value.indexOf(e.id)+1})).sort((e,l)=>e.index>l.index?1:e.index<l.index?-1:0).reduce((e,{item:l})=>{const S=l.layout.position.x+l.layout.size.x,w=l.layout.position.y+l.layout.size.y;return e.x=e.x<S?S:e.x,e.y=e.y<w?w:e.y,e},ye(0,0))),m=u(()=>N[_e.SHOW_INVISIBLE_SYMBOLS]),v=u(()=>c.value.filter(F)),G=u(()=>(o.parentLayout||{}).size);k(()=>o.parentFocused,e=>{V(e)}),k(()=>o.wrapperId,e=>{var l;(l=o.core.modules.symbols)==null||l.get(e),P()}),k(()=>G,()=>{P()}),k(()=>b,()=>{ee(()=>{x("refresh",{scroll:!0})})}),se(()=>{ee(()=>{P(),V(o.parentFocused),x("ready")})}),oe(()=>{var e,l,S,w,H,W;(e=o.core.modules.symbols)!=null&&e.getPrimaryWrapper()&&((l=o.core.modules.symbols)==null?void 0:l.getPrimaryWrapper().id)===n.value.id&&((S=o.core.modules.symbols)==null||S.setPrimaryWrapper(null)),(w=o.core.modules.symbols)!=null&&w.getSecondaryWrapper()&&((H=o.core.modules.symbols)==null?void 0:H.getSecondaryWrapper().id)===n.value.id&&((W=o.core.modules.symbols)==null||W.setSecondaryWrapper(null))});function V(e=!1){o.core.modules.symbols&&(e?n.value instanceof j&&o.core.modules.symbols.setPrimaryWrapper(n.value):o.core.modules.symbols.getPrimaryWrapper()&&o.core.modules.symbols.getPrimaryWrapper().id===n.value.id&&o.core.modules.symbols.setPrimaryWrapper(null))}function P(){if(t.value){const{left:e,top:l}=t.value.getBoundingClientRect();n.value.setLayout({position:s(e,l),size:o.parentLayout.size}),n.value.setSize(s(t.value.offsetWidth,t.value.offsetHeight)),n.value.setParentSize(o.parentLayout.size)}}function F(e){return m.value||!m.value&&e.model.visible}function $(){var e;n.value instanceof j&&((e=o.core.modules.symbols)==null||e.setSecondaryWrapper(n.value))}function M(e){(e.target===h.value||e.target===z.value)&&n.value.clearSelectedItems()}return(e,l)=>(E(),A("div",{ref_key:"rootEl",ref:t,class:ae(["wb-env-symbol-wrapper",T.value]),style:re(R.value),onPointerdown:M,onPointermove:$},[C("div",{ref_key:"helperEl",ref:h,class:"helper"},null,512),C("div",{ref_key:"itemsEl",ref:z,class:"items"},[(E(!0),A(Ce,null,ze(v.value,(S,w)=>(E(),q(ke,{key:w,item:S,"clamp-global":e.clampSymbols,wrapper:ne(n),"parent-layout":O.value,"scroll-offset":f.value},null,8,["item","clamp-global","wrapper","parent-layout","scroll-offset"]))),128))],512)],38))}}),ot=le(Ae,[["__scopeId","data-v-84014d10"]]);export{Ze as B,et as C,tt as M,ot as W,st as d,Je as g};
