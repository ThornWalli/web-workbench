const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./TWJ6Icoe.js","./DepUWdG1.js","./CNkvSXuu.js","./BY0KaPQX.js","./C5mdboMC.js","./BJmh0rUk.js","./CgHJs8D8.js","./C3zvzGZe.css","./ouyT7PHM.js","./pCkh-wP3.css","./BTBmRolL.js","./B_usvsmx.css","./DoBqXM-L.js","./D_5tq7_O.css","./C8kdTkyf.js","./iKMg5t-_.css","./RHmh6MO8.js","./8q2Z1dNm.css","./CJrV-oJY.js","./C9SoOunh.js","./hgdfUW9W.js","./BDV1uWkE.js","./D5m4u8d2.js","./CXbNF4JJ.css","./CL53rMPt.css","./Bu130mQ-.js","./DEd3YzG8.js","./sTv0fu1X.js","./iZ1DQg6G.css","./1X6MrxDz.js","./QFyeECXp.css","./Bo2D8T6P.css","./DAmX6ORD.js","./DcEGgYs5.js","./BGIFtisS.js","./RAasLaaH.js","./D4lI5vpz.js","./DdQrQ7-5.js","./6C4StZv5.js","./CSlkdJUE.js","./Crnau0sa.js","./BOXo5Fuj.css","./B0vCzVqO.css","./pXS4ZTPS.js","./D-PMk-5t.js","./CuslVMR9.js","./BSpeqbCM.css","./SrmTDuH6.css","./uOA4b3M2.css","./BPOtYdVz.js","./D0Z5k6NX.css","./33-aPMrx.js","./DIR0ob6O.js","./c7yvS0cq.js","./BIzvQSzn.css","./CQ8j2mzx.js","./cfaNwG5f.css","./DWcwTzDj.js","./uYZ_NxVx.css","./PS5SoCZn.js","./Cd9UeY_V.js","./CfrwDXeG.js","./AyGIKDDV.js","./CCb_aLi_.js","./CXIFHnCy.css","./DuRZ77ma.js","./C8jtdYnp.js","./YQZY2WiX.js","./DxN6T3Eb.js","./DBY-TPLx.js","./D4Eys56B.js","./DM13WIpn.js","./BVJ9ZQs1.js","./DB5cYTSw.js","./Cpj98o6Y.js","./DtRunxS3.js","./DYHHCWM9.js","./DN3eHOnZ.js","./Ce6njBYG.js","./nufkX4jA.js","./ITCLPEJ-.css","./PIY7Fxsh.js","./CpKgHQdz.js","./BDDIUDB7.js","./Dc4CyA3k.js","./CLfbuiHm.js","./0e3xVbwT.js","./B9R4RqQk.js","./ddNVbTB1.js","./BqI57yGT.js","./BnUYaBTP.js","./hKONtwb2.js","./DMKDWS0n.js","./C8P-FY5n.js","./CDfc0YQ-.js","./D2stiSYP.js","./PdZEp8mc.js","./9QeckQhW.js","./CntqoV1v.js","./Chbmc6j2.js","./OWHxvJKP.js","./CIEO4uhY.js","./D2cNQHja.js","./0zf-5E6l.js","./B1XBBOEp.js","./jEEiKj_P.js","./CTeCj-It.js","./DsuRpeu2.js","./Bpv_BcSV.js","./Dk_J3ibT.js","./CmIGOicc.js","./CTl8GMYu.js","./DBxlfuvc.js","./BFeMLmMi.js","./DNlKV1jE.js","./C1CMnKdE.js","./CDl6MwL_.js","./BC7DO-uu.js","./BU4F8h9z.js","./kXaLjbmr.js","./-yaVoX4I.js","./BM1Z0Rpo.js","./AB-hjmGo.js","./KSJzhc0X.js","./B4WIvlbm.js","./DueUY6TH.js","./D8NcHpdc.js","./D1UQUYqe.js","./D_BvfAz4.js","./BS_RkiIy.js"])))=>i.map(i=>d[i]);
var Wt=Object.defineProperty;var nt=a=>{throw TypeError(a)};var Vt=(a,e,t)=>e in a?Wt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var E=(a,e,t)=>Vt(a,typeof e!="symbol"?e+"":e,t),ot=(a,e,t)=>e.has(a)||nt("Cannot "+t);var m=(a,e,t)=>(ot(a,e,"read from private field"),t?t.call(a):e.get(a)),v=(a,e,t)=>e.has(a)?nt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t),L=(a,e,t,r)=>(ot(a,e,"write to private field"),r?r.call(a,t):e.set(a,t),t);var U=(a,e,t,r)=>({set _(i){L(a,e,i,t)},get _(){return m(a,e,r)}});import{c as tt}from"./C5mdboMC.js";import{C as kt,d as fe,A as d,T as le,c as oe,a as lt,L as Ye,g as Mt,p as Ft}from"./DB5cYTSw.js";import{g as Bt,T as yt,u as T,e as S,c as ct,i as X,d as Ge,w as Ne,f as Ut,h as Xe,j as It,D as je,p as Yt,k as Oe,F as be,R as Gt,l as Xt,m as mt,n as ut,S as jt,C as zt,o as Ht,a as ze,W as dt,q as N,O as K,r as Ee,s as xe,I as Fe,E as $e}from"./DcEGgYs5.js";import{g as pt,C as Kt,M as ke,W as Zt}from"./BVJ9ZQs1.js";import{I as pe,H as g,m as Qt,K as D,a9 as qt,t as ce,v as q,x as J,d as vt,j as He,F as _e,z as Ce,D as ft,X as Jt,_ as At,r as er,A as tr,C as ht}from"./DepUWdG1.js";import{C as rr}from"./BJmh0rUk.js";import{I as b,d as rt,M as W,S as _}from"./hgdfUW9W.js";import{S as Ke}from"./RAasLaaH.js";import{R as ar}from"./BVsX1iIx.js";import{a as Ze,b as gt,l as sr,r as ir,s as Le,c as nr}from"./DIR0ob6O.js";import{i as at}from"./BGIFtisS.js";import{C as or,a as lr}from"./ey0azPGz.js";import{C as Qe}from"./C9SoOunh.js";import{c as cr}from"./DQWRfqHy.js";import{W as wt}from"./C8kdTkyf.js";import{W as mr}from"./ouyT7PHM.js";import{W as ur}from"./RHmh6MO8.js";import{O as dr,i as Rt}from"./DdQrQ7-5.js";import{p as pr,a as fr,f as Tt}from"./CYq5lAAG.js";import{m as hr,e as gr}from"./DN3eHOnZ.js";import{c as wr}from"./CSlkdJUE.js";import"./Cpj98o6Y.js";import"./BDV1uWkE.js";import"./BY0KaPQX.js";import"./DtRunxS3.js";import"./DYHHCWM9.js";import"./nufkX4jA.js";import"./D4lI5vpz.js";import"./Ce6njBYG.js";import"./6C4StZv5.js";import"./D5m4u8d2.js";import"./c7yvS0cq.js";import"./CJLX7oOC.js";var Er=Array.isArray,_r=Object.getPrototypeOf,Sr=Object.prototype,br=Object.keys;function yr(a){if(a.length===1){var e=a[0];if(Er(e))return{args:e,keys:null};if(Ir(e)){var t=br(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:a,keys:null}}function Ir(a){return a&&typeof a=="object"&&_r(a)===Sr}function vr(a,e){return a.reduce(function(t,r,i){return t[r]=e[i],t},{})}function Ar(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];var t=pr(a),r=fr(a),i=yr(a),s=i.args,n=i.keys;if(s.length===0)return Tt([],t);var o=new dr(Rr(s,t,n?function(l){return vr(n,l)}:Rt));return r?o.pipe(hr(r)):o}function Rr(a,e,t){return t===void 0&&(t=Rt),function(r){Et(e,function(){for(var i=a.length,s=new Array(i),n=i,o=i,l=function(u){Et(e,function(){var w=Tt(a[u],e),p=!1;w.subscribe(wr(r,function(f){s[u]=f,p||(p=!0,o--),o||r.next(t(s.slice()))},function(){--n||r.complete()}))},r)},c=0;c<i;c++)l(c)},r)}}function Et(a,e,t){a?gr(t,a,e):e()}class Tr{constructor(e,t){E(this,"entries",new Map(Object.entries(pt())));E(this,"observable",pe(pt()));E(this,"storage");E(this,"ready");const r=Bt(t||yt.NONE);this.storage=new r({name:e}),this.ready=this.storage.load().then(i=>(this.entries=new Map([...this.entries,...i]),Object.assign(this.observable,Object.fromEntries(this.entries)),this)).catch(i=>{throw i})}setDefaults(e){return Promise.all(Object.keys(e).map(t=>{this.has(t)||this.set(t,e[String(t)])}))}get(e){return this.entries.get(e)}has(e){return this.entries.has(e)}set(e,t){return typeof e=="string"?(this.entries.set(e,t),this.observable[String(e)]=t):e&&typeof e=="object"&&!(e instanceof Map)&&Object.keys(e).forEach(r=>{t=e[r],this.entries.set(r,t),this.observable[r]=t}),this.storage.save(Array.from(this.entries))}}class Dr extends kt{constructor(t){super();E(this,"core");this.core=t}prompt(t){const r=["openDialog","--prompt"];return t&&r.push(`--message="${T(t)}"`),this.core.executeCommand(r.join(" "))}confirm(t){const r=["openDialog","--confirm"];return t&&r.push(`--message="${T(t)}"`),this.core.executeCommand(r.join(" "))}}var ye,Ie;class Pr{constructor(e){v(this,ye);v(this,Ie,[]);L(this,ye,e)}command(e,t){m(this,Ie).push({value:e,targetValue:t})}run(){return Promise.all(m(this,Ie).map(({value:e,targetValue:t})=>m(this,ye).executeCommand(e).then(r=>{const i=r===t;return i||console.warn(`[ ${e} ]; ${r} === ${t}`),{value:e,targetValue:t,result:r,success:i}})))}async start(){const e=await this.run();return[[e.length,"Tests processed"],[e.filter(t=>t.success).length,"Tests success"],[e.filter(t=>!t.success).length,"Tests failed"]]}}ye=new WeakMap,Ie=new WeakMap;const Nr=fe(({core:a})=>[{name:["execute"],description:"Execute file.",args:[new d({index:0,name:"path",description:"Path to the file"})],async action({path:e}){var s,n;let t=e;const r=new Map(a.config.get(rr.FILE_EXTENSION_ASSIGNMENT));if(!t)throw S.get("bad_args");let i;if(r.has(ct(t))?i=await((s=a.modules.files)==null?void 0:s.fs.get(r.get(ct(t)))):(i=await((n=a.modules.files)==null?void 0:n.fs.get(t)),t=void 0),typeof(i==null?void 0:i.action)=="function")return i.action(a,t);if(i!=null&&i.data&&typeof(i==null?void 0:i.data)=="object"&&"type"in i.data){const o=i.data,l=[`openPreview "${i.getPath()}"`];return o.openMaximized&&l.push("-maximized"),a.executeCommand(l.join(" "))}}},{name:["openColorSettings"],async action(){var t;const e=await g(()=>import("./TWJ6Icoe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url).then(r=>r.default);(t=a.modules.windows)==null||t.addWindow({component:e,componentData:{},options:{title:"Color Settings",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}},{name:["openSettings"],async action(){var t;const e=await g(()=>import("./Bu130mQ-.js"),__vite__mapDeps([25,5,6,1,7,14,15,16,17,26,8,9,27,28,29,30,20,21,22,23,31]),import.meta.url).then(r=>r.default);(t=a.modules.windows)==null||t.addWindow({component:e,componentData:{},options:{title:"Settings",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}},{name:["echo","print"],args:[new d({name:["newline","n"],flag:!0})],async action({newline:e},t){const r=i=>T(i).replace(/\\"/g,'"').replace(/\\n/g,`
`);if(e)t.message(t.commandArgs.map(i=>r(i)));else{let i=await t.core.executeCommand(t.commandValue);typeof i=="object"&&(i=JSON.stringify(i)),t.message(`${T(r(i))}`)}}},{name:"commands",action(e,t){const r=new le({headerPadding:1});return r.addColumns([{value:"Command(s)",align:"left",maxWidth:20},{value:"Description/Arguments",align:"left",maxWidth:60}]),r.addRows(oe.items.reduce((i,s)=>{const n=s.args||[],o=[];s.description&&(o.push(s.description),o.push("")),n.length&&(o.push("Arguments:"),o.push(""));const{flagNames:l,kwargNames:c}=n.reduce((w,p)=>{const f=p.name.join(", ");return p.flag?w.flagNames.push({name:`-${f}`,description:p.description}):w.kwargNames.push({name:`--${f}`,description:p.description}),w},{flagNames:[],kwargNames:[]}),u={paddingChr:"Â",showHeaders:!1,config:{name:{minWidth:15},description:{minWidth:10,maxWidth:30}}};return o.push(lt(l,Object.assign({},u))),l.length>0&&c.length>0&&o.push(""),o.push(lt(c,Object.assign({},u))),i.push([s.name.join(", "),o.join(`
`)]),i},[])),t.message(["Commands:",r]),Promise.resolve()}},{name:["CLS","CLEAR"],async action(){a.consoleInterface.clear()}},{name:["prompt","input","PROMPT","INPUT"],args:[new d({index:0,name:"text",description:"Text from prompt."}),new d({index:1,name:"variable",description:"Variable"})],action:({text:e,variable:t,unresolved:r})=>(r.text&&!r.variable?(t=r.text,e=void 0):t=r.variable,a.consoleInterface.prompt(e).then(i=>{var s;return X(i)&&(i=Number(i)),t&&((s=a.modules.parser)==null||s.memory.set(t,i)),i}))},{name:["confirm","CONFIRM"],args:[new d({index:0,name:"text",description:"Text from confirm."})],action({text:e}){return a.consoleInterface.confirm(e)}},{name:["selfCheck"],async action(e,t){const r=new le;r.addColumns([{value:"Count",align:"left",minWidth:8},{value:"Description",align:"left",minWidth:15}]),r.addRows(await Or(a)),t.message(['"Command Tests:"',r,'"For failures, look in the web console of the browser."'])}}]);function Or(a){const e=new Pr(a);return e.command('"foo" +"bar"','"foobar"'),e.command("(-3+-6)+1",-8),e.command("(-3-+6)+1",-8),e.command("(-3*-6)+1",-3*-6+1),e.command("(-3/-6)+1",-3/-6+1),e.command("(-3+6)+1",4),e.command("(-3-6)+1",-8),e.command("(-3*6) + 1",-3*6+1),e.command("(-3/6)+1",-3/6+1),e.command("INT(PI)",3),e.command("(POW(2,2)+1)",5),e.command('ASC("D")',68),e.command("CHR$(68)",'"D"'),e.command('LEN("ABC")',3),e.command('"a" + "b"','"ab"'),e.command("STRING$(3,0)",'"000"'),e.command("SQRT(2,2)",Math.sqrt(2)),e.command("128 >> (256 + 5)",4),e.command("-2+4+SQRT(2,2)",2+Math.sqrt(2)),e.command("-2- 2 * 2",-2-2*2),e.command("(1+1)",2),e.command("2*2",2*2),e.command("1+2+3+(POW(2,2)+1)+5*8-(50/2)",6+(2**2+1)+5*8-50/2),e.start()}const{version:Lr}=Qt().public,ae=class ae{constructor(){E(this,"setupComplete",!1);E(this,"events",D(new Ke));E(this,"errorObserver",D(new Ke));E(this,"ready",D(new ar(0)));E(this,"modules",{});E(this,"consoleInterface",new Dr(this));E(this,"logger",new Ye({core:this,debug:!1,consoleInterface:this.consoleInterface}));E(this,"executionCounter",0);E(this,"config",new Tr(Kt,yt.SESSION));this.log(`${ae.NAME}; ${ae.VERSION}`)}get version(){return ae.VERSION}addExecution(){return this.executionCounter++,()=>{this.executionCounter--}}async setup({rootItems:e,disks:t}={}){var i;if(this.setupComplete)return console.warn("Setup is complete!"),this;this.setupComplete=!0,oe.add(Mt(Nr({core:this}))),await this.config.ready;const r=Object.values(this.modules);return await Promise.all(r.map(s=>Promise.resolve(s==null?void 0:s.beforeSetup()))),await Promise.all(r.map(s=>Promise.resolve(s==null?void 0:s.setup()))),t&&((i=this.modules.files)==null||i.addDisks(t)),e!=null&&e.length&&await this.addRootItems(await e({core:this})),this.ready.next(this),this}destroy(){oe.clear()}addModule(e,t){const r=new e({core:this,...t});this.modules[tt(r.name)]=r}async removeModule(e){await e.destroy(),Reflect.deleteProperty(this.modules,e.name)}executeCommands(e){const t=e.shift();if(t)return this.executeCommand(t).then(()=>this.executeCommands(e))}async executeCommand(e,t){var o,l,c;typeof e=="string"&&(e=e.replace(/(.*[^\\])\n(\S*)/gm,"$1\\n$2"));const r=(t==null?void 0:t.show)||!1,i=[];(Array.isArray(t==null?void 0:t.message)||typeof(t==null?void 0:t.message)=="string")&&i.push(...i.concat(t==null?void 0:t.message));const s={commandBucket:oe,core:this,logger:this.logger,show:r,...t,message:u=>{if(r){let w=u;typeof u=="string"&&(u=u.replace(/\\n/g,`
`),w=`"${u}"`),i.push(...[].concat(w))}}};let n;try{if(e){const u=await((o=this.modules.parser)==null?void 0:o.parseCommand(e));u&&((l=s.commandBucket)!=null&&l.has(u.command)?n=await _t(e,u,s.commandBucket,s):oe.has(u.command)?n=await _t(e,u,oe,s):(c=this.modules.parser)!=null&&c.isMathValue(e)?n=await this.modules.parser.parseMath(e):/^\w+$/.test(e)&&console.warn(`can\\'t use variable or method "${e}"`))}}catch(u){let w=u;Array.isArray(u)&&(w=new Error(u[u.length-1])),this.errorObserver.next(w)}return n!==void 0&&n!=="undefined"&&typeof n=="string"&&s.show&&i.length<1&&i.push(n),i.forEach(u=>{var w;return(w=s.logger)==null?void 0:w.add(u,{type:Ye.TYPE.OUTPUT})}),n}addRootItems(e){var r;const t=(r=this.modules.files)==null?void 0:r.fileSystem;return Promise.all(e.map(async({id:i,name:s,data:n,meta:o,items:l})=>{if(l&&l.length){const c=await(t==null?void 0:t.createRootDir("Press","Press",{meta:[[b.WINDOW_SIDEBAR,!1],[b.WINDOW_SCALE,!1],[b.WINDOW_SCROLL_X,!1],[b.WINDOW_SCROLL_Y,!1],[b.POSITION,{x:80,y:320}],[b.WINDOW_SIZE,{x:120,y:120}],[b.IGNORE_SYMBOL_REARRANGE,!0]]}));return c==null||c.addItems(l),c}else return t==null?void 0:t.createRootFile(i,s,n,{meta:o||[]})})).catch(i=>{throw new Error(i)})}log(e){this.logger.add(e,{namespace:"Core"})}};E(ae,"VERSION",Lr||"0.0.0"),E(ae,"NAME","web-workbench");let qe=ae;async function _t(a,e,t,r){var s;const i=t.get(e.command);if(i){const n=r.show,o=Ft(i,e),l=await i.action(o,Object.assign({command:e.command,commandValue:e.commandValue,commandArgs:e.args},r));return n&&r.showCommand&&((s=r.logger)==null||s.add("> "+a,{type:Ye.TYPE.OUTPUT})),l}}var Je=(a=>(a.STRING="string",a.ANY="any",a.INTEGER="integer",a.TERM="term",a.BOOLEAN="boolean",a.DOUBLE="double",a))(Je||{});function Se(a,e){return a.separator===e}function $r(a){return{rawCommand:"",mergeArgs:!1,mergeArgsBy:/^[+,]$/,hasProgram:!1,activeArgument:void 0,isLongArgument:!1,isKeyWordArgument:!1,isString:!1,stringTmpValue:void 0,additionSpecial:!1,specialChar:["+",";",","],isBufferWrite:!1,isBufferValue:!1,isBufferString:!1,rawBuffer:void 0,lastChar:void 0,isSeparating:!1,escaped:!1,currentTick:Nt,isClamp:!1,...a,separator:a.separator||Dt}}function se(a,{separator:e,forceProgram:t,mergeArgs:r,mergeArgsBy:i}={}){var o,l;const s=$r({separator:e||Dt});a=`${String(a).trim()}${s.separator}`,s.rawCommand=a,s.mergeArgs=r||!1,s.mergeArgsBy=i||s.mergeArgsBy;const n=[];for(;s.rawCommand.length;){const c=s.rawCommand[0];s.rawCommand=s.rawCommand.slice(1);const u=s.rawCommand[0];if(Se(s,u)){if(s.isSeparating&&Se(s,c))s.isSeparating=!1;else if(!s.isBufferWrite&&Se(s,c)){s.isSeparating=!0;continue}}else s.isSeparating=!1;if((Se(s,c)&&!s.isClamp||s.rawCommand.length<1)&&(!s.escaped&&s.isBufferValue&&!s.isBufferString&&(s.isBufferWrite=!1),!s.isBufferWrite&&(s.isBufferValue&&Xr(s),s.activeArgument))){Gr(s,n);continue}if(c===Pt&&s.activeArgument){s.isKeyWordArgument=!0;continue}else if((c===Be&&(/[ +a-zA-Z]/.test(u)||u===Be)||s.activeArgument&&!s.isKeyWordArgument)&&!s.isBufferWrite&&!s.specialChar.includes(c))if(s.activeArgument){!((l=(o=s.activeArgument)==null?void 0:o.name)!=null&&l.length)&&c===Be?s.isLongArgument=!0:s.activeArgument.name+=c;continue}else{s.activeArgument={name:re},s.isLongArgument&&(s.activeArgument.long=s.isLongArgument);continue}Ur(s,c)}return kr(n,{forceProgram:t,mergeArgs:r,mergeArgsBy:i})}function xr(a){var e,t,r;return((e=a.value)==null?void 0:e.type)==="any"&&!a.name&&((t=a.value)==null?void 0:t.raw)&&/^[a-zA-Z]+$/.test((r=a.value)==null?void 0:r.raw)||!1}function Cr(a){var e;return((e=a.value)==null?void 0:e.raw)==="+"}function Wr(a,e=/^[+]$/){return a.reduce((t,r)=>{var n,o,l,c,u,w;const i=(o=(n=t[t.length-1])==null?void 0:n.value)==null?void 0:o.raw,s=i&&i[String(i).length-1];if(typeof e=="string"&&(String((l=r.value)==null?void 0:l.raw)===e||String(s)===e)||e instanceof RegExp&&(e.test(String((c=r.value)==null?void 0:c.raw))||e.test(String(s)))){const p=t[t.length-1].value;p&&p.raw&&typeof p.value=="string"&&(p.raw+=(u=r.value)==null?void 0:u.raw,p.value+=((w=r.value)==null?void 0:w.value)||"",p.type="any")}else t.push(r);return t},Array())}function Vr(a,e){const t=[];return a&&t.push(a),t.push(...e.map(r=>{var i,s;if(r.plain)return((i=r.value)==null?void 0:i.raw)||r.name||re;{const n=r.long?"--":"-",o=r.name||re,l=((s=r.value)==null?void 0:s.raw)||re,c=r.value?Pt:"";return`${n}${o}${c}${l}`}})),t}function kr(a,{forceProgram:e,mergeArgs:t,mergeArgsBy:r}={}){var c;const i=a[0],s=a[1];let n;(!s||!Cr(s))&&i&&(xr(i)||e)&&(a=a.filter(u=>u!==i),n=(c=i.value)==null?void 0:c.raw);let o=a;t&&(o=Wr(a,r));const l=Vr(n,o);return{program:n,args:o,rawArgs:l}}const Mr="\\",re="",Dt=" ",Be="-",Pt="=",Nt='"',Fr="'";function Br(a){return a===Mr}function Ur(a,e){Br(e)?a.escaped=!0:(!a.escaped&&!a.isBufferValue&&!Se(a,e)?(a.isBufferWrite=!0,a.isBufferValue=!0,(e===Fr||e===Nt)&&!a.isClamp&&(a.currentTick=e,a.isBufferString=!0),a.isBufferString=e===a.currentTick,a.rawBuffer=void 0,a.activeArgument=a.activeArgument||{value:void 0,plain:!0}):e===a.currentTick&&a.isBufferString&&!a.escaped&&!a.isClamp&&(a.isBufferWrite=!1),(e!==a.currentTick||a.isClamp||a.escaped&&e===a.currentTick)&&((!a.isBufferWrite&&a.isBufferString||a.isBufferWrite&&!a.isBufferString)&&!a.isClamp&&a.specialChar.includes(e)&&!a.additionSpecial?(a.rawCommand=" "+e+" "+a.rawCommand,a.additionSpecial=!0):(a.additionSpecial=!1,a.rawBuffer=(a.rawBuffer||"")+e)),a.escaped=!1),a.isBufferWrite&&(e==="("?a.isClamp=!0:e===")"&&(a.isClamp=!1)),a.lastChar=e}function Yr(a){var e,t,r;return a.plain&&!a.name&&((e=a.value)==null?void 0:e.type)==="any"&&(((t=a.value)==null?void 0:t.raw)===void 0||((r=a.value)==null?void 0:r.raw)===re)}function Gr(a,e){a.activeArgument&&(a.isLongArgument&&(a.activeArgument.long=a.isLongArgument),Yr(a.activeArgument)||e.push(a.activeArgument)),a.activeArgument=void 0,a.isLongArgument=!1,a.isKeyWordArgument=!1}function Xr(a){const e=a.rawBuffer||re;if(a.isBufferString)a.activeArgument.value={type:"string",value:a.rawBuffer,raw:`${a.currentTick}${a.rawBuffer||""}${a.currentTick}`};else{let t="any",r=e;/^[+-]?\d+$/.test(e)?(t="integer",r=Math.round(Number(e))):/^[+-]?(?:\d+\.?\d*|\.\d+)$/.test(e)?(t="double",r=Number(e)):/^true|false$/.test(e)?(t="boolean",r=e==="true"):/^[a-zA-Z$]+$/.test(e)?(t="any",r=String(e).replace(/ /g,re)):/^[\d+\-*./a-zA-Z$]+$/.test(e)&&(t="term",r=String(e).replace(/ /g,re)),a.activeArgument.value={type:t,value:r,raw:a.rawBuffer}}a.rawBuffer=void 0,a.isBufferValue=!1,a.isBufferString=!1}var ve;const M=class M{constructor(e){v(this,ve);L(this,ve,e)}async parse(e){const t=se(e,{forceProgram:!0}),r=await this.getArguments(t);return{origin:e,unresolved:zr(t),args:r.args,kwargs:r.kwargs,command:t.program||"",commandValue:e}}async getArguments(e){return{args:await Promise.all(e.args.filter(t=>t.plain).map(t=>{if(t.value)return this.parseValue(t.value)})),kwargs:Object.fromEntries(await Promise.all(e.args.filter(t=>!t.plain).map(async t=>[tt(t.name||""),t.value!==void 0?await this.parseValue(t.value):void 0])))}}parseValue({value:e,type:t}){return typeof e=="string"&&[Je.ANY,Je.TERM].includes(t)?m(this,ve).parse(e.replace(/ *([a-zA-Z_-]+) */,"$1")):Promise.resolve(e)}static extractStrings(e){let t=!1,r=0;const i=[];let s=!1;for(let o=e.length-1;o>=0;o--){const l=e[Number(o)],c=e[o-1];!s&&l==='"'&&c!=="\\"?t?(t=!1,i.push(e.slice(o,r+1))):(s=!1,t=!0,r=o):(!t&&s||s)&&l==="'"&&c!=="\\"&&(t?(s=!1,t=!1,i.push(e.slice(o,r+1))):(s=!0,t=!0,r=o))}if(t)throw new Error("can't extract values; "+e);return{result:i.reduce((o,l,c)=>o.replace(l,M.resolveKey(c)),e),values:i}}static extractValues(e,t=" "){let r=!1,i=0;const s=[];let n=!1;for(let l=e.length-1;l>=0;l--){const c=e[Number(l)],u=e[l-1];!n&&c==='"'&&u!=="\\"?r?(r=!1,s.push(e.slice(l,i+1))):(n=!1,r=!0,i=l):(!r&&n||n)&&c==="'"&&u!=="\\"&&(r?(n=!1,r=!1,s.push(e.slice(l,i+1))):(n=!0,r=!0,i=l))}if(r)throw new Error("can't extract values; "+e);return s.forEach((l,c)=>{e=e.replace(l,M.resolveKey(c))}),{params:e.split(t).filter(l=>l),values:s}}static resolveKey(e){return`$$$$$$${e}`}static resolveValues({params:e,values:t}){return e.map(r=>M.resolveValue(r,t))}static valueUnresolved(e){return typeof e=="string"&&M.REGEX_VALUE_RESOLVE.test(e)}static resolveValue(e,t){var i;let r=e;if(M.valueUnresolved(e)){if(r=(i=String(e).match(/[$]{3}(\d+)/g))==null?void 0:i.reduce((s,n)=>s.replace(n,t[Number(n.replace(M.REGEX_VALUE_RESOLVE,"$1"))]),String(e)),/[\w]+[$%]?[ ]*\(/.test(r||""))return r;if(typeof r=="string"){if(r==="undefined")return;if(jr(r))return Number(r);if(!r.startsWith('"'))return r}}return r}};ve=new WeakMap,E(M,"REGEX_VALUE_RESOLVE",/[$]{3}(\d+)/),E(M,"REGEX_COMMAND_REPLACE",/^([a-zA-Z]+[a-zA-Z0-9_]+) (.*)$/),E(M,"REGEX_PARAM_KWARG",/^[-]{0,2}([\\-\w]+)=(.*)$/),E(M,"REGEX_PARAM_ARG",/^[-]{1,2}([\\-\w]+)$/);let V=M;function jr(a){return!isNaN(Number(a))}function zr(a){return{args:a.args.filter(e=>e.plain).map(e=>{var t;return((t=e.value)==null?void 0:t.raw)||""}),kwargs:Object.fromEntries(a.args.filter(e=>!e.plain).map(e=>{var t;return[tt(e.name||""),((t=e.value)==null?void 0:t.raw)||""]}))}}var me;class Ot{constructor(e,t,r,i){E(this,"name");v(this,me);E(this,"global",!1);E(this,"readonly",!1);this.name=e,L(this,me,t),this.global=r||this.global,this.readonly=i||this.readonly}get value(){return m(this,me)}set value(e){this.readonly||L(this,me,e)}}me=new WeakMap;class Hr extends Ot{constructor(e,t,r=!1){super(e,t,r,!0)}async execute(...e){if(typeof this.value=="function")return this.value(...e)}}class et extends Ot{}var O,ee,$;class st{constructor(){v(this,O,new Map);v(this,ee,new Map);v(this,$,[])}reset(){this.resetPrefixStack(),m(this,O).clear(),m(this,ee).clear()}resetPrefixStack(){L(this,$,[])}get prefixStack(){return m(this,$)}get currentPrefixStack(){return m(this,$)[m(this,$).length-1]}has(e){var t;return e=e.replace(/(.*[^ ])[ ]+$/,"$1"),e=e.replace(/[$%]$/,""),(!m(this,O).get(e)||m(this,O).get(e)&&!((t=m(this,O).get(e))!=null&&t.global))&&(e=this.prepareName(e)),m(this,O).has(e)}add(e,t,r=!1,i=!1){e=e.replace(/(.*[^ ])[ ]+$/,"$1"),/\$$/.test(e)?t===void 0&&(t=""):/\\%$/.test(e)&&t===void 0&&(t=0),e=e.replace(/[$%]$/,""),e=this.prepareName(e),this.has(e)||m(this,O).set(e,new et(e,t,r,i))}get(e){var i;e=e.replace(/(.*[^ ])[ ]+$/,"$1");const t=e;e=e.replace(/[$%]$/,""),(!m(this,O).get(e)||m(this,O).get(e)&&!((i=m(this,O).get(e))!=null&&i.global))&&(e=this.prepareName(e));const r=m(this,O).get(e);if(r){let s=r.value;return s&&typeof s=="string"&&(/\$$/.test(t)?s=String(s):/\\%$/.test(t)||/^\d+$/.test(s)?s=parseInt(s):/^[\d.]+$/.test(s)&&(s=parseFloat(s))),s}}set(e,t,r=!1,i=!1){if(e=e.replace(/(.*[^ ])[ ]+$/,"$1"),typeof t=="string"&&(/[$]$/.test(e)?t===void 0?t="":t=String(t):/[%]$/.test(e)&&(t===void 0?t=0:t=parseInt(t))),e=e.replace(/[$%]$/,""),e=this.prepareName(e),this.has(e)){const s=m(this,O).get(e);s instanceof et&&s&&(s.value=t)}else this.add(e,t,r,i)}addSub(e,t){e=this.prepareName(e,!1),this.has(e)||m(this,ee).set(e,new Hr(e,t))}async executeSub(e,t=[],r=!1){t=t||[],e=this.prepareName(e,!1),m(this,$).push({name:`${Math.round(Math.random()*1e4)}`,global:r});const i=m(this,ee).get(e);return i==null?void 0:i.execute(...t).then(s=>(m(this,O).forEach(n=>{RegExp(`[$]{3}${m(this,$)[m(this,$).length-1].name}$`).test(n.name)&&m(this,O).delete(n.name)}),m(this,$).pop(),s))}hasSub(e){return e=this.prepareName(e,!1),m(this,ee).has(e)}prepareName(e,t=!0){return typeof e=="string"&&(e=e.replace(/ /g,"")),t&&m(this,$).length&&!/[$]{3}/.test(e)&&(e=`${e}$$$${m(this,$)[m(this,$).length-1].name}`),e}get dims(){return m(this,O)}get subs(){return m(this,ee)}}O=new WeakMap,ee=new WeakMap,$=new WeakMap;var ie,Ae,P,F,Z,Re,Te,C,De,ne,Q,x,te,Y,G,bt;let Kr=(bt=class{constructor(e,t,r,i,s,n){E(this,"debug",!1);v(this,ie);v(this,Ae);v(this,P);v(this,F);v(this,Z);v(this,Re,9999999999);v(this,Te,0);v(this,C);v(this,De,[]);v(this,ne,0);v(this,Q,[]);v(this,x,-1);v(this,te,[]);v(this,Y,[]);v(this,G,-1);L(this,Z,e),L(this,F,t||(()=>Promise.resolve(void 0))),L(this,P,r||new st),L(this,ie,i),L(this,Ae,s),this.debug=n!==void 0?n:this.debug}get memory(){return m(this,P)}get lines(){return m(this,Z)}parse(e){var r;e=e||Array().concat(m(this,Z));const t=(r=e.shift())==null?void 0:r.trim();return new Promise(i=>{if(m(this,C)&&t!=="END SUB"){t&&m(this,C).lines.push(t),i(void 0);return}if(m(this,Re)>0&&m(this,Te)>m(this,Re))throw new Error("BASIC INTERPRETER OVERFLOW");if(U(this,Te)._++,m(this,G)>=0){const s=m(this,Y)[m(this,G)];if(s){if(m(this,Y).forEach(n=>{s.count===0&&n&&t&&n.count===0&&n.lines.push(t)}),t&&(t==="WEND"||/NEXT /.test(t)))return s.condition().then(async n=>{if(s.tmpLines=s.tmpLines||e,n){const o=s.lines;return s.count++,s&&typeof s.step=="function"&&await s.step(),o.length>0?this.parse(Array().concat(o)):(m(this,Y)[m(this,G)]=!1,U(this,G)._--,m(this,Y).pop(),null)}else return m(this,Y)[m(this,G)]=!1,U(this,G)._--,m(this,Y).pop(),null}).then(i);i(void 0)}else i(void 0)}else i(void 0)}).then(()=>{if(!m(this,C)&&m(this,x)>=-1&&(m(this,te)[m(this,x)]!==void 0&&m(this,Q)[m(this,x)]===void 0&&m(this,Q).push(!m(this,te)[m(this,x)]),t==="ELSE"&&m(this,ne)<1&&(m(this,Q)[m(this,x)]=!m(this,Q)[m(this,x)])),m(this,Q)[m(this,x)])t&&/^IF (\((.*)\)|(.*)) THEN$/.test(t)&&U(this,ne)._++;else return this.parseLine(t,e);return null}).then(()=>(m(this,x)>-1&&(t==="ENDIF"||t==="END IF")&&(m(this,ne)<1?(U(this,x)._--,m(this,te).pop(),m(this,Q).pop()):U(this,ne)._--),e.length?this.parse(e):m(this,De)))}parseLine(e,t){return new Promise((r,i)=>{if(e=(e||"").replace(/^[ \t]+/g,""),/^ *[#/]+/.test(e)){r(void 0);return}if(/^GOTO +([\w\d]+)$/.test(e)){const s=e.match(/^GOTO +([\w\d]+)$/)||[];this.commandGoto(t,s[1]),e=""}if(/^SUB (.*) STATIC$/.test(e)){const s=e.match(/^SUB (.*) STATIC$/)||[];return this.commandSubStatic(s[1]).then(r)}else{if(e==="END SUB")return this.commandEndSub().then(r);if(m(this,C)){r(void 0);return}}if(/^IF (\((.*)\)|(.*)) THEN$/.test(e)){const s=e.match(/^IF (\((.*)\)|(.*)) THEN$/)||[],n=s[3]||s[2];return this.commandIfThen(n).then(r)}else if(e==="ELSE"||e==="ENDIF"||e==="END IF"){r(void 0);return}if(/^WHILE (.*)$/.test(e)){const s=e.match(/^WHILE (.*)$/)||[];return this.commandWhile(s[1]).then(r)}else if(e==="WEND"){r(void 0);return}if(/^FOR (.*)$/.test(e)){const s=e.match(/^FOR (.*)$/)||[];return this.commandFor(s[1]).then(r)}else if(e.startsWith("NEXT ")){r(void 0);return}if(/^([\w\d]+):$/.test(e)){r(void 0);return}if(/^DIM( SHARED)? +(.*)$/.test(e)){const s=e.match(/^DIM( SHARED)? +(.*)$/)||[];return this.commandDimShared(s[2],!!s[1]).then(r)}if(/^LET +([\w,$%]+)(\((.*)\))? *= *(.*)$/.test(e)){const s=e.match(/^LET +([\w,$%]+)(\((.*)\))? *= *(.*)$/)||[];return this.commandLet(s[1],s[4],s[3]).then(()=>r(void 0))}if(/^READ +([\w, $%]+)$/.test(e)){const s=e.match(/^READ +([\w, $%]+)$/)||[];return this.commandRead(s[1]).then(r)}if(/^END[ ]*$/.test(e))return this.commandEnd().then(r);if(/^(PAUSE|SLEEP) +(.+)/.test(e)){const n=(e.match(/^(PAUSE|SLEEP) +(.+)/)||[])[2];return this.commandPause(n).then(r)}if(/^CALL *(.*)/.test(e)){const s=e.match(/^CALL *(.*)/)||[];return this.commandCall(s[1],t).then(r)}if(/^EXECUTE *(FILE|EVAL) *(.*)/.test(e)){const s=e.match(/^EXECUTE *(FILE|EVAL) *(.*)/)||[];return this.commandExecute(s[1],s[2]).then(r).catch(i)}if(/^PRINT +USING +.*$/.test(e)){const s=e.match(/^PRINT +USING +(.*)$/)||[];return this.commandPrintUsing(s[1]).then(r)}if(/^PRINT +(.*)$/.test(e)){const s=e.match(/^PRINT +(.*)$/)||[];return this.commandPrint(s[1]).then(r)}if(/^DATA +(.*)$/.test(e)){const s=e.match(/^DATA +(.*)$/)||[];return this.commandDataVar(s[1]).then(r)}m(this,F).call(this,e,{show:!0}).then(s=>{s!==void 0&&m(this,De).push(s)}).then(r).catch(i)})}async setReadStack(e,t){let r=await this.parseValue(t,!0);return typeof r=="string"&&X(r)&&(r=parseFloat(r)),m(this,P).set(e,r,!0)}async addDataStack(e){let t=await this.parseValue(e,!0);return typeof t=="string"&&X(t)&&(t=parseFloat(t)),m(this,ie).push(t)}async setStack({name:e,value:t,index:r,global:i}){let s=await this.parseValue(t,!0);if(typeof s=="string"&&X(s)&&(s=parseFloat(s)),r!==void 0){r=Number(await this.parseValue(r,!0));const n=m(this,P).get(e);if(typeof n=="object")return n[r-1]=s,s;throw new Error(`Index ${r} out of range`)}else return m(this,P).set(e,s,i)}async setGotoMarkStack(e,t){m(this,Ae).set(e,await this.parseValue(t,!0))}async parseValue(e,t=!0,r=!1){if(e===void 0)return e;if(Array.isArray(e))return e;if(typeof e=="boolean")return e;if(typeof e=="number")return Number(e);if(typeof e=="string"){if(/^ *(true|false|TRUE|FALSE) *$/.test(e))return e.toLowerCase()==="true";if(/^[\d]+$/.test(e.trim())||/^ *([\\-]?[\d.]+(e[-+]?\d+)?) *$/.test(e.trim()))return parseFloat(e);if(/^ *@"((.|\n)*)" *$/.test(e.trim()))return e.replace(/^ *@"((.|\n)*)" *$/,'"$1"');if(/^"((\\"|[^"])+)"$/.test(e.trim()))return e.trim().replace(/^"((\\"|[^"])+)"$/,'"$1"');if(/^[^"]?(.+)[^"]? *$/.test(e.replace(/ /g,""))){if(e=e.replace(/^ */g,""),m(this,P).has(e.replace(/ /g,"")))return e=e.replace(/ /g,""),this.parseValue(m(this,P).get(e),!0);if(r)throw new Error(`Value processing continues: ${e.slice(0,20)}…'`);return m(this,F).call(this,e,{message:t?void 0:e})}}}async executeCondition(e,t,r){const i=await this.parseValue(e,!0),s=await this.parseValue(r,!0);return/^[=]?==$/.test(t)?i===s:t==="<>"?i!==s:/^([<>][=]|[<>])?$/.test(t)?Zr(i,t,s):/^!=[=]?$/.test(t)?i!==s:!1}commandIfThen(e){const t=e.match(/([^<>]*) *(<>|<=|>=|<|>|[=!]{2,3}) *([^<>].*)/);return t?this.executeCondition(t[1],t[2],t[3]).then(r=>(m(this,te).push(r),U(this,x)._++,r)):this.parseValue(e[1],!0).then(r=>{let i=r;return r instanceof et&&(i=r.value),m(this,te).push(!!i),U(this,x)._++,i})}commandWhile(e){const t=e.match(/([^<>]*) *(<>|<=|>=|<|>|[=!]{2,3}) *([^<>].*)/);return t?this.executeCondition(t[1],t[2],t[3]).then(r=>{if(r)return m(this,Y).push({count:0,lines:[],condition:()=>this.executeCondition(t[1],t[2],t[3])}),U(this,G)._++,r}):Promise.resolve(void 0)}async commandFor(e){const t=e.match(/(.*) *= *(.*) +TO +(.*) +STEP[ ](.*)/)||e.match(/(.*) *= *(.*) +TO +(.*)/);if(t){const r=await this.parseValue(t[2],!0),i=await this.parseValue(t[3],!0);m(this,P).set(t[1],r),U(this,G)._++;const s=async(n=!0)=>{let o=1;return t[4]&&(o=await this.parseValue(t[4],!0)),n&&m(this,P).set(t[1],Number(m(this,P).get(t[1]))+o),o};return m(this,Y).push({step:s,count:0,lines:[],condition:async()=>{const n=await s(!1);return n===0?!1:this.executeCondition(`(${t[1]}  )`,n<0?">":"<",String(i))}})}}commandSubStatic(e){const t=e.match(/^([\w,$%]+)(\((.*)\))?$/)||[],r=t[1],i=V.resolveValues(V.extractValues(t[3]||"",","));return L(this,C,{name:r,lines:[],args:i}),Promise.resolve(void 0)}commandEndSub(){if(m(this,C)){const e=m(this,C).lines,t=m(this,C).args;m(this,P).addSub(m(this,C).name,async(...r)=>{(await Promise.all(t.map((s,n)=>this.parseValue(r[Number(n)]).then(o=>({arg:s,value:o}))))).forEach(({arg:s,value:n})=>{s&&m(this,P).add(String(s),n)}),await this.parse(Array().concat(e))}),L(this,C,void 0)}else throw new Error("has no active SUB");return Promise.resolve(void 0)}commandGoto(e,t){return e.splice(0,e.length),this.parse(m(this,Z).slice(m(this,Z).indexOf(`${t}:`),m(this,Z).length))}commandDimShared(e,t){return V.resolveValues(V.extractValues(e,",")).reduce((i,s)=>{const n=String(s||"").match(/^([\w, $%]+)?(\((.*)\))?$/)||[];return m(this,P).has(n[1])||(n[3]&&(i=i.then(()=>this.parseValue(n[3],!0))),i=i.then(o=>(this.setStack({name:n[1],value:o?Array(o):void 0,global:t}),o))),i},Promise.resolve(void 0))}commandLet(e,t,r){if(m(this,P).has(e))return this.setStack({name:e,value:t,index:r});throw new Error(`Variable ${e} not defined`)}async commandPrintUsing(e){const t=se(e,{mergeArgs:!0,mergeArgsBy:/^[+,]$/}).rawArgs,r=se(t[2],{mergeArgs:!0}).rawArgs.filter(n=>n!==",").map(n=>this.parseValue(n)),i=await Promise.all(r);let s=T(t[0]);for(;s.includes("#");){const n=i.shift(),o=s.match(/(#+\.#+)|(#+)/);if(o&&/(#+\.#+)/.test(o[0])){const[l,c]=o[0].split("."),[u,w]=String(n).split("."),p=Ze(String(u||"").slice(0,l.length),l.length,!0," ")+"."+Ze(String(w||"").slice(0,c.length),c.length,!1,"0");s=s.replace(/(#+\.#+)/,T(String(p)))}else s=s.replace(/(#+|#+\.#+)/,T(String(n)))}return m(this,F).call(this,null,{message:`"${T(s)}"`})}commandDataVar(e){if(m(this,ie).length===0)return Promise.all(e.split(",").map(t=>this.addDataStack(t)));throw new Error("DATA has already been declared")}async commandPrint(e){if(/^((".*"|[^"]*);([^;]*))$/.test(e)){const t=e.match(/(.*);(.*)$/)||[],r=await this.parseValue(t[1],!0),{rawArgs:i}=se(String(t[2]),{mergeArgs:!0});let s=await Promise.all(i.map(o=>this.parseValue(o,!0)));s=s.map(o=>T(o));const n=s.map(o=>`${T(r)}${o}`).join(" ");return m(this,F).call(this,null,{message:Ge(n)||X(n)?n:`"${n}"`})}else{let t=await this.parseValue(e);const{rawArgs:r}=se(String(t),{mergeArgs:!0});let i=await Promise.all(r.map(s=>this.parseValue(s,!0)));return i=i.map(s=>T(s)),i.length>1?t=i.join(""):t=i[0],m(this,F).call(this,null,{message:Ge(t)||X(t)?t:`"${t}"`})}}commandEnd(){return Promise.resolve(void 0)}async commandPause(e){const t=Number(await this.parseValue(e));return new Promise(r=>window.setTimeout(()=>{r(void 0)},t))}commandRead(e){const t=e.split(",");return Promise.all(t.map(r=>{const i=m(this,ie).shift();return this.setReadStack(r,i),Promise.resolve(void 0)}))}commandCall(e,t){const i=(e.match(/([^(]+)\(.*\)/)||[])[1];if(m(this,P).hasSub(i))return this.parseLine(e,t);throw new Error(`SUB ${i} NOT FOUND`)}async commandExecute(e,t){if(!m(this,F))throw new Error("No callback available for readfile");let r;switch(e){case"FILE":if(r=await m(this,F).call(this,`readfile ${t}`,{show:!1}),r&&typeof r=="object"&&"content"in r)return m(this,F).call(this,r.content,{show:!0});throw new Error("File Content is empty");case"EVAL":return this.parseValue(t,!1)}}},ie=new WeakMap,Ae=new WeakMap,P=new WeakMap,F=new WeakMap,Z=new WeakMap,Re=new WeakMap,Te=new WeakMap,C=new WeakMap,De=new WeakMap,ne=new WeakMap,Q=new WeakMap,x=new WeakMap,te=new WeakMap,Y=new WeakMap,G=new WeakMap,bt);function Zr(a,e,t){switch(a=String(a),t=String(t),(e.match(/^([<>][=]|[<>])$/)||[])[1]){case"<":return parseFloat(a)<parseFloat(t);case">":return parseFloat(a)>parseFloat(t);case"<=":return parseFloat(a)<=parseFloat(t);case">=":return parseFloat(a)>=parseFloat(t);default:return null}}var ue,de,We,Ve;class Qr{constructor(e,t){v(this,ue);v(this,de);v(this,We,new Map);v(this,Ve,[]);L(this,de,t),L(this,ue,e)}get callback(){return m(this,de)}get memory(){return m(this,ue)}async parse(e,t,r){if(e.length===0)return;e.length>1&&await this.readData(e);const i=[];return new Kr(e,async(n,o)=>{o={...o,...r};const l=await(t||m(this,de)||(()=>{}))(n,o);return o.show&&l!==void 0&&i.push(l),l},m(this,ue),m(this,Ve),m(this,We)).parse().then(()=>i)}readData(e){const t=e.find(r=>/^[ ]*DATA[ +]/.test(r));if(t){const r=e.splice(e.indexOf(t),1);return this.parse(r)}return Promise.resolve(void 0)}}ue=new WeakMap,de=new WeakMap,We=new WeakMap,Ve=new WeakMap;function k(...a){if(a.includes(void 0))throw new Error("invalid arguments")}const R={};try{R.brackets=/([^\w$%]?)\(([^\\(\\)]+)\)/,R.brackets_start=/^\((.*)\)$/,R.multiply=new RegExp("[^\\d$\\-\\w]?(?<a>([+-]?[\\w.]+e\\+\\d+)|([+-]?[\\w$%.]+)|(^[+-]?[\\w$%.]+)|([\\w$%.]+)|([$]{3}\\d+))[ ]*(?<operator>[\\^*%\\/]|MOD|XOR|AND|OR|<<|>>|>>>)[ ]*(?<b>([-]?[\\w.]+e\\+\\d+)|([-]?[\\w$%.]+)|(^[+-]?[\\w$%.]+)|([\\w$%.]+)|([$]{3}\\d+))"),R.add_subtract=/([+-]?[\w.]+e\+\d+|[+-]?[\w$%.]+|[$]{3}\d+)[ ]*([+-])[ ]*([+-]?[\w.]+e\+\d+|[+-]?[\w$%.]+|[$]{3}\d+)/,R.function=/([\w]+[a-zA-Z0-9_.]+[$%]?)[ ]*\(([^\\(\\)]*)\)/,R.function_start=/^([\w]+[a-zA-Z0-9_.]+[$%]?)[ ]*\(([^\\(\\)]*)\)/,R.variable=/^([\w]+[a-zA-Z0-9_.]?[$%]?)/,R.number=/^([+-]?[\d.]+e\+\d+|[+-]?[\d.])+($|$)/}catch(a){console.error(a)}class qr{constructor(e,t){E(this,"debug",!1);E(this,"memory");this.memory=this.createMemory(e),this.debug=t!==void 0?t:this.debug}createMemory(e){const t=e||new st;return t.addSub("RND",()=>Promise.resolve(Math.random())),t.addSub("PI",()=>Promise.resolve(Math.PI)),t.addSub("POW",(r,i)=>{if(k(r,i),typeof r=="string")throw new Error("Parameter is not a number");if(typeof i=="string")throw new Error("Parameter is not B number");return Promise.resolve(r**(i||2))}),t.addSub("SQRT",r=>{if(k(r),typeof r=="string")throw new Error("Parameter is not a number");return Promise.resolve(Math.sqrt(r))}),t.addSub("INT",async r=>(k(r),await parseInt(T(String(r))))),t.addSub("SPC",r=>{if(k(r),typeof r=="string")throw new Error("Parameter is not a number");return Promise.resolve(`"${gt(r," ")}"`)}),t.addSub("LEN",r=>(k(r),Promise.resolve(T(String(r)).length))),t.addSub("ASC",r=>(k(r),Promise.resolve(String(T(r)).charCodeAt(0)))),t.addSub("CHR$",r=>{if(k(r),typeof r=="string")throw new Error("Parameter is not a number");return Promise.resolve(Ne(String.fromCharCode(r)))}),t.addSub("LEFT$",(r,i)=>{if(k(r,i),typeof i=="string")throw new Error("Parameter is not B number");return Promise.resolve(`"${sr(T(r),i)}"`)}),t.addSub("RIGHT$",(r,i)=>{if(k(r,i),typeof i=="string")throw new Error("Parameter is not B number");return Promise.resolve(Ne(ir(String(T(r)),i)))}),t.addSub("STRING$",(r,i)=>{if(k(r,i),typeof r=="string")throw new Error("Parameter is not a number");return Promise.resolve(Ne(gt(r,String(T(i)))))}),t.addSub("TIME%",()=>Promise.resolve(Date.now())),t.addSub("HEX_ENC$",r=>(k(r),Promise.resolve(Ne(Number(T(r)).toString(16))))),t.addSub("HEX_DEC$",r=>(k(r),r=parseInt(String(T(r)),16),Promise.resolve(r))),t}async parse(e){const r=await new ea(this).parse(e);return this.debug&&console.debug("Result:",typeof r,r),r}validInput(e){return e&&/[/*\-+^()]?/.test(e)}}const Jr=5e3;class ea{constructor(e,{debug:t}={}){E(this,"debug",!1);E(this,"parser");E(this,"parsedValues",[]);E(this,"timeout",0);this.parser=e,this.debug=t!==void 0?t:this.debug}async parse(e){if(this.debug&&console.debug("PARSE ".padEnd(20,"-")),this.timeout>Jr)throw new Error(`Can't parse ${e}`);this.timeout++;const{result:t,values:r}=V.extractStrings(String(e));let i=se(t).rawArgs;this.parsedValues=this.parsedValues.concat(r),i=i.map(l=>/^MOD|XOR|AND|OR$/.test(l)?` ${l} `:l);let s=i.join("");X(s)?s=Number(s):Ge(s)&&(s=!!s);const n=s,o=await this.action(s);if(this.debug&&console.debug("action:",typeof o,o),o!==void 0){let l;return typeof o=="string"&&o!==n&&!/^".*"$/.test(String(o))?(l=await this.parse(o),this.debug&&console.debug("parse:",typeof l,l),l):(l=await this.resolveValue(o),this.debug&&console.debug("$v:",typeof l,l),l)}}async action(e){var t,r,i,s,n,o;if(typeof e=="string"){if((t=R.brackets_start)!=null&&t.test(e)){const l=e.match(R.brackets_start);if(l){const[c,u]=l;e=e.replace(c,u)}else throw new Error("Invalid expression")}if((r=R.function)!=null&&r.test(e)){const l=e.match(R.function);if(l){const[c,u,w,p]=l,f=u||p;let h=se(w||"",{separator:","}).rawArgs;const I=w.includes(",")&&h.join("")!==w;I&&(h=w.split(","));let y=await Promise.all(h.map(A=>this.parse(A)));if(y=I?y:[await this.parse(y.join(""))],this.parser.memory.has(f))return e.replace(c,(i=this.parser.memory.get(f))==null?void 0:i[Number(y[0])-1]);if(this.parser.memory.hasSub(f))return e.replace(c,this.cacheValue(await this.parser.memory.executeSub(f,y)))}}if((s=R.brackets)!=null&&s.test(e)){const l=e.match(R.brackets);if(l){const[c,u,w]=l;return e.replace(c,u+await this.parse(w))}else throw new Error("Invalid expression")}if((n=R.multiply)!=null&&n.test(e))return this.operation(e,R.multiply);if((o=R.add_subtract)!=null&&o.test(e))return this.operation(e,R.add_subtract)}return this.resolveValue(e)}async operation(e,t){const r=e.match(t);if(r){let i,s,n;const o=r[0];"groups"in r&&r.groups?(i=r.groups.a,s=r.groups.b,n=r.groups.operator):(i=r[1],n=r[2],s=r[3]);let l=e,c=await this.parse(i);X(c)||(c=T(c));let u=await this.parse(s);switch(X(u)||(u=T(u)),this.debug&&console.debug({valueA:c,valueB:u}),c=c,u=u,n){case"+":l=c+u;break;case"-":l=c-u;break;case"*":l=c*u;break;case"/":l=c/u;break;case">":l=c>u;break;case"<":l=c<u;break;case"^":l=c^u;break;case"%":l=c%u;break;case"MOD":l=c%u;break;case"AND":l=c&u;break;case"OR":l=c|u;break;case"XOR":l=c^u;break;case"<<":l=c<<u;break;case">>":l=c>>u;break;case">>>":l=c>>>u;break}return X(l)||(l=`"${l}"`),e.replace(o,o.replace(RegExp(`[${i}]{${String(i).length}}[ ]*[${n}]{${String(n).length}}[ ]*[${s}]{${String(s).length}}`),"")+this.cacheValue(l))}else throw new Error("Invalid expression")}async resolveValue(e){var t,r,i;if(typeof e!="function"&&V.valueUnresolved(e))return V.resolveValue(e,this.parsedValues);if(typeof e=="string"){if(e=e.replace(/^[ ]*([^ ].*[^ ])[ ]*$/,"$1"),(t=R.number)!=null&&t.test(e)){if(X(e))return Number(e)}else if((r=R.function_start)!=null&&r.test(String(e))){const s=e.match(R.function_start);if(s){const[,n,o]=s;if(this.parser.memory.hasSub(n))return this.parser.memory.executeSub(n,V.resolveValues(V.extractValues(o,",")));throw new Error(`can't find sub "${n}" in memory`)}else throw new Error("Invalid expression")}else if((i=R.variable)!=null&&i.test(String(e))){const s=e.replace(R.variable,"$1");if(this.parser.memory.hasSub(s))return this.parser.memory.executeSub(s);if(this.parser.memory.has(s))return this.parser.memory.get(s)}}return e}cacheValue(e){return this.parsedValues.push(e),V.resolveKey(this.parsedValues.length-1)}}const ta=["CLS","READ max","DIM fib%(max)","LET fib(1) = 1","LET fib(2) = 2","FOR i=3 TO max","LET fib(i) = fib(i - 2) + fib(i -1)","NEXT i","FOR i=1 TO max","PRINT fib(i)","NEXT i","DATA 10","END"],ra=["CLS","DIM w%,h%,a%","LET w%=12","LET h%=4","LET a%=w%*h%",'PRINT "With the width " + w%','PRINT " and the height " + h%','PRINT " you have the area " + a%'],aa=["CLS","DIM r,a","LET r=5","READ pi","LET a=r*r*pi",'PRINT USING "With the radius ##.##"; r','PRINT USING "we have the area ##.##"; a',"DATA 3.14","END"],sa=["GuessTheNumber","CLS","READ max%","DIM number%, guess%, guesses%",'PRINT "The number is between 1-1000."',"LET number% = INT(RND * max%) + 1","LET guess% = 1","LET guesses% = 0","WHILE guess%<>number%",'PRINT "Guess the number"',"INPUT guess%","IF (guess%<>number%) THEN","IF (guess%>number%) THEN",'PRINT "Your guess was too high"',"ELSE",'PRINT "Your guess was too low"',"ENDIF","ENDIF","LET guesses% = guesses% + 1","WEND",'PRINT USING "You found the number in # tries"; guesses%',"DATA 1000","END"],ia=["DIM result",'PRINT "Calculate the factorial of"',"INPUT n","LET result = 1","FOR i = n TO 1 STEP -1","LET result = result * i","NEXT i",'PRINT USING "#! = #"; n, result',"END"],na=["CLS","DIM stars$",'PRINT "Enter the height of the pyramid"',"INPUT height",'LET stars$ = ""',"FOR i = 1 TO height",'LET stars$ = ""',"FOR j = 1 TO (i+i-1)",'LET stars$ = stars$ + "*"',"NEXT j","PRINT SPC(height - i) + stars","NEXT i","END"],oa=['PRINT "Step 1"','PRINT "Step 2"','PRINT "Step 3"',"GOTO ignore",'PRINT "Step 4"',"ignore:",'PRINT "Step 5"'],la=["DIM A, B","LET A = 2000",'LET B = "Hello World"','PRINT USING "A: #"; A','PRINT USING "B: #"; B'],ca=["DIM A, B","LET A = 1","LET B = 2","IF A == B THEN",'PRINT "true"',"ELSE",'PRINT "false"',"END","IF (A < B) THEN",'PRINT "true"',"END"],ma=["DIM i%","FOR i% = 1 TO 5",'PRINT USING "For Number #"; i%',"NEXT i%"],ua=["DIM i%","LET i%=0","WHILE i% < 5",'PRINT USING "While Number #"; i%',"LET i% = i% + 1","WEND"],da=["DIM duration","LET duration = 2500",'PRINT USING "Start with Pause #ms"; duration',"PAUSE duration",'PRINT "End Pause"','PRINT USING "Start with Sleep #ms"; duration',"PAUSE duration",'PRINT "End Sleep"'],pa={Fibonacci:ta,Area:ra,Circle:aa,"Your Name":["CLS",'PRINT "What is your name?"',"INPUT n$",'PRINT "What is your shoe size?"',"INPUT size",'PRINT "Hello "; n$','PRINT USING "your shoe size is ##.##"; size',"END"],GuessTheNumber:sa,Factorial:ia,Pyramid:na,"Bubble Sort":["CLS","READ max","DIM SHARED numbers(max)","SUB CreateList(max) STATIC","FOR i=1 TO max","LET numbers(i) = INT(RND * 100)","NEXT i","END SUB","SUB PrintList(max) STATIC","FOR i=1 TO max","PRINT numbers(i)","NEXT i","END SUB","SUB SwapValues(i%, j%) STATIC","LET numbers(i%) = numbers(i%) XOR numbers(j%)","LET numbers(j%) = numbers(i%) XOR numbers(j%)","LET numbers(i%) = numbers(i%) XOR numbers(j%)","END SUB","SUB Sort(max) STATIC","FOR i%=1 TO (max - 1)","FOR j%=i% TO max","IF numbers(i%)>numbers(j%) THEN","CALL SwapValues(i%, j%)","END IF","NEXT j%","NEXT i%","END SUB","CreateList(max)","Sort(max)","PrintList(max)","DATA 10","END"],Goto:oa,Vars:la,If:ca,For:ma,"For Step":["CLS","FOR i% = 0 TO 6 STEP 2",'PRINT "For Step Number #"; i%',"NEXT i%"],While:ua,Pause:da},fa=fe(({module:a,core:e})=>[{name:["basic"],args:[new d({index:0,name:"path",description:"Path to basic script"})],async action({path:t},r){var s;if(!t)throw S.get("bad_args");const i=await((s=e.modules.files)==null?void 0:s.fileSystem.get(t));if(typeof(i==null?void 0:i.data)=="object"){const n=i.data;if(n.type==="basic"&&Array.isArray(n.content))return a.parseBasic(n.content,void 0,{logger:r.logger})}else throw new TypeError(`Can't read file ${t}`)}},{name:["basicExamples"],args:[new d({index:0,name:"name",description:"Name from example"})],action({name:t}){return a.parseBasic(pa[String(t)])}}]);class ha extends ke{constructor({core:t}){super({name:"Parser",commands:r=>[...fa(r)],core:t});E(this,"basicInterpreter");E(this,"memory",D(new st));E(this,"mathParser",D(new qr(this.memory)));E(this,"commandParser",D(new V(this.mathParser)));this.basicInterpreter=D(new Qr(this.memory,t.executeCommand.bind(t)))}parse(t,r,i){return this.basicInterpreter.parse(t,r,i)}parseBasic(t,r,i={}){let s=t;return Array.isArray(t)||(s=t.split(`
`)),this.basicInterpreter.parse(s,r,i)}async parseCommand(t){return this.commandParser.parse(t)}parseMath(t){return this.mathParser.parse(t)}isMathValue(t){return this.mathParser.validInput(t)}}async function ga(a,e,t){const r=await a.executeCommand(`exist "${e}"`);let i=!1;r&&(i=await a.executeCommand('openDialog "File exist, overwrite?" --confirm'));const s=[`makefile "${e}"`];return t&&s.push(`--data="${t}"`),i?s.push("--override"):s.push("--ignore"),a.executeCommand(s.join(" "))}async function wa(a,e){var i;const t=await((i=a.modules.files)==null?void 0:i.fs.get(e)),r=await a.executeCommand(`readfile "${e}"`);return{fsItem:t,value:r}}const Ea=fe(({module:a,core:e})=>{const{fileSystem:t}=a;return[{name:"openPreview",args:[new d({index:0,name:"path",description:"Path to the file"}),new d({name:"maximized",description:"If set, window is maximized."})],async action({path:r,maximized:i}){var c,u;const s=await t.get(r),{type:n,content:o,openMaximized:l}=s.data;if(n==="basic"&&!s.data[or.HAS_WINDOW_OUTPUT])await((c=e.modules.parser)==null?void 0:c.parseBasic(o,async(w,p)=>await e.executeCommand(w,p)));else{const w=await g(()=>import("./DAmX6ORD.js"),__vite__mapDeps([32,33,34,35,36,37,38,21,1,39,20,22,23,40,41,18,19,42]),import.meta.url).then(p=>p.default);(u=e.modules.windows)==null||u.addWindow({component:w,componentData:{type:n,content:o},options:{title:s.name,scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0},layout:{size:at(420,360)}},{full:l||i||!1})}}},{name:"saveFileDialog",args:[new d({index:0,name:"data",description:"File Content"}),new d({index:1,name:"id",description:"File Id"}),new d({index:2,name:"extension",description:"File Extension"})],async action({data:r,id:i,extension:s}){var l;const n=await g(()=>import("./pXS4ZTPS.js"),__vite__mapDeps([43,6,1,7,14,15,16,17,44,45,46,33,34,35,36,37,38,21,39,20,22,23,47,8,9,48]),import.meta.url).then(c=>c.default),o=(l=e.modules.windows)==null?void 0:l.addWindow({component:n,componentData:{fsItem:t.root&&D(t.root),id:i},options:{title:"Save File",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}});if(o){const{value:c}=await o.awaitClose();if(c){const u=Ut(c,s),w=await ga(e,u,r);if(w)return D(qt(w))}}}},{name:"openFileDialog",args:[],async action(){var n;const r=pe({}),i=await g(()=>import("./BPOtYdVz.js"),__vite__mapDeps([49,6,1,7,14,15,16,17,44,45,46,33,34,35,36,37,38,21,39,20,22,23,47,8,9,18,19,50]),import.meta.url).then(o=>o.default),s=(n=e.modules.windows)==null?void 0:n.addWindow({component:i,componentData:{model:r,fsItem:t.root&&D(t.root)},options:{title:"Open File",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}});if(s){const{value:o}=await s.awaitClose();return o&&wa(e,o)}}},{name:"fileinfo",description:"Get info from File or Directory",args:[new d({index:0,name:"path",description:"Path to the file"}),new d({index:1,name:"name",description:"Name from the Info"}),new d({index:2,name:["list","ls"],flag:!0,description:"List all Infos"})],async action({path:r,name:i,list:s},n){const o=await t.getItemMetaList(r);if(s){const l=new le;l.addColumns([{value:"Name",align:"left",minWidth:20},{value:"Value",align:"left",minWidth:20}]),l.addRows(o.map(({name:c,value:u})=>{let w=u;return Array.isArray(u)&&(w=u.join(" ")),[c,w]})),n.message([l])}else return o.find(l=>l.name===i)}},{name:["info","i"],args:[new d({index:0,name:"path",description:"Path to the file"})],async action({path:r},i){let s=t.root;r&&(s=await t.get(r)),s!=null&&s.parent&&(s=s.parent);const n=await(s==null?void 0:s.getItems()),o=new le;o.addColumns([{value:"Unit",align:"left",minWidth:8},{value:"Size",align:"right",minWidth:6},{value:"Used",align:"right",minWidth:6},{value:"Free",align:"right",minWidth:6},{value:"Full",minWidth:4},{value:"Errs",align:"center",minWidth:4},{value:"Status",align:"center",minWidth:10},{value:"Name",align:"right",minWidth:14}]);const l=Array.from((n==null?void 0:n.values())||[]).filter(u=>u instanceof Xe);o.addRows(l.map(u=>{let w=0;return(u.size>0||u.maxSize>0)&&(w=u.size/u.maxSize*100),[`${u.id}:`,Le(u.maxSize),Le(u.size),Le(u.maxSize-u.size),`${w}%`,"0",u.locked?"Read":"Read/Write",`${u.name||""}`]}));const c=["","Mounted disks:",o,"","Volumes available:"];l.forEach(u=>{c.push(`${u.name}: [Mounted]`)}),c.push(""),i.message(c)}},{name:["list","ls"],args:[new d({index:0,name:"path",description:"Path to the file"}),new d({name:"dir-size",flag:!0,description:"Show Directory Size."})],async action({path:r,dirSize:i},s){let n=t.currentItem;r&&(n=await t.get(r));const o=Array.from((await(n==null?void 0:n.getItems())||[]).values()),l=new le;l.addColumns([{value:"Name",align:"left",minWidth:26},{value:"Size",align:"right",minWidth:8},{value:"Access",align:"center",minWidth:12},{value:"Date / Time",align:"center",minWidth:18}]),l.addRows(o.reduce((w,p)=>{let f;p instanceof It&&!i?f="DIR":f=Ze(Le(p.size),8,!0,"0");const h=p.isLocked()?"Read":"Read/Write";return w.push([`${p.id}:`,f,h,p.createdDate?nr("D-mm-y H:I:S",p.createdDate):""]),w},[]));const c=o.reduce((w,p)=>(p instanceof je&&w++,w),0),u=o.reduce((w,p)=>(w+=p.size,w),0);return s.message([l,`${o.length} files - ${c} directories - ${u} blocks used`]),Promise.resolve()}}]}),_a=rt(({core:a})=>{const e=a.modules.symbols||{},t=a.modules.windows||{},r=pe({open:{disabled:!1},edit:{disabled:!1},duplicate:{disabled:!1},container:{disabled:!1},emptyTrashcan:{disabled:!1},discard:{disabled:!1},info:{disabled:!1},webLink:{disabled:!1},webLinkNew:{disabled:!1},webLinkEdit:{disabled:!1}});function i(){const p=e.getSelectedItems()||[],f=e.getPrimaryWrapper();r.info.disabled=p.length<1,r.open.disabled=p.length<1,r.edit.disabled=p.length<1||!!p.find(h=>(h==null?void 0:h.locked)||h instanceof Oe),r.duplicate.disabled=p.length<1||!!p.find(({fsItem:h})=>(h==null?void 0:h.locked)||h instanceof Oe||h instanceof Xe),r.container.disabled=!r.open.disabled||f instanceof be&&f.fsItem&&(f.fsItem instanceof Gt||f.fsItem.locked)||!f,r.webLinkEdit.disabled=p.length<1||!!p.find(h=>{var I;return!((I=h==null?void 0:h.fsItem)!=null&&I.meta.get(b.WEB_URL))}),r.webLinkNew.disabled=r.container.disabled,r.webLink.disabled=r.webLinkNew.disabled&&r.webLinkEdit.disabled,r.emptyTrashcan.disabled=p.length<1||!!p.find(h=>!((h==null?void 0:h.fsItem)instanceof Oe)),r.discard.disabled=p.length<1||!!p.find(({fsItem:h})=>(h==null?void 0:h.locked)||h instanceof Oe||h instanceof Xe)}return e.events.subscribe(()=>i()),i(),[{order:1,title:"File",items:[{title:"Open",options:r.open,action:s},{title:"Edit",options:r.edit,action:c},{type:W.SEPARATOR},{title:"Web Link",options:r.webLink,items:[{title:"New",options:r.webLinkNew,action:o},{title:"Edit",options:r.webLinkEdit,action:l}]},{type:W.SEPARATOR},{title:"Duplicate",options:r.duplicate,action(){const p=e.getSelectedItems()||[];return Promise.all(p.filter(f=>f.fsItem).map(async({fsItem:f})=>{const h=await(f==null?void 0:f.getPath());return a.executeCommand(`copy "${h}" "${h}" -ignore`)}))}},{title:"Make Dir",options:r.container,async action(){var f;const p=(f=e.getPrimaryWrapper())==null?void 0:f.fsItem;if(p){const h=Yt(await p.getPath(),"Directory");return console.log(`makedir "${h}" -ignore`),a.executeCommand(`makedir "${h}" -ignore`)}else throw new Error("No item found")}},{type:W.SEPARATOR},{title:"Discard",options:r.discard,action(){const p=e.getSelectedItems()||[];return Promise.all(p.filter(f=>f.fsItem).map(async({fsItem:f})=>{const h=await(f==null?void 0:f.getPath());return a.executeCommand(`remove "${h}" -r`)}))}},{title:"Empty Trashcan",options:r.emptyTrashcan,action(){const p=e.getSelectedItems()||[];return Promise.all(p.filter(f=>f.fsItem).map(async({fsItem:f})=>{const h=await(f==null?void 0:f.getItems())||[];return Promise.all(Array.from(h.values()).map(async I=>{const y=await I.getPath();return a.executeCommand(`remove "${y}" -r -ignore`)}))}))}},{type:W.SEPARATOR},{title:"Info",options:r.info,async action(){const p=e.getSelectedItems()||[];await Promise.all(p.filter(f=>f.fsItem).map(async f=>{if(f.fsItem){const h=await g(()=>import("./33-aPMrx.js"),__vite__mapDeps([51,52,53,37,38,36,39,18,19,20,1,21,22,23,54]),import.meta.url).then(I=>I.default);t.addWindow({component:h,componentData:{fsItem:D(f.fsItem)},layout:{size:at(460,280)},options:{title:`Info File ${f.fsItem.name}`,scaleX:!0,scaleY:!0,prompt:!1,scrollX:!0,scrollY:!0}})}else throw new Error(`Item has no fsItem. ${f.id}`)}))}}]}];function s(){(e.getSelectedItems()||[]).filter(f=>f.fsItem).forEach(f=>{if(f.command){const h={showCommand:!1,show:!0};return a.executeCommand(f.command,h)}})}async function n({name:p,url:f,symbol:h},I){if(I||(I=await a.executeCommand(`saveFileDialog --id="${Xt(p)}"`)),I){const y=a.addExecution();try{const A=I.getPath();await a.executeCommand(`rename "${A}" "${p}" -n`),await a.executeCommand(`editfilemeta "${A}" "${b.WEB_URL}" "${f}"`),await a.executeCommand(`editfilemeta "${A}" "${b.SYMBOL}" "${h}"`)}catch(A){throw y(),A}return y(),!0}return!1}async function o(){const p=await g(()=>import("./CQ8j2mzx.js"),__vite__mapDeps([55,4,20,1,21,22,23,6,7,14,15,16,17,8,9,12,13,56]),import.meta.url).then(h=>h.default);return t.addWindow({component:p,componentData:{model:{actions:{save:n},name:null,url:null,symbol:"default"}},options:{title:"Make Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}async function l(){const p=e.getSelectedItems();await Promise.all(p.filter(f=>f.fsItem).map(async f=>{const h=f.fsItem;if(h){const I=await g(()=>import("./CQ8j2mzx.js"),__vite__mapDeps([55,4,20,1,21,22,23,6,7,14,15,16,17,8,9,12,13,56]),import.meta.url).then(y=>y.default);t.addWindow({component:I,componentData:{fsItem:D(h),model:{actions:{save:n},name:h.name,url:h.meta.get(b.WEB_URL),symbol:h.meta.get(b.SYMBOL)}},options:{title:"Edit Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}else throw new Error(`Item has no fsItem. ${f.id}`)}))}async function c(){const p=e.getSelectedItems();await Promise.all(p.filter(f=>f.fsItem).map(async f=>{const h=f.fsItem;if(h){const I=pe({actions:{save:w},id:h.id,name:h.name});[b.SYMBOL,b.VISIBLE,b.IGNORE_SYMBOL_REARRANGE,b.WINDOW_SCALE,b.WINDOW_SCROLL_X,b.WINDOW_SCROLL_Y,b.WINDOW_FULL_SIZE,b.WINDOW_SYMBOL_REARRANGE,b.WINDOW_SIDEBAR].forEach(A=>{I[A]=h.meta.has(A)?h.meta.get(A):!1});const y=await g(()=>import("./DWcwTzDj.js"),__vite__mapDeps([57,4,20,1,21,22,23,6,7,14,15,16,17,8,9,12,13,26,27,28,58]),import.meta.url).then(A=>A.default);t.addWindow({component:y,componentData:{fsItem:D(h),model:I},options:{title:`Edit File ${h.name}`,prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}else throw new Error(`Item has no fsItem. ${f.id}`)}))}function u(){return[b.SYMBOL,b.VISIBLE,b.IGNORE_SYMBOL_REARRANGE,b.WINDOW_SCALE,b.WINDOW_SCROLL_X,b.WINDOW_SCROLL_Y,b.WINDOW_FULL_SIZE,b.WINDOW_SYMBOL_REARRANGE,b.WINDOW_SIDEBAR]}async function w(p,f){const{id:h,name:I}=p,y=f.getPath();if(!h)throw new Error("Id is emoty!");let A;const B=a.addExecution();try{await Promise.all(u().map(j=>{let z=p[j];return typeof z=="string"&&(z=`"${z}"`),a.executeCommand(`editfilemeta "${y}" "${j}" ${z}`)})),I&&h!==I?await a.executeCommand(`rename "${y}" "${I}" -n`):A=a.executeCommand(`rename "${y}" "${h}" -rn`),A=a.executeCommand(`rename "${y}" "${h}"`)}catch(j){throw B(),j}return B(),A}}),Sa=fe(({module:a})=>{const{fileSystem:e,core:t,disks:r}=a;return[{name:["mountDisk"],description:"Mount Disk",args:[new d({index:0,name:"id",description:"Disk ID"})],async action({id:i},s){const n=t.addExecution();try{const o=await r[i].data(),l=await e.addFloppyDisk(()=>o({core:t}));r[i].hidden||s.message(`Mount Disk <strong>${l.name}</strong> <strong>(${l.id})</strong> successful!`),n()}catch(o){throw console.error(o),S.get("cant_find_disk",i)}}},{name:["changeDirectory","cd"],description:"cd %path%",args:[new d({index:0,name:"path",description:"Directory path"})],async action({path:i}){if(!i)throw S.get("bad_args");try{await e.changeDirectory(i)}catch(s){throw console.error(s),S.get("cant_find",i)}}},{name:["exist"],description:"Check if file exists.",args:[new d({index:0,name:"path",description:"Filename"})],async action({path:i},s){if(!i)throw S.get("bad_args");const n=mt(i),o=await e.exist(i);return o?s.message(`File ${n} exists`):s.message(`File ${n} does not exist`),o}},{name:["makedir","mkdir"],args:[new d({index:0,name:"path",description:"Filename"}),new d({index:1,name:"name",description:"Name"}),new d({name:"ignore",flag:!0,description:"Ignore file exist."})],async action({path:i,name:s,ignore:n},o){if(!i)throw S.get("bad_args");const l=await e.makedir(i,s||mt(i),{override:n});return o.message(`Directory "${l.name}" created`),l}},{name:["remove","rm"],args:[new d({index:0,name:"path",description:"Filename"}),new d({name:["recursive","r"],flag:!0,description:"Remove Directory Items and Directories."}),new d({name:["ignore"],flag:!0,description:"Ignore the specified file is deleted."})],async action({path:i,recursive:s,ignore:n},o){if(!i)throw S.get("bad_args");return(await e.remove(i,s,{ignore:n})||[]).map(c=>{const u=c.type===je.TYPE?"Directory":"File";return o.message(`Removed ${u}: ${c.name}`),c})}},{name:["readfile","getfile"],description:"Get file content",args:[new d({index:0,name:"path",description:"Filename"})],async action({path:i}){if(!i)throw S.get("bad_args");return(await e.get(i)).data}},{name:["makefile","mkfile"],description:"Creates a file with the specified attributes.",args:[new d({index:0,name:"path",description:"Filename"}),new d({index:1,name:"name",description:"Name"}),new d({index:3,name:"data",description:"Data"}),new d({name:"override",flag:!0,description:"Deletes existing file and recreates."})],async action({path:i,name:s,data:n,override:o=!1},l){if(!i)throw S.get("bad_args");typeof n=="string"&&(n=ut(n));const c=await e.makefile(i,s,n,{override:o||!1,meta:[]});return l.message(`File "${c.name}" created`),c}},{name:["editfile"],description:"Edits file with specified attributes.",args:[new d({index:0,name:"path",description:"Filename"}),new d({index:1,name:"data",description:"Data"})],async action({path:i,data:s},n){if(!i)throw S.get("bad_args");typeof s=="string"&&(s=ut(s));const o=await e.editfile(i,s);return n.message(`File "${o.name}" edited`),o}},{name:["editfilemeta"],description:"Edits file with specified attributes.",args:[new d({index:0,name:"path",description:"Filename"}),new d({index:1,name:"name",description:"Name"}),new d({index:2,name:"value",description:"Value"})],async action({path:i,name:s,value:n},o){if(!i)throw S.get("bad_args");const l=await e.editfileMeta(i,s,n);return o.message(`File  "${l.name}" Meta edited`),l}},{name:["makelink","mklink"],description:"Creates a link to the specified path.",args:[new d({index:0,name:"ref",description:"Reference path with id (example.ext)."}),new d({index:1,name:"name",description:"Displayed Name"}),new d({index:2,name:"dest",description:"Destination directory."})],async action({ref:i,name:s,dest:n},o){if(!i)throw S.get("bad_args");n=n||".";const l=await e.get(i),c=await e.makelink(l,s);return await e.get(n)!==e.currentItem&&await e.move(c,n,{override:!0}),o.message(`Created link "${s}" with "${await l.getPath()}"`),c}},{name:["editlink"],description:"",args:[new d({index:0,name:"path",description:"Reference filepath with id (example.ext)."}),new d({index:1,name:"ref",description:"Destination directory."})],async action({path:i,ref:s},n){if(!(i&&s))throw S.get("bad_args");const o=await e.get(s),l=await e.editlink(i,o);return n.message(`Edited link "${name}" with "${await o.getPath()}"`),l}},{name:"rename",description:"Renamed a file",args:[new d({index:0,name:"path",description:"Filepath with id (example.ext)."}),new d({index:1,name:"value",description:"Value for id or displayed name."}),new d({name:["name","n"],flag:!0,description:"When set, changes the display name."}),new d({name:["removeName","rn"],flag:!0,description:"When set, removes the display name."})],async action({path:i,value:s,name:n,removeName:o},l){if(!o&&(!i||!s))throw S.get("bad_args");const c=await e.get(i),u=n?c.name:c.id;return await e.rename(i,s,{name:n,removeName:o}),l.message(`Renamed from "${u}" to "${s}"`),c}},{name:["cp","copy"],args:[new d({index:0,name:"from",description:"Source Filepath with id (example.ext)."}),new d({index:1,name:"dest",description:"Destination Filepath with id (example.ext)."}),new d({name:["ignore","i"],flag:!0,description:"When sets, creates a new file if exists."})],async action({from:i,dest:s,ignore:n},o){let l=s;if(!l&&n&&(l=i),!l||!i)throw S.get("bad_args");const c=await e.copy(i,l,{ignore:n});return o.message(`Copied from "${i}" to "${l}"`),c}},{name:["mv","move"],description:"move %from% %to%",args:[new d({index:0,name:"from",description:"From path"}),new d({index:1,name:"to",description:"To path"}),new d({index:2,name:"item-position",description:"Sets the position in the Icon view. (x,y)"})],async action({from:i,to:s,itemPosition:n},o){if(!s||!i)throw S.get("bad_args");const l=await e.move(i,s);n&&l.meta.set(b.POSITION,[0,0].map((u,w)=>{const p=n.split(",");return parseInt(p[Number(w)]||"0")})),l.save();let c;return l instanceof je?c="Directory":c="File",o.message(`${c} moved ${l.name}`),l}},{name:["executeFile"],description:"Execute file.",args:[new d({index:0,name:"path",description:"Path to the file"})],async action({path:i}){if(!i)throw S.get("bad_args");const s=await e.get(i);if(typeof s.action=="function")return s.action(t);throw S.get("cant_find_action",i)}}]});S.add("cant_find_action","Can't find action %1");S.add("cant_find_disk","Can't find disk %1");const ba=new class{constructor(){E(this,"firebase",null)}get(){return this.firebase||(this.firebase=this.getImports())}getImports(){return Promise.all([g(()=>import("./PS5SoCZn.js"),__vite__mapDeps([59,60]),import.meta.url).then(e=>e.default||e),g(()=>import("./CfrwDXeG.js"),__vite__mapDeps([61,60,36]),import.meta.url).then(e=>e.default||e),g(()=>import("./AyGIKDDV.js"),__vite__mapDeps([62,60]),import.meta.url).then(e=>e.default||e)]).then(([e,t,r])=>({app:e,auth:t,database:r}))}},Ue=new Map;class ya extends jt{constructor(){super(...arguments);E(this,"modules");E(this,"services");E(this,"app")}get name(){var t;return(t=this.app)==null?void 0:t.name}async connect(t,{apiKey:r,url:i}){if(this.modules=await ba.get(),this.app)Ue.has(t)&&(this.app=Ue.get(t));else{const s=this.modules.app.initializeApp({apiKey:r,databaseURL:i},t);Ue.set(s.name,s),this.app=s}return this.app}async disconnect(){var t;if(!this.app)throw S.get("FirebaseWrapper_noApp");ge(this),await this.logout(),await((t=this.modules)==null?void 0:t.app.deleteApp(this.app)),this.app=void 0}get locked(){return!!this.app&&!this.isLogged()}get currentUser(){var t;if((t=this.modules)!=null&&t.auth){const{getAuth:r}=this.modules.auth;return r(this.app).currentUser}}isLogged(){return!!this.app&&!!this.currentUser}login(t,r){var i;if((i=this.modules)!=null&&i.auth){const{getAuth:s,signInWithEmailAndPassword:n}=this.modules.auth,o=s(this.app);return ge(this),n(o,t,r)}}logout(){var t;if(this.app&&((t=this.modules)!=null&&t.auth)){const{getAuth:r,signOut:i}=this.modules.auth,s=r(this.app);return i(s)}else throw S.get("FirebaseWrapper_notConnected")}remove(t){var r;if(ge(this),(r=this.modules)!=null&&r.database){const{remove:i,ref:s,getDatabase:n}=this.modules.database,o=n(this.app),l=s(o,t);return i(l)}}get(t){var r;if(ge(this),(r=this.modules)!=null&&r.database){const{ref:i,onValue:s,getDatabase:n}=this.modules.database,o=n(this.app),l=i(o,t);return new Promise(c=>{s(l,u=>c(u.val()))})}}async set(t,r){var i;if(ge(this),(i=this.modules)!=null&&i.database){const{ref:s,set:n,getDatabase:o}=this.modules.database,l=o(this.app),c=s(l,t);return await n(c,r),r}}}function ge(a){if(!a.app)throw S.get("FirebaseWrapper_notConnected")}S.add([["FirebaseWrapper_notConnected",["Not connected","Not connected"]],["FirebaseWrapper_noApp",["No app available","No app available"]],["FirebaseWrapper_hasApp",["App already available",'App "%1" already available']]]);class Ia extends zt{constructor(e){super({...e,storage:new ya})}async mount(e){if(e.onDisconnect=()=>{this.unmount()},this.storage)return await this.storage.connect(e.id,{apiKey:e.apiKey,url:e.url}),this;throw new Error("no storage")}async unmount(){if(this.storage)return await this.storage.disconnect(),this;throw new Error("no storage")}async load(){if(this.storage){let e=await this.storage.get(this.name);return e||(e={},this.storage.locked||await this.storage.set(this.name,e)),this.data=e,e}else throw new Error("no storage")}async save(e){if(this.storage)return e=Lt(e),this.data=e||this.data,await this.storage.set(this.name,e),this.data;throw new Error("no storage")}get locked(){var e;return((e=this.storage)==null?void 0:e.locked)||!1}}function Lt(a){return Object.fromEntries(Object.entries(a).filter(([,e])=>e).map(([e,t])=>(t&&typeof t=="object"&&(t=Lt(t)),[e,t])))}const we=new Map,va=fe(({module:a,core:e})=>{const{fileSystem:t}=a;return[{name:"cloudList",args:[new d({name:"json",flag:!0,description:"Get JSON Export"})],action({json:r},i){const s=Array.from(we.values());if(r)return Promise.resolve(s);{const n=new le;return n.addColumns([{value:"Storage (Id)",align:"left",minWidth:15},{value:"Name",align:"left",minWidth:15},{value:"Logged In",align:"center",minWidth:9}]),n.addRows(s.reduce((o,l)=>(o.push([l.id,l.name,l.storage.storage.isLogged()?"yes":"no"]),o),[])),i.message([n]),Promise.resolve()}}},{name:"cloudMountFirebase",args:[new d({index:0,name:"id",flag:!0,description:"Id from Storage."}),new d({index:1,name:"apiKey",description:"Firebase Api-Key."}),new d({index:2,name:"url",description:"Firebase Database-Url."})],async action({id:r,apiKey:i,url:s},n){if(!i||!s)throw S.get("bad_args");const o=e.addExecution(),l=await t.connect(Ia,{id:r,apiKey:i,url:s});return we.set(l.id,l),n.message(`Mount <strong>${l.name}</strong> <strong>(${l.id})</strong> successful!`),o(),l}},{name:"cloudUnmount",args:[new d({index:0,name:"id",flag:!0,description:"Id from Storage."})],async action({id:r},i){if(!r)throw S.get("bad_args");const s=e.addExecution();try{const n=we.get(r);await t.disconnect(n),we.delete(n.id),i.message(`Unmount "${n.name}" successful!`),s()}catch(n){throw s(),n}}},{name:"cloudAuth",args:[new d({name:"login",flag:!0,description:"Storage Login"}),new d({name:"logout",flag:!0,description:"Logout from Storage."}),new d({name:"email",description:"Email for Login."}),new d({name:"password",description:"Password for Login."}),new d({name:"storage",description:"Specifies which drive is logged on."})],async action({email:r,password:i,storage:s,login:n,logout:o},l){const c=s;if(!c)throw S.get("bad_args");const u=e.addExecution(),w=we.get(c);let p;if(w)try{if(n){if(!r||!i)throw S.get("bad_args");p=await w.storage.storage.login(r,i),l.message(`Login with ${w.id} (${w.id}) successful!`)}else o&&(p=await w.storage.storage.logout(),l.message(`Logout from ${w.id} (${w.id}) successful!`))}catch(f){if(u(),f instanceof Error&&"code"in f){switch(f.code){case"auth/user-not-found":case"auth/wrong-password":return f}throw f}}else throw new Error(`${c} is not mounted.`);return u(),p}}]}),St=D(new Ht("web_workbench_FS"));class $t extends ke{constructor({core:t}){super({name:"Files",commands:({module:r,core:i})=>[...Ea({module:r,core:i}),...Sa({module:r}),...va({module:r,core:i})],contextMenu:_a,core:t});E(this,"fileSystem",St);E(this,"fs",St);E(this,"disks",{})}async addDisks(t){[...t].sort((r,i)=>r.order>i.order?1:r.order<i.order?-1:0).forEach(r=>{this.disks[r.name]=r})}}E($t,"NAME","Files");class Aa{constructor(e){E(this,"defaultItems",new Qe);E(this,"activeItems");E(this,"core");this.core=e,this.activeItems=this.defaultItems}addDefaultItems(e){this.defaultItems.add(e)}getActiveItems(){return this.activeItems}setActiveItems(e){return this.activeItems=e||this.defaultItems}}const Ra=rt(({core:a})=>{const{windows:e}=a.modules;return[{order:0,title:"Web-Workbench",items:[{title:"Settings",action(){return a.executeCommand("openSettings")}},{type:W.SEPARATOR},{hotKey:"I",keyCode:73,title:"Info",async action(){const t=await g(()=>import("./CCb_aLi_.js"),__vite__mapDeps([63,40,1,41,18,19,20,21,22,23,64]),import.meta.url).then(r=>r.default);e==null||e.addWindow({component:t,componentData:{},options:{title:"Info",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}},{type:W.SEPARATOR},{title:"Imprint",action(){return a.executeCommand('execute "Imprint.md"')}},{title:"Disclaimer",action(){return a.executeCommand('execute "Disclaimer.md"')}}]}]}),Ta={xmlns:"http://www.w3.org/2000/svg",width:"6",height:"10",viewBox:"0.5 50.5 6 10"};function Da(a,e){return q(),ce("svg",Ta,e[0]||(e[0]=[J("path",{fill:"#020203",d:"M.5 50.5h6v2h-4v2h2v2h-2v4h-2z"},null,-1)]))}const Pa={render:Da},Na={xmlns:"http://www.w3.org/2000/svg",width:"6",height:"10"};function Oa(a,e){return q(),ce("svg",Na,e[0]||(e[0]=[J("path",{d:"M0 10h6V8H2V6h2V4H2V2h4V0H0z"},null,-1)]))}const La={render:Oa},$a={class:"icon full"},xa={class:"icon empty"},Ca=vt({__name:"StorageBar",props:{visible:{type:Boolean,default:!0},value:{type:Number,default:.8}},setup(a){const e=a,t=He(()=>({"--bar-height":Math.min(e.value,1)}));return(r,i)=>a.visible?(q(),ce("div",{key:0,class:"wb-env-atom-storage-bar",style:Jt(t.value)},[J("div",null,[J("div",$a,[Ce(ft(Pa))]),i[0]||(i[0]=J("span",{class:"size"},[J("span",{class:"helper"})],-1)),J("div",xa,[Ce(ft(La))])])],4)):_e("",!0)}}),Wa=At(Ca,[["__scopeId","data-v-3d4c6ce7"]]),Va={class:"wb-env-molecule-dialog-content"},ka=["innerHTML"],Ma={key:1,class:"input"},Fa=vt({__name:"DialogContent",props:{message:{type:String,default(){return"Dialog Message"}},confirm:{type:Boolean,default:!1},prompt:{type:Boolean,default:!1},promptType:{type:String,default:"text"},promptStep:{type:Number,default:void 0},promptValue:{type:String,default:""},password:{type:Boolean,default:!1},apply:{type:Function,default(){return null}},abort:{type:Function,default(){return null}},applyLabel:{type:String,default(){return"Continue"}},abortLabel:{type:String,default(){return"Cancel"}},yesLabel:{type:String,default(){return"Yes"}},noLabel:{type:String,default(){return"No"}}},emits:["apply","abort"],setup(a,{emit:e}){const t=a,r=e,i=er(t.promptValue),s=He(()=>t.password?"password":t.promptType),n=He(()=>t.message.replace(/\\n|\n/g,"<br>")),o=()=>{const c=i.value||!0;typeof t.apply=="function"?t.apply(c):r("apply",c)},l=()=>{typeof t.abort=="function"?t.abort():r("abort")};return(c,u)=>(q(),ce("div",Va,[J("div",null,[a.message?(q(),ce("p",{key:0,innerHTML:n.value},null,8,ka)):_e("",!0),a.prompt?(q(),ce("div",Ma,[Ce(mr,{ref:"dialogInput",modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=w=>i.value=w),step:a.promptStep,type:s.value,label:null},null,8,["modelValue","step","type"])])):_e("",!0),Ce(ur,{align:a.abortLabel?"outer":"center",class:"buttons"},{default:tr(()=>[a.applyLabel||a.confirm&&a.yesLabel?(q(),ht(wt,{key:0,"style-type":"dialog",label:a.confirm?a.yesLabel:a.applyLabel,onClick:o},null,8,["label"])):_e("",!0),a.abortLabel||a.confirm&&a.noLabel?(q(),ht(wt,{key:1,"style-type":"dialog",label:a.confirm?a.noLabel:a.abortLabel,onClick:l},null,8,["label"])):_e("",!0)]),_:1},8,["align"])])]))}}),Ba=At(Fa,[["__scopeId","data-v-302c1124"]]),Ua=fe(({module:a,core:e})=>{var s;const t=(s=e.modules.files)==null?void 0:s.fs,r=e.modules.symbols,i=e.modules.windows;return[{name:["openDirectory","openDir"],description:"Opens the specified directory.",args:[new d({index:0,name:"path",description:"Path to the directory."}),new d({name:"sortSymbols",description:"Sort Symbols",flag:!0}),new d({name:"windowSize",description:"Window Size"}),new d({name:"windowPosition",description:"Window Position"}),new d({name:"windowScale",description:"Window Scale"}),new d({name:"windowScrollX",description:"Window Scroll-X"}),new d({name:"windowScrollY",description:"Window Scroll-Y"}),new d({name:"windowSidebar",description:"Window Sidebar"}),new d({name:"windowFullSize",description:"Window Full-Size"})],async action(n){const{path:o,sortSymbols:l,windowSize:c,windowPosition:u,windowScale:w,windowScrollX:p,windowScrollY:f,windowSidebar:h,windowFullSize:I}=n;if(!o)throw S.get("bad_args");const y=await(t==null?void 0:t.get(o));if(!y)throw S.get("FileSystemItem_itemNotFound",o);if(!(y instanceof It))throw S.get("FileSystemItem_itemNotContainer",o);const A=await(r==null?void 0:r.addFileSystemWrapper(y)),B=r==null?void 0:r.getWrapper(String(A)),j=pe({value:y.size/y.maxSize}),z=Me=>{const[Pe,he]=Me.split(",");return at(Number(Pe),Number(he))},H=i==null?void 0:i.addWindow({layout:{size:z(c||"400,200"),position:z(u||"0,0")},sidebarComponent:Wa,sidebarComponentData:j,component:Zt,componentData:{wrapperId:A,parentScrollable:p||f},options:{title:y.name,sidebar:h!==void 0?h:!0,scale:w!==void 0?w:!0,scrollX:p!==void 0?p:!0,scrollY:f!==void 0?f:!0,center:!u}},{active:!0,full:I}),it=()=>{j.value=y.size/y.maxSize},Ct=[B==null?void 0:B.events.subscribe(it)];return new Promise(Me=>{H==null||H.events.subscribe(({name:Pe})=>{Pe==="ready"&&l?window.requestAnimationFrame(()=>{B==null||B.rearrangeIcons()}):Pe==="close"?(Ct.forEach(he=>he==null?void 0:he.unsubscribe()),A&&(r==null||r.removeWrapper(A)),Me(!0)):it()})})}},{name:["openDialog"],description:"Open a Dialog.",args:[new d({index:0,name:["message"],description:"Message from Dialog."}),new d({index:1,name:["title"],description:"Title from Dialog."}),new d({name:["apply"],description:"Title from apply button."}),new d({name:["abort"],description:"Title from abort button."}),new d({name:["confirm"],flag:!0,description:"Defines the confirm dialog"}),new d({name:["prompt"],flag:!0,description:"Defines the prompt dialog"}),new d({name:["promptType"],description:"Type from prompt dialog (e.g. text, number, email). (Default: text)"}),new d({name:["promptStep"],description:"Step from prompt dialog (e.g. 1, 0.1, 0.01). (Default: 1)"}),new d({name:["promptValue"],description:"Default value from prompt dialog."}),new d({name:["secret"],flag:!1,description:"Input is illegible."})],action:n=>{const{title:o,message:l=null,apply:c=null,abort:u=null,confirm:w=!1,prompt:p=!1,promptType:f="text",promptStep:h=void 0,promptValue:I=null,secret:y=!1}=n;let A;const B=H=>{A(H)},j=()=>{A(!1)},z=a.addWindow(new ze({component:Ba,componentData:{title:o,message:l,secret:y,confirm:w,prompt:p,promptType:f,promptStep:Number(h),promptValue:I,applyLabel:c||"Continue",abortLabel:u,apply:B,abort:j},options:{scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1,close:!1}}));return z.awaitClose().then(()=>j()),new Promise(H=>{A=H}).then(H=>(z.close(),H))}}]});class Ya extends ke{constructor(t){super({config:lr,commands:Ua,...t,name:"Windows"});E(this,"wrappers",D(new Map));E(this,"contentWrapper");E(this,"globalWrapper");E(this,"contextMenu");this.contextMenu=pe(new Aa(this.core)),this.contentWrapper=this.getWrapper(this.addWrapper(new dt(this.core))),this.globalWrapper=this.getWrapper(this.addWrapper(new dt(this.core))),Ar({contentWrapper:this.contentWrapper.events,globalWrapper:this.globalWrapper.events}).subscribe(r=>{console.log("event",r)})}addWindow(t,r={}){let i;return t instanceof ze?i=t:i=new ze(t),i.componentData&&(i.componentData.core=D(this.core)),r={global:!1,...r},r.global?i=this.globalWrapper.add(i,r):i=this.contentWrapper.add(i,r),i}getWrapper(t){return this.wrappers.get(t)}getFocusedWrapper(){return Array.from(this.wrappers.values()).map(({models:t})=>t.value).flat().find(t=>t.options.focused)}addWrapper(t){return this.wrappers.set(t.id,t),t.id}removeWrapper(t){typeof t!="string"&&(t=t.id),this.wrappers.delete(t)}isContextMenu(t){return t.id===this.getActiveContextMenu().id}setup(){this.contextMenu.addDefaultItems(new Qe(Ra,{core:this.core})),this.contextMenu.addDefaultItems(new Qe(cr,{core:this.core}))}clear(){this.contentWrapper.clear(),this.globalWrapper.clear()}getActiveContextMenu(){return this.contextMenu.getActiveItems()}setActiveContextMenu(t){return this.contextMenu.setActiveItems(t)}}const Ga={[_.DEFAULT]:()=>g(()=>import("./DuRZ77ma.js"),__vite__mapDeps([65,1]),import.meta.url).then(a=>a.default),[_.DIRECTORY]:()=>g(()=>import("./C8jtdYnp.js"),__vite__mapDeps([66,1]),import.meta.url).then(a=>a.default),[_.DIRECTORY_PREFS]:()=>g(()=>import("./YQZY2WiX.js"),__vite__mapDeps([67,1]),import.meta.url).then(a=>a.default),[_.CLOUD_DISK]:()=>g(()=>import("./DxN6T3Eb.js"),__vite__mapDeps([68,1]),import.meta.url).then(a=>a.default),[_.HARD_DISK]:()=>g(()=>import("./DBY-TPLx.js"),__vite__mapDeps([69,1]),import.meta.url).then(a=>a.default),[_.RAM_DISK]:()=>g(()=>import("./D4Eys56B.js"),__vite__mapDeps([70,1]),import.meta.url).then(a=>a.default),[_.TMP_DISK]:()=>g(()=>import("./DM13WIpn.js"),__vite__mapDeps([71,1]),import.meta.url).then(a=>a.default),[_.DISK_1]:()=>g(()=>import("./BVJ9ZQs1.js").then(a=>a.d),__vite__mapDeps([72,3,4,5,73,74,19,20,1,21,22,23,34,33,35,36,37,38,39,75,76,77,78,79,52,53,80]),import.meta.url).then(a=>a.default),[_.DISK_2]:()=>g(()=>import("./PIY7Fxsh.js"),__vite__mapDeps([81,1]),import.meta.url).then(a=>a.default),[_.DISK_WORKBENCH13]:()=>g(()=>import("./CpKgHQdz.js"),__vite__mapDeps([82,1]),import.meta.url).then(a=>a.default),[_.DISK_MARKDOWN]:()=>g(()=>import("./BDDIUDB7.js"),__vite__mapDeps([83,1]),import.meta.url).then(a=>a.default),[_.DISK_BASIC]:()=>g(()=>import("./Dc4CyA3k.js"),__vite__mapDeps([84,1]),import.meta.url).then(a=>a.default),[_.WORK]:()=>g(()=>import("./CLfbuiHm.js"),__vite__mapDeps([85,1]),import.meta.url).then(a=>a.default),[_.CONSOLE]:()=>g(()=>import("./0e3xVbwT.js"),__vite__mapDeps([86,1]),import.meta.url).then(a=>a.default),[_.SETTINGS]:()=>g(()=>import("./B9R4RqQk.js"),__vite__mapDeps([87,1]),import.meta.url).then(a=>a.default),[_.TRASHCAN]:()=>g(()=>import("./ddNVbTB1.js"),__vite__mapDeps([88,1]),import.meta.url).then(a=>a.default),[_.COMPUTER_1]:()=>g(()=>import("./BqI57yGT.js"),__vite__mapDeps([89,1]),import.meta.url).then(a=>a.default),[_.TELEPHONE]:()=>g(()=>import("./BnUYaBTP.js"),__vite__mapDeps([90,1]),import.meta.url).then(a=>a.default),[_.CURSOR]:()=>g(()=>import("./hKONtwb2.js"),__vite__mapDeps([91,1]),import.meta.url).then(a=>a.default),[_.PREFERENCE]:()=>g(()=>import("./DMKDWS0n.js"),__vite__mapDeps([92,1]),import.meta.url).then(a=>a.default),[_.WEB_BASIC]:()=>g(()=>import("./C8P-FY5n.js"),__vite__mapDeps([93,1]),import.meta.url).then(a=>a.default),[_.WEB_PAINTING]:()=>g(()=>import("./CDfc0YQ-.js"),__vite__mapDeps([94,1]),import.meta.url).then(a=>a.default),[_.COLORS]:()=>g(()=>import("./D2stiSYP.js"),__vite__mapDeps([95,1]),import.meta.url).then(a=>a.default),[_.PRINT_1]:()=>g(()=>import("./PdZEp8mc.js"),__vite__mapDeps([96,1]),import.meta.url).then(a=>a.default),[_.PRINT_2]:()=>g(()=>import("./9QeckQhW.js"),__vite__mapDeps([97,1]),import.meta.url).then(a=>a.default),[_.NOTEPAD]:()=>g(()=>import("./CntqoV1v.js"),__vite__mapDeps([98,1]),import.meta.url).then(a=>a.default),[_.BASIC]:()=>g(()=>import("./Chbmc6j2.js"),__vite__mapDeps([99,1]),import.meta.url).then(a=>a.default),[_.IMAGE]:()=>g(()=>import("./OWHxvJKP.js"),__vite__mapDeps([100,1]),import.meta.url).then(a=>a.default),[_.NOTE]:()=>g(()=>import("./CIEO4uhY.js"),__vite__mapDeps([101,1]),import.meta.url).then(a=>a.default),[_.NOTE_BLANK]:()=>g(()=>import("./D2cNQHja.js"),__vite__mapDeps([102,1]),import.meta.url).then(a=>a.default),[_.LARGE_NOTE]:()=>g(()=>import("./0zf-5E6l.js"),__vite__mapDeps([103,1]),import.meta.url).then(a=>a.default),[_.LARGE_NOTE_RICH]:()=>g(()=>import("./B1XBBOEp.js"),__vite__mapDeps([104,1]),import.meta.url).then(a=>a.default),[_.FULLSCREEN]:()=>g(()=>import("./jEEiKj_P.js"),__vite__mapDeps([105,1]),import.meta.url).then(a=>a.default),[_.CALCULATOR]:()=>g(()=>import("./CTeCj-It.js"),__vite__mapDeps([106,1]),import.meta.url).then(a=>a.default),[_.CLOCK]:()=>g(()=>import("./DsuRpeu2.js"),__vite__mapDeps([107,1]),import.meta.url).then(a=>a.default),[_.KEYBOARD_QUESTION]:()=>g(()=>import("./Bpv_BcSV.js"),__vite__mapDeps([108,1]),import.meta.url).then(a=>a.default),[_.LARGE_NOTEPAD]:()=>g(()=>import("./Dk_J3ibT.js"),__vite__mapDeps([109,1]),import.meta.url).then(a=>a.default),[_.LARGE_NOTEPAD_HELP]:()=>g(()=>import("./CmIGOicc.js"),__vite__mapDeps([110,1]),import.meta.url).then(a=>a.default),[_.RABBIT]:()=>g(()=>import("./CTl8GMYu.js"),__vite__mapDeps([111,1]),import.meta.url).then(a=>a.default),[_.MORE]:()=>g(()=>import("./DBxlfuvc.js"),__vite__mapDeps([112,1]),import.meta.url).then(a=>a.default),[_.SAY]:()=>g(()=>import("./BFeMLmMi.js"),__vite__mapDeps([113,1]),import.meta.url).then(a=>a.default),[_.GITHUB]:()=>g(()=>import("./DNlKV1jE.js"),__vite__mapDeps([114,1]),import.meta.url).then(a=>a.default),[_.LAMMPEE]:()=>g(()=>import("./C1CMnKdE.js"),__vite__mapDeps([115,1]),import.meta.url).then(a=>a.default),[_.CUBY]:()=>g(()=>import("./CDl6MwL_.js"),__vite__mapDeps([116,1]),import.meta.url).then(a=>a.default),[_.NUXT]:()=>g(()=>import("./BC7DO-uu.js"),__vite__mapDeps([117,1]),import.meta.url).then(a=>a.default),[_.CLOWN]:()=>g(()=>import("./BU4F8h9z.js"),__vite__mapDeps([118,1]),import.meta.url).then(a=>a.default),[_.DISALLOW_1]:()=>g(()=>import("./kXaLjbmr.js"),__vite__mapDeps([119,1]),import.meta.url).then(a=>a.default),[_.COPY_1]:()=>g(()=>import("./-yaVoX4I.js"),__vite__mapDeps([120,1]),import.meta.url).then(a=>a.default),[_.COPY_2]:()=>g(()=>import("./BM1Z0Rpo.js"),__vite__mapDeps([121,1]),import.meta.url).then(a=>a.default),[_.DISPLAY_KEYBOARD]:()=>g(()=>import("./AB-hjmGo.js"),__vite__mapDeps([122,1]),import.meta.url).then(a=>a.default),[_.PALETTE]:()=>g(()=>import("./KSJzhc0X.js"),__vite__mapDeps([123,1]),import.meta.url).then(a=>a.default),[_.SIGN_1]:()=>g(()=>import("./B4WIvlbm.js"),__vite__mapDeps([124,1]),import.meta.url).then(a=>a.default),[_.DOCUMENT_EDITOR]:()=>g(()=>import("./DueUY6TH.js"),__vite__mapDeps([125,1]),import.meta.url).then(a=>a.default),[_.DOCUMENT_READER]:()=>g(()=>import("./D8NcHpdc.js"),__vite__mapDeps([126,1]),import.meta.url).then(a=>a.default),[_.SYNTHESIZER]:()=>g(()=>import("./D1UQUYqe.js"),__vite__mapDeps([127,1]),import.meta.url).then(a=>a.default),[_.VUE_SEMANTIC_STRUCTURE]:()=>g(()=>import("./D_BvfAz4.js"),__vite__mapDeps([128,1]),import.meta.url).then(a=>a.default),[_.NUXT_BOOSTER]:()=>g(()=>import("./BS_RkiIy.js"),__vite__mapDeps([129,1]),import.meta.url).then(a=>a.default)},Xa=rt(({module:a,core:e})=>[{order:30,title:"Symbol",items:[{type:W.CHECKBOX,title:"Show Invisible Symbols",model:e.config.observable,name:N.SHOW_INVISIBLE_SYMBOLS,action(t){return e.config.set(N.SHOW_INVISIBLE_SYMBOLS,t)}},{title:"Rearrange Symbols",hotKey:"R",keyCode:82,action(){const t=a.getDefaultWrapper(),r=a.getPrimaryWrapper();if(r instanceof be&&(r==null?void 0:r.id)!==(t==null?void 0:t.id)){if(r==null||r.rearrangeIcons(),r!=null&&r.fsItem)return xe(r==null?void 0:r.fsItem);throw new Error("No fsItem found")}else if(t instanceof be){if(t==null||t.rearrangeIcons({root:!0}),t!=null&&t.fsItem)return xe(t==null?void 0:t.fsItem);throw new Error("No fsItem found")}}},{title:"Order Type",items:[{model:e.config.observable,type:W.RADIO,name:N.ORDER_TYPE,value:K.NAME,title:"Name",action(){return e.config.set(N.ORDER_TYPE,K.NAME)}},{model:e.config.observable,type:W.RADIO,name:N.ORDER_TYPE,value:K.TYPE,title:"Type",action(){return e.config.set(N.ORDER_TYPE,K.TYPE)}},{model:e.config.observable,type:W.RADIO,name:N.ORDER_TYPE,value:K.CREATED_DATE,title:"Created Date",action(){return e.config.set(N.ORDER_TYPE,K.CREATED_DATE)}},{model:e.config.observable,type:W.RADIO,name:N.ORDER_TYPE,value:K.EDITED_DATE,title:"Edited Date",action(){return e.config.set(N.ORDER_TYPE,K.EDITED_DATE)}}]},{title:"Order Direction",items:[{model:e.config.observable,type:W.RADIO,name:N.ORDER_DIRECTION,value:Ee.ASCENDING,title:"Ascending",action(){return e.config.set(N.ORDER_DIRECTION,Ee.ASCENDING)}},{model:e.config.observable,type:W.RADIO,name:N.ORDER_DIRECTION,value:Ee.DESCENDING,title:"Descending",action(){return e.config.set(N.ORDER_DIRECTION,Ee.DESCENDING)}}]}]}]),ja=({module:a})=>[{name:["rearrangeIcons"],description:"Rearrange Icons",args:[new d({name:"id",description:"Wraper id"}),new d({name:"root",description:"Use root wrapper",flag:!0})],async action({id:e,root:t}){const r=a.getDefaultWrapper(),i=a.getPrimaryWrapper();if(await new Promise(s=>window.requestAnimationFrame(s)),t){if(r.fsItem)return r==null||r.rearrangeIcons({root:!0}),xe(r.fsItem);throw new Error("No fsItem found")}else{let s=i;if(e&&(s=a.get(e),s instanceof be&&s.fsItem))return s.rearrangeIcons(),xe(s.fsItem)}}}];function za(){return{[N.SHOW_INVISIBLE_SYMBOLS]:!1,[N.ORDER_TYPE]:K.NAME,[N.ORDER_DIRECTION]:Ee.ASCENDING}}class Ha extends $e{}class xt extends ke{constructor(t){const{core:r}=Object.assign({core:null},t);super({name:"Symbols",config:za(),commands:ja,contextMenu:Xa,core:r});E(this,"events",D(new Ke));E(this,"symbols",D(new Map));E(this,"wrappers",D(new Map));E(this,"wrappersObservable",{});E(this,"hasSelectedItems",!1);E(this,"_activeWrapper");E(this,"_defaultWrapper");E(this,"activeWrapper");E(this,"defaultWrapper");E(this,"primaryWrapper");E(this,"secondaryWrapper")}addWrapper(t){return t=D(t),this.wrappers.set(t.id,t),this.wrappersObservable[t.id]=t,t.events.subscribe(this.onEventWrapper.bind(this)),t.id}onEventWrapper({name:t,value:r}){var i;r!=null&&r.wrapper&&(t==="selectItem"||t==="unselectItem")&&(this.hasSelectedItems=((i=r==null?void 0:r.wrapper.selectedItems.value)==null?void 0:i.length)>0,this.events.next(new Ha({name:"hasSelectedItems",value:this.hasSelectedItems})))}getWrapper(t){return typeof t!="string"&&(t=t.id),this.wrappers.get(t)}removeWrapper(t){typeof t!="string"&&(t=t.id),this.wrappers.delete(t),Reflect.deleteProperty(this.wrappersObservable,t)}getActiveWrapper(t=!1){var i;const r=(i=this.core.modules.windows)==null?void 0:i.contentWrapper.getActiveWindow();return r&&r.symbolWrapper?r.symbolWrapper:t?null:this.activeWrapper}getSelectedItems(){return Array.from(this.wrappers.values()).reduce((t,r)=>(r.selectedItems.value.forEach(s=>{const n=r.get(s);n&&t.push(n)}),t),[])}clearSelectedItems(){return Array.from(this.wrappers.values()).forEach(t=>{t.clearSelectedItems()})}async addFileSystemWrapper(t,r=!1){const i=new be(this.core,void 0,r);return await i.setup(t),this.addWrapper(i)}async setup(){var r;const t=(r=this.core.modules.files)==null?void 0:r.fs.root;t&&(await this.loadCoreSymbols(),this.setDefaultWrapper(await this.addFileSystemWrapper(t,!0)))}loadCoreSymbols(){return Promise.all(Object.values(_).map(async t=>this.symbols.set(t,await Ga[t]())))}get(t){return this.wrappers.get(t)}setDefaultWrapper(t){this._defaultWrapper=t;const r=this.wrappers.get(t);r&&(this.primaryWrapper=r,this.secondaryWrapper=r,this.activeWrapper=r,this.defaultWrapper=r)}getDefaultWrapper(){return this.defaultWrapper}getPrimaryWrapper(){return this.primaryWrapper||this.defaultWrapper}getSecondaryWrapper(){return this.secondaryWrapper||this.defaultWrapper}setPrimaryWrapper(t){if(t){let r;t instanceof Fe?r=t.id:r=t,this.primaryWrapper=this.wrappers.get(r)}else this.primaryWrapper=void 0;this.events.next(new $e({name:"setPrimaryWrapper",value:this.getPrimaryWrapper()}))}setSecondaryWrapper(t){if(t){let r;t instanceof Fe?r=t.id:r=t,this.secondaryWrapper=this.wrappers.get(r)}else this.primaryWrapper=void 0;this.events.next(new $e({name:"setSecondaryWrapper",value:this.secondaryWrapper}))}setActiveWrapper(t){let r;t instanceof Fe?r=t.id:r=t;let i=this.wrappers.get(this._activeWrapper||"");return r!==this._activeWrapper&&(this._activeWrapper=r,this.activeWrapper=this.wrappers.get(this._activeWrapper),i=this.activeWrapper||this.wrappers.get(this._defaultWrapper||""),this.events.next(new $e({name:"setActiveWrapper",value:i}))),i}addSymbol(t,r){this.symbols.set(t,r)}removeSymbol(t){this.symbols.delete(t)}}E(xt,"NAME","Symbols");function Ka(){const a=new qe;return a.addModule(ha),a.addModule($t),a.addModule(Ya),a.addModule(xt),a}const Ls=Ka();export{Ls as default};
