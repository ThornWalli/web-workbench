var ae=Object.defineProperty;var re=(a,r,n)=>r in a?ae(a,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[r]=n;var H=(a,r,n)=>re(a,typeof r!="symbol"?r+"":r,n);import{I as se,T as ue,b as ie,e as ce,C as fe}from"./DB5cYTSw.js";import{x as me,y as de,u as pe}from"./DcEGgYs5.js";import{A as ve}from"./5JAKi7LI.js";import{a as C}from"./DYHHCWM9.js";import{u as he}from"./CJrV-oJY.js";import{d as Ce,r as l,K as $,I as we,j as N,a0 as I,o as ye,ae as ge,a1 as D,W as Re,t as Se,v as Ie,x as _,z as _e,D as Ee,Y as Ae,_ as Oe}from"./DepUWdG1.js";import"./C5mdboMC.js";import"./Cpj98o6Y.js";import"./BGIFtisS.js";import"./RAasLaaH.js";import"./D4lI5vpz.js";import"./DdQrQ7-5.js";import"./6C4StZv5.js";import"./BDV1uWkE.js";import"./CSlkdJUE.js";import"./hgdfUW9W.js";import"./D5m4u8d2.js";import"./DIR0ob6O.js";import"./c7yvS0cq.js";import"./DtRunxS3.js";import"./DN3eHOnZ.js";import"./Ce6njBYG.js";import"./nufkX4jA.js";import"./WL2z-xAH.js";import"./C9SoOunh.js";class Te extends se{constructor(n={}){const{onAdd:i}={onAdd:null,...n};super(n);H(this,"onAdd");this.onAdd=i||(()=>{})}add(n,i){let f="",w=!1;typeof n=="string"&&me(n)?w=!0:(n instanceof ue&&(f=n.toColumnify().split(/\n/g)),typeof n=="string"&&de(n)&&(f=pe(n))),typeof n=="string"&&/^> \w+/.test(n)?this.onAdd(n,i):(w||f.length)&&this.onAdd(f,i)}}const xe={class:"wrapper"},be={class:"input"},Le=["innerHTML"],ke=Ce({__name:"Console",props:{rootElement:{type:HTMLElement,default(){return null}},showIntroduction:{type:Boolean,default(){return!1}},delimiterPrefix:{type:String,default:"1.SYS"},readonly:{type:Boolean,default:!1},startCommands:{type:[Array,String],default:null},preRows:{type:Array,default(){return[]}}},emits:["freeze","unfreeze","startCommandsComplete","refresh"],setup(a,{emit:r}){const{window:n,core:i,parentFocused:f,parentLayout:w}=he();let E=1;const A=l(null),y=l(null),V=l(null),O=l(null),m=a,g=r,P=$(new ie);P.add([new ce({name:["CLS","CLEAR"],action(){Z()}})]);const K=l($(new Te({core:i,consoleInterface:new fe,onAdd:B}))),p=l({value:"",focused:!1}),d=l([]),c=l(0),R=l(0),v=l([`[CLI ${E}]`]),s=l(-1),j=l(18),S=l({value:m.delimiterPrefix,prompt:!1,confirm:!1}),Y=l(null),U=l(null),T=l(null),x=l(!1),F=we({show:!0,logger:K,showCommand:!0,commandBucket:P}),q=N(()=>({"js--prompt":T.value,"js--focused":f.value})),G=N(()=>{let e=S.value.value;const{confirm:t,prompt:o}=S.value;return t?e="(y/n) ?":o?e="?":e&&(e=`${e}:&gt`),e&&(e=`${e}&nbsp;`),e}),J=N(()=>w.value.size);let W;I(()=>J.value,()=>{window.clearTimeout(W),W=window.setTimeout(()=>{h()},200)}),I(()=>Y.value,()=>{k({value:""})}),I(()=>U.value,()=>{k({value:m.delimiterPrefix,confirm:U.value})}),I(()=>T.value,()=>{k({value:m.delimiterPrefix,prompt:T.value})}),v.value.unshift(...m.preRows),ye(async()=>{const e=ge();if(e&&e.parent&&"console"in e.parent&&(e.parent.console=this),E++,m.showIntroduction){const t=X();t&&await t.then(()=>b('basic "TMP:CONSOLE_INSTRUCTIONS.basic"',{showCommand:!1}))}D(async()=>{if(m.startCommands){const t=Array().concat(m.startCommands),o=u=>b(u.shift()||"",{showCommand:!1}).then(()=>{if(u.length>0)return o(u)});await o(t),g("startCommandsComplete")}})}),Re(()=>{E--});function Q(e){p.value.value=e}async function b(e,t){s.value=-1,c.value=0,R.value=0,g("freeze");const o=await i.executeCommand(e,{...F,...t});o&&(typeof o=="number"||typeof o=="string")&&B(o),g("unfreeze"),h(),L(!0)}function X(){var t;const e=["#basic","CLS",'PRINT "Scroll (Up/Down): <strong>Shift+Up</strong> / <strong>Shift+Down</strong>"','PRINT "Enter <strong>commands</strong> to show all commands."'];return(t=i.modules.files)==null?void 0:t.fs.createTmpFile("CONSOLE_INSTRUCTIONS.basic","CONSOLE_INSTRUCTIONS.basic",{type:"basic",content:e})}function Z(){R.value=v.value.length,h()}function h(){if(A.value&&y.value){y.value.innerHTML="";const e=Math.floor(A.value.offsetHeight/j.value)-2;let t=0;for(;c.value+t<c.value+e;){const o=v.value[Math.max(v.value.length-e-c.value,0)+t];if(o!==void 0){const u=document.createElement("li");u.innerHTML=String(o).replace(/[\\]?\\n/,"<br>")+`
`,y.value.appendChild(u)}else break;t++}}}function L(e){D(()=>{e&&(x.value={scroll:!0},g("refresh",x.value),D(()=>{x.value=null}))})}function ee(e){let t=!1;e?R.value>0?(R.value=0,t=!0):c.value<v.value.length&&(c.value++,t=!0):c.value>0&&(c.value--,t=!0),t&&h()}function k(e,t=!1,o=!1){S.value={...S,value:e,prompt:t,confirm:o}}function B(e){const t=[];Array.isArray(e)?t.push(...e):t.push(String(e)),v.value.push(...t),h()}function te(){p.value.focused=!0}function ne(e){return d.value[d.value.length-1]!==e&&d.value.push(e),p.value.value="",b(e)}function oe(){p.value.focused=!1,L(),n.value.unfocus()}function le(e){var u,z;const t=e.code;let o=!1;if(((u=O.value)!=null&&u.controlCapsLockActive||(z=O.value)!=null&&z.controlShiftActive)&&(t===C.ARROW_UP||t===C.ARROW_DOWN))e.preventDefault(),ee(t===C.ARROW_UP);else{switch(t){case C.ARROW_UP:s.value++,s.value=Math.min(s.value,d.value.length-1),o=!0;break;case C.ARROW_DOWN:s.value--,s.value=Math.max(s.value,-1),o=!0;break}if(o&&d.value.length>0){let M;s.value<0?M="":M=d.value[d.value.length-1-s.value],p.value.value=M}L()}}return(e,t)=>(Ie(),Se("div",{ref_key:"rootEl",ref:A,class:Ae(["wb-env-console",q.value]),onClick:te},[_("div",xe,[_("ul",{ref_key:"consoleOutputEl",ref:y,class:"output typo-style"},null,512),_("div",be,[_("span",{ref_key:"consoleCommandDelimiterEl",ref:V,class:"prefix",innerHTML:G.value},null,8,Le),_e(ve,{ref_key:"inputEl",ref:O,"root-element":a.rootElement||e.$el,class:"element",multiline:!1,"override-focused":Ee(f),readonly:a.readonly,"model-value":p.value.value,onBlur:oe,"onUpdate:modelValue":Q,onEnter:ne,onKeydown:le},null,8,["root-element","override-focused","readonly","model-value"])])])],2))}}),at=Oe(ke,[["__scopeId","data-v-bd1e8a73"]]);export{at as default};
