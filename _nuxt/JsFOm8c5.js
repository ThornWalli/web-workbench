import{p as E}from"./ClLpnmyR.js";import{r as d,k as u,a0 as R,o as j,a1 as D,W as G,a7 as y,G as W}from"./BkRx7U8b.js";class F{id=crypto.randomUUID();items=[];constructor(t,e){t&&e&&(this.items=E(t(e)))}add(t){t instanceof F&&this.items.push(...t.items)}}function z(){const s=d(!1),t=y("core"),e=y("window");if(!t||!e)throw new Error("Core or Window not found");const w=y("window:refresh"),p=u(()=>e.id),f=u(()=>e.layout),r=u(()=>e.options.focused||!1),h=u(()=>e.parentWindow),i=d(),o=d(),v=u(()=>e.options.embed),a=d(!1),c=(n=!0)=>{a.value=n},M=(n,A={})=>{o.value=new F(n,{core:t,mainWindow:W(e),parentWindow:W(h),preserveContextMenu:c,...A})},l=n=>{o.value&&(n?i.value=t.modules.windows?.setActiveContextMenu(o.value):!a.value&&t.modules.windows?.getActiveContextMenu()===i.value&&!v.value&&t.modules.windows?.setActiveContextMenu(null))};R(r,n=>l(n)),R(o,n=>{i.value=t.modules.windows?.setActiveContextMenu(n)}),j(()=>{D(()=>{s.value=!0,l(!0)})}),G(()=>{o.value&&t.modules.windows?.isContextMenu(i.value)&&t.modules.windows?.setActiveContextMenu(null)});const x=u(()=>s.value),g=()=>{e.close()};let C;const b=n=>{e.options.title!==n&&(C=e.options.title,e.options.title=n)};let m=0;const k=n=>{m===1&&n===0?e.options.title=C:m===0&&n===1&&(C=e.options.title,e.options.title=`${e.options.title} (unsaved)`),m=n};return new N({isReady:x,id:p,parentFocused:r,parentLayout:f,core:t,window:e,setContextMenu:M,preserveContextMenu:c,contextMenu:o,currentContextMenu:i,refresh:w,close:g,setTitle:b,setTitleStatus:k})}var L=(s=>(s[s.NONE=0]="NONE",s[s.EDIT=1]="EDIT",s))(L||{});class N{isReady;id;parentFocused;parentLayout;core;window;setContextMenu;preserveContextMenu;contextMenu;currentContextMenu;refresh;close;setTitle;setTitleStatus;constructor(t){const{isReady:e,id:w,parentFocused:p,parentLayout:f,core:r,window:h,setContextMenu:i,preserveContextMenu:o,contextMenu:v,currentContextMenu:a,refresh:c,close:M,setTitle:l,setTitleStatus:x}=t;this.isReady=e,this.id=w,this.parentFocused=p,this.parentLayout=f,this.core=r,this.window=h,this.setContextMenu=i,this.preserveContextMenu=o,this.contextMenu=v,this.currentContextMenu=a,this.refresh=c,this.close=M,this.setTitle=l,this.setTitleStatus=x}}export{F as C,L as W,z as u};
