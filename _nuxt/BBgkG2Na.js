import{P as ie,D as le,a as fe}from"./CJzlme9J.js";import{C as I}from"./BJmh0rUk.js";import{i as e,p as ve}from"./OlYXjGCK.js";import{r as he,I as X,C as ye}from"./Dql81Gm-.js";import{d as j}from"./DeEbP9sG.js";import{d as we}from"./B3Wmi0DA.js";import{n as ge,d as be}from"./Ds4KxLLa.js";import{u as Ee,S as se}from"./ClLpnmyR.js";import{S as Se}from"./Wv4Ty0OG.js";import{f as Ie}from"./D53hIzv4.js";import{d as ue,k as i,r as b,L as Ce,a0 as R,o as ce,W as me,F as J,z as F,R as oe,P as _e,D as xe,A as N,a9 as Te,_ as pe,a7 as V,O as ze,a1 as ne,y as re,X as Me,Y as We,Z as Oe,$ as Pe}from"./BkRx7U8b.js";import{c as ae}from"./DFR6kSAz.js";import{g as Le,d as Re,A as K}from"./QwGUwJAP.js";import{C as Fe}from"./JsFOm8c5.js";import{C as O,a as Ne,W as Ae,b as Be,P as De}from"./7gmBHocL.js";const pt=2e3;function ke(){return console.log("Checking for debug query parameter"),new URL(window.location.href).searchParams.has("debug")}const Z=ke();function dt(){return{[I.SCREEN_1084_FRAME]:!Z,[I.SCREEN_REAL_LOOK]:!Z,[I.SCREEN_SCAN_LINES]:!Z,[I.SCREEN_ACTIVE_ANIMATION]:!0,[I.BOOT_WITH_SEQUENCE]:!0,[I.BOOT_WITH_WEBDOS]:!0,[I.THEME]:ie[le],[I.FILE_EXTENSION_ASSIGNMENT]:[["md","DF0:DocumentReader.app"],["bas","DF1:WebBasic.app"],["basic","DF1:WebBasic.app"]],[I.SCREEN_CONFIG]:{contrast:.5,brightness:.5,color:.5,sharpness:0,horizontalCentering:.5,soundVolume:.5}}}const ft="web_workbench_CONFIG";class He{config;commands;constructor({name:o,core:u,config:s={},commands:m,contextMenu:v}){this.name=o||"Module",this.core=u,this.config=s,this.commands=m,this.contextMenu=v}name;core;contextMenu;beforeSetup(){const o=this.core;o.config.setDefaults(this.config),typeof this.commands=="function"&&(this.commands=Le(this.commands({core:o,module:this})),ae.add(this.commands)),typeof this.contextMenu=="function"&&(this.contextMenu=new Fe(this.contextMenu,{core:o,module:this}),this.core.modules.windows?.contextMenu?.addDefaultItems(this.contextMenu))}setup(){this.log(this.name)}destroy(){Array.isArray(this.commands)&&ae.remove(this.commands)}log(o){this.core.logger.add(o,{namespace:this.name})}}const Ue=["innerHTML"],Ve=ue({__name:"Item",props:{parentLayout:{},clampGlobal:{type:Boolean},container:{type:Boolean},item:{},scrollOffset:{},wrapper:{}},emits:["click"],setup(c,{emit:o}){const u=e(0,0),s=c,m=i(()=>{const r=w?.symbols.get(p.value.symbol||se.DEFAULT)?.component||w?.symbols.get(se.DEFAULT)?.component;return r?Te(r):void 0}),{core:v}=Ee(),$=o,G=b(s.wrapper.selectedItems),x=b(!1),h=b(null),_=b(!1),n=Ce({start:e(0,0),move:e(0,0),lastPosition:e(0,0),offset:e(0,0),scrollOffset:e(0,0)}),l=new Se,T=b(null),z=b(null),q=v.value?.modules.screen,w=v.value?.modules.symbols,P=i(()=>s.item.command),S=i(()=>s.item.id),p=i(()=>s.item.model),g=i(()=>s.item.layout),A=i(()=>p.value.url?"a":"button"),B=i(()=>p.value.url?{href:p.value.url,target:p.value.url?"_blank":null,title:p.value.title}:{}),D=i(()=>q?.contentLayout||{position:e(0,0),size:e(0,0)}),L=i(()=>G.value.includes(S.value)),k=i(()=>({moving:_.value,selected:L.value||x.value,"symbol-used":p.value.used}));R(()=>p.value,()=>{U()},{deep:!0}),ce(()=>{z.value=T.value?.parentElement,U()}),me(()=>{l.unsubscribe(),s.wrapper.unselectItem(S.value)});function C(r){s.item?.setLayout(r)}let H;function U(){C({size:e(200,200)}),window.cancelAnimationFrame(H),H=window.requestAnimationFrame(()=>{const r=T.value?.children[0];r&&r instanceof HTMLElement&&C({size:e(r.offsetWidth||0,r.offsetHeight||0)})})}function Y(r){const{width:a,height:f,left:E,top:d}=r.getBoundingClientRect();return{position:e(E,d),size:e(a,f)}}let t=!1;function y(r){if(!t){const a=S.value;if(p.value.url&&L.value||(r.preventDefault(),p.value.used))return!0;if(P.value&&L.value){const f=he(P.value);if(f){const E={showCommand:!1,show:!0};return s.wrapper.unselectItem(a),p.value.used=!0,v.value?.executeCommand(f,E).then(()=>p.value.used=!1)}}j.shiftActive?s.wrapper.isSelectedItem(a)?s.wrapper.unselectItem(a):s.wrapper.selectItem(a):(w&&w.getSelectedItems().length>0&&w.clearSelectedItems(),s.wrapper.selectItem(a)),$("click")}t=!1}function M(r){if(r=ge(r),t=!1,y(r)){t=!0;return}t=!0,de(e(r.x,r.y))}function W(){if(w){const r=w.getSelectedItems().filter(f=>f.id!==S.value),a=s.wrapper.get(S.value);a&&r.length>0&&a.fsItem instanceof we&&r.forEach(f=>s.wrapper.moveItemToItem(f.fsItem,a.fsItem))}}const te=i(()=>s.scrollOffset||u);function de(r){if(z.value){const a=Y(z.value);n.lastPosition=e(g.value.position.x,g.value.position.y),n.scrollOffset=e(te.value.x,te.value.y),n.start=r,n.offset=e(()=>n.start-g.value.position),Q(r,a,!0),_.value=!0;let f=r;const E=j.pointerMove.subscribe(d=>{f=e(d.x,d.y),Q(e(d.x,d.y),a,!0)});l.add(j.pointerUp.pipe(Ie()).subscribe(()=>{if(E.unsubscribe(),w&&w.getSecondaryWrapper().id!==s.wrapper.id)return s.wrapper.moveItem(S.value,w.getSecondaryWrapper()).then(d=>(d||C({position:e(n.lastPosition?.x,n.lastPosition?.y)}),h.value=null,_.value=!1,d));if(_.value=!1,Q(f,a),!g.value.position.equals(e(()=>n.start-n.offset)))return s.wrapper.savePosition(S.value,g.value.position)}))}}function Q(r,a,f=!1){const E={min:e(0,0),max:e(()=>a.size-g.value.size)};n.move=e(()=>r-n.start);let d=e(()=>Math.round(n.start+n.move-n.offset));f?(E.min=a.position,E.max=e(()=>E.max+D.value.position),d=e(()=>Math.round(d+E.min)),s.clampGlobal?h.value=e(()=>Math.max(Math.min(d,D.value.position+s.wrapper.size-g.value.size),E.min)):h.value=d):(s.wrapper.root?C({position:e(()=>Math.max(Math.min(d,s.wrapper.size-g.value.size),0))}):C({position:e(()=>Math.max(d,0))}),h.value=null)}return(r,a)=>(F(),J(oe(A.value),_e(B.value,{ref_key:"rootEl",ref:T,"data-id":S.value,class:["wb-env-element-symbol-wrapper-item",k.value],style:[g.value.size.toCSSVars("item-size"),(h.value||g.value.position).toCSSVars("item-position")],"touch-action":"none",onFocus:a[0]||(a[0]=f=>x.value=!0),onBlur:a[1]||(a[1]=f=>x.value=!1),onClick:y,onPointerdown:M,onPointerup:W}),{default:xe(()=>[N("div",null,[N("i",null,[(F(),J(oe(m.value)))]),N("span",{class:"label",innerHTML:p.value.title},null,8,Ue)])]),_:1},16,["data-id","class","style"]))}}),$e=pe(Ve,[["__scopeId","data-v-0eaeb899"]]),Ge=ue({__name:"SymbolWrapper",props:{clampSymbols:{type:Boolean},wrapperId:{}},emits:["ready","refresh"],setup(c,{emit:o}){const u=b(null),s=b(null),m=b(null),v=c,$=V("window",void 0),G=i(()=>l.value),x=i(()=>!!$),h=V("parentLayout",i(()=>({position:e(0,0),size:e(window?.innerWidth,window?.innerHeight)}))),_=V("parentFocused",!1),n=V("core");if(!n)throw new Error("Core not found");const l=b(n?.modules.symbols?.get(v.wrapperId))||b(new X(n)),T=o,z=i(()=>"value"in l.value.items?l.value.items.value:l.value.items),q=b(l.value.selectedItems),w=ze(n.config.observable),P=i(()=>l.value.layout),S=i(()=>({"parent-scrollable":x.value,active:(n.modules.symbols?.primaryWrapper||{}).id===l.value.id})),p=i(()=>h?.value&&"scrollOffset"in h.value?h?.value.scrollOffset:e(0,0)),g=i(()=>{const t=[p.value?.toCSSVars("symbol-wrapper-scroll-offset")];return x.value?t.push(A.value.toCSSVars("symbol-wrapper-size")):t.push(P.value.size.toCSSVars("symbol-wrapper-size")),t}),A=i(()=>z.value.map(t=>({item:t,index:q.value.indexOf(t.id)+1})).sort((t,y)=>t.index>y.index?1:t.index<y.index?-1:0).reduce((t,{item:y})=>{const M=y.layout.position.x+y.layout.size.x,W=y.layout.position.y+y.layout.size.y;return t.x=t.x<M?M:t.x,t.y=t.y<W?W:t.y,t},ve(0,0))),B=i(()=>w[ye.SHOW_INVISIBLE_SYMBOLS]),D=i(()=>z.value.filter(H)),L=i(()=>h?.value?.size||e(0,0));R(()=>_,t=>{k(t)}),R(()=>v.wrapperId,t=>{n.modules.symbols?.get(t),C()}),R(()=>L,()=>{C()}),R(()=>A,()=>{ne(()=>{T("refresh",{scroll:!0})})}),ce(()=>{ne(()=>{C(),k(_),T("ready")})}),me(()=>{n.modules.symbols?.getPrimaryWrapper()&&n.modules.symbols?.getPrimaryWrapper().id===l.value.id&&n.modules.symbols?.setPrimaryWrapper(null),n.modules.symbols?.getSecondaryWrapper()&&n.modules.symbols?.getSecondaryWrapper().id===l.value.id&&n.modules.symbols?.setSecondaryWrapper(null)});function k(t=!1){n&&n.modules.symbols&&(t?l.value instanceof X&&n.modules.symbols.setPrimaryWrapper(l.value):n.modules.symbols.getPrimaryWrapper()&&n.modules.symbols.getPrimaryWrapper().id===l.value.id&&n.modules.symbols.setPrimaryWrapper(null))}function C(){if(u.value&&h?.value){const{left:t,top:y}=u.value.getBoundingClientRect();l.value.setLayout({position:e(t,y),size:h.value.size}),l.value.setSize(e(u.value.offsetWidth,u.value.offsetHeight)),l.value.setParentSize(h.value.size)}}function H(t){return B.value||!B.value&&t.model.visible}function U(){l.value instanceof X&&n?.modules.symbols?.setSecondaryWrapper(l.value)}function Y(t){(t.target===s.value||t.target===m.value)&&l.value.clearSelectedItems()}return(t,y)=>(F(),re("div",{ref_key:"rootEl",ref:u,class:Pe(["wb-env-symbol-wrapper",S.value]),style:Oe(g.value),onPointerdown:Y,onPointermove:U},[N("div",{ref_key:"helperEl",ref:s,class:"helper"},null,512),N("div",{ref_key:"itemsEl",ref:m,class:"items"},[(F(!0),re(Me,null,We(D.value,(M,W)=>(F(),J($e,{key:W,item:M,"clamp-global":t.clampSymbols,wrapper:G.value,"parent-layout":P.value,"scroll-offset":p.value},null,8,["item","clamp-global","wrapper","parent-layout","scroll-offset"]))),128))],512)],38))}}),vt=pe(Ge,[["__scopeId","data-v-f5ed7cd4"]]);function qe(c){c=c||document.body,c.requestFullscreen()}function Ye(){document.exitFullscreen()}function Qe(c,o=void 0){c=c||document.body,o||o===void 0&&!ee()?qe(c):Ye()}function ee(){return!!document.fullscreenElement}const Xe=Re(({core:c})=>[{name:["fullscreen"],description:"Toggle Fullscreen",args:[new K({name:"set",description:"Set Fullscreen"}),new K({name:"toggle",description:"Toggle Fullscreen",flag:!0}),new K({name:"is",description:"check fullscreen",flag:!0})],async action({is:o,fullscreen:u,toggle:s}){if(o)return ee();if(u||s){let m="Enter Fullscreen?";ee()&&(m="Leave Fullscreen?"),await c.executeCommand(`openDialog "${m}" -confirm`)&&Qe(document.body)}}}]);class je{cursors;current;constructor(){this.cursors={wait:this.getCursor(O.WAIT),default:this.getCursor(O.POINTER_1)},this.current=this.cursors.default}setWait(o){o?this.current=this.cursors.wait:this.current=this.cursors.default}getCursor(o){return new{[O.POINTER_1]:De,[O.POINTER_MOONCITY]:Be,[O.WAIT]:Ae,[O.CROSSHAIR]:Ne}[o]}setCurrent(o){this.current?.name!==o&&(o?this.current=this.getCursor(o):this.current=this.cursors.default)}}class ht extends He{static NAME="Screen";defaultTheme;currentTheme;cursor=new je;contentEl;sizes={content:e(0,0)};positions={content:e(0,0)};screenLayout={size:e(0,0),position:e(0,0)};contentLayout={size:e(0,0),position:e(0,0)};constructor(o){const{core:u,contentEl:s}={contentEl:void 0,...o};if(super({name:"Screen",commands:Xe,core:u}),this.contentEl=s,this.defaultTheme=this.currentTheme=this.getDefaultTheme(),window===void 0)throw new Error("ScreenControl is only for Browser");be.then(this.onReady.bind(this)).catch(m=>{throw m}),u.executionCounter>0&&this.cursor.setWait(!0)}destroy(){window.removeEventListener("resize",this.onResize.bind(this),!1)}updateContentLayout(o){const{x:u,y:s,width:m,height:v}=o.getBoundingClientRect();this.contentLayout={size:e(m,v),position:e(u,s)}}updateScreenLayout(o){const{x:u,y:s,width:m,height:v}=o.getBoundingClientRect();this.screenLayout={size:e(m,v),position:e(u,s)}}getDefaultTheme(){const o=this.core.config.get(I.THEME)||ie[le];return new fe("current",o)}setTheme(o){return this.currentTheme=o||this.getDefaultTheme()}onReady(){window.addEventListener("resize",this.onResize.bind(this),!1),this.onResize()}onResize(){if(this.contentEl){const{x:o,y:u,width:s,height:m}=this.contentEl.getBoundingClientRect();this.positions.content=e(o,u),this.sizes.content=e(s,m)}}}window.oncontextmenu=c=>{c.preventDefault()};export{pt as B,je as C,He as M,ht as S,vt as W,ft as a,dt as g};
