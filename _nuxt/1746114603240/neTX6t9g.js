const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B87cNmrk.js","./BRP7lMhW.js","./CNkvSXuu.js","./BY0KaPQX.js","./C5mdboMC.js","./BJmh0rUk.js","./BV7m95iv.js","./C3zvzGZe.css","./BDAkpjrJ.js","./pCkh-wP3.css","./CB-RsRv4.js","./B_usvsmx.css","./Ba9r8HTT.js","./D_5tq7_O.css","./DK5mOmiz.js","./iKMg5t-_.css","./LDaXBbxb.js","./8q2Z1dNm.css","./YcwuoW3W.js","./CnnF2WpI.js","./BL9b5cpI.js","./L24w7Tb1.js","./DMqoVgoU.js","./CXbNF4JJ.css","./CL53rMPt.css","./DZ0O8WRZ.js","./DrMhIDnQ.js","./DwCo2nxe.js","./iZ1DQg6G.css","./DXmgvhA9.js","./QFyeECXp.css","./Bo2D8T6P.css"])))=>i.map(i=>d[i]);
var L=Object.defineProperty;var T=n=>{throw TypeError(n)};var k=(n,e,t)=>e in n?L(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var m=(n,e,t)=>k(n,typeof e!="symbol"?e+"":e,t),P=(n,e,t)=>e.has(n)||T("Cannot "+t);var b=(n,e,t)=>(P(n,e,"read from private field"),t?t.call(n):e.get(n)),S=(n,e,t)=>e.has(n)?T("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),R=(n,e,t,s)=>(P(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t);import{c as Y}from"./C5mdboMC.js";import{b as B,d as V,A as p,T as A,c as g,e as I,L as N,g as F,p as G}from"./C6HPuhbs.js";import{q as X,T as $,u as O,e as U,j as W,a as q}from"./CDSNOiTq.js";import{g as _,C as z}from"./CSceaZGY.js";import{I as H,H as M,m as Q,K as E}from"./BRP7lMhW.js";import{C as J}from"./BJmh0rUk.js";import{I as f}from"./BL9b5cpI.js";import{S as j}from"./RAasLaaH.js";import{R as K}from"./BH9FFkim.js";class Z{constructor(e,t){m(this,"entries",new Map(Object.entries(_())));m(this,"observable",H(_()));m(this,"storage");m(this,"ready");const s=X(t||$.NONE);this.storage=new s({name:e}),this.ready=this.storage.load().then(a=>(this.entries=new Map([...this.entries,...a]),Object.assign(this.observable,Object.fromEntries(this.entries)),this)).catch(a=>{throw a})}setDefaults(e){return Promise.all(Object.keys(e).map(t=>{this.has(t)||this.set(t,e[String(t)])}))}get(e){return this.entries.get(e)}has(e){return this.entries.has(e)}set(e,t){return typeof e=="string"?(this.entries.set(e,t),this.observable[String(e)]=t):e&&typeof e=="object"&&!(e instanceof Map)&&Object.keys(e).forEach(s=>{t=e[s],this.entries.set(s,t),this.observable[s]=t}),this.storage.save(Array.from(this.entries))}}class ee extends B{constructor(t){super();m(this,"core");this.core=t}prompt(t){const s=["openDialog","--prompt"];return t&&s.push(`--message="${O(t)}"`),this.core.executeCommand(s.join(" "))}confirm(t){const s=["openDialog","--confirm"];return t&&s.push(`--message="${O(t)}"`),this.core.executeCommand(s.join(" "))}}var w,C;class te{constructor(e){S(this,w);S(this,C,[]);R(this,w,e)}command(e,t){b(this,C).push({value:e,targetValue:t})}run(){return Promise.all(b(this,C).map(({value:e,targetValue:t})=>b(this,w).executeCommand(e).then(s=>{const a=s===t;return a||console.warn(`[ ${e} ]; ${s} === ${t}`),{value:e,targetValue:t,result:s,success:a}})))}async start(){const e=await this.run();return[[e.length,"Tests processed"],[e.filter(t=>t.success).length,"Tests success"],[e.filter(t=>!t.success).length,"Tests failed"]]}}w=new WeakMap,C=new WeakMap;const se=V(({core:n})=>[{name:["execute"],description:"Execute file.",args:[new p({index:0,name:"path",description:"Path to the file"})],async action({path:e}){var r,i;let t=e;const s=new Map(n.config.get(J.FILE_EXTENSION_ASSIGNMENT));if(!t)throw U.get("bad_args");let a;if(s.has(W(t))?a=await((r=n.modules.files)==null?void 0:r.fs.get(s.get(W(t)))):(a=await((i=n.modules.files)==null?void 0:i.fs.get(t)),t=void 0),typeof(a==null?void 0:a.action)=="function")return a.action(n,t);if(a!=null&&a.data&&typeof(a==null?void 0:a.data)=="object"&&"type"in a.data){const c=a.data,d=[`openPreview "${a.getPath()}"`];return c.openMaximized&&d.push("-maximized"),n.executeCommand(d.join(" "))}}},{name:["openColorSettings"],async action(){var t;const e=await M(()=>import("./B87cNmrk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url).then(s=>s.default);(t=n.modules.windows)==null||t.addWindow({component:e,componentData:{},options:{title:"Color Settings",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}},{name:["openSettings"],async action(){var t;const e=await M(()=>import("./DZ0O8WRZ.js"),__vite__mapDeps([25,5,6,1,7,14,15,16,17,26,8,9,27,28,29,30,20,21,22,23,31]),import.meta.url).then(s=>s.default);(t=n.modules.windows)==null||t.addWindow({component:e,componentData:{},options:{title:"Settings",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}},{name:["echo","print"],args:[new p({name:["newline","n"],flag:!0})],async action({newline:e},t){const s=a=>O(a).replace(/\\"/g,'"').replace(/\\n/g,`
`);if(e)t.message(t.commandArgs.map(a=>s(a)));else{let a=await t.core.executeCommand(t.commandValue);typeof a=="object"&&(a=JSON.stringify(a)),t.message(`${O(s(a))}`)}}},{name:"commands",action(e,t){const s=new A({headerPadding:1});return s.addColumns([{value:"Command(s)",align:"left",maxWidth:20},{value:"Description/Arguments",align:"left",maxWidth:60}]),s.addRows(g.items.reduce((a,r)=>{const i=r.args||[],c=[];r.description&&(c.push(r.description),c.push("")),i.length&&(c.push("Arguments:"),c.push(""));const{flagNames:d,kwargNames:h}=i.reduce((l,y)=>{const x=y.name.join(", ");return y.flag?l.flagNames.push({name:`-${x}`,description:y.description}):l.kwargNames.push({name:`--${x}`,description:y.description}),l},{flagNames:[],kwargNames:[]}),o={paddingChr:"Ã‚",showHeaders:!1,config:{name:{minWidth:15},description:{minWidth:10,maxWidth:30}}};return c.push(I(d,Object.assign({},o))),d.length>0&&h.length>0&&c.push(""),c.push(I(h,Object.assign({},o))),a.push([r.name.join(", "),c.join(`
`)]),a},[])),t.message(["Commands:",s]),Promise.resolve()}},{name:["CLS","CLEAR"],async action(){n.consoleInterface.clear()}},{name:["prompt","input","PROMPT","INPUT"],args:[new p({index:0,name:"text",description:"Text from prompt."}),new p({index:1,name:"variable",description:"Variable"})],action:({text:e,variable:t,unresolved:s})=>(s.text&&!s.variable?(t=s.text,e=void 0):t=s.variable,n.consoleInterface.prompt(e).then(a=>{var r;return q(a)&&(a=Number(a)),t&&((r=n.modules.parser)==null||r.memory.set(t,a)),a}))},{name:["confirm","CONFIRM"],args:[new p({index:0,name:"text",description:"Text from confirm."})],action({text:e}){return n.consoleInterface.confirm(e)}},{name:["selfCheck"],async action(e,t){const s=new A;s.addColumns([{value:"Count",align:"left",minWidth:8},{value:"Description",align:"left",minWidth:15}]),s.addRows(await ae(n)),t.message(['"Command Tests:"',s,'"For failures, look in the web console of the browser."'])}}]);function ae(n){const e=new te(n);return e.command('"foo" +"bar"','"foobar"'),e.command("(-3+-6)+1",-8),e.command("(-3-+6)+1",-8),e.command("(-3*-6)+1",-3*-6+1),e.command("(-3/-6)+1",-3/-6+1),e.command("(-3+6)+1",4),e.command("(-3-6)+1",-8),e.command("(-3*6) + 1",-3*6+1),e.command("(-3/6)+1",-3/6+1),e.command("INT(PI)",3),e.command("(POW(2,2)+1)",5),e.command('ASC("D")',68),e.command("CHR$(68)",'"D"'),e.command('LEN("ABC")',3),e.command('"a" + "b"','"ab"'),e.command("STRING$(3,0)",'"000"'),e.command("SQRT(2,2)",Math.sqrt(2)),e.command("128 >> (256 + 5)",4),e.command("-2+4+SQRT(2,2)",2+Math.sqrt(2)),e.command("-2- 2 * 2",-2-2*2),e.command("(1+1)",2),e.command("2*2",2*2),e.command("1+2+3+(POW(2,2)+1)+5*8-(50/2)",6+(2**2+1)+5*8-50/2),e.start()}const{version:ne}=Q().public,u=class u{constructor(){m(this,"setupComplete",!1);m(this,"events",E(new j));m(this,"errorObserver",E(new j));m(this,"ready",E(new K(0)));m(this,"modules",{});m(this,"consoleInterface",new ee(this));m(this,"logger",new N({core:this,debug:!1,consoleInterface:this.consoleInterface}));m(this,"executionCounter",0);m(this,"config",new Z(z,$.SESSION));this.log(`${u.NAME}; ${u.VERSION}`)}get version(){return u.VERSION}addExecution(){return this.executionCounter++,()=>{this.executionCounter--}}async setup({rootItems:e,disks:t}={}){var a;if(this.setupComplete)return console.warn("Setup is complete!"),this;this.setupComplete=!0,g.add(F(se({core:this}))),await this.config.ready;const s=Object.values(this.modules);return await Promise.all(s.map(r=>Promise.resolve(r==null?void 0:r.beforeSetup()))),await Promise.all(s.map(r=>Promise.resolve(r==null?void 0:r.setup()))),t&&((a=this.modules.files)==null||a.addDisks(t)),e!=null&&e.length&&await this.addRootItems(await e({core:this})),this.ready.next(this),this}destroy(){g.clear()}addModule(e,t){const s=new e({core:this,...t});this.modules[Y(s.name)]=s}async removeModule(e){await e.destroy(),Reflect.deleteProperty(this.modules,e.name)}executeCommands(e){const t=e.shift();if(t)return this.executeCommand(t).then(()=>this.executeCommands(e))}async executeCommand(e,t){var c,d,h;typeof e=="string"&&(e=e.replace(/(.*[^\\])\n(\S*)/gm,"$1\\n$2"));const s=(t==null?void 0:t.show)||!1,a=[];(Array.isArray(t==null?void 0:t.message)||typeof(t==null?void 0:t.message)=="string")&&a.push(...a.concat(t==null?void 0:t.message));const r={commandBucket:g,core:this,logger:this.logger,show:s,...t,message:o=>{if(s){let l=o;typeof o=="string"&&(o=o.replace(/\\n/g,`
`),l=`"${o}"`),a.push(...[].concat(l))}}};let i;try{if(e){const o=await((c=this.modules.parser)==null?void 0:c.parseCommand(e));o&&((d=r.commandBucket)!=null&&d.has(o.command)?i=await v(e,o,r.commandBucket,r):g.has(o.command)?i=await v(e,o,g,r):(h=this.modules.parser)!=null&&h.isMathValue(e)?i=await this.modules.parser.parseMath(e):/^\w+$/.test(e)&&console.warn(`can\\'t use variable or method "${e}"`))}}catch(o){let l=o;Array.isArray(o)&&(l=new Error(o[o.length-1])),this.errorObserver.next(l)}return i!==void 0&&i!=="undefined"&&typeof i=="string"&&r.show&&a.length<1&&a.push(i),a.forEach(o=>{var l;return(l=r.logger)==null?void 0:l.add(o,{type:N.TYPE.OUTPUT})}),i}addRootItems(e){var s;const t=(s=this.modules.files)==null?void 0:s.fileSystem;return Promise.all(e.map(async({id:a,name:r,data:i,meta:c,items:d})=>{if(d&&d.length){const h=await(t==null?void 0:t.createRootDir("Press","Press",{meta:[[f.WINDOW_SIDEBAR,!1],[f.WINDOW_SCALE,!1],[f.WINDOW_SCROLL_X,!1],[f.WINDOW_SCROLL_Y,!1],[f.POSITION,{x:80,y:320}],[f.WINDOW_SIZE,{x:120,y:120}],[f.IGNORE_SYMBOL_REARRANGE,!0]]}));return h==null||h.addItems(d),h}else return t==null?void 0:t.createRootFile(a,r,i,{meta:c||[]})})).catch(a=>{throw new Error(a)})}log(e){this.logger.add(e,{namespace:"Core"})}};m(u,"VERSION",ne||"0.0.0"),m(u,"NAME","web-workbench");let D=u;async function v(n,e,t,s){var r;const a=t.get(e.command);if(a){const i=s.show,c=G(a,e),d=await a.action(c,Object.assign({command:e.command,commandValue:e.commandValue,commandArgs:e.args},s));return i&&s.showCommand&&((r=s.logger)==null||r.add("> "+n,{type:N.TYPE.OUTPUT})),d}}export{D as C};
