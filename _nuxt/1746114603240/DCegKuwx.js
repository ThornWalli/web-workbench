var ue=Object.defineProperty;var ce=(y,a,t)=>a in y?ue(y,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):y[a]=t;var L=(y,a,t)=>ce(y,typeof a!="symbol"?a+"":a,t);import{g as me,c as Z}from"./C6HPuhbs.js";import{C as pe}from"./CnnF2WpI.js";import{i as o,p as de}from"./BGIFtisS.js";import{S as fe,d as ve,I as R,C as ye}from"./DchX226r.js";import{d as G}from"./YY0LfIuj.js";import{n as he}from"./DYHHCWM9.js";import{t as A,v as x,x as M,d as ee,r as w,I as be,j as u,a0 as V,o as te,W as oe,X as se,Y as re,C as U,N as J,O as ge,aa as we,A as Se,F as Ie,D as ae,_ as le,K as xe,a1 as Q,Z as _e,$ as ze}from"./BRP7lMhW.js";import{u as Me}from"./BL9b5cpI.js";import{S as Pe}from"./6C4StZv5.js";import{f as We}from"./DIR0ob6O.js";class qe{constructor({name:a,core:t,config:h={},commands:P,contextMenu:s}){L(this,"config");L(this,"commands");L(this,"name");L(this,"core");L(this,"contextMenu");this.name=a||"Module",this.core=t,this.config=h,this.commands=P,this.contextMenu=s}beforeSetup(){var t,h;const a=this.core;a.config.setDefaults(this.config),typeof this.commands=="function"&&(this.commands=me(this.commands({core:a,module:this})),Z.add(this.commands)),typeof this.contextMenu=="function"&&(this.contextMenu=new pe(this.contextMenu,{core:a,module:this}),(h=(t=this.core.modules.windows)==null?void 0:t.contextMenu)==null||h.addDefaultItems(this.contextMenu))}setup(){this.log(this.name)}destroy(){Array.isArray(this.commands)&&Z.remove(this.commands)}log(a){this.core.logger.add(a,{namespace:this.name})}}const Ce={xmlns:"http://www.w3.org/2000/svg",width:"31",height:"30",class:"wb_symbol_disk_1"};function ne(y,a){return x(),A("svg",Ce,a[0]||(a[0]=[M("path",{d:"M0 0h25v2h2v2h2v2h2v24H0z",class:"svg-secondary"},null,-1),M("path",{fill:"#FFF",d:"M2 2v26h27V6h-2V4h-2V2",class:"svg-primary"},null,-1),M("path",{fill:"#FA5",d:"M7 2h13v10H7z",class:"svg-tertiary"},null,-1),M("path",{d:"M11 2h5v8h-5z",class:"svg-secondary"},null,-1)]))}const ie={render:ne},Ye=Object.freeze(Object.defineProperty({__proto__:null,default:ie,render:ne},Symbol.toStringTag,{value:"Module"})),ke=["data-id"],Le={key:0},Ee=["innerHTML"],Oe=ee({__name:"Item",props:{parentLayout:{type:Object,default(){return null}},clampGlobal:{type:Boolean,default:!1},container:{type:Boolean,default(){return!1}},item:{type:fe,default(){return{id:null,command:null,model:{title:"Item Title",url:null,symbol:ie,used:!1,visible:!0},layout:{position:o(0,0),size:o(50,50)}}}},scrollOffset:{type:Object,default(){return o(0,0)}},wrapper:{type:Object,default:null}},emits:["click"],setup(y,{emit:a}){var q,Y;const t=y,{core:h}=Me(),P=a,s=w(t.wrapper.selectedItems),l=w(null),_=w(!1),c=be({start:o(0,0),move:o(0,0),lastPosition:o(0,0),offset:o(0,0),scrollOffset:o(0,0)}),D=new Pe,E=w(null),W=w(null),O=(q=h.value)==null?void 0:q.modules.screen,f=(Y=h.value)==null?void 0:Y.modules.symbols,H=u(()=>t.item.command),b=u(()=>t.item.id),m=u(()=>t.item.model),v=u(()=>t.item.layout),j=u(()=>m.value.url?"a":"span"),T=u(()=>m.value.url?{href:m.value.url,target:m.value.url?"_blank":null,title:m.value.title}:{}),C=u(()=>(O==null?void 0:O.contentLayout)||{position:o(0,0),size:o(0,0)}),B=u(()=>s.value.includes(b.value)),N=u(()=>({moving:_.value,selected:B.value,"symbol-used":m.value.used}));V(()=>m.value,()=>{e()},{deep:!0}),te(()=>{var r;W.value=(r=E.value)==null?void 0:r.parentElement,e()}),oe(()=>{D.unsubscribe(),t.wrapper.unselectItem(b)});function z(r){t.item.setLayout(r)}let F;function e(){z({size:o(200,200)}),window.cancelAnimationFrame(F),F=window.requestAnimationFrame(()=>{var i;const r=(i=E.value)==null?void 0:i.children[0];r&&r instanceof HTMLElement&&z({size:o(r.offsetWidth||0,r.offsetHeight||0)})})}function n(r){const{width:i,height:p,left:g,top:d}=r.getBoundingClientRect();return{position:o(g,d),size:o(i,p)}}function S(r){var p;r=he(r);const i=b.value;if(!(m.value.url&&B.value)&&(r.preventDefault(),!m.value.used)){if(H.value&&B.value){const g={showCommand:!1,show:!0};return t.wrapper.unselectItem(i),m.value.used=!0,(p=h.value)==null?void 0:p.executeCommand(H.value,g).then(()=>m.value.used=!1)}G.shiftActive?t.wrapper.isSelectedItem(i)?t.wrapper.unselectItem(i):t.wrapper.selectItem(i):(f&&f.getSelectedItems().length>0&&f.clearSelectedItems(),t.wrapper.selectItem(i)),$(o(r.x,r.y)),P("click")}}function I(){if(f){const r=f.getSelectedItems().filter(p=>p.id!==b.value),i=t.wrapper.get(b.value);r.length>0&&i.fsItem instanceof ve&&r.forEach(p=>t.wrapper.moveItemToItem(p.fsItem,i.fsItem))}}function $(r){if(W.value){const i=n(W.value);c.lastPosition=o(v.value.position.x,v.value.position.y),c.scrollOffset=o(t.scrollOffset.x,t.scrollOffset.y),c.start=r,c.offset=o(()=>c.start-v.value.position),k(r,i,!0),_.value=!0;let p=r;const g=G.pointerMove.subscribe(d=>{p=o(d.x,d.y),k(o(d.x,d.y),i,!0)});D.add(G.pointerUp.pipe(We()).subscribe(()=>{if(g.unsubscribe(),f&&f.getSecondaryWrapper().id!==t.wrapper.id)return t.wrapper.moveItem(b.value,f.getSecondaryWrapper()).then(d=>{var K,X;return d||z({position:o((K=c.lastPosition)==null?void 0:K.x,(X=c.lastPosition)==null?void 0:X.y)}),l.value=null,_.value=!1,d});if(_.value=!1,k(p,i),!v.value.position.equals(o(()=>c.start-c.offset)))return t.wrapper.savePosition(b.value,v.value.position)}))}}function k(r,i,p=!1){const g={min:o(0,0),max:o(()=>i.size-v.value.size)};c.move=o(()=>r-c.start);let d=o(()=>Math.round(c.start+c.move-c.offset));p?(g.min=i.position,g.max=o(()=>g.max+C.value.position),d=o(()=>Math.round(d+g.min)),t.clampGlobal?l.value=o(()=>Math.max(Math.min(d,C.value.position+t.wrapper.size-v.value.size),g.min)):l.value=d):(t.wrapper.root?z({position:o(()=>Math.max(Math.min(d,t.wrapper.size-v.value.size),0))}):z({position:o(()=>Math.max(d,0))}),l.value=null)}return(r,i)=>(x(),A("figure",{ref_key:"rootEl",ref:E,"data-id":b.value,class:re(["wb-env-atom-symbol-wrapper-item",N.value]),style:se([v.value.size.toCSSVars("item-size"),(l.value||v.value.position).toCSSVars("item-position")]),"touch-action":"none",onPointerdown:S,onPointerup:I},[(x(),U(J(j.value),ge(we(T.value)),{default:Se(()=>{var p;return[m.value.symbol?(x(),A("i",Le,[(x(),U(J((p=ae(f))==null?void 0:p.symbols.get(m.value.symbol))))])):Ie("",!0),M("figcaption",{innerHTML:m.value.title},null,8,Ee)]}),_:1},16))],46,ke))}}),Be=le(Oe,[["__scopeId","data-v-92c10949"]]),Fe=ee({__name:"SymbolWrapper",props:{core:{},parentLayout:{},parentScrollable:{type:Boolean},parentFocused:{type:Boolean},clampSymbols:{type:Boolean},wrapperId:{}},emits:["ready","refresh"],setup(y,{emit:a}){var F;const t=w(null),h=w(null),P=w(null),s=y,l=w((F=s.core.modules.symbols)==null?void 0:F.get(s.wrapperId))||w(new R(s.core)),_=a,c=u(()=>l.value.items.value),D=w(l.value.selectedItems),E=xe(s.core.config.observable),W=u(()=>l.value.layout),O=u(()=>{var e;return{"parent-scrollable":s.parentScrollable,active:(((e=s.core.modules.symbols)==null?void 0:e.primaryWrapper)||{}).id===l.value.id}}),f=u(()=>s.parentLayout&&"scrollOffset"in s.parentLayout?s.parentLayout.scrollOffset:o(0,0)),H=u(()=>{var n;const e=[(n=f.value)==null?void 0:n.toCSSVars("symbol-wrapper-scroll-offset")];return s.parentScrollable?e.push(b.value.toCSSVars("symbol-wrapper-size")):e.push(W.value.size.toCSSVars("symbol-wrapper-size")),e}),b=u(()=>c.value.map(e=>({item:e,index:D.value.indexOf(e.id)+1})).sort((e,n)=>e.index>n.index?1:e.index<n.index?-1:0).reduce((e,{item:n})=>{const S=n.layout.position.x+n.layout.size.x,I=n.layout.position.y+n.layout.size.y;return e.x=e.x<S?S:e.x,e.y=e.y<I?I:e.y,e},de(0,0))),m=u(()=>E[ye.SHOW_INVISIBLE_SYMBOLS]),v=u(()=>c.value.filter(B)),j=u(()=>(s.parentLayout||{}).size);V(()=>s.parentFocused,e=>{T(e)}),V(()=>s.wrapperId,e=>{var n;(n=s.core.modules.symbols)==null||n.get(e),C()}),V(()=>j,()=>{C()}),V(()=>b,()=>{Q(()=>{_("refresh",{scroll:!0})})}),te(()=>{Q(()=>{C(),T(s.parentFocused),_("ready")})}),oe(()=>{var e,n,S,I,$,k;(e=s.core.modules.symbols)!=null&&e.getPrimaryWrapper()&&((n=s.core.modules.symbols)==null?void 0:n.getPrimaryWrapper().id)===l.value.id&&((S=s.core.modules.symbols)==null||S.setPrimaryWrapper(null)),(I=s.core.modules.symbols)!=null&&I.getSecondaryWrapper()&&(($=s.core.modules.symbols)==null?void 0:$.getSecondaryWrapper().id)===l.value.id&&((k=s.core.modules.symbols)==null||k.setSecondaryWrapper(null))});function T(e=!1){s.core.modules.symbols&&(e?l.value instanceof R&&s.core.modules.symbols.setPrimaryWrapper(l.value):s.core.modules.symbols.getPrimaryWrapper()&&s.core.modules.symbols.getPrimaryWrapper().id===l.value.id&&s.core.modules.symbols.setPrimaryWrapper(null))}function C(){if(t.value){const{left:e,top:n}=t.value.getBoundingClientRect();l.value.setLayout({position:o(e,n),size:s.parentLayout.size}),l.value.setSize(o(t.value.offsetWidth,t.value.offsetHeight)),l.value.setParentSize(s.parentLayout.size)}}function B(e){return m.value||!m.value&&e.model.visible}function N(){var e;l.value instanceof R&&((e=s.core.modules.symbols)==null||e.setSecondaryWrapper(l.value))}function z(e){(e.target===h.value||e.target===P.value)&&l.value.clearSelectedItems()}return(e,n)=>(x(),A("div",{ref_key:"rootEl",ref:t,class:re(["wb-env-symbol-wrapper",O.value]),style:se(H.value),onPointerdown:z,onPointermove:N},[M("div",{ref_key:"helperEl",ref:h,class:"helper"},null,512),M("div",{ref_key:"itemsEl",ref:P,class:"items"},[(x(!0),A(_e,null,ze(v.value,(S,I)=>(x(),U(Be,{key:I,item:S,"clamp-global":e.clampSymbols,wrapper:ae(l),"parent-layout":W.value,"scroll-offset":f.value},null,8,["item","clamp-global","wrapper","parent-layout","scroll-offset"]))),128))],512)],38))}}),Ke=le(Fe,[["__scopeId","data-v-84014d10"]]);export{qe as M,Ke as W,Ye as d};
