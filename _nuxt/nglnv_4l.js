const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DFhd1ocT.js","./BUU1NkbK.js","./CNkvSXuu.js","./CHpeLE9u.js","./9V19AFUE.js","./BJmh0rUk.js","./B1olVgM4.js","./CHLd88nu.css","./CZFypg2d.js","./DEAznjDA.css","./DBJy15Pp.js","./gFpO8BtF.css","./B4Wca970.js","./CuhyRvkQ.css","./Uu07fvcW.js","./CiACgkXc.css","./C0s6aVd8.js","./Bn0T8SwD.css","./Xupdrwif.js","./DcvgOCRL.js","./7MFW2ODw.js","./CXbNF4JJ.css","./D2G2gdJv.css","./Cqqj1XYM.js","./Ds9lsDfM.js","./DDz0S8ig.js","./BxhCEbwT.js","./4lgYwaTL.css","./DZNmLgaI.js","./CpIyErmU.js","./DNMHntIy.css","./DZkluKzQ.css","./Dpn7fjjX.js","./DG6QdPnO.js","./BIzvQSzn.css","./qMKjp9Ux.js","./BHtCX32_.js","./BSKES50A.css","./h0CjWPC6.js","./BPJTiICV.css","./Cnjlk9Ir.js","./eyMFa7z1.css","./DdYgkxZ_.js","./CDQba72W.js","./CYV3YR6m.css","./B67YLBng.css"])))=>i.map(i=>d[i]);
var Wt=Object.defineProperty;var tt=n=>{throw TypeError(n)};var Ot=(n,e,t)=>e in n?Wt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var f=(n,e,t)=>Ot(n,typeof e!="symbol"?e+"":e,t),rt=(n,e,t)=>e.has(n)||tt("Cannot "+t);var l=(n,e,t)=>(rt(n,e,"read from private field"),t?t.call(n):e.get(n)),y=(n,e,t)=>e.has(n)?tt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),D=(n,e,t,r)=>(rt(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t);var F=(n,e,t,r)=>({set _(a){D(n,e,a,t)},get _(){return l(n,e,r)}});import{c as Qe}from"./9V19AFUE.js";import{C as kt,c as ne,L as Ue}from"./Br_8hjjw.js";import{f as Et}from"./dQFVkrwK.js";import{d as ke,A as b,T as Xe,c as st,g as _t,p as Mt}from"./Bu9-HbQ4.js";import{g as Vt,T as St,u as N,e as k,a as at,i as X,b as Ye,w as Pe,p as Ft,c as Re,I as nt,R as Bt,f as it,S as Ut,C as Xt,F as Yt,d as jt,s as De,E as Ce}from"./BnQx2YJv.js";import{g as ot,a as Gt,M as _e,W as zt,S as Ht}from"./DjL2hHZW.js";import{L as Ee,K as H,n as Kt,O as C,y as oe,z as K,A as Z,d as yt,k as je,I as ge,C as Le,G as ct,Z as Zt,_ as It,r as Qt,D as qt,F as lt}from"./BUU1NkbK.js";import{C as Jt}from"./BJmh0rUk.js";import{I as R,d as qe,a as S,b as ee,g as er}from"./DcvgOCRL.js";import{S as Ge}from"./RAasLaaH.js";import{R as tr}from"./BH9FFkim.js";import{f as ut,a as mt,l as rr,r as sr}from"./DG6QdPnO.js";import{o as ar,c as nr,a as ir}from"./BSdpnwYg.js";import{i as vt}from"./CpIyErmU.js";import{r as or,F as Se,a as ze,W as dt,C as $,O as j,b as we,I as Ve}from"./BGsde7CB.js";import{S as ie}from"./D1A-NVwd.js";import{S as pt}from"./BDuQcTSZ.js";import{C as He}from"./Xupdrwif.js";import{c as cr}from"./DmXZOoyp.js";import{W as ht}from"./Uu07fvcW.js";import{W as lr}from"./BHtCX32_.js";import{W as ur}from"./C0s6aVd8.js";import{a as mr}from"./CxKYomUj.js";import{O as dr,i as Nt}from"./DdQrQ7-5.js";import{f as At}from"./CNlRQWZy.js";import{m as pr,e as hr}from"./BE-N3i2n.js";import{p as fr,a as gr}from"./DMzq3-W3.js";import{c as wr}from"./6jpuwjT2.js";import{K as br}from"./B2exwp0w.js";import"./Cc_Og2B_.js";import"./Cpj98o6Y.js";import"./CHpeLE9u.js";import"./On0xenC3.js";import"./CZZPvNTk.js";import"./djI3_XgP.js";import"./D4lI5vpz.js";import"./Ce6njBYG.js";import"./6C4StZv5.js";import"./DI3A0fxi.js";import"./BlhZwPhK.js";import"./DLyaWjaL.js";import"./BflcHXSR.js";import"./7MFW2ODw.js";import"./CV0dHcg-.js";import"./DNvW6rqi.js";import"./B1olVgM4.js";import"./CtYz4Lhf.js";import"./_N77y_hU.js";import"./CZFypg2d.js";import"./CJLX7oOC.js";var Er=Array.isArray,Sr=Object.getPrototypeOf,yr=Object.prototype,Ir=Object.keys;function vr(n){if(n.length===1){var e=n[0];if(Er(e))return{args:e,keys:null};if(Nr(e)){var t=Ir(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function Nr(n){return n&&typeof n=="object"&&Sr(n)===yr}function Ar(n,e){return n.reduce(function(t,r,a){return t[r]=e[a],t},{})}function Tr(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=fr(n),r=gr(n),a=vr(n),s=a.args,i=a.keys;if(s.length===0)return At([],t);var o=new dr($r(s,t,i?function(c){return Ar(i,c)}:Nt));return r?o.pipe(pr(r)):o}function $r(n,e,t){return t===void 0&&(t=Nt),function(r){ft(e,function(){for(var a=n.length,s=new Array(a),i=a,o=a,c=function(m){ft(e,function(){var g=At(n[m],e),E=!1;g.subscribe(wr(r,function(h){s[m]=h,E||(E=!0,o--),o||r.next(t(s.slice()))},function(){--i||r.complete()}))},r)},u=0;u<a;u++)c(u)},r)}}function ft(n,e,t){n?hr(t,n,e):e()}class Pr{constructor(e,t){f(this,"entries",new Map(Object.entries(ot())));f(this,"observable",Ee(ot()));f(this,"storage");f(this,"ready");const r=Vt(t||St.NONE);this.storage=new r({name:e}),this.ready=this.storage.load().then(a=>(this.entries=new Map([...this.entries,...a]),Object.assign(this.observable,Object.fromEntries(this.entries)),this)).catch(a=>{throw a})}setDefaults(e){return Promise.all(Object.keys(e).map(t=>{this.has(t)||this.set(t,e[String(t)])}))}get(e){return this.entries.get(e)}has(e){return this.entries.has(e)}set(e,t){return typeof e=="string"?(this.entries.set(e,t),this.observable[String(e)]=t):e&&typeof e=="object"&&!(e instanceof Map)&&Object.keys(e).forEach(r=>{t=e[r],this.entries.set(r,t),this.observable[r]=t}),this.storage.save(Array.from(this.entries))}}class Rr extends kt{constructor(t){super();f(this,"core");this.core=t}prompt(t){const r=["openDialog","--prompt"];return t&&r.push(`--message="${N(t)}"`),this.core.executeCommand(r.join(" "))}confirm(t){const r=["openDialog","--confirm"];return t&&r.push(`--message="${N(t)}"`),this.core.executeCommand(r.join(" "))}}var ye,Ie;class Cr{constructor(e){y(this,ye);y(this,Ie,[]);D(this,ye,e)}command(e,t){l(this,Ie).push({value:e,targetValue:t})}run(){return Promise.all(l(this,Ie).map(({value:e,targetValue:t})=>l(this,ye).executeCommand(e).then(r=>{const a=r===t;return a||console.warn(`[ ${e} ]; ${r} === ${t}`),{value:e,targetValue:t,result:r,success:a}})))}async start(){const e=await this.run();return[[e.length,"Tests processed"],[e.filter(t=>t.success).length,"Tests success"],[e.filter(t=>!t.success).length,"Tests failed"]]}}ye=new WeakMap,Ie=new WeakMap;const Dr=ke(({core:n})=>[{name:["execute"],description:"Execute file.",args:[new b({index:0,name:"path",description:"Path to the file"})],async action({path:e}){var s,i;let t=e;const r=new Map(n.config.get(Jt.FILE_EXTENSION_ASSIGNMENT));if(!t)throw k.get("bad_args");let a;if(r.has(at(t))?a=await((s=n.modules.files)==null?void 0:s.fs.get(r.get(at(t)))):(a=await((i=n.modules.files)==null?void 0:i.fs.get(t)),t=void 0),typeof(a==null?void 0:a.action)=="function")return a.action(n,t);if(a!=null&&a.data&&typeof(a==null?void 0:a.data)=="object"&&"type"in a.data){const o=a.data,c=[`openPreview "${a.getPath()}"`];return o.openMaximized&&c.push("-maximized"),n.executeCommand(c.join(" "))}}},{name:["openColorSettings"],async action(){var t;const e=await H(()=>import("./DFhd1ocT.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]),import.meta.url).then(r=>r.default);(t=n.modules.windows)==null||t.addWindow({component:e,componentData:{},options:{title:"Color Settings",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}},{name:["openSettings"],async action(){var t;const e=await H(()=>import("./Cqqj1XYM.js"),__vite__mapDeps([23,5,6,1,7,14,15,16,17,24,8,9,25,26,27,28,29,30,19,20,21,31]),import.meta.url).then(r=>r.default);(t=n.modules.windows)==null||t.addWindow({component:e,componentData:{},options:{title:"Settings",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1,filled:!0}})}},{name:["echo","print"],args:[new b({name:["newline","n"],flag:!0})],async action({newline:e},t){const r=a=>N(a).replace(/\\"/g,'"').replace(/\\n/g,`
`);if(e)t.message(t.commandArgs.map(a=>r(a)));else{let a=await t.core.executeCommand(t.commandValue);typeof a=="object"&&(a=JSON.stringify(a)),t.message(`${N(r(a))}`)}}},{name:"commands",action(e,t){const r=new Xe({headerPadding:1});return r.addColumns([{value:"Command(s)",align:"left",maxWidth:20},{value:"Description/Arguments",align:"left",maxWidth:60}]),r.addRows(ne.items.reduce((a,s)=>{const i=s.args||[],o=[];s.description&&(o.push(s.description),o.push("")),i.length&&(o.push("Arguments:"),o.push(""));const{flagNames:c,kwargNames:u}=i.reduce((g,E)=>{const h=E.name.join(", ");return E.flag?g.flagNames.push({name:`-${h}`,description:E.description}):g.kwargNames.push({name:`--${h}`,description:E.description}),g},{flagNames:[],kwargNames:[]}),m={paddingChr:"Â",showHeaders:!1,config:{name:{minWidth:15},description:{minWidth:10,maxWidth:30}}};return o.push(st(c,Object.assign({},m))),c.length>0&&u.length>0&&o.push(""),o.push(st(u,Object.assign({},m))),a.push([s.name.join(", "),o.join(`
`)]),a},[])),t.message(["Commands:",r]),Promise.resolve()}},{name:["CLS","CLEAR"],async action(){n.consoleInterface.clear()}},{name:["prompt","input","PROMPT","INPUT"],args:[new b({index:0,name:"text",description:"Text from prompt."}),new b({index:1,name:"variable",description:"Variable"})],action:({text:e,variable:t,unresolved:r})=>(r.text&&!r.variable?(t=r.text,e=void 0):t=r.variable,n.consoleInterface.prompt(e).then(a=>{var s;return X(a)&&(a=Number(a)),t&&((s=n.modules.parser)==null||s.memory.set(t,a)),a}))},{name:["confirm","CONFIRM"],args:[new b({index:0,name:"text",description:"Text from confirm."})],action({text:e}){return n.consoleInterface.confirm(e)}},{name:["selfCheck"],async action(e,t){const r=new Xe;r.addColumns([{value:"Count",align:"left",minWidth:8},{value:"Description",align:"left",minWidth:15}]),r.addRows(await Lr(n)),t.message(['"Command Tests:"',r,'"For failures, look in the web console of the browser."'])}}]);function Lr(n){const e=new Cr(n);return e.command('"foo" +"bar"','"foobar"'),e.command("(-3+-6)+1",-8),e.command("(-3-+6)+1",-8),e.command("(-3*-6)+1",-3*-6+1),e.command("(-3/-6)+1",-3/-6+1),e.command("(-3+6)+1",4),e.command("(-3-6)+1",-8),e.command("(-3*6) + 1",-3*6+1),e.command("(-3/6)+1",-3/6+1),e.command("INT(PI)",3),e.command("(POW(2,2)+1)",5),e.command('ASC("D")',68),e.command("CHR$(68)",'"D"'),e.command('LEN("ABC")',3),e.command('"a" + "b"','"ab"'),e.command("STRING$(3,0)",'"000"'),e.command("SQRT(2,2)",Math.sqrt(2)),e.command("128 >> (256 + 5)",4),e.command("-2+4+SQRT(2,2)",2+Math.sqrt(2)),e.command("-2- 2 * 2",-2-2*2),e.command("(1+1)",2),e.command("2*2",2*2),e.command("1+2+3+(POW(2,2)+1)+5*8-(50/2)",6+(2**2+1)+5*8-50/2),e.start()}const{version:xr}=Kt().public,te=class te{constructor(){f(this,"setupComplete",!1);f(this,"events",C(new Ge));f(this,"errorObserver",C(new Ge));f(this,"ready",C(new tr(0)));f(this,"modules",{});f(this,"consoleInterface",new Rr(this));f(this,"logger",new Ue({core:this,debug:!1,consoleInterface:this.consoleInterface}));f(this,"executionCounter",0);f(this,"config",new Pr(Gt,St.SESSION));this.log(`${te.NAME}; ${te.VERSION}`)}get version(){return te.VERSION}addExecution(){return this.executionCounter++,()=>{this.executionCounter--}}async setup({firebase:e,symbols:t,disks:r}={}){var s,i;if(this.setupComplete)return console.warn("Setup is complete!"),this;this.setupComplete=!0,ne.add(_t(Dr({core:this}))),await this.config.ready;const a=Object.values(this.modules);return await Promise.all(a.map(o=>Promise.resolve(o==null?void 0:o.beforeSetup()))),await Promise.all(a.map(o=>Promise.resolve(o==null?void 0:o.setup()))),r&&((s=this.modules.files)==null||s.addDisks(r)),t&&((i=this.modules.symbols)==null||i.addSymbols(t)),e&&await Et.initApp(e),this.ready.next(this),this}destroy(){ne.clear()}addModule(e,t){const r=new e({core:this,...t});this.modules[Qe(r.name)]=r}async removeModule(e){await e.destroy(),Reflect.deleteProperty(this.modules,e.name)}executeCommands(e){const t=e.shift();if(t)return this.executeCommand(t).then(()=>this.executeCommands(e))}async executeCommand(e,t){var o,c,u;typeof e=="string"&&(e=e.replace(/(.*[^\\])\n(\S*)/gm,"$1\\n$2"));const r=(t==null?void 0:t.show)||!1,a=[];(Array.isArray(t==null?void 0:t.message)||typeof(t==null?void 0:t.message)=="string")&&a.push(...a.concat(t==null?void 0:t.message));const s={commandBucket:ne,core:this,logger:this.logger,show:r,...t,message:m=>{if(r){let g=m;typeof m=="string"&&(m=m.replace(/\\n/g,`
`),g=`"${m}"`),a.push(...[].concat(g))}}};let i;try{if(e){const m=await((o=this.modules.parser)==null?void 0:o.parseCommand(e));m?(c=s.commandBucket)!=null&&c.has(m.command)?i=await gt(e,m,s.commandBucket,s):ne.has(m.command)?i=await gt(e,m,ne,s):(u=this.modules.parser)!=null&&u.mathParser.validInput(e)?i=await this.modules.parser.mathParser.parse(e):/^\w+$/.test(e)&&console.warn(`can\\'t use variable or method "${e}"`):console.warn(`can\\'t parse command "${e}"`)}}catch(m){let g=m;Array.isArray(m)&&(g=new Error(m[m.length-1])),this.errorObserver.next(g)}return i!==void 0&&i!=="undefined"&&typeof i=="string"&&s.show&&a.length<1&&a.push(i),a.forEach(m=>{var g;return(g=s.logger)==null?void 0:g.add(m,{type:Ue.TYPE.OUTPUT})}),i}addRootItems(e){var r;const t=(r=this.modules.files)==null?void 0:r.fileSystem;return Promise.all(e.map(async({id:a,name:s,data:i,meta:o,items:c})=>{if(c&&c.length){const u=await(t==null?void 0:t.createRootDir(a,s,{meta:[[R.WINDOW_SIDEBAR,!1],[R.WINDOW_SCALE,!1],[R.WINDOW_SCROLL_X,!1],[R.WINDOW_SCROLL_Y,!1],[R.POSITION,{x:80,y:320}],[R.WINDOW_SIZE,{x:120,y:120}],[R.IGNORE_SYMBOL_REARRANGE,!0]]}));return u==null||u.addItems(c),u}else return t==null?void 0:t.createRootFile(a,s,i,{meta:o||[]})})).catch(a=>{throw new Error(a)})}log(e){this.logger.add(e,{namespace:"Core"})}};f(te,"VERSION",xr||"0.0.0"),f(te,"NAME","web-workbench");let Ke=te;async function gt(n,e,t,r){var s;const a=t.get(e.command);if(a){const i=r.show,o=Mt(a,e),c=await a.action(o,Object.assign({command:e.command,commandValue:e.commandValue,commandArgs:e.args},r));return i&&r.showCommand&&((s=r.logger)==null||s.add("> "+n,{type:Ue.TYPE.OUTPUT})),c}}function be(n,e){return n.separator===e}function Wr(n){return{rawCommand:"",mergeArgs:!1,mergeArgsBy:/^[+,]$/,hasProgram:!1,activeArgument:void 0,isLongArgument:!1,isKeyWordArgument:!1,isString:!1,stringTmpValue:void 0,additionSpecial:!1,specialChar:["+",";",","],isBufferWrite:!1,isBufferValue:!1,isBufferString:!1,rawBuffer:void 0,lastChar:void 0,isSeparating:!1,escaped:!1,currentTick:Pt,isClamp:!1,...n,separator:n.separator||Tt}}const xe="[COMMAND_PARSER_NEW_LINE]";function re(n,{separator:e,forceProgram:t,mergeArgs:r,mergeArgsBy:a}={}){var o,c;const s=Wr({separator:e||Tt});n=n.replace("\\n",xe),n=`${String(n).trim()}${s.separator}`,s.rawCommand=n,s.mergeArgs=r||!1,s.mergeArgsBy=a||s.mergeArgsBy;const i=[];for(;s.rawCommand.length;){const u=s.rawCommand[0];s.rawCommand=s.rawCommand.slice(1);const m=s.rawCommand[0];if(be(s,m)){if(s.isSeparating&&be(s,u))s.isSeparating=!1;else if(!s.isBufferWrite&&be(s,u)){s.isSeparating=!0;continue}}else s.isSeparating=!1;if((be(s,u)&&!s.isClamp||s.rawCommand.length<1)&&(!s.escaped&&s.isBufferValue&&!s.isBufferString&&(s.isBufferWrite=!1),!s.isBufferWrite&&(s.isBufferValue&&Gr(s),s.activeArgument))){jr(s,i);continue}if(u===$t&&s.activeArgument){s.isKeyWordArgument=!0;continue}else if((u===Fe&&(/[ +a-zA-Z]/.test(m)||m===Fe)||s.activeArgument&&!s.isKeyWordArgument)&&!s.isBufferWrite&&!s.specialChar.includes(u))if(s.activeArgument){!((c=(o=s.activeArgument)==null?void 0:o.name)!=null&&c.length)&&u===Fe?s.isLongArgument=!0:s.activeArgument.name+=u;continue}else{s.activeArgument={name:J},s.isLongArgument&&(s.activeArgument.long=s.isLongArgument);continue}Xr(s,u)}return Vr(i,{forceProgram:t,mergeArgs:r,mergeArgsBy:a})}function Or(n){var e,t,r;return((e=n.value)==null?void 0:e.type)==="any"&&!n.name&&((t=n.value)==null?void 0:t.raw)&&/^[a-zA-Z]+$/.test((r=n.value)==null?void 0:r.raw)||!1}function kr(n){var e;return((e=n.value)==null?void 0:e.raw)==="+"}function _r(n,e=/^[+]$/){return n.reduce((t,r)=>{var i,o,c,u,m,g;const a=(o=(i=t[t.length-1])==null?void 0:i.value)==null?void 0:o.raw,s=a&&a[String(a).length-1];if(typeof e=="string"&&(String((c=r.value)==null?void 0:c.raw)===e||String(s)===e)||e instanceof RegExp&&(e.test(String((u=r.value)==null?void 0:u.raw))||e.test(String(s)))){const E=t[t.length-1].value;E&&E.raw&&typeof E.value=="string"&&(E.raw+=(m=r.value)==null?void 0:m.raw,E.value+=((g=r.value)==null?void 0:g.value)||"",E.type="any")}else t.push(r);return t},Array())}function Mr(n,e){const t=[];return n&&t.push(n),t.push(...e.map(r=>{var a,s;if(r.plain)return((a=r.value)==null?void 0:a.raw)||r.name||J;{const i=r.long?"--":"-",o=r.name||J,c=((s=r.value)==null?void 0:s.raw)||J,u=r.value?$t:"";return`${i}${o}${u}${c}`}})),t}function Vr(n,{forceProgram:e,mergeArgs:t,mergeArgsBy:r}={}){var u;const a=n[0],s=n[1];let i;(!s||!kr(s))&&a&&(Or(a)||e)&&(n=n.filter(m=>m!==a),i=(u=a.value)==null?void 0:u.raw);let o=n;t&&(o=_r(n,r));const c=Mr(i,o);return{program:i==null?void 0:i.replace(xe,`
`),args:o,rawArgs:c}}const Fr="\\",J="",Tt=" ",Fe="-",$t="=",Pt='"',Br="'";function Ur(n){return n===Fr}function Xr(n,e){Ur(e)?n.escaped=!0:(!n.escaped&&!n.isBufferValue&&!be(n,e)?(n.isBufferWrite=!0,n.isBufferValue=!0,(e===Br||e===Pt)&&!n.isClamp&&(n.currentTick=e,n.isBufferString=!0),n.isBufferString=e===n.currentTick,n.rawBuffer=void 0,n.activeArgument=n.activeArgument||{value:void 0,plain:!0}):e===n.currentTick&&n.isBufferString&&!n.escaped&&!n.isClamp&&(n.isBufferWrite=!1),(e!==n.currentTick||n.isClamp||n.escaped&&e===n.currentTick)&&((!n.isBufferWrite&&n.isBufferString||n.isBufferWrite&&!n.isBufferString)&&!n.isClamp&&n.specialChar.includes(e)&&!n.additionSpecial?(n.rawCommand=" "+e+" "+n.rawCommand,n.additionSpecial=!0):(n.additionSpecial=!1,n.rawBuffer=(n.rawBuffer||"")+e)),n.escaped=!1),n.isBufferWrite&&(e==="("?n.isClamp=!0:e===")"&&(n.isClamp=!1)),n.lastChar=e}function Yr(n){var e,t,r;return n.plain&&!n.name&&((e=n.value)==null?void 0:e.type)==="any"&&(((t=n.value)==null?void 0:t.raw)===void 0||((r=n.value)==null?void 0:r.raw)===J)}function jr(n,e){n.activeArgument&&(n.isLongArgument&&(n.activeArgument.long=n.isLongArgument),Yr(n.activeArgument)||e.push(n.activeArgument)),n.activeArgument=void 0,n.isLongArgument=!1,n.isKeyWordArgument=!1}function Gr(n){var t,r;const e=n.rawBuffer||J;if(n.isBufferString)n.activeArgument.value={type:"string",value:(t=n.rawBuffer)==null?void 0:t.replace(xe,`
`),raw:`${n.currentTick}${((r=n.rawBuffer)==null?void 0:r.replace(xe,`
`))||""}${n.currentTick}`};else{let a="any",s=e;/^[+-]?\d+$/.test(e)?(a="integer",s=Math.round(Number(e))):/^[+-]?(?:\d+\.?\d*|\.\d+)$/.test(e)?(a="double",s=Number(e)):/^true|false$/.test(e)?(a="boolean",s=e==="true"):/^[a-zA-Z$]+$/.test(e)?(a="any",s=String(e).replace(/ /g,J)):/^[\d+\-*./a-zA-Z$]+$/.test(e)&&(a="term",s=String(e).replace(/ /g,J)),n.activeArgument.value={type:a,value:s,raw:n.rawBuffer}}n.rawBuffer=void 0,n.isBufferValue=!1,n.isBufferString=!1}const M=class M{async parse(e){const t=re(e,{forceProgram:!0}),r=await this.getArguments(t);return{origin:e,unresolved:Hr(t),args:r.args,kwargs:r.kwargs,command:t.program||"",commandValue:e}}getArguments(e){return{args:e.args.filter(t=>t.plain).map(t=>{if(t.value)return t.value.value}),kwargs:Object.fromEntries(e.args.filter(t=>!t.plain).map(t=>[Qe(t.name||""),t.value!==void 0?t.value.value:void 0]))}}static extractStrings(e){let t=!1,r=0;const a=[];let s=!1;for(let o=e.length-1;o>=0;o--){const c=e[Number(o)],u=e[o-1];!s&&c==='"'&&u!=="\\"?t?(t=!1,a.push(e.slice(o,r+1))):(s=!1,t=!0,r=o):(!t&&s||s)&&c==="'"&&u!=="\\"&&(t?(s=!1,t=!1,a.push(e.slice(o,r+1))):(s=!0,t=!0,r=o))}if(t)throw new Error("can't extract values; "+e);return{result:a.reduce((o,c,u)=>o.replace(c,M.resolveKey(u)),e),values:a}}static extractValues(e,t=" "){let r=!1,a=0;const s=[];let i=!1;for(let c=e.length-1;c>=0;c--){const u=e[Number(c)],m=e[c-1];!i&&u==='"'&&m!=="\\"?r?(r=!1,s.push(e.slice(c,a+1))):(i=!1,r=!0,a=c):(!r&&i||i)&&u==="'"&&m!=="\\"&&(r?(i=!1,r=!1,s.push(e.slice(c,a+1))):(i=!0,r=!0,a=c))}if(r)throw new Error("can't extract values; "+e);return s.forEach((c,u)=>{e=e.replace(c,M.resolveKey(u))}),{params:e.split(t).filter(c=>c),values:s}}static resolveKey(e){return`$$$$$$${e}`}static resolveValues({params:e,values:t}){return e.map(r=>M.resolveValue(r,t))}static valueUnresolved(e){return typeof e=="string"&&M.REGEX_VALUE_RESOLVE.test(e)}static resolveValue(e,t){var a;let r=e;if(M.valueUnresolved(e)){if(r=(a=String(e).match(/[$]{3}(\d+)/g))==null?void 0:a.reduce((s,i)=>s.replace(i,t[Number(i.replace(M.REGEX_VALUE_RESOLVE,"$1"))]),String(e)),/[\w]+[$%]?[ ]*\(/.test(r||""))return r;if(typeof r=="string"){if(r==="undefined")return;if(zr(r))return Number(r);if(!r.startsWith('"'))return r}}return r}};f(M,"REGEX_VALUE_RESOLVE",/[$]{3}(\d+)/),f(M,"REGEX_COMMAND_REPLACE",/^([a-zA-Z]+[a-zA-Z0-9_]+) (.*)$/),f(M,"REGEX_PARAM_KWARG",/^[-]{0,2}([\\-\w]+)=(.*)$/),f(M,"REGEX_PARAM_ARG",/^[-]{1,2}([\\-\w]+)$/);let O=M;function zr(n){return!isNaN(Number(n))}function Hr(n){return{args:n.args.filter(e=>e.plain).map(e=>{var t;return((t=e.value)==null?void 0:t.raw)||""}),kwargs:Object.fromEntries(n.args.filter(e=>!e.plain).map(e=>{var t;return[Qe(e.name||""),((t=e.value)==null?void 0:t.raw)||""]}))}}var ce;class Rt{constructor(e,t,r,a){f(this,"name");y(this,ce);f(this,"global",!1);f(this,"readonly",!1);this.name=e,D(this,ce,t),this.global=r||this.global,this.readonly=a||this.readonly}get value(){return l(this,ce)}set value(e){this.readonly||D(this,ce,e)}}ce=new WeakMap;class Kr extends Rt{constructor(e,t,r=!1){super(e,t,r,!0)}async execute(...e){if(typeof this.value=="function")return this.value(...e)}}class Ze extends Rt{}var P,Q,L;class Je{constructor(){y(this,P,new Map);y(this,Q,new Map);y(this,L,[])}reset(){this.resetPrefixStack(),l(this,P).clear(),l(this,Q).clear()}resetPrefixStack(){D(this,L,[])}get prefixStack(){return l(this,L)}get currentPrefixStack(){return l(this,L)[l(this,L).length-1]}has(e){var t;return e=e.replace(/(.*[^ ])[ ]+$/,"$1"),e=e.replace(/[$%]$/,""),(!l(this,P).get(e)||l(this,P).get(e)&&!((t=l(this,P).get(e))!=null&&t.global))&&(e=this.prepareName(e)),l(this,P).has(e)}add(e,t,r=!1,a=!1){e=e.replace(/(.*[^ ])[ ]+$/,"$1"),/\$$/.test(e)?t===void 0&&(t=""):/\\%$/.test(e)&&t===void 0&&(t=0),e=e.replace(/[$%]$/,""),e=this.prepareName(e),this.has(e)||l(this,P).set(e,new Ze(e,t,r,a))}get(e){var a;e=e.replace(/(.*[^ ])[ ]+$/,"$1");const t=e;e=e.replace(/[$%]$/,""),(!l(this,P).get(e)||l(this,P).get(e)&&!((a=l(this,P).get(e))!=null&&a.global))&&(e=this.prepareName(e));const r=l(this,P).get(e);if(r){let s=r.value;return s&&typeof s=="string"&&(/\$$/.test(t)?s=String(s):/\\%$/.test(t)||/^\d+$/.test(s)?s=parseInt(s):/^[\d.]+$/.test(s)&&(s=parseFloat(s))),s}}set(e,t,r=!1,a=!1){if(e=e.replace(/(.*[^ ])[ ]+$/,"$1"),typeof t=="string"&&(/[$]$/.test(e)?t===void 0?t="":t=String(t):/[%]$/.test(e)&&(t===void 0?t=0:t=parseInt(t))),e=e.replace(/[$%]$/,""),e=this.prepareName(e),this.has(e)){const s=l(this,P).get(e);s instanceof Ze&&s&&(s.value=t)}else this.add(e,t,r,a)}addSub(e,t){e=this.prepareName(e,!1),this.has(e)||l(this,Q).set(e,new Kr(e,t))}async executeSub(e,t=[],r=!1){t=t||[],e=this.prepareName(e,!1),l(this,L).push({name:`${Math.round(Math.random()*1e4)}`,global:r});const a=l(this,Q).get(e);return a==null?void 0:a.execute(...t).then(s=>(l(this,P).forEach(i=>{RegExp(`[$]{3}${l(this,L)[l(this,L).length-1].name}$`).test(i.name)&&l(this,P).delete(i.name)}),l(this,L).pop(),s))}hasSub(e){return e=this.prepareName(e,!1),l(this,Q).has(e)}prepareName(e,t=!0){return typeof e=="string"&&(e=e.replace(/ /g,"")),t&&l(this,L).length&&!/[$]{3}/.test(e)&&(e=`${e}$$$${l(this,L)[l(this,L).length-1].name}`),e}get dims(){return l(this,P)}get subs(){return l(this,Q)}}P=new WeakMap,Q=new WeakMap,L=new WeakMap;var se,ve,T,V,G,Ne,Ae,W,Te,ae,z,x,q,B,U,bt;let Zr=(bt=class{constructor(e,t,r,a,s,i){f(this,"debug",!1);y(this,se);y(this,ve);y(this,T);y(this,V);y(this,G);y(this,Ne,9999999999);y(this,Ae,0);y(this,W);y(this,Te,[]);y(this,ae,0);y(this,z,[]);y(this,x,-1);y(this,q,[]);y(this,B,[]);y(this,U,-1);D(this,G,e),D(this,V,t||(()=>Promise.resolve(void 0))),D(this,T,r||new Je),D(this,se,a),D(this,ve,s),this.debug=i!==void 0?i:this.debug}get memory(){return l(this,T)}get lines(){return l(this,G)}parse(e){var r;e=e||Array().concat(l(this,G));const t=(r=e.shift())==null?void 0:r.trim();return new Promise(a=>{if(l(this,W)&&t!=="END SUB"){t&&l(this,W).lines.push(t),a(void 0);return}if(l(this,Ne)>0&&l(this,Ae)>l(this,Ne))throw new Error("BASIC INTERPRETER OVERFLOW");if(F(this,Ae)._++,l(this,U)>=0){const s=l(this,B)[l(this,U)];if(s){if(l(this,B).forEach(i=>{s.count===0&&i&&t&&i.count===0&&i.lines.push(t)}),t&&(t==="WEND"||/NEXT /.test(t)))return s.condition().then(async i=>{if(s.tmpLines=s.tmpLines||e,i){const o=s.lines;return s.count++,s&&typeof s.step=="function"&&await s.step(),o.length>0?this.parse(Array().concat(o)):(l(this,B)[l(this,U)]=!1,F(this,U)._--,l(this,B).pop(),null)}else return l(this,B)[l(this,U)]=!1,F(this,U)._--,l(this,B).pop(),null}).then(a);a(void 0)}else a(void 0)}else a(void 0)}).then(()=>{if(!l(this,W)&&l(this,x)>=-1&&(l(this,q)[l(this,x)]!==void 0&&l(this,z)[l(this,x)]===void 0&&l(this,z).push(!l(this,q)[l(this,x)]),t==="ELSE"&&l(this,ae)<1&&(l(this,z)[l(this,x)]=!l(this,z)[l(this,x)])),l(this,z)[l(this,x)])t&&/^IF (\((.*)\)|(.*)) THEN$/.test(t)&&F(this,ae)._++;else return this.parseLine(t,e);return null}).then(()=>(l(this,x)>-1&&(t==="ENDIF"||t==="END IF")&&(l(this,ae)<1?(F(this,x)._--,l(this,q).pop(),l(this,z).pop()):F(this,ae)._--),e.length?this.parse(e):l(this,Te)))}parseLine(e,t){return new Promise((r,a)=>{if(e=(e||"").replace(/^[ \t]+/g,""),/^ *[#/]+/.test(e)){r(void 0);return}if(/^GOTO +([\w\d]+)$/.test(e)){const s=e.match(/^GOTO +([\w\d]+)$/)||[];this.commandGoto(t,s[1]),e=""}if(/^SUB (.*) STATIC$/.test(e)){const s=e.match(/^SUB (.*) STATIC$/)||[];return this.commandSubStatic(s[1]).then(r)}else{if(e==="END SUB")return this.commandEndSub().then(r);if(l(this,W)){r(void 0);return}}if(/^IF (\((.*)\)|(.*)) THEN$/.test(e)){const s=e.match(/^IF (\((.*)\)|(.*)) THEN$/)||[],i=s[3]||s[2];return this.commandIfThen(i).then(r)}else if(e==="ELSE"||e==="ENDIF"||e==="END IF"){r(void 0);return}if(/^WHILE (.*)$/.test(e)){const s=e.match(/^WHILE (.*)$/)||[];return this.commandWhile(s[1]).then(r)}else if(e==="WEND"){r(void 0);return}if(/^FOR (.*)$/.test(e)){const s=e.match(/^FOR (.*)$/)||[];return this.commandFor(s[1]).then(r)}else if(e.startsWith("NEXT ")){r(void 0);return}if(/^([\w\d]+):$/.test(e)){r(void 0);return}if(/^DIM( SHARED)? +(.*)$/.test(e)){const s=e.match(/^DIM( SHARED)? +(.*)$/)||[];return this.commandDimShared(s[2],!!s[1]).then(r)}if(/^LET +([\w,$%]+)(\((.*)\))? *= *(.*)$/.test(e)){const s=e.match(/^LET +([\w,$%]+)(\((.*)\))? *= *(.*)$/)||[];return this.commandLet(s[1],s[4],s[3]).then(()=>r(void 0))}if(/^READ +([\w, $%]+)$/.test(e)){const s=e.match(/^READ +([\w, $%]+)$/)||[];return this.commandRead(s[1]).then(r)}if(/^END[ ]*$/.test(e))return this.commandEnd().then(r);if(/^(PAUSE|SLEEP) +(.+)/.test(e)){const i=(e.match(/^(PAUSE|SLEEP) +(.+)/)||[])[2];return this.commandPause(i).then(r)}if(/^CALL *(.*)/.test(e)){const s=e.match(/^CALL *(.*)/)||[];return this.commandCall(s[1],t).then(r)}if(/^EXECUTE *(FILE|EVAL) *(.*)/.test(e)){const s=e.match(/^EXECUTE *(FILE|EVAL) *(.*)/)||[];return this.commandExecute(s[1],s[2]).then(r).catch(a)}if(/^PRINT +USING +.*$/.test(e)){const s=e.match(/^PRINT +USING +(.*)$/)||[];return this.commandPrintUsing(s[1]).then(r)}if(/^PRINT +(.*)$/.test(e)){const s=e.match(/^PRINT +(.*)$/)||[];return console.debug("PRINT",s),this.commandPrint(s[1]).then(r)}if(/^DATA +(.*)$/.test(e)){const s=e.match(/^DATA +(.*)$/)||[];return this.commandDataVar(s[1]).then(r)}l(this,V).call(this,e,{show:!0}).then(s=>{s!==void 0&&l(this,Te).push(s)}).then(r).catch(a)})}async setReadStack(e,t){let r=await this.parseValue(t,!0);return typeof r=="string"&&X(r)&&(r=parseFloat(r)),l(this,T).set(e,r,!0)}async addDataStack(e){let t=await this.parseValue(e,!0);return typeof t=="string"&&X(t)&&(t=parseFloat(t)),l(this,se).push(t)}async setStack({name:e,value:t,index:r,global:a}){let s=await this.parseValue(t,!0);if(typeof s=="string"&&X(s)&&(s=parseFloat(s)),r!==void 0){r=Number(await this.parseValue(r,!0));const i=l(this,T).get(e);if(typeof i=="object")return i[r-1]=s,s;throw new Error(`Index ${r} out of range`)}else return l(this,T).set(e,s,a)}async setGotoMarkStack(e,t){l(this,ve).set(e,await this.parseValue(t,!0))}async parseValue(e,t=!0,r=!1){if(e===void 0)return e;if(Array.isArray(e))return e;if(typeof e=="boolean")return e;if(typeof e=="number")return Number(e);if(typeof e=="string"){if(/^ *(true|false|TRUE|FALSE) *$/.test(e))return e.toLowerCase()==="true";if(/^[\d]+$/.test(e.trim())||/^ *([\\-]?[\d.]+(e[-+]?\d+)?) *$/.test(e.trim()))return parseFloat(e);if(/^ *@"((.|\n)*)" *$/.test(e.trim()))return e.replace(/^ *@"((.|\n)*)" *$/,'"$1"');if(/^"((\\"|[^"])+)"$/.test(e.trim()))return e.trim().replace(/^"((\\"|[^"])+)"$/,'"$1"');if(/^[^"]?(.+)[^"]? *$/.test(e.replace(/ /g,""))){if(e=e.replace(/^ */g,""),l(this,T).has(e.replace(/ /g,"")))return e=e.replace(/ /g,""),this.parseValue(l(this,T).get(e),!0);if(r)throw new Error(`Value processing continues: ${e.slice(0,20)}…'`);return l(this,V).call(this,e,{message:t?void 0:e})}}}async executeCondition(e,t,r){const a=await this.parseValue(e,!0),s=await this.parseValue(r,!0);return/^[=]?==$/.test(t)?a===s:t==="<>"?a!==s:/^([<>][=]|[<>])?$/.test(t)?Qr(a,t,s):/^!=[=]?$/.test(t)?a!==s:!1}commandIfThen(e){const t=e.match(/([^<>]*) *(<>|<=|>=|<|>|[=!]{2,3}) *([^<>].*)/);return t?this.executeCondition(t[1],t[2],t[3]).then(r=>(l(this,q).push(r),F(this,x)._++,r)):this.parseValue(e[1],!0).then(r=>{let a=r;return r instanceof Ze&&(a=r.value),l(this,q).push(!!a),F(this,x)._++,a})}commandWhile(e){const t=e.match(/([^<>]*) *(<>|<=|>=|<|>|[=!]{2,3}) *([^<>].*)/);return t?this.executeCondition(t[1],t[2],t[3]).then(r=>{if(r)return l(this,B).push({count:0,lines:[],condition:()=>this.executeCondition(t[1],t[2],t[3])}),F(this,U)._++,r}):Promise.resolve(void 0)}async commandFor(e){const t=e.match(/(.*) *= *(.*) +TO +(.*) +STEP[ ](.*)/)||e.match(/(.*) *= *(.*) +TO +(.*)/);if(t){const r=await this.parseValue(t[2],!0),a=await this.parseValue(t[3],!0);l(this,T).set(t[1],r),F(this,U)._++;const s=async(i=!0)=>{let o=1;return t[4]&&(o=await this.parseValue(t[4],!0)),i&&l(this,T).set(t[1],Number(l(this,T).get(t[1]))+o),o};return l(this,B).push({step:s,count:0,lines:[],condition:async()=>{const i=await s(!1);return i===0?!1:this.executeCondition(`(${t[1]}  )`,i<0?">":"<",String(a))}})}}commandSubStatic(e){const t=e.match(/^([\w,$%]+)(\((.*)\))?$/)||[],r=t[1],a=O.resolveValues(O.extractValues(t[3]||"",","));return D(this,W,{name:r,lines:[],args:a}),Promise.resolve(void 0)}commandEndSub(){if(l(this,W)){const e=l(this,W).lines,t=l(this,W).args;l(this,T).addSub(l(this,W).name,async(...r)=>{(await Promise.all(t.map((s,i)=>this.parseValue(r[Number(i)]).then(o=>({arg:s,value:o}))))).forEach(({arg:s,value:i})=>{s&&l(this,T).add(String(s),i)}),await this.parse(Array().concat(e))}),D(this,W,void 0)}else throw new Error("has no active SUB");return Promise.resolve(void 0)}commandGoto(e,t){return e.splice(0,e.length),this.parse(l(this,G).slice(l(this,G).indexOf(`${t}:`),l(this,G).length))}commandDimShared(e,t){return O.resolveValues(O.extractValues(e,",")).reduce((a,s)=>{const i=String(s||"").match(/^([\w, $%]+)?(\((.*)\))?$/)||[];return l(this,T).has(i[1])||(i[3]&&(a=a.then(()=>this.parseValue(i[3],!0))),a=a.then(o=>(this.setStack({name:i[1],value:o?Array(o):void 0,global:t}),o))),a},Promise.resolve(void 0))}commandLet(e,t,r){if(l(this,T).has(e))return this.setStack({name:e,value:t,index:r});throw new Error(`Variable ${e} not defined`)}async commandPrintUsing(e){const t=re(e,{mergeArgs:!0,mergeArgsBy:/^[+,]$/}).rawArgs,r=re(t[2],{mergeArgs:!0}).rawArgs.filter(i=>i!==",").map(i=>this.parseValue(i)),a=await Promise.all(r);let s=N(t[0]);for(;s.includes("#");){const i=a.shift(),o=s.match(/(#+\.#+)|(#+)/);if(o&&/(#+\.#+)/.test(o[0])){const[c,u]=o[0].split("."),[m,g]=String(i).split("."),E=ut(String(m||"").slice(0,c.length),c.length,!0," ")+"."+ut(String(g||"").slice(0,u.length),u.length,!1,"0");s=s.replace(/(#+\.#+)/,N(String(E)))}else s=s.replace(/(#+|#+\.#+)/,N(String(i)))}return l(this,V).call(this,null,{message:`"${N(s)}"`})}commandDataVar(e){if(l(this,se).length===0)return Promise.all(e.split(",").map(t=>this.addDataStack(t)));throw new Error("DATA has already been declared")}async commandPrint(e){if(/^((".*"|[^"]*);([^;]*))$/.test(e)){const t=e.match(/(.*);(.*)$/)||[],r=await this.parseValue(t[1],!0),{rawArgs:a}=re(String(t[2]),{mergeArgs:!0});let s=await Promise.all(a.map(o=>this.parseValue(o,!0)));s=s.map(o=>N(o));const i=s.map(o=>`${N(r)}${o}`).join(" ");return l(this,V).call(this,null,{message:Ye(i)||X(i)?i:`"${i}"`})}else{let t=await this.parseValue(e);const{rawArgs:r}=re(String(t),{mergeArgs:!0});let a=await Promise.all(r.map(s=>this.parseValue(s,!0)));return a=a.map(s=>N(s)),a.length>1?t=a.join(""):t=a[0],l(this,V).call(this,null,{message:Ye(t)||X(t)?t:`"${t}"`})}}commandEnd(){return Promise.resolve(void 0)}async commandPause(e){const t=Number(await this.parseValue(e));return new Promise(r=>window.setTimeout(()=>{r(void 0)},t))}commandRead(e){const t=e.split(",");return Promise.all(t.map(r=>{const a=l(this,se).shift();return this.setReadStack(r,a),Promise.resolve(void 0)}))}commandCall(e,t){const a=(e.match(/([^(]+)\(.*\)/)||[])[1];if(l(this,T).hasSub(a))return this.parseLine(e,t);throw new Error(`SUB ${a} NOT FOUND`)}async commandExecute(e,t){if(!l(this,V))throw new Error("No callback available for readfile");let r;switch(e){case"FILE":if(r=await l(this,V).call(this,`readfile ${t}`,{show:!1}),r&&typeof r=="object"&&"content"in r)return l(this,V).call(this,r.content,{show:!0});throw new Error("File Content is empty");case"EVAL":return this.parseValue(t,!1)}}},se=new WeakMap,ve=new WeakMap,T=new WeakMap,V=new WeakMap,G=new WeakMap,Ne=new WeakMap,Ae=new WeakMap,W=new WeakMap,Te=new WeakMap,ae=new WeakMap,z=new WeakMap,x=new WeakMap,q=new WeakMap,B=new WeakMap,U=new WeakMap,bt);function Qr(n,e,t){switch(n=String(n),t=String(t),(e.match(/^([<>][=]|[<>])$/)||[])[1]){case"<":return parseFloat(n)<parseFloat(t);case">":return parseFloat(n)>parseFloat(t);case"<=":return parseFloat(n)<=parseFloat(t);case">=":return parseFloat(n)>=parseFloat(t);default:return null}}var le,ue,We,Oe;class qr{constructor(e,t){y(this,le);y(this,ue);y(this,We,new Map);y(this,Oe,[]);D(this,ue,t),D(this,le,e)}get callback(){return l(this,ue)}get memory(){return l(this,le)}async parse(e,t,r){if(e.length===0)return;e.length>1&&await this.readData(e);const a=[];return new Zr(e,async(i,o)=>{o={...o,...r};const c=await(t||l(this,ue)||(()=>{}))(i,o);return o.show&&c!==void 0&&a.push(c),c},l(this,le),l(this,Oe),l(this,We)).parse().then(()=>a)}readData(e){const t=e.find(r=>/^[ ]*DATA[ +]/.test(r));if(t){const r=e.splice(e.indexOf(t),1);return this.parse(r)}return Promise.resolve(void 0)}}le=new WeakMap,ue=new WeakMap,We=new WeakMap,Oe=new WeakMap;function _(...n){if(n.includes(void 0))throw new Error("invalid arguments")}const I={};try{I.brackets=/([^\w$%]?)\(([^\\(\\)]+)\)/,I.brackets_start=/^\((.*)\)$/,I.multiply=new RegExp("[^\\d$\\-\\w]?(?<a>([+-]?[\\w.]+e\\+\\d+)|([+-]?[\\w$%.]+)|(^[+-]?[\\w$%.]+)|([\\w$%.]+)|([$]{3}\\d+))[ ]*(?<operator>[\\^*%\\/]|MOD|XOR|AND|OR|<<|>>|>>>)[ ]*(?<b>([-]?[\\w.]+e\\+\\d+)|([-]?[\\w$%.]+)|(^[+-]?[\\w$%.]+)|([\\w$%.]+)|([$]{3}\\d+))"),I.add_subtract=/([+-]?[\w.]+e\+\d+|[+-]?[\w$%.]+|[$]{3}\d+)[ ]*([+-])[ ]*([+-]?[\w.]+e\+\d+|[+-]?[\w$%.]+|[$]{3}\d+)/,I.function=/([\w]+[a-zA-Z0-9_.]+[$%]?)[ ]*\(([^\\(\\)]*)\)/,I.function_start=/^([\w]+[a-zA-Z0-9_.]+[$%]?)[ ]*\(([^\\(\\)]*)\)/,I.variable=/^([\w]+[a-zA-Z0-9_.]?[$%]?)/,I.number=/^([+-]?[\d.]+e\+\d+|[+-]?[\d.])+($|$)/}catch(n){console.error(n)}class Jr{constructor(e,t){f(this,"debug",!1);f(this,"memory");this.memory=this.createMemory(e),this.debug=t!==void 0?t:this.debug}createMemory(e){const t=e||new Je;return t.addSub("RND",()=>Promise.resolve(Math.random())),t.addSub("PI",()=>Promise.resolve(Math.PI)),t.addSub("POW",(r,a)=>{if(_(r,a),typeof r=="string")throw new Error("Parameter is not a number");if(typeof a=="string")throw new Error("Parameter is not B number");return Promise.resolve(r**(a||2))}),t.addSub("SQRT",r=>{if(_(r),typeof r=="string")throw new Error("Parameter is not a number");return Promise.resolve(Math.sqrt(r))}),t.addSub("INT",async r=>(_(r),await parseInt(N(String(r))))),t.addSub("SPC",r=>{if(_(r),typeof r=="string")throw new Error("Parameter is not a number");return Promise.resolve(`"${mt(r," ")}"`)}),t.addSub("LEN",r=>(_(r),Promise.resolve(N(String(r)).length))),t.addSub("ASC",r=>(_(r),Promise.resolve(String(N(r)).charCodeAt(0)))),t.addSub("CHR$",r=>{if(_(r),typeof r=="string")throw new Error("Parameter is not a number");return Promise.resolve(Pe(String.fromCharCode(r)))}),t.addSub("LEFT$",(r,a)=>{if(_(r,a),typeof a=="string")throw new Error("Parameter is not B number");return Promise.resolve(`"${rr(N(r),a)}"`)}),t.addSub("RIGHT$",(r,a)=>{if(_(r,a),typeof a=="string")throw new Error("Parameter is not B number");return Promise.resolve(Pe(sr(String(N(r)),a)))}),t.addSub("STRING$",(r,a)=>{if(_(r,a),typeof r=="string")throw new Error("Parameter is not a number");return Promise.resolve(Pe(mt(r,String(N(a)))))}),t.addSub("TIME%",()=>Promise.resolve(Date.now())),t.addSub("HEX_ENC$",r=>(_(r),Promise.resolve(Pe(Number(N(r)).toString(16))))),t.addSub("HEX_DEC$",r=>(_(r),r=parseInt(String(N(r)),16),Promise.resolve(r))),t}async parse(e){const r=await new ts(this).parse(e);return this.debug&&console.debug("Result:",typeof r,r),r}validInput(e){return e&&/[/*\-+^()]?/.test(e)}}const es=5e3;class ts{constructor(e,{debug:t}={}){f(this,"debug",!1);f(this,"parser");f(this,"parsedValues",[]);f(this,"timeout",0);this.parser=e,this.debug=t!==void 0?t:this.debug}async parse(e){if(this.debug&&console.debug("PARSE ".padEnd(20,"-")),this.timeout>es)throw new Error(`Can't parse ${e}`);this.timeout++;const{result:t,values:r}=O.extractStrings(String(e));let a=re(t).rawArgs;this.parsedValues=this.parsedValues.concat(r),a=a.map(c=>/^MOD|XOR|AND|OR$/.test(c)?` ${c} `:c);let s=a.join("");X(s)?s=Number(s):Ye(s)&&(s=!!s);const i=s,o=await this.action(s);if(this.debug&&console.debug("action:",typeof o,o),o!==void 0){let c;return typeof o=="string"&&o!==i&&!/^".*"$/.test(String(o))?(c=await this.parse(o),this.debug&&console.debug("parse:",typeof c,c),c):(c=await this.resolveValue(o),this.debug&&console.debug("$v:",typeof c,c),c)}}async action(e){var t,r,a,s,i,o;if(typeof e=="string"){if((t=I.brackets_start)!=null&&t.test(e)){const c=e.match(I.brackets_start);if(c){const[u,m]=c;e=e.replace(u,m)}else throw new Error("Invalid expression")}if((r=I.function)!=null&&r.test(e)){const c=e.match(I.function);if(c){const[u,m,g,E]=c,h=m||E;let p=re(g||"",{separator:","}).rawArgs;const d=g.includes(",")&&p.join("")!==g;d&&(p=g.split(","));let w=await Promise.all(p.map(v=>this.parse(v)));if(w=d?w:[await this.parse(w.join(""))],this.parser.memory.has(h))return e.replace(u,(a=this.parser.memory.get(h))==null?void 0:a[Number(w[0])-1]);if(this.parser.memory.hasSub(h))return e.replace(u,this.cacheValue(await this.parser.memory.executeSub(h,w)))}}if((s=I.brackets)!=null&&s.test(e)){const c=e.match(I.brackets);if(c){const[u,m,g]=c;return e.replace(u,m+await this.parse(g))}else throw new Error("Invalid expression")}if((i=I.multiply)!=null&&i.test(e))return this.operation(e,I.multiply);if((o=I.add_subtract)!=null&&o.test(e))return this.operation(e,I.add_subtract)}return this.resolveValue(e)}async operation(e,t){const r=e.match(t);if(r){let a,s,i;const o=r[0];"groups"in r&&r.groups?(a=r.groups.a,s=r.groups.b,i=r.groups.operator):(a=r[1],i=r[2],s=r[3]);let c=e,u=await this.parse(a);X(u)||(u=N(u));let m=await this.parse(s);switch(X(m)||(m=N(m)),this.debug&&console.debug({valueA:u,valueB:m}),u=u,m=m,i){case"+":c=u+m;break;case"-":c=u-m;break;case"*":c=u*m;break;case"/":c=u/m;break;case">":c=u>m;break;case"<":c=u<m;break;case"^":c=u^m;break;case"%":c=u%m;break;case"MOD":c=u%m;break;case"AND":c=u&m;break;case"OR":c=u|m;break;case"XOR":c=u^m;break;case"<<":c=u<<m;break;case">>":c=u>>m;break;case">>>":c=u>>>m;break}return X(c)||(c=`"${c}"`),e.replace(o,o.replace(RegExp(`[${a}]{${String(a).length}}[ ]*[${i}]{${String(i).length}}[ ]*[${s}]{${String(s).length}}`),"")+this.cacheValue(c))}else throw new Error("Invalid expression")}async resolveValue(e){var t,r,a;if(typeof e!="function"&&O.valueUnresolved(e))return O.resolveValue(e,this.parsedValues);if(typeof e=="string"){if(e=e.replace(/^[ ]*([^ ].*[^ ])[ ]*$/,"$1"),(t=I.number)!=null&&t.test(e)){if(X(e))return Number(e)}else if((r=I.function_start)!=null&&r.test(String(e))){const s=e.match(I.function_start);if(s){const[,i,o]=s;if(this.parser.memory.hasSub(i))return this.parser.memory.executeSub(i,O.resolveValues(O.extractValues(o,",")));throw new Error(`can't find sub "${i}" in memory`)}else throw new Error("Invalid expression")}else if((a=I.variable)!=null&&a.test(String(e))){const s=e.replace(I.variable,"$1");if(this.parser.memory.hasSub(s))return this.parser.memory.executeSub(s);if(this.parser.memory.has(s))return this.parser.memory.get(s)}}return e}cacheValue(e){return this.parsedValues.push(e),O.resolveKey(this.parsedValues.length-1)}}const rs=["CLS","READ max","DIM fib%(max)","LET fib(1) = 1","LET fib(2) = 2","FOR i=3 TO max","LET fib(i) = fib(i - 2) + fib(i -1)","NEXT i","FOR i=1 TO max","PRINT fib(i)","NEXT i","DATA 10","END"],ss=["CLS","DIM w%,h%,a%","LET w%=12","LET h%=4","LET a%=w%*h%",'PRINT "With the width " + w%','PRINT " and the height " + h%','PRINT " you have the area " + a%'],as=["CLS","DIM r,a","LET r=5","READ pi","LET a=r*r*pi",'PRINT USING "With the radius ##.##"; r','PRINT USING "we have the area ##.##"; a',"DATA 3.14","END"],ns=["GuessTheNumber","CLS","READ max%","DIM number%, guess%, guesses%",'PRINT "The number is between 1-1000."',"LET number% = INT(RND * max%) + 1","LET guess% = 1","LET guesses% = 0","WHILE guess%<>number%",'PRINT "Guess the number"',"INPUT guess%","IF (guess%<>number%) THEN","IF (guess%>number%) THEN",'PRINT "Your guess was too high"',"ELSE",'PRINT "Your guess was too low"',"ENDIF","ENDIF","LET guesses% = guesses% + 1","WEND",'PRINT USING "You found the number in # tries"; guesses%',"DATA 1000","END"],is=["DIM result",'PRINT "Calculate the factorial of"',"INPUT n","LET result = 1","FOR i = n TO 1 STEP -1","LET result = result * i","NEXT i",'PRINT USING "#! = #"; n, result',"END"],os=["CLS","DIM stars$",'PRINT "Enter the height of the pyramid"',"INPUT height",'LET stars$ = ""',"FOR i = 1 TO height",'LET stars$ = ""',"FOR j = 1 TO (i+i-1)",'LET stars$ = stars$ + "*"',"NEXT j","PRINT SPC(height - i) + stars","NEXT i","END"],cs=['PRINT "Step 1"','PRINT "Step 2"','PRINT "Step 3"',"GOTO ignore",'PRINT "Step 4"',"ignore:",'PRINT "Step 5"'],ls=["DIM A, B","LET A = 2000",'LET B = "Hello World"','PRINT USING "A: #"; A','PRINT USING "B: #"; B'],us=["DIM A, B","LET A = 1","LET B = 2","IF A == B THEN",'PRINT "true"',"ELSE",'PRINT "false"',"END","IF (A < B) THEN",'PRINT "true"',"END"],ms=["DIM i%","FOR i% = 1 TO 5",'PRINT USING "For Number #"; i%',"NEXT i%"],ds=["DIM i%","LET i%=0","WHILE i% < 5",'PRINT USING "While Number #"; i%',"LET i% = i% + 1","WEND"],ps=["DIM duration","LET duration = 2500",'PRINT USING "Start with Pause #ms"; duration',"PAUSE duration",'PRINT "End Pause"','PRINT USING "Start with Sleep #ms"; duration',"PAUSE duration",'PRINT "End Sleep"'],hs={Fibonacci:rs,Area:ss,Circle:as,"Your Name":["CLS",'PRINT "What is your name?"',"INPUT n$",'PRINT "What is your shoe size?"',"INPUT size",'PRINT "Hello "; n$','PRINT USING "your shoe size is ##.##"; size',"END"],GuessTheNumber:ns,Factorial:is,Pyramid:os,"Bubble Sort":["CLS","READ max","DIM SHARED numbers(max)","SUB CreateList(max) STATIC","FOR i=1 TO max","LET numbers(i) = INT(RND * 100)","NEXT i","END SUB","SUB PrintList(max) STATIC","FOR i=1 TO max","PRINT numbers(i)","NEXT i","END SUB","SUB SwapValues(i%, j%) STATIC","LET numbers(i%) = numbers(i%) XOR numbers(j%)","LET numbers(j%) = numbers(i%) XOR numbers(j%)","LET numbers(i%) = numbers(i%) XOR numbers(j%)","END SUB","SUB Sort(max) STATIC","FOR i%=1 TO (max - 1)","FOR j%=i% TO max","IF numbers(i%)>numbers(j%) THEN","CALL SwapValues(i%, j%)","END IF","NEXT j%","NEXT i%","END SUB","CreateList(max)","Sort(max)","PrintList(max)","DATA 10","END"],Goto:cs,Vars:ls,If:us,For:ms,"For Step":["CLS","FOR i% = 0 TO 6 STEP 2",'PRINT "For Step Number #"; i%',"NEXT i%"],While:ds,Pause:ps},fs=ke(({module:n,core:e})=>[{name:["basic"],args:[new b({index:0,name:"path",description:"Path to basic script"})],async action({path:t},r){var s;if(!t)throw k.get("bad_args");const a=await((s=e.modules.files)==null?void 0:s.fileSystem.get(t));if(typeof(a==null?void 0:a.data)=="object"){const i=a.data;if(i.type==="basic"&&Array.isArray(i.content))return n.parseBasic(i.content,void 0,{logger:r.logger})}else throw new Error(`Can't read file ${t}`)}},{name:["basicExamples"],args:[new b({index:0,name:"name",description:"Name from example"})],action({name:t}){return n.parseBasic(hs[String(t)])}}]);class gs extends _e{constructor({core:t}){super({name:"Parser",commands:r=>[...fs(r)],core:t});f(this,"basicInterpreter");f(this,"memory",C(new Je));f(this,"mathParser",C(new Jr(this.memory)));f(this,"commandParser",C(new O));this.basicInterpreter=C(new qr(this.memory,t.executeCommand.bind(t)))}parse(t,r,a){return this.basicInterpreter.parse(t,r,a)}parseBasic(t,r,a={}){let s=t;return Array.isArray(t)||(s=t.split(`
`)),this.basicInterpreter.parse(s,r,a)}async parseCommand(t){return this.commandParser.parse(t)}parseMath(t){return this.mathParser.parse(t)}isMathValue(t){return this.mathParser.validInput(t)}}const ws=qe(({core:n})=>{const e=n.modules.symbols,t=n.modules.windows,r=Ee({open:{disabled:!1},edit:{disabled:!1},duplicate:{disabled:!1},container:{disabled:!1},emptyTrashcan:{disabled:!1},discard:{disabled:!1},info:{disabled:!1},itemLink:{disabled:!1},itemLinkNew:{disabled:!1},itemLinkEdit:{disabled:!1},webLink:{disabled:!1},webLinkNew:{disabled:!1},webLinkEdit:{disabled:!1}});function a(){const h=e.getSelectedItems()||[],p=e.getPrimaryWrapper();r.info.disabled=h.length<1,r.open.disabled=h.length<1,r.edit.disabled=h.length<1||!!h.find(d=>(d==null?void 0:d.locked)||d instanceof Re),r.duplicate.disabled=h.length<1||!!h.find(({fsItem:d})=>(d==null?void 0:d.locked)||d instanceof Re||d instanceof nt),r.container.disabled=!r.open.disabled||!(p instanceof Se&&p.fsItem&&(p.fsItem instanceof Bt||!p.fsItem.locked))||!p,r.itemLinkEdit.disabled=h.length<1||!!h.find(d=>{var w;return!((w=d==null?void 0:d.fsItem)!=null&&w.meta.get(R.REFERENCE))}),r.itemLinkNew.disabled=r.container.disabled,r.itemLink.disabled=r.itemLinkNew.disabled&&r.itemLinkEdit.disabled,r.webLinkEdit.disabled=h.length<1||!!h.find(d=>{var w;return!((w=d==null?void 0:d.fsItem)!=null&&w.meta.get(R.WEB_URL))}),r.webLinkNew.disabled=r.container.disabled,r.webLink.disabled=r.webLinkNew.disabled&&r.webLinkEdit.disabled,r.emptyTrashcan.disabled=h.length<1||!!h.find(d=>!((d==null?void 0:d.fsItem)instanceof Re)),r.discard.disabled=h.length<1||!!h.find(({fsItem:d})=>(d==null?void 0:d.locked)||d instanceof Re||d instanceof nt)}return e.events.subscribe(()=>a()),a(),[new S({order:1,title:"File",items:[new S({title:"Open",options:r.open,action:s}),new S({title:"Edit",options:r.edit,action:E}),new ie,new S({title:"Link",options:r.itemLink,items:[new S({title:"New",options:r.itemLinkNew,action:c}),new S({title:"Edit",options:r.itemLinkEdit,action:u})]}),new S({title:"Web Link",options:r.webLink,items:[new S({title:"New",options:r.webLinkNew,action:m}),new S({title:"Edit",options:r.webLinkEdit,action:g})]}),new ie,new S({title:"Duplicate",options:r.duplicate,action(){const h=e.getSelectedItems()||[];return Promise.all(h.filter(p=>p.fsItem).map(async({fsItem:p})=>{const d=await(p==null?void 0:p.getPath());return n.executeCommand(`copy "${d}" "${d}" -ignore`)}))}}),new S({title:"Make Dir",options:r.container,async action(){var p;const h=(p=e.getPrimaryWrapper())==null?void 0:p.fsItem;if(h){const d=Ft(await h.getPath(),"Directory");return console.log(`makedir "${d}" -ignore`),n.executeCommand(`makedir "${d}" -ignore`)}else throw new Error("No item found")}}),new ie,new S({title:"Discard",options:r.discard,action(){const h=e.getSelectedItems()||[];return Promise.all(h.filter(p=>p.fsItem).map(async({fsItem:p})=>{const d=await(p==null?void 0:p.getPath());return n.executeCommand(`remove "${d}" -r`)}))}}),new S({title:"Empty Trashcan",options:r.emptyTrashcan,action(){const h=e.getSelectedItems()||[];return Promise.all(h.filter(p=>p.fsItem).map(async({fsItem:p})=>{const d=await(p==null?void 0:p.getItems())||[];return Promise.all(Array.from(d.values()).map(async w=>{const v=await w.getPath();return n.executeCommand(`remove "${v}" -r -ignore`)}))}))}}),new ie,new S({title:"Info",options:r.info,async action(){const h=e.getSelectedItems()||[];await Promise.all(h.filter(p=>p.fsItem).map(async p=>{if(p.fsItem){const d=await H(()=>import("./Dpn7fjjX.js"),__vite__mapDeps([32,33,18,19,1,20,21,34]),import.meta.url).then(w=>w.default);t.addWindow({component:d,componentData:{fsItem:C(p.fsItem)},layout:{size:vt(460,280)},options:{title:`Info File ${p.fsItem.name}`,scaleX:!0,scaleY:!0,prompt:!1,scrollX:!0,scrollY:!0}})}else throw new Error(`Item has no fsItem. ${p.id}`)}))}})]})];function s(){(e.getSelectedItems()||[]).filter(p=>p.fsItem).forEach(p=>{if(p.command){const d={showCommand:!1,show:!0},w=or(p.command);if(!w)throw new Error(`No command found for item ${p.id}`);return n.executeCommand(w,d)}})}async function i({name:h,path:p,symbol:d},w){if(w||(w=await n.executeCommand(`saveFileDialog --id="${it(h)}"`)),w){const v=n.addExecution();try{const A=w.getPath();await n.executeCommand(`rename "${A}" "${h}" -n`),await n.executeCommand(`editfilemeta "${A}" "${R.REFERENCE}" "${p}"`),await n.executeCommand(`editfilemeta "${A}" "${R.SYMBOL}" "${d}"`)}catch(A){throw v(),A}return v(),!0}return!1}async function o({name:h,url:p,symbol:d},w){if(w||(w=await n.executeCommand(`saveFileDialog --id="${it(h)}"`)),w){const v=n.addExecution();try{const A=w.getPath();await n.executeCommand(`rename "${A}" "${h}" -n`),await n.executeCommand(`editfilemeta "${A}" "${R.WEB_URL}" "${p}"`),await n.executeCommand(`editfilemeta "${A}" "${R.SYMBOL}" "${d}"`)}catch(A){throw v(),A}return v(),!0}return!1}async function c(){const h=await H(()=>import("./qMKjp9Ux.js"),__vite__mapDeps([35,6,1,7,14,15,16,17,36,8,9,37,38,12,13,4,18,19,20,21,39]),import.meta.url).then(d=>d.default);return t.addWindow({component:h,componentData:{model:{actions:{save:i,selectItem:()=>n.executeCommand(`openFileDialog --type=${pt.BOTH}`)},name:null,url:null,symbol:"default"}},options:{title:"Make Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}async function u(){const h=e.getSelectedItems();await Promise.all(h.filter(p=>p.fsItem).map(async p=>{const d=p.fsItem;if(d){const w=await H(()=>import("./qMKjp9Ux.js"),__vite__mapDeps([35,6,1,7,14,15,16,17,36,8,9,37,38,12,13,4,18,19,20,21,39]),import.meta.url).then(v=>v.default);t.addWindow({component:w,componentData:{fsItem:C(d),model:{actions:{save:i,selectItem:()=>n.executeCommand(`openFileDialog --type=${pt.BOTH}`)},name:d.name,path:d.meta.get(R.REFERENCE),symbol:d.meta.get(R.SYMBOL)}},options:{title:"Edit Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}else throw new Error(`Item has no fsItem. ${p.id}`)}))}async function m(){const h=await H(()=>import("./Cnjlk9Ir.js"),__vite__mapDeps([40,6,1,7,14,15,16,17,36,8,9,37,38,12,13,4,18,19,20,21,41]),import.meta.url).then(d=>d.default);return t.addWindow({component:h,componentData:{model:{actions:{save:o},name:null,url:null,symbol:"default"}},options:{title:"Make Web Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}async function g(){const h=e.getSelectedItems();await Promise.all(h.filter(p=>p.fsItem).map(async p=>{const d=p.fsItem;if(d){const w=await H(()=>import("./Cnjlk9Ir.js"),__vite__mapDeps([40,6,1,7,14,15,16,17,36,8,9,37,38,12,13,4,18,19,20,21,41]),import.meta.url).then(v=>v.default);t.addWindow({component:w,componentData:{fsItem:C(d),model:{actions:{save:o},name:d.name,url:d.meta.get(R.WEB_URL),symbol:d.meta.get(R.SYMBOL)}},options:{title:"Edit Web Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}else throw new Error(`Item has no fsItem. ${p.id}`)}))}async function E(){return ar(n)}}),Be=new Map;class bs extends Ut{constructor(){super(...arguments);f(this,"modules");f(this,"services");f(this,"app")}get name(){var t;return(t=this.app)==null?void 0:t.name}async connect(t,{apiKey:r,url:a}){if(this.modules=await Et.get(),this.app)Be.has(t)&&(this.app=Be.get(t));else{const s=this.modules.app.initializeApp({apiKey:r,databaseURL:a},t);Be.set(s.name,s),this.app=s}return this.app}async disconnect(){var t;if(!this.app)throw k.get("FirebaseWrapper_noApp");he(this),await this.logout(),await((t=this.modules)==null?void 0:t.app.deleteApp(this.app)),this.app=void 0}get locked(){return!!this.app&&!this.isLogged()}get currentUser(){var t;if((t=this.modules)!=null&&t.auth){const{getAuth:r}=this.modules.auth;return r(this.app).currentUser}}isLogged(){return!!this.app&&!!this.currentUser}login(t,r){var a;if((a=this.modules)!=null&&a.auth){const{getAuth:s,signInWithEmailAndPassword:i}=this.modules.auth,o=s(this.app);return he(this),i(o,t,r)}}logout(){var t;if(this.app&&((t=this.modules)!=null&&t.auth)){const{getAuth:r,signOut:a}=this.modules.auth,s=r(this.app);return a(s)}else throw k.get("FirebaseWrapper_notConnected")}remove(t){var r;if(he(this),(r=this.modules)!=null&&r.database){const{remove:a,ref:s,getDatabase:i}=this.modules.database,o=i(this.app),c=s(o,t);return a(c)}}get(t){var r;if(he(this),(r=this.modules)!=null&&r.database){const{ref:a,onValue:s,getDatabase:i}=this.modules.database,o=i(this.app),c=a(o,t);let u;return new Promise(m=>{u=s(c,g=>m(g.val()))}).then(m=>(u&&u(),m))}}async set(t,r){var a;if(he(this),(a=this.modules)!=null&&a.database){const{ref:s,set:i,getDatabase:o}=this.modules.database,c=o(this.app),u=s(c,t);return await i(u,r),r}}}function he(n){if(!n.app)throw k.get("FirebaseWrapper_notConnected")}k.add([["FirebaseWrapper_notConnected",["Not connected","Not connected"]],["FirebaseWrapper_noApp",["No app available","No app available"]],["FirebaseWrapper_hasApp",["App already available",'App "%1" already available']]]);class Es extends Xt{constructor(e){super({...e,storage:new bs})}async mount(e){if(e.onDisconnect=()=>{this.unmount()},this.storage)return await this.storage.connect(e.id,{apiKey:e.apiKey,url:e.url}),this;throw new Error("no storage")}async unmount(){if(this.storage)return await this.storage.disconnect(),this;throw new Error("no storage")}async load(){if(this.storage){let e=await this.storage.get(this.name);return e||(e={},this.storage.locked||await this.storage.set(this.name,e)),this.data=e,e}else throw new Error("no storage")}async save(e){if(this.storage)return e=Ct(e),this.data=e||this.data,await this.storage.set(this.name,e),this.data;throw new Error("no storage")}get locked(){var e;return((e=this.storage)==null?void 0:e.locked)||!1}}function Ct(n){return Object.fromEntries(Object.entries(n).filter(([,e])=>e||typeof e=="number"||typeof e=="boolean").map(([e,t])=>(t&&typeof t=="object"&&(t=Ct(t)),[e,t])))}const fe=new Map,Ss=ke(({module:n,core:e})=>{const{fileSystem:t}=n;return[{name:"cloudList",args:[new b({name:"json",flag:!0,description:"Get JSON Export"})],action({json:r},a){const s=Array.from(fe.values());if(r)return Promise.resolve(s);{const i=new Xe;return i.addColumns([{value:"Storage (Id)",align:"left",minWidth:15},{value:"Name",align:"left",minWidth:15},{value:"Logged In",align:"center",minWidth:9}]),i.addRows(s.reduce((o,c)=>(o.push([c.id,c.name,c.storage.storage.isLogged()?"yes":"no"]),o),[])),a.message([i]),Promise.resolve()}}},{name:"cloudMountFirebase",args:[new b({index:0,name:"id",flag:!0,description:"Id from Storage."}),new b({index:1,name:"apiKey",description:"Firebase Api-Key."}),new b({index:2,name:"url",description:"Firebase Database-Url."})],async action({id:r,apiKey:a,url:s},i){if(!a||!s)throw k.get("bad_args");const o=e.addExecution(),c=await t.connect(Es,{id:r,apiKey:a,url:s});return fe.set(c.id,c),i.message(`Mount <strong>${c.name}</strong> <strong>(${c.id})</strong> successful!`),o(),c}},{name:"cloudUnmount",args:[new b({index:0,name:"id",flag:!0,description:"Id from Storage."})],async action({id:r},a){if(!r)throw k.get("bad_args");const s=e.addExecution();try{const i=fe.get(r);await t.disconnect(i),fe.delete(i.id),a.message(`Unmount "${i.name}" successful!`),s()}catch(i){throw s(),i}}},{name:"cloudAuth",args:[new b({name:"login",flag:!0,description:"Storage Login"}),new b({name:"logout",flag:!0,description:"Logout from Storage."}),new b({name:"email",description:"Email for Login."}),new b({name:"password",description:"Password for Login."}),new b({name:"storage",description:"Specifies which drive is logged on."})],async action({email:r,password:a,storage:s,login:i,logout:o},c){const u=s;if(!u)throw k.get("bad_args");const m=e.addExecution(),g=fe.get(u);let E;if(g)try{if(i){if(!r||!a)throw k.get("bad_args");E=await g.storage.storage.login(r,a),c.message(`Login with ${g.id} (${g.id}) successful!`)}else o&&(E=await g.storage.storage.logout(),c.message(`Logout from ${g.id} (${g.id}) successful!`))}catch(h){if(m(),h instanceof Error&&"code"in h){switch(h.code){case"auth/user-not-found":case"auth/wrong-password":return h}throw h}}else throw new Error(`${u} is not mounted.`);return m(),E}}]}),wt=C(new Yt("web_workbench_FS"));class Dt extends _e{constructor({core:t}){super({name:"Files",commands:({module:r,core:a})=>[...nr({module:r,core:a}),...ir({module:r}),...Ss({module:r,core:a})],contextMenu:ws,core:t});f(this,"fileSystem",wt);f(this,"fs",wt);f(this,"disks",{})}addDisks(t){[...t].sort((r,a)=>r.order>a.order?1:r.order<a.order?-1:0).forEach(r=>{this.disks[r.name]=r})}}f(Dt,"NAME","Files");class ys{constructor(e){f(this,"defaultItems",new He);f(this,"activeItems");f(this,"core");this.core=e,this.activeItems=this.defaultItems}addDefaultItems(e){this.defaultItems.add(e)}getActiveItems(){return this.activeItems}setActiveItems(e){return this.activeItems=e||this.defaultItems}}const Is=qe(({core:n})=>{const{windows:e}=n.modules;return[new S({order:0,title:"Web-Workbench",items:[new S({title:"Settings",action(){return n.executeCommand("openSettings")}}),new ie,new S({hotKey:{alt:!0,code:"KeyI",title:"I"},title:"Info",async action(){const t=await H(()=>import("./DdYgkxZ_.js"),__vite__mapDeps([42,43,19,1,20,21,44,18,45]),import.meta.url).then(r=>r.default);e==null||e.addWindow({component:t,componentData:{},options:{title:"Info",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}}),new ie,new S({title:"Imprint",action(){return n.executeCommand('execute "Imprint.md"')}}),new S({title:"Disclaimer",action(){return n.executeCommand('execute "Disclaimer.md"')}})]})]}),vs={xmlns:"http://www.w3.org/2000/svg",width:"6",height:"10",viewBox:"0.5 50.5 6 10"};function Ns(n,e){return K(),oe("svg",vs,e[0]||(e[0]=[Z("path",{fill:"#020203",d:"M.5 50.5h6v2h-4v2h2v2h-2v4h-2z"},null,-1)]))}const As={render:Ns},Ts={xmlns:"http://www.w3.org/2000/svg",width:"6",height:"10"};function $s(n,e){return K(),oe("svg",Ts,e[0]||(e[0]=[Z("path",{d:"M0 10h6V8H2V6h2V4H2V2h4V0H0z"},null,-1)]))}const Ps={render:$s},Rs={class:"icon full"},Cs={class:"icon empty"},Ds=yt({__name:"StorageBar",props:{visible:{type:Boolean,default:!0},value:{type:Number,default:.8}},setup(n){const e=n,t=je(()=>({"--bar-height":Math.min(e.value,1)}));return(r,a)=>n.visible?(K(),oe("div",{key:0,class:"wb-env-element-storage-bar",style:Zt(t.value)},[Z("div",null,[Z("div",Rs,[Le(ct(As))]),a[0]||(a[0]=Z("span",{class:"size"},[Z("span",{class:"helper"})],-1)),Z("div",Cs,[Le(ct(Ps))])])],4)):ge("",!0)}}),Ls=It(Ds,[["__scopeId","data-v-963a1798"]]),xs={class:"wb-env-fragment-dialog-content"},Ws=["innerHTML"],Os={key:1,class:"input"},ks=yt({__name:"DialogContent",props:{message:{type:String,default(){return"Dialog Message"}},confirm:{type:Boolean,default:!1},prompt:{type:Boolean,default:!1},promptType:{type:String,default:"text"},promptStep:{type:Number,default:void 0},promptValue:{type:String,default:""},password:{type:Boolean,default:!1},apply:{type:Function,default(){return null}},abort:{type:Function,default(){return null}},applyLabel:{type:String,default(){return"Continue"}},abortLabel:{type:String,default(){return"Cancel"}},yesLabel:{type:String,default(){return"Yes"}},noLabel:{type:String,default(){return"No"}}},emits:["apply","abort"],setup(n,{emit:e}){const t=n,r=e,a=Qt(t.promptValue),s=je(()=>t.password?"password":t.promptType),i=je(()=>t.message.replace(/\\n|\n/g,"<br>")),o=()=>{const u=a.value||!0;typeof t.apply=="function"?t.apply(u):r("apply",u)},c=()=>{typeof t.abort=="function"?t.abort():r("abort")};return(u,m)=>(K(),oe("div",xs,[Z("div",null,[n.message?(K(),oe("p",{key:0,innerHTML:i.value},null,8,Ws)):ge("",!0),n.prompt?(K(),oe("div",Os,[Le(lr,{ref:"dialogInput",modelValue:a.value,"onUpdate:modelValue":m[0]||(m[0]=g=>a.value=g),step:n.promptStep,type:s.value,label:null},null,8,["modelValue","step","type"])])):ge("",!0),Le(ur,{align:n.abortLabel?"outer":"center",class:"buttons"},{default:qt(()=>[n.applyLabel||n.confirm&&n.yesLabel?(K(),lt(ht,{key:0,"style-type":"dialog",label:n.confirm?n.yesLabel:n.applyLabel,onClick:o},null,8,["label"])):ge("",!0),n.abortLabel||n.confirm&&n.noLabel?(K(),lt(ht,{key:1,"style-type":"dialog",label:n.confirm?n.noLabel:n.abortLabel,onClick:c},null,8,["label"])):ge("",!0)]),_:1},8,["align"])])]))}}),_s=It(ks,[["__scopeId","data-v-0fa943a5"]]),Ms=ke(({module:n,core:e})=>{var s;const t=(s=e.modules.files)==null?void 0:s.fs,r=e.modules.symbols,a=e.modules.windows;return[{name:["openDirectory","openDir"],description:"Opens the specified directory.",args:[new b({index:0,name:"path",description:"Path to the directory."}),new b({name:"sortSymbols",description:"Sort Symbols",flag:!0}),new b({name:"windowSize",description:"Window Size"}),new b({name:"windowPosition",description:"Window Position"}),new b({name:"windowScale",description:"Window Scale"}),new b({name:"windowScrollX",description:"Window Scroll-X"}),new b({name:"windowScrollY",description:"Window Scroll-Y"}),new b({name:"windowSidebar",description:"Window Sidebar"}),new b({name:"windowFullSize",description:"Window Full-Size"})],async action(i){const{path:o,sortSymbols:c,windowSize:u,windowPosition:m,windowScale:g,windowScrollX:E,windowScrollY:h,windowSidebar:p,windowFullSize:d}=i;if(!o)throw k.get("bad_args");const w=await(t==null?void 0:t.get(o));if(!w)throw k.get("FileSystemItem_itemNotFound",o);if(!(w instanceof jt))throw k.get("FileSystemItem_itemNotContainer",o);const v=await(r==null?void 0:r.addFileSystemWrapper(w)),A=r==null?void 0:r.getWrapper(String(v)),me=Ee({value:w.size/w.maxSize}),de=Me=>{const[$e,pe]=Me.split(",");return vt(Number($e),Number(pe))},Y=a==null?void 0:a.addWindow({layout:{size:de(u||"400,200"),position:de(m||"0,0")},sidebarComponent:Ls,sidebarComponentData:me,component:zt,componentData:{wrapperId:v,parentScrollable:E||h},options:{title:w.name,sidebar:p!==void 0?p:!0,scale:g!==void 0?g:!0,scrollX:E!==void 0?E:!0,scrollY:h!==void 0?h:!0,center:!m}},{active:!0,full:d}),et=()=>{me.value=w.size/w.maxSize},xt=[A==null?void 0:A.events.subscribe(et)];return new Promise(Me=>{Y==null||Y.events.subscribe(({name:$e})=>{$e==="ready"&&c?window.requestAnimationFrame(()=>{A==null||A.rearrangeIcons()}):$e==="close"?(xt.forEach(pe=>pe==null?void 0:pe.unsubscribe()),v&&(r==null||r.removeWrapper(v)),Me(!0)):et()})})}},{name:["openDialog"],description:"Open a Dialog.",args:[new b({index:0,name:["message"],description:"Message from Dialog."}),new b({index:1,name:["title"],description:"Title from Dialog."}),new b({name:["apply"],description:"Title from apply button."}),new b({name:["abort"],description:"Title from abort button."}),new b({name:["confirm"],flag:!0,description:"Defines the confirm dialog"}),new b({name:["prompt"],flag:!0,description:"Defines the prompt dialog"}),new b({name:["promptType"],description:"Type from prompt dialog (e.g. text, number, email). (Default: text)"}),new b({name:["promptStep"],description:"Step from prompt dialog (e.g. 1, 0.1, 0.01). (Default: 1)"}),new b({name:["promptValue"],description:"Default value from prompt dialog."}),new b({name:["secret"],flag:!1,description:"Input is illegible."})],action:i=>{const{title:o,message:c=null,apply:u=null,abort:m=null,confirm:g=!1,prompt:E=!1,promptType:h="text",promptStep:p=void 0,promptValue:d=null,secret:w=!1}=i;let v;const A=Y=>{v(Y)},me=()=>{v(!1)},de=n.addWindow(new ze({component:_s,componentData:{title:o,message:c,secret:w,confirm:g,prompt:E,promptType:h,promptStep:Number(p),promptValue:d,applyLabel:u||"Continue",abortLabel:m,apply:A,abort:me},options:{scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1,close:!1}}));return de.awaitClose().then(()=>me()),new Promise(Y=>{v=Y}).then(Y=>(de.close(),Y))}}]});class Vs extends _e{constructor(t){super({config:mr,commands:Ms,...t,name:"Windows"});f(this,"wrappers",C(new Map));f(this,"contentWrapper");f(this,"globalWrapper");f(this,"contextMenu");this.contextMenu=Ee(new ys(this.core));const r=this.getWrapper(this.addWrapper(new dt(this.core)));if(!r)throw new Error("Content wrapper not found");this.contentWrapper=r;const a=this.getWrapper(this.addWrapper(new dt(this.core)));if(!a)throw new Error("Global wrapper not found");this.globalWrapper=a,Tr({contentWrapper:this.contentWrapper.events,globalWrapper:this.globalWrapper.events}).subscribe(s=>{console.log("event",s)})}addWindow(t,r){let a;return t instanceof ze?a=t:a=new ze(t),r={global:!1,...r},r.global?a=this.globalWrapper.add(a,r):a=this.contentWrapper.add(a,r),a.focus(),a}getWrapper(t){return this.wrappers.get(t)}getFocusedWrapper(){return Array.from(this.wrappers.values()).map(({models:t})=>t).flat().find(t=>t.options.focused)}addWrapper(t){return this.wrappers.set(t.id,Ee(t)),t.id}removeWrapper(t){typeof t!="string"&&(t=t.id),this.wrappers.delete(t)}isContextMenu(t){return t.id===this.getActiveContextMenu().id}setup(){this.contextMenu.addDefaultItems(new He(Is,{core:this.core})),this.contextMenu.addDefaultItems(new He(cr,{core:this.core}))}clear(){this.contentWrapper.clear(),this.globalWrapper.clear()}getActiveContextMenu(){return this.contextMenu.getActiveItems()}setActiveContextMenu(t){return this.contextMenu.setActiveItems(t)}}const Fs=qe(({module:n,core:e})=>[new S({order:30,title:"Symbol",items:[new S({type:ee.CHECKBOX,title:"Show Invisible Symbols",model:e.config.observable,name:$.SHOW_INVISIBLE_SYMBOLS,action({checked:t}){return e.config.set($.SHOW_INVISIBLE_SYMBOLS,t)}}),new S({title:"Rearrange Symbols",hotKey:{alt:!0,code:br.KEY_R,title:"R"},action(){const t=n.getDefaultWrapper(),r=n.getPrimaryWrapper();if(r instanceof Se&&(r==null?void 0:r.id)!==(t==null?void 0:t.id)){if(r==null||r.rearrangeIcons(),r!=null&&r.fsItem)return De(r==null?void 0:r.fsItem);throw new Error("No fsItem found")}else if(t instanceof Se){if(t==null||t.rearrangeIcons({root:!0}),t!=null&&t.fsItem)return De(t==null?void 0:t.fsItem);throw new Error("No fsItem found")}}}),new S({title:"Order Type",items:[new S({model:e.config.observable,type:ee.RADIO,name:$.ORDER_TYPE,value:j.NAME,title:"Name",action(){return e.config.set($.ORDER_TYPE,j.NAME)}}),new S({model:e.config.observable,type:ee.RADIO,name:$.ORDER_TYPE,value:j.TYPE,title:"Type",action(){return e.config.set($.ORDER_TYPE,j.TYPE)}}),new S({model:e.config.observable,type:ee.RADIO,name:$.ORDER_TYPE,value:j.CREATED_DATE,title:"Created Date",action(){return e.config.set($.ORDER_TYPE,j.CREATED_DATE)}}),new S({model:e.config.observable,type:ee.RADIO,name:$.ORDER_TYPE,value:j.EDITED_DATE,title:"Edited Date",action(){return e.config.set($.ORDER_TYPE,j.EDITED_DATE)}})]}),new S({title:"Order Direction",items:[new S({model:e.config.observable,type:ee.RADIO,name:$.ORDER_DIRECTION,value:we.ASCENDING,title:"Ascending",action(){return e.config.set($.ORDER_DIRECTION,we.ASCENDING)}}),new S({model:e.config.observable,type:ee.RADIO,name:$.ORDER_DIRECTION,value:we.DESCENDING,title:"Descending",action(){return e.config.set($.ORDER_DIRECTION,we.DESCENDING)}})]})]})]),Bs=({module:n})=>[{name:["rearrangeIcons"],description:"Rearrange Icons",args:[new b({name:"id",description:"Wraper id"}),new b({name:"root",description:"Use root wrapper",flag:!0}),new b({name:"force",description:"Force rearrangement",flag:!0})],async action({id:e,root:t,force:r}){const a=n.getDefaultWrapper(),s=n.getPrimaryWrapper();if(await new Promise(i=>window.requestAnimationFrame(i)),t){if(a.fsItem)return a==null||a.rearrangeIcons({root:!0,force:r}),De(a.fsItem);throw new Error("No fsItem found")}else{let i=s;if(e&&(i=n.get(e),i instanceof Se&&i.fsItem))return i.rearrangeIcons({force:r}),De(i.fsItem)}}}];function Us(){return{[$.SHOW_INVISIBLE_SYMBOLS]:!1,[$.ORDER_TYPE]:j.NAME,[$.ORDER_DIRECTION]:we.ASCENDING}}class Xs extends Ce{}class Lt extends _e{constructor(t){const{core:r}=Object.assign({core:null},t);super({name:"Symbols",config:Us(),commands:Bs,contextMenu:Fs,core:r});f(this,"events",C(new Ge));f(this,"symbols",C(new Map));f(this,"wrappers",C(new Map));f(this,"wrappersObservable",{});f(this,"hasSelectedItems",!1);f(this,"_activeWrapper");f(this,"_defaultWrapper");f(this,"activeWrapper");f(this,"defaultWrapper");f(this,"primaryWrapper");f(this,"secondaryWrapper")}addWrapper(t){return t=C(t),this.wrappers.set(t.id,t),this.wrappersObservable[t.id]=t,t.events.subscribe(this.onEventWrapper.bind(this)),t.id}onEventWrapper({name:t,value:r}){var a;r!=null&&r.wrapper&&(t==="selectItem"||t==="unselectItem")&&(this.hasSelectedItems=((a=r==null?void 0:r.wrapper.selectedItems.value)==null?void 0:a.length)>0,this.events.next(new Xs({name:"hasSelectedItems",value:this.hasSelectedItems})))}getWrapper(t){return typeof t!="string"&&(t=t.id),this.wrappers.get(t)}removeWrapper(t){typeof t!="string"&&(t=t.id),this.wrappers.delete(t),Reflect.deleteProperty(this.wrappersObservable,t)}getActiveWrapper(t=!1){var a,s,i;const r=(a=this.core.modules.windows)==null?void 0:a.contentWrapper.getActiveWindow();return r&&((s=r.componentData)!=null&&s.symbolWrapper)?(i=r.componentData)==null?void 0:i.symbolWrapper:t?null:this.activeWrapper}getSelectedItems(){return Array.from(this.wrappers.values()).reduce((t,r)=>(r.selectedItems.value.forEach(s=>{const i=r.get(s);i&&t.push(i)}),t),[])}clearSelectedItems(){return Array.from(this.wrappers.values()).forEach(t=>{t.clearSelectedItems()})}async addFileSystemWrapper(t,r=!1){const a=new Se(this.core,void 0,r);return await a.setup(t),this.addWrapper(a)}async setup(){var r;const t=(r=this.core.modules.files)==null?void 0:r.fs.root;t&&(this.addSymbols(await er()),this.setDefaultWrapper(await this.addFileSystemWrapper(t,!0)))}get(t){return this.wrappers.get(t)}setDefaultWrapper(t){this._defaultWrapper=t;const r=this.wrappers.get(t);r&&(this.primaryWrapper=r,this.secondaryWrapper=r,this.activeWrapper=r,this.defaultWrapper=r)}getDefaultWrapper(){return this.defaultWrapper}getPrimaryWrapper(){return this.primaryWrapper||this.defaultWrapper}getSecondaryWrapper(){return this.secondaryWrapper||this.defaultWrapper}setPrimaryWrapper(t){if(t){let r;t instanceof Ve?r=t.id:r=t,this.primaryWrapper=this.wrappers.get(r)}else this.primaryWrapper=void 0;this.events.next(new Ce({name:"setPrimaryWrapper",value:this.getPrimaryWrapper()}))}setSecondaryWrapper(t){if(t){let r;t instanceof Ve?r=t.id:r=t,this.secondaryWrapper=this.wrappers.get(r)}else this.primaryWrapper=void 0;this.events.next(new Ce({name:"setSecondaryWrapper",value:this.secondaryWrapper}))}setActiveWrapper(t){let r;t instanceof Ve?r=t.id:r=t;let a=this.wrappers.get(this._activeWrapper||"");return r!==this._activeWrapper&&(this._activeWrapper=r,this.activeWrapper=this.wrappers.get(this._activeWrapper),a=this.activeWrapper||this.wrappers.get(this._defaultWrapper||""),this.events.next(new Ce({name:"setActiveWrapper",value:a}))),a}addSymbol(t){this.symbols.set(t.key,t)}addSymbols(t){t.forEach(r=>{this.addSymbol(r)})}removeSymbol(t){this.symbols.delete(t)}}f(Lt,"NAME","Symbols");function Ys(){const n=new Ke;return n.addModule(gs),n.addModule(Dt),n.addModule(Vs),n.addModule(Ht),n.addModule(Lt),n}const Xa=Ys();export{Xa as default};
