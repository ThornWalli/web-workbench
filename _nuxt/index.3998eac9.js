var Ht=Object.defineProperty;var Mt=(r,t,e)=>t in r?Ht(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var T=(r,t,e)=>(Mt(r,typeof t!="symbol"?t+"":t,e),e),Et=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var f=(r,t,e)=>(Et(r,t,"read from private field"),e?e.call(r):t.get(r)),D=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},S=(r,t,e,s)=>(Et(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e);import{Y as Yt,Z as Wt,G as zt,$ as kt,H as At,T as Gt,g as p,n as gt,e as Zt,a0 as jt,V as A,X as y,a1 as Kt,S as Rt,b as x,N as ut,a2 as Xt,a3 as wt,h as at,a4 as k}from"./index.0712caa6.js";import{W as rt,F as v,A as $t,E as M,r as Vt}from"./entry.9fb9bafb.js";import{p as Jt}from"./index.56665add.js";import{v as qt}from"./viewport.8757096e.js";import{c as P}from"./math.571b3f1f.js";import{b as Qt,a as te}from"./async.8020bbf7.js";function ee(r){return r&&Yt(r.schedule)}function se(r){return r instanceof Date&&!isNaN(r)}function re(r,t,e){r===void 0&&(r=0),e===void 0&&(e=Qt);var s=-1;return t!=null&&(ee(t)?e=t:s=t),new Wt(function(a){var i=se(r)?+r-e.now():r;i<0&&(i=0);var n=0;return e.schedule(function(){a.closed||(a.next(n++),0<=s?this.schedule(void 0,s):a.complete())},i)})}function ae(r,t){return zt(function(e,s){var a=t??{},i=a.leading,n=i===void 0?!0:i,h=a.trailing,d=h===void 0?!1:h,c=!1,_=null,l=null,o=!1,b=function(){l==null||l.unsubscribe(),l=null,d&&(I(),o&&s.complete())},u=function(){l=null,o&&s.complete()},E=function(C){return l=kt(r(C)).subscribe(At(s,b,u))},I=function(){if(c){c=!1;var C=_;_=null,s.next(C),!o&&E(C)}};e.subscribe(At(s,function(C){c=!0,_=C,!(l&&!l.closed)&&(n?I():E(C))},function(){o=!0,!(d&&c&&l&&!l.closed)&&s.complete()}))})}function ie(r,t,e){t===void 0&&(t=te);var s=re(r,t);return ae(function(){return s},e)}const ne=new Gt("Black Contrast",{colors:{screen:{background:"#000"},header:{background:"#000",coverBackground:"#000",coverTitle:"#fff",title:"#fff"},windowHeader:{background:"#000",stripes:"#fff",title:"#fff",buttonBackground:"#fff",buttonPrimary:"#000",buttonSecondary:"#fff"},contextMenu:{border:"#fff"},contextMenuItem:{background:"#000",label:"#fff",indicatorContext:"#fff",hotkey:"#fff"},contextMenuSeparator:{background:"#fff"},window:{text:"#fff",background:"#000",border:"#fff",borderScaling:"#fff",helper__scaleBackground:"#000",helper__scaleIcon:"#fff",helper__scaleIconActive:"#fff"},scrollContent:{scrollbarCorner:"#000",scrollbarSpacer:"#fff",scrollbarBackground:"#000",scrollbarHelperBackground:"#000",scrollbarHelper:"#fff",scrollbarHelperActive:"#fff",scrollbarRange:"#000"},symbolWrapperItem:{text:"#fff"},textbox:{text:"#fff",background:"#000",border:"#000",outline:"#fff",dialog:{text:"#fff",background:"#000",border:"#000",outline:"#fff"},disabledReadonlyText:"#AAA",disabledReadonlyBackground:"#000"},textarea:{text:"#fff",background:"#000",border:"#000",outline:"#fff",resizeBackground:"#fff",resizeIcon:"#000"},itemSelect:{border:"#fff"},itemSelectItem:{border:"#fff",background:"#000",disabledLabelText:"#AAA",disabledLabelbackground:"#000"},button:{label:"#000",primary:{label:"#fff",background:"#000",border:"#AAA",outline:"#fff"},secondary:{label:"#fff",background:"#000",border:"#fff"},dialog:{label:"#fff",background:"#000",border:"#fff",outline:"#AAA"}},markdown:{typo:{selection:"#fff",headlinePrimary:"#fff",headlineSecondary:"#AAA",strong:"#AAA",strongEm:"#fff",link:"#AAA",linkHover:"#fff",del:"#fff",line:"#fff",blockquoteBackground:"#AAA",blockquoteText:"#fff",codeBackground:"#AAA",codeText:"#fff",codeSelection:"#fff"}},dialogContent:{backgroundPrimary:"#fff",backgroundSecondary:"#000",text:"#000"}}});function oe(r){const t=r.modules.windows;return async({modules:e},s)=>{const a=r.addExecution();let i;const n=rt({actions:{},value:yt(),fsItem:null,output:[],openValue:null});if(s)if(i=await e.files.fs.get(s),m.CONTENT in i.data){const l=Object.assign({},i.data,{[m.CONTENT]:[].concat(i.data[m.CONTENT]).join(`
`)});n.fsItem=i,n.value=l}else throw new Error("Can't read file content");const[h,d]=await Promise.all([v(()=>import("./WebBasic.3e27df01.js"),["./WebBasic.3e27df01.js","./InputText.eb0ba8ef.js","./index.0712caa6.js","./entry.9fb9bafb.js","./index.56665add.js","./index.c26f1597.css","./async.8020bbf7.js","./InputText.37a55679.css","./viewport.8757096e.js","./math.571b3f1f.js","./WebBasic.8c9a985d.css"],import.meta.url).then(l=>l.default),v(()=>import("./Preview.1aa573fb.js"),["./Preview.1aa573fb.js","./index.0712caa6.js","./entry.9fb9bafb.js","./index.56665add.js","./index.c26f1597.css","./viewport.8757096e.js","./math.571b3f1f.js","./async.8020bbf7.js","./Preview.bd4eb934.css"],import.meta.url).then(l=>l.default)]),c=e.windows.addWindow({title:"WebBasic - Extras 1.3",component:h,componentData:{model:n},options:{scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0,center:!1,embed:!0,borderless:!0},layout:{size:p(540,360)}},{group:"extras13WebBasic"});Object.assign(n.actions,{close:()=>{c.close()},focus:()=>{c.focus()},reset:()=>{n.value=yt(),n.fsItem=null,n.output=[],n.openValue=null}});let _;return n.actions.togglePreview=(l=!0)=>{l?(_=e.windows.addWindow({title:"Preview - WebBasic - Extras 1.3",component:d,componentData:{model:n},options:{scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0,center:!1,close:!1,embed:!0,borderless:!0},layout:{size:p(540,360)}},{group:"extras13WebBasic",active:!1}),window.requestAnimationFrame(()=>{t.contentWrapper.setWindowPositions(gt.SPLIT_HORIZONTAL,[c,_],{embed:!0})})):_&&(c.unfocus(),_.close(),window.requestAnimationFrame(()=>{t.contentWrapper.setWindowPositions(gt.SPLIT_HORIZONTAL,[c],{embed:!0}),c.focus()}))},r.modules.screen.setTheme(ne),new Promise(l=>{a(),c.events.pipe(Zt(({name:o})=>o==="close")).subscribe(()=>{_&&_.close(),r.modules.screen.setTheme(null),l()})})}}const he={WEB_BASIC_SHOW_PREVIEW:"extras13_web_basic_show_preview",WEB_PAINTING_DISPLAY_BACKGROUND:"extras13_web_painting_display_background",WEB_PAINTING_DISPLAY_FOREGROUND:"extras13_web_painting_display_foreground"},le={[he.WEB_BASIC_SHOW_PREVIEW]:!0},m={HAS_WINDOW_OUTPUT:jt.HAS_WINDOW_OUTPUT,CONTENT:"content",OUTPUT_TYPE:"type"};function yt(){return{[m.HAS_WINDOW_OUTPUT]:!1,[m.CONTENT]:"",[m.OUTPUT_TYPE]:"basic"}}const ce={meta:[[A.SYMBOL,y.DIRECTORY],[A.WINDOW_SIZE,p(380,200)],[A.WINDOW_SYMBOL_REARRANGE,!0]],id:"BasicDemos",name:"Basic Demos",createdDate:new Date(2017,7,5).getTime(),editedDate:new Date(2020,3,14).getTime(),items:[{meta:[[A.SYMBOL,y.BASIC]],id:"TEST.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:['PRINT USING "# #"; 1,2']}},{meta:[[A.SYMBOL,y.BASIC]],id:"FunctionTest.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:['PRINT USING "LEN(\\"ABC\\") #"; LEN("ABC")','PRINT USING "ASC(\\"D\\") ##"; ASC("D")','PRINT USING "CHR$(68) ##"; CHR$(68)','PRINT USING "LEFT$(\\"XYZ\\", LEN(\\"XYZ\\")-1) #"; LEFT$("XYZ", LEN("XYZ")-1)','PRINT USING "RIGHT$(\\"XYZ\\", LEN(\\"XYZ\\")-1) #"; RIGHT$("XYZ", LEN("XYZ")-1)']}},{meta:[[A.SYMBOL,y.BASIC]],id:"Fibonacci.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["CLS","READ max","DIM fib%(max)","LET fib(1) = 1","LET fib(2) = 2","FOR i=3 TO max","LET fib(i) = fib(i - 2) + fib(i -1)","NEXT i","FOR i=1 TO max","PRINT fib(i)","NEXT i","DATA 10","END"]}},{meta:[[A.SYMBOL,y.BASIC]],id:"Area.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["CLS","DIM w%,h%,a%","LET w%=12","LET h%=4","LET a%=w%*h%",'PRINT "With the width " + w%','PRINT " and the height " + h%','PRINT " you have the area " + a%']}},{meta:[[A.SYMBOL,y.BASIC]],id:"Circle.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["CLS","DIM r,a","LET r=5","READ pi","LET a=r*r*pi",'PRINT USING "With the radius ##.##"; r','PRINT USING "we have the area ##.##"; a',"DATA 3.14","END"]}},{meta:[[A.SYMBOL,y.BASIC]],id:"Your_Name.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["CLS",'PRINT "What is your name?"',"INPUT n$",'PRINT "What is your shoe size?"',"INPUT size",'PRINT "Hello "; n$','PRINT USING "your shoe size is ##.##"; size',"END"]}},{meta:[[A.SYMBOL,y.BASIC]],id:"GuessTheNumber.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["GuessTheNumber","CLS","READ max%","DIM number%, guess%, guesses%, message$",'LET message$ =  ""','PRINT "The number is between 1-1000."',"LET number% = INT(RND * max%) + 1","LET guess% = 1","LET guesses% = 0","WHILE guess%<>number%",'PRINT "Guess the number"',"PRINT message$","INPUT message$ guess%","IF (guess%<>number%) THEN","IF (guess%>number%) THEN",'LET message$ = "Your guess was too high"',"ELSE",'LET message$ =  "Your guess was too low"',"ENDIF","ENDIF","LET guesses% = guesses% + 1","WEND",'PRINT USING "You found the number in # tries"; guesses%',"DATA 1000","END"]}},{meta:[[A.SYMBOL,y.BASIC]],id:"Factorial.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["DIM result, n",'PRINT "Calculate the factorial of"',"INPUT n","LET result = 1","FOR i = n TO 1 STEP -1","LET result = result * i","NEXT i",'PRINT USING "#! = #"; n, result',"END"]}},{meta:[[A.SYMBOL,y.BASIC]],id:"Pyramid.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["CLS","DIM stars$",'PRINT "Enter the height of the pyramid"',"INPUT height",'LET stars$ = ""',"FOR i = 1 TO height",'LET stars$ = ""',"FOR j = 1 TO (i+i-1)",'LET stars$ = stars$ + "*"',"NEXT j","PRINT SPC(height - i) + stars","NEXT i","END"]}},{meta:[[A.SYMBOL,y.BASIC]],id:"Bubble_Sort.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["CLS","READ max","DIM SHARED numbers(max)","SUB CreateList(max) STATIC","FOR i=1 TO max","LET numbers(i) = INT(RND * 100)","NEXT i","END SUB","SUB PrintList(max) STATIC","FOR i=1 TO max","PRINT numbers(i)","NEXT i","END SUB","SUB SwapValues(i%, j%) STATIC","LET numbers(i%) = numbers(i%) XOR numbers(j%)","LET numbers(j%) = numbers(i%) XOR numbers(j%)","LET numbers(i%) = numbers(i%) XOR numbers(j%)","END SUB","SUB Sort(max) STATIC","FOR i%=1 TO (max - 1)","FOR j%=i% TO max","IF numbers(i%)>numbers(j%) THEN","CALL SwapValues(i, j)","END IF","NEXT j%","NEXT i%","END SUB","CreateList(max)","Sort(max)","PrintList(max)","DATA 10","END"]}},{meta:[[A.SYMBOL,y.BASIC]],id:"Goto.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:['PRINT "Step 1"','PRINT "Step 2"','PRINT "Step 3"',"GOTO ignore",'PRINT "Step 4"',"ignore:",'PRINT "Step 5"']}},{meta:[[A.SYMBOL,y.BASIC]],id:"Vars.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["DIM A, B","LET A = 2000",'LET B = "Hello World"','PRINT USING "A: #"; A','PRINT USING "B: #"; B']}},{meta:[[A.SYMBOL,y.BASIC]],id:"If.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["DIM A, B","LET A = 1","LET B = 2","IF A == B THEN",'PRINT "true"',"ELSE",'PRINT "false"',"END","IF (A < B) THEN",'PRINT "true"',"END"]}},{meta:[[A.SYMBOL,y.BASIC]],id:"For.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["DIM i%","FOR i% = 1 TO 5",'PRINT USING "For Number #"; i%',"NEXT i%"]}},{meta:[[A.SYMBOL,y.BASIC]],id:"For_Step.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["CLS","FOR i% = 0 TO 6 STEP 2",'PRINT "For Step Number #"; i%',"NEXT i%"]}},{meta:[[A.SYMBOL,y.BASIC]],id:"While.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["DIM i%","LET i%=0","WHILE i% < 5",'PRINT USING "While Number #"; i%',"LET i% = i% + 1","WEND"]}},{meta:[[A.SYMBOL,y.BASIC]],id:"Pause.bas",data:{[m.HAS_WINDOW_OUTPUT]:!0,[m.OUTPUT_TYPE]:"basic",[m.CONTENT]:["DIM duration","LET duration = 2500",'PRINT USING "Start with Pause #ms"; duration',"PAUSE duration",'PRINT "End Pause"','PRINT USING "Start with Sleep #ms"; duration',"PAUSE duration",'PRINT "End Sleep"']}}]};function ue(r){return r.toISOString().slice(0,10).replace(/[-]/g,"")}const de=Object.freeze({NATURAL:"natural",SHARP:"sharp",DOUBLE_SHARP:"doubleSharp",FLAT:"flat",DOUBLE_FLAT:"doubleFlat"}),me=Object.freeze({ADD:"add",REPLACE:"replace"}),pe=Object.freeze({LARGE:"large",MEDIUM:"medium",SMALL:"small"}),fe=de,_e=Object.freeze({TOP:"top",BOTTOM:"bottom"}),_s=Object.freeze({DEFAULT:"default",ASCENDING:"ascending",DESCENDING:"descending",EQUAL:"equal"}),Nt={test2000:[],alleMeineEnten:[{name:"C4",time:"4n"},{name:"D4",time:"4n"},{name:"E4",time:"4n"},{name:"F4",time:"4n"},{name:"G4",time:"2n"},{name:"G4",time:"2n"},{name:"A4",time:"4n"},{name:"A4",time:"4n"},{name:"A4",time:"4n"},{name:"A4",time:"4n"},{name:"G4",time:"1m"},{name:"A4",time:"4n"},{name:"A4",time:"4n"},{name:"A4",time:"4n"},{name:"A4",time:"4n"},{name:"G4",time:"1m"},{name:"F4",time:"4n"},{name:"F4",time:"4n"},{name:"F4",time:"4n"},{name:"F4",time:"4n"},{name:"E4",time:"2n"},{name:"E4",time:"2n"},{name:"G4",time:"4n"},{name:"G4",time:"4n"},{name:"G4",time:"4n"},{name:"G4",time:"4n"},{name:"C4",time:"1m"}],testA:[{name:"C#4",time:"4n"},{name:"",time:1},{name:"C4",time:"4n"},{name:"C4",time:"4n"},{name:"C4",time:"4n"},{name:"C4",time:"4n"},{name:"C4",time:"4n"}],chocoboThemeV1:[{name:"C5",time:"4n",dot:!1},{name:"A4",time:"8n",dot:!1},{name:"F4",time:"8n",dot:!1},{name:"D4",time:"8n",dot:!1},{name:"C5",time:"8n",dot:!1},{name:"A4",time:"8n",dot:!1},{name:"F4",time:"8n",dot:!1},{name:"A4",time:"4n",dot:!1},{name:"F4",time:"4n",dot:!1},{name:"A4",time:"4n",dot:!0},{name:"G4",time:"8n",dot:!1},{name:"F4",time:"8n",dot:!1},{name:"F4",time:"16n",dot:!1},{name:"G4",time:"16n",dot:!1},{name:"F4",time:"8n",dot:!1},{name:"E4",time:"8n",dot:!1},{name:"F4",time:"4n",dot:!0},{name:"E4",time:"8n",dot:!1},{name:"F4",time:"8n",dot:!1},{name:"F4",time:"16n",dot:!1},{name:"A4",time:"16n",dot:!1},{name:"C5",time:"8n",dot:!1},{name:"D5",time:"8n",dot:!1},{name:"E5",time:"2n",dot:!1},{name:"C5",time:"4n",dot:!1},{name:"A4",time:"8n",dot:!1},{name:"F4",time:"8n",dot:!1},{name:"D4",time:"8n",dot:!1},{name:"C5",time:"8n",dot:!1},{name:"A4",time:"8n",dot:!1},{name:"F4",time:"8n",dot:!1},{name:"A4",time:"4n",dot:!1},{name:"F4",time:"4n",dot:!1},{name:"A4",time:"4n",dot:!0},{name:"G4",time:"8n",dot:!1},{name:"F4",time:"8n",dot:!1},{name:"F4",time:"16n",dot:!1},{name:"G4",time:"16n",dot:!1},{name:"F4",time:"8n",dot:!1},{name:"E4",time:"8n",dot:!1},{name:"F4",time:"4n",dot:!0},{name:"E4",time:"8n",dot:!1},{name:"F4",time:"8n",dot:!1},{name:"F4",time:"16n",dot:!1},{name:"A4",time:"16n",dot:!1},{name:"C5",time:"8n",dot:!1},{name:"D5",time:"8n",dot:!1},{name:"E5",time:"2n",dot:!1},{name:"D5",time:"4n",dot:!1},{name:"B4",time:"8n",dot:!1},{name:"G4",time:"8n",dot:!1},{name:"E4",time:"8n",dot:!1},{name:"G4",time:"8n",dot:!1},{name:"B4",time:"8n",dot:!1},{name:"D5",time:"8n",dot:!1},{name:"C5",time:"4n",dot:!1},{name:"F5",time:"4n",dot:!1},{name:"C5",time:"4n",dot:!0},{name:"A4",time:"8n",dot:!1},{name:"B4",time:"4n",dot:!1},{name:"G4",time:"8n",dot:!1},{name:"E4",time:"8n",dot:!1},{name:"C4",time:"8n",dot:!1},{name:"E4",time:"8n",dot:!1},{name:"G4",time:"8n",dot:!1},{name:"B4",time:"8n",dot:!1},{name:"A4",time:"8n",dot:!1},{name:"A4",time:"16n",dot:!1},{name:"B4",time:"16n",dot:!1},{name:"A4",time:"8n",dot:!1},{name:"G4",time:"8n",dot:!1},{name:"A4",time:"2n",dot:!1},{name:"D5",time:"4n",dot:!1},{name:"B4",time:"8n",dot:!1},{name:"G4",time:"8n",dot:!1},{name:"E4",time:"8n",dot:!1},{name:"G4",time:"8n",dot:!1},{name:"B4",time:"8n",dot:!1},{name:"D5",time:"8n",dot:!1},{name:"C5",time:"4n",dot:!1},{name:"F5",time:"4n",dot:!1},{name:"C5",time:"4n",dot:!0},{name:"A4",time:"8n",dot:!1},{name:"G4",time:"8n",dot:!1},{name:"G4",time:"16n",dot:!1},{name:"A4",time:"16n",dot:!1},{name:"G4",time:"8n",dot:!1},{name:"F4",time:"8n",dot:!1},{name:"G4",time:"4n",dot:!0},{name:"F4",time:"8n",dot:!1},{name:"G4",time:"8n",dot:!1},{name:"G4",time:"16n",dot:!1},{name:"A4",time:"16n",dot:!1},{name:"B4",time:"8n",dot:!1},{name:"C5",time:"8n",dot:!1},{name:"D5",time:"4n",dot:!1},{name:"E5",time:"4n",dot:!1},{name:"F5",time:"2n",dot:!1},{name:"",time:"2n",dot:!1}]};function Te(r){return async({modules:t})=>{const{windows:e}=t,[s,a,i]=await Promise.all([v(()=>import("./MidiController.0f6340f7.js"),["./MidiController.0f6340f7.js","./entry.9fb9bafb.js","./index.0712caa6.js","./index.56665add.js","./index.c26f1597.css"],import.meta.url).then(u=>u.default),v(()=>import("./Track.34d43f2d.js").then(u=>u.n),["./Track.34d43f2d.js","./index.56665add.js","./index.0712caa6.js","./entry.9fb9bafb.js","./index.c26f1597.css"],import.meta.url).then(u=>u.default),v(()=>import("./Project.d8d80471.js"),["./Project.d8d80471.js","./Track.34d43f2d.js","./index.56665add.js","./index.0712caa6.js","./entry.9fb9bafb.js","./index.c26f1597.css","./viewport.8757096e.js","./math.571b3f1f.js","./async.8020bbf7.js"],import.meta.url).then(u=>u.default)]),n=new s;n.start();const[h,d,c,_]=await Promise.all([v(()=>import("./Project.00a4335e.js"),["./Project.00a4335e.js","./index.0712caa6.js","./entry.9fb9bafb.js","./index.56665add.js","./index.c26f1597.css","./Track.34d43f2d.js","./Navigation.0c81943e.js","./Navigation.37a3366a.css","./TimelineCanvas.7a745905.js","./TimelineCanvas.27f9ef0f.css","./viewport.8757096e.js","./math.571b3f1f.js","./async.8020bbf7.js","./Project.4affe510.css"],import.meta.url).then(u=>u.default),v(()=>import("./Track.9535984a.js"),["./Track.9535984a.js","./index.0712caa6.js","./entry.9fb9bafb.js","./index.56665add.js","./index.c26f1597.css","./Track.34d43f2d.js","./ContextMenu.b1bcc7e2.js","./ContextMenu.8af64bc9.css","./Navigation.0c81943e.js","./Navigation.37a3366a.css","./MidiController.0f6340f7.js","./TimelineCanvas.7a745905.js","./TimelineCanvas.27f9ef0f.css","./viewport.8757096e.js","./math.571b3f1f.js","./async.8020bbf7.js","./Track.815b9646.css"],import.meta.url).then(u=>u.default),v(()=>import("./Notes.d2b1c09d.js"),["./Notes.d2b1c09d.js","./index.0712caa6.js","./entry.9fb9bafb.js","./index.56665add.js","./index.c26f1597.css","./Track.34d43f2d.js","./TimelineCanvas.7a745905.js","./TimelineCanvas.27f9ef0f.css","./viewport.8757096e.js","./math.571b3f1f.js","./async.8020bbf7.js","./Notes.0901121d.css"],import.meta.url).then(u=>u.default),v(()=>import("./Midi.d90ce9ee.js"),["./Midi.d90ce9ee.js","./index.0712caa6.js","./entry.9fb9bafb.js","./index.56665add.js","./index.c26f1597.css","./MidiController.0f6340f7.js"],import.meta.url).then(u=>u.default)]),l=$t([]),o=rt(await ge()),b=e.addWindow({title:"Synthesizer",component:h,componentData:{core:r,midiController:n,model:o},options:{scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!0,embed:!0,borderless:!0}},{group:"extras13Synthesizer",full:!0});o.actions={removeTrack:async u=>{await St(r,`Remove Track \\"${u.name}\\" from Project??`)&&(o[g.SYNTHESIZER_PROJECT].tracks=o[g.SYNTHESIZER_PROJECT].tracks.filter(I=>I!==u))},clearTracks:async()=>{await St(r,"Remove all Tracks from Project??")&&(o[g.SYNTHESIZER_PROJECT].tracks=[])},newProject:async()=>{const u=new i,E=await It(r,"New Project:",u.name);E&&(u.name=E,o[g.SYNTHESIZER_PROJECT]=u)},openProject:async()=>{const u=await r.executeCommand("openFileDialog");if(u){const E=new i(u.value);o[g.SYNTHESIZER_PROJECT]=E}},saveProject:async()=>{const u=await btoa(JSON.stringify(o[g.SYNTHESIZER_PROJECT]));return o.fsItem=await r.executeCommand(`saveFileDialog --data="${u}" --extension="json"`),o.fsItem},importProject:async u=>{const E=new i(JSON.parse(await u.text()));o[g.SYNTHESIZER_PROJECT]=E},exportProject:async()=>{const u=await v(()=>import("./FileSaver.min.22889dc2.js").then(E=>E.F),["./FileSaver.min.22889dc2.js","./index.0712caa6.js","./entry.9fb9bafb.js","./index.56665add.js","./index.c26f1597.css"],import.meta.url).then(E=>E.default);try{const E=o[g.SYNTHESIZER_PROJECT],I=new Blob([JSON.stringify(E)],{type:"application/json;charset=utf-8"});await u.saveAs(I,`${ue(new Date)}-${Jt(E.name)}.json`)}catch(E){console.error("An error occurred during export.",E)}},newTrack:async()=>{const u=new a,E=await It(r,"New Track:",u.name);E&&(u.name=E,console.log(u),o[g.SYNTHESIZER_PROJECT].tracks.push(u))},editTrack:(u,E={})=>{const I=e.addWindow({title:`Track: ${u.name}`,component:d,componentData:{parentWindow:b,model:o,trackModel:{...Ae(u),...E}},options:{scaleX:!1,scaleY:!0,scrollX:!1,scrollY:!1}},{group:"extras13Synthesizer",full:!0});return l.push(I),{window:I,close:I.awaitClose().then(()=>new a(u)),ready:I.awaitReady()}},openDebugNotes:()=>{const u=e.addWindow({title:"Debug Notes",component:c,componentData:{parentWindow:b},options:{scaleX:!1,scaleY:!0,scrollX:!1,scrollY:!0}},{group:"extras13Synthesizer",full:!0});return l.push(u),{window:u,close:u.awaitClose(),ready:u.awaitReady()}},openDebugMidi:()=>{const u=e.addWindow({title:"Debug Midi",component:_,componentData:{midiController:n,parentWindow:b},options:{scaleX:!1,scaleY:!0,scrollX:!1,scrollY:!0}},{group:"extras13Synthesizer",full:!0});return l.push(u),{window:u,close:u.awaitClose(),ready:u.awaitReady()}},closeTracks:()=>{l.forEach(u=>u.close())},close:()=>{l.forEach(u=>u.close()),b.close()},focus:()=>{b.focus()}}}}const g={SYNTHESIZER_BPM:"extras13_synthesizer_bpm",SYNTHESIZER_PROJECT:"extras13_synthesizer_project",SYNTHESIZER_TRACK:"extras13_synthesizer_track",SYNTHESIZER_TRACK_SHOW_NOTE_LABELS:"extras13_synthesizer_showNoteLabels",SYNTHESIZER_TRACK_SHOW_KEYBOARD:"extras13_synthesizer_showKeyboard",SYNTHESIZER_TRACK_INSTRUMENT:"extras13_synthesizer_instrument",SYNTHESIZER_TRACK_START_OCTAVE:"extras13_synthesizer_startOctave",SYNTHESIZER_TRACK_OCTAVE_COUNT:"extras13_synthesizer_octaveCount",SYNTHESIZER_TRACK_KEYBOARD_ALIGN:"extras13_synthesizer_keyboardAlign",SYNTHESIZER_TRACK_KEYBOARD_SIZE:"extras13_synthesizer_keyboardSize",SYNTHESIZER_TRACK_DURATION:"extras13_synthesizer_duration",SYNTHESIZER_TRACK_BEAT_COUNT:"extras13_synthesizer_beat_count",SYNTHESIZER_TRACK_BASE_NOTE:"extras13_synthesizer_base_note",SYNTHESIZER_TRACK_NOTE_COUNT:"extras13_synthesizer_note_count",SYNTHESIZER_TRACK_INPUT_OPERATION:"extras13_synthesizer_input_operation",SYNTHESIZER_TRACK_INPUT_DOT:"extras13_synthesizer_input_dot",SYNTHESIZER_TRACK_INPUT_TRIPLET:"extras13_synthesizer_input_triplet",SYNTHESIZER_TRACK_INPUT_MODIFICATION:"extras13_synthesizer_input_modification"},be={};function It(r,t,e=""){return r.executeCommand(`openDialog -title="${t}" -prompt -prompt-value="${e}" -apply="Save" -abort="Cancel"`)}function St(r,t){return r.executeCommand(`openDialog "${t}" -confirm`)}async function Ee(){const[r,t]=await Promise.all([v(()=>import("./Track.34d43f2d.js").then(s=>s.n),["./Track.34d43f2d.js","./index.56665add.js","./index.0712caa6.js","./entry.9fb9bafb.js","./index.c26f1597.css"],import.meta.url).then(s=>s.default),v(()=>import("./Project.d8d80471.js"),["./Project.d8d80471.js","./Track.34d43f2d.js","./index.56665add.js","./index.0712caa6.js","./entry.9fb9bafb.js","./index.c26f1597.css","./viewport.8757096e.js","./math.571b3f1f.js","./async.8020bbf7.js"],import.meta.url).then(s=>s.default)]);return new t({tracks:[new r({name:"Test",type:"Synth",notes:[{name:"C2",time:"2n"},{name:"C5",time:"2n"},{name:"C4",time:"4n"},{name:"fb3",time:"2n"}],beatCount:2}),new r({name:"Alle Meine Enten",type:"Synth",notes:Nt.alleMeineEnten,beatCount:2}),new r({name:"Chocobo Theme V1",type:"Synth",notes:Nt.chocoboThemeV1,baseNote:8,noteCount:8,beatCount:4})]})}function Ae(r){return{[g.SYNTHESIZER_TRACK]:r,[g.SYNTHESIZER_TRACK_KEYBOARD_ALIGN]:_e.TOP,[g.SYNTHESIZER_TRACK_KEYBOARD_SIZE]:pe.SMALL,[g.SYNTHESIZER_TRACK_SHOW_NOTE_LABELS]:!1,[g.SYNTHESIZER_TRACK_DURATION]:"2n",[g.SYNTHESIZER_TRACK_INPUT_OPERATION]:me.ADD,[g.SYNTHESIZER_TRACK_SHOW_KEYBOARD]:!0,[g.SYNTHESIZER_TRACK_INPUT_DOT]:!1,[g.SYNTHESIZER_TRACK_INPUT_TRIPLET]:!1,[g.SYNTHESIZER_TRACK_INPUT_MODIFICATION]:fe.NATURAL,[g.SYNTHESIZER_TRACK_START_OCTAVE]:3,[g.SYNTHESIZER_TRACK_OCTAVE_COUNT]:2}}async function ge(){return{[g.SYNTHESIZER_PROJECT]:await Ee(),[g.SYNTHESIZER_BPM]:120}}var B,_t,Tt;class ht{constructor(t=0,e=0,s=0,a=255){D(this,B,0);D(this,_t,0);D(this,Tt,0);this.set(t,e,s,a)}set(t=0,e=0,s=0,a=255){Array.isArray(t)&&(a=t[3],s=t[2],e=t[1],t=t[0]),this.red=t,this.green=e,this.blue=s,this.alpha=a===void 0?255:a}get r(){return f(this,B)}get red(){return f(this,B)}set red(t){S(this,B,P(t,0,255))}get g(){return this._green}get green(){return this._green}set green(t){this._green=P(t,0,255)}get blue(){return this._blue}get b(){return this._blue}set blue(t){this._blue=P(t,0,255)}get a(){return this._alpha}get alpha(){return this._alpha}set alpha(t){this._alpha=P(t,0,255)}get sum(){return f(this,B)+this._blue+this._green+this._alpha}toRGB(){return`rgb(${f(this,B)},${this._green},${this._blue})`}toRGBA(){return`rgba(${f(this,B)},${this._green},${this._blue},${this._alpha/255})`}toJSON(){return{red:this.red,green:this.green,blue:this.blue,alpha:this.alpha}}is(t){return this.red===t.red&&this.blue===t.blue&&this.green===t.green&&this.alpha===t.alpha}invert(){return S(this,B,255-f(this,B)),this._green=255-this._green,this._blue=255-this._blue,this}add(t){this.red=P(this.red+t.red,0,255),this.green=P(this.green+t.green,0,255),this.blue=P(this.blue+t.blue,0,255)}subtract(t){this.red=P(this.red-t.red,0,255),this.green=P(this.green-t.green,0,255),this.blue=P(this.blue-t.blue,0,255)}multiply(t){this.red=P(this.red*t.red,0,255),this.green=P(this.green*t.green,0,255),this.blue=P(this.blue*t.blue,0,255)}divide(t){this.red=P(this.red/t.red,0,255),this.green=P(this.green/t.green,0,255),this.blue=P(this.blue/t.blue,0,255)}}B=new WeakMap,_t=new WeakMap,Tt=new WeakMap;ht.COLOR_BLACK=[0,0,0,255];ht.COLOR_WHITE=[255,255,255,255];ht.COLOR_TRANSPARENT=[0,0,0,0];const N=ht;var G;class dt{constructor(t,e){D(this,G,p(0,0));S(this,G,p(t,e))}get width(){return f(this,G).x}get height(){return f(this,G).y}get size(){return f(this,G)}}G=new WeakMap;class z{static invertImageData(t){let e=0;for(let s=0;s<t.width;s++)for(let a=0;a<t.height;a++)e=(s+a*t.width)*4,t.data[Number(e)]=255-t.data[Number(e)],t.data[e+1]=255-t.data[e+1],t.data[e+2]=255-t.data[e+2]}static createImageData(t,e,s){return new window.ImageData(new window.Uint8ClampedArray(s||4*t*e),t,e)}static resizeImageData(t,e=1){const s=t.data,a=t.width,i=t.height,n=a*e,h=i*e,d=Array(n*h*4),c=p(parseInt((a<<16)/n)+1,parseInt((i<<16)/h)+1);let _,l;for(let o=0;o<h;o++)for(let b=0;b<n;b++)_=b*c.x>>16,l=o*c.y>>16,mt((l*a+_)*4,s,(o*n+b)*4,d);return z.createImageData(n,h,d)}static cropImageData(t,e,s,a,i){const n=t.data,h=Array(a*i*4);for(let d=0;d<a;d++)for(let c=0;c<i;c++){const _=(s*t.width+e)*4+(c*t.width+d)*4;mt(_,n,(c*a+d)*4,h)}return z.createImageData(a,i,h)}getActiveContext(){return this._app.display.context}getDisplayContexts(){return this._app.displays.value.map(t=>t.context)}constructor(t){this._app=t;const e=t.options.size;this._bitmapData=new dt(e.width,e.height),this._renderActions=[],this._passiveRenderActions=[],this.clearStack()}setSize(t,e){this._bitmapData=new dt(t,e),this.clearStack(),this.render(),this._app.refresh()}loadImage(t){const e=this.getImageDataFromImage(t);this._bitmapData=new dt(e.width,e.height),this.clearStack(),this._stacks.push(e),this.render(),this._app.refresh()}getImageDataFromImage(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0);const a=z.createImageData(t.width,t.height),i=s.getImageData(0,0,e.width,e.height);for(let n=0;n<i.length;n++)a.data[Number(n)]=i[Number(n)];return i}getColorFromPixel(t,e,s=!1){const a=s?this._renderImageData:this._stacks[this._stacks.length-1||0],i=a.data,n=e*(a.width*4)+t*4;return new N(i[Number(n)],i[n+1],i[n+2],i[n+3])}getPixel(t,e,s=!1){const a=s?this._renderImageData:this._stacks[this._stacks.length-1||0],i=a.data,n=e*(a.width*4)+t*4;return i[Number(n)]+i[n+1]+i[n+2]+i[n+3]}setPixel(t,e,s){s=s||this._app.primaryColor;const a=(t+e*this._renderImageData.width)*4;this._renderImageData.data[a+0]=s.red,this._renderImageData.data[a+1]=s.green,this._renderImageData.data[a+2]=s.blue,this._renderImageData.data[a+3]=s.alpha>=0?s.alpha:255}putImageData(t,e,s){let a,i;for(let n=0;n<t.width;n++)for(let h=0;h<t.height;h++)a=(h*t.width+n)*4,i=((s+h)*this._renderImageData.width+(e+n))*4,mt(a,t.data,i,this._renderImageData.data)}fillPixels(t,e,s,a,i){for(let n=e;n<Math.min(e+a,this._renderImageData.width);n++)for(let h=s;h<Math.min(s+i,this._renderImageData.height);h++)this.setPixel(n,h,t)}addRenderAction(t){this._renderActions.push(t)}addPassiveRenderAction(t){this._passiveRenderActions.push(t)}cleanPassiveRenderActions(){this._passiveRenderActions=[]}getTmpStack(){return z.createImageData(this._stacks[this._stacks.length-1].width,this._stacks[this._stacks.length-1].height,this._stacks[this._stacks.length-1].data)}render(){this._renderImageData=this.getTmpStack(),pt(this._renderActions),pt(this._passiveRenderActions,!0),window.cancelAnimationFrame(this._renderWait),this._renderWait=window.setTimeout(()=>{Dt.bind(this)(!0),this._renderWait=null},1e3/30),window.clearTimeout(this._renderWaitDisplays),this._renderWaitDisplays=window.setTimeout(()=>{Dt.bind(this)()},300)}get size(){return p(this._renderImageData.width,this._renderImageData.height)}get width(){return this._renderImageData.width}get height(){return this._renderImageData.height}get stacks(){return this._stacks}get renderImageData(){return this._renderImageData}clearStack(){this._renderImageData=z.createImageData(this._bitmapData.width,this._bitmapData.height),this._stacks=[this._renderImageData],this.render()}saveStack(){this._renderImageData=this.getTmpStack(),pt(this._renderActions,!0),this._stacks.push(this._renderImageData),this.render()}revertStack(){this._stacks.length>1&&(this._renderImageData=this._stacks.pop(),this.render())}toBlob(){return new Promise(t=>{Pt(this._renderImageData).toBlob(t)})}toBase64(){return new Promise(t=>{t(Pt(this._renderImageData).toDataURL())})}}function mt(r,t,e,s){s[Number(e)]=t[Number(r)],s[e+1]=t[r+1],s[e+2]=t[r+2],s[e+3]=t[r+3]}function Pt(r){const t=document.createElement("canvas");return t.width=r.width,t.height=r.height,t.getContext("2d").putImageData(r,0,0),t}function Dt(r){r?this._app.display&&(this._app.display.imageData=this._renderImageData):this._app.displays.value.forEach(t=>{t.imageData=this._renderImageData})}function pt(r,t){if(t){let e;for(;r.length>0;)e=r.shift(),e()}else r.forEach(e=>{e()})}const j=z;class vt extends Kt{}class ye{constructor(t){T(this,"subscription",new Rt);this._app=t}register(){this.subscription.add(x.keydown.pipe(ie(200)).subscribe(Ie.bind(this)),x.keyup.subscribe(Ne.bind(this)))}unregister(){this.subscription.unsubscribe()}registerDisplay(t){}unregisterDisplay(t){}}function Ne(r){switch(r.keyCode){case 17:r.preventDefault(),this.holdCrtl=!1;break;case 18:r.preventDefault(),this.holdAlt=!1;break}}function Ie(r){if(this._app.display){let t=1;switch(this.holdAlt&&(t*=10),r.keyCode){case 17:r.preventDefault(),this.holdCrtl=!0;break;case 18:r.preventDefault(),this.holdAlt=!0;break;case 37:r.preventDefault(),this._app.display.offset.x-=t;break;case 38:r.preventDefault(),this._app.display.offset.y-=t;break;case 39:r.preventDefault(),this._app.display.offset.x+=t;break;case 40:r.preventDefault(),this._app.display.offset.y+=t;break}const e=this._app.display;this._app.display.offset=new vt(P(e.offset.x,-e.zoomBounds.min.x,e.canvasLayout.naturalSize.x-e.zoomBounds.max.x),P(e.offset.y,-e.zoomBounds.min.y,e.canvasLayout.naturalSize.y-e.zoomBounds.max.y)),this._app.display.renderImageData()}}const Se=20;class Pe{constructor(t){T(this,"subscriptions",[]);T(this,"displaySubscriptions",new Map);T(this,"runSubscriptions",[]);this._app=t,this._pressed=!1}registerDisplay(t){this.displaySubscriptions.set(t,[x.get("mousedown",t.canvas).subscribe(this.onPointerDown(t).bind(this)),x.get("mouseenter",t.canvas).subscribe(this.onPointerEnter(t).bind(this))])}unregisterDisplay(t){this.displaySubscriptions.has(t)&&(this.displaySubscriptions.get(t).forEach(e=>e.unsubscribe()),this.displaySubscriptions.delete(t))}register(){}unregister(){}onContextMenu(t){return e=>{this.runActionResult(we.bind(this)(e,t))}}onPointerEnter(t){return e=>{this.app.setDisplay(t);const s=x.get("mouseleave",e.target).subscribe(a=>{s.unsubscribe(),this.onPointerLeave(t)(a)})}}onPointerLeave(t){return e=>{}}onPointerDown(t){return e=>{this.app.setDisplay(t),this._pointerEvent=lt.bind(this)(e,t),this._pressed=!0,this.runActionResult(Ce.bind(this)(e,t),e,t),this.app.display.renderCanvas()}}onPointerLeaveAndUp(t){return e=>{xt(),this.runActionResult(Oe.bind(this)(e,t))}}onPointerMove(t){return e=>{this.runActionResult(Re.bind(this)(e,t))}}get app(){return this._app}get pressed(){return this._pressed}runActionResult(t,e,s){t&&(t.events&&(this.runSubscriptions=[x.get("contextmenu",e.target).subscribe(this.onContextMenu(s).bind(this)),x.get("mouseleave",e.target).subscribe(this.onPointerLeaveAndUp(s).bind(this)),x.get("mousemove",e.target).subscribe(this.onPointerMove(s).bind(this)),x.get("mouseup",e.target).subscribe(this.onPointerLeaveAndUp(s).bind(this))]),t.save&&this.app.canvas.saveStack(),t.revert&&this.app.canvas.revertStack(),t.render&&this.app.canvas.render())}unsubscribeRun(){this.runSubscriptions.filter(t=>!t.unsubscribe())}}let ft;function xt(){window.clearInterval(ft),ft=null}function De(r){xt(),ft=window.setInterval(r,Se)}function lt(r,t){const e=t.canvasLayout;let s=p(r.clientX-t.bounds.min.x,r.clientY-t.bounds.min.y),a=p(()=>s-e.position);this.app.globalBounds&&(s=p(()=>s-this.app.globalBounds.min),a=p(()=>a-this.app.globalBounds.min));const i=p(()=>Math.round(a)),n=p(()=>Math.round(a/t.zoomFactor+t.zoomBounds.min));return{position:n,origin:i,app:this.app,x:n.x,y:n.y,originX:i.x,originY:i.y,leftClick:r.button!==2,rightClick:r.button===2,holdAlt:x.altActive,holdCtrl:x.cmdActive}}function Ce(){const r={events:!0};if(this.app.tool.pointerDownHold)De(()=>{this.runActionResult(this.app.tool.onPointerDown(this._pointerEvent,this)),this.app.canvas.render()});else return Object.assign(r,this.app.tool.onPointerDown(this._pointerEvent,this));return r}function Oe(r,t){return this._pressed=!1,this._pointerEvent=null,this.unsubscribeRun(),this.app.tool.onPointerUp(lt.bind(this)(r,t),this)}function Re(r,t){return this._pointerEvent=lt.bind(this)(r,t),this.app.tool.onPointerMove(this._pointerEvent,this)}function we(r,t){return r.preventDefault(),r.stopPropagation(),this.app.tool.onContextMenu(lt.bind(this)(r,t),this)}var Q;class Y{constructor(t){D(this,Q,!1);this._app=t.app,this.passive=t.passive||!1,S(this,Q,t.pointerDownHold||!1)}get pointerDownHold(){return f(this,Q)}deconstructor(){}onActive(){}onPointerDown(){}onPointerUp(){}onPointerMove(){}onContextMenu(){}get app(){return this._app}get setPixel(){return this._app.activeDisplay.setPixel}}Q=new WeakMap;class w extends Y{constructor(t){super(t),this._brush=t.brush}get brush(){return this._brush}set brush(t){this._brush=t}static drawBrush({x:t,y:e,data:s,app:a,color:i}){t=Math.floor(t-s[0].length/2+1),e=Math.floor(e-s.length/2);const n=[];for(let h=0;h<s[0].length;h++)for(let d=0;d<s.length;d++)s[Number(d)][Number(h)]>0&&i.alpha?(a.canvas.setPixel(t+h,e+d,i),n.push([t+h,e+d])):s[Number(d)][Number(h)]<0&&a.canvas.setPixel(t+h,e+d);return n}}class Bt extends w{onPointerDown(t){const e=t.x,s=t.y,a=[].concat(this._brush.data);return this._app.canvas.addRenderAction(()=>{w.drawBrush({color:this._brush.primaryColor,x:e,y:s,data:a,app:this._app})}),{save:!0,render:!0}}}function Lt(r,t,e,s,a=0){const i=Math.abs(e-r),n=r<e?1:-1,h=Math.abs(s-t),d=t<s?1:-1;let c=(i>h?i:-h)/2;const _=[];let l=0;for(;a===0||l>=1?(_.push([r,t]),l=0):l+=1/a,!(r===e&&t===s);){const o=c;o>-i&&(c-=h,r+=n),o<h&&(c+=i,t+=d)}return _}function H(r,t,e,s,a,{density:i=0}){Lt(t,e,s,a,i).forEach(n=>{r(n[0],n[1])})}function ve(r,t,e,s,a,i,n,h,d,c=.001){let _=0,l=0,o=0;for(o=0;o<=1;o+=c)_=(1-o)**3*t+3*o*(1-o)**2*s+3*o**2*(1-o)*i+o**3*h,l=(1-o)**3*e+3*o*(1-o)**2*a+3*o**2*(1-o)*n+o**3*d,r(parseInt(_),parseInt(l))}function J(r,t,e,s,a,{strokeSize:i=0,filled:n=!1,density:h}){if(n){const d=(c,_)=>r(c,_,!0);for(let c=(a<0,e);a<0?c>=e+a:c<=e+a;a<0?c--:c++)H(d,(s<0,t),c,t+s,c,{density:h})}if(i>0){i=Math.floor(i/2),i=[s<0?-i:i,a<0?-i:i];let d=[t-i[0],e-i[1]];[[t-i[0],e-i[1]],[t-i[0],e+a+i[1]],[t+s+i[0],e+a+i[1]],[t+s+i[0],e-i[1]],d].forEach(c=>{H(r,d[0],d[1],c[0],c[1],{density:h}),d=c})}}function it(r,t,e,s,a,{filled:i=!1,density:n=0}){s<0&&(s=Math.abs(s)),a<0&&(a=Math.abs(a));const h=s*s,d=a*a,c=4*h,_=4*d;let l,o,b,u=0;const E=(C,W)=>r(C,W,!0),I=[];for(l=0,o=a,b=2*d+h*(1-2*a);d*l<=h*o;l++)!n||u>=1?(I.push([t+l,e+o]),I.push([t-l,e-o]),I.push([t-l,e+o]),I.push([t+l,e-o]),u=0):u+=1/n,b>=0&&(b+=c*(1-o),o--),b+=d*(4*l+6);for(u=0,l=s,o=0,b=2*h+d*(1-2*s);h*o<=d*l;o++)!n||u>=1?(I.push([t+l,e+o]),I.push([t-l,e+o]),I.push([t+l,e-o]),I.push([t-l,e-o]),u=0):u+=1/n,b>=0&&(b+=_*(1-l),l--),b+=h*(4*o+6);if(i)for(let C=-a;C<=a;C++)for(let W=-s;W<=s;W++)W*W*a*a+C*C*s*s<=a*a*s*s&&E(t+W,e+C);I.forEach(C=>{r(C[0],C[1])})}function xe(r,t,e,{strokeSize:s=0,filled:a=!1,density:i=0}){let n,h=Number.MAX_VALUE,d=Number.MAX_VALUE,c=Number.MIN_VALUE,_=Number.MIN_VALUE;if(t.forEach(l=>{n&&(l.x>c&&(c=l.x),l.y>_&&(_=l.y),l.x<h&&(h=l.x),l.y<d&&(d=l.y),H(r,n.x,n.y,l.x,l.y,{density:i})),n=l}),e){const l=t[0];n&&(l.x>c&&(c=l.x),l.y>_&&(_=l.y),l.x<h&&(h=l.x),l.y<d&&(d=l.y),H(r,n.x,n.y,l.x,l.y,{density:i}))}a&&Be((o,b)=>r(o,b,!0),t,{IMAGE_LEFT:h,IMAGE_TOP:d,IMAGE_RIGHT:c,IMAGE_BOTTOM:_})}function Be(r,t,{IMAGE_LEFT:e=0,IMAGE_TOP:s=0,IMAGE_RIGHT:a,IMAGE_BOTTOM:i}){const n=[],h=[];t.forEach(E=>{n.push(E.y),h.push(E.x)});let d;const c=Array(t.length);let _,l,o,b,u;for(l=s;l<i;l++){for(d=0,b=t.length-1,o=0;o<t.length;o++)(n[Number(o)]<l&&n[Number(b)]>=l||n[Number(b)]<l&&n[Number(o)]>=l)&&(c[d++]=Math.round(h[Number(o)]+(l-n[Number(o)])/(n[Number(b)]-n[Number(o)])*(h[Number(b)]-h[Number(o)]))),b=o;for(o=0;o<d-1;)c[Number(o)]>c[o+1]?(u=c[Number(o)],c[Number(o)]=c[o+1],c[o+1]=u,o&&o--):o++;for(o=0;o<d&&!(c[Number(o)]>=a);o+=2)if(c[o+1]>e)for(c[Number(o)]<e&&(c[Number(o)]=e),c[o+1]>a&&(c[o+1]=a),_=c[Number(o)];_<c[o+1];_++)r(_,l)}}class Le extends w{onPointerDown(t){return Ct.bind(this)(t)}onPointerMove(t){return Ct.bind(this)(t)}onPointerUp(){return this.last=null,{save:!0}}}function Ct(r){const t=(this.last||r).x,e=(this.last||r).y;return H((s,a)=>{const i=[].concat(this._brush.data);this._app.canvas.addRenderAction(()=>{w.drawBrush({color:this._brush.primaryColor,data:i,x:s,y:a,app:this._app})})},t,e,r.x,r.y,{}),this.last=r,{render:!0}}class q{constructor({app:t,size:e=1,lowres:s=!0,primaryColor:a,secondaryColor:i}){this._app=t,this._size=e,this._lowres=s,this._data=this.getScaledData(this._size),this._primaryColor=a,this._secondaryColor=i}get lowres(){return this._lowres}get data(){return this._data}get size(){return this._size}set size(t=1){this._size=t,this._data=this.getScaledData(this._size)}get primaryColor(){return this._primaryColor||this._app.primaryColor}get secondaryColor(){return this._secondaryColor||this._app.secondaryColor}getData(t){return q.scale([],t)}getScaledData(t=1){return q.scale(this.getData(t),this._app.density)}static scale(t,e){const s=[];for(let a=0;a<t.length*e;a++){s.push([]);for(let i=0;i<t[0].length*e;i++)s[Number(a)].push(t[Math.floor(a/e)][Math.floor(i/e)])}return s}static scaleAsCopy(t,e){const s=[];for(let a=0;a<t.length*e;a++){s.push([]);for(let i=0;i<t[0].length*e;i++)s[Number(a)].push(t[a%t.length][i%t[0].length])}return s}}class Ue extends q{getData(t){return t>1?Ut(t):t?[[1]]:[]}}function Ut(r){r=(r-1)*2;const t=Array(r+1);for(let e=0;e<r+1;e++)t[Number(e)]=Array(r+1).fill(0);return it((e,s)=>{t[Math.round(e)][Math.round(s)]=1},r/2,r/2,r/2,r/2,{filled:!0}),t}function Fe(r){const t=Ut(r+2);for(let e=0;e<t.length;e++)for(let s=0;s<t[Number(e)].length;s++)t[Number(e)][Number(s)]>0&&Math.random()<.15/r?t[Number(e)][Number(s)]=1:t[Number(e)][Number(s)]=0;return t}function He(r){const t=Array(r+1);for(let e=0;e<r+1;e++)t[Number(e)]=Array(r+1).fill(0);return J((e,s)=>{t[Math.round(e)][Math.round(s)]=1},0,0,r,r,{filled:!0}),t}class Me extends q{getData(t){return He(t)}}class Ye extends q{getData(t){return Fe(t)}get data(){return this._data=this.getScaledData(this._size),this._data}}function ct(r){return[Ue,Me,Ye][Number(r)]}class R extends w{constructor(t){super(t),this.COLOR_TRANSPARENT=new N(N.COLOR_TRANSPARENT),this.filled=!1,this.selectedAnchor=null,this.anchors=[],this.anchorBrush=new(ct(0))({app:this._app,size:1,primaryColor:new N(N.COLOR_BLACK),secondaryColor:new N(N.COLOR_WHITE)})}onPointerDown(t){this.startEvent=t}drawAnchors(){const t=[].concat(this.anchorBrush.data);this.anchors.forEach(e=>{this.drawAnchor(e,t)})}drawAnchor(t,e){t.intersectMap={},J((s,a,i)=>{let n=this._app.canvas.getColorFromPixel(s,a);n.alpha===0?n=i?this.anchorBrush.secondaryColor:this.anchorBrush.primaryColor:n.invert(),t.intersectMap[Number(s)]=t.intersectMap[Number(s)]||{},t.intersectMap[Number(s)][Number(a)]=!0,w.drawBrush({color:n,data:e,x:s,y:a,app:this._app})},t.x-5,t.y-5,10,10,{strokeSize:1,filled:!0})}getAnchorByPosition(t,e){return this.anchors.find(s=>s.intersectAnchor(t,e)?s:!1)}addAnchor(t,e){const s=new We(t,e,this.anchorBrush);return this.anchors.push(s),s}reset(){this.anchors=[],this.selectedAnchor=null}}class We{constructor(t,e,s){this.x=t,this.y=e,this.brush=s}intersectAnchor(t,e){return this.intersectMap&&this.intersectMap[Number(t)]&&this.intersectMap[Number(t)][Number(e)]}}class ze extends R{onPointerDown(t){if(this.selectedAnchor){const e=this.getAnchorByPosition(t.x,t.y);if(e)this.selectedAnchor=e;else return this._app.canvas.addRenderAction(()=>{this.render(!1),this.reset()}),{save:!0,render:!0};this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)})}return{render:!0}}onPointerMove(t,e){if(e.pressed)return this.anchors.length<1&&(this.addAnchor(t.x,t.y),this.selectedAnchor=this.addAnchor(t.x,t.y)),this.selectedAnchor.x=t.x,this.selectedAnchor.y=t.y,this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}}render(t=!1){this.anchors.length&&(H((e,s)=>{const a=[].concat(this._brush.data);R.drawBrush({color:this._brush.primaryColor,data:a,x:e,y:s,app:this._app})},this.anchors[0].x,this.anchors[0].y,this.anchors[1].x,this.anchors[1].y,{}),t&&this.drawAnchors())}}class ke extends R{constructor(t){super(t),this.status=0,this.locked=!1}refreshHelperOffset(){this.primaryHelper&&(this.primaryHelperOffset=[this.primaryHelper.x-this.primaryAnchor.x,this.primaryHelper.y-this.primaryAnchor.y]),this.secondaryHelper&&(this.secondaryHelperOffset=[this.secondaryHelper.x-this.secondaryAnchor.x,this.secondaryHelper.y-this.secondaryAnchor.y])}onPointerDown(t){if(this.moved||this.reset(),this.locked)return;this.locked=!0,this.anchors.length===1&&this.reset();const e=this.getAnchorByPosition(t.x,t.y);if(e&&this.selectedAnchor!==e)this.selectedAnchor=e;else{if(this.status===2&&!e)return Ze.bind(this)();this.status===1?Ge.bind(this)():this.selectedAnchor||(this.addAnchor(t.x,t.y),this.selectedAnchor=this.addAnchor(t.x,t.y))}return this._app.canvas.addPassiveRenderAction(()=>{this.render(!0),this.locked=!1}),{render:!0}}get primaryAnchor(){return this.anchors[0]}get secondaryAnchor(){return this.anchors[1]}get primaryHelper(){return this.anchors[2]}get secondaryHelper(){return this.anchors[3]}onPointerUp(){if(this.status<3&&this.status===0)return this.selectedAnchor=null,this.status++,this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}}onPointerMove(t,e){if(e.pressed&&this.selectedAnchor)return this.moved=!0,this.selectedAnchor.x=t.x,this.selectedAnchor.y=t.y,this.selectedAnchor===this.primaryAnchor&&this.primaryHelper?(this.primaryHelper.x=this.selectedAnchor.x+this.primaryHelperOffset[0],this.primaryHelper.y=this.selectedAnchor.y+this.primaryHelperOffset[1]):this.selectedAnchor===this.secondaryAnchor&&this.secondaryHelper?(this.secondaryHelper.x=this.selectedAnchor.x+this.secondaryHelperOffset[0],this.secondaryHelper.y=this.selectedAnchor.y+this.secondaryHelperOffset[1]):(this.selectedAnchor===this.primaryHelper||this.selectedAnchor===this.secondaryHelper)&&this.refreshHelperOffset(),this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}}addPoints(t){t.forEach(e=>{this.points[P(e[0]-1,0,this._app.canvas.width-1)][P(e[1]-1,0,this._app.canvas.height-1)]=!0})}render(t=!1){this.status>1?ve((e,s)=>{const a=[].concat(this._brush.data);w.drawBrush({color:this._brush.primaryColor,data:a,x:e,y:s,app:this._app})},this.primaryAnchor.x,this.primaryAnchor.y,this.primaryHelper.x,this.primaryHelper.y,this.secondaryHelper.x,this.secondaryHelper.y,this.secondaryAnchor.x,this.secondaryAnchor.y):H((e,s)=>{const a=[].concat(this._brush.data);R.drawBrush({color:this._brush.primaryColor,data:a,x:e,y:s,app:this._app})},this.primaryAnchor.x,this.primaryAnchor.y,this.secondaryAnchor.x,this.secondaryAnchor.y,{}),t&&(this.primaryHelper&&H((e,s)=>{let a=this._app.canvas.getColorFromPixel(e,s);a.alpha===0?a=this.anchorBrush.primaryColor:a.invert();const i=[].concat(this.anchorBrush.data);R.drawBrush({color:a,data:i,x:e,y:s,app:this._app})},this.primaryAnchor.x,this.primaryAnchor.y,this.primaryHelper.x,this.primaryHelper.y,{}),this.secondaryHelper&&H((e,s)=>{let a=this._app.canvas.getColorFromPixel(e,s);a.alpha===0?a=this.anchorBrush.primaryColor:a.invert();const i=[].concat(this.anchorBrush.data);R.drawBrush({color:a,data:i,x:e,y:s,app:this._app})},this.secondaryAnchor.x,this.secondaryAnchor.y,this.secondaryHelper.x,this.secondaryHelper.y,{}),this.drawAnchors())}reset(){R.prototype.reset.apply(this,arguments),this.status=0,this.locked=!1}intersect(t,e){const s=[[0,0],[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]];for(let a=0;a<s.length;a++)if(this.points[t+s[Number(a)][0]][e+s[Number(a)][1]])return!0;return!1}}function Ge(){let r=Ot(this.primaryAnchor,this.secondaryAnchor);this.addAnchor(r[0],r[1]),r=Ot(this.secondaryAnchor,this.primaryAnchor),this.addAnchor(r[0],r[1]),this.refreshHelperOffset(),this._app.canvas.addPassiveRenderAction(()=>{this.render(!0),this.locked=!1}),this.status++}function Ze(){return this._app.canvas.addRenderAction(()=>{this.render(!1),this.reset()}),{events:!1,save:!0,render:!0}}function Ot(r,t){const e=Lt(r.x,r.y,t.x,t.y);return e[Math.floor(e.length/4)]}class je extends Y{fill(t,e,s){const a=[[t,e]];let i=0,n,h,d,c,_;const l=this._app.canvas.getColorFromPixel(t,e,!0),o=[[-1,0],[1,0],[0,-1],[0,1]];for(;a.length;){if(i>2e6)throw new Error("FILL OVERFLOW");for(n=a.pop(),t=n[0],e=n[1],this._app.canvas.setPixel(t,e,s,!0),h=0;h<o.length;h++)d=t+o[Number(h)][0],c=e+o[Number(h)][1],d>=0&&d<this._app.canvas.width&&c>=0&&c<this._app.canvas.height&&(_=this._app.canvas.getColorFromPixel(d,c,!0),_.is(l)&&!s.is(_)&&a.push([d,c]));i++}}onPointerDown(t){if(!this._filling){this._filling=!0;const e=t.x,s=t.y,a=this._app.primaryColor;return this._app.canvas.addRenderAction(()=>{this.fill(e,s,a),this._filling=!1}),{save:!0,render:!0}}return{events:!1}}}class Ke extends Bt{constructor(t={}){t.pointerDownHold=!0,super(t)}}class Xe extends R{onPointerMove(t){const e=t.x-this.startEvent.x,s=t.y-this.startEvent.y;return this._app.canvas.addPassiveRenderAction(()=>{J((a,i,n)=>{const h=[].concat(this._brush.data);w.drawBrush({color:n?this._brush.secondaryColor:this._brush.primaryColor,data:h,x:a,y:i,app:this._app})},this.startEvent.x,this.startEvent.y,e,s,{strokeSize:this.filled?0:this._brush.data.length,filled:this.filled})}),{render:!0}}onPointerUp(t){const e=t.x-this.startEvent.x,s=t.y-this.startEvent.y;return this._app.canvas.addRenderAction(()=>{J((a,i,n)=>{const h=[].concat(this._brush.data);w.drawBrush({color:n?this._brush.secondaryColor:this._brush.primaryColor,data:h,x:a,y:i,app:this._app})},this.startEvent.x,this.startEvent.y,e,s,{strokeSize:this.filled?0:this._brush.data.length,filled:this.filled})}),{save:!0,render:!0}}}class Ft extends R{constructor(t){super(t),this._proportinalScale=!1}onPointerMove(t){const e=(t.x-this.startEvent.x)/2;let s=(t.y-this.startEvent.y)/2;if(this._proportinalScale&&(e<0&&s>0||e>0&&s<0?s=e*-1:s=e),e!==0&&s!==0)return this._app.canvas.addPassiveRenderAction(()=>{it((a,i,n)=>{const h=[].concat(this._brush.data);w.drawBrush({color:n?this._brush.secondaryColor:this._brush.primaryColor,data:h,x:a,y:i,app:this._app})},Math.floor(this.startEvent.x+e),Math.floor(this.startEvent.y+s),e,s,{filled:this.filled})}),{render:!0}}onPointerUp(t){const e=(t.x-this.startEvent.x)/2;let s=(t.y-this.startEvent.y)/2;if(this._proportinalScale&&(e<0&&s>0||e>0&&s<0?s=e*-1:s=e),e!==0&&s!==0)return this._app.canvas.addRenderAction(()=>{it((a,i,n)=>{const h=[].concat(this._brush.data);w.drawBrush({color:n?this._brush.secondaryColor:this._brush.primaryColor,data:h,x:a,y:i,app:this._app})},Math.floor(this.startEvent.x+e),Math.floor(this.startEvent.y+s),e,s,{strokeSize:this._brush.data.length,filled:this.filled})}),{save:!0,render:!0}}}class $e extends Ft{constructor(t){super(t),this._proportinalScale=!0,this._func=it}}class Ve extends R{constructor(t){super(t),this.status=0}onPointerMove(t,e){if(e.pressed&&this.selectedAnchor)return this.selectedAnchor.x=t.x,this.selectedAnchor.y=t.y,this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}}onPointerDown(t){const e=this.getAnchorByPosition(t.x,t.y);switch(this.status){case 1:if(e)this.selectedAnchor=e;else return this.status=2,this._app.canvas.addRenderAction(()=>{this.render(!1),this.reset()}),{save:!0,render:!0};break;default:e&&this.anchors[0]===e?(this.status=1,this.selectedAnchor=e):this.selectedAnchor=e||this.addAnchor(t.x,t.y)}return this._app.canvas.addPassiveRenderAction(()=>{this.render(this.status<2)}),{render:!0}}isClosed(){return this.status>0}render(t=!1){xe((s,a)=>{const i=[].concat(this._brush.data);w.drawBrush({color:this._brush.primaryColor,data:i,x:s,y:a,app:this._app})},this.anchors,this.status>0,{filled:this.filled}),t&&this.drawAnchors()}reset(){R.prototype.reset.apply(this,arguments),this.status=0}}class F{constructor(t,e){T(this,"min",p(0,0));T(this,"max",p(0,0));this.min=t||this.min,this.max=e||this.max}}class Je extends R{constructor(t){super(t),this.brushPrimaryColor=new N(N.COLOR_BLACK),this.brushSecondaryColor=new N(N.COLOR_WHITE),this.brush=new(ct(0))({app:this.app,size:1,primaryColor:this.brushPrimaryColor,secondaryColor:this.brushSecondaryColor}),this.reset()}intersect(t){return this.bounds?t.x>this.bounds.min.x&&t.x<this.bounds.max.x&&t.y>this.bounds.min.y&&t.y<this.bounds.max.y:!1}reset(){this.status=0,this.bounds=null,this.intersectedStartEvent=null,this.croppedImageData=null,this.startEvent=null}onPointerDown(t){let e;switch(this.status){case 3:break;case 2:if(this.croppedImageData&&(this.intersectedStartEvent||this.intersect(t)))if(this.intersectedStartEvent=t,t.rightClick)this.status++;else return{events:!0,render:!1};break;case 1:if(e=p(this.bounds.max-this.bounds.min),this.status++,t.rightClick){const s=this.bounds.min.x,a=this.bounds.min.y;this.app.canvas.addRenderAction(()=>{this.app.canvas.fillPixels(this._brush.secondaryColor,s,a,e.x,e.y)})}return this.app.canvas.addPassiveRenderAction(()=>{this.render(this.startEvent.x,this.startEvent.y,!0)}),{events:!0,render:!0};default:return R.prototype.onPointerDown.apply(this,arguments)}}onPointerMove(t,e){if(this.intersectedStartEvent&&e.pressed){const s=this.getRectInfo(t);return this._app.canvas.addPassiveRenderAction(()=>{this.render(s.x,s.y,!0)}),{render:!0}}else if(this.status===0)return this._app.canvas.addPassiveRenderAction(()=>{this.render(t.x,t.y,!0)}),{render:!0}}getRectInfo(t){return{width:this.bounds.max.x-this.bounds.min.x,height:this.bounds.max.y-this.bounds.min.y,x:this.startEvent.x+t.x-this.intersectedStartEvent.x,y:this.startEvent.y+t.y-this.intersectedStartEvent.y}}onPointerUp(t){if(this.status===3)return this.app.canvas.addRenderAction(()=>{const e=this.getRectInfo(t);j.invertImageData(this.croppedImageData),this.render(e.x,e.y,!1),this.reset()}),{save:!0,render:!0};if(this.intersectedStartEvent&&this.status===2){const e=this.getRectInfo(t);return this.startEvent.x=e.x,this.startEvent.y=e.y,this.bounds=new F(p(e.x,e.y),p(e.x+e.width,e.y+e.height)),this._app.canvas.addPassiveRenderAction(()=>{this.render(e.x,e.y,!0)}),{render:!0}}else if(this.startEvent&&this.status===0){const e=t.x-this.startEvent.x,s=t.y-this.startEvent.y;return e>0&&s>0&&(this.bounds=new F(p(this.startEvent.x,this.startEvent.y),p(t.x,t.y)),this.status++,this._app.canvas.addPassiveRenderAction(()=>{this.croppedImageData=j.cropImageData(this.app.canvas.renderImageData,this.bounds.min.x,this.bounds.min.y,e,s),j.invertImageData(this.croppedImageData),this.render(this.startEvent.x,this.startEvent.y,!0)})),{render:!0}}}render(t,e,s){let a=p(0,0),i=p(t,e);this.bounds?a=p(()=>this.bounds.max-this.bounds.min):(a=p(()=>i-this.startEvent.position),i=this.startEvent.position),this.croppedImageData&&this.app.canvas.putImageData(this.croppedImageData,i.x,i.y),s&&J((n,h)=>{const d=[].concat(this._brush.data);let c=this._app.canvas.getColorFromPixel(n,h);c.alpha===0?c=this.brushPrimaryColor:c.invert(),w.drawBrush({color:c,data:d,x:n,y:h,app:this._app})},i.x,i.y,a.x,a.y,{strokeSize:this._brush.data.length,filled:this.filled,density:3})}}class qe extends R{constructor(t){super(t),this.brushPrimaryColor=new N(N.COLOR_BLACK),this.brushSecondaryColor=new N(N.COLOR_WHITE),this.brush=new(ct(0))({app:this.app,size:1,primaryColor:this.brushPrimaryColor,secondaryColor:this.brushSecondaryColor}),this._moving=!1}onPointerMove(t){const e=t.x-this.startEvent.x,s=t.y-this.startEvent.y;return this._moving||(this._moving=!0,this._app.canvas.addPassiveRenderAction(()=>{J((a,i)=>{const n=[].concat(this._brush.data);let h=this._app.canvas.getColorFromPixel(a,i);h.alpha===0?h=this.brushPrimaryColor:h.invert(),w.drawBrush({color:h,data:n,x:a,y:i,app:this._app})},this.startEvent.x,this.startEvent.y,e,s,{strokeSize:this._brush.data.length,filled:!1}),this._moving=!1})),{render:!0}}onPointerUp(t){this._app.canvas.cleanPassiveRenderActions();const e=p(t),s=p(this.startEvent),a=ut(()=>Math.floor(e-s));if(a.x>0&&a.y>0){const i=new F(s,e),n=this.app.display,h=ut(()=>Math.floor(n.canvasLayout.naturalSize/a*n.zoomFactor)),d=ut(()=>i.min+a/2);this.app.display.setZoom(h.x>h.y?h.x:h.y,d)}return{render:!0}}}class Qe extends Y{onPointerDown(t){const e=this.app.display;let s=2;return e.maxZoomFactor-5<e.zoomFactor&&(s=1),s=x.altActive?-s:s,this.app.display.zoom(s,new vt(t.x,t.y)),{events:!1}}}class ts extends Y{constructor(t){super(t),this.passive=!0}onActive(){this.app.canvas.revertStack()}}class es extends Y{constructor(t){super(t),this.passive=!0}onActive(){this.app.canvas.clearStack()}}function ss(r){return[Bt,Le,ze,ke,je,Ke,Xe,$e,Ft,Ve,Je,Y,Y,Y,qe,Qe,ts,es][Number(r)]}var ot,tt,Z,bt,U,L,K,O,X;class rs{constructor(t){D(this,ot,Xt());T(this,"events",new wt);D(this,tt,new F);D(this,Z,p());T(this,"canvasLayout",rt({size:M(p()),naturalSize:M(p()),position:M(p())}));D(this,bt,new F);D(this,U,null);D(this,L,null);D(this,K,void 0);D(this,O,void 0);D(this,X,void 0);T(this,"zoomFactor",1);T(this,"maxZoomFactor",20);T(this,"zoomPosition",p(.5,.5));T(this,"zoomBounds",new F);T(this,"offset",at());T(this,"cursorVisible",!1);this.app=t,this.cursorColor=new N(N.COLOR_BLACK),this.resetZoom()}showCursor(){this.cursorVisible=!0}hideCursor(){this.cursorVisible=!1,this.renderImageData()}setElement(t){S(this,K,t)}setCanvas(t){S(this,O,t),S(this,X,t.getContext("2d")),Object.values(this.app.inputs).forEach(e=>{e.registerDisplay(this)})}destroy(){this.events.next(new k("destroy")),Object.values(this.app.inputs).forEach(t=>{t.unregisterDisplay(this)})}get canvas(){return f(this,O)}get id(){return f(this,ot)}get bounds(){return f(this,tt)}get imageData(){return f(this,U)}set imageData(t){S(this,L,S(this,U,t)),this.maxZoomFactor=20,this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.renderImageData()}get canvasSize(){return p(f(this,O).width,f(this,O).height)}get naturalSize(){return p(f(this,O).width,f(this,O).height)}get naturalWidth(){return f(this,U).width}get naturalHeight(){return f(this,U).height}get width(){return this.zoomBounds.max.x-this.zoomBounds.min.x}get height(){return this.zoomBounds.max.y-this.zoomBounds.min.y}get zoomFactorWidth(){return f(this,O).width/this.zoomFactor}setSize(t,e){let s;"x"in t?s=t:s=p(t,e),S(this,Z,s),this.events.next(new k("change:size",s)),this.canvasAdjustment()}canvasAdjustment(){this.canvasLayout.size=p(()=>Math.min(Math.max(this.app.canvas.size*this.zoomFactor,0),f(this,Z))),this.canvasLayout.naturalSize=this.app.canvas.size,this.canvasLayout.position=p(0,0)}setZoom(t=1,e=p()){t=Math.min(t,this.maxZoomFactor),t>=0&&(this.zoomFactor=t,this.canvasAdjustment(),this.zoomPosition=p(()=>e/this.canvasLayout.naturalSize),this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.resetOffset(),window.requestAnimationFrame(()=>{this.renderImageData(),this.events.next(new k("change:zoomFactor",t))}))}zoom(t=1,e=p()){this.zoomFactor+t>=0&&this.setZoom(this.zoomFactor+t,e)}renderImageData(){S(this,L,f(this,U));const t=p(()=>this.zoomBounds.max-this.zoomBounds.min),e=p(()=>p(this.offset)+this.zoomBounds.min);S(this,L,j.cropImageData(f(this,L),e.x,e.y,t.x,t.y)),S(this,L,j.resizeImageData(f(this,L),this.zoomFactor)),this.renderCanvas()}get cursorColor(){return this._cursorColor}set cursorColor(t){this._cursorColorRGBA=t.toRGBA(),this._cursorColor=t}get size(){return f(this,Z)}renderCanvas(){f(this,L)&&(f(this,X).putImageData(f(this,L),-this.offset.x,-this.offset.y),this.renderRaster())}reset(){this.resetZoom(),this.resetOffset(),this.renderCanvas()}resetOffset(){this.offset=at(0,0)}resetZoom(){f(this,U)&&this.setZoom(1)}renderRaster(){const t=[];this.zoomFactor>this.maxZoomFactor-3&&t.push({size:p(1,1),width:1,color:"#CCCCCC"});const e=f(this,X);e.globalCompositeOperation="destination-over",t.forEach(s=>{const a=p(()=>this.canvasLayout.naturalSize/s.size);e.lineWidth=s.width,e.beginPath();for(let i=0;i<a.x+1;i++){const n=Math.floor(i*s.size.x*this.zoomFactor)+s.width/2;e.moveTo(n,0),e.lineTo(n,f(this,O).height);for(let h=0;h<a.y+1;h++){const d=Math.floor(h*s.size.y*this.zoomFactor)+s.width/2;e.moveTo(0,d),e.lineTo(f(this,O).width,d)}}e.strokeStyle=s.color,e.stroke()})}refresh(){const t={left:f(this,O).offsetLeft+f(this,K).offsetLeft,top:f(this,O).offsetTop+f(this,K).offsetTop,width:f(this,O).offsetWidth,height:f(this,O).offsetHeight};S(this,tt,new F(p(t.left,t.top),p(t.left+t.width,t.top+t.height))),f(this,U)&&this.renderImageData()}setOffset(t){this.offset=at(t.x,t.y)}calculateZoomBounds(t,e){e=e||1;const s=this.app.canvas.size;t=p(()=>Math.floor(t*s));const a=p(()=>f(this,Z)/s),i=p(()=>Math.ceil(Math.min(a/e*s,s))),n=p(()=>Math.min(Math.max(t-Math.ceil(i/2),0),s-i)),h=p(()=>n+i);return new F(n,h)}}ot=new WeakMap,tt=new WeakMap,Z=new WeakMap,bt=new WeakMap,U=new WeakMap,L=new WeakMap,K=new WeakMap,O=new WeakMap,X=new WeakMap;const as={FULL:0,HALF:1,THIRD:2,QUARTER:3};var $,et,st,V;class is{constructor(t){T(this,"subscription",new Rt);T(this,"events",new wt);D(this,$,void 0);T(this,"fsItem");T(this,"options",{size:{width:300,height:200},display:{foreground:"#FFFFFF",background:"#000000"}});D(this,et,1);T(this,"displaySplit",as.FULL);T(this,"displays",Vt([]));T(this,"displaysEl");T(this,"displaysLayout",{size:p()});T(this,"display");D(this,st,void 0);T(this,"primaryColor");T(this,"secondaryColor");D(this,V,void 0);T(this,"brush");T(this,"brushSelect",{size:1,index:0});T(this,"colorSelect",rt({primaryColor:M(new N(N.COLOR_BLACK)),secondaryColor:M(new N(N.COLOR_WHITE)),paletteSteps:M(new N(2,1,1))}));T(this,"tool");T(this,"toolSelect",{value:"",index:1,filled:!1});T(this,"cursorCanvas",null);S(this,$,t),S(this,st,new j(this)),this.primaryColor=this.colorSelect.primaryColor,this.secondaryColor=this.colorSelect.secondaryColor,this.setBrush(this.brushSelect),this.setTool(this.toolSelect),this.subscription.add(qt.resize.subscribe(this.onViewportRefresh.bind(this))),S(this,V,{keyboard:new ye(this),mouse:new Pe(this)}),Object.values(f(this,V)).forEach(e=>{e.register()})}setDisplaysElement(t){this.displaysEl=t}refresh(){this.displaysLayout={size:p(this.displaysEl.offsetWidth,this.displaysEl.offsetHeight)},this.refreshDisplayPositions(),this.refreshDisplays()}setDisplay(t){this.display&&this.display.hideCursor(),this.display=t,this.display.showCursor()}updateGlobalBounds(t){S(this,$,t)}reset(){this.canvas.clearStack(),this.displays.value.forEach(t=>t.reset())}destroy(){this.subscription.unsubscribe()}refreshDisplays(){this.displays.value.forEach(t=>{t.refresh()})}onViewportRefresh(){this.refreshDisplays()}addDisplay(t){return t=M(t||new rs(this)),this.displays.value.push(t),t.app=this,this.events.next(new k("addDisplay",t,this)),this.canvas.render(),t}clearDisplays(){this.displays.value.forEach(t=>{t.destroy(),this.events.next(new k("removeDisplay",t,this))}),this.displays.value=[]}getDisplay(t){return this.displays.value.find(e=>e.id===t?e:!1)}get inputs(){return f(this,V)}get globalBounds(){return f(this,$)}get canvas(){return f(this,st)}get density(){return f(this,et)}set density(t){S(this,et,t)}setBrush({index:t,size:e}){this.brush=new(ct(t))({app:this,size:e}),this.tool&&(this.tool.brush=this.brush),this.events.next(new k("change:brush",this.brush,this))}setBrushSize(t){this.brush.size=t}setTool({index:t}){const e=new(ss(t))({app:this,brush:this.brush});this.tool=e,this.tool.onActive(),this.events.next(new k("change:tool",this.tool,this))}get paletteSteps(){return this.colorSelect.paletteSteps}set paletteSteps(t){this.colorSelect.paletteSteps=t}refreshDisplayPositions(){const t=this.displaysLayout.size.x,e=this.displaysLayout.size.y;let s=[[[1,1]],[[.5,1],[.5,1]],[[1,.5],[1,.5]],[[1,.5],[.5,.5],[.5,.5]],[[.5,.5],[.5,.5],[1,.5]],[[.5,.5],[.5,.5],[.5,.5],[.5,.5]]].filter(a=>a.length===this.displays.value.length?a:!1);s=s[0],this.displays.value.forEach((a,i)=>{a.setSize(at(Math.floor(t*s[Number(i)][0]),Math.floor(e*s[Number(i)][1]))),s[Number(i)][0]<1,s[Number(i)][1]<1})}}$=new WeakMap,et=new WeakMap,st=new WeakMap,V=new WeakMap;function ns(r){const t=r.modules.windows;return async({modules:e})=>{const s=r.addExecution(),[a]=await Promise.all([v(()=>import("./WebPainting.56805fc7.js"),["./WebPainting.56805fc7.js","./index.0712caa6.js","./entry.9fb9bafb.js","./index.56665add.js","./index.c26f1597.css","./layout.28a82e5a.js","./viewport.8757096e.js","./math.571b3f1f.js","./async.8020bbf7.js","./WebPainting.747ce1dd.css"],import.meta.url).then(c=>c.default)]),i=r.modules.screen.contentLayout,n=M(new is(new F(i.position,p(()=>i.position+i.size))));n.options.display.background=r.config.get(nt.WEB_PAINTING_DISPLAY_BACKGROUND),n.options.display.foreground=r.config.get(nt.WEB_PAINTING_DISPLAY_FOREGROUND);const h=rt({fsItem:null,app:n}),d=t.addWindow({title:"WebPainting - Extras 1.3",component:a,componentData:{model:h},options:{scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1,embed:!0}},{group:"extras13WebPainting",full:!0});h.actions={close:()=>{d.close()},focus:()=>{d.focus()}},s()}}const nt={WEB_PAINTING_DISPLAY_BACKGROUND:"extras13_web_painting_display_background",WEB_PAINTING_DISPLAY_FOREGROUND:"extras13_web_painting_display_foreground"},os={[nt.WEB_PAINTING_DISPLAY_BACKGROUND]:"#CCCCCC",[nt.WEB_PAINTING_DISPLAY_FOREGROUND]:"#FFFFFF"},Ts={CONTENT:"content",OUTPUT_TYPE:"type"},hs=({core:r})=>(r.config.setDefaults(be),r.config.setDefaults(os),r.config.setDefaults(le),{locked:!0,meta:[[A.SYMBOL,y.DISK_WORKBENCH13],[A.WINDOW_SIZE,p(320,220)],[A.WINDOW_POSITION,p(310,10)],[A.WINDOW_SYMBOL_REARRANGE,!0]],name:"Extras 1.3",items:[{meta:[[A.SYMBOL,y.SYNTHESIZER]],id:"Synthesizer.app",name:"Synthesizer",createdDate:new Date(2023,8,4).getTime(),editedDate:new Date(2023,8,4).getTime(),action:Te(r)},{meta:[[A.SYMBOL,y.WEB_PAINTING]],id:"WebPainting.app",name:"WebPainting",createdDate:new Date(2017,7,5).getTime(),editedDate:new Date(2020,3,14).getTime(),action:ns(r)},{meta:[[A.SYMBOL,y.WEB_BASIC],[A.WINDOW_SIZE,p(360,200)]],id:"WebBasic.app",name:"WebBasic",createdDate:new Date(2017,7,5).getTime(),editedDate:new Date(2020,3,14).getTime(),action:oe(r)},ce]}),bs=Object.freeze(Object.defineProperty({__proto__:null,default:hs},Symbol.toStringTag,{value:"Module"}));export{is as A,F as B,g as C,as as D,_s as G,me as I,pe as K,de as N,Ts as P,_e as a,Ae as b,N as c,nt as d,rs as e,m as f,ge as g,he as h,yt as i,bs as j,It as r};
