var T=t=>{throw TypeError(t)};var C=(t,r,e)=>r.has(t)||T("Cannot "+e);var i=(t,r,e)=>(C(t,r,"read from private field"),e?e.call(t):r.get(t)),c=(t,r,e)=>r.has(t)?T("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(t):r.set(t,e),a=(t,r,e,s)=>(C(t,r,"write to private field"),s?s.call(t,e):r.set(t,e),e);import{j as K,a as U,E as W,S as $,e as Y,O as L,k as R,l as z,_ as G}from"./BxO05Tpb.js";var F=K(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),x=function(t){U(r,t);function r(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r.prototype.lift=function(e){var s=new B(this,this);return s.operator=e,s},r.prototype._throwIfClosed=function(){if(this.closed)throw new F},r.prototype.next=function(e){var s=this;R(function(){var n,o;if(s._throwIfClosed(),!s.isStopped){s.currentObservers||(s.currentObservers=Array.from(s.observers));try{for(var l=z(s.currentObservers),u=l.next();!u.done;u=l.next()){var w=u.value;w.next(e)}}catch(A){n={error:A}}finally{try{u&&!u.done&&(o=l.return)&&o.call(l)}finally{if(n)throw n.error}}}})},r.prototype.error=function(e){var s=this;R(function(){if(s._throwIfClosed(),!s.isStopped){s.hasError=s.isStopped=!0,s.thrownError=e;for(var n=s.observers;n.length;)n.shift().error(e)}})},r.prototype.complete=function(){var e=this;R(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var s=e.observers;s.length;)s.shift().complete()}})},r.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(r.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),r.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},r.prototype._innerSubscribe=function(e){var s=this,n=this,o=n.hasError,l=n.isStopped,u=n.observers;return o||l?W:(this.currentObservers=null,u.push(e),new $(function(){s.currentObservers=null,Y(u,e)}))},r.prototype._checkFinalizedStatuses=function(e){var s=this,n=s.hasError,o=s.thrownError,l=s.isStopped;n?e.error(o):l&&e.complete()},r.prototype.asObservable=function(){var e=new L;return e.source=this,e},r.create=function(e,s){return new B(e,s)},r}(L),B=function(t){U(r,t);function r(e,s){var n=t.call(this)||this;return n.destination=e,n.source=s,n}return r.prototype.next=function(e){var s,n;(n=(s=this.destination)===null||s===void 0?void 0:s.next)===null||n===void 0||n.call(s,e)},r.prototype.error=function(e){var s,n;(n=(s=this.destination)===null||s===void 0?void 0:s.error)===null||n===void 0||n.call(s,e)},r.prototype.complete=function(){var e,s;(s=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||s===void 0||s.call(e)},r.prototype._subscribe=function(e){var s,n;return(n=(s=this.source)===null||s===void 0?void 0:s.subscribe(e))!==null&&n!==void 0?n:W},r}(x),S;class H{constructor(){c(this,S,new Map)}get items(){return i(this,S)}add(r,e){Array.isArray(r)?r.forEach(s=>{this.add(...s)}):i(this,S).set(r,[].concat(e))}get(...r){const e=r.shift();return i(this,S).get(e).map(s=>r.reduce((n,o)=>n.replace(/%\d+/,o),s))}}S=new WeakMap;const y=new H;y.add("bad_args","Bad args");y.add("cant_find","Can't find %1");const J="/",N="ROOT",oe="CLOUD";function ae(t){return typeof t=="object"&&"id"in t?t.id:t.replace(/.*[\\/:]{1,1}([^:\\/]+)$/,"$1")}function ce(t){return/^[a-zA-Z0-9_-]+:/.test(t)}function ue(...t){return t.reduce((r,e)=>(r.push(...e.replace(/[\\/]+/,"/").replace(/^\//,"").replace(/\/$/,"").split("/")),r),[]).join("/").replace(/\/$/,"")}function le(t){return t.replace(/(.*)[:/]([^\\/:]+)/,"$1")}function he(t){return t.replace(/(.*)\/([^\\/]+)/,"$2")}function de(t){return t.replace(/(.*[\\/:]{1,1})[^:\\/]+$/,"$1")}function V(t){return t.length&&/^[\w .\\/:-]+$/.test(t)}function fe(t){return V(t)&&!!(t.includes("/")||t.match(/^([^:]+):.*/))}function _e(t){return t*1e3}function Z(t){return t.replace(/^(.*)\.[^.]+$/,"$1")}function j(t){const r=t.match(/^.*\.([^.]*)$/);return r?r[1]:""}function X(t){return t.replace(/[^.a-zA-Z0-9_-]/g,"_")}function P(t,r){return r?`${Z(t)}.${r}`:t}function q(t,r,e){let s=t;return r.hasItem(P(s,e))?(s=`copy_${t}`,r.hasItem(P(s,e))?q(s,r,e):s):s}function pe(t){if(t.getStorageItem()){if(t.getStorageItem().locked)throw y.get("FileSystem_permissionsNeeded");return t}return t}async function Se(t,r){return t.getStorageItem()&&(await t.save(),await t.getStorageItem().save()),t}async function ge(t,r){const e=await r.remove(t);return Array.isArray(e)?e:[e]}const f={DEFAULT:"default",DIRECTORY:"directory",DIRECTORY_PREFS:"directory_prefs",CLOUD_DISK:"cloud_disk",HARD_DISK:"hard_disk",RAM_DISK:"ram_disk",TMP_DISK:"tmp_disk",DISK_1:"disk_1",DISK_2:"disk_2",DISK_WORKBENCH13:"disk_workbench13",DISK_MARKDOWN:"disk_markdown",DISK_BASIC:"disk_basic",WORK:"work",CONSOLE:"console",SETTINGS:"settings",TRASHCAN:"trashcan",COMPUTER_1:"computer_1",TELEPHONE:"telephone",CURSOR:"cursor",PREFERENCE:"preference",WEB_BASIC:"web_basic",WEB_PAINTING:"web_painting",COLORS:"colors",PRINT_1:"print_1",PRINT_2:"print_2",NOTEPAD:"notepad",BASIC:"basic",IMAGE:"image",NOTE:"note",NOTE_BLANK:"note_blank",LARGE_NOTE:"large_note",LARGE_NOTE_RICH:"large_note_rich",FULLSCREEN:"fullscreen",CALCULATOR:"calculator",CLOCK:"clock",KEYBOARD_QUESTION:"keyboard_question",LARGE_NOTEPAD:"large_notepad",LARGE_NOTEPAD_HELP:"large_notepad_help",RABBIT:"rabbit",MORE:"more",SAY:"say",GITHUB:"github",LAMMPEE:"lammpee",CUBY:"cuby",NUXT:"nuxt",CLOWN:"clown",DISALLOW_1:"disallow_1",COPY_1:"copy_1",COPY_2:"copy_2",DISPLAY_KEYBOARD:"display_keyboard",PALETTE:"palette",SIGN_1:"sign_1",DOCUMENT_EDITOR:"document_editor",DOCUMENT_READER:"document_reader",SYNTHESIZER:"synthesizer",VUE_SEMANTIC_STRUCTURE:"vue_semantic_structure",NUXT_BOOSTER:"nuxt_booster"};class D{constructor(r,e){this.name=r,this.value=e}}function Q(t){return/^"([^"]*)"$/.test(t)}function Ee(t){return Q(t)?t:(t=ee(t),`"${t}"`)}function Ie(t){return t.replace(/[ ]*(.+)[ ]+/)}function ee(t){return typeof t!="string"?t:t.replace(/^[ ]*"(.*)"[ ]*$/,"$1").replace(/\\"/g,'"')}function be(t){return!isNaN(t)}function me(t){return decodeURIComponent(globalThis.atob(t))}function te(t){return globalThis.btoa(encodeURIComponent(t))}const k={SYMBOL:"symbol",VISIBLE:"visible",POSITION:"position",WINDOW_SYMBOL_REARRANGE:"window_symbol_rearrange",WINDOW_SIZE:"window_size",WINDOW_POSITION:"window_position",WINDOW_SCALE:"window_scale",WINDOW_SCROLL_X:"window_scroll_x",WINDOW_SCROLL_Y:"window_scroll_y",WINDOW_FULL_SIZE:"window_full_size",WINDOW_SIDEBAR:"window_sidebar",WEB_URL:"web_url",IGNORE_SYMBOL_REARRANGE:"ignore_symbol_rearrange"},re={basic:f.BASIC,bas:f.BASIC,markdown:f.DISK_MARKDOWN,md:f.DISK_MARKDOWN,image:f.IMAGE,img:f.IMAGE};function se(t,r=f.NOTE_BLANK){const e=j(t).toLowerCase();return re[String(e)]||r}var O,g,_,E,I,h,p,b,d,v;const m=class m{constructor({locked:r=!1,id:e=null,name:s=null,meta:n=[],data:o=null,action:l=null,createdDate:u=Date.now(),editedDate:w=null}){c(this,O);c(this,g,!1);c(this,_,null);c(this,E);c(this,I);c(this,h);c(this,p);c(this,b);c(this,d);c(this,v);if(a(this,O,new x),a(this,E,u),a(this,I,w||u),a(this,g,r),a(this,h,e),a(this,p,s),a(this,b,new Map([[k.SYMBOL,se(e||"",this.constructor.SYMBOL)],[k.VISIBLE,!0]].concat(n||[]))),typeof o=="string")try{o=JSON.parse(o)}catch(A){throw console.log(o),new Error(A)}a(this,v,l),this.data=o||{}}async remove(r){const{silent:e}=Object.assign({silent:!1},r);let s;const n=this.isLocked();if(!n)s={type:this.constructor.NAME,id:this.id,name:this.name,path:await this.getPath(),size:this.size,storage:this.getStorageItem()};else if(!e)return y.get("FileSystemItem_itemLocked",await this.getPath());return(e||!n)&&(this.events.next(new D("remove",this)),this.events.unsubscribe(),this.parent.removeItem(this)),s}isLocked(r){return r?!1:this.parent&&this.parent.locked&&this.parent.id!==N?!0:i(this,g)}getStorageItem(){return"storage"in this?this:this.parent?this.parent.getStorageItem():null}async copy(){const r=this.constructor;let e=await this.export({encodeData:!1});return e=new r(e),Promise.resolve(e)}rename(r,e){const{name:s=!1,ignore:n=!1}=Object.assign({name:!1,ignore:!1},e);if(!this.isLocked(n)){if(s)return this.name=r,this;{const o=this.id;a(this,h,X(r)),this.parent&&o!==this.id&&this.parent.changeItemId(this,o,this.id)}this.events.next(new D("rename",{name:s,id:r}))}return this}save(){this.events.next(new D("save",this))}get type(){return this.constructor.NAME}async export(r){const{encodeData:e}=Object.assign({encodeData:!0},r),s=new Map(i(this,b));return Array.from(s.keys()).forEach(n=>{s.get(n)instanceof G&&s.set(n,s.get(n).toJSON())}),{type:this.type,id:i(this,h),name:i(this,p),createdDate:i(this,E),editedDate:i(this,I),data:e?await te(i(this,d)):i(this,d),meta:Array.from(s)}}get createdDate(){return i(this,E)}get editedDate(){return i(this,I)}get data(){if(typeof i(this,d)=="string")try{return JSON.parse(i(this,d))}catch(r){return console.error(r),{data:i(this,d)}}return i(this,d)}set data(r){typeof r=="object"&&(r=JSON.stringify(r)),a(this,d,r)}get action(){return i(this,v)}get events(){return i(this,O)}get parent(){return i(this,_)}setId(r){a(this,h,r)}setParent(r){a(this,_,r)}get locked(){return i(this,_)?i(this,_).locked:i(this,g)}get id(){return i(this,h)}get name(){return i(this,p)||i(this,h)}set name(r){a(this,p,r)}get extension(){return j(i(this,h))}get meta(){return i(this,b)}get size(){return new Blob([Object.values(this.data)]).size}get maxSize(){return new Blob([Object.values(this.data)]).size}getBase(){return m.getBaseRecursive({item:this},!1)}getPath(){return m.getBaseRecursive({item:this})}static getBaseRecursive({item:r,path:e=[]},s=!0){if(s&&e.push(r.id),r.parent)return m.getBaseRecursive({item:r.parent,path:e});if(e=e.reverse(),e[0]===N&&e.shift(),e.length>0){let n=e[0];return/\./.test(n)||(n+=":"),`${n}${e.slice(1,e.length).join(J)}`}else return N}};O=new WeakMap,g=new WeakMap,_=new WeakMap,E=new WeakMap,I=new WeakMap,h=new WeakMap,p=new WeakMap,b=new WeakMap,d=new WeakMap,v=new WeakMap;let M=m;y.add([["FileSystemItem_itemLocked",["Item Locked","Item is locked, can't be edit… %1"]]]);export{te as A,oe as C,D as E,k as I,f as S,x as a,M as b,ee as c,me as d,y as e,P as f,j as g,q as h,Q as i,V as j,_e as k,ae as l,de as m,fe as n,pe as o,le as p,he as q,Z as r,Se as s,ce as t,ue as u,ge as v,X as w,be as x,Ie as y,Ee as z};
