(window.webpackJsonp=window.webpackJsonp||[]).push([[3,39],{343:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var o=n(403),r=new(n(402).a)(o.a)},365:function(t,e,n){"use strict";n.r(e),n.d(e,"DISPLAY_SPLIT_VALUES",(function(){return x})),n.d(e,"default",(function(){return P}));n(57),n(268),n(34),n(262),n(267),n(35);var o=n(254),r=n(255),c=n(260),h=n(261),l=n(428),f=n(298),d=n(336),v=n(306),y=n(418),O=n(413),j=n(497),m=n(339),k=n(396),z=n(479),w=n(333),x={FULL:0,HALF:1,THIRD:2,QUARTER:3},D=Object(h.a)("globalBounds"),C=Object(h.a)("density"),_=Object(h.a)("canvas"),S=Object(h.a)("inputs"),P=function(){function t(e){Object(o.a)(this,t),this.events=new l.a,Object.defineProperty(this,D,{writable:!0,value:void 0}),this.fsItem=void 0,this.options={size:{width:300,height:200},display:{foreground:"#FFFFFF",background:"#000000"}},Object.defineProperty(this,C,{writable:!0,value:1}),this.displaySplit=x.FULL,this.displays=[],this.displaysEl=void 0,this.displaysLayout={size:Object(f.e)()},this.display=void 0,Object.defineProperty(this,_,{writable:!0,value:void 0}),this.primaryColor=void 0,this.secondaryColor=void 0,Object.defineProperty(this,S,{writable:!0,value:void 0}),this.brush=void 0,this.brushSelect={size:1,index:0},this.colorSelect={index:0,primaryColor:new v.default(v.default.COLOR_BLACK),secondaryColor:new v.default(v.default.COLOR_WHITE),paletteSteps:new v.default(2,1,1)},this.tool=void 0,this.toolSelect={value:"",index:1,filled:!1},this.cursorCanvas=null,Object(c.a)(this,D)[D]=e,Object(c.a)(this,_)[_]=new d.default(this),this.primaryColor=this.colorSelect.primaryColor,this.secondaryColor=this.colorSelect.secondaryColor,this.setBrush(this.brushSelect),this.setTool(this.toolSelect),this.subscriptions=[z.a.resize.subscribe(this.onViewportRefresh.bind(this))],Object(c.a)(this,S)[S]={keyboard:new y.default(this),mouse:new O.default(this)},Object.values(Object(c.a)(this,S)[S]).forEach((function(input){input.register()}))}return Object(r.a)(t,[{key:"setDisplaysElement",value:function(t){this.displaysEl=t}},{key:"refresh",value:function(){this.displaysLayout={size:Object(f.e)(this.displaysEl.offsetWidth,this.displaysEl.offsetHeight)},this.refreshDisplayPositions(),this.refreshDisplays()}},{key:"setDisplay",value:function(t){this.display&&this.display.hideCursor(),this.display=t,this.display.showCursor()}},{key:"updateGlobalBounds",value:function(t){Object(c.a)(this,D)[D]=t}}]),Object(r.a)(t,[{key:"reset",value:function(){this.canvas.clearStack(),this.displays.forEach((function(t){return t.reset()}))}},{key:"destroy",value:function(){this.subscriptions.forEach((function(t){return t.unsubscribe()}))}},{key:"refreshDisplays",value:function(){this.displays.forEach((function(t){t.refresh()}))}},{key:"onViewportRefresh",value:function(){this.refreshDisplays()}},{key:"addDisplay",value:function(t){return t=t||new k.default(this),this.displays.push(t),t.app=this,this.events.next(new w.a("addDisplay",t,this)),this.canvas.render(),t}},{key:"clearDisplays",value:function(){var t=this;this.displays.forEach((function(e){e.destroy(),t.events.next(new w.a("removeDisplay",e,t))})),this.displays=[]}},{key:"getDisplay",value:function(t){return this.displays.find((function(e){if(e.id===t)return e}))}},{key:"setBrush",value:function(t){var e=t.index,n=t.size;this.brush=new(Object(m.getBrushByIndex)(e))({app:this,size:n}),this.tool&&(this.tool.brush=this.brush),this.events.next(new w.a("change:brush",this.brush,this))}},{key:"setBrushSize",value:function(t){this.brush.size=t}},{key:"setTool",value:function(t){var e=t.index,n=new(Object(j.getToolByIndex)(e))({app:this,brush:this.brush});this.tool=n,this.tool.onActive(),this.events.next(new w.a("change:tool",this.tool,this))}},{key:"refreshDisplayPositions",value:function(){var t=this,e=this.displaysLayout.size.x,n=this.displaysLayout.size.y,o=[[[1,1]],[[.5,1],[.5,1]],[[1,.5],[1,.5]],[[1,.5],[.5,.5],[.5,.5]],[[.5,.5],[.5,.5],[1,.5]],[[.5,.5],[.5,.5],[.5,.5],[.5,.5]]].filter((function(e){if(e.length===t.displays.length)return e}));o=o[0],this.displays.forEach((function(t,i){t.setSize(Object(f.f)(Math.floor(e*o[Number(i)][0]),Math.floor(n*o[Number(i)][1]))),o[Number(i)][0],o[Number(i)][1]}))}},{key:"inputs",get:function(){return Object(c.a)(this,S)[S]}},{key:"globalBounds",get:function(){return Object(c.a)(this,D)[D]}},{key:"canvas",get:function(){return Object(c.a)(this,_)[_]}},{key:"density",get:function(){return Object(c.a)(this,C)[C]},set:function(t){Object(c.a)(this,C)[C]=t}},{key:"paletteSteps",get:function(){return this.colorSelect.paletteSteps},set:function(t){this.colorSelect.paletteSteps=t}}]),t}()},396:function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"default",(function(){return P}));n(34),n(267),n(35);var o=n(31),r=n(254),c=n(255),h=n(260),l=n(261),f=n(902),d=n(428),v=n(298),y=n(336),O=n(306),j=n(320),m=n(333),k=Object(l.a)("id"),z=Object(l.a)("bounds"),w=Object(l.a)("cropBounds"),x=Object(l.a)("imageData"),D=Object(l.a)("tmpImageData"),C=Object(l.a)("el"),_=Object(l.a)("canvas"),S=Object(l.a)("context"),P=function(){function e(t){Object(r.a)(this,e),Object.defineProperty(this,k,{writable:!0,value:Object(f.a)()}),this.events=new d.a,Object.defineProperty(this,z,{writable:!0,value:new j.default}),this.size=Object(v.e)(),this.canvasLayout={size:Object(v.e)(),naturalSize:Object(v.e)(),position:Object(v.e)()},Object.defineProperty(this,w,{writable:!0,value:new j.default}),Object.defineProperty(this,x,{writable:!0,value:null}),Object.defineProperty(this,D,{writable:!0,value:null}),Object.defineProperty(this,C,{writable:!0,value:void 0}),Object.defineProperty(this,_,{writable:!0,value:void 0}),Object.defineProperty(this,S,{writable:!0,value:void 0}),this.zoomFactor=1,this.zoomPosition=Object(v.e)(.5,.5),this.zoomBounds=new j.default,this.offset=Object(v.f)(),this.cursorVisible=!1,this.app=t,this.cursorColor=new O.default(O.default.COLOR_BLACK),this.resetZoom()}return Object(c.a)(e,[{key:"showCursor",value:function(){this.cursorVisible=!0}},{key:"hideCursor",value:function(){this.cursorVisible=!1,this.renderImageData()}},{key:"setElement",value:function(element){Object(h.a)(this,C)[C]=element}},{key:"setCanvas",value:function(canvas){var t=this;Object(h.a)(this,_)[_]=canvas,Object(h.a)(this,S)[S]=canvas.getContext("2d"),Object.values(this.app.inputs).forEach((function(input){input.registerDisplay(t)}))}},{key:"destroy",value:function(){var t=this;this.events.next(new m.a("destroy")),Object.values(this.app.inputs).forEach((function(input){input.unregisterDisplay(t)}))}},{key:"setSize",value:function(t,e){var n;n="object"===Object(o.a)(t)?t:Object(v.e)(t,e),this.size=n,this.events.next(new m.a("change:size",n)),this.canvasAdjustment()}},{key:"canvasAdjustment",value:function(){var t=this;this.canvasLayout.size=Object(v.e)((function(){return Math.min(Math.max(t.app.canvas.size*t.zoomFactor,0),t.size)})),this.canvasLayout.naturalSize=this.app.canvas.size,this.canvasLayout.position=Object(v.e)(0,0)}},{key:"setZoom",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(v.e)();(n=Math.min(n,this.maxZoomFactor))>=0&&(this.zoomFactor=n,this.canvasAdjustment(),this.zoomPosition=Object(v.e)((function(){return o/e.canvasLayout.naturalSize})),this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.resetOffset(),t.requestAnimationFrame((function(){e.renderImageData(),e.events.next(new m.a("change:zoomFactor",n))})))}},{key:"zoom",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(v.e)();this.zoomFactor+t>=0&&this.setZoom(this.zoomFactor+t,e)}},{key:"renderImageData",value:function(){var t=this;Object(h.a)(this,D)[D]=Object(h.a)(this,x)[x];var e=Object(v.e)((function(){return t.zoomBounds.max-t.zoomBounds.min})),n=Object(v.e)((function(){return Object(v.e)(t.offset)+t.zoomBounds.min}));Object(h.a)(this,D)[D]=y.default.cropImageData(Object(h.a)(this,D)[D],n.x,n.y,e.x,e.y),Object(h.a)(this,D)[D]=y.default.resizeImageData(Object(h.a)(this,D)[D],this.zoomFactor),this.renderCanvas()}},{key:"renderCanvas",value:function(){Object(h.a)(this,D)[D]&&(Object(h.a)(this,S)[S].putImageData(Object(h.a)(this,D)[D],-this.offset.x,-this.offset.y),this.renderRaster())}},{key:"reset",value:function(){this.resetZoom(),this.resetOffset(),this.renderCanvas()}},{key:"resetOffset",value:function(){this.offset=Object(v.f)(0,0)}},{key:"resetZoom",value:function(){Object(h.a)(this,x)[x]&&this.setZoom(1)}},{key:"renderRaster",value:function(){var t=this,e=[];this.zoomFactor>this.maxZoomFactor-3&&e.push({size:Object(v.e)(1,1),width:1,color:"#CCCCCC"});var n=Object(h.a)(this,S)[S];n.globalCompositeOperation="destination-over",e.forEach((function(e){var o=Object(v.e)((function(){return t.canvasLayout.naturalSize/e.size}));n.lineWidth=e.width,n.beginPath();for(var r=0;r<o.x+1;r++){var c=Math.floor(r*e.size.x*t.zoomFactor)+e.width/2;n.moveTo(c,0),n.lineTo(c,Object(h.a)(t,_)[_].height);for(var l=0;l<o.y+1;l++){var f=Math.floor(l*e.size.y*t.zoomFactor)+e.width/2;n.moveTo(0,f),n.lineTo(Object(h.a)(t,_)[_].width,f)}}n.strokeStyle=e.color,n.stroke()}))}},{key:"refresh",value:function(){var rect={left:Object(h.a)(this,_)[_].offsetLeft+Object(h.a)(this,C)[C].offsetLeft,top:Object(h.a)(this,_)[_].offsetTop+Object(h.a)(this,C)[C].offsetTop,width:Object(h.a)(this,_)[_].offsetWidth,height:Object(h.a)(this,_)[_].offsetHeight};Object(h.a)(this,z)[z]=new j.default(Object(v.e)(rect.left,rect.top),Object(v.e)(rect.left+rect.width,rect.top+rect.height)),Object(h.a)(this,x)[x]&&this.renderImageData()}},{key:"setOffset",value:function(t){this.offset=Object(v.f)(t.x,t.y)}},{key:"calculateZoomBounds",value:function(t,e){var n=this;e=e||1;var o=this.app.canvas.size;t=Object(v.e)((function(){return Math.floor(t*o)}));var r=Object(v.e)((function(){return n.size/o})),c=Object(v.e)((function(){return Math.ceil(Math.min(r/e*o,o))})),h=Object(v.e)((function(){return Math.min(Math.max(t-Math.ceil(c/2),0),o-c)})),l=Object(v.e)((function(){return h+c}));return new j.default(h,l)}},{key:"canvas",get:function(){return Object(h.a)(this,_)[_]}},{key:"id",get:function(){return Object(h.a)(this,k)[k]}},{key:"bounds",get:function(){return Object(h.a)(this,z)[z]}},{key:"imageData",get:function(){return Object(h.a)(this,x)[x]},set:function(t){Object(h.a)(this,D)[D]=Object(h.a)(this,x)[x]=t,this.maxZoomFactor=20,this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.renderImageData()}},{key:"canvasSize",get:function(){return Object(v.e)(Object(h.a)(this,_)[_].width,Object(h.a)(this,_)[_].height)}},{key:"naturalSize",get:function(){return Object(v.e)(Object(h.a)(this,_)[_].width,Object(h.a)(this,_)[_].height)}},{key:"naturalWidth",get:function(){return Object(h.a)(this,x)[x].width}},{key:"naturalHeight",get:function(){return Object(h.a)(this,x)[x].height}},{key:"width",get:function(){return this.zoomBounds.max.x-this.zoomBounds.min.x}},{key:"height",get:function(){return this.zoomBounds.max.y-this.zoomBounds.min.y}},{key:"zoomFactorWidth",get:function(){return Object(h.a)(this,_)[_].width/this.zoomFactor}},{key:"cursorColor",get:function(){return this._cursorColor},set:function(t){this._cursorColorRGBA=t.toRGBA(),this._cursorColor=t}}]),e}()}.call(this,n(36))},413:function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"default",(function(){return f}));n(57),n(34),n(263),n(17),n(48),n(37),n(35),n(51);var o,r=n(254),c=n(255),h=n(298),l=n(305),f=function(){function t(e){Object(r.a)(this,t),this.subscriptions=[],this.displaySubscriptions=new Map,this.runSubscriptions=[],this._app=e,this._pressed=!1}return Object(c.a)(t,[{key:"registerDisplay",value:function(t){this.displaySubscriptions.set(t,[l.a.get("mousedown",t.canvas).subscribe(this.onPointerDown(t).bind(this)),l.a.get("mouseenter",t.canvas).subscribe(this.onPointerEnter(t).bind(this))])}},{key:"unregisterDisplay",value:function(t){this.displaySubscriptions.has(t)&&(this.displaySubscriptions.get(t).forEach((function(t){return t.unsubscribe()})),this.displaySubscriptions.delete(t))}},{key:"register",value:function(){}},{key:"unregister",value:function(){}},{key:"onContextMenu",value:function(t){var e=this;return function(n){e.runActionResult(m.bind(e)(n,t))}}},{key:"onPointerEnter",value:function(t){var e=this;return function(n){e.app.setDisplay(t);var o=l.a.get("mouseleave",n.target).subscribe((function(n){o.unsubscribe(),e.onPointerLeave(t)(n)}))}}},{key:"onPointerLeave",value:function(t){return function(t){}}},{key:"onPointerDown",value:function(t){var e=this;return function(n){e.app.setDisplay(t),e._pointerEvent=v.bind(e)(n,t),e._pressed=!0,e.runActionResult(y.bind(e)(n,t),n,t),e.app.display.renderCanvas()}}},{key:"onPointerLeaveAndUp",value:function(t){var e=this;return function(n){d(),e.runActionResult(O.bind(e)(n,t))}}},{key:"onPointerMove",value:function(t){var e=this;return function(n){e.runActionResult(j.bind(e)(n,t))}}},{key:"runActionResult",value:function(t,e,n){t&&(t.events&&(this.runSubscriptions=[l.a.get("contextmenu",e.target).subscribe(this.onContextMenu(n).bind(this)),l.a.get("mouseleave",e.target).subscribe(this.onPointerLeaveAndUp(n).bind(this)),l.a.get("mousemove",e.target).subscribe(this.onPointerMove(n).bind(this)),l.a.get("mouseup",e.target).subscribe(this.onPointerLeaveAndUp(n).bind(this))]),t.save&&this.app.canvas.saveStack(),t.revert&&this.app.canvas.revertStack(),t.render&&this.app.canvas.render())}},{key:"unsubscribeRun",value:function(){this.runSubscriptions.filter((function(t){return!t.unsubscribe()}))}},{key:"app",get:function(){return this._app}},{key:"pressed",get:function(){return this._pressed}}]),t}();function d(){t.clearInterval(o),o=null}function v(t,e){var n=this,o=e.canvasLayout,r=Object(h.e)(t.clientX-e.bounds.min.x,t.clientY-e.bounds.min.y),c=Object(h.e)((function(){return r-o.position}));this.app.globalBounds&&(console.log(this.app.globalBounds.min.toString()),r=Object(h.e)((function(){return r-n.app.globalBounds.min})),c=Object(h.e)((function(){return c-n.app.globalBounds.min})));var f=Object(h.e)((function(){return Math.round(c)})),d=Object(h.e)((function(){return Math.round(c/e.zoomFactor+e.zoomBounds.min)}));return{position:d,origin:f,app:this.app,x:d.x,y:d.y,originX:f.x,originY:f.y,leftClick:2!==t.button,rightClick:2===t.button,holdAlt:l.a.altActive,holdCtrl:l.a.cmdActive}}function y(){var e,n=this,r={events:!0};return this.app.tool.pointerDownHold?(e=function(){n.runActionResult(n.app.tool.onPointerDown(n._pointerEvent,n)),n.app.canvas.render()},d(),o=t.setInterval(e,20),r):Object.assign(r,this.app.tool.onPointerDown(this._pointerEvent,this))}function O(t,e){return this._pressed=!1,this._pointerEvent=null,this.unsubscribeRun(),this.app.tool.onPointerUp(v.bind(this)(t,e),this)}function j(t,e){return this._pointerEvent=v.bind(this)(t,e),this.app.tool.onPointerMove(this._pointerEvent,this)}function m(t,e){return t.preventDefault(),t.stopPropagation(),this.app.tool.onContextMenu(v.bind(this)(t,e),this)}}.call(this,n(36))},418:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return k}));n(34),n(35);var o=n(254),r=n(255),c=n(300),h=n(311),l=n(343);n(341),n(457),n(405);n(377);n(427),h.a,h.a,h.a,h.a;var f={leading:!0,trailing:!1};var d=function(){function t(t,e,n,o){this.duration=t,this.scheduler=e,this.leading=n,this.trailing=o}return t.prototype.call=function(t,source){return source.subscribe(new v(t,this.duration,this.scheduler,this.leading,this.trailing))},t}(),v=function(t){function e(e,n,o,r,c){var h=t.call(this,e)||this;return h.duration=n,h.scheduler=o,h.leading=r,h.trailing=c,h._hasTrailingValue=!1,h._trailingValue=null,h}return c.__extends(e,t),e.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(y,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))},e.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},e.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)},e}(h.a);function y(t){t.subscriber.clearThrottle()}var O=n(338),j=n(318),m=n(305),k=function(){function t(e){Object(o.a)(this,t),this.subscriptions=[],this._app=e}return Object(r.a)(t,[{key:"register",value:function(){var t,e,n;this.subscriptions.push(m.a.keydown.pipe((t=200,void 0===e&&(e=l.a),void 0===n&&(n=f),function(source){return source.lift(new d(t,e,n.leading,n.trailing))})).subscribe(w.bind(this)),m.a.keyup.subscribe(z.bind(this)))}},{key:"unregister",value:function(){this.subscriptions.forEach((function(t){return t.unsubscribe()}))}},{key:"registerDisplay",value:function(t){}},{key:"unregisterDisplay",value:function(t){}}]),t}();function z(t){switch(t.keyCode){case 17:t.preventDefault(),this.holdCrtl=!1;break;case 18:t.preventDefault(),this.holdAlt=!1}}function w(t){if(this._app.display){var e=1;switch(this.holdAlt&&(e*=10),t.keyCode){case 17:t.preventDefault(),this.holdCrtl=!0;break;case 18:t.preventDefault(),this.holdAlt=!0;break;case 37:t.preventDefault(),this._app.display.offset.x-=e;break;case 38:t.preventDefault(),this._app.display.offset.y-=e;break;case 39:t.preventDefault(),this._app.display.offset.x+=e;break;case 40:t.preventDefault(),this._app.display.offset.y+=e}var n=this._app.display;this._app.display.offset=new O.default(Object(j.b)(n.offset.x,-n.zoomBounds.min.x,n.canvasLayout.naturalSize.x-n.zoomBounds.max.x),Object(j.b)(n.offset.y,-n.zoomBounds.min.y,n.canvasLayout.naturalSize.y-n.zoomBounds.max.y)),this._app.display.renderImageData()}}},479:function(t,e,n){"use strict";(function(t){var o,r=n(254),c=n(255),h=n(260),l=n(261),f=n(298),d=n(900),v=Object(l.a)("resize"),y=function(){function e(){Object(r.a)(this,e),this.screenSize=Object(f.e)(0,0),Object.defineProperty(this,v,{writable:!0,value:new d.a(0)}),t.addEventListener("resize",this.onResize.bind(this),!1)}return Object(c.a)(e,[{key:"destroy",value:function(){t.removeEventListener("resize",this.onResize.bind(this),!1)}},{key:"onResize",value:function(){this.screenSize=Object(f.e)(window.innerWidth,window.innerHeight)}},{key:"getElementSize",value:function(t){return Object(f.e)(t.offsetWidth,t.offsetHeight)}},{key:"resize",get:function(){return Object(h.a)(this,v)[v]}}]),e}();e.a=o||(o=new y)}).call(this,n(36))}}]);