var ne=Object.defineProperty;var oe=(o,t,e)=>t in o?ne(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var m=(o,t,e)=>oe(o,typeof t!="symbol"?t+"":t,e);import{i as h,p as me}from"./2o4skMhU.js";import{S as _,I as l,e as S,a as te,f as U,g as p,h as w,j as M,k as Z,E as g,C as le,l as ce,m as D,s as v,n as ue,o as he,p as de,q as fe,r as se,t as Ie,v as ge,w as ye,x as we,y as pe,z as ve}from"./7vWQM-aF.js";import{T as E,a as Se,g as De}from"./DSSEMlfr.js";import{I as ae,T as L,r as q}from"./CSrBrIb-.js";import{v as ie}from"./C6aID195.js";class re extends f{constructor(t){t={...t,locked:!0,id:"ROOT",name:"ROOT"},super(t,{type:"Root"})}}m(re,"TYPE","Root");class x extends f{constructor(e,s){e={...e,locked:!0};super(e,s);m(this,"storage");this.storage=e.storage}get locked(){return this.storage.locked}mount(...e){return this.storage.mount(...e)}unmount(...e){return this.storage.unmount(...e)}async save(){return this.storage.save(await this.export())}}m(x,"TYPE","Storage");class C extends x{constructor(t){super(t,{type:"TmpDisk",symbol:_.TMP_DISK}),this.meta.set(l.VISIBLE,!1)}}m(C,"TYPE","TmpDisk");class F extends x{constructor(t){super(t,{type:"RamDisk",symbol:_.RAM_DISK})}}m(F,"TYPE","RamDisk");class k extends f{constructor(t){super(t,{type:"FloppyDisk"})}}m(k,"TYPE","FloppyDisk");class Y extends x{constructor(t){super(t,{type:"HardDisk",symbol:_.HARD_DISK})}}m(Y,"TYPE","HardDisk");const K=class K extends x{constructor(t){super(t,{type:K.TYPE,symbol:_.CLOUD_DISK})}isLogged(){var t;return((t=this.storage.storage)==null?void 0:t.isLogged())||!1}};m(K,"TYPE","CloudDisk");let b=K;class N extends f{constructor(t){super(t,{type:"Directory",symbol:_.DIRECTORY}),[l.WINDOW_SCALE,l.WINDOW_SCROLL_X,l.WINDOW_SCROLL_Y].forEach(e=>{this.meta.has(e)||this.meta.set(e,!0)})}}m(N,"TYPE","Directory");class P extends f{constructor(t){super(t,{type:"Trashcan",symbol:_.TRASHCAN})}}m(P,"TYPE","Trashcan");class A extends S{constructor(t){super(t,{type:"File"})}}m(A,"TYPE","File");class $ extends S{constructor(e){e={refPath:void 0,...e};super(e);m(this,"refPath");this.refPath=e.refPath}}m($,"TYPE","Link");const d=class d{constructor(t){m(this,"name");m(this,"root");m(this,"currentItem");m(this,"storages",new Map);m(this,"events",ae(new te));this.name=t,this.root=new re,this.setup()}setup(){this.currentItem=this.root;const t=[this.addStorage(d.RAM_DISK_TITLE,E.SESSION,{id:d.RAM_DISK_NAME}),this.addStorage(d.HARD_DISK_NAME,E.LOCAL,{trashcan:!0}),this.addStorage(d.TMP_DISK_TITLE,E.TEMP,{id:d.TMP_DISK_NAME,trashcan:!1})];return Promise.all(t).catch(e=>{throw e})}createTmpFile(t,e,s,a){return this.createRootFile(`TMP:${t}`,e,s,a)}createRootDir(t,e,s){const a=`${t}`;return this.makedir(a,e,{override:!0,...s})}createRootFile(t,e,s,a){let i=e,r=s;typeof e=="object"&&(r=e,i=void 0);const n=`${t}`;return this.makefile(n,i,r,{...a||{},override:!0})}async get(t,e=!1){if(t instanceof S)return t;if(U(t))try{return await this.parsePath(t)}catch(s){if(e)return new S({id:p(t),name:p(t)});throw s}else throw w.get("FileSystem_pathInvalid",p(t),M(t))}async parsePath(t){var i,r;let e=t,s=this.currentItem;const a=t.match(/^([^:\\/]+):(.*)$/);if(a?(s=(i=this.root)==null?void 0:i.getItem(a[1]),e=a[2]):e[0]==="/"&&this.currentItem?(e=e.slice(1),s=Z(this.currentItem)):e==="ROOT"&&(s=this.root,e=""),e&&e.length>0&&(s=G(e.split("/"),s)),s)return s;throw w.get("FileSystem_pathInvalid",t,await((r=this.currentItem)==null?void 0:r.getBase())||"")}async addFloppyDisk(t){let e;return typeof t=="function"?e=await t():e=t,this.addStorage(e)}async removeFloppyDisk(t){await t.remove({silent:!0})}async addStorage(t,e,s={}){s=Object.assign({id:null},s);let a;typeof e=="function"&&(a=e,e=E.CLOUD);const i=this.getFreeSlot(d.PREFIX.FLOPPY_DISK),r={id:i,itemClass:k};let n={};if(typeof t=="object"){const c=t;r.name=c.name,c.items&&(r.items=c.items),r.meta=Array.from(new Map([[l.SYMBOL,_.DISK_1],...c.meta||[]]))}else{switch(e){case E.SESSION:r.id=d.PREFIX.RAM,r.itemClass=F;break;case E.TEMP:r.id=d.PREFIX.TMP,r.itemClass=C;break;case E.LOCAL:r.id=this.getFreeSlot(d.PREFIX.HARD_DISK),r.itemClass=Y;break;case E.CLOUD:r.id=this.getFreeSlot(d.PREFIX.CLOUD_DISK),r.itemClass=b;break}r.id=s.id||r.id;let c;a&&typeof a=="function"?c=await this.registerStorageByStorage(r.id,a).mount(s):c=await this.registerStorageByType(r.id,e).mount(s);const u=await c.load();n=f.normalizeItemData(u),r.storage=c,E.NONE!==e&&(r.name=n.name||t)}return(r.meta=r.meta||[]).push(...n.meta||[]),this.addDisk({...r,...n,storage:r.storage||new Se({id:i,name:d.TMP_DISK_TITLE})},s)}removeStorage(t){return t.unmount().then(()=>(this.events.next(new g({name:"removeStorage",value:{itemStorage:t}})),t))}registerStorageByType(t,e){const s=De(e),a=`${this.name}_${t}`,i=new s({id:t,name:a});return this.storages.set(a,i),i}registerStorageByStorage(t,e){const s=`${this.name}_${t}`,a=new e({id:t,name:s});return this.storages.set(s,a),a}connect(t,e){return this.addStorage(le,t,e).then(s=>s).catch(s=>{throw s})}async disconnect(t){return t=await this.removeStorage(t),t.remove({silent:!0,recursive:!0}),t}addDisk({id:t,name:e,meta:s,items:a,itemClass:i,storage:r},n){var y;n={trashcan:!1,...n},a instanceof Map&&n.trashcan&&(!a||a&&!a.has(P.TYPE))&&(a=a||new Map,a.set(P.TYPE,{type:P.TYPE,id:P.TYPE,name:P.TYPE}));const c=i;if(!c)throw new Error("ItemClass is empty!");const u=new c({id:t,name:e||t,meta:s,items:a,storage:r});return(y=this.root)==null||y.addItem(u),this.events.next(new g({name:"addDisk",value:{id:t,item:u}})),u}getFreeSlot(t){var s;let e=0;for(;(s=this.root)!=null&&s.hasItem(`${t}${e}`);)e++;return`${t}${e}`}async exist(t){try{return!!await this.get(t)}catch(e){return console.error(e),!1}}async changeDirectory(t){const e=await this.get(t);return this.currentItem=e,this.events.next(new g({name:"changeDirectory",value:e})),e}async makedir(t,e,s){const{override:a,meta:i}={override:!1,meta:[],...s};let r;t&&ce(t)&&t!==e?r=await this.get(M(t)):r=this.currentItem;const n=new N({id:p(t),name:e||"",createdDate:Date.now(),meta:i});if(await D(r),a||!r.getItem(n.id))r.addItem(n,a),this.events.next(new g({name:"writeItem",value:n}));else throw w.get("FileSystem_fileExist",n.id);return await v(r),n}async makefile(t,e,s,a){var T,X,V;const{override:i,meta:r}={...a,meta:a.meta||[]},n=p(t),c=new A({id:n,name:e||n,data:s,meta:r,createdDate:Date.now()});if(!U(t))throw w.get("FileSystem_invalidPath",t);let u=ue(t);const y=he(t);u===y&&(u=".");let I;if(de(u)?I=await this.get(u):((T=this.currentItem)==null?void 0:T.id)!=="ROOT"?I=await this.get(fe(await((X=this.currentItem)==null?void 0:X.getPath())||"",u)):I=await this.get(u),I.hasItem(y))if(i)await((V=I.getItem(y))==null?void 0:V.remove()),I.addItem(c);else throw w.get("FileSystem_fileExist",c.id);else I.addItem(c),this.events.next(new g({name:"writeItem",value:c}));return await v(I),c}async editfile(t,e){const s=await this.get(t).then(D);return await D(s),s.data=e,v(s)}async editfileMeta(t,e,s){const a=await this.get(t);return Array.isArray(e)?e.map(i=>({name:i[0],value:i[1]})):a.meta.set(e,s),v(a)}async getItemMetaList(t){const e=await this.get(t);return Array.from(e.meta).map(s=>({name:s[0],value:s[1]}))}async saveItem(t){const e=await this.get(t);return v(e)}async makelink(t,e=null){const s=await this.get(t);await D(s);const a=this.currentItem,i=new $({id:se(s.id)+".ref",name:`${e||s.name}`,refPath:await s.getPath(),createdDate:Date.now()});return await a.addItem(i),await v(s),i}async editlink(t,e){const s=await this.get(t);await D(s);const a=await this.get(e);return s.refPath=await a.getPath(),v(s)}async rename(t,e,{name:s,removeName:a}={name:!1,removeName:!1}){let i;if(t instanceof S)i=t;else if(U(t)||typeof t=="string")i=await this.get(t);else throw w.get("FileSystem_pathInvalid",M(t),t);return await D(i),a&&(s=!0,e=void 0),await i.rename(e,{ignore:!0,name:s}),v(i)}async copy(t,e,s={ignore:!1}){const{ignore:a}={ignore:!1,...s};let i,r,n;if(t instanceof S?(r=t,i=t.id):(r=await this.get(t),i=p(t)),e instanceof S)e instanceof f||(e=e.parent),n=e;else if(e){i=p(e);const u=await this.get(e,!0);if(u instanceof f?i=p(t):u.parent?n=u.parent:n=await this.get(M(e)),!(n instanceof f))throw new TypeError("no ItemContainer")}else throw new TypeError('"to" is empty!');await D(r);const c=await r.copy();if(n instanceof f&&(a||!n.getItem(i)))c.rename(i),n.addItem(c,a),this.events.next(new g({name:"copyItem",value:c}));else throw w.get("FileSystem_fileExist",i);return v(c)}async move(t,e,{override:s}={}){let a,i,r;if(t instanceof S)i=t,a=t.id;else{if(i=await this.get(t),i instanceof x)throw w.get("FileSystem_cantMoveStorage",i.id);a=p(t)}if(e instanceof S)e instanceof f?r=e:r=e.parent;else{if(a=p(e),r=await this.get(e),r instanceof f)a=p(t);else return this.get(M(e));if(!(r instanceof f))throw new TypeError("no ItemContainer")}let n;if(await D(i),s||!await r.getItem(a))n=Z(i),await i.rename(a),await r.addItem(i,s),this.events.next(new g({name:"moveItem",value:i}));else throw w.get("FileSystem_fileExist",i.id,a);return await v(i),n?n.save().then(()=>i):i}async remove(t,e,s={ignore:!1}){var r;const{ignore:a}={ignore:!1,...s},i=await this.get(t);await D(i);try{const n=await Ie(e,i);return n[n.length-1].storage&&await((r=n[n.length-1].storage)==null?void 0:r.save()),n}catch(n){if(!a)throw n}}};m(d,"PREFIX",{FLOPPY_DISK:"DF",TMP:"TMP",RAM:"RAM",HARD_DISK:"HD",CLOUD_DISK:"CD"}),m(d,"TMP_DISK_NAME","TMP"),m(d,"TMP_DISK_TITLE","TMP DISK"),m(d,"RAM_DISK_NAME","RAM"),m(d,"RAM_DISK_TITLE","RAM DISK"),m(d,"HARD_DISK_NAME","HARD DISK");let J=d;function G(o,t){const e=o.shift();if(e===void 0)return t;if(e===".."){if(t.parent)return t.parent}else if(e==="."||e==="")return G(o,t);if(t){const s=t.getItem(e);return o.length>0&&s instanceof f?G(o,s):s}}function H(o){switch(o){case N.TYPE:return N;case P.TYPE:return P;case x.TYPE:return x;case C.TYPE:return C;case F.TYPE:return F;case Y.TYPE:return Y;case k.TYPE:return k;case b.TYPE:return b;case $.TYPE:return $;case A.TYPE:return A}return A}w.add([["FileSystem_invalidPath",["Invalid File",'Invalid path "%1"']],["FileSystem_invalidFile",["Invalid File",'Invalid file… "%1"']],["FileSystem_fileExist",["File Ready",'File already exists… "%1"']],["FileSystem_pathInvalid",["Path Invalid",'Path invalid… "%1"; base: "%2"']],["FileSystem_itemInvalid",["Item Invalid",'Item id invalid… "%1" from "%2"']],["FileSystem_cantMoveStorage",["Can't Move",`Can't move BaseStorage "%1"`]],["FileSystem_permissionsNeeded",["Permissions needed","Permissions needed"]]]);class f extends S{constructor(e,s){e={...e};super(e,s);m(this,"items",new Map);m(this,"_maxSize",ge(1));this.addItems(e.items||this.items),this._maxSize=e.maxSize||this._maxSize}async export(e={}){const s={...await super.export(e),items:[]};return Reflect.deleteProperty(s,"data"),s.items=await Promise.all(Array.from(this.items.values()).map(a=>a.export())),s}async addItems(e,s=!1){let a=[];e instanceof Map?a=Array.from(e.values()):Array.isArray(e)&&(a=e),a=a.map(r=>(typeof r.data=="string"&&(r.data=ye(r.data)),r));const i=this.parseItems(a);return Promise.all(i.map(r=>this.addItem(r,s)))}static normalizeItemData(e){const s={...e},a=[];if("items"in e&&!(e.items instanceof Map)&&(s.items=new Map(e.items.map(i=>[i.id,i]))),"info"in e&&e.info)debugger;return"extension"in s&&(s.id+="."+s.extension,delete s.extension,a.push("extension")),"createTime"in s&&(s.createdDate=s.createTime,delete s.createTime,a.push("createTime")),"editTime"in s&&(s.editedDate=s.editTime,delete s.editTime,a.push("editTime")),"icon"in s&&(delete s.icon,a.push("icon")),a.length&&console.warn("@deprecated TODO: muss weg, hier werden die alten Items angepasst.",s,a),s}parseItems(e){return e.map(s=>{const a=f.normalizeItemData(s);let i;return a.type?i=H(a.type):"items"in a?i=H("Directory"):i=H(),new i(a)})}async addItem(e,s=!1){const a=e.parent;if(!s&&this.hasItem(e.id))throw new Error(`File ${e.id} exists`);if(a&&await a.removeItem(e),s){const i=we(e.id),r=se(e.id);e.setId(pe(ve(r,this,i),i))}return this.items.set(e.id,e),e.setParent(this),e.events.next(new g({name:"move",value:{item:e,lastParent:a}})),this.events.next(new g({name:"addItem",value:{item:e}})),e}removeItem(e){return e.setParent(void 0),this.items.delete(e.id),this.events.next(new g({name:"removeItem",value:{item:e}})),Promise.resolve()}async remove(e={}){var i;const{recursive:s}={recursive:!1,...e},a=[];if(s){const r=await this.getItems();for(const n of r.values())a.push(...await n.remove(e));return a.push(...await super.remove(e)),a}else{if((await this.getItems()).size>0)throw new Error((i=w.get("FileSystemItem_itemContainerNotEmpty",await this.getPath()))==null?void 0:i.join(" "));return await super.remove(e)}}changeItemId(e,s,a){this.items.delete(s),this.items.set(a,e),this.parent&&console.log("changeItemId by parent",s,a,this.parent.items)}getItems(){return Promise.resolve(this.items)}getItem(e){return this.items.get(e)}hasItem(e){return this.items.has(e)}get size(){return Array.from(this.items.values()).reduce(function(e,s){return s instanceof f||(e+=s.size),e},0)}get maxSize(){return e(this);function e(s){return s.parent&&s.getRealMaxSize()?e(s.parent):s.getRealMaxSize()}}}w.add([["FileSystemItem_itemContainerNotEmpty",["ItemWrapp Not Empty","ItemContainer not empty… %1"]]]);class B{constructor({fsItem:t,command:e,model:s,layout:a}){m(this,"fsItem");m(this,"command");m(this,"type");m(this,"id",ie());m(this,"layout",L({position:h(0,0),size:h(0,0)}));m(this,"ignoreRearrange",!1);m(this,"model",L({title:"Item Title",symbol:_.DEFAULT,used:!1,visible:!0,url:"",ignoreRearrange:!1}));if(this.type="default",this.command=e,this.model=L({...this.model,...s||{}}),this.layout=L({...this.layout,...a||{}}),this.fsItem=t,this.fsItem){const i=this.fsItem;this.type=Ee(i),this.setProperties(i),this.fsItem.events.subscribe(({name:r})=>{r!=="addItem"&&r!=="removeItem"&&t&&this.setProperties(t)})}}setLayout(t){t.position&&(this.layout.position=h(t.position.x,t.position.y)),t.size&&(this.layout.size=h(t.size.x,t.size.y))}setProperties(t){if(this.model.title=t.name||"",this.layout.position=t.meta.get(l.POSITION)&&j(t.meta.get(l.POSITION))||h(0,0),this.model.visible=!!t.meta.get(l.VISIBLE),this.model.symbol=t.meta.get(l.SYMBOL),t.meta.get(l.WEB_URL)&&(this.model.url=String(t.meta.get(l.WEB_URL))),this.model.ignoreRearrange=!!t.meta.get(l.IGNORE_SYMBOL_REARRANGE),t instanceof f){const e=[`openDirectory "${t.getPath()}"`];t.meta.get(l.WINDOW_SYMBOL_REARRANGE)&&e.push("-sort-symbols");const s=t.meta.get(l.WINDOW_POSITION)&&j(t.meta.get(l.WINDOW_POSITION))||h(0,0);s.length>0&&e.push(`--window-position="${h(s.x,s.y).toArray().join(",")}"`);const a=t.meta.get(l.WINDOW_SIZE)&&j(t.meta.get(l.WINDOW_SIZE))||h(0,0);a.length>0&&e.push(`--window-size="${h(a.x,a.y).toArray().join(",")}"`),t.meta.has(l.WINDOW_SCALE)&&e.push(`--window-scale=${t.meta.get(l.WINDOW_SCALE)}`),t.meta.has(l.WINDOW_SCROLL_X)&&e.push(`--window-scroll-x=${t.meta.get(l.WINDOW_SCROLL_X)}`),t.meta.has(l.WINDOW_SCROLL_Y)&&e.push(`--window-scroll-y=${t.meta.get(l.WINDOW_SCROLL_Y)}`),t.meta.has(l.WINDOW_SIDEBAR)&&e.push(`--window-sidebar=${t.meta.get(l.WINDOW_SIDEBAR)}`),t.meta.has(l.WINDOW_FULL_SIZE)&&e.push(`--window-full-size=${t.meta.get(l.WINDOW_FULL_SIZE)}`),this.command=e.join(" ")}else this.model.url||(this.command=`execute "${t.getPath()}"`)}}function Q(o){return o.map(t=>t instanceof B?t:new B(t))}function Ee(o){return o instanceof f?"container":o.meta.get(l.WEB_URL)?"link":"default"}function j(o){return h(o.x,o.y)}var O=(o=>(o[o.NAME=0]="NAME",o[o.TYPE=1]="TYPE",o[o.CREATED_DATE=2]="CREATED_DATE",o[o.EDITED_DATE=3]="EDITED_DATE",o))(O||{}),R=(o=>(o[o.ASCENDING=0]="ASCENDING",o[o.DESCENDING=1]="DESCENDING",o))(R||{}),W=(o=>(o.SHOW_INVISIBLE_SYMBOLS="symbolWrapper_showInvisibleItems",o.ORDER_TYPE="symbolWrapper_iconsOrderType",o.ORDER_DIRECTION="symbolWrapper_iconsOrderDirection",o))(W||{});const be={symbolWrapper_showInvisibleItems:!1,symbolWrapper_iconsOrderType:0,symbolWrapper_iconsOrderDirection:0};class ee extends g{}class Te{constructor(t,e=[],s=!1){m(this,"id",ie());m(this,"items",q([]));m(this,"selectedItems",q([]));m(this,"core");m(this,"root",!1);m(this,"layout",L({size:h(0,0),position:h(0,0)}));m(this,"size",h(0,0));m(this,"parentSize",h(0,0));this.root=s||!1,this.core=t,this.items.value=Q(e||[])}setLayout(t){t.position&&(this.layout.position=h(t.position.x,t.position.y)),t.size&&(this.layout.size=h(t.size.x,t.position.y))}setSize(t){this.size=h(t.x,t.y)}setParentSize(t){this.parentSize=h(t.x,t.y)}rearrangeIcons(t={orderType:O.NAME,orderDirection:R.ASCENDING,onlyVisible:!1,root:!1,margin:10}){t=Object.assign({orderType:this.core.config.get(W.ORDER_TYPE),orderDirection:this.core.config.get(W.ORDER_DIRECTION),onlyVisible:!this.core.config.get(W.SHOW_INVISIBLE_SYMBOLS),root:!1,margin:10},t);let e=this.items.value;switch(t.root&&(t.orderType=O.NAME,t.orderDirection=R.DESCENDING),t.onlyVisible&&(e=e.filter(n=>n.model.visible)),e=e.filter(n=>!n.model.ignoreRearrange),t.orderType){case O.TYPE:e=e.sort((n,c)=>n.type.localeCompare(c.type));break;case O.CREATED_DATE:e=e.sort((n,c)=>{var I,T;const[u,y]=[((I=n.fsItem)==null?void 0:I.createdDate)||0,((T=c.fsItem)==null?void 0:T.createdDate)||0];return u===y?0:u>y?1:-1});break;case O.EDITED_DATE:e=e.sort((n,c)=>{var I,T;const[u,y]=[((I=n.fsItem)==null?void 0:I.editedDate)||0,((T=c.fsItem)==null?void 0:T.editedDate)||0];return u===y?0:u>y?1:-1});break;default:e=e.sort(n=>n.model.title.localeCompare(n.model.title))}switch(t.orderDirection){case R.ASCENDING:e.reverse();break}const s=t.margin||0;let a,i=s;const r=me(0,0);return t.root?a=this.size.x:a=s,e.forEach(n=>{t.root?(n.layout.position=h(a-n.layout.size.x,i),n.layout.size.x>r.x&&(r.x=n.layout.size.x),i+n.layout.size.y<this.parentSize.y?i+=n.layout.size.y+s:(a-=r.x+s,i=s)):(n.layout.size.y>r.y&&(r.y=n.layout.size.y),n.layout.position=h(a,i),a+n.layout.size.x<this.parentSize.x||(a=s,i+=r.y+s,n.layout.position=h(a,i)),a+=n.layout.size.x+s)}),Promise.all(e.map(({id:n,layout:c})=>this.savePosition(n,c.position)))}clearSelectedItems(){[...this.selectedItems.value].forEach(t=>this.unselectItem(t))}isSelectedItem(t){return this.selectedItems.value.includes(t)}selectItem(t){return this.isSelectedItem(t)?!1:(this.selectedItems.value.push(t),!0)}unselectItem(t){return this.isSelectedItem(t)?(this.selectedItems.value=this.selectedItems.value.filter(e=>e!==t),!0):!1}async moveItem(t,e){console.warn("Method not implemented.",t,e)}async moveItemToItem(t,e){console.warn("Method not implemented.",e,t)}async savePosition(t,e){console.warn("Method not implemented.",t,e)}get(t){return this.items.value.find(e=>e.id===t)}has(t){return!!this.items.value.find(e=>e.id===t)}add(...t){const e=Q(t);return this.items.value.push(...e),e}remove(t){let e;return typeof t=="string"?e=this.get(t):e=t,e&&(this.unselectItem(e.id),this.items.value.splice(this.items.value.indexOf(e),1)),e}}class Pe extends Te{constructor(){super(...arguments);m(this,"events",ae(new te))}add(...e){const s=super.add(...e);return this.events.next(new ee({name:"add",value:{wrapper:this,items:Array.from(s)}})),s}remove(e){const s=super.remove(e);return s&&this.events.next(new ee({name:"remove",value:{wrapper:this,item:s||void 0}})),s}setup(...e){return Promise.resolve()}selectItem(e){return super.selectItem(e)?(this.events.next(new g({name:"selectItem",value:{wrapper:this,id:e}})),!0):!1}unselectItem(e){return super.unselectItem(e)?(this.events.next(new g({name:"unselectItem",value:{wrapper:this,id:e}})),!0):!1}}class z extends Pe{constructor(){super(...arguments);m(this,"fsItem");m(this,"usedMemory",0)}async setup(e){this.fsItem=e;const s=Array.from((await e.getItems()).values());await Promise.all(s.map(async a=>this.add(await z.fsItemToSymbol(a)))),e.events.subscribe(this.onEventItem.bind(this))}async moveItemToItem(e,s){var a,i;if(e.locked)throw new Error("Items are locked!");if(s.locked)throw new Error("Destination is locked!");e.meta.set(l.POSITION,h(0,0)),await((a=this.core.modules.files)==null?void 0:a.fs.saveItem(e)),await((i=this.core.modules.files)==null?void 0:i.fs.move(e,s,{override:!0}))}async moveItem(e,s){const a=this.get(e);if(a&&(a.fsItem instanceof A||a.fsItem instanceof N))try{if(a!=null&&a.fsItem&&(s!=null&&s.fsItem))await this.moveItemToItem(a.fsItem,s.fsItem);else throw new Error("Item or wrapper not found");return!0}catch(i){return console.warn(i),!1}return!1}async savePosition(e,s){var i;let a;if(typeof e=="string"&&this.get(e)?a=this.get(e):e instanceof B&&(a=e),a)if(a.fsItem)a.fsItem.meta.set(l.POSITION,s),(i=this.core.modules.files)==null||i.fs.saveItem(a.fsItem);else throw new Error(`Item has no fsItem. ${e}`);else throw new Error(`Item not found. ${e}`)}hasFsItem(e){return this.items.value.find(s=>{var a;return((a=s.fsItem)==null?void 0:a.id)===e.id})}async onEventItem({name:e,value:s}){var a;if(s!=null&&s.item){let i;if(e==="addItem")i=await z.fsItemToSymbol(s.item),this.hasFsItem(s.item)||this.add(i);else if(e==="removeItem"){const r=this.items.value.find(n=>n.fsItem===s);r?this.remove(r):console.warn("Item not found",s)}this.usedMemory=((a=this.fsItem)==null?void 0:a.getUsedMemory())||0}else console.warn("Item event without value",e,s)}static getItemsFromItem(e){return Promise.all(Array.from(e.items.values()).map(z.fsItemToSymbol))}static async fsItemToSymbol(e){const s=await e.getPath(),a=new B({fsItem:e,model:{title:e.name||"Untitled"}});return typeof e.action=="function"&&(a.command=`executeFile "${s}"`),e.meta.get(l.WEB_URL)&&(a.model.url=String(e.meta.get(l.WEB_URL))),a}}export{W as C,N as D,z as F,Te as I,O,re as R,B as S,P as T,f as a,x as b,J as c,R as d,be as e};
