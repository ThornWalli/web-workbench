import{a as p,M as k}from"./CWuhyOxF.js";import{C as f}from"./CGk7t0fz.js";import{T as v,g as _}from"./DGDReys3.js";import{T,c as y}from"./C2h4z5IK.js";import{C as m}from"./CPvqz4AR.js";import{N as C,u as g}from"./fkrD9QA-.js";import{T as x}from"./DbTrm4Mj.js";import{u as N}from"./CwTyMeF_.js";import{_ as b,t as n,v as o,z as l,x as u,M as E,aa as $,g as d,F as w,Y as M,Z as P,a5 as R,$ as V,J as S,C as j}from"./CSrBrIb-.js";import"./2o4skMhU.js";import"./BY0KaPQX.js";import"./C5mdboMC.js";import"./C6aID195.js";import"./U0J9jNun.js";import"./ey0azPGz.js";import"./DG3wQKIc.js";import"./BSj7esSs.js";import"./CNkvSXuu.js";import"./BcHo-crN.js";const I={components:{Navigation:C,SynthesizerTimelineCanvas:x},props:{model:{type:Object,required:!0}},emits:["refresh"],async setup(t){const e=R(t,"model"),s=N();return V(e,()=>{s.setContextMenu(y,{model:e.value,preserveContextMenu:s.preserveContextMenu})},{immediate:!0,deep:!0}),{...s,...await g()}},data:function(){return{toneDestination:null,tracksEdit:{}}},computed:{timelineRefreshKey(){return`timeline-${this.bpm}`},project(){return this.model[m.SYNTHESIZER_PROJECT]},tracks:{get(){return this.project.tracks},set(t){this.project.tracks=t}},bpm(){return Number(this.model[m.SYNTHESIZER_BPM])},controlsNavigation(){return{model:this.model,items:[[{text:`Project: ${this.project.name} | Tracks: ${this.tracks.length}`}]]}},masterVolume(){return this.core.config.observable[f.SCREEN_CONFIG].soundVolume},decibelValue(){return _(this.masterVolume)}},watch:{masterVolume:{handler(){k.volume.value=this.decibelValue},immediate:!0},tracks(){this.$nextTick(()=>{this.$emit("refresh")})},bpm:{handler(t){const e=this.tone.transport;e.stop(),e.bpm.value=120,e.seconds=0,e.bpm.value=t,e.start()}}},mounted(){this.$nextTick(()=>{console.log(this.tracks),this.editTrack(this.tracks[0],{})}),this.$nextTick(()=>{this.$emit("refresh")})},unmounted(){this.model.actions.closeTracks()},methods:{async onClickPlay(){await this.tone.start(),this.players=this.tracks.map(s=>{const r=new T(s,{autoplay:!1});return r.createInstrument("Synth"),r});const t=p;t.stop(),t.seconds=0,t.start(),this.players.map(s=>s.play()).map(s=>s.start(0))},getControls(t){const e=t.getDuration();return{items:[{text:t.name},{spacer:!0},{text:` ${e}`},{label:"Edit",onClick:async()=>{await this.tone.start(),this.editTrack(new v(t),{toneDestination:this.toneDestination})}},{label:"Remove",onClick:async()=>{this.preserveContextMenu(!0),await this.model.actions.removeTrack(t),this.preserveContextMenu(!1),this.$emit("refresh")}}]}},async editTrack(t){this.tracksEdit[t.id]=!0;const{close:e}=this.model.actions.editTrack(t),s=await e;this.tracks=this.tracks.map(r=>r.id===s.id?s:r),this.tracksEdit[t.id]=!1,this.$nextTick(()=>{this.$emit("refresh")})}}},z={class:"wb-disks-extras13-synthesizer-project"},D={class:"tracks"},F={key:0,class:"no-tracks"},B={class:"sheet"};function O(t,e,s,r,q,a){const c=d("navigation"),h=d("synthesizer-timeline-canvas");return o(),n("div",z,[l(c,E($(a.controlsNavigation)),null,16),u("div",D,[a.tracks.length<1?(o(),n("div",F,"No tracks availableâ€¦")):w("",!0),(o(!0),n(M,null,P(a.tracks,i=>(o(),n("div",{key:i.id,class:"track"},[l(c,S({ref_for:!0},a.getControls(i)),null,16),u("div",B,[(o(),j(h,{key:a.timelineRefreshKey,track:i,static:t.tracksEdit[i.id],onRefresh:e[0]||(e[0]=G=>t.$emit("refresh"))},null,8,["track","static"]))])]))),128))])])}const ct=b(I,[["render",O],["__scopeId","data-v-334f0956"]]);export{ct as default};
