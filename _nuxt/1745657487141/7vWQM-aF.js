var k=Object.defineProperty;var O=(e,t,r)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var a=(e,t,r)=>O(e,typeof t!="symbol"?t+"":t,r);import{c as P,_ as N,e as b,E as R,S as U,a as T,O as w,b as W,I as x}from"./2o4skMhU.js";import{I as K}from"./CSrBrIb-.js";var j=P(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),D=function(e){N(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var s=new v(this,this);return s.operator=r,s},t.prototype._throwIfClosed=function(){if(this.closed)throw new j},t.prototype.next=function(r){var s=this;b(function(){var n,i;if(s._throwIfClosed(),!s.isStopped){s.currentObservers||(s.currentObservers=Array.from(s.observers));try{for(var o=W(s.currentObservers),u=o.next();!u.done;u=o.next()){var d=u.value;d.next(r)}}catch(p){n={error:p}}finally{try{u&&!u.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}}})},t.prototype.error=function(r){var s=this;b(function(){if(s._throwIfClosed(),!s.isStopped){s.hasError=s.isStopped=!0,s.thrownError=r;for(var n=s.observers;n.length;)n.shift().error(r)}})},t.prototype.complete=function(){var r=this;b(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var s=r.observers;s.length;)s.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var s=this,n=this,i=n.hasError,o=n.isStopped,u=n.observers;return i||o?R:(this.currentObservers=null,u.push(r),new U(function(){s.currentObservers=null,T(u,r)}))},t.prototype._checkFinalizedStatuses=function(r){var s=this,n=s.hasError,i=s.thrownError,o=s.isStopped;n?r.error(i):o&&r.complete()},t.prototype.asObservable=function(){var r=new w;return r.source=this,r},t.create=function(r,s){return new v(r,s)},t}(w),v=function(e){N(t,e);function t(r,s){var n=e.call(this)||this;return n.destination=r,n.source=s,n}return t.prototype.next=function(r){var s,n;(n=(s=this.destination)===null||s===void 0?void 0:s.next)===null||n===void 0||n.call(s,r)},t.prototype.error=function(r){var s,n;(n=(s=this.destination)===null||s===void 0?void 0:s.error)===null||n===void 0||n.call(s,r)},t.prototype.complete=function(){var r,s;(s=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||s===void 0||s.call(r)},t.prototype._subscribe=function(r){var s,n;return(n=(s=this.source)===null||s===void 0?void 0:s.subscribe(r))!==null&&n!==void 0?n:R},t}(D);class ${constructor(){a(this,"items",new Map)}add(t,r){Array.isArray(t)?t.forEach(([s,n])=>{this.add(s,n)}):r&&(Array.isArray(r)||(r=[r]),this.items.set(t,r))}get(...t){var s;const r=t.shift()||"";return(s=this.items.get(r))==null?void 0:s.map(n=>t.reduce((i,o)=>i.replace(/%\d+/,o),n))}}const l=new $;l.add("bad_args","Bad args");l.add("cant_find","Can't find %1");const z="/",y="ROOT",te="CLOUD";function re(e){return typeof e=="object"&&"id"in e?e.id:e.replace(/.*[\\/:]{1,1}([^:\\/]+)$/,"$1")}function se(e){return/^[a-zA-Z0-9_-]+:/.test(e)}function ne(...e){return e.reduce((t,r)=>(t.push(...r.replace(/[\\/]+/,"/").replace(/^\//,"").replace(/\/$/,"").split("/")),t),[]).join("/").replace(/:\//,":").replace(/\/$/,"")}function ie(e){return e.replace(/(.*)[:/]([^\\/:]+)/,"$1")}function oe(e){return e.replace(/^(.*)[\\/:]([^\\/:]+)$/,"$2")}function ae(e){return e.replace(/(.*[\\/:]{1,1})[^:\\/]+$/,"$1")}function F(e){return e.length&&/^[\w .\\/:-]+$/.test(e)}function ce(e){return F(e)&&!!(e.includes("/")||e.match(/^([^:]+):.*/))}function ue(e){return e*1e3}function G(e){return e.replace(/^(.*)\.[^.]+$/,"$1")}function A(e){const t=e.match(/^.*\.([^.]*)$/);return t?t[1]:""}function H(e){return e.replace(/[^.a-zA-Z0-9_-]/g,"_")}function E(e,t){return t?`${G(e)}.${t}`:e}function J(e,t,r){let s=e;return t.hasItem(E(s,r))?(s=`copy_${e}`,t.hasItem(E(s,r))?J(s,t,r):s):s}function de(e){const t=f(e);if(t){if(t!=null&&t.locked)throw l.get("FileSystem_permissionsNeeded");return e}return e}async function le(e,t){return t=t||f(e),t&&(await e.save(),await t.save()),e}async function he(e,t){const r=await t.remove({recursive:e});return Array.isArray(r)?r:[r]}function f(e){if(e.storage)return e;if(e.parent)return f(e.parent)}var c=(e=>(e.DEFAULT="default",e.DIRECTORY="directory",e.DIRECTORY_PREFS="directory_prefs",e.CLOUD_DISK="cloud_disk",e.HARD_DISK="hard_disk",e.RAM_DISK="ram_disk",e.TMP_DISK="tmp_disk",e.DISK_1="disk_1",e.DISK_2="disk_2",e.DISK_WORKBENCH13="disk_workbench13",e.DISK_MARKDOWN="disk_markdown",e.DISK_BASIC="disk_basic",e.WORK="work",e.CONSOLE="console",e.SETTINGS="settings",e.TRASHCAN="trashcan",e.COMPUTER_1="computer_1",e.TELEPHONE="telephone",e.CURSOR="cursor",e.PREFERENCE="preference",e.WEB_BASIC="web_basic",e.WEB_PAINTING="web_painting",e.COLORS="colors",e.PRINT_1="print_1",e.PRINT_2="print_2",e.NOTEPAD="notepad",e.BASIC="basic",e.IMAGE="image",e.NOTE="note",e.NOTE_BLANK="note_blank",e.LARGE_NOTE="large_note",e.LARGE_NOTE_RICH="large_note_rich",e.FULLSCREEN="fullscreen",e.CALCULATOR="calculator",e.CLOCK="clock",e.KEYBOARD_QUESTION="keyboard_question",e.LARGE_NOTEPAD="large_notepad",e.LARGE_NOTEPAD_HELP="large_notepad_help",e.RABBIT="rabbit",e.MORE="more",e.SAY="say",e.GITHUB="github",e.LAMMPEE="lammpee",e.CUBY="cuby",e.NUXT="nuxt",e.CLOWN="clown",e.DISALLOW_1="disallow_1",e.COPY_1="copy_1",e.COPY_2="copy_2",e.DISPLAY_KEYBOARD="display_keyboard",e.PALETTE="palette",e.SIGN_1="sign_1",e.DOCUMENT_EDITOR="document_editor",e.DOCUMENT_READER="document_reader",e.SYNTHESIZER="synthesizer",e.VUE_SEMANTIC_STRUCTURE="vue_semantic_structure",e.NUXT_BOOSTER="nuxt_booster",e))(c||{});class g{constructor({name:t,value:r}){a(this,"name");a(this,"value");this.name=t,this.value=r}}function fe(e){return typeof e=="string"&&_(e.trim())}const Z=['"',"'"];function _e(e,t='"'){return _(e)?e:(e=e.replace(/"/g,'\\"'),`${t}${e}${t}`)}function pe(e){return e.length===2&&e[0]===e[e.length-1]&&_(e)}function _(e){return e[0]===e[e.length-1]&&Z.includes(e[0])}function me(e){if(typeof e=="string"){const t=e.trim();if(_(t))return t.slice(1,e.length-1)}return e}function be(e){return typeof e=="boolean"||e==="true"||e==="false"}function ye(e){return!isNaN(e)&&!isNaN(parseFloat(e))}function ge(e){return decodeURIComponent(globalThis.atob(e))}function V(e){return globalThis.btoa(encodeURIComponent(e))}var X=(e=>(e.SYMBOL="symbol",e.VISIBLE="visible",e.POSITION="position",e.WINDOW_SYMBOL_REARRANGE="window_symbol_rearrange",e.WINDOW_SIZE="window_size",e.WINDOW_POSITION="window_position",e.WINDOW_SCALE="window_scale",e.WINDOW_SCROLL_X="window_scroll_x",e.WINDOW_SCROLL_Y="window_scroll_y",e.WINDOW_FULL_SIZE="window_full_size",e.WINDOW_SIDEBAR="window_sidebar",e.WEB_URL="web_url",e.IGNORE_SYMBOL_REARRANGE="ignore_symbol_rearrange",e))(X||{});const q={basic:c.BASIC,bas:c.BASIC,markdown:c.DISK_MARKDOWN,md:c.DISK_MARKDOWN,image:c.IMAGE,img:c.IMAGE};function Q(e,t=c.NOTE_BLANK){const r=q,s=A(e).toLowerCase();return r[s]||t}class L extends g{}class h{constructor(t,{type:r,symbol:s=c.NOTE_BLANK}={type:"Unknown",symbol:c.NOTE_BLANK}){a(this,"type");a(this,"events");a(this,"_locked",!1);a(this,"parent");a(this,"createdDate");a(this,"editedDate");a(this,"id");a(this,"_name","");a(this,"meta");a(this,"_data");a(this,"_action");const{locked:n=!1,id:i,name:o=void 0,meta:u=void 0,data:d=void 0,action:p,createdDate:I=Date.now(),editedDate:C=void 0}=t;this.events=K(new D),this.createdDate=I||Date.now(),this.editedDate=C||I,this._locked=n||!1,this.id=i,this._name=o||"",this.type=r||"Unknown",this.meta=new Map([["symbol",Q(i||"",s||c.NOTE_BLANK)],["visible",!0],...u||[]]);let m=d;if(typeof d=="string")try{m=JSON.parse(d)}catch(S){throw console.log(m),S}this._action=p,this._data=B(m||{})}async remove(t={}){var i,o;const{silent:r}=Object.assign({silent:!1},t);let s;const n=this.isLocked();if(!n)s={type:this.type,id:this.id,name:this.name,path:await this.getPath(),size:this.size,storage:f(this)};else if(!r)throw new Error((i=l.get("FileSystemItem_itemLocked",await this.getPath()))==null?void 0:i.join(" "));return(r||!n)&&(this.events.next(new g({name:"remove",value:{item:this}})),this.events.unsubscribe(),(o=this.parent)==null||o.removeItem(this)),s?[s]:[]}isLocked(t=!1){return t?!1:this.parent&&this.parent.locked&&this.parent.id!==y?!0:this._locked}async copy(){const t=this.constructor,r=await this.export({encodeData:!1}),s=new t(r);return Promise.resolve(s)}rename(t,r={}){const{name:s=!1,ignore:n=!1}=Object.assign({name:!1,ignore:!1},r);if(!this.isLocked(n)){if(s)return this.name=t,this;{const i=this.id;this.id=H(t||""),this.parent&&i!==this.id&&this.parent.changeItemId(this,i,this.id)}this.events.next(new L({name:"rename",value:{item:this}}))}return this}save(){this.events.next(new g({name:"save",value:{item:this}}))}getUsedMemory(){return this.size/this.maxSize}async export(t={}){const{encodeData:r}=Object.assign({encodeData:!0},t),s=new Map(this.meta);Array.from(s.keys()).forEach(i=>{s.get(i)instanceof x&&s.set(i,s.get(i).toJSON())});let n;return r&&typeof this._data=="string"?n=await V(this._data):n=this._data,{type:this.type,id:this.id,name:this._name,createdDate:this.createdDate,editedDate:this.editedDate,data:n,meta:Array.from(s)}}get data(){let t=this._data;if(typeof this._data=="string")try{t=JSON.parse(this._data)}catch(r){console.error(r),t={type:"markdown",content:"Cannot parse data",data:this._data}}return t}set data(t){typeof t=="object"&&(t=JSON.stringify(t)),this._data=t}get action(){return this._action}setId(t){this.id=t}setParent(t){this.parent=t}get locked(){var t;return((t=this.parent)==null?void 0:t.locked)||this._locked}get name(){return this._name||this.id}set name(t){this._name=t||""}get extension(){return A(this.id)}get size(){const t=Object.values(this.data||{});return new Blob(t).size}get maxSize(){return new Blob(Object.values(this.data||{})).size}getRealMaxSize(){return new Blob(Object.values(this.data||{})).size}getBase(){return h.getBaseRecursive({item:this},!1)}getPath(){return h.getBaseRecursive({item:this})}static getBaseRecursive({item:t,path:r=[]},s=!0){if(s&&r.push(t.id),t.parent)return h.getBaseRecursive({item:t.parent,path:r});if(r=r.reverse(),r[0]===y&&r.shift(),r.length>0){let n=r[0];return/\./.test(n)||(n+=":"),`${n}${r.slice(1,r.length).join(z)}`}else return y}}l.add([["FileSystemItem_itemLocked",["Item Locked","Item is locked, can't be edit… %1"]]]);function B(e){return typeof e=="object"&&(e=JSON.stringify(e)),e}function Ie(e){return t=>e(t)}export{ye as A,be as B,te as C,_e as D,g as E,H as F,X as I,c as S,D as a,fe as b,V as c,Ie as d,h as e,F as f,re as g,l as h,pe as i,ae as j,f as k,ce as l,de as m,ie as n,oe as o,se as p,ne as q,G as r,le as s,he as t,me as u,ue as v,ge as w,A as x,E as y,J as z};
