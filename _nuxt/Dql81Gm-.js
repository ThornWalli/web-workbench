import{i as r}from"./OlYXjGCK.js";import{d as M,E as m,l as C,D as O}from"./B3Wmi0DA.js";import{S as b}from"./CtlMGvom.js";import{f as L}from"./C723tzWh.js";import{L as p,r as A,O as d,a9 as N}from"./BkRx7U8b.js";import{S,I as l}from"./ClLpnmyR.js";class x{ready=!1;fsItem;command;type="default";id=crypto.randomUUID();layout=p({position:r(0,0),size:r(0,0)});ignoreRearrange=!1;model=p({title:"Item Title",symbol:S.DEFAULT,used:!1,visible:!0,url:void 0,ignoreRearrange:!1});constructor({fsItem:e,command:t,model:i,layout:o}){this.type="default",this.command=t,this.model=p({...this.model,...i||{}}),this.layout=p({...this.layout,...o||{}}),this.fsItem=e}async setup({core:e}){try{const t=this.fsItem;if(!t||this.ready)return;this.type=U(t),await R(this,e),t.events.subscribe(async({name:i})=>{i!=="addItem"&&i!=="removeItem"&&t&&await R(this,e)})}catch(t){console.warn(t),this.model.symbol=S.DISALLOW_1}this.ready=!0}setLayout(e){e.position&&(this.layout.position=r(e.position.x,e.position.y)),e.size&&(this.layout.size=r(e.size.x,e.size.y))}}async function R(s,e){const t=s.fsItem;if(t)if(s.model.title=t.name||"",s.layout.position=t.meta.get(l.POSITION)&&w(t.meta.get(l.POSITION))||r(0,0),s.model.visible=!!t.meta.get(l.VISIBLE),s.model.symbol=t.meta.get(l.SYMBOL),t.meta.get(l.WEB_URL)&&(s.model.url=String(t.meta.get(l.WEB_URL))),s.model.ignoreRearrange=!!t.meta.get(l.IGNORE_SYMBOL_REARRANGE),t.meta.get(l.REFERENCE)){const i=await e.modules.files?.fileSystem.get(String(t.meta.get(l.REFERENCE)));if(!i)throw new Error("Reference item not found");i.meta.get(l.WEB_URL)&&(s.model.url=String(i.meta.get(l.WEB_URL))),s.command=()=>W(i,s.model)}else s.command=()=>W(t,s.model)}function W(s,e){if(s instanceof M){const t=[`openDirectory "${s.getPath()}"`];s.meta.get(l.WINDOW_SYMBOL_REARRANGE)&&t.push("-sort-symbols");const i=s.meta.get(l.WINDOW_POSITION)&&w(s.meta.get(l.WINDOW_POSITION))||r(0,0);i.length>0&&t.push(`--window-position="${r(i.x,i.y).toArray().join(",")}"`);const o=s.meta.get(l.WINDOW_SIZE)&&w(s.meta.get(l.WINDOW_SIZE))||r(0,0);return o.length>0&&t.push(`--window-size="${r(o.x,o.y).toArray().join(",")}"`),s.meta.has(l.WINDOW_SCALE)&&t.push(`--window-scale=${s.meta.get(l.WINDOW_SCALE)}`),s.meta.has(l.WINDOW_SCROLL_X)&&t.push(`--window-scroll-x=${s.meta.get(l.WINDOW_SCROLL_X)}`),s.meta.has(l.WINDOW_SCROLL_Y)&&t.push(`--window-scroll-y=${s.meta.get(l.WINDOW_SCROLL_Y)}`),s.meta.has(l.WINDOW_SIDEBAR)&&t.push(`--window-sidebar=${s.meta.get(l.WINDOW_SIDEBAR)}`),s.meta.has(l.WINDOW_FULL_SIZE)&&t.push(`--window-full-size=${s.meta.get(l.WINDOW_FULL_SIZE)}`),t.join(" ")}else if(!e.url)return`execute "${s.getPath()}"`}function _(s,e){return s.map(t=>{const i=t instanceof x?t:new x({...t});return i.setup({core:e}),i})}function U(s){return s instanceof M?"container":s.meta.get(l.WEB_URL)?"link":"default"}function w(s){return r(s.x,s.y)}function J(s){return typeof s=="function"?s():s}var y=(s=>(s[s.NAME=0]="NAME",s[s.TYPE=1]="TYPE",s[s.CREATED_DATE=2]="CREATED_DATE",s[s.EDITED_DATE=3]="EDITED_DATE",s))(y||{}),v=(s=>(s[s.ASCENDING=0]="ASCENDING",s[s.DESCENDING=1]="DESCENDING",s))(v||{}),z=(s=>(s.SHOW_INVISIBLE_SYMBOLS="symbolWrapper_showInvisibleItems",s.ORDER_TYPE="symbolWrapper_iconsOrderType",s.ORDER_DIRECTION="symbolWrapper_iconsOrderDirection",s))(z||{});class T extends m{}class B{id=crypto.randomUUID();items=A([]);selectedItems=A([]);core;root=!1;layout=p({size:r(0,0),position:r(0,0)});size=r(0,0);parentSize=r(0,0);constructor(e,t=[],i=!1){this.root=i||!1,this.core=e,this.items.value=_(t||[],this.core)}setLayout(e){e.position&&(this.layout.position=r(e.position.x,e.position.y)),e.size&&(this.layout.size=r(e.size.x,e.position.y))}setSize(e){this.size=r(e.x,e.y)}setParentSize(e){this.parentSize=r(e.x,e.y)}rearrangeIcons(e={align:"left",axis:"horizontal",force:!1,root:!1,margin:10}){e=Object.assign({orderType:this.core.config.get(z.ORDER_TYPE)||y.NAME,orderDirection:this.core.config.get(z.ORDER_DIRECTION)||v.ASCENDING,onlyVisible:!this.core.config.get(z.SHOW_INVISIBLE_SYMBOLS)||!1,align:"left",axis:"horizontal",root:!1,margin:10},e);let t=this.items.value;switch(e.root&&(e.orderType=y.NAME,e.orderDirection=v.DESCENDING,e.force||(e.axis="vertical",e.align="right")),e.onlyVisible&&(t=t.filter(a=>a.model.visible)),e.force||(t=t.filter(a=>!a.model.ignoreRearrange)),e.orderType){case y.TYPE:t=t.sort((a,u)=>a.type.localeCompare(u.type));break;case y.CREATED_DATE:t=t.sort((a,u)=>{const[h,I]=[a.fsItem?.createdDate||0,u.fsItem?.createdDate||0];return h===I?0:h>I?1:-1});break;case y.EDITED_DATE:t=t.sort((a,u)=>{const[h,I]=[a.fsItem?.editedDate||0,u.fsItem?.editedDate||0];return h===I?0:h>I?1:-1});break;default:t=t.sort(a=>a.model.title.localeCompare(a.model.title))}switch(e.orderDirection){case v.ASCENDING:t.reverse();break}const i=e.margin||0;let o,n=i,c=0,f=0;return e.align==="right"?o=this.size.x:o=i,t.forEach(a=>{e.axis==="horizontal"?((e.align==="left"&&o+(a.layout.size.x+i)>=this.parentSize.x||e.align==="right"&&o-(a.layout.size.x+i)<=0)&&(e.align==="right"?o=this.size.x:o=i,n+=c+i,c=0),a.layout.position=r(o,n),o+=(a.layout.size.x+i)*(e.align==="right"?-1:1),c=Math.max(c,a.layout.size.y)):(n+a.layout.size.y>this.parentSize.y-i*2&&(o+=(f+i)*(e.align==="right"?-1:1),n=i,f=0),e.align==="right"?a.layout.position=r(o-(a.layout.size.x+i),n):a.layout.position=r(o,n),n=n+(a.layout.size.y+i),f=Math.max(f,a.layout.size.x))}),t.reduce((a,{id:u,layout:h})=>a.then(()=>this.savePosition(u,h.position)),Promise.resolve())}clearSelectedItems(){[...this.selectedItems.value].forEach(e=>this.unselectItem(e))}isSelectedItem(e){return this.selectedItems.value.includes(e)}selectItem(e){return this.isSelectedItem(e)?!1:(this.selectedItems.value.push(e),!0)}unselectItem(e){return this.isSelectedItem(e)?(this.selectedItems.value=this.selectedItems.value.filter(t=>t!==e),!0):!1}async moveItem(e,t){console.warn("Method not implemented.",e,t)}async moveItemToItem(e,t){console.warn("Method not implemented.",t,e)}async savePosition(e,t){console.warn("Method not implemented.",e,t)}get(e){return this.items.value.find(t=>t.id===e)}has(e){return!!this.items.value.find(t=>t.id===e)}add(...e){const t=_(e,this.core);return this.items.value.push(...t),t}remove(e){let t;return typeof e=="string"?t=this.get(e):t=e,t&&(this.unselectItem(t.id),this.items.value.splice(this.items.value.indexOf(t),1)),t}}class G extends B{events=d(new b);add(...e){const t=super.add(...e);return this.events.next(new T({name:"add",value:{wrapper:this,items:Array.from(t)}})),t}remove(e){const t=super.remove(e);return t&&this.events.next(new T({name:"remove",value:{wrapper:this,item:t||void 0}})),t}setup(...e){return Promise.resolve()}selectItem(e){return super.selectItem(e)?(this.events.next(new m({name:"selectItem",value:{wrapper:this,id:e}})),!0):!1}unselectItem(e){return super.unselectItem(e)?(this.events.next(new m({name:"unselectItem",value:{wrapper:this,id:e}})),!0):!1}}class g extends G{fsItem;usedMemory=0;async setup(e){this.fsItem=e;const t=Array.from((await e.getItems()).values());await Promise.all(t.map(async i=>this.add(await g.fsItemToSymbol(i)))),e.events.subscribe(this.onEventItem.bind(this))}async moveItemToItem(e,t){if(e.locked)throw new Error("Items are locked!");if(t.locked)throw new Error("Destination is locked!");e.meta.set(l.POSITION,r(0,0)),await this.core.modules.files?.fs.saveItem(e),await this.core.modules.files?.fs.move(e,t,{override:!0})}async moveItem(e,t){const i=this.get(e);if(i&&(i.fsItem instanceof C||i.fsItem instanceof O))try{if(i?.fsItem&&t?.fsItem)await this.moveItemToItem(i.fsItem,t.fsItem);else throw new Error("Item or wrapper not found");return!0}catch(o){return console.warn(o),!1}return!1}async savePosition(e,t){let i;if(typeof e=="string"&&this.get(e)?i=this.get(e):e instanceof x&&(i=e),i)if(i.fsItem)i.fsItem.meta.set(l.POSITION,t),this.core.modules.files?.fs.saveItem(i.fsItem);else throw new Error(`Item has no fsItem. ${e}`);else throw new Error(`Item not found. ${e}`)}hasFsItem(e){return this.items.value.find(t=>t.fsItem?.id===e.id)}async onEventItem({name:e,value:t}){if(t?.item){let i;if(e==="addItem")i=await g.fsItemToSymbol(t.item),this.hasFsItem(t.item)||this.add(i);else if(e==="removeItem"){const o=this.items.value.find(n=>n.fsItem?.id===t.item?.id);if(o)this.remove(o);else throw new Error(`Item not found in symbol wrapper. ${t.item?.id}`)}this.usedMemory=this.fsItem?.getUsedMemory()||0}else console.warn("Item event without value",e,t)}static getItemsFromItem(e){return Promise.all(Array.from(e.items.values()).map(g.fsItemToSymbol))}static async fsItemToSymbol(e){const t=await e.getPath(),i=new x({fsItem:e,model:{title:e.name||"Untitled"}});return typeof e.action=="function"&&(i.command=`executeFile "${t}"`),e.meta.get(l.WEB_URL)&&(i.model.url=String(e.meta.get(l.WEB_URL))),i}}const F=r(0,0);class E{events=new b;id=crypto.randomUUID();component;componentData;sidebarComponent;sidebarComponentData;parentWindow;options=p({title:void 0,scale:!1,scaleX:!1,scaleY:!1,scroll:!1,scrollX:!1,scrollY:!1,clamp:!1,clampX:!0,clampY:!1,freeze:!1,focused:!1,center:!0,close:!0,overlay:!0,embed:!1,fillHeader:!1,filled:!1,borderless:!1,hideRootHeader:!1,sidebar:!0,prompt:!1});group;wrapper;layout=p({focused:!1,position:r(0,0),size:F,scrollOffset:r(0,0),zIndex:0});constructor({sidebarComponent:e,sidebarComponentData:t,component:i,componentData:o,options:n,wrapper:c,layout:f,parentWindow:a}){this.parentWindow=a,e&&(this.sidebarComponent=d(e)),t&&(this.sidebarComponentData=d(t)),i&&(this.component=d(i)),this.componentData={...o||{}},c&&(this.wrapper=d(c)),this.options=Object.assign(this.options,n),this.layout=Object.assign(this.layout,f)}setLayout(e){e.position&&(this.layout.position=r(e.position.x,e.position.y)),e.size&&(this.layout.size=r(e.size.x,e.size.y)),e.scrollOffset&&(this.layout.scrollOffset=r(e.scrollOffset.x,e.scrollOffset.y)),e.focused&&(this.layout.focused=e.focused)}ready(){this.options.ready=!0,this.events.next(new m({name:"ready"}))}focus(){this.options.focused=!0,this.events.next(new m({name:"focus"}))}unfocus(){this.options.focused=!1,this.events.next(new m({name:"unfocus"}))}close(e){this.wrapper&&(this.events.next(new m({name:"close",value:e})),this.wrapper.remove(this.id),this.wrapper=void 0)}setWrapper(e){this.wrapper=d(e)}setGroup(e){this.group=e}awaitClose(){return new Promise(e=>{const t=this.events.pipe(L(({name:i})=>i==="close")).subscribe(i=>{t.unsubscribe(),e(i)})})}awaitReady(){return new Promise(e=>{if(this.options.ready)e(this);else{const t=this.events.pipe(L(({name:i})=>i==="ready")).subscribe(()=>{t.unsubscribe(),e(this)})}})}}var k=(s=>(s[s.CENTER=0]="CENTER",s[s.ORDER_HORIZONTAL=1]="ORDER_HORIZONTAL",s[s.ORDER_VERTICAL=2]="ORDER_VERTICAL",s[s.ORDER_DIAGONAL_LEFT=3]="ORDER_DIAGONAL_LEFT",s[s.ORDER_DIAGONAL_RIGHT=4]="ORDER_DIAGONAL_RIGHT",s[s.SPLIT_HORIZONTAL=5]="SPLIT_HORIZONTAL",s[s.SPLIT_VERTICAL=6]="SPLIT_VERTICAL",s[s.FULL=7]="FULL",s))(k||{});class K{events=d(new b);id=crypto.randomUUID();core;layout={size:r(0,0),position:r(0,0)};groups=new Map;modelMap=new Map;models=[];_activeWindow=void 0;constructor(e,t=[]){this.core=e,t.forEach(i=>this.add(i))}setLayout(e){e.position&&(this.layout.position=r(e.position.x,e.position.y)),e.size&&(this.layout.size=r(e.size.x,e.size.y))}getActiveWindow(){return this.models.find(e=>e.options.focused)}setActiveWindow(e){this.models.forEach(t=>{t.options.focused=e===t.id,e===t.id&&(this._activeWindow=t,this.events.next(new m({name:"setActiveWindow",value:t})))})}hasEmbbedWindow(){return!!this.models.find(e=>e.options.embed)}isHeaderVsible(){return!this.models.find(e=>e.options.embed&&e.options.hideRootHeader)}add(e,t){const{full:i,maximize:o,active:n,group:c}={full:!1,maximize:!1,active:!0,group:null,...t||{}};let f;if(e instanceof E?f=e:f=new E(e),f.setWrapper(this),o?f.layout.size=r(this.layout.size.x,this.layout.size.y):i&&(f.layout.size=r(()=>r(this.layout.size.x,this.layout.size.y)+r(0,0))),c){let a;this.groups.has(c)?(a=this.groups.get(c),a.windows.push(f)):(a={primary:f,windows:[],name:c},this.groups.set(c,a)),f.setGroup(a)}return f.layout.zIndex=this.models.length,this.models.push(f),this.events.next(new m({name:"add",value:f})),this.modelMap.set(f.id,f),n&&this.setActiveWindow(f.id),f}remove(e){let t;e instanceof E?t=e:t=this.get(e),t!==void 0&&(t.group&&(t.group.primary===e?(t.group.windows.forEach(i=>i.close()),this.groups.delete(t.group.name)):t.group.primary.focus()),this.models.splice(this.models.indexOf(t),1),this.modelMap.delete(t.id))}get(e){return this.modelMap.get(e)}clear(){this.models=[].splice(0,this.models.length),this.modelMap.clear()}setWindowUpDown(e,t){const i=this.models,o=Array.from(i).filter(c=>!c.options.embed).sort((c,f)=>(c.layout.zIndex||0)-(f.layout.zIndex||0)).map(N),n=this.get(e);if(n){const c=o.findIndex(({id:a})=>a===n.id),f=o[t?c-1:c+1];if(f){const a=n.layout.zIndex;n.layout.zIndex=f.layout.zIndex,f.layout.zIndex=a}}}centerWindow(e){let t;e instanceof E?t=e:t=this.get(e),t&&D(t,this.layout)}setWindowPositions(e,t=[],i){const{embed:o}={embed:!1,...i};switch(t.length<1&&t.push(...this.models),o||(t=t.filter(n=>!n.options.embed)),e){case 7:t.forEach(n=>{P(n,this.layout)});break;case 0:t.forEach(n=>{D(n,this.layout)});break;case 3:case 4:$(t,this.layout,e===4);break;case 5:case 6:H(t,this.layout,e===6);break}}saveSize(e,t){const i=this.get(e);if(i&&i.componentData?.symbolWrapper&&i.componentData?.symbolWrapper instanceof g){const o=i.componentData?.symbolWrapper.fsItem;o&&(o.meta.set(l.WINDOW_SIZE,t),this.core.modules.files?.fs.saveItem(o))}}savePosition(e,t){const i=this.get(e);if(i&&i.componentData?.symbolWrapper&&i.componentData?.symbolWrapper instanceof g){const o=i.componentData?.symbolWrapper.fsItem;o&&(o.meta.set(l.WINDOW_POSITION,t),this.core.modules.files?.fs.saveItem(o))}}}function P(s,e){s.layout.position=r(0,0),s.layout.size=e.size}function D(s,e){s.layout.position=r(()=>(r(e.size.x,e.size.y)-r(s.layout.size.x,s.layout.size.y))/2)}function $(s,e,t){const i=1/s.length;s.forEach((o,n)=>{D(o,e),n=-Math.floor(s.length/2)+n;const c=r(o.layout.position.x+(t?-1:1)*(i*o.layout.size.x)*n,o.layout.position.y+i*o.layout.size.y*n),f=r(()=>r(e.size.x,e.size.y)-r(o.layout.size.x,o.layout.size.y));o.layout.position=r(()=>Math.max(Math.min(c,f),0))})}function H(s,e,t){let i;const o=s.length;t?(i=r(e.size.x,e.size.y/o),s.forEach((n,c)=>{n.layout.position=r(0,c*i.y),n.layout.size=i})):(i=r(e.size.x/o,e.size.y),s.forEach((n,c)=>{n.layout.position=r(c*i.x,0),n.layout.size=i}))}export{z as C,g as F,B as I,y as O,K as W,E as a,v as b,k as c,J as r};
