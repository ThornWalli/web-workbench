import{j as _,k as v,u as f}from"./index.0712caa6.js";import{N as y,T,a as w}from"./Track.34d43f2d.js";import{N as C,u as x,c as N,T as g}from"./Navigation.0c81943e.js";import{C as m}from"./index.3998eac9.js";import{T as $}from"./TimelineCanvas.7a745905.js";import{_ as P,S as j,Z as b,f as l,k as a,l as o,q as u,H as d,a3 as p,m as h,C as E,N as R,O as M,z as S}from"./entry.9fb9bafb.js";import"./index.56665add.js";import"./viewport.8757096e.js";import"./math.571b3f1f.js";import"./async.8020bbf7.js";window.NoteDescription=y;const D={components:{Navigation:C,SynthesizerTimelineCanvas:$},props:{..._,model:{type:Object,required:!0}},emits:[...v,"refresh"],async setup(e,t){const s=j(e,"model"),r=f(e,t);return b(s,()=>{r.setContextMenu(N,{model:s.value,preserveContextMenu:r.preserveContextMenu})},{immediate:!0,deep:!0}),{...r,...await x()}},data:function(){return{toneDestination:null}},computed:{timelineRefreshKey(){return`timeline-${this.bpm}`},project(){return this.model[m.SYNTHESIZER_PROJECT]},tracks:{get(){return this.project.tracks},set(e){this.project.tracks=e}},bpm(){return Number(this.model[m.SYNTHESIZER_BPM])},controlsNavigation(){return{model:this.model,items:[[{text:`Project: ${this.project.name} | Tracks: ${this.tracks.length}`}]]}}},watch:{tracks(){this.$nextTick(()=>{this.$emit("refresh")})},bpm:{handler(e){const t=this.tone.transport;t.stop(),t.bpm.value=120,t.seconds=0,t.bpm.value=e,t.start()}}},mounted(){this.$nextTick(()=>{this.$emit("refresh")})},unmounted(){this.model.actions.closeTracks()},methods:{async onClickPlay(){await this.tone.start(),this.players=this.tracks.map(s=>{const r=new g(s,{autoplay:!1});return r.createInstrument("Synth"),r});const e=w;e.stop(),e.seconds=0,e.start(),this.players.map(s=>s.play()).map(s=>s.start(0))},getControls(e){const t=e.getDuration();return{items:[{text:e.name},{spacer:!0},{text:` ${t}`},{title:"Edit",onClick:async()=>{await this.tone.start(),this.editTrack(new T(e),{toneDestination:this.toneDestination})}},{title:"Remove",onClick:async()=>{this.preserveContextMenu(!0),await this.model.actions.removeTrack(e),this.preserveContextMenu(!1),this.$emit("refresh")}}]}},async editTrack(...e){const{close:t}=this.model.actions.editTrack(...e),s=await t;this.tracks=this.tracks.map(r=>r.id===s.id?s:r),this.$nextTick(()=>{this.$emit("refresh")})}}},z={class:"wb-disks-extras13-synthesizer-project"},B={class:"tracks"},I={key:0,class:"no-tracks"},q={class:"sheet"};function O(e,t,s,r,H,n){const c=l("navigation"),k=l("synthesizer-timeline-canvas");return a(),o("div",z,[u(c,d(p(n.controlsNavigation)),null,16),h("div",B,[n.tracks.length<1?(a(),o("div",I,"No tracks availableâ€¦")):E("",!0),(a(!0),o(R,null,M(n.tracks,i=>(a(),o("div",{key:i.id,class:"track"},[u(c,d(p(n.getControls(i))),null,16),h("div",q,[(a(),S(k,{key:n.timelineRefreshKey,track:i,onRefresh:t[0]||(t[0]=V=>e.$emit("refresh"))},null,8,["track"]))])]))),128))])])}const U=P(D,[["render",O],["__scopeId","data-v-1146e05e"]]);export{U as default};
