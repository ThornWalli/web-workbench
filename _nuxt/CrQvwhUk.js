import{a as O,x as g,l as j,m as I}from"./C0_snZds.js";import{a as T}from"./Bk_zE6I5.js";import{i as C}from"./CpQI5kI4.js";import{o as B}from"./BeevJImz.js";var W={now:function(){return(W.delegate||Date).now()},delegate:void 0},F=function(t){O(o,t);function o(r,e,i){r===void 0&&(r=1/0),e===void 0&&(e=1/0),i===void 0&&(i=W);var n=t.call(this)||this;return n._bufferSize=r,n._windowTime=e,n._timestampProvider=i,n._buffer=[],n._infiniteTimeWindow=!0,n._infiniteTimeWindow=e===1/0,n._bufferSize=Math.max(1,r),n._windowTime=Math.max(1,e),n}return o.prototype.next=function(r){var e=this,i=e.isStopped,n=e._buffer,s=e._infiniteTimeWindow,f=e._timestampProvider,u=e._windowTime;i||(n.push(r),!s&&n.push(f.now()+u)),this._trimBuffer(),t.prototype.next.call(this,r)},o.prototype._subscribe=function(r){this._throwIfClosed(),this._trimBuffer();for(var e=this._innerSubscribe(r),i=this,n=i._infiniteTimeWindow,s=i._buffer,f=s.slice(),u=0;u<f.length&&!r.closed;u+=n?1:2)r.next(f[u]);return this._checkFinalizedStatuses(r),e},o.prototype._trimBuffer=function(){var r=this,e=r._bufferSize,i=r._timestampProvider,n=r._buffer,s=r._infiniteTimeWindow,f=(s?1:2)*e;if(e<1/0&&f<n.length&&n.splice(0,n.length-f),!s){for(var u=i.now(),c=0,a=1;a<n.length&&n[a]<=u;a+=2)c=a;c&&n.splice(0,c+1)}},o}(T);function M(t){t===void 0&&(t={});var o=t.connector,r=o===void 0?function(){return new T}:o,e=t.resetOnError,i=e===void 0?!0:e,n=t.resetOnComplete,s=n===void 0?!0:n,f=t.resetOnRefCountZero,u=f===void 0?!0:f;return function(c){var a,d,v,l=0,_=!1,p=!1,b=function(){d==null||d.unsubscribe(),d=void 0},y=function(){b(),a=v=void 0,_=p=!1},R=function(){var m=a;y(),m==null||m.unsubscribe()};return B(function(m,x){l++,!p&&!_&&b();var h=v=v??r();x.add(function(){l--,l===0&&!p&&!_&&(d=S(R,u))}),h.subscribe(x),!a&&l>0&&(a=new g({next:function(w){return h.next(w)},error:function(w){p=!0,b(),d=S(y,i,w),h.error(w)},complete:function(){_=!0,b(),d=S(y,s),h.complete()}}),C(m).subscribe(a))})(c)}}function S(t,o){for(var r=[],e=2;e<arguments.length;e++)r[e-2]=arguments[e];if(o===!0){t();return}if(o!==!1){var i=new g({next:function(){i.unsubscribe(),t()}});return C(o.apply(void 0,j([],I(r)))).subscribe(i)}}export{F as R,W as d,M as s};
