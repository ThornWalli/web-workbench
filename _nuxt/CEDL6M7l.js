import{d as e,r as n,k as l,a0 as u,o as a,W as o,y as s,z as t,$ as r,A as i,I as c,X as v,G as d,a3 as p,ad as f,U as m,_ as y}from"./BfpYGSxR.js";import{e as T}from"./CxZzHJhT.js";import{d as b}from"./DdO-3S9B.js";import{f as k}from"./B1k18Rg6.js";import{K as h}from"./Cy0zoxeo.js";import{o as H,S as L}from"./CrNGlbV0.js";import{f as M}from"./D3xLGof4.js";import{f as w}from"./N5kgPtk_.js";import{a as I}from"./I81pZH22.js";import{c as g}from"./tbUmQ5LT.js";const F={class:"result"},S=["innerHTML"],K=["innerHTML"],_=["innerHTML"],j=["innerHTML"],C=["innerHTML"],E=["innerHTML"],P=["innerHTML"],x=["innerHTML"],B={key:1,class:"selected"},D=["innerHTML"],R=["innerHTML"],U={class:"input"},V=["readonly"],A=["readonly"],q=y(e({__name:"InputText",props:{rootElement:{type:HTMLElement,default:()=>null},overrideFocused:{type:Boolean,default:!1},readonly:{type:Boolean,required:!1,default:!1},multiline:{type:Boolean,required:!1,default:!0},name:{type:String,default:"value"},modelValue:{type:String,default:void 0},model:{type:Object,required:!1,default:()=>({value:"Input Value"})}},emits:["blur","refresh","input","update:model-value","enter","keydown","keyup"],setup(e,{expose:y,emit:q}){const G=e,W=q,O=n(null),z=n(G.overrideFocused),J=n(0),N=n(0),X=n(0),$=n(!1),Q=n(!1);let Y=new L;const Z=l({get:()=>G.modelValue||"",set(e){W("update:model-value",e)}}),ee=l(()=>({readonly:G.readonly,multiline:G.multiline,"selection-empty":!J.value,focused:z.value,"shift-active":$.value,"caps-lock-active":Q.value}));function onFocus(){var e;Y.add(b.pointerDown.pipe(M(({target:e})=>{var n;const l=m(),u=G.rootElement||(null==(n=null==l?void 0:l.parent)?void 0:n.vnode.el);return!k(e,u)}),w()).subscribe(onBlur)),Y.add(b.keyPress.subscribe(()=>{var e;null==(e=O.value)||e.focus()})),Y.add(b.keyDown.subscribe(({code:e})=>{switch(e){case h.SHIFT_LEFT:case h.SHIFT_RIGHT:$.value=!0;break;case h.CAPS_LOCK:Q.value=!Q.value}})),Y.add(b.keyUp.subscribe(e=>{switch(e.code){case h.SHIFT_LEFT:case h.SHIFT_RIGHT:$.value=!1}W("keyup",e)})),null==(e=O.value)||e.focus()}function onBlur(){var e;Y.unsubscribe(),Y=new L,null==(e=O.value)||e.blur(),W("blur")}function refresh(){const e=O.value;e&&(N.value=e.selectionStart||0,X.value=e.selectionEnd||0,J.value=X.value-N.value,W("refresh"))}function onPointerDown(){const e=b.pointerMove.pipe(function debounceTime(e,n){return void 0===n&&(n=I),H(function(l,u){var a=null,o=null,s=null,emit=function(){if(a){a.unsubscribe(),a=null;var e=o;o=null,u.next(e)}};function emitWhenIdle(){var l=s+e,o=n.now();if(o<l)return a=this.schedule(void 0,l-o),void u.add(a);emit()}l.subscribe(g(u,function(l){o=l,s=n.now(),a||(a=n.schedule(emitWhenIdle,e),u.add(a))},function(){emit(),u.complete()},void 0,function(){o=a=null}))})}(128)).subscribe(()=>{refresh()});b.pointerUp.pipe(w()).subscribe(()=>{e.unsubscribe()})}function onInput(){refresh(),W("input")}function onClick(){z.value?refresh():function setFocus(e){z.value=e}(!0)}function onKeydown(e){G.multiline||e.code!==h.ENTER?(W("keydown",e),refresh()):(e.preventDefault(),e.stopPropagation(),W("enter",Z.value),refresh())}function onKeyup(e){W("keyup",e),refresh()}return u(()=>G.overrideFocused,e=>{z.value=e}),u(()=>z.value,e=>{e?onFocus():onBlur()}),a(()=>{var e;null==(e=O.value)||e.setSelectionRange(Z.value.length,Z.value.length),refresh(),z.value&&onFocus()}),o(()=>{Y.unsubscribe()}),y({resetSelection:()=>{var e;null==(e=O.value)||e.setSelectionRange(0,0)},controlShiftActive:$,controlCapsLockActive:Q}),(n,l)=>(t(),s("div",{class:r(["wb-env-element-input-text",ee.value])},[i("div",null,[i("div",F,[Z.value.length>0&&X.value>0?(t(),s(v,{key:0},[N.value>=0&&X.value===Z.value.length?(t(),s(v,{key:0},[i("span",{innerHTML:d(T)(Z.value.slice(0,N.value))},null,8,S),i("span",{class:"selected",innerHTML:d(T)(Z.value.slice(N.value,X.value+1))||" "},null,8,K)],64)):N.value&&N.value===X.value?(t(),s(v,{key:1},[i("span",{innerHTML:d(T)(Z.value.slice(0,N.value))},null,8,_),i("span",{class:"selected",innerHTML:d(T)(Z.value.slice(N.value,N.value+1))||" "},null,8,j),i("span",{innerHTML:d(T)(Z.value.slice(N.value+1,Z.value.length))},null,8,C)],64)):(t(),s(v,{key:2},[i("span",{innerHTML:d(T)(Z.value.slice(0,N.value))},null,8,E),i("span",{class:"selected",innerHTML:d(T)(Z.value.slice(N.value,X.value))},null,8,P),i("span",{innerHTML:d(T)(Z.value.slice(X.value,Z.value.length))},null,8,x)],64))],64)):c("",!0),N.value||""!==Z.value?Z.value.length>0&&!N.value&&N.value===X.value?(t(),s(v,{key:2},[i("span",{class:"selected",innerHTML:d(T)(Z.value.slice(0,1))},null,8,D),i("span",{innerHTML:d(T)(Z.value.slice(1,Z.value.length))},null,8,R)],64)):c("",!0):(t(),s("span",B," "))]),i("div",U,[e.multiline?p((t(),s("textarea",{key:0,ref_key:"inputEl",ref:O,"onUpdate:modelValue":l[0]||(l[0]=e=>Z.value=e),readonly:e.readonly,onPointerdown:onPointerDown,onInput:onInput,onClick:onClick,onKeydown:onKeydown,onKeyup:onKeyup,onFocus:onClick},null,40,V)),[[f,Z.value]]):c("",!0),e.multiline?c("",!0):p((t(),s("input",{key:1,ref_key:"inputEl",ref:O,"onUpdate:modelValue":l[1]||(l[1]=e=>Z.value=e),type:"text",readonly:e.readonly,onPointerdown:onPointerDown,onInput:onInput,onClick:onClick,onKeydown:onKeydown,onKeyup:onKeyup,onFocus:onClick},null,40,A)),[[f,Z.value]])])])],2))}}),[["__scopeId","data-v-5df8126c"]]);export{q as E};
