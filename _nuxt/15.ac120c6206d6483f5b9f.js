(window.webpackJsonp=window.webpackJsonp||[]).push([[15,37,38],{293:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return c}));var r=n(118),h=n(252),c=function t(e,n){Object(r.a)(this,t),this.min=Object(h.e)(0,0),this.max=Object(h.e)(0,0),this.min=e||this.min,this.max=n||this.max}},310:function(t,e,n){"use strict";n.r(e),function(t){var r=n(118),h=n(119),c=(n(37),n(255),n(8),n(395),n(396),n(397),n(398),n(399),n(401),n(402),n(403),n(404),n(405),n(406),n(407),n(408),n(409),n(410),n(411),n(412),n(413),n(414),n(415),n(416),n(417),n(418),n(419),n(26),n(252)),o=n(264),d=n(311),l=function(){function e(t){Object(r.a)(this,e),this._app=t;var n=t.options.size;this._bitmapData=new d.default(n.width,n.height),this._renderActions=[],this._passiveRenderActions=[],this.clearStack()}return Object(h.a)(e,[{key:"getActiveContext",value:function(){return this._app.display.context}},{key:"getDisplayContexts",value:function(){return this._app.displays.map((function(t){return t.context}))}},{key:"setSize",value:function(t,e){this._bitmapData=new d.default(t,e),this.clearStack(),this.render(),this._app.refresh()}},{key:"loadImage",value:function(image){var t=this.getImageDataFromImage(image);this._bitmapData=new d.default(t.width,t.height),this.clearStack(),this._stacks.push(t),this.render(),this._app.refresh()}},{key:"getImageDataFromImage",value:function(image){var canvas=document.createElement("canvas");canvas.width=image.width,canvas.height=image.height;var t=canvas.getContext("2d");t.drawImage(image,0,0);for(var n=e.createImageData(image.width,image.height),data=t.getImageData(0,0,canvas.width,canvas.height),i=0;i<data.length;i++)n.data[Number(i)]=data[Number(i)];return data}},{key:"getColorFromPixel",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=n?this._renderImageData:this._stacks[this._stacks.length-1||0],data=r.data,h=e*(4*r.width)+4*t;return new o.default(data[Number(h)],data[h+1],data[h+2],data[h+3])}},{key:"getPixel",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=n?this._renderImageData:this._stacks[this._stacks.length-1||0],data=r.data,h=e*(4*r.width)+4*t;return data[Number(h)]+data[h+1]+data[h+2]+data[h+3]}},{key:"setPixel",value:function(t,e,n){n=n||this._app.primaryColor;var i=4*(t+e*this._renderImageData.width);this._renderImageData.data[i+0]=n.red,this._renderImageData.data[i+1]=n.green,this._renderImageData.data[i+2]=n.blue,this._renderImageData.data[i+3]=n.alpha>=0?n.alpha:255}},{key:"putImageData",value:function(t,e,n){for(var r,h,c=0;c<t.width;c++)for(var o=0;o<t.height;o++)r=4*(o*t.width+c),h=4*((n+o)*this._renderImageData.width+(e+c)),f(r,t.data,h,this._renderImageData.data)}},{key:"fillPixels",value:function(t,e,n,r,h){for(var c=e;c<Math.min(e+r,this._renderImageData.width);c++)for(var o=n;o<Math.min(n+h,this._renderImageData.height);o++)this.setPixel(c,o,t)}},{key:"addRenderAction",value:function(t){this._renderActions.push(t)}},{key:"addPassiveRenderAction",value:function(t){this._passiveRenderActions.push(t)}},{key:"cleanPassiveRenderActions",value:function(){this._passiveRenderActions=[]}},{key:"getTmpStack",value:function(){return e.createImageData(this._stacks[this._stacks.length-1].width,this._stacks[this._stacks.length-1].height,this._stacks[this._stacks.length-1].data)}},{key:"render",value:function(){var e=this;this._renderImageData=this.getTmpStack(),y(this._renderActions),y(this._passiveRenderActions,!0),t.cancelAnimationFrame(this._renderWait),this._renderWait=t.setTimeout((function(){m.bind(e)(!0),e._renderWait=null}),1e3/30),t.clearTimeout(this._renderWaitDisplays),this._renderWaitDisplays=t.setTimeout((function(){m.bind(e)()}),300)}},{key:"size",get:function(){return Object(c.e)(this._renderImageData.width,this._renderImageData.height)}},{key:"width",get:function(){return this._renderImageData.width}},{key:"height",get:function(){return this._renderImageData.height}},{key:"stacks",get:function(){return this._stacks}},{key:"renderImageData",get:function(){return this._renderImageData}},{key:"clearStack",value:function(){this._renderImageData=e.createImageData(this._bitmapData.width,this._bitmapData.height),this._stacks=[this._renderImageData],this.render()}},{key:"saveStack",value:function(){this._renderImageData=this.getTmpStack(),y(this._renderActions,!0),this._stacks.push(this._renderImageData),this.render()}},{key:"revertStack",value:function(){this._stacks.length>1&&(this._renderImageData=this._stacks.pop(),this.render())}},{key:"toBlob",value:function(){var t=this;return new Promise((function(e){v(t._renderImageData).toBlob(e)}))}},{key:"toBase64",value:function(){var t=this;return new Promise((function(e){e(v(t._renderImageData).toDataURL())}))}}],[{key:"invertImageData",value:function(t){for(var i=0,e=0;e<t.width;e++)for(var n=0;n<t.height;n++)i=4*(e+n*t.width),t.data[Number(i)]=255-t.data[Number(i)],t.data[i+1]=255-t.data[i+1],t.data[i+2]=255-t.data[i+2]}},{key:"createImageData",value:function(e,n,data){return new t.ImageData(new t.Uint8ClampedArray(data||4*e*n),e,n)}},{key:"resizeImageData",value:function(t){for(var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=t.data,o=t.width,h1=t.height,d=o*r,h2=h1*r,l=Array(d*h2*4),v=Object(c.e)(parseInt((o<<16)/d)+1,parseInt((h1<<16)/h2)+1),i=0;i<h2;i++)for(var m=0;m<d;m++)n=m*v.x>>16,f(4*((i*v.y>>16)*o+n),h,4*(i*d+m),l);return e.createImageData(d,h2,l)}},{key:"cropImageData",value:function(t,n,r,h,c){for(var o=t.data,d=Array(h*c*4),i=0;i<h;i++)for(var l=0;l<c;l++){f(4*(r*t.width+n)+4*(l*t.width+i),o,4*(l*h+i),d)}return e.createImageData(h,c,d)}}]),e}();function f(t,e,n,r){r[Number(n)]=e[Number(t)],r[n+1]=e[t+1],r[n+2]=e[t+2],r[n+3]=e[t+3]}function v(t){var canvas=document.createElement("canvas");return canvas.width=t.width,canvas.height=t.height,canvas.getContext("2d").putImageData(t,0,0),canvas}function m(t){var e=this;t?this._app.display&&(this._app.display.imageData=this._renderImageData):this._app.displays.forEach((function(t){t.imageData=e._renderImageData}))}function y(t,e){if(e)for(;t.length>0;)t.shift()();else t.forEach((function(t){t()}))}e.default=l}.call(this,n(36))},311:function(t,e,n){"use strict";n.r(e);var r=n(118),h=n(119),c=n(253),o=n(254),d=n(252),l=Object(o.a)("size"),f=function(){function t(e,n){Object(r.a)(this,t),Object.defineProperty(this,l,{writable:!0,value:Object(d.e)(0,0)}),Object(c.a)(this,l)[l]=Object(d.e)(e,n)}return Object(h.a)(t,[{key:"width",get:function(){return Object(c.a)(this,l)[l].x}},{key:"height",get:function(){return Object(c.a)(this,l)[l].y}},{key:"size",get:function(){return Object(c.a)(this,l)[l]}}]),t}();e.default=f},363:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return x}));n(248);var r=n(118),h=n(119),c=n(251),o=n(249),d=n(250),l=(n(62),n(252)),f=n(310),v=n(261),m=n(264),y=n(314),_=n(293),k=n(289),D=n(260);function I(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(d.a)(t);if(e){var h=Object(d.a)(this).constructor;n=Reflect.construct(r,arguments,h)}else n=r.apply(this,arguments);return Object(o.a)(this,n)}}var x=function(t){Object(c.a)(n,t);var e=I(n);function n(t){var h;return Object(r.a)(this,n),(h=e.call(this,t)).brushPrimaryColor=new m.default(m.default.COLOR_BLACK),h.brushSecondaryColor=new m.default(m.default.COLOR_WHITE),h.brush=new(Object(y.getBrushByIndex)(0))({app:h.app,size:1,primaryColor:h.brushPrimaryColor,secondaryColor:h.brushSecondaryColor}),h.reset(),h}return Object(h.a)(n,[{key:"intersect",value:function(t){return!!this.bounds&&(t.x>this.bounds.min.x&&t.x<this.bounds.max.x&&t.y>this.bounds.min.y&&t.y<this.bounds.max.y)}},{key:"reset",value:function(){console.log("RESET"),this.status=0,this.bounds=null,this.intersectedStartEvent=null,this.croppedImageData=null,this.startEvent=null}},{key:"onPointerDown",value:function(t){var e,n=this;switch(console.log("Status: ",this.status),this.status){case 3:break;case 2:if(this.croppedImageData&&(this.intersectedStartEvent||this.intersect(t))){if(this.intersectedStartEvent=t,!t.rightClick)return{events:!0,render:!1};console.log("Ablegen"),this.status++}break;case 1:if(e=Object(l.e)(this.bounds.max-this.bounds.min),this.status++,t.rightClick){var r=this.bounds.min.x,h=this.bounds.min.y;this.app.canvas.addRenderAction((function(){n.app.canvas.fillPixels(n._brush.secondaryColor,r,h,e.x,e.y)}))}return this.app.canvas.addPassiveRenderAction((function(){n.render(n.startEvent.x,n.startEvent.y,!0)})),{events:!0,render:!0};default:return k.default.prototype.onPointerDown.apply(this,arguments)}}},{key:"onPointerMove",value:function(t,e){var n=this;if(this.intersectedStartEvent&&e.pressed){var r=this.getRectInfo(t);return this._app.canvas.addPassiveRenderAction((function(){n.render(r.x,r.y,!0)})),{render:!0}}if(0===this.status)return this._app.canvas.addPassiveRenderAction((function(){n.render(t.x,t.y,!0)})),{render:!0}}},{key:"getRectInfo",value:function(t){return{width:this.bounds.max.x-this.bounds.min.x,height:this.bounds.max.y-this.bounds.min.y,x:this.startEvent.x+t.x-this.intersectedStartEvent.x,y:this.startEvent.y+t.y-this.intersectedStartEvent.y}}},{key:"onPointerUp",value:function(t){var e=this;if(3===this.status)return this.app.canvas.addRenderAction((function(){var n=e.getRectInfo(t);f.default.invertImageData(e.croppedImageData),e.render(n.x,n.y,!1),e.reset()})),{save:!0,render:!0};if(this.intersectedStartEvent&&2===this.status){var n=this.getRectInfo(t);return this.startEvent.x=n.x,this.startEvent.y=n.y,this.bounds=new _.default(Object(l.e)(n.x,n.y),Object(l.e)(n.x+n.width,n.y+n.height)),this._app.canvas.addPassiveRenderAction((function(){e.render(n.x,n.y,!0)})),{render:!0}}if(this.startEvent&&0===this.status){console.log(t);var r=t.x-this.startEvent.x,h=t.y-this.startEvent.y;return r>0&&h>0&&(this.bounds=new _.default(Object(l.e)(this.startEvent.x,this.startEvent.y),Object(l.e)(t.x,t.y)),this.status++,this._app.canvas.addPassiveRenderAction((function(){e.croppedImageData=f.default.cropImageData(e.app.canvas.renderImageData,e.bounds.min.x,e.bounds.min.y,r,h),f.default.invertImageData(e.croppedImageData),e.render(e.startEvent.x,e.startEvent.y,!0)}))),{render:!0}}}},{key:"render",value:function(t,e,rect){var n=this,r=Object(l.e)(0,0),h=Object(l.e)(t,e);this.bounds?r=Object(l.e)((function(){return n.bounds.max-n.bounds.min})):(r=Object(l.e)((function(){return h-n.startEvent.position})),h=this.startEvent.position),this.croppedImageData&&this.app.canvas.putImageData(this.croppedImageData,h.x,h.y),rect&&Object(v.rectangle)((function(t,e){var data=[].concat(n._brush.data),r=n._app.canvas.getColorFromPixel(t,e);0===r.alpha?r=n.brushPrimaryColor:r.invert(),D.default.drawBrush({color:r,data:data,x:t,y:e,app:n._app})}),h.x,h.y,r.x,r.y,{strokeSize:this._brush.data.length,filled:this.filled,density:3})}}]),n}(k.default)}}]);