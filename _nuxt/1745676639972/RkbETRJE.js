var ae=Object.defineProperty;var se=(a,s,n)=>s in a?ae(a,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[s]=n;var H=(a,s,n)=>se(a,typeof s!="symbol"?s+"":s,n);import{I as re,T as ue,C as ie,a as ce,b as fe}from"./C6HPuhbs.js";import{i as de,c as ve,u as me}from"./B6KsP_aU.js";import{A as pe}from"./DABYRaol.js";import{K as C}from"./0lJVpglL.js";import{u as he}from"./Dr9DEtSu.js";import{d as Ce,r as l,J as V,I as we,j as M,$ as E,o as ye,a8 as ge,a0 as U,V as Re,t as Se,v as Ee,x as I,z as Ie,D as _e,X as Oe,_ as Ae}from"./CYlf7ZdY.js";class Te extends re{constructor(n={}){const{onAdd:i}={onAdd:null,...n};super(n);H(this,"onAdd");this.onAdd=i||(()=>{})}add(n,i){let f="",w=!1;typeof n=="string"&&de(n)?w=!0:(n instanceof ue&&(f=n.toColumnify().split(/\n/g)),typeof n=="string"&&ve(n)&&(f=me(n))),typeof n=="string"&&/^> \w+/.test(n)?this.onAdd(n,i):(w||f.length)&&this.onAdd(f,i)}}const Le={class:"wrapper"},be={class:"input"},xe=["innerHTML"],Ne=Ce({__name:"Console",props:{rootElement:{type:HTMLElement,default(){return null}},showIntroduction:{type:Boolean,default(){return!1}},delimiterPrefix:{type:String,default:"1.SYS"},readonly:{type:Boolean,default:!1},startCommands:{type:[Array,String],default:null},preRows:{type:Array,default(){return[]}}},emits:["freeze","unfreeze","startCommandsComplete","refresh"],setup(a,{emit:s}){const{window:n,core:i,parentFocused:f,parentLayout:w}=he();let _=1;const O=l(null),y=l(null),$=l(null),A=l(null),d=a,g=s,D=V(new ie);D.add([new ce({name:["CLS","CLEAR"],action(){Z()}})]);const K=l(V(new Te({core:i,consoleInterface:new fe,onAdd:B}))),m=l({value:"",focused:!1}),v=l([]),c=l(0),R=l(0),p=l([`[CLI ${_}]`]),r=l(-1),j=l(18),S=l({value:d.delimiterPrefix,prompt:!1,confirm:!1}),F=l(null),P=l(null),T=l(null),L=l(!1),Y=we({show:!0,logger:K,showCommand:!0,commandBucket:D}),J=M(()=>({"js--prompt":T.value,"js--focused":f.value})),X=M(()=>{let e=S.value.value;const{confirm:t,prompt:o}=S.value;return t?e="(y/n) ?":o?e="?":e&&(e=`${e}:&gt`),e&&(e=`${e}&nbsp;`),e}),q=M(()=>w.value.size);let W;E(()=>q.value,()=>{window.clearTimeout(W),W=window.setTimeout(()=>{h()},200)}),E(()=>F.value,()=>{N({value:""})}),E(()=>P.value,()=>{N({value:d.delimiterPrefix,confirm:P.value})}),E(()=>T.value,()=>{N({value:d.delimiterPrefix,prompt:T.value})}),p.value.unshift(...d.preRows),ye(async()=>{const e=ge();if(e&&e.parent&&"console"in e.parent&&(e.parent.console=this),_++,d.showIntroduction){const t=Q();t&&await t.then(()=>b('basic "TMP:CONSOLE_INSTRUCTIONS.basic"',{showCommand:!1}))}U(async()=>{if(d.startCommands){const t=Array().concat(d.startCommands),o=u=>b(u.shift()||"",{showCommand:!1}).then(()=>{if(u.length>0)return o(u)});await o(t),g("startCommandsComplete")}})}),Re(()=>{_--});function G(e){m.value.value=e}async function b(e,t){r.value=-1,c.value=0,R.value=0,g("freeze");const o=await i.executeCommand(e,{...Y,...t});o&&(typeof o=="number"||typeof o=="string")&&B(o),g("unfreeze"),h(),x(!0)}function Q(){var t;const e=["#basic","CLS",'PRINT "Scroll (Up/Down): <strong>Shift+Up</strong> / <strong>Shift+Down</strong>"','PRINT "Enter <strong>commands</strong> to show all commands."'];return(t=i.modules.files)==null?void 0:t.fs.createTmpFile("CONSOLE_INSTRUCTIONS.basic","CONSOLE_INSTRUCTIONS.basic",{type:"basic",content:e})}function Z(){R.value=p.value.length,h()}function h(){if(O.value&&y.value){y.value.innerHTML="";const e=Math.floor(O.value.offsetHeight/j.value)-2;let t=0;for(;c.value+t<c.value+e;){const o=p.value[Math.max(p.value.length-e-c.value,0)+t];if(o!==void 0){const u=document.createElement("li");u.innerHTML=String(o).replace(/[\\]?\\n/,"<br>")+`
`,y.value.appendChild(u)}else break;t++}}}function x(e){U(()=>{e&&(L.value={scroll:!0},g("refresh",L.value),U(()=>{L.value=null}))})}function ee(e){let t=!1;e?R.value>0?(R.value=0,t=!0):c.value<p.value.length&&(c.value++,t=!0):c.value>0&&(c.value--,t=!0),t&&h()}function N(e,t=!1,o=!1){S.value={...S,value:e,prompt:t,confirm:o}}function B(e){const t=[];console.log("CONSOLE:VUE",e),Array.isArray(e)?t.push(...e):t.push(String(e)),p.value.push(...t),h()}function te(){m.value.focused=!0}function ne(e){return v.value[v.value.length-1]!==e&&v.value.push(e),m.value.value="",b(e)}function oe(){m.value.focused=!1,x(),n.value.unfocus()}function le(e){var u,z;const t=e.code;let o=!1;if(((u=A.value)!=null&&u.controlCapsLockActive||(z=A.value)!=null&&z.controlShiftActive)&&(t===C.ARROW_UP||t===C.ARROW_DOWN))e.preventDefault(),ee(t===C.ARROW_UP);else{switch(t){case C.ARROW_UP:r.value++,r.value=Math.min(r.value,v.value.length-1),o=!0;break;case C.ARROW_DOWN:r.value--,r.value=Math.max(r.value,-1),o=!0;break}if(o&&v.value.length>0){let k;r.value<0?k="":k=v.value[v.value.length-1-r.value],m.value.value=k}x()}}return(e,t)=>(Ee(),Se("div",{ref_key:"rootEl",ref:O,class:Oe(["wb-env-console",J.value]),onClick:te},[I("div",Le,[I("ul",{ref_key:"consoleOutputEl",ref:y,class:"output typo-style"},null,512),I("div",be,[I("span",{ref_key:"consoleCommandDelimiterEl",ref:$,class:"prefix",innerHTML:X.value},null,8,xe),Ie(pe,{ref_key:"inputEl",ref:A,"root-element":a.rootElement||e.$el,class:"element",multiline:!1,"override-focused":_e(f),readonly:a.readonly,"model-value":m.value.value,onBlur:oe,"onUpdate:modelValue":G,onEnter:ne,onKeydown:le},null,8,["root-element","override-focused","readonly","model-value"])])])],2))}}),ze=Ae(Ne,[["__scopeId","data-v-53b4e1e4"]]);export{ze as W};
