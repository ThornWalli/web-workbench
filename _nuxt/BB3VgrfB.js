import{N as p,M as k,a as f}from"./DpORGlnS.js";import{u as v,C as _}from"./DASBRxSW.js";import{g as T,T as y}from"./C5Pzic37.js";import{T as C,c as N}from"./BZ70cSnO.js";import{C as m}from"./CUIwSJfT.js";import{N as g,u as x}from"./CoY81t28.js";import{T as b}from"./C0qZV8yr.js";import{_ as w,a7 as E,S as $,g as l,t as o,v as n,z as u,N as M,ac as P,x as d,I as R,a0 as S,a1 as V,O as j,E as D}from"./SgttEdOw.js";import"./C5mdboMC.js";import"./B90GAztJ.js";import"./BNe1vznq.js";import"./CzCUmlVA.js";import"./RqjUgALo.js";window.NoteDescription=p;const I={components:{Navigation:g,SynthesizerTimelineCanvas:b},props:{model:{type:Object,required:!0}},emits:["refresh"],async setup(e){const t=E(e,"model"),s=v();return $(t,()=>{s.setContextMenu(N,{model:t.value,preserveContextMenu:s.preserveContextMenu})},{immediate:!0,deep:!0}),{...s,...await x()}},data:function(){return{toneDestination:null,tracksEdit:{}}},computed:{timelineRefreshKey(){return`timeline-${this.bpm}`},project(){return this.model[m.SYNTHESIZER_PROJECT]},tracks:{get(){return this.project.tracks},set(e){this.project.tracks=e}},bpm(){return Number(this.model[m.SYNTHESIZER_BPM])},controlsNavigation(){return{model:this.model,items:[[{text:`Project: ${this.project.name} | Tracks: ${this.tracks.length}`}]]}},masterVolume(){return this.core.config.observable[_.SCREEN_CONFIG].soundVolume},decibelValue(){return T(this.masterVolume)}},watch:{masterVolume:{handler(){k.volume.value=this.decibelValue},immediate:!0},tracks(){this.$nextTick(()=>{this.$emit("refresh")})},bpm:{handler(e){const t=this.tone.transport;t.stop(),t.bpm.value=120,t.seconds=0,t.bpm.value=e,t.start()}}},mounted(){this.$nextTick(()=>{console.log(this.tracks),this.editTrack(this.tracks[0],{})}),this.$nextTick(()=>{this.$emit("refresh")})},unmounted(){this.model.actions.closeTracks()},methods:{async onClickPlay(){await this.tone.start(),this.players=this.tracks.map(s=>{const r=new C(s,{autoplay:!1});return r.createInstrument("Synth"),r});const e=f;e.stop(),e.seconds=0,e.start(),this.players.map(s=>s.play()).map(s=>s.start(0))},getControls(e){const t=e.getDuration();return{items:[{text:e.name},{spacer:!0},{text:` ${t}`},{label:"Edit",onClick:async()=>{await this.tone.start(),this.editTrack(new y(e),{toneDestination:this.toneDestination})}},{label:"Remove",onClick:async()=>{this.preserveContextMenu(!0),await this.model.actions.removeTrack(e),this.preserveContextMenu(!1),this.$emit("refresh")}}]}},async editTrack(e){this.tracksEdit[e.id]=!0;const{close:t}=this.model.actions.editTrack(e),s=await t;this.tracks=this.tracks.map(r=>r.id===s.id?s:r),this.tracksEdit[e.id]=!1,this.$nextTick(()=>{this.$emit("refresh")})}}},z={class:"wb-disks-extras13-synthesizer-project"},O={class:"tracks"},B={key:0,class:"no-tracks"},F={class:"sheet"};function q(e,t,s,r,G,a){const c=l("navigation"),h=l("synthesizer-timeline-canvas");return o(),n("div",z,[u(c,M(P(a.controlsNavigation)),null,16),d("div",O,[a.tracks.length<1?(o(),n("div",B,"No tracks availableâ€¦")):R("",!0),(o(!0),n(S,null,V(a.tracks,i=>(o(),n("div",{key:i.id,class:"track"},[u(c,j({ref_for:!0},a.getControls(i)),null,16),d("div",F,[(o(),D(h,{key:a.timelineRefreshKey,track:i,static:e.tracksEdit[i.id],onRefresh:t[0]||(t[0]=A=>e.$emit("refresh"))},null,8,["track","static"]))])]))),128))])])}const re=w(I,[["render",q],["__scopeId","data-v-882294f4"]]);export{re as default};
