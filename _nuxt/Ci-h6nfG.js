var e=Object.defineProperty,__publicField=(t,i,n)=>((t,i,n)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n)(t,"symbol"!=typeof i?i+"":i,n);import{i as t}from"./BHmTNEz3.js";function drawRect(e,t,i,n,l=0){e.fillStyle=n,e.fillRect(Number(t.getAttribute("x"))+i[0],Number(t.getAttribute("y"))+i[1]-l,Number(t.getAttribute("width")),Number(t.getAttribute("height"))+l)}function drawPolygon(e,t,i,n){if(!(t instanceof SVGPolygonElement))throw new Error("polygon is not an instance of SVGPolygonElement");e.fillStyle=n,e.beginPath(),Array.from(t.points).forEach((t,n)=>{n<1?e.moveTo(t.x+i[0],t.y+i[1]):e.lineTo(t.x+i[0],t.y+i[1])}),e.closePath(),e.fill()}const i=[{test:/^2m/,name:"sharp",selectors:[{selector:"#sharp rect",draw:drawRect,offset:[-8,0]}]},{test:/^2m/,name:"doubleSharp",selectors:[{selector:"#double-sharp rect",draw:drawRect,offset:[-8,0]}]},{test:/^2m/,name:"dot",selectors:[{selector:"#dot",draw:drawPolygon,offset:[4,0]}]},{test:/^1m/,name:"sharp",selectors:[{selector:"#sharp rect",draw:drawRect,offset:[-4,0]}]},{test:/^1m/,name:"doubleSharp",selectors:[{selector:"#double-sharp rect",draw:drawRect,offset:[-4,0]}]},{test:/^1m/,name:"dot",selectors:[{selector:"#dot",draw:drawPolygon,offset:[1,0]}]},{test:/^2m/,name:"flat",selectors:[{selector:"#flat-1 rect",draw:drawRect,offset:[-8,0]}]},{test:/^2m/,name:"doubleFlat",selectors:[{selector:"#flat-1 rect",draw:drawRect,offset:[-8,0]},{selector:"#flat-2 rect",draw:drawRect,offset:[-8,0]}]},{test:/^1m/,name:"flat",selectors:[{selector:"#flat-1 rect",draw:drawRect,offset:[-5,0]}]},{test:/^1m/,name:"doubleFlat",selectors:[{selector:"#flat-1 rect",draw:drawRect,offset:[-5,0]},{selector:"#flat-2 rect",draw:drawRect,offset:[-5,0]}]},{name:"flat",selectors:[{selector:"#flat-1 rect",draw:drawRect}]},{name:"doubleFlat",selectors:[{selector:"#flat-1 rect",draw:drawRect},{selector:"#flat-2 rect",draw:drawRect}]},{name:"sharp",selectors:[{selector:"#sharp rect",draw:drawRect}]},{name:"doubleSharp",selectors:[{selector:"#double-sharp rect",draw:drawRect}]},{name:"dot",selectors:[{selector:"#dot",draw:drawPolygon}]}],n=[{time:[/^1m/],offset:[0,3],selectors:[{selector:"#whole-pause",draw:drawRect}]},{time:[/^2m/],offset:[0,3],selectors:[{selector:"#double-pause",draw:drawRect}]},{time:[/^2[nt]/],offset:[0,7],selectors:[{selector:"#half-pause",draw:drawRect}]},{time:[/^4[nt]/],offset:[0,0],selectors:[{selector:"#divide-pause-line-0",draw:drawRect},{selector:"#divide-pause-line-1",draw:drawPolygon}]},{time:[/^8[nt]/],selectors:[{selector:"#divide-pause-line-0",draw:drawRect},{selector:"#divide-pause-line-1",draw:drawPolygon},{selector:"#divide-pause-line-2",draw:drawPolygon}]},{time:[/^16[nt]/],offset:[0,0],selectors:[{selector:"#divide-pause-line-0",draw:drawRect},{selector:"#divide-pause-line-1",draw:drawPolygon},{selector:"#divide-pause-line-2",draw:drawPolygon,color:"black"},{selector:"#divide-pause-line-3",draw:drawPolygon,color:"black"}]},{time:[/^32[nt]/],offset:[0,0],selectors:[{selector:"#divide-pause-line-0",draw:drawRect},{selector:"#divide-pause-line-1",draw:drawPolygon},{selector:"#divide-pause-line-2",draw:drawPolygon},{selector:"#divide-pause-line-3",draw:drawPolygon},{selector:"#divide-pause-line-4",draw:drawPolygon}]}],l="primary",s="secondary",o=[{time:[/^1m/],selectors:[{selector:"#whole-background",draw:drawPolygon},{selector:"#whole-foreground",draw:drawPolygon,color:s}]},{time:[/^2m/],selectors:[{selector:"#whole-background",draw:drawPolygon},{selector:"#whole-foreground",draw:drawPolygon,color:s},{selector:"#whole-double rect",draw:drawRect}]},{time:[/^2[nt]/],selectors:[{selector:"#divide-background",draw:drawPolygon},{selector:"#divide-foreground",draw:drawPolygon,color:s},{selector:"#divide-line",draw:drawRect,autoHeight:!0}]},{time:[/^4[nt]/],selectors:[{selector:"#divide-background",draw:drawPolygon},{selector:"#divide-line",draw:drawRect,autoHeight:!0}]},{time:[/^8[nt]/],selectors:[{selector:"#divide-background",draw:drawPolygon},{selector:"#divide-line",draw:drawRect,autoHeight:!0}]},{time:[/^16[nt]/],selectors:[{selector:"#divide-background",draw:drawPolygon},{selector:"#divide-line",draw:drawRect,autoHeight:!0}]},{time:[/^32[nt]/],selectors:[{selector:"#divide-background",draw:drawPolygon},{selector:"#divide-line",draw:drawRect,autoHeight:!0}]}],r='<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- Generator: Adobe Illustrator 27.8.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e\n<svg version="1.1" id="Ebene_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t width="26px" height="39px" viewBox="0 0 26 39" style="enable-background:new 0 0 26 39;" xml:space="preserve">\n<polygon id="divide-background" style="display:none;" points="19,30 19,29 18,29 18,28 16,28 16,27 13,27 13,28 11,28 11,29 10,29\n\t10,30 9,30 9,31 9,32 9,33 10,33 10,34 11,34 11,35 13,35 13,36 16,36 16,35 18,35 18,34 19,34 19,33 20,33 20,32 20,31 20,30 "/>\n<polygon id="divide-foreground" style="display:none;fill:#FFFFFF;" points="16,30 16,29 15,29 14,29 14,30 13,30 13,31 12,31\n\t12,32 12,33 13,33 13,34 14,34 15,34 15,33 16,33 16,32 17,32 17,31 17,30 "/>\n<rect id="divide-line" x="19" width="1" height="30"/>\n<polygon id="divide-line-4" style="display:none;" points="20,23 24,23 24,25 26,25 26,22 25,22 25,21 20,21 "/>\n<polygon id="divide-line-3" style="display:none;" points="20,17 24,17 24,19 26,19 26,16 25,16 25,15 20,15 "/>\n<polygon id="divide-line-2" style="display:none;" points="20,11 24,11 24,13 26,13 26,10 25,10 25,9 20,9 "/>\n<polygon id="divide-line-1" style="display:none;" points="20,5 24,5 24,7 26,7 26,4 25,4 25,3 20,3 "/>\n<polygon id="dot" style="display:none;" points="24,31 23,31 23,30 22,30 22,31 21,31 21,32 22,32 22,33 23,33 23,32 24,32 "/>\n<polygon id="whole-background" points="18.9,30 18.9,29 17.9,29 17.9,28 15.7,28 15.7,27 9.3,27 9.3,28 7.1,28 7.1,29 6.1,29\n\t6.1,30 5,30 5,31 5,32 5,33 6.1,33 6.1,34 7.1,34 7.1,35 9.3,35 9.3,36 15.7,36 15.7,35 17.9,35 17.9,34 18.9,34 18.9,33 20,33\n\t20,32 20,31 20,30 "/>\n<polygon id="whole-foreground" style="fill:#FFFFFF;" points="14.8,31 14.8,30 13.7,30 13.7,29 10.2,29 10.2,30 9,30 9,32 10.2,32\n\t10.2,33 11.3,33 11.3,34 14.8,34 14.8,33 16,33 16,31 "/>\n<g id="whole-double" style="display:none;">\n\t<rect x="3" y="27" style="display:inline;" width="1" height="9"/>\n\t<rect x="1" y="27" style="display:inline;" width="1" height="9"/>\n\t<rect x="23" y="27" style="display:inline;" width="1" height="9"/>\n\t<rect x="21" y="27" style="display:inline;" width="1" height="9"/>\n</g>\n<polygon id="divide-pause-line-4" style="display:none;" points="17,6 17,7 16,7 16,6 16,5 15,5 15,4 13,4 13,5 12,5 12,6 12,7\n\t13,7 13,8 15,8 17,8 17,12 18,12 18,6 "/>\n<polygon id="divide-pause-line-3" style="display:none;" points="16,12 16,13 15,13 15,12 15,11 14,11 14,10 12,10 12,11 11,11\n\t11,12 11,13 12,13 12,14 14,14 16,14 16,18 17,18 17,12 "/>\n<polygon id="divide-pause-line-2" style="display:none;" points="15,18 15,19\n\t14,19 14,18 14,17 13,17 13,16 11,16 11,17 10,17 10,18 10,19 11,19 11,20 13,20 15,20 15,24 16,24 16,18 "/>\n<polygon id="divide-pause-line-1" style="display:none;" points="14,24 14,25\n\t13,25 13,24 13,23 12,23 12,22 10,22 10,23 9,23 9,24 9,25 10,25 10,26 12,26 14,26 14,30 15,30 15,24 "/>\n<rect id="divide-pause-line-0" x="13" y="30" style="display:none;" width="1" height="6"/>\n<rect id="half-pause" x="10" y="27" style="display:none;" width="8" height="3"/>\n<rect id="whole-pause" x="10" y="31" style="display:none;" width="8" height="3"/>\n<rect id="double-pause" x="10" y="27" style="display:none;" width="8" height="7"/>\n<g id="sharp" style="display:none;">\n\t<rect x="3" y="27" style="display:inline;" width="1" height="9"/>\n\t<rect x="1" y="29" style="display:inline;" width="7" height="1"/>\n\t<rect x="1" y="33" style="display:inline;" width="7" height="1"/>\n\t<rect x="5" y="27" style="display:inline;" width="1" height="9"/>\n</g>\n<g id="double-sharp" style="display:none;">\n\t<rect x="1" y="29" style="display:inline;" width="2" height="2"/>\n\t<rect x="1" y="33" style="display:inline;" width="2" height="2"/>\n\t<rect x="5" y="29" style="display:inline;" width="2" height="2"/>\n\t<rect x="5" y="33" style="display:inline;" width="2" height="2"/>\n\t<rect x="3" y="31" style="display:inline;" width="2" height="2"/>\n</g>\n<g id="flat-2" style="display:none;">\n\t<rect x="1" y="30" style="display:inline;" width="2" height="1"/>\n\t<rect y="23" style="display:inline;" width="1" height="13"/>\n\t<rect x="3" y="31" style="display:inline;" width="1" height="4"/>\n\t<rect y="31" style="display:inline;" width="1" height="4"/>\n\t<rect x="1" y="35" style="display:inline;" width="2" height="1"/>\n</g>\n<g id="flat-1" style="display:none;">\n\t<rect x="5" y="30" style="display:inline;" width="2" height="1"/>\n\t<rect x="4" y="23" style="display:inline;" width="1" height="13"/>\n\t<rect x="7" y="31" style="display:inline;" width="1" height="4"/>\n\t<rect x="4" y="31" style="display:inline;" width="1" height="4"/>\n\t<rect x="5" y="35" style="display:inline;" width="2" height="1"/>\n</g>\n<g id="natural" style="display:none;">\n\t<rect x="4" y="27" style="display:inline;" width="2" height="2"/>\n\t<rect x="4" y="32" style="display:inline;" width="2" height="2"/>\n\t<rect x="2" y="28" style="display:inline;" width="2" height="2"/>\n\t<rect x="2" y="33" style="display:inline;" width="2" height="2"/>\n\t<rect x="6" y="26" style="display:inline;" width="1" height="12"/>\n\t<rect x="1" y="24" style="display:inline;" width="1" height="12"/>\n</g>\n</svg>\n',a=3;class FrameDescription{constructor(e){__publicField(this,"canvas"),__publicField(this,"firstPixel"),this.canvas=e,this.firstPixel=function getFirstPixelFromCanvas(e){const i=e.getContext("2d");if(!i)throw new Error("Canvas context is not available");const{data:n}=i.getImageData(0,0,e.width,e.height);for(let l=0;l<n.length;l+=4)if(255===n[l+3]){const i=Math.floor(l/4/e.width),n=l/4-i*e.width;return t(n,i)}}(this.canvas)}}const d=new Map;class NoteRenderer{constructor(e={localCache:!1}){__publicField(this,"queue"),__publicField(this,"canvas"),__publicField(this,"canvasContext"),__publicField(this,"svgNode"),__publicField(this,"dimension"),__publicField(this,"localCache",!1),__publicField(this,"_cache",new Map),__publicField(this,"colors",{background:"#000000",foreground:"#000000"});const{localCache:i,svgNode:n}=e||{};this.localCache=void 0!==i&&i,this.queue=Promise.resolve(void 0);const l=new DOMParser,s=n||l.parseFromString(r,"image/svg+xml").querySelector("svg");if(!s)throw new Error("SVG node is not available");this.svgNode=s;const{width:o,height:a}=this.svgNode.viewBox.baseVal;this.dimension=t(o,a),this.canvas=new OffscreenCanvas(this.dimension.x+100,this.dimension.y+100);const d=this.canvas.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("Canvas context is not available");this.canvasContext=d,this.canvasContext.imageSmoothingEnabled=!1}get cache(){return this.localCache?this._cache:d}render(e,t,i=0){const{colors:l}=t||{},s={background:"#0055aa",foreground:"#000000",...l},r=[e.getName(),e.getTime(),Object.values(s).join("_"),i].join("_");return this.cache.has(r)?Promise.resolve(this.cache.get(r)):this.queue=this.queue.then(()=>{var t,l,a,d,c;const h=this.svgNode,w=this.canvasContext.canvas,y=this.canvasContext;y.clearRect(0,0,w.width,w.height);const g=(e.isPause?n:o).find(t=>t.time.find(t=>e.time&&t.test(e.time.toString())));g&&drawElements(h,y,g.selectors,s,i),(null==(t=e.time)?void 0:t.dot)&&drawElements(h,y,getExtra("dot",e),s,i),(null==(l=e.note)?void 0:l.flat)&&drawElements(h,y,getExtra("flat",e),s,i),(null==(a=e.note)?void 0:a.doubleFlat)&&drawElements(h,y,getExtra("doubleFlat",e),s,i),(null==(d=e.note)?void 0:d.sharp)&&drawElements(h,y,getExtra("sharp",e),s,i),(null==(c=e.note)?void 0:c.doubleSharp)&&drawElements(h,y,getExtra("doubleSharp",e),s,i);const{x:p,y:u,width:f,height:m}=function getWidthFromCanvasFilledPixel(e){const t=e.canvas,i=e.getImageData(0,0,t.width,t.height).data;let n=1/0,l=-1/0,s=1/0,o=-1/0;for(let r=0;r<i.length;r+=4){const e=Math.floor(r/4)%t.width,a=Math.floor(r/4/t.width);i[r+3]&&(e<n?n=e:e>l&&(l=e),a<s?s=a:a>o&&(o=a))}return{x:n,y:s,width:l-n+1,height:o-s+1}}(y);let v=0,x=m+3;g&&g.offset&&(g.offset[1]<0?(v=Math.abs(v),x+=Math.abs(v)):x+=g.offset[1]);const b=new OffscreenCanvas(f,x),P=b.getContext("2d");if(!P)throw new Error("Canvas context is not available");P.imageSmoothingEnabled=!1,P.drawImage(w,p,u,b.width,b.height,0,0,b.width,b.height);const R=new FrameDescription(b);return this.cache.set(r,R),R})}}function drawElements(e,t,i,n,s=0){i.forEach(({selector:i,draw:o,color:r,offset:a,autoHeight:d})=>{(a=[...a||[0,0]])[0]+=(t.canvas.width-26)/2,a[1]+=s,Array.from(e.querySelectorAll(i)).forEach(e=>{o(t,e,a,n[r||l],d&&s||0)})})}function getExtra(e,t){var n;return(null==(n=i.find(i=>{var n;return i.name===e&&t.time&&((null==(n=i.test)?void 0:n.test(t.time.toString()))||!i.test)}))?void 0:n.selectors)||[]}export{NoteRenderer as N,a as S,r as a};
