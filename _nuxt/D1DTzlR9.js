import{i as p,o as he}from"./OlYXjGCK.js";import{R as ye}from"./BQm3Nqs0.js";import{d as U}from"./DeEbP9sG.js";import{S as ge,a as we,b as Ce,c as xe,d as ke,W as be}from"./CuTSLZpO.js";import{S as Ie}from"./uxCSd1pF.js";import{y as d,z as n,A as m,d as ze,r as v,ab as Ve,a7 as H,k as s,o as Me,a1 as G,W as Se,a0 as _e,F as c,D as X,I as u,R as Y,P as Te,G as r,C as q,B as J,$ as He,_ as Ee}from"./BkRx7U8b.js";import{i as Oe}from"./B3Wmi0DA.js";import{b as h,a as i,p as Re}from"./ClLpnmyR.js";import{S as $e}from"./B9nPFJJ2.js";import{S as De}from"./Bg2SjdcQ.js";import{i as Ae}from"./Ds4KxLLa.js";import{S as Fe}from"./Wv4Ty0OG.js";import{f as Pe}from"./C723tzWh.js";import"./D4lI5vpz.js";import"./CtlMGvom.js";import"./D4b9WN8K.js";import"./CV0dHcg-.js";import"./B4rpyJsK.js";import"./CL1V9BUB.js";import"./OAVrZOa6.js";import"./KQEr41HO.js";import"./CVx03s7S.js";import"./CoWiVqj-.js";import"./BTMT_sH9.js";class Be{screenSize=p(0,0);#e=new ye(0);constructor(){window.addEventListener("resize",this.onResize.bind(this),!1)}destroy(){window.removeEventListener("resize",this.onResize.bind(this),!1)}onResize(){this.screenSize=p(window.innerWidth,window.innerHeight)}getElementSize(a){return p(a.offsetWidth,a.offsetHeight)}get resize(){return this.#e}}let Q;const Ke=Q||(Q=new Be),Le={xmlns:"http://www.w3.org/2000/svg",width:"22",height:"16"};function Ne(y,a){return n(),d("svg",Le,a[0]||(a[0]=[m("g",{class:"svg-primary"},[m("path",{d:"M20 2V0H2v2H0v12h2v2h18v-2h2V2zm-1 12h-5v-2H8v2H3v-2h2v-2h2V8h2V6h2V4h2V2h3.667v10H19z"}),m("path",{d:"M12 6h2v4h-4V8h2z"})],-1)]))}const We={render:Ne},je={xmlns:"http://www.w3.org/2000/svg",width:"22",height:"16"};function Ue(y,a){return n(),d("svg",je,a[0]||(a[0]=[m("g",{class:"svg-primary"},[m("path",{d:"M12 7v2h-2V7z"}),m("path",{d:"M20 2h2v12h-2v2H2v-2H0V2h2V0h18zM6 13v1h3v-1zm7 0v1h3v-1zm-8-3v3h1v-3zm4-7v3H6v1h3v2H6v1h3v3h1v-3h2v3h1v-3h3V9h-3V7h3V6h-3V3h-1v3h-2V3zm7 7v3h1v-3zM5 3v3h1V3zm11 0v3h1V3zM6 2v1h3V2zm7 0v1h3V2z"})],-1)]))}const Ge={render:Ue},Xe={xmlns:"http://www.w3.org/2000/svg",width:"6",height:"10"};function Ye(y,a){return n(),d("svg",Xe,a[0]||(a[0]=[m("path",{d:"M0 0h2v2h2v2h2v2H4v2H2v2H0z",class:"svg-primary"},null,-1)]))}const qe={render:Ye},Je=["type","name","value","checked"],Qe={key:1,class:"checkbox"},Ze={class:"title"},et={key:2,class:"hotkey"},tt={key:3,class:"indicator-context"},ot=ze({__name:"MenuItem",props:{item:{},parentLayout:{},tag:{},direction:{},core:{}},emits:["click","update:model-value"],setup(y,{expose:a,emit:Z}){const z=v(Ae()),ee=Ve(),g=H("closeContextMenu",()=>{});a({closeContextMenu:g});const te="bottom",oe={size:Ke.screenSize,position:p(0,0)};function ne(e){return e&&typeof e=="object"&&"value"in e,e}const ie=s(()=>{const e=t.item;return e.type===h.CUSTOM?ne(e.options.checked):$.value?e.getValue()===e.value:!!e.getValue()}),E=s(()=>t.item.items.filter(e=>!(e instanceof $e||e instanceof De)&&!e.options.disabled).length>0),t=y,k=Z,O=v(),se=v(),f=v(),b=v(!1),V=v(!1),w=v(!1),C=v(p(2,3)),R=new Fe,ae=s(()=>t.item instanceof i&&t.item.type===h.RADIO?"radio":"checkbox"),M=s(()=>{if(t.item instanceof i){const e=t.item.type;return e!==void 0&&[h.CUSTOM,h.CHECKBOX,h.RADIO].includes(e)}return!1}),S=s(()=>t.item instanceof i&&t.item.name!==void 0&&t.item.name.length>0),re=s(()=>{if(t.item instanceof i)return t.item.title||""}),l=s(()=>{if(t.item instanceof i)return t.item.hotKey}),$=s(()=>t.item instanceof i&&t.item.type===h.RADIO),ce=s(()=>S.value?"label":t.item instanceof i&&t.item.url?"a":"button"),le=s(()=>{const e={class:"inner",is:void 0};return S.value?e.is="label":t.item instanceof i&&t.item.url&&(e.is="a",e.href=t.item.url),e}),ue=s(()=>({focused:b.value,"force-visible":V.value,"context-ready":w.value,"context-halign-left":C.value.x===0,"context-halign-right":C.value.x===2,"context-valign-top":C.value.y===1,"context-valign-bottom":C.value.y===3,disabled:D.value})),D=s(()=>t.item instanceof i&&(!t.item.action&&(!E.value&&f.value||A.value.disabled)||t.item.action&&A.value.disabled)),A=s(()=>t.item.options);Me(()=>{G(()=>{t.item instanceof i&&t.item.hotKey&&R.add(U.keyDown.pipe(Pe(e=>!!(t.item instanceof i&&t.item.hotKey&&U.resolveHotKey(t.item.hotKey,e)))).subscribe(e=>{e.preventDefault(),ve()}))})}),Se(()=>{R.unsubscribe()});function me(e,o){k("update:model-value",e,o)}async function ve(){if(t.item instanceof i&&typeof t.item.action=="function")try{await t.item.action({closeContextMenu:g})}catch(e){console.error(e),t.core?.errorObserver.next(e)}else O.value.click()}function pe(e){if(!(t.item instanceof i))return;let o;const x=e.target;$.value?o=x?.value:o=x?.checked,Oe(o)?t.item.setValue(Number(o)):t.item.setValue(o),k("update:model-value",t.item.name||"",o),typeof t.item.action=="function"&&Promise.resolve(t.item.action({closeContextMenu:g,value:o})).catch(I=>{throw I})}async function fe(e){if(e.pointerType===""&&f.value&&E.value&&!w.value&&b.value)F();else if(t.item instanceof i&&!S.value&&typeof t.item.action=="function")try{await t.item.action({closeContextMenu:g})}catch(o){console.error(o),t.core?.errorObserver.next(o)}else k("click",e)}async function de(e){if(t.item instanceof i&&!M.value&&typeof t.item.action=="function")try{await t.item.action({closeContextMenu:g})}catch(o){console.error(o),t.core?.errorObserver.next(o)}else k("click",e)}function F(){w.value||(V.value=!0),P()}function P(){w.value||(w.value=!0,G(()=>{window.setTimeout(()=>{if(f.value&&f.value.$el instanceof HTMLElement){const e=f.value.$el.getBoundingClientRect(),{size:o,position:x}=t.parentLayout||oe,I=he(()=>p(e.left,e.top)-(x.x>0?x:0)+p(e.width,e.height)),T=(t.direction||te)==="bottom";!T&&t.direction,C.value=p(o.x<I.x?0:2,(o.y-2<=I.y,T?3:1))}V.value=!1},0)}))}const B=H("addItemFocus"),K=H("removeItemFocus"),L=()=>{b.value=!0,B&&B(t.item.id)},N=s(()=>f.value?.hasFocusedItem||!1);let W=-1;_e(()=>N.value,e=>{window.clearTimeout(W),W=window.setTimeout(()=>{e||_()},0)});let j=-1;const _=()=>{window.clearTimeout(j),j=window.setTimeout(()=>{N.value||(b.value=!1,K&&K(t.item.id))})};return(e,o)=>(n(),c(Y(e.tag),{class:He(["wb-env-element-context-menu-item",ue.value])},{default:X(()=>[(n(),c(Y(ce.value),Te({ref_key:"clickEl",ref:O,disabled:D.value},le.value,{onFocus:L,onBlur:_,onClick:fe,onPointeroverPassive:P,onTouchstartPassive:F}),{default:X(()=>[e.item instanceof r(i)&&M.value?(n(),d("input",{key:0,ref_key:"inputEl",ref:se,type:ae.value,name:e.item.name||r(ee),value:e.item.value,checked:ie.value,onFocus:L,onBlur:_,onClick:de,onInput:pe},null,40,Je)):u("",!0),M.value?(n(),d("span",Qe,[q(r(Ie))])):u("",!0),m("span",Ze,J(re.value),1),l.value?(n(),d("span",et,[l.value.shift?(n(),c(r(ge),{key:0})):u("",!0),z.value&&l.value.meta?(n(),c(r(Ge),{key:1})):l.value.meta?(n(),c(r(We),{key:2})):u("",!0),z.value&&l.value.alt?(n(),c(r(we),{key:3})):l.value.alt?(n(),c(r(Ce),{key:4})):u("",!0),z.value&&l.value.ctrl?(n(),c(r(xe),{key:5})):l.value.ctrl?(n(),c(r(ke),{key:6})):u("",!0),m("span",null,J(l.value.title),1)])):u("",!0),e.item.items.length>0?(n(),d("span",tt,[q(r(qe))])):u("",!0)]),_:1},16,["disabled"])),e.item.items.length>0?(n(),c(be,{key:0,ref_key:"contextMenuEl",ref:f,core:e.core,items:r(Re)(e.item.items),"parent-layout":e.parentLayout,onInput:me},null,8,["core","items","parent-layout"])):u("",!0)]),_:1},8,["class"]))}}),Mt=Ee(ot,[["__scopeId","data-v-1746ff8c"]]);export{Mt as default};
