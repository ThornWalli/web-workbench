const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./YsBFgZV-.js","./BkRx7U8b.js","./entry.BKgKayuE.css","./CNkvSXuu.js","./CJzlme9J.js","./BoZA8JgY.js","./BJmh0rUk.js","./BPnw8H1C.js","./Form.CHLd88nu.css","./eRs2tlcG.js","./FormField.uYJe21CG.css","./C-jUgzLs.js","./RangeSlider.CIPF3Jep.css","./CcXWfcLA.js","./Dropdown.D8llyuFU.css","./D9PjJnFw.js","./Button.d1yhUyXb.css","./DpGpKT4E.js","./ButtonWrapper.CJ5gVsbK.css","./JsFOm8c5.js","./ClLpnmyR.js","./BTMT_sH9.js","./Page.BBrJQr8a.css","./ColorSettings.frSgDcyk.css","./C7NIQjxM.js","./BT_Yc7AT.js","./uxCSd1pF.js","./Db7xYFkh.js","./CheckboxGroup.4lgYwaTL.css","./BrM1ohlr.js","./OlYXjGCK.js","./Textarea.B98r7nMf.css","./Settings.DZkluKzQ.css","./D68gwkTd.js","./DG6QdPnO.js","./Info.BIzvQSzn.css","./BxiH5fYY.js","./CPrp_Jrr.js","./Textfield.DAJI4Mxe.css","./D3SuBBef.js","./ItemLink.BPJTiICV.css","./BhlQppw9.js","./WebLink.eyMFa7z1.css","./cQCfnh_t.js","./Xk46uXlJ.js","./Markdown.CTZzViyZ.css","./Info.B67YLBng.css"])))=>i.map(i=>d[i]);
import{c as be}from"./BoZA8JgY.js";import{C as Ze,c as M,L as me}from"./DFR6kSAz.js";import{f as _e}from"./B1dhf47O.js";import{d as se,A as f,T as ue,c as Ie,g as Qe,p as qe}from"./QwGUwJAP.js";import{g as Je,T as Me,u as y,e as $,a as ve,i as R,b as de,w as Q,p as et,c as q,I as Ne,R as tt,f as Ae,S as rt,C as st,F as at,d as nt,s as ee,E as J}from"./B3Wmi0DA.js";import{g as Te,a as it,M as ae,W as ot,S as lt}from"./BBgkG2Na.js";import{L as H,K as W,n as ct,O as T,y as F,z as D,A as L,d as Ve,k as pe,I as Y,C as te,G as $e,Z as mt,_ as Fe,r as ut,D as dt,F as Pe}from"./BkRx7U8b.js";import{C as pt}from"./BJmh0rUk.js";import{I as N,d as Ee,a as h,b as k,g as ft}from"./ClLpnmyR.js";import{S as fe}from"./CtlMGvom.js";import{R as ht}from"./BQm3Nqs0.js";import{f as Re,a as Ce,l as gt,r as wt}from"./DG6QdPnO.js";import{o as bt,c as Et,a as yt}from"./BtH6r1li.js";import{i as Be}from"./OlYXjGCK.js";import{r as St,F as K,a as he,W as We,C as v,O as C,b as j,I as oe}from"./Dql81Gm-.js";import{S as De}from"./DsnPi5_5.js";import{S as V}from"./B9nPFJJ2.js";import{C as ge}from"./JsFOm8c5.js";import{c as It}from"./Br3o2oUw.js";import{W as Le}from"./D9PjJnFw.js";import{W as vt}from"./CPrp_Jrr.js";import{W as Nt}from"./DpGpKT4E.js";import{a as At}from"./CxKYomUj.js";import{O as Tt,i as Ue}from"./D4b9WN8K.js";import{f as Xe}from"./Bpi429LP.js";import{m as $t,e as Pt}from"./KQEr41HO.js";import{p as Rt,a as Ct}from"./BnD3zOT9.js";import{c as Wt}from"./CVx03s7S.js";import{K as Dt}from"./B4rpyJsK.js";import"./Bwr9avpB.js";import"./Cpj98o6Y.js";import"./CJzlme9J.js";import"./DeEbP9sG.js";import"./Ds4KxLLa.js";import"./CL1V9BUB.js";import"./D4lI5vpz.js";import"./OAVrZOa6.js";import"./Wv4Ty0OG.js";import"./D53hIzv4.js";import"./CTpy3bpH.js";import"./DXGPjI4_.js";import"./7gmBHocL.js";import"./BTMT_sH9.js";import"./CV0dHcg-.js";import"./C723tzWh.js";import"./BPnw8H1C.js";import"./DJBUgBH1.js";import"./CJbvcseS.js";import"./eRs2tlcG.js";import"./312NxIbt.js";var Lt=Array.isArray,xt=Object.getPrototypeOf,Ot=Object.prototype,kt=Object.keys;function _t(s){if(s.length===1){var e=s[0];if(Lt(e))return{args:e,keys:null};if(Mt(e)){var t=kt(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:s,keys:null}}function Mt(s){return s&&typeof s=="object"&&xt(s)===Ot}function Vt(s,e){return s.reduce(function(t,r,a){return t[r]=e[a],t},{})}function Ft(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];var t=Rt(s),r=Ct(s),a=_t(s),n=a.args,i=a.keys;if(n.length===0)return Xe([],t);var o=new Tt(Bt(n,t,i?function(l){return Vt(i,l)}:Ue));return r?o.pipe($t(r)):o}function Bt(s,e,t){return t===void 0&&(t=Ue),function(r){xe(e,function(){for(var a=s.length,n=new Array(a),i=a,o=a,l=function(p){xe(e,function(){var w=Xe(s[p],e),E=!1;w.subscribe(Wt(r,function(u){n[p]=u,E||(E=!0,o--),o||r.next(t(n.slice()))},function(){--i||r.complete()}))},r)},c=0;c<a;c++)l(c)},r)}}function xe(s,e,t){s?Pt(t,s,e):e()}class Ut{entries=new Map(Object.entries(Te()));observable=H(Te());storage;ready;constructor(e,t){const r=Je(t||Me.NONE);this.storage=new r({name:e}),this.ready=this.storage.load().then(a=>(this.entries=new Map([...this.entries,...a]),Object.assign(this.observable,Object.fromEntries(this.entries)),this)).catch(a=>{throw a})}setDefaults(e){return Promise.all(Object.keys(e).map(t=>{this.has(t)||this.set(t,e[String(t)])}))}get(e){return this.entries.get(e)}has(e){return this.entries.has(e)}set(e,t){return typeof e=="string"?(this.entries.set(e,t),this.observable[String(e)]=t):e&&typeof e=="object"&&!(e instanceof Map)&&Object.keys(e).forEach(r=>{t=e[r],this.entries.set(r,t),this.observable[r]=t}),this.storage.save(Array.from(this.entries))}}class Xt extends Ze{core;constructor(e){super(),this.core=e}prompt(e){const t=["openDialog","--prompt"];return e&&t.push(`--message="${y(e)}"`),this.core.executeCommand(t.join(" "))}confirm(e){const t=["openDialog","--confirm"];return e&&t.push(`--message="${y(e)}"`),this.core.executeCommand(t.join(" "))}}class Yt{#e;#r=[];constructor(e){this.#e=e}command(e,t){this.#r.push({value:e,targetValue:t})}run(){return Promise.all(this.#r.map(({value:e,targetValue:t})=>this.#e.executeCommand(e).then(r=>{const a=r===t;return a||console.warn(`[ ${e} ]; ${r} === ${t}`),{value:e,targetValue:t,result:r,success:a}})))}async start(){const e=await this.run();return[[e.length,"Tests processed"],[e.filter(t=>t.success).length,"Tests success"],[e.filter(t=>!t.success).length,"Tests failed"]]}}const jt=se(({core:s})=>[{name:["execute"],description:"Execute file.",args:[new f({index:0,name:"path",description:"Path to the file"})],async action({path:e}){let t=e;const r=new Map(s.config.get(pt.FILE_EXTENSION_ASSIGNMENT));if(!t)throw $.get("bad_args");let a;if(r.has(ve(t))?a=await s.modules.files?.fs.get(r.get(ve(t))):(a=await s.modules.files?.fs.get(t),t=void 0),typeof a?.action=="function")return a.action(s,t);if(a?.data&&typeof a?.data=="object"&&"type"in a.data){const n=a.data,i=[`openPreview "${a.getPath()}"`];return n.openMaximized&&i.push("-maximized"),s.executeCommand(i.join(" "))}}},{name:["openColorSettings"],async action(){const e=await W(()=>import("./YsBFgZV-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]),import.meta.url).then(t=>t.default);s.modules.windows?.addWindow({component:e,componentData:{},options:{title:"Color Settings",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}},{name:["openSettings"],async action(){const e=await W(()=>import("./C7NIQjxM.js"),__vite__mapDeps([24,6,7,1,2,8,15,16,17,18,25,9,10,26,27,28,29,30,31,20,21,22,32]),import.meta.url).then(t=>t.default);s.modules.windows?.addWindow({component:e,componentData:{},options:{title:"Settings",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1,filled:!0}})}},{name:["echo","print"],args:[new f({name:["newline","n"],flag:!0})],async action({newline:e},t){const r=a=>y(a).replace(/\\"/g,'"').replace(/\\n/g,`
`);if(e)t.message(t.commandArgs.map(a=>r(a)));else{let a=await t.core.executeCommand(t.commandValue);typeof a=="object"&&(a=JSON.stringify(a)),t.message(`${y(r(a))}`)}}},{name:"commands",action(e,t){const r=new ue({headerPadding:1});return r.addColumns([{value:"Command(s)",align:"left",maxWidth:20},{value:"Description/Arguments",align:"left",maxWidth:60}]),r.addRows(M.items.reduce((a,n)=>{const i=n.args||[],o=[];n.description&&(o.push(n.description),o.push("")),i.length&&(o.push("Arguments:"),o.push(""));const{flagNames:l,kwargNames:c}=i.reduce((w,E)=>{const u=E.name.join(", ");return E.flag?w.flagNames.push({name:`-${u}`,description:E.description}):w.kwargNames.push({name:`--${u}`,description:E.description}),w},{flagNames:[],kwargNames:[]}),p={paddingChr:"Â",showHeaders:!1,config:{name:{minWidth:15},description:{minWidth:10,maxWidth:30}}};return o.push(Ie(l,Object.assign({},p))),l.length>0&&c.length>0&&o.push(""),o.push(Ie(c,Object.assign({},p))),a.push([n.name.join(", "),o.join(`
`)]),a},[])),t.message(["Commands:",r]),Promise.resolve()}},{name:["CLS","CLEAR"],async action(){s.consoleInterface.clear()}},{name:["prompt","input","PROMPT","INPUT"],args:[new f({index:0,name:"text",description:"Text from prompt."}),new f({index:1,name:"variable",description:"Variable"})],action:({text:e,variable:t,unresolved:r})=>(r.text&&!r.variable?(t=r.text,e=void 0):t=r.variable,s.consoleInterface.prompt(e).then(a=>(R(a)&&(a=Number(a)),t&&s.modules.parser?.memory.set(t,a),a)))},{name:["confirm","CONFIRM"],args:[new f({index:0,name:"text",description:"Text from confirm."})],action({text:e}){return s.consoleInterface.confirm(e)}},{name:["selfCheck"],async action(e,t){const r=new ue;r.addColumns([{value:"Count",align:"left",minWidth:8},{value:"Description",align:"left",minWidth:15}]),r.addRows(await Gt(s)),t.message(['"Command Tests:"',r,'"For failures, look in the web console of the browser."'])}}]);function Gt(s){const e=new Yt(s);return e.command('"foo" +"bar"','"foobar"'),e.command("(-3+-6)+1",-8),e.command("(-3-+6)+1",-8),e.command("(-3*-6)+1",-3*-6+1),e.command("(-3/-6)+1",-3/-6+1),e.command("(-3+6)+1",4),e.command("(-3-6)+1",-8),e.command("(-3*6) + 1",-3*6+1),e.command("(-3/6)+1",-3/6+1),e.command("INT(PI)",3),e.command("(POW(2,2)+1)",5),e.command('ASC("D")',68),e.command("CHR$(68)",'"D"'),e.command('LEN("ABC")',3),e.command('"a" + "b"','"ab"'),e.command("STRING$(3,0)",'"000"'),e.command("SQRT(2,2)",Math.sqrt(2)),e.command("128 >> (256 + 5)",4),e.command("-2+4+SQRT(2,2)",2+Math.sqrt(2)),e.command("-2- 2 * 2",-2-2*2),e.command("(1+1)",2),e.command("2*2",2*2),e.command("1+2+3+(POW(2,2)+1)+5*8-(50/2)",6+(2**2+1)+5*8-50/2),e.start()}const{version:zt}=ct().public;class z{static VERSION=zt||"0.0.0";get version(){return z.VERSION}static NAME="web-workbench";setupComplete=!1;events=T(new fe);errorObserver=T(new fe);ready=T(new ht(0));modules={};consoleInterface=new Xt(this);logger=new me({core:this,debug:!1,consoleInterface:this.consoleInterface});executionCounter=0;addExecution(){return this.executionCounter++,()=>{this.executionCounter--}}config=new Ut(it,Me.SESSION);constructor(){this.log(`${z.NAME}; ${z.VERSION}`)}async setup({firebase:e,symbols:t,disks:r}={}){if(this.setupComplete)return console.warn("Setup is complete!"),this;this.setupComplete=!0,M.add(Qe(jt({core:this}))),await this.config.ready;const a=Object.values(this.modules);return await Promise.all(a.map(n=>Promise.resolve(n?.beforeSetup()))),await Promise.all(a.map(n=>Promise.resolve(n?.setup()))),r&&this.modules.files?.addDisks(r),t&&this.modules.symbols?.addSymbols(t),e&&await _e.initApp(e),this.ready.next(this),this}destroy(){M.clear()}addModule(e,t){const r=new e({core:this,...t});this.modules[be(r.name)]=r}async removeModule(e){await e.destroy(),Reflect.deleteProperty(this.modules,e.name)}executeCommands(e){const t=e.shift();if(t)return this.executeCommand(t).then(()=>this.executeCommands(e))}async executeCommand(e,t){typeof e=="string"&&(e=e.replace(/(.*[^\\])\n(\S*)/gm,"$1\\n$2"));const r=t?.show||!1,a=[];(Array.isArray(t?.message)||typeof t?.message=="string")&&a.push(...a.concat(t?.message));const n={commandBucket:M,core:this,logger:this.logger,show:r,...t,message:o=>{if(r){let l=o;typeof o=="string"&&(o=o.replace(/\\n/g,`
`),l=`"${o}"`),a.push(...[].concat(l))}}};let i;try{if(e){const o=await this.modules.parser?.parseCommand(e);o?n.commandBucket?.has(o.command)?i=await Oe(e,o,n.commandBucket,n):M.has(o.command)?i=await Oe(e,o,M,n):this.modules.parser?.mathParser.validInput(e)?i=await this.modules.parser.mathParser.parse(e):/^\w+$/.test(e)&&console.warn(`can\\'t use variable or method "${e}"`):console.warn(`can\\'t parse command "${e}"`)}}catch(o){let l=o;Array.isArray(o)&&(l=new Error(o[o.length-1])),this.errorObserver.next(l)}return i!==void 0&&i!=="undefined"&&typeof i=="string"&&n.show&&a.length<1&&a.push(i),a.forEach(o=>n.logger?.add(o,{type:me.TYPE.OUTPUT})),i}addRootItems(e){const t=this.modules.files?.fileSystem;return Promise.all(e.map(async({id:r,name:a,data:n,meta:i,items:o})=>{if(o&&o.length){const l=await t?.createRootDir(r,a,{meta:[[N.WINDOW_SIDEBAR,!1],[N.WINDOW_SCALE,!1],[N.WINDOW_SCROLL_X,!1],[N.WINDOW_SCROLL_Y,!1],[N.POSITION,{x:80,y:320}],[N.WINDOW_SIZE,{x:120,y:120}],[N.IGNORE_SYMBOL_REARRANGE,!0]]});return l?.addItems(o),l}else return t?.createRootFile(r,a,n,{meta:i||[]})})).catch(r=>{throw new Error(r)})}log(e){this.logger.add(e,{namespace:"Core"})}}async function Oe(s,e,t,r){const a=t.get(e.command);if(a){const n=r.show,i=qe(a,e),o=await a.action(i,Object.assign({command:e.command,commandValue:e.commandValue,commandArgs:e.args},r));return n&&r.showCommand&&r.logger?.add("> "+s,{type:me.TYPE.OUTPUT}),o}}function G(s,e){return s.separator===e}function Ht(s){return{rawCommand:"",mergeArgs:!1,mergeArgsBy:/^[+,]$/,hasProgram:!1,activeArgument:void 0,isLongArgument:!1,isKeyWordArgument:!1,isString:!1,stringTmpValue:void 0,additionSpecial:!1,specialChar:["+",";",","],isBufferWrite:!1,isBufferValue:!1,isBufferString:!1,rawBuffer:void 0,lastChar:void 0,isSeparating:!1,escaped:!1,currentTick:Ge,isClamp:!1,...s,separator:s.separator||Ye}}const re="[COMMAND_PARSER_NEW_LINE]";function _(s,{separator:e,forceProgram:t,mergeArgs:r,mergeArgsBy:a}={}){const n=Ht({separator:e||Ye});s=s.replace("\\n",re),s=`${String(s).trim()}${n.separator}`,n.rawCommand=s,n.mergeArgs=r||!1,n.mergeArgsBy=a||n.mergeArgsBy;const i=[];for(;n.rawCommand.length;){const o=n.rawCommand[0];n.rawCommand=n.rawCommand.slice(1);const l=n.rawCommand[0];if(G(n,l)){if(n.isSeparating&&G(n,o))n.isSeparating=!1;else if(!n.isBufferWrite&&G(n,o)){n.isSeparating=!0;continue}}else n.isSeparating=!1;if((G(n,o)&&!n.isClamp||n.rawCommand.length<1)&&(!n.escaped&&n.isBufferValue&&!n.isBufferString&&(n.isBufferWrite=!1),!n.isBufferWrite&&(n.isBufferValue&&ir(n),n.activeArgument))){nr(n,i);continue}if(o===je&&n.activeArgument){n.isKeyWordArgument=!0;continue}else if((o===le&&(/[ +a-zA-Z]/.test(l)||l===le)||n.activeArgument&&!n.isKeyWordArgument)&&!n.isBufferWrite&&!n.specialChar.includes(o))if(n.activeArgument){!n.activeArgument?.name?.length&&o===le?n.isLongArgument=!0:n.activeArgument.name+=o;continue}else{n.activeArgument={name:x},n.isLongArgument&&(n.activeArgument.long=n.isLongArgument);continue}sr(n,o)}return Jt(i,{forceProgram:t,mergeArgs:r,mergeArgsBy:a})}function Kt(s){return s.value?.type==="any"&&!s.name&&s.value?.raw&&/^[a-zA-Z]+$/.test(s.value?.raw)||!1}function Zt(s){return s.value?.raw==="+"}function Qt(s,e=/^[+]$/){return s.reduce((t,r)=>{const a=t[t.length-1]?.value?.raw,n=a&&a[String(a).length-1];if(typeof e=="string"&&(String(r.value?.raw)===e||String(n)===e)||e instanceof RegExp&&(e.test(String(r.value?.raw))||e.test(String(n)))){const i=t[t.length-1].value;i&&i.raw&&typeof i.value=="string"&&(i.raw+=r.value?.raw,i.value+=r.value?.value||"",i.type="any")}else t.push(r);return t},Array())}function qt(s,e){const t=[];return s&&t.push(s),t.push(...e.map(r=>{if(r.plain)return r.value?.raw||r.name||x;{const a=r.long?"--":"-",n=r.name||x,i=r.value?.raw||x,o=r.value?je:"";return`${a}${n}${o}${i}`}})),t}function Jt(s,{forceProgram:e,mergeArgs:t,mergeArgsBy:r}={}){const a=s[0],n=s[1];let i;(!n||!Zt(n))&&a&&(Kt(a)||e)&&(s=s.filter(c=>c!==a),i=a.value?.raw);let o=s;t&&(o=Qt(s,r));const l=qt(i,o);return{program:i?.replace(re,`
`),args:o,rawArgs:l}}const er="\\",x="",Ye=" ",le="-",je="=",Ge='"',tr="'";function rr(s){return s===er}function sr(s,e){rr(e)?s.escaped=!0:(!s.escaped&&!s.isBufferValue&&!G(s,e)?(s.isBufferWrite=!0,s.isBufferValue=!0,(e===tr||e===Ge)&&!s.isClamp&&(s.currentTick=e,s.isBufferString=!0),s.isBufferString=e===s.currentTick,s.rawBuffer=void 0,s.activeArgument=s.activeArgument||{value:void 0,plain:!0}):e===s.currentTick&&s.isBufferString&&!s.escaped&&!s.isClamp&&(s.isBufferWrite=!1),(e!==s.currentTick||s.isClamp||s.escaped&&e===s.currentTick)&&((!s.isBufferWrite&&s.isBufferString||s.isBufferWrite&&!s.isBufferString)&&!s.isClamp&&s.specialChar.includes(e)&&!s.additionSpecial?(s.rawCommand=" "+e+" "+s.rawCommand,s.additionSpecial=!0):(s.additionSpecial=!1,s.rawBuffer=(s.rawBuffer||"")+e)),s.escaped=!1),s.isBufferWrite&&(e==="("?s.isClamp=!0:e===")"&&(s.isClamp=!1)),s.lastChar=e}function ar(s){return s.plain&&!s.name&&s.value?.type==="any"&&(s.value?.raw===void 0||s.value?.raw===x)}function nr(s,e){s.activeArgument&&(s.isLongArgument&&(s.activeArgument.long=s.isLongArgument),ar(s.activeArgument)||e.push(s.activeArgument)),s.activeArgument=void 0,s.isLongArgument=!1,s.isKeyWordArgument=!1}function ir(s){const e=s.rawBuffer||x;if(s.isBufferString)s.activeArgument.value={type:"string",value:s.rawBuffer?.replace(re,`
`),raw:`${s.currentTick}${s.rawBuffer?.replace(re,`
`)||""}${s.currentTick}`};else{let t="any",r=e;/^[+-]?\d+$/.test(e)?(t="integer",r=Math.round(Number(e))):/^[+-]?(?:\d+\.?\d*|\.\d+)$/.test(e)?(t="double",r=Number(e)):/^true|false$/.test(e)?(t="boolean",r=e==="true"):/^[a-zA-Z$]+$/.test(e)?(t="any",r=String(e).replace(/ /g,x)):/^[\d+\-*./a-zA-Z$]+$/.test(e)&&(t="term",r=String(e).replace(/ /g,x)),s.activeArgument.value={type:t,value:r,raw:s.rawBuffer}}s.rawBuffer=void 0,s.isBufferValue=!1,s.isBufferString=!1}class S{static REGEX_VALUE_RESOLVE=/[$]{3}(\d+)/;static REGEX_COMMAND_REPLACE=/^([a-zA-Z]+[a-zA-Z0-9_]+) (.*)$/;static REGEX_PARAM_KWARG=/^[-]{0,2}([\\-\w]+)=(.*)$/;static REGEX_PARAM_ARG=/^[-]{1,2}([\\-\w]+)$/;async parse(e){const t=_(e,{forceProgram:!0}),r=await this.getArguments(t);return{origin:e,unresolved:lr(t),args:r.args,kwargs:r.kwargs,command:t.program||"",commandValue:e}}getArguments(e){return{args:e.args.filter(t=>t.plain).map(t=>{if(t.value)return t.value.value}),kwargs:Object.fromEntries(e.args.filter(t=>!t.plain).map(t=>[be(t.name||""),t.value!==void 0?t.value.value:void 0]))}}static extractStrings(e){let t=!1,r=0;const a=[];let n=!1;for(let o=e.length-1;o>=0;o--){const l=e[Number(o)],c=e[o-1];!n&&l==='"'&&c!=="\\"?t?(t=!1,a.push(e.slice(o,r+1))):(n=!1,t=!0,r=o):(!t&&n||n)&&l==="'"&&c!=="\\"&&(t?(n=!1,t=!1,a.push(e.slice(o,r+1))):(n=!0,t=!0,r=o))}if(t)throw new Error("can't extract values; "+e);return{result:a.reduce((o,l,c)=>o.replace(l,S.resolveKey(c)),e),values:a}}static extractValues(e,t=" "){let r=!1,a=0;const n=[];let i=!1;for(let l=e.length-1;l>=0;l--){const c=e[Number(l)],p=e[l-1];!i&&c==='"'&&p!=="\\"?r?(r=!1,n.push(e.slice(l,a+1))):(i=!1,r=!0,a=l):(!r&&i||i)&&c==="'"&&p!=="\\"&&(r?(i=!1,r=!1,n.push(e.slice(l,a+1))):(i=!0,r=!0,a=l))}if(r)throw new Error("can't extract values; "+e);return n.forEach((l,c)=>{e=e.replace(l,S.resolveKey(c))}),{params:e.split(t).filter(l=>l),values:n}}static resolveKey(e){return`$$$$$$${e}`}static resolveValues({params:e,values:t}){return e.map(r=>S.resolveValue(r,t))}static valueUnresolved(e){return typeof e=="string"&&S.REGEX_VALUE_RESOLVE.test(e)}static resolveValue(e,t){let r=e;if(S.valueUnresolved(e)){if(r=String(e).match(/[$]{3}(\d+)/g)?.reduce((a,n)=>a.replace(n,t[Number(n.replace(S.REGEX_VALUE_RESOLVE,"$1"))]),String(e)),/[\w]+[$%]?[ ]*\(/.test(r||""))return r;if(typeof r=="string"){if(r==="undefined")return;if(or(r))return Number(r);if(!r.startsWith('"'))return r}}return r}}function or(s){return!isNaN(Number(s))}function lr(s){return{args:s.args.filter(e=>e.plain).map(e=>e.value?.raw||""),kwargs:Object.fromEntries(s.args.filter(e=>!e.plain).map(e=>[be(e.name||""),e.value?.raw||""]))}}class ze{name;#e;global=!1;readonly=!1;constructor(e,t,r,a){this.name=e,this.#e=t,this.global=r||this.global,this.readonly=a||this.readonly}get value(){return this.#e}set value(e){this.readonly||(this.#e=e)}}class cr extends ze{constructor(e,t,r=!1){super(e,t,r,!0)}async execute(...e){if(typeof this.value=="function")return this.value(...e)}}class we extends ze{}class ye{#e=new Map;#r=new Map;#t=[];reset(){this.resetPrefixStack(),this.#e.clear(),this.#r.clear()}resetPrefixStack(){this.#t=[]}get prefixStack(){return this.#t}get currentPrefixStack(){return this.#t[this.#t.length-1]}has(e){return e=e.replace(/(.*[^ ])[ ]+$/,"$1"),e=e.replace(/[$%]$/,""),(!this.#e.get(e)||this.#e.get(e)&&!this.#e.get(e)?.global)&&(e=this.prepareName(e)),this.#e.has(e)}add(e,t,r=!1,a=!1){e=e.replace(/(.*[^ ])[ ]+$/,"$1"),/\$$/.test(e)?t===void 0&&(t=""):/\\%$/.test(e)&&t===void 0&&(t=0),e=e.replace(/[$%]$/,""),e=this.prepareName(e),this.has(e)||this.#e.set(e,new we(e,t,r,a))}get(e){e=e.replace(/(.*[^ ])[ ]+$/,"$1");const t=e;e=e.replace(/[$%]$/,""),(!this.#e.get(e)||this.#e.get(e)&&!this.#e.get(e)?.global)&&(e=this.prepareName(e));const r=this.#e.get(e);if(r){let a=r.value;return a&&typeof a=="string"&&(/\$$/.test(t)?a=String(a):/\\%$/.test(t)||/^\d+$/.test(a)?a=parseInt(a):/^[\d.]+$/.test(a)&&(a=parseFloat(a))),a}}set(e,t,r=!1,a=!1){if(e=e.replace(/(.*[^ ])[ ]+$/,"$1"),typeof t=="string"&&(/[$]$/.test(e)?t===void 0?t="":t=String(t):/[%]$/.test(e)&&(t===void 0?t=0:t=parseInt(t))),e=e.replace(/[$%]$/,""),e=this.prepareName(e),this.has(e)){const n=this.#e.get(e);n instanceof we&&n&&(n.value=t)}else this.add(e,t,r,a)}addSub(e,t){e=this.prepareName(e,!1),this.has(e)||this.#r.set(e,new cr(e,t))}async executeSub(e,t=[],r=!1){return t=t||[],e=this.prepareName(e,!1),this.#t.push({name:`${Math.round(Math.random()*1e4)}`,global:r}),this.#r.get(e)?.execute(...t).then(n=>(this.#e.forEach(i=>{RegExp(`[$]{3}${this.#t[this.#t.length-1].name}$`).test(i.name)&&this.#e.delete(i.name)}),this.#t.pop(),n))}hasSub(e){return e=this.prepareName(e,!1),this.#r.has(e)}prepareName(e,t=!0){return typeof e=="string"&&(e=e.replace(/ /g,"")),t&&this.#t.length&&!/[$]{3}/.test(e)&&(e=`${e}$$$${this.#t[this.#t.length-1].name}`),e}get dims(){return this.#e}get subs(){return this.#r}}let mr=class{debug=!1;#e;#r;#t;#s;#l;#d=9999999999;#p=0;#n;#f=[];#u=0;#c=[];#a=-1;#m=[];#i=[];#o=-1;constructor(e,t,r,a,n,i){this.#l=e,this.#s=t||(()=>Promise.resolve(void 0)),this.#t=r||new ye,this.#e=a,this.#r=n,this.debug=i!==void 0?i:this.debug}get memory(){return this.#t}get lines(){return this.#l}parse(e){e=e||Array().concat(this.#l);const t=e.shift()?.trim();return new Promise(r=>{if(this.#n&&t!=="END SUB"){t&&this.#n.lines.push(t),r(void 0);return}if(this.#d>0&&this.#p>this.#d)throw new Error("BASIC INTERPRETER OVERFLOW");if(this.#p++,this.#o>=0){const a=this.#i[this.#o];if(a){if(this.#i.forEach(n=>{a.count===0&&n&&t&&n.count===0&&n.lines.push(t)}),t&&(t==="WEND"||/NEXT /.test(t)))return a.condition().then(async n=>{if(a.tmpLines=a.tmpLines||e,n){const i=a.lines;return a.count++,a&&typeof a.step=="function"&&await a.step(),i.length>0?this.parse(Array().concat(i)):(this.#i[this.#o]=!1,this.#o--,this.#i.pop(),null)}else return this.#i[this.#o]=!1,this.#o--,this.#i.pop(),null}).then(r);r(void 0)}else r(void 0)}else r(void 0)}).then(()=>{if(!this.#n&&this.#a>=-1&&(this.#m[this.#a]!==void 0&&this.#c[this.#a]===void 0&&this.#c.push(!this.#m[this.#a]),t==="ELSE"&&this.#u<1&&(this.#c[this.#a]=!this.#c[this.#a])),this.#c[this.#a])t&&/^IF (\((.*)\)|(.*)) THEN$/.test(t)&&this.#u++;else return this.parseLine(t,e);return null}).then(()=>(this.#a>-1&&(t==="ENDIF"||t==="END IF")&&(this.#u<1?(this.#a--,this.#m.pop(),this.#c.pop()):this.#u--),e.length?this.parse(e):this.#f))}parseLine(e,t){return new Promise((r,a)=>{if(e=(e||"").replace(/^[ \t]+/g,""),/^ *[#/]+/.test(e)){r(void 0);return}if(/^GOTO +([\w\d]+)$/.test(e)){const n=e.match(/^GOTO +([\w\d]+)$/)||[];this.commandGoto(t,n[1]),e=""}if(/^SUB (.*) STATIC$/.test(e)){const n=e.match(/^SUB (.*) STATIC$/)||[];return this.commandSubStatic(n[1]).then(r)}else{if(e==="END SUB")return this.commandEndSub().then(r);if(this.#n){r(void 0);return}}if(/^IF (\((.*)\)|(.*)) THEN$/.test(e)){const n=e.match(/^IF (\((.*)\)|(.*)) THEN$/)||[],i=n[3]||n[2];return this.commandIfThen(i).then(r)}else if(e==="ELSE"||e==="ENDIF"||e==="END IF"){r(void 0);return}if(/^WHILE (.*)$/.test(e)){const n=e.match(/^WHILE (.*)$/)||[];return this.commandWhile(n[1]).then(r)}else if(e==="WEND"){r(void 0);return}if(/^FOR (.*)$/.test(e)){const n=e.match(/^FOR (.*)$/)||[];return this.commandFor(n[1]).then(r)}else if(e.startsWith("NEXT ")){r(void 0);return}if(/^([\w\d]+):$/.test(e)){r(void 0);return}if(/^DIM( SHARED)? +(.*)$/.test(e)){const n=e.match(/^DIM( SHARED)? +(.*)$/)||[];return this.commandDimShared(n[2],!!n[1]).then(r)}if(/^LET +([\w,$%]+)(\((.*)\))? *= *(.*)$/.test(e)){const n=e.match(/^LET +([\w,$%]+)(\((.*)\))? *= *(.*)$/)||[];return this.commandLet(n[1],n[4],n[3]).then(()=>r(void 0))}if(/^READ +([\w, $%]+)$/.test(e)){const n=e.match(/^READ +([\w, $%]+)$/)||[];return this.commandRead(n[1]).then(r)}if(/^END[ ]*$/.test(e))return this.commandEnd().then(r);if(/^(PAUSE|SLEEP) +(.+)/.test(e)){const i=(e.match(/^(PAUSE|SLEEP) +(.+)/)||[])[2];return this.commandPause(i).then(r)}if(/^CALL *(.*)/.test(e)){const n=e.match(/^CALL *(.*)/)||[];return this.commandCall(n[1],t).then(r)}if(/^EXECUTE *(FILE|EVAL) *(.*)/.test(e)){const n=e.match(/^EXECUTE *(FILE|EVAL) *(.*)/)||[];return this.commandExecute(n[1],n[2]).then(r).catch(a)}if(/^PRINT +USING +.*$/.test(e)){const n=e.match(/^PRINT +USING +(.*)$/)||[];return this.commandPrintUsing(n[1]).then(r)}if(/^PRINT +(.*)$/.test(e)){const n=e.match(/^PRINT +(.*)$/)||[];return this.commandPrint(n[1]).then(r)}if(/^DATA +(.*)$/.test(e)){const n=e.match(/^DATA +(.*)$/)||[];return this.commandDataVar(n[1]).then(r)}this.#s(e,{show:!0}).then(n=>{n!==void 0&&this.#f.push(n)}).then(r).catch(a)})}async setReadStack(e,t){let r=await this.parseValue(t,!0);return typeof r=="string"&&R(r)&&(r=parseFloat(r)),this.#t.set(e,r,!0)}async addDataStack(e){let t=await this.parseValue(e,!0);return typeof t=="string"&&R(t)&&(t=parseFloat(t)),this.#e.push(t)}async setStack({name:e,value:t,index:r,global:a}){let n=await this.parseValue(t,!0);if(typeof n=="string"&&R(n)&&(n=parseFloat(n)),r!==void 0){r=Number(await this.parseValue(r,!0));const i=this.#t.get(e);if(typeof i=="object")return i[r-1]=n,n;throw new Error(`Index ${r} out of range`)}else return this.#t.set(e,n,a)}async setGotoMarkStack(e,t){this.#r.set(e,await this.parseValue(t,!0))}async parseValue(e,t=!0,r=!1){if(e===void 0)return e;if(Array.isArray(e))return e;if(typeof e=="boolean")return e;if(typeof e=="number")return Number(e);if(typeof e=="string"){if(/^ *(true|false|TRUE|FALSE) *$/.test(e))return e.toLowerCase()==="true";if(/^[\d]+$/.test(e.trim())||/^ *([\\-]?[\d.]+(e[-+]?\d+)?) *$/.test(e.trim()))return parseFloat(e);if(/^ *@"((.|\n)*)" *$/.test(e.trim()))return e.replace(/^ *@"((.|\n)*)" *$/,'"$1"');if(/^"((\\"|[^"])+)"$/.test(e.trim()))return e.trim().replace(/^"((\\"|[^"])+)"$/,'"$1"');if(/^[^"]?(.+)[^"]? *$/.test(e.replace(/ /g,""))){if(e=e.replace(/^ */g,""),this.#t.has(e.replace(/ /g,"")))return e=e.replace(/ /g,""),this.parseValue(this.#t.get(e),!0);if(r)throw new Error(`Value processing continues: ${e.slice(0,20)}…'`);return this.#s(e,{message:t?void 0:e})}}}async executeCondition(e,t,r){const a=await this.parseValue(e,!0),n=await this.parseValue(r,!0);return/^[=]?==$/.test(t)?a===n:t==="<>"?a!==n:/^([<>][=]|[<>])?$/.test(t)?ur(a,t,n):/^!=[=]?$/.test(t)?a!==n:!1}commandIfThen(e){const t=e.match(/([^<>]*) *(<>|<=|>=|<|>|[=!]{2,3}) *([^<>].*)/);return t?this.executeCondition(t[1],t[2],t[3]).then(r=>(this.#m.push(r),this.#a++,r)):this.parseValue(e[1],!0).then(r=>{let a=r;return r instanceof we&&(a=r.value),this.#m.push(!!a),this.#a++,a})}commandWhile(e){const t=e.match(/([^<>]*) *(<>|<=|>=|<|>|[=!]{2,3}) *([^<>].*)/);return t?this.executeCondition(t[1],t[2],t[3]).then(r=>{if(r)return this.#i.push({count:0,lines:[],condition:()=>this.executeCondition(t[1],t[2],t[3])}),this.#o++,r}):Promise.resolve(void 0)}async commandFor(e){const t=e.match(/(.*) *= *(.*) +TO +(.*) +STEP[ ](.*)/)||e.match(/(.*) *= *(.*) +TO +(.*)/);if(t){const r=await this.parseValue(t[2],!0),a=await this.parseValue(t[3],!0);this.#t.set(t[1],r),this.#o++;const n=async(i=!0)=>{let o=1;return t[4]&&(o=await this.parseValue(t[4],!0)),i&&this.#t.set(t[1],Number(this.#t.get(t[1]))+o),o};return this.#i.push({step:n,count:0,lines:[],condition:async()=>{const i=await n(!1);return i===0?!1:this.executeCondition(`(${t[1]}  )`,i<0?">":"<",String(a))}})}}commandSubStatic(e){const t=e.match(/^([\w,$%]+)(\((.*)\))?$/)||[],r=t[1],a=S.resolveValues(S.extractValues(t[3]||"",","));return this.#n={name:r,lines:[],args:a},Promise.resolve(void 0)}commandEndSub(){if(this.#n){const e=this.#n.lines,t=this.#n.args;this.#t.addSub(this.#n.name,async(...r)=>{(await Promise.all(t.map((n,i)=>this.parseValue(r[Number(i)]).then(o=>({arg:n,value:o}))))).forEach(({arg:n,value:i})=>{n&&this.#t.add(String(n),i)}),await this.parse(Array().concat(e))}),this.#n=void 0}else throw new Error("has no active SUB");return Promise.resolve(void 0)}commandGoto(e,t){return e.splice(0,e.length),this.parse(this.#l.slice(this.#l.indexOf(`${t}:`),this.#l.length))}commandDimShared(e,t){return S.resolveValues(S.extractValues(e,",")).reduce((a,n)=>{const i=String(n||"").match(/^([\w, $%]+)?(\((.*)\))?$/)||[];return this.#t.has(i[1])||(i[3]&&(a=a.then(()=>this.parseValue(i[3],!0))),a=a.then(o=>(this.setStack({name:i[1],value:o?Array(o):void 0,global:t}),o))),a},Promise.resolve(void 0))}commandLet(e,t,r){if(this.#t.has(e))return this.setStack({name:e,value:t,index:r});throw new Error(`Variable ${e} not defined`)}async commandPrintUsing(e){const t=_(e,{mergeArgs:!0,mergeArgsBy:/^[+,]$/}).rawArgs,r=_(t[2],{mergeArgs:!0}).rawArgs.filter(i=>i!==",").map(i=>this.parseValue(i)),a=await Promise.all(r);let n=y(t[0]);for(;n.includes("#");){const i=a.shift(),o=n.match(/(#+\.#+)|(#+)/);if(o&&/(#+\.#+)/.test(o[0])){const[l,c]=o[0].split("."),[p,w]=String(i).split("."),E=Re(String(p||"").slice(0,l.length),l.length,!0," ")+"."+Re(String(w||"").slice(0,c.length),c.length,!1,"0");n=n.replace(/(#+\.#+)/,y(String(E)))}else n=n.replace(/(#+|#+\.#+)/,y(String(i)))}return this.#s(null,{message:`"${y(n)}"`})}commandDataVar(e){if(this.#e.length===0)return Promise.all(e.split(",").map(t=>this.addDataStack(t)));throw new Error("DATA has already been declared")}async commandPrint(e){if(/^((".*"|[^"]*);([^;]*))$/.test(e)){const t=e.match(/(.*);(.*)$/)||[],r=await this.parseValue(t[1],!0),{rawArgs:a}=_(String(t[2]),{mergeArgs:!0});let n=await Promise.all(a.map(o=>this.parseValue(o,!0)));n=n.map(o=>y(o));const i=n.map(o=>`${y(r)}${o}`).join(" ");return this.#s(null,{message:de(i)||R(i)?i:`"${i}"`})}else{let t=await this.parseValue(e);const{rawArgs:r}=_(String(t),{mergeArgs:!0});let a=await Promise.all(r.map(n=>this.parseValue(n,!0)));return a=a.map(n=>y(n)),a.length>1?t=a.join(""):t=a[0],this.#s(null,{message:de(t)||R(t)?t:`"${t}"`})}}commandEnd(){return Promise.resolve(void 0)}async commandPause(e){const t=Number(await this.parseValue(e));return new Promise(r=>window.setTimeout(()=>{r(void 0)},t))}commandRead(e){const t=e.split(",");return Promise.all(t.map(r=>{const a=this.#e.shift();return this.setReadStack(r,a),Promise.resolve(void 0)}))}commandCall(e,t){const a=(e.match(/([^(]+)\(.*\)/)||[])[1];if(this.#t.hasSub(a))return this.parseLine(e,t);throw new Error(`SUB ${a} NOT FOUND`)}async commandExecute(e,t){if(!this.#s)throw new Error("No callback available for readfile");let r;switch(e){case"FILE":if(r=await this.#s(`readfile ${t}`,{show:!1}),r&&typeof r=="object"&&"content"in r)return this.#s(r.content,{show:!0});throw new Error("File Content is empty");case"EVAL":return this.parseValue(t,!1)}}};function ur(s,e,t){switch(s=String(s),t=String(t),(e.match(/^([<>][=]|[<>])$/)||[])[1]){case"<":return parseFloat(s)<parseFloat(t);case">":return parseFloat(s)>parseFloat(t);case"<=":return parseFloat(s)<=parseFloat(t);case">=":return parseFloat(s)>=parseFloat(t);default:return null}}class dr{#e;#r;#t=new Map;#s=[];constructor(e,t){this.#r=t,this.#e=e}get callback(){return this.#r}get memory(){return this.#e}async parse(e,t,r){if(e.length===0)return;e.length>1&&await this.readData(e);const a=[];return new mr(e,async(i,o)=>{o={...o,...r};const l=t||this.#r?await(t||this.#r)(i,o):{};return o.show&&l!==void 0&&a.push(l),l},this.#e,this.#s,this.#t).parse().then(()=>a)}readData(e){const t=e.find(r=>/^[ ]*DATA[ +]/.test(r));if(t){const r=e.splice(e.indexOf(t),1);return this.parse(r)}return Promise.resolve(void 0)}}function P(...s){if(s.includes(void 0))throw new Error("invalid arguments")}const b={};try{b.brackets=/([^\w$%]?)\(([^\\(\\)]+)\)/,b.brackets_start=/^\((.*)\)$/,b.multiply=new RegExp("[^\\d$\\-\\w]?(?<a>([+-]?[\\w.]+e\\+\\d+)|([+-]?[\\w$%.]+)|(^[+-]?[\\w$%.]+)|([\\w$%.]+)|([$]{3}\\d+))[ ]*(?<operator>[\\^*%\\/]|MOD|XOR|AND|OR|<<|>>|>>>)[ ]*(?<b>([-]?[\\w.]+e\\+\\d+)|([-]?[\\w$%.]+)|(^[+-]?[\\w$%.]+)|([\\w$%.]+)|([$]{3}\\d+))"),b.add_subtract=/([+-]?[\w.]+e\+\d+|[+-]?[\w$%.]+|[$]{3}\d+)[ ]*([+-])[ ]*([+-]?[\w.]+e\+\d+|[+-]?[\w$%.]+|[$]{3}\d+)/,b.function=/([\w]+[a-zA-Z0-9_.]+[$%]?)[ ]*\(([^\\(\\)]*)\)/,b.function_start=/^([\w]+[a-zA-Z0-9_.]+[$%]?)[ ]*\(([^\\(\\)]*)\)/,b.variable=/^([\w]+[a-zA-Z0-9_.]?[$%]?)/,b.number=/^([+-]?[\d.]+e\+\d+|[+-]?[\d.])+($|$)/}catch(s){console.error(s)}class pr{debug=!1;memory;constructor(e,t){this.memory=this.createMemory(e),this.debug=t!==void 0?t:this.debug}createMemory(e){const t=e||new ye;return t.addSub("RND",()=>Promise.resolve(Math.random())),t.addSub("PI",()=>Promise.resolve(Math.PI)),t.addSub("POW",(r,a)=>{if(P(r,a),typeof r=="string")throw new Error("Parameter is not a number");if(typeof a=="string")throw new Error("Parameter is not B number");return Promise.resolve(r**(a||2))}),t.addSub("SQRT",r=>{if(P(r),typeof r=="string")throw new Error("Parameter is not a number");return Promise.resolve(Math.sqrt(r))}),t.addSub("INT",async r=>(P(r),await parseInt(y(String(r))))),t.addSub("SPC",r=>{if(P(r),typeof r=="string")throw new Error("Parameter is not a number");return Promise.resolve(`"${Ce(r," ")}"`)}),t.addSub("LEN",r=>(P(r),Promise.resolve(y(String(r)).length))),t.addSub("ASC",r=>(P(r),Promise.resolve(String(y(r)).charCodeAt(0)))),t.addSub("CHR$",r=>{if(P(r),typeof r=="string")throw new Error("Parameter is not a number");return Promise.resolve(Q(String.fromCharCode(r)))}),t.addSub("LEFT$",(r,a)=>{if(P(r,a),typeof a=="string")throw new Error("Parameter is not B number");return Promise.resolve(`"${gt(y(r),a)}"`)}),t.addSub("RIGHT$",(r,a)=>{if(P(r,a),typeof a=="string")throw new Error("Parameter is not B number");return Promise.resolve(Q(wt(String(y(r)),a)))}),t.addSub("STRING$",(r,a)=>{if(P(r,a),typeof r=="string")throw new Error("Parameter is not a number");return Promise.resolve(Q(Ce(r,String(y(a)))))}),t.addSub("TIME%",()=>Promise.resolve(Date.now())),t.addSub("HEX_ENC$",r=>(P(r),Promise.resolve(Q(Number(y(r)).toString(16))))),t.addSub("HEX_DEC$",r=>(P(r),r=parseInt(String(y(r)),16),Promise.resolve(r))),t}async parse(e){const r=await new hr(this).parse(e);return this.debug&&console.debug("Result:",typeof r,r),r}validInput(e){return e&&/[/*\-+^()]?/.test(e)}}const fr=5e3;class hr{debug=!1;parser;parsedValues=[];timeout=0;constructor(e,{debug:t}={}){this.parser=e,this.debug=t!==void 0?t:this.debug}async parse(e){if(this.debug&&console.debug("PARSE ".padEnd(20,"-")),this.timeout>fr)throw new Error(`Can't parse ${e}`);this.timeout++;const{result:t,values:r}=S.extractStrings(String(e));let a=_(t).rawArgs;this.parsedValues=this.parsedValues.concat(r),a=a.map(l=>/^MOD|XOR|AND|OR$/.test(l)?` ${l} `:l);let n=a.join("");R(n)?n=Number(n):de(n)&&(n=!!n);const i=n,o=await this.action(n);if(this.debug&&console.debug("action:",typeof o,o),o!==void 0){let l;return typeof o=="string"&&o!==i&&!/^".*"$/.test(String(o))?(l=await this.parse(o),this.debug&&console.debug("parse:",typeof l,l),l):(l=await this.resolveValue(o),this.debug&&console.debug("$v:",typeof l,l),l)}}async action(e){if(typeof e=="string"){if(b.brackets_start?.test(e)){const t=e.match(b.brackets_start);if(t){const[r,a]=t;e=e.replace(r,a)}else throw new Error("Invalid expression")}if(b.function?.test(e)){const t=e.match(b.function);if(t){const[r,a,n,i]=t,o=a||i;let l=_(n||"",{separator:","}).rawArgs;const c=n.includes(",")&&l.join("")!==n;c&&(l=n.split(","));let p=await Promise.all(l.map(w=>this.parse(w)));if(p=c?p:[await this.parse(p.join(""))],this.parser.memory.has(o))return e.replace(r,this.parser.memory.get(o)?.[Number(p[0])-1]);if(this.parser.memory.hasSub(o))return e.replace(r,this.cacheValue(await this.parser.memory.executeSub(o,p)))}}if(b.brackets?.test(e)){const t=e.match(b.brackets);if(t){const[r,a,n]=t;return e.replace(r,a+await this.parse(n))}else throw new Error("Invalid expression")}if(b.multiply?.test(e))return this.operation(e,b.multiply);if(b.add_subtract?.test(e))return this.operation(e,b.add_subtract)}return this.resolveValue(e)}async operation(e,t){const r=e.match(t);if(r){let a,n,i;const o=r[0];"groups"in r&&r.groups?(a=r.groups.a,n=r.groups.b,i=r.groups.operator):(a=r[1],i=r[2],n=r[3]);let l=e,c=await this.parse(a);R(c)||(c=y(c));let p=await this.parse(n);switch(R(p)||(p=y(p)),this.debug&&console.debug({valueA:c,valueB:p}),c=c,p=p,i){case"+":l=c+p;break;case"-":l=c-p;break;case"*":l=c*p;break;case"/":l=c/p;break;case">":l=c>p;break;case"<":l=c<p;break;case"^":l=c^p;break;case"%":l=c%p;break;case"MOD":l=c%p;break;case"AND":l=c&p;break;case"OR":l=c|p;break;case"XOR":l=c^p;break;case"<<":l=c<<p;break;case">>":l=c>>p;break;case">>>":l=c>>>p;break}return R(l)||(l=`"${l}"`),e.replace(o,o.replace(RegExp(`[${a}]{${String(a).length}}[ ]*[${i}]{${String(i).length}}[ ]*[${n}]{${String(n).length}}`),"")+this.cacheValue(l))}else throw new Error("Invalid expression")}async resolveValue(e){if(typeof e!="function"&&S.valueUnresolved(e))return S.resolveValue(e,this.parsedValues);if(typeof e=="string"){if(e=e.replace(/^[ ]*([^ ].*[^ ])[ ]*$/,"$1"),b.number?.test(e)){if(R(e))return Number(e)}else if(b.function_start?.test(String(e))){const t=e.match(b.function_start);if(t){const[,r,a]=t;if(this.parser.memory.hasSub(r))return this.parser.memory.executeSub(r,S.resolveValues(S.extractValues(a,",")));throw new Error(`can't find sub "${r}" in memory`)}else throw new Error("Invalid expression")}else if(b.variable?.test(String(e))){const t=e.replace(b.variable,"$1");if(this.parser.memory.hasSub(t))return this.parser.memory.executeSub(t);if(this.parser.memory.has(t))return this.parser.memory.get(t)}}return e}cacheValue(e){return this.parsedValues.push(e),S.resolveKey(this.parsedValues.length-1)}}const gr=["CLS","READ max","DIM fib%(max)","LET fib(1) = 1","LET fib(2) = 2","FOR i=3 TO max","LET fib(i) = fib(i - 2) + fib(i -1)","NEXT i","FOR i=1 TO max","PRINT fib(i)","NEXT i","DATA 10","END"],wr=["CLS","DIM w%,h%,a%","LET w%=12","LET h%=4","LET a%=w%*h%",'PRINT "With the width " + w%','PRINT " and the height " + h%','PRINT " you have the area " + a%'],br=["CLS","DIM r,a","LET r=5","READ pi","LET a=r*r*pi",'PRINT USING "With the radius ##.##"; r','PRINT USING "we have the area ##.##"; a',"DATA 3.14","END"],Er=["GuessTheNumber","CLS","READ max%","DIM number%, guess%, guesses%",'PRINT "The number is between 1-1000."',"LET number% = INT(RND * max%) + 1","LET guess% = 1","LET guesses% = 0","WHILE guess%<>number%",'PRINT "Guess the number"',"INPUT guess%","IF (guess%<>number%) THEN","IF (guess%>number%) THEN",'PRINT "Your guess was too high"',"ELSE",'PRINT "Your guess was too low"',"ENDIF","ENDIF","LET guesses% = guesses% + 1","WEND",'PRINT USING "You found the number in # tries"; guesses%',"DATA 1000","END"],yr=["DIM result",'PRINT "Calculate the factorial of"',"INPUT n","LET result = 1","FOR i = n TO 1 STEP -1","LET result = result * i","NEXT i",'PRINT USING "#! = #"; n, result',"END"],Sr=["CLS","DIM stars$",'PRINT "Enter the height of the pyramid"',"INPUT height",'LET stars$ = ""',"FOR i = 1 TO height",'LET stars$ = ""',"FOR j = 1 TO (i+i-1)",'LET stars$ = stars$ + "*"',"NEXT j","PRINT SPC(height - i) + stars","NEXT i","END"],Ir=['PRINT "Step 1"','PRINT "Step 2"','PRINT "Step 3"',"GOTO ignore",'PRINT "Step 4"',"ignore:",'PRINT "Step 5"'],vr=["DIM A, B","LET A = 2000",'LET B = "Hello World"','PRINT USING "A: #"; A','PRINT USING "B: #"; B'],Nr=["DIM A, B","LET A = 1","LET B = 2","IF A == B THEN",'PRINT "true"',"ELSE",'PRINT "false"',"END","IF (A < B) THEN",'PRINT "true"',"END"],Ar=["DIM i%","FOR i% = 1 TO 5",'PRINT USING "For Number #"; i%',"NEXT i%"],Tr=["DIM i%","LET i%=0","WHILE i% < 5",'PRINT USING "While Number #"; i%',"LET i% = i% + 1","WEND"],$r=["DIM duration","LET duration = 2500",'PRINT USING "Start with Pause #ms"; duration',"PAUSE duration",'PRINT "End Pause"','PRINT USING "Start with Sleep #ms"; duration',"PAUSE duration",'PRINT "End Sleep"'],Pr={Fibonacci:gr,Area:wr,Circle:br,"Your Name":["CLS",'PRINT "What is your name?"',"INPUT n$",'PRINT "What is your shoe size?"',"INPUT size",'PRINT "Hello "; n$','PRINT USING "your shoe size is ##.##"; size',"END"],GuessTheNumber:Er,Factorial:yr,Pyramid:Sr,"Bubble Sort":["CLS","READ max","DIM SHARED numbers(max)","SUB CreateList(max) STATIC","FOR i=1 TO max","LET numbers(i) = INT(RND * 100)","NEXT i","END SUB","SUB PrintList(max) STATIC","FOR i=1 TO max","PRINT numbers(i)","NEXT i","END SUB","SUB SwapValues(i%, j%) STATIC","LET numbers(i%) = numbers(i%) XOR numbers(j%)","LET numbers(j%) = numbers(i%) XOR numbers(j%)","LET numbers(i%) = numbers(i%) XOR numbers(j%)","END SUB","SUB Sort(max) STATIC","FOR i%=1 TO (max - 1)","FOR j%=i% TO max","IF numbers(i%)>numbers(j%) THEN","CALL SwapValues(i%, j%)","END IF","NEXT j%","NEXT i%","END SUB","CreateList(max)","Sort(max)","PrintList(max)","DATA 10","END"],Goto:Ir,Vars:vr,If:Nr,For:Ar,"For Step":["CLS","FOR i% = 0 TO 6 STEP 2",'PRINT "For Step Number #"; i%',"NEXT i%"],While:Tr,Pause:$r},Rr=se(({module:s,core:e})=>[{name:["basic"],args:[new f({index:0,name:"path",description:"Path to basic script"})],async action({path:t},r){if(!t)throw $.get("bad_args");const a=await e.modules.files?.fileSystem.get(t);if(typeof a?.data=="object"){const n=a.data;if(n.type==="basic"&&Array.isArray(n.content))return s.parseBasic(n.content,void 0,{logger:r.logger})}else throw new Error(`Can't read file ${t}`)}},{name:["basicExamples"],args:[new f({index:0,name:"name",description:"Name from example"})],action({name:t}){return s.parseBasic(Pr[String(t)])}}]);class Cr extends ae{basicInterpreter;memory=T(new ye);mathParser=T(new pr(this.memory));commandParser=T(new S);constructor({core:e}){super({name:"Parser",commands:t=>[...Rr(t)],core:e}),this.basicInterpreter=T(new dr(this.memory,e.executeCommand.bind(e)))}parse(e,t,r){return this.basicInterpreter.parse(e,t,r)}parseBasic(e,t,r={}){let a=e;return Array.isArray(e)||(a=e.split(`
`)),this.basicInterpreter.parse(a,t,r)}async parseCommand(e){return this.commandParser.parse(e)}parseMath(e){return this.mathParser.parse(e)}isMathValue(e){return this.mathParser.validInput(e)}}const Wr=Ee(({core:s})=>{const e=s.modules.symbols,t=s.modules.windows,r=H({open:{disabled:!1},edit:{disabled:!1},duplicate:{disabled:!1},container:{disabled:!1},emptyTrashcan:{disabled:!1},discard:{disabled:!1},info:{disabled:!1},itemLink:{disabled:!1},itemLinkNew:{disabled:!1},itemLinkEdit:{disabled:!1},webLink:{disabled:!1},webLinkNew:{disabled:!1},webLinkEdit:{disabled:!1}});function a(){const u=e.getSelectedItems()||[],d=e.getPrimaryWrapper();r.info.disabled=u.length<1,r.open.disabled=u.length<1,r.edit.disabled=u.length<1||!!u.find(m=>m?.locked||m instanceof q),r.duplicate.disabled=u.length<1||!!u.find(({fsItem:m})=>m?.locked||m instanceof q||m instanceof Ne),r.container.disabled=!r.open.disabled||!(d instanceof K&&d.fsItem&&(d.fsItem instanceof tt||!d.fsItem.locked))||!d,r.itemLinkEdit.disabled=u.length<1||!!u.find(m=>!m?.fsItem?.meta.get(N.REFERENCE)),r.itemLinkNew.disabled=r.container.disabled,r.itemLink.disabled=r.itemLinkNew.disabled&&r.itemLinkEdit.disabled,r.webLinkEdit.disabled=u.length<1||!!u.find(m=>!m?.fsItem?.meta.get(N.WEB_URL)),r.webLinkNew.disabled=r.container.disabled,r.webLink.disabled=r.webLinkNew.disabled&&r.webLinkEdit.disabled,r.emptyTrashcan.disabled=u.length<1||!!u.find(m=>!(m?.fsItem instanceof q)),r.discard.disabled=u.length<1||!!u.find(({fsItem:m})=>m?.locked||m instanceof q||m instanceof Ne)}return e.events.subscribe(()=>a()),a(),[new h({order:1,title:"File",items:[new h({title:"Open",options:r.open,action:n}),new h({title:"Edit",options:r.edit,action:E}),new V,new h({title:"Link",options:r.itemLink,items:[new h({title:"New",options:r.itemLinkNew,action:l}),new h({title:"Edit",options:r.itemLinkEdit,action:c})]}),new h({title:"Web Link",options:r.webLink,items:[new h({title:"New",options:r.webLinkNew,action:p}),new h({title:"Edit",options:r.webLinkEdit,action:w})]}),new V,new h({title:"Duplicate",options:r.duplicate,action(){const u=e.getSelectedItems()||[];return Promise.all(u.filter(d=>d.fsItem).map(async({fsItem:d})=>{const m=await d?.getPath();return s.executeCommand(`copy "${m}" "${m}" -ignore`)}))}}),new h({title:"Make Dir",options:r.container,async action(){const u=e.getPrimaryWrapper()?.fsItem;if(u){const d=et(await u.getPath(),"Directory");return console.log(`makedir "${d}" -ignore`),s.executeCommand(`makedir "${d}" -ignore`)}else throw new Error("No item found")}}),new V,new h({title:"Discard",options:r.discard,action(){const u=e.getSelectedItems()||[];return Promise.all(u.filter(d=>d.fsItem).map(async({fsItem:d})=>{const m=await d?.getPath();return s.executeCommand(`remove "${m}" -r`)}))}}),new h({title:"Empty Trashcan",options:r.emptyTrashcan,action(){const u=e.getSelectedItems()||[];return Promise.all(u.filter(d=>d.fsItem).map(async({fsItem:d})=>{const m=await d?.getItems()||[];return Promise.all(Array.from(m.values()).map(async g=>{const A=await g.getPath();return s.executeCommand(`remove "${A}" -r -ignore`)}))}))}}),new V,new h({title:"Info",options:r.info,async action(){const u=e.getSelectedItems()||[];await Promise.all(u.filter(d=>d.fsItem).map(async d=>{if(d.fsItem){const m=await W(()=>import("./D68gwkTd.js"),__vite__mapDeps([33,34,19,20,1,2,21,22,35]),import.meta.url).then(g=>g.default);t.addWindow({component:m,componentData:{fsItem:T(d.fsItem)},layout:{size:Be(460,280)},options:{title:`Info File ${d.fsItem.name}`,scaleX:!0,scaleY:!0,prompt:!1,scrollX:!0,scrollY:!0}})}else throw new Error(`Item has no fsItem. ${d.id}`)}))}})]})];function n(){(e.getSelectedItems()||[]).filter(d=>d.fsItem).forEach(d=>{if(d.command){const m={showCommand:!1,show:!0},g=St(d.command);if(!g)throw new Error(`No command found for item ${d.id}`);return s.executeCommand(g,m)}})}async function i({name:u,path:d,symbol:m},g){if(g||(g=await s.executeCommand(`saveFileDialog --id="${Ae(u)}"`)),g){const A=s.addExecution();try{const I=g.getPath();await s.executeCommand(`rename "${I}" "${u}" -n`),await s.executeCommand(`editfilemeta "${I}" "${N.REFERENCE}" "${d}"`),await s.executeCommand(`editfilemeta "${I}" "${N.SYMBOL}" "${m}"`)}catch(I){throw A(),I}return A(),!0}return!1}async function o({name:u,url:d,symbol:m},g){if(g||(g=await s.executeCommand(`saveFileDialog --id="${Ae(u)}"`)),g){const A=s.addExecution();try{const I=g.getPath();await s.executeCommand(`rename "${I}" "${u}" -n`),await s.executeCommand(`editfilemeta "${I}" "${N.WEB_URL}" "${d}"`),await s.executeCommand(`editfilemeta "${I}" "${N.SYMBOL}" "${m}"`)}catch(I){throw A(),I}return A(),!0}return!1}async function l(){const u=await W(()=>import("./BxiH5fYY.js"),__vite__mapDeps([36,7,1,2,8,15,16,17,18,37,9,10,38,39,13,14,5,19,20,21,22,40]),import.meta.url).then(m=>m.default);return t.addWindow({component:u,componentData:{model:{actions:{save:i,selectItem:()=>s.executeCommand(`openFileDialog --type=${De.BOTH}`)},name:null,url:null,symbol:"default"}},options:{title:"Make Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}async function c(){const u=e.getSelectedItems();await Promise.all(u.filter(d=>d.fsItem).map(async d=>{const m=d.fsItem;if(m){const g=await W(()=>import("./BxiH5fYY.js"),__vite__mapDeps([36,7,1,2,8,15,16,17,18,37,9,10,38,39,13,14,5,19,20,21,22,40]),import.meta.url).then(A=>A.default);t.addWindow({component:g,componentData:{fsItem:T(m),model:{actions:{save:i,selectItem:()=>s.executeCommand(`openFileDialog --type=${De.BOTH}`)},name:m.name,path:m.meta.get(N.REFERENCE),symbol:m.meta.get(N.SYMBOL)}},options:{title:"Edit Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}else throw new Error(`Item has no fsItem. ${d.id}`)}))}async function p(){const u=await W(()=>import("./BhlQppw9.js"),__vite__mapDeps([41,7,1,2,8,15,16,17,18,37,9,10,38,39,13,14,5,19,20,21,22,42]),import.meta.url).then(m=>m.default);return t.addWindow({component:u,componentData:{model:{actions:{save:o},name:null,url:null,symbol:"default"}},options:{title:"Make Web Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}async function w(){const u=e.getSelectedItems();await Promise.all(u.filter(d=>d.fsItem).map(async d=>{const m=d.fsItem;if(m){const g=await W(()=>import("./BhlQppw9.js"),__vite__mapDeps([41,7,1,2,8,15,16,17,18,37,9,10,38,39,13,14,5,19,20,21,22,42]),import.meta.url).then(A=>A.default);t.addWindow({component:g,componentData:{fsItem:T(m),model:{actions:{save:o},name:m.name,url:m.meta.get(N.WEB_URL),symbol:m.meta.get(N.SYMBOL)}},options:{title:"Edit Web Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}else throw new Error(`Item has no fsItem. ${d.id}`)}))}async function E(){return bt(s)}}),ce=new Map;class Dr extends rt{modules;services=void 0;app;get name(){return this.app?.name}async connect(e,{apiKey:t,url:r}){if(this.modules=await _e.get(),this.app)ce.has(e)&&(this.app=ce.get(e));else{const a=this.modules.app.initializeApp({apiKey:t,databaseURL:r},e);ce.set(a.name,a),this.app=a}return this.app}async disconnect(){if(!this.app)throw $.get("FirebaseWrapper_noApp");U(this),await this.logout(),await this.modules?.app.deleteApp(this.app),this.app=void 0}get locked(){return!!this.app&&!this.isLogged()}get currentUser(){if(this.modules?.auth){const{getAuth:e}=this.modules.auth;return e(this.app).currentUser}}isLogged(){return!!this.app&&!!this.currentUser}login(e,t){if(this.modules?.auth){const{getAuth:r,signInWithEmailAndPassword:a}=this.modules.auth,n=r(this.app);return U(this),a(n,e,t)}}logout(){if(this.app&&this.modules?.auth){const{getAuth:e,signOut:t}=this.modules.auth,r=e(this.app);return t(r)}else throw $.get("FirebaseWrapper_notConnected")}remove(e){if(U(this),this.modules?.database){const{remove:t,ref:r,getDatabase:a}=this.modules.database,n=a(this.app),i=r(n,e);return t(i)}}get(e){if(U(this),this.modules?.database){const{ref:t,onValue:r,getDatabase:a}=this.modules.database,n=a(this.app),i=t(n,e);let o;return new Promise(l=>{o=r(i,c=>l(c.val()))}).then(l=>(o&&o(),l))}}async set(e,t){if(U(this),this.modules?.database){const{ref:r,set:a,getDatabase:n}=this.modules.database,i=n(this.app),o=r(i,e);return await a(o,t),t}}}function U(s){if(!s.app)throw $.get("FirebaseWrapper_notConnected")}$.add([["FirebaseWrapper_notConnected",["Not connected","Not connected"]],["FirebaseWrapper_noApp",["No app available","No app available"]],["FirebaseWrapper_hasApp",["App already available",'App "%1" already available']]]);class Lr extends st{constructor(e){super({...e,storage:new Dr})}async mount(e){if(e.onDisconnect=()=>{this.unmount()},this.storage)return await this.storage.connect(e.id,{apiKey:e.apiKey,url:e.url}),this;throw new Error("no storage")}async unmount(){if(this.storage)return await this.storage.disconnect(),this;throw new Error("no storage")}async load(){if(this.storage){let e=await this.storage.get(this.name);return e||(e={},this.storage.locked||await this.storage.set(this.name,e)),this.data=e,e}else throw new Error("no storage")}async save(e){if(this.storage)return e=He(e),this.data=e||this.data,await this.storage.set(this.name,e),this.data;throw new Error("no storage")}get locked(){return this.storage?.locked||!1}}function He(s){return Object.fromEntries(Object.entries(s).filter(([,e])=>e||typeof e=="number"||typeof e=="boolean").map(([e,t])=>(t&&typeof t=="object"&&(t=He(t)),[e,t])))}const X=new Map,xr=se(({module:s,core:e})=>{const{fileSystem:t}=s;return[{name:"cloudList",args:[new f({name:"json",flag:!0,description:"Get JSON Export"})],action({json:r},a){const n=Array.from(X.values());if(r)return Promise.resolve(n);{const i=new ue;return i.addColumns([{value:"Storage (Id)",align:"left",minWidth:15},{value:"Name",align:"left",minWidth:15},{value:"Logged In",align:"center",minWidth:9}]),i.addRows(n.reduce((o,l)=>(o.push([l.id,l.name,l.storage.storage.isLogged()?"yes":"no"]),o),[])),a.message([i]),Promise.resolve()}}},{name:"cloudMountFirebase",args:[new f({index:0,name:"id",flag:!0,description:"Id from Storage."}),new f({index:1,name:"apiKey",description:"Firebase Api-Key."}),new f({index:2,name:"url",description:"Firebase Database-Url."})],async action({id:r,apiKey:a,url:n},i){if(!a||!n)throw $.get("bad_args");const o=e.addExecution(),l=await t.connect(Lr,{id:r,apiKey:a,url:n});return X.set(l.id,l),i.message(`Mount <strong>${l.name}</strong> <strong>(${l.id})</strong> successful!`),o(),l}},{name:"cloudUnmount",args:[new f({index:0,name:"id",flag:!0,description:"Id from Storage."})],async action({id:r},a){if(!r)throw $.get("bad_args");const n=e.addExecution();try{const i=X.get(r);await t.disconnect(i),X.delete(i.id),a.message(`Unmount "${i.name}" successful!`),n()}catch(i){throw n(),i}}},{name:"cloudAuth",args:[new f({name:"login",flag:!0,description:"Storage Login"}),new f({name:"logout",flag:!0,description:"Logout from Storage."}),new f({name:"email",description:"Email for Login."}),new f({name:"password",description:"Password for Login."}),new f({name:"storage",description:"Specifies which drive is logged on."})],async action({email:r,password:a,storage:n,login:i,logout:o},l){const c=n;if(!c)throw $.get("bad_args");const p=e.addExecution(),w=X.get(c);let E;if(w)try{if(i){if(!r||!a)throw $.get("bad_args");E=await w.storage.storage.login(r,a),l.message(`Login with ${w.id} (${w.id}) successful!`)}else o&&(E=await w.storage.storage.logout(),l.message(`Logout from ${w.id} (${w.id}) successful!`))}catch(u){if(p(),u instanceof Error&&"code"in u){switch(u.code){case"auth/user-not-found":case"auth/wrong-password":return u}throw u}}else throw new Error(`${c} is not mounted.`);return p(),E}}]}),ke=T(new at("web_workbench_FS"));class Or extends ae{static NAME="Files";fileSystem=ke;fs=ke;disks={};constructor({core:e}){super({name:"Files",commands:({module:t,core:r})=>[...Et({module:t,core:r}),...yt({module:t}),...xr({module:t,core:r})],contextMenu:Wr,core:e})}addDisks(e){[...e].sort((t,r)=>t.order>r.order?1:t.order<r.order?-1:0).forEach(t=>{this.disks[t.name]=t})}}class kr{defaultItems=new ge;activeItems;core;constructor(e){this.core=e,this.activeItems=this.defaultItems}addDefaultItems(e){this.defaultItems.add(e)}getActiveItems(){return this.activeItems}setActiveItems(e){return this.activeItems=e||this.defaultItems}}const _r=Ee(({core:s})=>{const{windows:e}=s.modules;return[new h({order:0,title:"Web-Workbench",items:[new h({title:"Settings",action(){return s.executeCommand("openSettings")}}),new V,new h({hotKey:{alt:!0,code:"KeyI",title:"I"},title:"Info",async action(){const t=await W(()=>import("./cQCfnh_t.js"),__vite__mapDeps([43,44,20,1,2,21,22,45,19,46]),import.meta.url).then(r=>r.default);e?.addWindow({component:t,componentData:{},options:{title:"Info",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}}),new V,new h({title:"Imprint",action(){return s.executeCommand('execute "Imprint.md"')}}),new h({title:"Disclaimer",action(){return s.executeCommand('execute "Disclaimer.md"')}})]})]}),Mr={xmlns:"http://www.w3.org/2000/svg",width:"6",height:"10",viewBox:"0.5 50.5 6 10"};function Vr(s,e){return D(),F("svg",Mr,e[0]||(e[0]=[L("path",{fill:"#020203",d:"M.5 50.5h6v2h-4v2h2v2h-2v4h-2z"},null,-1)]))}const Fr={render:Vr},Br={xmlns:"http://www.w3.org/2000/svg",width:"6",height:"10"};function Ur(s,e){return D(),F("svg",Br,e[0]||(e[0]=[L("path",{d:"M0 10h6V8H2V6h2V4H2V2h4V0H0z"},null,-1)]))}const Xr={render:Ur},Yr={class:"icon full"},jr={class:"icon empty"},Gr=Ve({__name:"StorageBar",props:{visible:{type:Boolean,default:!0},value:{type:Number,default:.8}},setup(s){const e=s,t=pe(()=>({"--bar-height":Math.min(e.value,1)}));return(r,a)=>s.visible?(D(),F("div",{key:0,class:"wb-env-element-storage-bar",style:mt(t.value)},[L("div",null,[L("div",Yr,[te($e(Fr))]),a[0]||(a[0]=L("span",{class:"size"},[L("span",{class:"helper"})],-1)),L("div",jr,[te($e(Xr))])])],4)):Y("",!0)}}),zr=Fe(Gr,[["__scopeId","data-v-963a1798"]]),Hr={class:"wb-env-fragment-dialog-content"},Kr=["innerHTML"],Zr={key:1,class:"input"},Qr=Ve({__name:"DialogContent",props:{message:{type:String,default(){return"Dialog Message"}},confirm:{type:Boolean,default:!1},prompt:{type:Boolean,default:!1},promptType:{type:String,default:"text"},promptStep:{type:Number,default:void 0},promptValue:{type:String,default:""},password:{type:Boolean,default:!1},apply:{type:Function,default(){return null}},abort:{type:Function,default(){return null}},applyLabel:{type:String,default(){return"Continue"}},abortLabel:{type:String,default(){return"Cancel"}},yesLabel:{type:String,default(){return"Yes"}},noLabel:{type:String,default(){return"No"}}},emits:["apply","abort"],setup(s,{emit:e}){const t=s,r=e,a=ut(t.promptValue),n=pe(()=>t.password?"password":t.promptType),i=pe(()=>t.message.replace(/\\n|\n/g,"<br>")),o=()=>{const c=a.value||!0;typeof t.apply=="function"?t.apply(c):r("apply",c)},l=()=>{typeof t.abort=="function"?t.abort():r("abort")};return(c,p)=>(D(),F("div",Hr,[L("div",null,[s.message?(D(),F("p",{key:0,innerHTML:i.value},null,8,Kr)):Y("",!0),s.prompt?(D(),F("div",Zr,[te(vt,{ref:"dialogInput",modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=w=>a.value=w),step:s.promptStep,type:n.value,label:null},null,8,["modelValue","step","type"])])):Y("",!0),te(Nt,{align:s.abortLabel?"outer":"center",class:"buttons"},{default:dt(()=>[s.applyLabel||s.confirm&&s.yesLabel?(D(),Pe(Le,{key:0,"style-type":"dialog",label:s.confirm?s.yesLabel:s.applyLabel,onClick:o},null,8,["label"])):Y("",!0),s.abortLabel||s.confirm&&s.noLabel?(D(),Pe(Le,{key:1,"style-type":"dialog",label:s.confirm?s.noLabel:s.abortLabel,onClick:l},null,8,["label"])):Y("",!0)]),_:1},8,["align"])])]))}}),qr=Fe(Qr,[["__scopeId","data-v-0fa943a5"]]),Jr=se(({module:s,core:e})=>{const t=e.modules.files?.fs,r=e.modules.symbols,a=e.modules.windows;return[{name:["openDirectory","openDir"],description:"Opens the specified directory.",args:[new f({index:0,name:"path",description:"Path to the directory."}),new f({name:"sortSymbols",description:"Sort Symbols",flag:!0}),new f({name:"windowSize",description:"Window Size"}),new f({name:"windowPosition",description:"Window Position"}),new f({name:"windowScale",description:"Window Scale"}),new f({name:"windowScrollX",description:"Window Scroll-X"}),new f({name:"windowScrollY",description:"Window Scroll-Y"}),new f({name:"windowSidebar",description:"Window Sidebar"}),new f({name:"windowFullSize",description:"Window Full-Size"})],async action(n){const{path:i,sortSymbols:o,windowSize:l,windowPosition:c,windowScale:p,windowScrollX:w,windowScrollY:E,windowSidebar:u,windowFullSize:d}=n;if(!i)throw $.get("bad_args");const m=await t?.get(i);if(!m)throw $.get("FileSystemItem_itemNotFound",i);if(!(m instanceof nt))throw $.get("FileSystemItem_itemNotContainer",i);const g=await r?.addFileSystemWrapper(m),A=r?.getWrapper(String(g)),I=H({value:m.size/m.maxSize}),B=ne=>{const[Z,ie]=ne.split(",");return Be(Number(Z),Number(ie))},O=a?.addWindow({layout:{size:B(l||"400,200"),position:B(c||"0,0")},sidebarComponent:zr,sidebarComponentData:I,component:ot,componentData:{wrapperId:g,parentScrollable:w||E},options:{title:m.name,sidebar:u!==void 0?u:!0,scale:p!==void 0?p:!0,scrollX:w!==void 0?w:!0,scrollY:E!==void 0?E:!0,center:!c}},{active:!0,full:d}),Se=()=>{I.value=m.size/m.maxSize},Ke=[A?.events.subscribe(Se)];return new Promise(ne=>{O?.events.subscribe(({name:Z})=>{Z==="ready"&&o?window.requestAnimationFrame(()=>{A?.rearrangeIcons()}):Z==="close"?(Ke.forEach(ie=>ie?.unsubscribe()),g&&r?.removeWrapper(g),ne(!0)):Se()})})}},{name:["openDialog"],description:"Open a Dialog.",args:[new f({index:0,name:["message"],description:"Message from Dialog."}),new f({index:1,name:["title"],description:"Title from Dialog."}),new f({name:["apply"],description:"Title from apply button."}),new f({name:["abort"],description:"Title from abort button."}),new f({name:["confirm"],flag:!0,description:"Defines the confirm dialog"}),new f({name:["prompt"],flag:!0,description:"Defines the prompt dialog"}),new f({name:["promptType"],description:"Type from prompt dialog (e.g. text, number, email). (Default: text)"}),new f({name:["promptStep"],description:"Step from prompt dialog (e.g. 1, 0.1, 0.01). (Default: 1)"}),new f({name:["promptValue"],description:"Default value from prompt dialog."}),new f({name:["secret"],flag:!1,description:"Input is illegible."})],action:n=>{const{title:i,message:o=null,apply:l=null,abort:c=null,confirm:p=!1,prompt:w=!1,promptType:E="text",promptStep:u=void 0,promptValue:d=null,secret:m=!1}=n;let g;const A=O=>{g(O)},I=()=>{g(!1)},B=s.addWindow(new he({component:qr,componentData:{title:i,message:o,secret:m,confirm:p,prompt:w,promptType:E,promptStep:Number(u),promptValue:d,applyLabel:l||"Continue",abortLabel:c,apply:A,abort:I},options:{scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1,close:!1}}));return B.awaitClose().then(()=>I()),new Promise(O=>{g=O}).then(O=>(B.close(),O))}}]});class es extends ae{wrappers=T(new Map);contentWrapper;globalWrapper;contextMenu=void 0;constructor(e){super({config:At,commands:Jr,...e,name:"Windows"}),this.contextMenu=H(new kr(this.core));const t=this.getWrapper(this.addWrapper(new We(this.core)));if(!t)throw new Error("Content wrapper not found");this.contentWrapper=t;const r=this.getWrapper(this.addWrapper(new We(this.core)));if(!r)throw new Error("Global wrapper not found");this.globalWrapper=r,Ft({contentWrapper:this.contentWrapper.events,globalWrapper:this.globalWrapper.events}).subscribe(a=>{console.log("event",a)})}addWindow(e,t){let r;return e instanceof he?r=e:r=new he(e),t={global:!1,...t},t.global?r=this.globalWrapper.add(r,t):r=this.contentWrapper.add(r,t),r.focus(),r}getWrapper(e){return this.wrappers.get(e)}getFocusedWrapper(){return Array.from(this.wrappers.values()).map(({models:e})=>e).flat().find(e=>e.options.focused)}addWrapper(e){return this.wrappers.set(e.id,H(e)),e.id}removeWrapper(e){typeof e!="string"&&(e=e.id),this.wrappers.delete(e)}isContextMenu(e){return e.id===this.getActiveContextMenu().id}setup(){this.contextMenu.addDefaultItems(new ge(_r,{core:this.core})),this.contextMenu.addDefaultItems(new ge(It,{core:this.core}))}clear(){this.contentWrapper.clear(),this.globalWrapper.clear()}getActiveContextMenu(){return this.contextMenu.getActiveItems()}setActiveContextMenu(e){return this.contextMenu.setActiveItems(e)}}const ts=Ee(({module:s,core:e})=>[new h({order:30,title:"Symbol",items:[new h({type:k.CHECKBOX,title:"Show Invisible Symbols",model:e.config.observable,name:v.SHOW_INVISIBLE_SYMBOLS,action({value:t}){return e.config.set(v.SHOW_INVISIBLE_SYMBOLS,t)}}),new h({title:"Rearrange Symbols",hotKey:{alt:!0,code:Dt.KEY_R,title:"R"},action(){const t=s.getDefaultWrapper(),r=s.getPrimaryWrapper();if(r instanceof K&&r?.id!==t?.id){if(r?.rearrangeIcons(),r?.fsItem)return ee(r?.fsItem);throw new Error("No fsItem found")}else if(t instanceof K){if(t?.rearrangeIcons({root:!0}),t?.fsItem)return ee(t?.fsItem);throw new Error("No fsItem found")}}}),new h({title:"Order Type",items:[new h({model:e.config.observable,type:k.RADIO,name:v.ORDER_TYPE,value:C.NAME,title:"Name",action(){return e.config.set(v.ORDER_TYPE,C.NAME)}}),new h({model:e.config.observable,type:k.RADIO,name:v.ORDER_TYPE,value:C.TYPE,title:"Type",action(){return e.config.set(v.ORDER_TYPE,C.TYPE)}}),new h({model:e.config.observable,type:k.RADIO,name:v.ORDER_TYPE,value:C.CREATED_DATE,title:"Created Date",action(){return e.config.set(v.ORDER_TYPE,C.CREATED_DATE)}}),new h({model:e.config.observable,type:k.RADIO,name:v.ORDER_TYPE,value:C.EDITED_DATE,title:"Edited Date",action(){return e.config.set(v.ORDER_TYPE,C.EDITED_DATE)}})]}),new h({title:"Order Direction",items:[new h({model:e.config.observable,type:k.RADIO,name:v.ORDER_DIRECTION,value:j.ASCENDING,title:"Ascending",action(){return e.config.set(v.ORDER_DIRECTION,j.ASCENDING)}}),new h({model:e.config.observable,type:k.RADIO,name:v.ORDER_DIRECTION,value:j.DESCENDING,title:"Descending",action(){return e.config.set(v.ORDER_DIRECTION,j.DESCENDING)}})]})]})]),rs=({module:s})=>[{name:["rearrangeIcons"],description:"Rearrange Icons",args:[new f({name:"id",description:"Wraper id"}),new f({name:"root",description:"Use root wrapper",flag:!0}),new f({name:"force",description:"Force rearrangement",flag:!0})],async action({id:e,root:t,force:r}){const a=s.getDefaultWrapper(),n=s.getPrimaryWrapper();if(await new Promise(i=>window.requestAnimationFrame(i)),t){if(a.fsItem)return a?.rearrangeIcons({root:!0,force:r}),ee(a.fsItem);throw new Error("No fsItem found")}else{let i=n;if(e&&(i=s.get(e),i instanceof K&&i.fsItem))return i.rearrangeIcons({force:r}),ee(i.fsItem)}}}];function ss(){return{[v.SHOW_INVISIBLE_SYMBOLS]:!1,[v.ORDER_TYPE]:C.NAME,[v.ORDER_DIRECTION]:j.ASCENDING}}class as extends J{}class ns extends ae{static NAME="Symbols";events=T(new fe);symbols=T(new Map);wrappers=T(new Map);wrappersObservable={};hasSelectedItems=!1;_activeWrapper;_defaultWrapper;activeWrapper;defaultWrapper;primaryWrapper;secondaryWrapper;constructor(e){const{core:t}=Object.assign({core:null},e);super({name:"Symbols",config:ss(),commands:rs,contextMenu:ts,core:t})}addWrapper(e){return e=T(e),this.wrappers.set(e.id,e),this.wrappersObservable[e.id]=e,e.events.subscribe(this.onEventWrapper.bind(this)),e.id}onEventWrapper({name:e,value:t}){t?.wrapper&&(e==="selectItem"||e==="unselectItem")&&(this.hasSelectedItems=t?.wrapper.selectedItems.value?.length>0,this.events.next(new as({name:"hasSelectedItems",value:this.hasSelectedItems})))}getWrapper(e){return typeof e!="string"&&(e=e.id),this.wrappers.get(e)}removeWrapper(e){typeof e!="string"&&(e=e.id),this.wrappers.delete(e),Reflect.deleteProperty(this.wrappersObservable,e)}getActiveWrapper(e=!1){const t=this.core.modules.windows?.contentWrapper.getActiveWindow();return t&&t.componentData?.symbolWrapper?t.componentData?.symbolWrapper:e?null:this.activeWrapper}getSelectedItems(){return Array.from(this.wrappers.values()).reduce((e,t)=>(t.selectedItems.value.forEach(a=>{const n=t.get(a);n&&e.push(n)}),e),[])}clearSelectedItems(){return Array.from(this.wrappers.values()).forEach(e=>{e.clearSelectedItems()})}async addFileSystemWrapper(e,t=!1){const r=new K(this.core,void 0,t);return await r.setup(e),this.addWrapper(r)}async setup(){const e=this.core.modules.files?.fs.root;e&&(this.addSymbols(await ft()),this.setDefaultWrapper(await this.addFileSystemWrapper(e,!0)))}get(e){return this.wrappers.get(e)}setDefaultWrapper(e){this._defaultWrapper=e;const t=this.wrappers.get(e);t&&(this.primaryWrapper=t,this.secondaryWrapper=t,this.activeWrapper=t,this.defaultWrapper=t)}getDefaultWrapper(){return this.defaultWrapper}getPrimaryWrapper(){return this.primaryWrapper||this.defaultWrapper}getSecondaryWrapper(){return this.secondaryWrapper||this.defaultWrapper}setPrimaryWrapper(e){if(e){let t;e instanceof oe?t=e.id:t=e,this.primaryWrapper=this.wrappers.get(t)}else this.primaryWrapper=void 0;this.events.next(new J({name:"setPrimaryWrapper",value:this.getPrimaryWrapper()}))}setSecondaryWrapper(e){if(e){let t;e instanceof oe?t=e.id:t=e,this.secondaryWrapper=this.wrappers.get(t)}else this.primaryWrapper=void 0;this.events.next(new J({name:"setSecondaryWrapper",value:this.secondaryWrapper}))}setActiveWrapper(e){let t;e instanceof oe?t=e.id:t=e;let r=this.wrappers.get(this._activeWrapper||"");return t!==this._activeWrapper&&(this._activeWrapper=t,this.activeWrapper=this.wrappers.get(this._activeWrapper),r=this.activeWrapper||this.wrappers.get(this._defaultWrapper||""),this.events.next(new J({name:"setActiveWrapper",value:r}))),r}addSymbol(e){this.symbols.set(e.key,e)}addSymbols(e){e.forEach(t=>{this.addSymbol(t)})}removeSymbol(e){this.symbols.delete(e)}}function is(){const s=new z;return s.addModule(Cr),s.addModule(Or),s.addModule(es),s.addModule(lt),s.addModule(ns),s}const aa=is();export{aa as default};
