var g=Object.defineProperty;var M=(s,t,e)=>t in s?g(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>M(s,typeof t!="symbol"?t+"":t,e);import{g as c}from"./B0mDl-SK.js";import{T as v}from"./C9RIoK38.js";import{f as x}from"./bn1upPd7.js";import{u as _}from"./v1EQIz_Z.js";import{_ as w,t as b,v as y,x as d,J as C,N as R,ac as $,C as B,D as S}from"./C_6bBdO0.js";const h=2;let f=class{constructor({speed:t=1,time:e="4n",beatCount:o=1}={}){a(this,"value",0);this.time=e,this.speed=t,this.beatCount=o}prev(){this.value=Math.max(this.value-this.timeDuration,0)}reset(){this.value=0}next(){this.value=this.value+this.timeDuration}get currentBeat(){return Math.floor(this.value/h)}prevBeat(t=this.beatCount){this.value=Math.max(this.value-t*h,0)}setBeat(t,e=1){this.value=t*e*h}nextBeat(t=this.beatCount){console.log("nexeatt",t),this.value=this.value+t*h}get timeDuration(){return new v(this.time).toSeconds()/this.speed}get steps(){return 2/this.timeDuration}now(){return window.performance.now()}getDuration(){return this.value}};class T{constructor(t,e,o={}){a(this,"outerMargin",[32,0,19,0]);a(this,"beatCount",2);if(this.setOptions(o),this.canvas=t,this.ctx=t.getContext("2d"),this.noteTimes=x(),e instanceof f)this.metronom=e;else throw new Error("MetronomRenderer: metronom must be an instance of Metronom")}setOptions(t){const{outerMargin:e}=t||{};this.outerMargin=e||this.outerMargin}render(t){const e=this.ctx;e.clearRect(0,0,this.canvas.width,this.canvas.height);const o=c(this.outerMargin[0],this.outerMargin[1]),r=c(this.canvas.width-(this.outerMargin[0]+this.outerMargin[2]),this.canvas.height-(this.outerMargin[1]+this.outerMargin[3]));e.fillStyle="#FFAA5580",e.fill(this.getPath(o,r)),e.fillRect(o.x+Math.min(Math.max(Math.round(r.x*(this.metronom.value%(2*this.metronom.beatCount))/2/this.metronom.beatCount),0),r.x),o.y,r.x/this.metronom.steps/this.metronom.beatCount,r.y),typeof t=="function"&&t(e,{position:o,dimension:r})}getPath(t,e){const o=this.metronom,r=new Path2D,p=new v(o.time).toSeconds();for(let m=0;m<this.noteTimes.length;m++){const u=this.noteTimes[Number(m)],i=2;for(let n=1;n<=(2/u[1]-1)*this.metronom.beatCount;n++)r.rect(t.x+Math.round(e.x*u[1]*n/2-i/2)/this.metronom.beatCount-i/2,t.y,i,38-2/u[1]);for(let n=0;n<=1/p*2*o.speed*this.metronom.beatCount;n++)r.rect(t.x+Math.round(e.x*p*n/o.speed/2-i/2)/this.metronom.beatCount-i/2,t.y,i,e.y)}return r}}const D={props:{model:{type:f,required:!0}},emits:["value","speed","render","ready"],async setup(){return{...await _()}},data(){return{metronomRenderer:null,dimension:c(0,0)}},computed:{isPlaying(){return this.model.state==="playing"}},watch:{"model.value"(s){this.$emit("value",s),this.render()},"model.time"(){this.render()},"model.speed"(){this.render()}},mounted(){this.metronomRenderer=new T(this.$refs.canvas,this.model),this.onRefresh(),this.$emit("ready",{render:()=>this.render()})},methods:{onRefresh(){const{width:s,height:t}=this.$refs.canvas.getBoundingClientRect();this.$refs.canvas.width=s,this.$refs.canvas.height=t,this.render()},render(){this.metronomRenderer.render((...s)=>{this.$emit("render",...s)})}}},P=s=>(B("data-v-e3665d7b"),s=s(),S(),s),I={class:"synthesizer-metronom"},N={class:"wrapper"},A=P(()=>d("div",{class:"spacer"},null,-1)),k={ref:"canvas"};function E(s,t,e,o,r,l){return b(),y("div",I,[d("div",N,[C(s.$slots,"background",R($({onRefresh:()=>l.onRefresh()})),()=>[A],!0),d("canvas",k,null,512)])])}const W=w(D,[["render",E],["__scopeId","data-v-e3665d7b"]]);export{W as M,f as a};
