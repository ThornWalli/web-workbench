const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./D9jdACNK.js","./Cpj98o6Y.js","./DRnnhBLv.js","./ClLpnmyR.js","./BkRx7U8b.js","./entry.BKgKayuE.css","./BTMT_sH9.js","./Page.BBrJQr8a.css","./CoWiVqj-.js","./B9nPFJJ2.js","./B4rpyJsK.js","./OlYXjGCK.js","./D7YMvfqk.js","./CNkvSXuu.js","./JsFOm8c5.js","./Ds4KxLLa.js","./Wv4Ty0OG.js","./D4lI5vpz.js","./KQEr41HO.js","./OAVrZOa6.js","./D4b9WN8K.js","./CVx03s7S.js","./DeEbP9sG.js","./CL1V9BUB.js","./CtlMGvom.js","./C723tzWh.js","./BPnw8H1C.js","./Form.CHLd88nu.css","./Ca7ITM_r.js","./ColorSelect.DLyiZdA0.css","./Bg2SjdcQ.js","./BJC40ZHD.js","./CuTSLZpO.js","./ContextMenu.CmJ-qq9i.css","./Footer.CEvC3aDS.css","./7gmBHocL.js","./BoZA8JgY.js","./rEnmFtaA.js","./BnD3zOT9.js","./312NxIbt.js","./Bpi429LP.js","./DFTH32ee.js","./CTpy3bpH.js","./BtH6r1li.js","./QwGUwJAP.js","./DG6QdPnO.js","./B3Wmi0DA.js","./CxKYomUj.js","./CJzlme9J.js","./CcuCSIbb.js","./Gl1UmUM-.js","./CV0dHcg-.js","./CaAbksje.js","./App.Z03sKP1k.css","./CshrRwMP.js","./NpjbJe0L.js","./BT_Yc7AT.js","./eRs2tlcG.js","./FormField.uYJe21CG.css","./uxCSd1pF.js","./Db7xYFkh.js","./CheckboxGroup.4lgYwaTL.css","./D4CgN78G.js","./Color.BcyJQVUx.css","./CPrp_Jrr.js","./Textfield.DAJI4Mxe.css","./Cnp2dj6X.js","./Checkbox.BmCNKUYp.css","./DpGpKT4E.js","./ButtonWrapper.CJ5gVsbK.css","./D9PjJnFw.js","./Button.d1yhUyXb.css","./Settings.Des-dSoH.css","./C1BFwIiJ.js","./ValueInput.BJFCGr2I.css","./DwmuoBLz.js","./Xk46uXlJ.js","./Markdown.CTZzViyZ.css","./Info.CqSni2Z7.css","./C1Ql79V5.js","./Help.B99bv_Es.css","./-oOCArvC.js","./CcXWfcLA.js","./Dropdown.D8llyuFU.css","./NewDocument.BFWZryM7.css","./C3_arNxO.js","./ColorPalette.CPiPkKZX.css","./Ds_9MjU1.js","./GridSettings.DJIPkX5k.css","./w5dx6wz8.js","./PiW-z4FK.js","./OriginSelect.hcWqPp51.css","./InsertImage.BNMrmZh7.css","./pyJXcLcS.js","./Sharpness.Osn91g6R.css","./DNu4xERN.js","./D4OJi69G.js","./ColorPicker.WMiRWnxK.css","./ColorPicker.DcfwILHF.css","./HH2gEuxu.js","./Export.VJeiTLGo.css","./6XNQL8lN.js","./ColorPickers.Dm0I8L0q.css","./C8JhhZaP.js","./DocumentResize.DpF2CqGf.css","./DcZLzrFo.js","./DocumentResizeCanvas.Bl_BwBO3.css","./Dyyg_CrM.js","./DocumentSettings.JQdx4pHS.css","./DZtr8k2A.js"])))=>i.map(i=>d[i]);
import{K as b,L as wt}from"./BkRx7U8b.js";import{c as At,I as G,h as bt,S as Ae}from"./ClLpnmyR.js";import{i as c,I as St}from"./OlYXjGCK.js";import{a as x,b as _t,f as be}from"./KQEr41HO.js";import{o as X,c as vt}from"./rEnmFtaA.js";import{O as Et}from"./D4b9WN8K.js";import{c as ce,t as Ct,l as le}from"./DFTH32ee.js";import{f as xe}from"./Bpi429LP.js";import{S as Te}from"./Wv4Ty0OG.js";import{u as Dt,i as Re,a as Pe,l as $,b as Lt,c as It,d as Se,r as kt,e as xt}from"./D7YMvfqk.js";import{K,a as _e}from"./B4rpyJsK.js";import{e as Tt,s as Rt}from"./BtH6r1li.js";import{T as Pt,g as Bt}from"./CJzlme9J.js";import{t as Ot}from"./CcuCSIbb.js";import{f as Mt}from"./CaAbksje.js";import{s as Ft}from"./BoZA8JgY.js";var q=(t=>(t.CONTENT="content",t.OUTPUT_TYPE="type",t))(q||{}),E=(t=>(t.WEB_PAINT_DOCUMENT_BACKGROUND="extras13_web_paint_document_background",t.WEB_PAINT_DISPLAY_BACKGROUND="extras13_web_paint_display_background",t.WEB_PAINT_DISPLAY_FOREGROUND="extras13_web_paint_display_foreground",t.WEB_PAINT_FIT_IMAGE_ACTIVE="extras13_web_paint_fit_image_active",t.WEB_PAINT_FIT_IMAGE_OFFSET="extras13_web_paint_fit_image_offset",t.WEB_PAINT_NATIVE_THEME="extras13_web_paint_native_theme",t.WEB_PAINT_PALETTES="extras13_web_paint_palettes",t.WEB_PAINT_PIXEL_GRID_COLOR="extras13_web_paint_display_pixel_grid_color",t.WEB_PAINT_PIXEL_GRID_LINE_WIDTH="extras13_web_paint_pixel_grid_line_width",t.WEB_PAINT_PIXEL_GRID_VISIBLE_COUNT="extras13_web_paint_pixel_grid_visible_count",t.WEB_PAINT_DEBUG="extras13_web_paint_debug",t))(E||{}),Ut=(t=>(t.LEFT_TOP="left_top",t.TOP="top",t.RIGHT_TOP="right_top",t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.LEFT_BOTTOM="left_bottom",t.BOTTOM="bottom",t.RIGHT_BOTTOM="right_bottom",t))(Ut||{});const Ht=""+new URL("lenna.pWAMfWPQ.jpg",import.meta.url).href,Nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQQAAAEGCAYAAACDwOsBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAkTSURBVHgB7d1Bctw2FgZgaioHic8wuYCrrDM5O2/jM8kLHyBzBh9FU0qZr2RGEAESJAHw+zapSM1md0d5+PkAoh+m/j1PcB8P04H+MwH8dGi1OYmEwB0d8v+uhACEYRPC589/Tz35+vWPN3/+9PQ00Y7Hx8c3f37031vq72Oq/P+whAAEBQE68JJAEinkearYR1MQgPDbBB1KXcvX0mrvZk4Jb/QU5pSwq6cgIQBBQYAOHdVTUBCAoIfAUErXA7wzv9+F2j0FCQEICgIMoFZPQUEAgoIAA9mbFBQEICgIMKCtSUFBAIKCAAMrTQoKAhAUBLiB3KSgIADBvQxwI2v3PkgIQFAQgKAgAEFBAIKCAAQFAQgKAhAUBCAoCECwUpGh9L6L8tUkBCAoCEBQEICgh0CXWv125t5JCEBQEICgIABBQQCCggAEswyNe3x8nOAsEgIQFAQgKAhA0ENoROJbdeBUEgIQFAQgKAhAUBCAoCAAQUEAgoIABAUBCAoCEBQEICgIQFAQgKAgAEFBAIKCAAQFAQgKAhAUBCAoCEBQEICgIABBQQCCggAEBQEICgIQFAQgKAhAUBCAoCAAQUEAgoIABAUBCAoCEBQEICgIQFAQgKAgAEFBAIKCAITfpn49Tw37+vWP6QifP/89wVEkBCD0lBCaTgQpz89vv+yHh4dpizl5SAocQUIAQssJ4c2hdTnibh1pcx3VC0glh9n8vlLv96jXRR+OSogSAhBaSgjvDplrI2pr9r7e+fhlUjg7IXEvEgIQWkgIWb2C1pw9Uqd6Cku9JSned3YClBCAcGVC+GUoM7LB9SQEIPR8L0MTltd4kg49kxCAcEVCGKJ3YP6fEUkIQFAQKntJDtIDvVIQgHBmD+FW6w5yVxZCSyQEIFiHUNnyLsVeksKff/4v63F//fXfTcetPU9K6vlzj89V+j5qn78VEgIQzkgIt+gdLN9XKim0ah7xSkfk3MRQOqJuTR6ltp5nPm60pCAhAEEPYSF3r8LcpLNMClv12oNYJo+1RDH/vrRXUauXkXo9qfONlhQkBCCclhBaH+FqJ4Nax9WyNvKVXvuXjqRnO+r1XPV+ziIhAOHI1vcpswupa/PcfeuPTgZHK92PIfdaf/nz0udLPf/e51l7vqNfz9bPaau9f98pqb97CQEIt5tl6D0R7FV7JKv1fKM+T28kBCAckRCaXJk4WjI4ay/HUVfk1TbK5yQhAKHmLENWMqh991+tewQkA1pklgG4zJ4ewqbvZEyt7a890v348eOXf//w4cOh5ztKaoSQDDjCsNOOv//++wSU2VIQqswirO0XsNaDWNP7tbZeAVfQQwBCSUI4ZH1Bqqcw+v4BKVclg713L+7dI3HrebceX3ovw13WYUgIQMgZhi9deZibFHq/xm6lZ1C6b8LWkXNrItn6uNxkc9Yuz7msQwAu814PoelkMErXvbXZhOX9/qX7FPR27T36DkilJAQgNLcwaXmvw6jfkdjqOoOt1+Jbn/8qazsf3TU5SAhAeCshXNI7SK1DkAzOUevaf60HkRqBU/sJlPY0Sl+3fR5+JSEA4XVCODUZ3OUuvl7e59l7LRrJ2yQhAOH0WQazCGOx5+JYJAQgvAxjl37DkmQAae5lAC5zWA/hbnsBSgaMQEIAQvWEcJdZBBiRhACEagnhLvcinOXbt29Fj//06dOu40stz3fWeVOvI3Xetd/vPe8s9/lTn1srJAQgVFuHcPdEcPQsw9oImHtc7shWOrJuTQy1jiv9fLa+772fdynrEIDLVOsh6BVc4+hr19ykMP8+9zx7X8/yvLn2juCj9ApSJAQgDPtlr3exNmJuvUZfjvhHdeu3OjsZpI6r3TO4moQABAlhEKUj1dEjWa0ufenv1x5f632PlgxmEgIQJITOPD4+vvnzp6enf/5ZOlLlrh+ZR8Tl+VPnTT1uTeq4tfMe9U1ftT/v1kkIQJAQOldrpEqtI8hNBltXJC7Ps5SbSFJyk0muUZPBTEIAgoTQqdojVepaeXm+2TIZrB0/X+OnRuzc85e+3/l5935eoyeDmYQAhNN2XR6dPRU5grsdgcsoCJW8JILXqeClsq/NjUNrFAQg6CFUJhXQMwkBCApCZcteAvREQQCClYonmVPDx48fp+/fv//r51fJ7Xns3Y379Y8mmiUhnOzLly8TtMosw0FyVy5etcLx6GTwznkkhIZJCEDQQ7hIaoQ+OjGclQzok4QABAnhJFtXMNb6zkzJgBwSAhAkhIutjcjzyL41KQycDHJf8MPG49aeJ+V55/G5St9H1vklBCBYh3CQ5Yi+txdQOvtwdTI4cf3B3hG51oi+9kHWev97/4O9+zokBCDoIXRimTRSicNsQrazkkEtpQnkeeV53nyfEgIQJITOpJJC6fFH6eDehdqzALVmMUrPc8jzSAhAkBBOVnu2IZeewWnrA65SZZZDQgCChHCwrbMBtUb03PMOvO/B6MmgKgkBCBLCSY5aaVjrvAN+N+XdksHabMe76w9mEgIQJISTbF1RWPu8uY/LnQ3paM/E3pNBrXslrFQE8kgIF6l1jX5U0qh1l2YDjk4GuR/M8nEPhb9/SDxuWvn5tPK8v5AQgPCvhDDAiMAJOugdjD6bYMck4Fivq4adkyo6e14/tUPT1vMXrLC04m8gEgIQzDIMIpUMcp21LoK2SQhAkBAGVbqzUqpX8M5xIsWAJAQgSAiDSa0wXEsIa7MSr34vGQxMQgCChDCo0lmHjH0SJIMbkBCAICFU1trOQ6X7GViJeG8SAhAkhEp635NQr4AXEgIQJISdek0GegW8RUIAwm0TQu27++wfwQgkBCDoIezU8WxC/GiCnyQEIEgIP43eA5AMyCEhAEFBAIKCAAQ9hMHpHVBCQgCChDAoyYAtJAQgKAhAUBCAoIcwCN+wRA0SAhAkhE5l7OcgGVBMQgCChNC4gp2dJAJ2kxCAICE0JrWLs5WHnEFCAIKE0DjfqMSZJAQgSAjtkww4jYQABAUBCAoCEBQEICgIQFAQgKAgAEFBAIKCAAQFAQgKAhAUBCAoCEBQEICgIABBQQCCggCE17vxPE+0yI5JnEZCAIKCAAQFAQj/BxP176+Lo3jpAAAAAElFTkSuQmCC",zt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAcCAYAAAATFf3WAAAACXBIWXMAAAWJAAAFiQFtaJ36AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFySURBVHgBzZcBksIgDACTTh9wT7hP6SP1U/eTHtQGaJrEhDqVnVGxk8IaAlSEMVmogTAeS2JtICJMMBZFjhgpgzu5nL31A8ZAlCtvX0aV2zUiHTrjPH2bct5O1A4t8Fg9aPUlyYkXPiEnwYU9cpnLtpksRFJeucyl+2CWichlLhPkU9zImnUzg4/z9Xd71DbAbrrTtfwFewWl1cYDZClik7PiNVpB8S7XVpAywOOWx+3Vvj9r4PMuyllZxBqj/yqqF6Ood08gJFfu3yRTzF/6+NXGkPqeQJHLN9DrLI3wDwSZW6G3A9WpOFx30i/YTKFJz2rOU9y7C8x8cFMyFfkKbRlUW7QgWP01tQe9IEhPsdK5SXJEkuQrlBN8sEBNECxJUU6TbOXYSu6Ry0w17pg1U+4DRM9iFOuPnQIcLVNaZreBXHJawOsEl+pHyiZbMKUTQbxJgHtztQJ10SA9YpEbimFElpVL93EU/k8SiD1/Rib+AQhe0VUs7Fs4AAAAAElFTkSuQmCC",Gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAVCAYAAABCIB6VAAAACXBIWXMAAAWJAAAFiQFtaJ36AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAB7SURBVHgB7ZXdDoAgCIUPjmftoXpZ+7moaSjYoNbWd+HmPB4ZIhKAjAB4Hydn75mQEMT3jLmYrbm50Mq/ouV6LedzkUjYbNSKqdAMLdqkRaLR0rI1AometjQeeSiK9sVyG6FbbrhHHdJDqRBO9jF2bJ9/2zzY7irkz1sAUAkbb2UHezIAAAAASUVORK5CYII=",Vt=""+new URL("cuby_1080.BD77XR_k.png",import.meta.url).href;function Qt(){return{[E.WEB_PAINT_DOCUMENT_BACKGROUND]:"#FFFFFFFF",[E.WEB_PAINT_DISPLAY_BACKGROUND]:"#CCCCCCFF",[E.WEB_PAINT_DISPLAY_FOREGROUND]:"#FFFFFFFF",[E.WEB_PAINT_FIT_IMAGE_ACTIVE]:!0,[E.WEB_PAINT_FIT_IMAGE_OFFSET]:.1,[E.WEB_PAINT_NATIVE_THEME]:!1,[E.WEB_PAINT_DEBUG]:!1,[E.WEB_PAINT_PIXEL_GRID_COLOR]:"#00000033",[E.WEB_PAINT_PIXEL_GRID_LINE_WIDTH]:1,[E.WEB_PAINT_PIXEL_GRID_VISIBLE_COUNT]:10}}const tn={LENNA:Ht,DISK:Nt,WEB_PAINTING:zt,CUBY:Gt,CUBY_1080:Vt};var he=(t=>(t.WEB_PAINT="web_paint",t))(he||{}),h=(t=>(t.DEFAULT="default",t.REFRESH="refresh",t.REFRESH_SUCCESS="refreshSuccess",t.DEBUG="debug",t.INIT="init",t.INIT_SUCCESS="initSuccess",t.SYNC_STATE="syncState",t.SYNC_STATE_SUCCESS="syncStateSuccess",t.ADD_RENDER_WORKER_PORT="addRenderWorkerPort",t.ADD_RENDER_WORKER_PORT_SUCCESS="addRenderWorkerPortSuccess",t.LOAD_IMAGE="loadImage",t.LOAD_IMAGE_SUCCESS="loadImageSuccess",t.UPDATE_CANVAS="updateCanvas",t.UPDATE_BUFFER="updateBuffer",t.UPDATE_BUFFER_SUCCESS="updateBufferSuccess",t.STACK="stack",t.STACK_SUCCESS="stackSuccess",t.UNDO_STACK="undoStack",t.UNDO_STACK_SUCCESS="undoStackSuccess",t.REDO_STACK="redoStack",t.REDO_STACK_SUCCESS="redoStackSuccess",t.CLEAR="clear",t.CLEAR_SUCCESS="clearSuccess",t.SET_ZOOM="setZoom",t.SET_ZOOM_SUCCESS="setZoomSuccess",t.ZOOM_FIT="zoomFit",t.ZOOM_FIT_SUCCESS="zoomFitSuccess",t.SET_POSITION="setPosition",t.SET_POSITION_SUCCESS="setPositionSuccess",t.USE_TOOL="useTool",t.USE_TOOL_SUCCESS="useToolSuccess",t.SET_SELECT_OPTIONS="setSelectOptions",t.SET_SELECT_OPTIONS_SUCCESS="setSelectOptionsSuccess",t.GET_DATA="getData",t.GET_DATA_SUCCESS="getDataSuccess",t.RESIZE="resize",t.RESIZE_SUCCESS="resizeSuccess",t.RESIZE_CANVAS="resizeCanvas",t.RESIZE_CANVAS_SUCCESS="resizeCanvasSuccess",t.GET_COLORS="getColors",t.GET_COLORS_SUCCESS="getColorsSuccess",t.IMAGE_OPERATION="imageOperation",t.IMAGE_OPERATION_SUCCESS="imageOperationSuccess",t.COLOR_PICKER="colorPicker",t.COLOR_PICKER_SUCCESS="colorPickerSuccess",t.SET_OPTIONS="setOptions",t.SET_OPTIONS_SUCCESS="setOptionsSuccess",t.INSERT_IMAGE="insertImage",t.INSERT_IMAGE_SUCCESS="insertImageSuccess",t.ROTATE="rotate",t.ROTATE_SUCCESS="rotateSuccess",t.FLIP="flip",t.FLIP_SUCCESS="flipSuccess",t.SELECT_LAYER="selectLayer",t.SELECT_CURRENT_SUCCESS="selectLayerSuccess",t.UPDATE_LAYER="updateLayer",t.UPDATE_LAYER_SUCCESS="updateLayerSuccess",t.ADD_LAYER="addLayer",t.ADD_LAYER_SUCCESS="addLayerSuccess",t.REMOVE_LAYER="removeLayer",t.REMOVE_LAYER_SUCCESS="removeLayerSuccess",t.MOVE_LAYERS="moveLayer",t.MOVE_LAYER_SUCCESS="moveLayerSuccess",t.GET_LAYERS="getLayers",t.GET_LAYERS_SUCCESS="getLayersSuccess",t.LOAD_DOCUMENT="loadDocument",t.LOAD_DOCUMENT_SUCCESS="loadDocumentSuccess",t.DUPLICATE_LAYER="duplicateLayer",t.DUPLICATE_LAYER_SUCCESS="duplicateLayerSuccess",t.MERGE_LAYERS="mergeLayers",t.MERGE_LAYERS_SUCCESS="mergeLayersSuccess",t.SET_LAYERS="setLayers",t.SET_LAYERS_SUCCESS="setLayersSuccess",t))(h||{});function Wt(t,e,o){let i,n,a;if(e===0)i=n=a=o;else{const r=(m,I,_)=>(_<0&&(_+=1),_>1&&(_-=1),_<.16666666666666666?m+(I-m)*6*_:_<.5?I:_<.6666666666666666?m+(I-m)*(.6666666666666666-_)*6:m),l=o<.5?o*(1+e):o+e-o*e,d=2*o-l;i=r(d,l,t/360+1/3),n=r(d,l,t/360),a=r(d,l,t/360-1/3)}return{r:Math.round(i*255),g:Math.round(n*255),b:Math.round(a*255)}}class p{constructor(e,o=0,i=0,n=255){if(this.g=o,this.b=i,this.a=n,Array.isArray(e))[this.r,this.g,this.b,this.a]=e;else if(typeof e=="string"){const a=p.fromHex(e);this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a}else typeof e=="object"?(this.r=e.r||0,this.g=e.g||0,this.b=e.b||0,this.a=e.a!==void 0?e.a:255):(this.r=e,this.g=o||0,this.b=i||0,this.a=n===void 0?255:n);this.r=Math.min(Math.max(this.r,0),255),this.g=Math.min(Math.max(this.g,0),255),this.b=Math.min(Math.max(this.b,0),255),this.a=Math.min(Math.max(this.a,0),255)}static TRANSPARENT=new p(0,0,0,0);static TYPE="Color";static fromHex(e){e.length===4&&(e=`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`);const o=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16),a=parseInt(e.slice(7,9),16);return new p(o,i,n,isNaN(a)?255:a)}static fromHsl(e,o,i,n=255){const{r:a,g:r,b:l}=Wt(e,o,i);return new p(a,r,l,n)}static isValidHex(e){return/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(e)}r;toInverted(){return new p(255-this.r,255-this.g,255-this.b,this.a)}toJSON(){return{_type:p.TYPE,r:this.r,g:this.g,b:this.b,a:this.a}}toHex(){return`#${this.toRGBA().map(e=>e.toString(16).padStart(2,"0")).join("")}`}toRGB(){return[this.r,this.g,this.b]}toRGBA(){return[...this.toRGB(),this.a]}toCSSRGB(){return[...this.toRGB()]}toCSSRGBA(){return[...this.toRGB(),this.a/255]}toHsl(){const e=this.r/255,o=this.g/255,i=this.b/255,n=Math.max(e,o,i),a=Math.min(e,o,i);let r=0,l=0;const d=(n+a)/2;if(n===a)r=l=0;else{const m=n-a;switch(l=d>.5?m/(2-n-a):m/(n+a),n){case e:r=(o-i)/m+(o<i?6:0);break;case o:r=(i-e)/m+2;break;case i:r=(e-o)/m+4;break}r/=6}return[Math.round(r*360),l,d]}toHsla(){const[e,o,i]=this.toHsl();return[e,o,i,this.a]}toHsv(){const e=this.r/255,o=this.g/255,i=this.b/255,n=Math.max(e,o,i),a=Math.min(e,o,i);let r=0,l=0;const d=n,m=n-a;if(n!==0)l=m/n;else return[0,0,0];if(n===a)r=0;else{switch(n){case e:r=(o-i)/m+(o<i?6:0);break;case o:r=(i-e)/m+2;break;case i:r=(e-o)/m+4;break}r/=6}return[Math.round(r*360),l,d]}toHsva(){const[e,o,i]=this.toHsv();return[e,o,i,this.a]}getHslaHue(){const[e]=this.toHsl();return e}getHslaSaturation(){const[e]=this.toHsl();return e}getHslaLightness(){const[e]=this.toHsl();return e}setHslaHue(e){const[o,i,n]=this.toHsl();return p.fromHsl(o+e,i,n,this.a)}setHslaSaturation(e){const[o,i,n]=this.toHsl();return p.fromHsl(o,i+e,n,this.a)}setHslaLightness(e){const[o,i,n]=this.toHsl();return p.fromHsl(o,i,n+e,this.a)}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}clone(){return new p(this.r,this.g,this.b,this.a)}}const B={fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},ve={silent:{level:-1},fatal:{level:B.fatal},error:{level:B.error},warn:{level:B.warn},log:{level:B.log},info:{level:B.info},success:{level:B.success},fail:{level:B.fail},ready:{level:B.info},start:{level:B.info},box:{level:B.info},debug:{level:B.debug},trace:{level:B.trace},verbose:{level:B.verbose}};function se(t){if(t===null||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.iterator in t?!1:Symbol.toStringTag in t?Object.prototype.toString.call(t)==="[object Module]":!0}function pe(t,e,o=".",i){if(!se(e))return pe(t,{},o);const n=Object.assign({},e);for(const a in t){if(a==="__proto__"||a==="constructor")continue;const r=t[a];r!=null&&(Array.isArray(r)&&Array.isArray(n[a])?n[a]=[...r,...n[a]]:se(r)&&se(n[a])?n[a]=pe(r,n[a],(o?`${o}.`:"")+a.toString()):n[a]=r)}return n}function Zt(t){return(...e)=>e.reduce((o,i)=>pe(o,i,""),{})}const Jt=Zt();function jt(t){return Object.prototype.toString.call(t)==="[object Object]"}function Xt(t){return!(!jt(t)||!t.message&&!t.args||t.stack)}let ae=!1;const Ee=[];class D{options;_lastLog;_mockFn;constructor(e={}){const o=e.types||ve;this.options=Jt({...e,defaults:{...e.defaults},level:re(e.level,o),reporters:[...e.reporters||[]]},{types:ve,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const i in o){const n={type:i,...this.options.defaults,...o[i]};this[i]=this._wrapLogFn(n),this[i].raw=this._wrapLogFn(n,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(e){this.options.level=re(e,this.options.types,this.options.level)}prompt(e,o){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(e,o)}create(e){const o=new D({...this.options,...e});return this._mockFn&&o.mockTypes(this._mockFn),o}withDefaults(e){return this.create({...this.options,defaults:{...this.options.defaults,...e}})}withTag(e){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+e:e})}addReporter(e){return this.options.reporters.push(e),this}removeReporter(e){if(e){const o=this.options.reporters.indexOf(e);if(o!==-1)return this.options.reporters.splice(o,1)}else this.options.reporters.splice(0);return this}setReporters(e){return this.options.reporters=Array.isArray(e)?e:[e],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const e in this.options.types)console["__"+e]||(console["__"+e]=console[e]),console[e]=this[e].raw}restoreConsole(){for(const e in this.options.types)console["__"+e]&&(console[e]=console["__"+e],delete console["__"+e])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(e,o){e&&(e.__write||(e.__write=e.write),e.write=i=>{this[o].raw(String(i).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(e){e&&e.__write&&(e.write=e.__write,delete e.__write)}pauseLogs(){ae=!0}resumeLogs(){ae=!1;const e=Ee.splice(0);for(const o of e)o[0]._logFn(o[1],o[2])}mockTypes(e){const o=e||this.options.mockFn;if(this._mockFn=o,typeof o=="function")for(const i in this.options.types)this[i]=o(i,this.options.types[i])||this[i],this[i].raw=this[i]}_wrapLogFn(e,o){return(...i)=>{if(ae){Ee.push([this,e,i,o]);return}return this._logFn(e,i,o)}}_logFn(e,o,i){if((e.level||0)>this.level)return!1;const n={date:new Date,args:[],...e,level:re(e.level,this.options.types)};!i&&o.length===1&&Xt(o[0])?Object.assign(n,o[0]):n.args=[...o],n.message&&(n.args.unshift(n.message),delete n.message),n.additional&&(Array.isArray(n.additional)||(n.additional=n.additional.split(`
`)),n.args.push(`
`+n.additional.join(`
`)),delete n.additional),n.type=typeof n.type=="string"?n.type.toLowerCase():"log",n.tag=typeof n.tag=="string"?n.tag:"";const a=(l=!1)=>{const d=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&d>0){const m=[...this._lastLog.object.args];d>1&&m.push(`(repeated ${d} times)`),this._log({...this._lastLog.object,args:m}),this._lastLog.count=1}l&&(this._lastLog.object=n,this._log(n))};clearTimeout(this._lastLog.timeout);const r=this._lastLog.time&&n.date?n.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=n.date,r<this.options.throttle)try{const l=JSON.stringify([n.type,n.tag,n.args]),d=this._lastLog.serialized===l;if(this._lastLog.serialized=l,d&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin)){this._lastLog.timeout=setTimeout(a,this.options.throttle);return}}catch{}a(!0)}_log(e){for(const o of this.options.reporters)o.log(e,{options:this.options})}}function re(t,e={},o=3){return t===void 0?o:typeof t=="number"?t:e[t]&&e[t].level!==void 0?e[t].level:o}D.prototype.add=D.prototype.addReporter;D.prototype.remove=D.prototype.removeReporter;D.prototype.clear=D.prototype.removeReporter;D.prototype.withScope=D.prototype.withTag;D.prototype.mock=D.prototype.mockTypes;D.prototype.pause=D.prototype.pauseLogs;D.prototype.resume=D.prototype.resumeLogs;function $t(t={}){return new D(t)}class qt{options;defaultColor;levelColorMap;typeColorMap;constructor(e){this.options={...e},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(e){return e<1?console.__error||console.error:e===1?console.__warn||console.warn:console.__log||console.log}log(e){const o=this._getLogFn(e.level),i=e.type==="log"?"":e.type,n=e.tag||"",r=`
      background: ${this.typeColorMap[e.type]||this.levelColorMap[e.level]||this.defaultColor};
      border-radius: 0.5em;
      color: white;
      font-weight: bold;
      padding: 2px 0.5em;
    `,l=`%c${[n,i].filter(Boolean).join(":")}`;typeof e.args[0]=="string"?o(`${l}%c ${e.args[0]}`,r,"",...e.args.slice(1)):o(l,r,...e.args)}}function Yt(t={}){return $t({reporters:t.reporters||[new qt({})],prompt(o,i={}){return i.type==="confirm"?Promise.resolve(confirm(o)):Promise.resolve(prompt(o))},...t})}const Kt=Yt(),W=Kt.withTag("webPaint"),eo=W.withTag("workerManager");W.withTag("display");const Be=W.withTag("worker");Be.withTag("main");Be.withTag("display");async function to(t,e,o){switch(o.type){case h.INIT:t.options.debug&&W.withTag("Incoming").withTag("action").withTag(h.INIT).success(o);break;case h.LOAD_IMAGE_SUCCESS:t.config.get(E.WEB_PAINT_FIT_IMAGE_ACTIVE)&&e.displays.forEach(i=>{i.actions.fitZoom()});break;case h.SYNC_STATE:e.setState(o.payload);break;case h.UPDATE_BUFFER:console.log("[WorkerManager] BOOOOM",o);break;case h.RESIZE_CANVAS_SUCCESS:{const i=o.payload;e.currentDocument?.setDimension(i.dimension)}break;default:t.options.debug&&W.withTag("Incoming").withTag("main").withTag("action").warn("Action not handled in WorkerManager:",o);break}}async function oo(t,e,o,i){switch(i.type){case h.INIT_SUCCESS:t.config.get(E.WEB_PAINT_FIT_IMAGE_ACTIVE)?o.actions.fitZoom():o.actions.setPosition(c(0,0));break;case h.SET_ZOOM_SUCCESS:{const{currentZoomLevel:n}=i.payload;o.setCurrentZoomLevel(n),i.payload&&"position"in i.payload&&(o.options.position=c(i.payload.position.x,i.payload.position.y))}break;default:t.options.debug&&W.withTag("Incoming").withTag("display").withTag("action").warn("Action not handled in WorkerManager:",i);break}}const io=[{validator:()=>!0,handler:()=>t=>t.pipe(x(e=>e))}];class z{validator;handler;constructor(e,o){this.validator=e,this.handler=o}}const no=(t=[])=>[...t,...io],so=[{validator:()=>!0,handler:()=>t=>t.pipe(x(e=>e))}],ao=(t=[])=>[...t,...so],Oe={[Object.prototype.constructor.name]:t=>e=>e.pipe(x(Object.entries),Q(t),x(Object.fromEntries)),[Array.prototype.constructor.name]:t=>e=>e.pipe(vt(),Q(t),Ct()),[Promise.prototype.constructor.name]:t=>e=>e.pipe(ce(o=>xe(o)),Q(t)),[Et.prototype.constructor.name]:t=>e=>e.pipe(ce(o=>o),Q(t)),[void 0]:()=>t=>t};function Me(t=[]){return e=>e.pipe(Q(no(t)))}function Fe(t=[]){return e=>e.pipe(Q(ao(t)))}function Q(t){return e=>e.pipe(_t(o=>{const i=ro(o),n=i&&Oe[i];return n?X(o).pipe(n(t)):X(o)}),co(t))}function ro(t){if(t==null)return;const e=t.constructor;if(e){const o=e.name;if(Object.prototype.hasOwnProperty.call(Oe,o))return o}}function co(t){return e=>e.pipe(ce(o=>X(o).pipe(lo(t,o).handler())))}const lo=(t,e)=>{const o=t.find(({validator:i})=>i(e));return o||{validator:()=>!0,handler:i=>i}};var U=(t=>(t.TOP_LEFT="top_left",t.TOP_CENTER="top_center",t.TOP_RIGHT="top_right",t.CENTER_LEFT="center_left",t.CENTER="center",t.CENTER_RIGHT="center_right",t.BOTTOM_LEFT="bottom_left",t.BOTTOM_CENTER="bottom_center",t.BOTTOM_RIGHT="bottom_right",t))(U||{});class Z{static TYPE="DisplayOptions";origin;position;colors;pixelGrid;grid;zoomLevel;precision;constructor(e){const{origin:o,position:i,colors:n,pixelGrid:a,grid:r,zoomLevel:l}=e||{};this.origin=o||U.CENTER,this.position=i?c(i.x,i.y):c(0,0),this.colors={background:n?.background?new p(n.background):new p(0,0,0),foreground:n?.foreground?new p(n.foreground):new p(255,255,255)},this.pixelGrid={color:a?.color?new p(a.color):new p(0,0,0,255*.2),lineWidth:a?.lineWidth??1,visibleCount:a?.visibleCount??10},this.grid={active:r?.active??!1,colors:{primary:r?.colors?new p(r.colors.primary):new p(0,221,204,255*.6),secondary:r?.colors?new p(r.colors.secondary):new p(0,221,204,255*.4)},position:r?.position?c(r.position.x,r.position.y):c(0,0),dimension:r?.dimension?c(r.dimension.x,r.dimension.y):c(1,1)},this.zoomLevel=l||1,this.precision=3}toJSON(){return{_type:Z.TYPE,origin:this.origin,position:this.position.toJSON(),colors:{background:this.colors.background.toJSON(),foreground:this.colors.foreground.toJSON()},pixelGrid:{color:this.pixelGrid.color.toJSON(),lineWidth:this.pixelGrid.lineWidth,visibleCount:this.pixelGrid.visibleCount},grid:{active:this.grid.active,colors:{primary:this.grid.colors.primary.toJSON(),secondary:this.grid.colors.secondary.toJSON()},position:this.grid.position.toJSON(),dimension:this.grid.dimension.toJSON()},zoomLevel:this.zoomLevel,precision:this.precision}}}U.TOP_LEFT+"",c(-1,-1),U.TOP_CENTER+"",c(0,-1),U.TOP_RIGHT+"",c(1,-1),U.CENTER_LEFT+"",c(-1,0),U.CENTER+"",c(0,0),U.CENTER_RIGHT+"",c(1,0),U.BOTTOM_LEFT+"",c(-1,1),U.BOTTOM_CENTER+"",c(0,1),U.BOTTOM_RIGHT+"",c(1,1);class M{static TYPE="PaletteColor";id;color;constructor(e){const{id:o,color:i}=e||{};this.id=o||crypto.randomUUID(),this.color=i?new p(i):new p(0,0,0)}setColor(e){this.color=e}equal(e){return this.id===e?.id}toJSON(){return{_type:M.TYPE,id:this.id,color:this.color.toJSON()}}clone(){return new M({id:this.id,color:this.color.clone()})}}class A{static TYPE="Palette";id;name;description;colors;locked;constructor(e){const{id:o,name:i,description:n,colors:a,locked:r}=e||{};this.id=o||crypto.randomUUID(),this.name=i||"",this.description=n,this.colors=(a||[]).map(l=>new M(l)),this.locked=r}clone(){return new A({id:this.id,name:this.name,description:this.description,colors:this.colors.map(e=>e.clone()),locked:this.locked})}toJSON(){return{_type:A.TYPE,id:this.id,name:this.name,description:this.description,colors:this.colors.map(e=>e.toJSON()),locked:this.locked}}}const Ue=[new z(t=>t&&t instanceof St,()=>t=>t.pipe(x(e=>({__type:"IPoint",...e.toJSON()})))),new z(t=>t&&t instanceof Z,()=>t=>t.pipe(x(e=>e.toJSON()))),new z(t=>t&&t instanceof p,()=>t=>t.pipe(x(e=>e.toJSON()))),new z(t=>t&&t instanceof M,()=>t=>t.pipe(x(e=>e.toJSON()))),new z(t=>t&&t instanceof A,()=>t=>t.pipe(x(e=>e.toJSON())))],He=[new z(t=>typeof t=="object"&&"__type"in t&&t.__type==="IPoint",()=>t=>t.pipe(x(e=>c(e.x,e.y)))),new z(t=>t&&Z.TYPE===t._type,()=>t=>t.pipe(x(e=>new Z(e)))),new z(t=>t&&p.TYPE===t._type,()=>t=>t.pipe(x(e=>new p(e)))),new z(t=>t&&M.TYPE===t._type,()=>t=>t.pipe(x(e=>new M(e)))),new z(t=>t&&A.TYPE===t._type,()=>t=>t.pipe(x(e=>new A(e))))];function po(){return t=>t.pipe(Me(Ue))}function Ce(){return t=>t.pipe(Fe(He))}function mo(){return t=>t.pipe(Me(Ue))}function ho(){return t=>t.pipe(Fe(He))}class uo{constructor(e,o,i={debug:!1}){this.app=e,this.config=o,this.options=i}subscription=new Te;readyResolver=Promise.withResolvers();mainWorker=null;displayWorkers=[];async setup(){const e=new Worker(new URL(""+new URL("main-CGRAmk5l.js",import.meta.url).href,import.meta.url),{type:"module"});this.mainWorker=e;const o={type:h.INIT,payload:{debug:this.options.debug}};this.subscription?.add(be(this.mainWorker,"message").pipe(x(i=>i.data),Ce()).subscribe(i=>{this.onMessageMainWorker(i)})),await this.action(o),this.readyResolver.resolve()}get ready(){return this.readyResolver.promise}destroy(){this.subscription?.unsubscribe(),this.mainWorker&&(this.mainWorker.terminate(),this.mainWorker=null),this.displayWorkers.forEach(e=>e.terminate()),this.displayWorkers=[]}addDisplay(e,o){return new Promise(i=>{const n=new Worker(new URL(""+new URL("display-B0K-RTwd.js",import.meta.url).href,import.meta.url),{type:"module"});if(e.setWorker(n),this.subscription?.add(be(n,"message").pipe(x(a=>a.data),Ce()).subscribe(a=>this.onMessageDisplayWorker(a,e))),this.displayWorkers.push(n),o){const a=o.transferControlToOffscreen(),r=new MessageChannel,l={type:h.INIT,payload:{debug:this.options.debug,options:e.options,canvas:a,port:r.port1}};if(this.mainWorker){const d={type:h.ADD_RENDER_WORKER_PORT,payload:{port:r.port2}};this.action(d,[r.port2]).then(()=>i())}this.action(l,[a,r.port1],n)}})}removeDisplay(e){this.displayWorkers=this.displayWorkers.filter(o=>o!==e.worker),e.worker?.terminate(),e.worker=void 0}resolveMap=new Map;async action(e,o,i=this.mainWorker){const n=crypto.randomUUID(),a=Promise.withResolvers();ee.set(n,a.resolve),this.options.debug&&eo.withTag("action").withTag(e.type).start(e,i);const r=await le(X({id:n,data:e}).pipe(po()));return i.postMessage(r,o||[]),a.promise.then(l=>(ee.delete(n),l))}async onMessageMainWorker(e){const{id:o,data:i}=e;await to(this,this.app,i),ee.get(o)?.(i)}async onMessageDisplayWorker(e,o){const{id:i,data:n}=e;await oo(this,this.app,o,n),ee.get(i)?.(n)}}const ee=new Map;var R=(t=>(t.NORMAL="normal",t.MULTIPLY="multiply",t.SCREEN="screen",t.OVERLAY="overlay",t.DARKEN="darken",t.LIGHTEN="lighten",t.COLOR_DODGE="colorDodge",t.COLOR_BURN="colorBurn",t.HARD_LIGHT="hardLight",t.SOFT_LIGHT="softLight",t.DIFFERENCE="difference",t.EXCLUSION="exclusion",t))(R||{}),v=(t=>(t.NORMAL="normal",t.REPLACE="replace",t.MULTIPLY="multiply",t.SCREEN="screen",t.OVERLAY="overlay",t.SOFT_LIGHT="soft_light",t.HARD_LIGHT="hard_light",t.DIFFERENCE="difference",t.EXCLUSION="exclusion",t.COLOR_BURN="color_burn",t.LINEAR_BURN="linear_burn",t.COLOR_DODGE="color_dodge",t.LINEAR_DODGE="linear_dodge",t.VIVID_LIGHT="vivid_light",t.LINEAR_LIGHT="linear_light",t.PIN_LIGHT="pin_light",t.HARD_MIX="hard_mix",t.SUBSTRACT="substract",t.DIVIDE="divide",t))(v||{}),j=(t=>(t.FILLED="filled",t.STROKED="stroked",t.STROKED_FILLED="stroked_filled",t))(j||{}),y=(t=>(t.CIRCLE="circle",t.SQUARE="square",t.DOTS="dots",t))(y||{}),s=(t=>(t.NONE="none",t.DOTTED_FREEHAND="dotted_freehand",t.CONTINUOUS_FREEHAND="continuous_freehand",t.STRAIGHT_LINE="straight_line",t.CURVE_LINE="curve_line",t.FILL_TOOL="fill_tool",t.AIR_BRUSH="airbrush",t.RECTANGLE="rectangle",t.CIRCLE="circle",t.ELLIPSE="ellipse",t.POLYGON="polygon",t.CROP="crop",t.TEXT="text",t.GRID="grid",t.SPLIT_SCREEN="splitScreen",t.MAGNIFY="magnify",t.ZOOM="zoom",t.STACK_REDO="stack_redo",t.STACK_UNDO="stack_undo",t.CLEAR="clear",t.ZOOM_FIT="zoom_fit",t.COLOR_PICKER="color_picker",t.IMAGE_OPERATION="image_operation",t.ERASER="eraser",t))(s||{});class go{constructor(e){this.display=e}useTool(e,{domEvents:o}){switch(this.display.app.options.select.tool.value){case s.ZOOM:{const n=this.display.app.options.zoomStep,a=1+(o.shiftLeftActive?-n:n);this.setZoom(e,a)}}}setPosition(e){return this.display.options.position=e,this.display.action({type:h.SET_POSITION,payload:{position:e}})}setZoom(e=c(0,0),o,i=!1){return this.display.options.zoomLevel=o,this.display.action({type:h.SET_ZOOM,payload:{zoomLevel:o,position:e,replace:i}})}colorPicker(e){return this.display.action({type:h.COLOR_PICKER,payload:{position:e}})}async fitZoom(){const e=this.display;await e.actions.setPosition(c(0,0)),await e.actions.setZoom(c(0,0),0),await e.action({type:h.ZOOM_FIT,payload:{}})}async setOptions(){const e=this.display;await e.action({type:h.SET_OPTIONS,payload:{options:e.options}})}}class fo{id=crypto.randomUUID();actions;app;worker;options;constructor(e,o={}){this.app=e,this.options=new Z(o),this.actions=new go(this)}setWorker(e){this.worker=e}setCurrentZoomLevel(e){this.options.zoomLevel=e}action(e,o){return this.app.workerManager.action(e,o,this.worker)}setColors(e){return this.options.colors={background:new p(e.background),foreground:new p(e.foreground)},this.actions.setOptions()}setPixelGrid(e){return this.options.pixelGrid={...e,color:new p(e.color)},this.actions.setOptions()}setGrid(e){return this.options.grid={...e},this.actions.setOptions()}}class De{id;name;order;opacity;visible;blendMode;imageBitmap;constructor(e){this.id=e?.id??crypto.randomUUID(),this.name=e?.name??"Untitled Layer",this.order=e?.order??0,this.opacity=e?.opacity??1,this.visible=e?.visible??!0,this.blendMode=e?.blendMode??R.NORMAL,this.imageBitmap=e.imageBitmap}toJSON(){return{id:this.id,name:this.name,order:this.order,opacity:this.opacity,visible:this.visible,blendMode:this.blendMode}}}class yo{colors;dimension;constructor({colors:e,dimension:o}){this.colors={background:new p(255,255,255),...e},this.dimension=o?c(o.x,o.y):c(0,0)}}function ue(t,e,o){const i=new OffscreenCanvas(t,e),n=i.getContext("2d");if(!n)throw new Error("Failed to get 2D context from OffscreenCanvas");return o&&(n.fillStyle=o,n.fillRect(0,0,t,e)),i.transferToImageBitmap()}class Y{name;meta;layers=[];constructor({name:e,meta:o,layers:i}){this.name=e,this.meta=new yo(o),this.layers=i?i.map(n=>new De(n)):[new De({imageBitmap:ue(this.meta.dimension.x,this.meta.dimension.y,this.meta.colors.background.toHex())})]}setDimension(e){this.meta.dimension=e}destroy(){this.layers.forEach(e=>{e.imageBitmap.close()})}toJSON(){return{name:this.name,meta:this.meta,layers:this.layers.map(e=>e.toJSON())}}}async function on(t){const e=await Dt(t),o={colors:{background:new p(255,255,255)},dimension:c(e.width,e.height)};return new Y({name:"Untitled Document",meta:o,layers:[{imageBitmap:e.transferToImageBitmap()}]})}function te({background:t,dimension:e,imageBitmap:o}){return new Y({name:"Untitled Document",meta:{colors:{background:t||p.TRANSPARENT},dimension:e},layers:[{imageBitmap:o}]})}async function wo(t,e){let o;if(t.type.includes("svg")){const n=new Image;n.src=URL.createObjectURL(t),await new Promise(a=>{n.complete?a(n):n.onload=()=>a(n)}),o=await Pe(await $(URL.createObjectURL(t)))}else o=await Re(await createImageBitmap(t));const i=o.transferToImageBitmap();return te({background:p.TRANSPARENT,dimension:c(i.width,i.height),imageBitmap:i})}async function Ao(t,e){const o=await Re(await createImageBitmap(t));return te({background:p.TRANSPARENT,dimension:c(o.width,o.height),imageBitmap:o.transferToImageBitmap()})}function bo(t=c(300,240),e){const o=ue(t.x,t.y);return te({background:p.TRANSPARENT,dimension:c(o.width,o.height),imageBitmap:o})}function So(t,e){const o=ue(t.dimension.x,t.dimension.y,e?.toHex());return te({background:p.TRANSPARENT,dimension:c(o.width,o.height),imageBitmap:o})}const _o=new A({locked:!0,id:"aap64-palette",name:"AAP-64",description:"A large, versatile palette with 64 colors that provides a wide range of tones for almost any type of scene or object. Ideal if you want a richer and more detailed color scheme without being overwhelmed.",colors:[{id:"aap64-c0",name:"Darkest Grey",color:"#161320"},{id:"aap64-c1",name:"Dark Grey",color:"#2a2139"},{id:"aap64-c2",name:"Medium Dark Grey",color:"#473b4f"},{id:"aap64-c3",name:"Medium Grey",color:"#63586f"},{id:"aap64-c4",name:"Light Grey",color:"#817b96"},{id:"aap64-c5",name:"Pale Grey",color:"#a8a8bb"},{id:"aap64-c6",name:"White",color:"#d0d2dd"},{id:"aap64-c7",name:"Bright White",color:"#f8f7f9"},{id:"aap64-c8",name:"Deep Red",color:"#330000"},{id:"aap64-c9",name:"Dark Red",color:"#680000"},{id:"aap64-c10",name:"Red",color:"#a20000"},{id:"aap64-c11",name:"Bright Red",color:"#d70000"},{id:"aap64-c12",name:"Light Red",color:"#ff3838"},{id:"aap64-c13",name:"Pink",color:"#ff7575"},{id:"aap64-c14",name:"Pale Pink",color:"#ffb2b2"},{id:"aap64-c15",name:"Lightest Pink",color:"#ffecec"},{id:"aap64-c16",name:"Dark Brown",color:"#3f1a00"},{id:"aap64-c17",name:"Brown",color:"#7e3300"},{id:"aap64-c18",name:"Orange Brown",color:"#bb4e00"},{id:"aap64-c19",name:"Dark Orange",color:"#ed6900"},{id:"aap64-c20",name:"Orange",color:"#ff9e3b"},{id:"aap64-c21",name:"Bright Orange",color:"#ffba78"},{id:"aap64-c22",name:"Light Orange",color:"#ffd7b5"},{id:"aap64-c23",name:"Pale Orange",color:"#ffefe6"},{id:"aap64-c24",name:"Dark Yellow",color:"#3f3000"},{id:"aap64-c25",name:"Yellow Brown",color:"#7e6000"},{id:"aap64-c26",name:"Mustard Yellow",color:"#bbaa00"},{id:"aap64-c27",name:"Bright Yellow",color:"#edde00"},{id:"aap64-c28",name:"Yellow",color:"#fff04d"},{id:"aap64-c29",name:"Light Yellow",color:"#fff68b"},{id:"aap64-c30",name:"Pale Yellow",color:"#fffcc8"},{id:"aap64-c31",name:"Lightest Yellow",color:"#fffee0"},{id:"aap64-c32",name:"Dark Green Blue",color:"#002a20"},{id:"aap64-c33",name:"Green Blue",color:"#005540"},{id:"aap64-c34",name:"Teal",color:"#008060"},{id:"aap64-c35",name:"Bright Teal",color:"#00aa80"},{id:"aap64-c36",name:"Cyan",color:"#00ffc0"},{id:"aap64-c37",name:"Light Cyan",color:"#4dffdb"},{id:"aap64-c38",name:"Pale Cyan",color:"#80ffe6"},{id:"aap64-c39",name:"Lightest Cyan",color:"#e6fff4"},{id:"aap64-c40",name:"Dark Blue Green",color:"#001a2f"},{id:"aap64-c41",name:"Blue Green",color:"#00335f"},{id:"aap64-c42",name:"Medium Blue Green",color:"#004d8e"},{id:"aap64-c43",name:"Bright Blue Green",color:"#0066bd"},{id:"aap64-c44",name:"Blue",color:"#0088ff"},{id:"aap64-c45",name:"Light Blue",color:"#4daaff"},{id:"aap64-c46",name:"Pale Blue",color:"#80ccff"},{id:"aap64-c47",name:"Lightest Blue",color:"#e6f4ff"},{id:"aap64-c48",name:"Dark Violet",color:"#0a0026"},{id:"aap64-c49",name:"Violet",color:"#14004c"},{id:"aap64-c50",name:"Medium Violet",color:"#230075"},{id:"aap64-c51",name:"Bright Violet",color:"#330099"},{id:"aap64-c52",name:"Purple",color:"#5e00ff"},{id:"aap64-c53",name:"Light Purple",color:"#8f4dff"},{id:"aap64-c54",name:"Pale Purple",color:"#bf80ff"},{id:"aap64-c55",name:"Lightest Purple",color:"#f2e6ff"},{id:"aap64-c56",name:"Dark Magenta",color:"#260026"},{id:"aap64-c57",name:"Magenta",color:"#4c004c"},{id:"aap64-c58",name:"Medium Magenta",color:"#750075"},{id:"aap64-c59",name:"Bright Magenta",color:"#990099"},{id:"aap64-c60",name:"Fuchsia",color:"#ff00ff"},{id:"aap64-c61",name:"Light Fuchsia",color:"#ff4dff"},{id:"aap64-c62",name:"Pale Fuchsia",color:"#ff80ff"},{id:"aap64-c63",name:"Lightest Fuchsia",color:"#ffe6ff"}]}),vo=new A({locked:!0,name:"Apple II High-Res Palette",description:"The characteristic colors of the Apple II High-Resolution graphics mode.",colors:[{id:"apple2-0",color:"#000000"},{id:"apple2-1",color:"#FFFFFF"},{id:"apple2-2",color:"#00FF00"},{id:"apple2-3",color:"#FF00FF"},{id:"apple2-4",color:"#FFA500"},{id:"apple2-5",color:"#0000FF"}]}),Eo=new A({locked:!0,id:"arne-16",name:"Arne16",description:"Another well-known 16-color palette by Arne Niklas Jansson (Skeddles), often with a slightly cooler color scheme than DB16, but also very versatile and balanced for various pixel art projects.",colors:[{id:"arne16-c0",name:"Deep Blue",color:"#1a1c2c"},{id:"arne16-c1",name:"Dark Purple",color:"#43283c"},{id:"arne16-c2",name:"Dark Green",color:"#4a444a"},{id:"arne16-c3",name:"Dark Cyan",color:"#633c58"},{id:"arne16-c4",name:"Dark Brown",color:"#76425a"},{id:"arne16-c5",name:"Forest Green",color:"#945c56"},{id:"arne16-c6",name:"Gray Blue",color:"#bc4a4a"},{id:"arne16-c7",name:"Light Brown",color:"#de7b72"},{id:"arne16-c8",name:"Orange Red",color:"#efb28e"},{id:"arne16-c9",name:"Pale Yellow",color:"#fecf65"},{id:"arne16-c10",name:"Bright Yellow",color:"#fff79c"},{id:"arne16-c11",name:"Light Green",color:"#227772"},{id:"arne16-c12",name:"Medium Green",color:"#28a773"},{id:"arne16-c13",name:"Teal",color:"#54d3ed"},{id:"arne16-c14",name:"Sky Blue",color:"#80f0c0"},{id:"arne16-c15",name:"White",color:"#b8f7ed"}]}),Co=new A({locked:!0,id:"bob-ross-palette",name:"Bob Ross Inspired",description:"A color palette inspired by the typical colors Bob Ross used in his 'The Joy of Painting' shows. Ideal for serene nature landscapes with mountains, trees, and water.",colors:[{id:"br-c0",name:"Midnight Black (Alizarin Crimson/Prussian Blue-like)",color:"#140c1c"},{id:"br-c1",name:"Dark Umber (Dark Sienna/Van Dyke Brown-like)",color:"#2a1e1b"},{id:"br-c2",name:"Forest Green (Dark Phthalo Green-like)",color:"#1f3a2c"},{id:"br-c3",name:"Mountain Blue (Prussian Blue-like)",color:"#2c2a3f"},{id:"br-c4",name:"Deep Red (Alizarin Crimson-like)",color:"#5b1e2c"},{id:"br-c5",name:"Warm Brown (Burnt Umber-like)",color:"#6d372c"},{id:"br-c6",name:"Moss Green (Sap Green-like)",color:"#4a6d38"},{id:"br-c7",name:"Sky Blue (Phthalo Blue-like)",color:"#4b6c8d"},{id:"br-c8",name:"Bright Red (Cadmium Red Light-like)",color:"#9b3c4f"},{id:"br-c9",name:"Golden Yellow (Cadmium Yellow-like)",color:"#e0a656"},{id:"br-c10",name:"Bright Green (Bright Sap Green-like)",color:"#76c04f"},{id:"br-c11",name:"Soft Blue (Light Phthalo Blue-like)",color:"#81a2cc"},{id:"br-c12",name:"Cream (Titanium White with a hint of color)",color:"#d6cec2"},{id:"br-c13",name:"Off-White (Liquid White-like)",color:"#f0f0e8"},{id:"br-c14",name:"Cloud Grey (Grey Mix-like)",color:"#b0b0b0"},{id:"br-c15",name:"Pure White (Titanium White-like)",color:"#ffffff"}]}),Do=new A({locked:!0,id:"bubblegum-16",name:"Bubblegum 16",description:"A vibrant and cheerful 16-color palette, well-suited for bright, friendly, or 'cute' aesthetics. Ideal for characters, UI elements, or colorful environments.",colors:[{id:"bubblegum-c0",name:"Dark Purple",color:"#2e203c"},{id:"bubblegum-c1",name:"Dark Blue",color:"#4b3064"},{id:"bubblegum-c2",name:"Medium Blue",color:"#6d5494"},{id:"bubblegum-c3",name:"Light Blue",color:"#8a7ba7"},{id:"bubblegum-c4",name:"Dark Pink",color:"#a75276"},{id:"bubblegum-c5",name:"Pink",color:"#d284ae"},{id:"bubblegum-c6",name:"Pale Pink",color:"#ffadd8"},{id:"bubblegum-c7",name:"Light Yellow",color:"#fffefb"},{id:"bubblegum-c8",name:"Dark Green",color:"#366e44"},{id:"bubblegum-c9",name:"Green",color:"#5cb064"},{id:"bubblegum-c10",name:"Lime Green",color:"#94d682"},{id:"bubblegum-c11",name:"Yellow Green",color:"#d2f7ae"},{id:"bubblegum-c12",name:"Orange",color:"#de7061"},{id:"bubblegum-c13",name:"Red Orange",color:"#ff9e7f"},{id:"bubblegum-c14",name:"Light Orange",color:"#ffbe9c"},{id:"bubblegum-c15",name:"Cream",color:"#ffe8c6"}]}),Lo=new A({locked:!0,name:"Commodore 64 (C64) Palette",description:"The characteristic 16 colors of the C64, generated by the VIC-II chip.",colors:[{id:"c64-0",color:"#000000"},{id:"c64-1",color:"#FFFFFF"},{id:"c64-2",color:"#68372B"},{id:"c64-3",color:"#70A4B2"},{id:"c64-4",color:"#6F3D86"},{id:"c64-5",color:"#588D43"},{id:"c64-6",color:"#352879"},{id:"c64-7",color:"#B8C76F"},{id:"c64-8",color:"#6F4F25"},{id:"c64-9",color:"#433900"},{id:"c64-10",color:"#9A6759"},{id:"c64-11",color:"#444444"},{id:"c64-12",color:"#6F6F6F"},{id:"c64-13",color:"#9AD284"},{id:"c64-14",color:"#6565EB"},{id:"c64-15",color:"#787878"}]}),Io=new A({locked:!0,name:"CGA 0 (High Intensity)",description:"The most well-known 4-color palette of the IBM PC Color Graphics Adapter.",colors:[{id:"cga-p0-0",color:"#000000"},{id:"cga-p0-1",color:"#00AA00"},{id:"cga-p0-2",color:"#AA0000"},{id:"cga-p0-3",color:"#AA5500"}]}),ko=new A({locked:!0,name:"CGA 1 (High Intensity)",description:"Another iconic 4-color palette of the CGA, often responsible for the cyan-magenta look.",colors:[{id:"cga-p1-0",color:"#000000"},{id:"cga-p1-1",color:"#00AAAA"},{id:"cga-p1-2",color:"#AA00AA"},{id:"cga-p1-3",color:"#AAAAAA"}]}),xo=new A({locked:!0,id:"cga-palette",name:"CGA Palette (Mode 4 High Intensity)",description:"A historical 16-color palette inspired by the IBM CGA graphics standard. Known for its bright, sometimes unsaturated colors and distinctive retro computer look. Challenging but very characteristic.",colors:[{id:"cga-c0",name:"Black",color:"#000000"},{id:"cga-c1",name:"Dark Blue",color:"#0000aa"},{id:"cga-c2",name:"Dark Green",color:"#00aa00"},{id:"cga-c3",name:"Dark Cyan",color:"#00aaaa"},{id:"cga-c4",name:"Dark Red",color:"#aa0000"},{id:"cga-c5",name:"Dark Magenta",color:"#aa00aa"},{id:"cga-c6",name:"Brown",color:"#aa5500"},{id:"cga-c7",name:"Light Gray",color:"#aaaaaa"},{id:"cga-c8",name:"Dark Gray",color:"#555555"},{id:"cga-c9",name:"Blue",color:"#5555ff"},{id:"cga-c10",name:"Green",color:"#55ff55"},{id:"cga-c11",name:"Cyan",color:"#55ffff"},{id:"cga-c12",name:"Red",color:"#ff5555"},{id:"cga-c13",name:"Magenta",color:"#ff55ff"},{id:"cga-c14",name:"Yellow",color:"#ffff55"},{id:"cga-c15",name:"White",color:"#ffffff"}]}),To=new A({locked:!0,id:"db16-palette",name:"Dawnbringer 16 (DB16)",description:"A versatile and balanced palette by Arne Niklas Jansson, ideal for various moods and scenarios. Known for its earthy and muted tones.",colors:[{id:"db16-c0",name:"Dark Plum",color:"#140c1c"},{id:"db16-c1",name:"Dark Blue",color:"#442434"},{id:"db16-c2",name:"Dark Green",color:"#30346d"},{id:"db16-c3",name:"Brown",color:"#4e4a68"},{id:"db16-c4",name:"Dark Red",color:"#69512c"},{id:"db16-c5",name:"Dark Orange",color:"#636357"},{id:"db16-c6",name:"Gray Blue",color:"#6f6451"},{id:"db16-c7",name:"Light Brown",color:"#76864d"},{id:"db16-c8",name:"Red Orange",color:"#816d56"},{id:"db16-c9",name:"Light Green",color:"#7b707c"},{id:"db16-c10",name:"Light Blue",color:"#80a254"},{id:"db16-c11",name:"Sand",color:"#a8b97d"},{id:"db16-c12",name:"Light Yellow",color:"#a2d28f"},{id:"db16-c13",name:"Pale Yellow",color:"#c6f5d0"},{id:"db16-c14",name:"Sky Blue",color:"#e0f6ee"},{id:"db16-c15",name:"White",color:"#f8f8f8"}]}),Ro=new A({locked:!0,id:"edg20-palette",name:"EDG20",description:"An Endesga-created 20-color palette. It offers a good selection of rich colors with various ramps for lights and shadows, ideal for more detailed scenes and illustrations.",colors:[{id:"edg20-c0",name:"Dark Grey",color:"#181425"},{id:"edg20-c1",name:"Deep Violet",color:"#241d3b"},{id:"edg20-c2",name:"Dark Violet",color:"#382552"},{id:"edg20-c3",name:"Medium Violet",color:"#5b3164"},{id:"edg20-c4",name:"Bright Violet",color:"#81396f"},{id:"edg20-c5",name:"Dark Blue",color:"#114c62"},{id:"edg20-c6",name:"Medium Blue",color:"#316f7c"},{id:"edg20-c7",name:"Light Blue",color:"#5e9a93"},{id:"edg20-c8",name:"Cyan",color:"#85c596"},{id:"edg20-c9",name:"Light Green",color:"#a8eb9b"},{id:"edg20-c10",name:"Dark Green",color:"#2c726f"},{id:"edg20-c11",name:"Olive Green",color:"#58916d"},{id:"edg20-c12",name:"Yellow Green",color:"#90c57c"},{id:"edg20-c13",name:"Dark Brown",color:"#4a2a4f"},{id:"edg20-c14",name:"Brown",color:"#793c66"},{id:"edg20-c15",name:"Light Brown",color:"#ae4f6b"},{id:"edg20-c16",name:"Dark Red",color:"#dd6e6c"},{id:"edg20-c17",name:"Red",color:"#ff9a8a"},{id:"edg20-c18",name:"Orange",color:"#ffca9a"},{id:"edg20-c19",name:"White",color:"#fff5ea"}]}),Po=new A({locked:!0,id:"gameboy-palette",name:"Game Boy (Original)",description:"The iconic 4-color palette of the classic Game Boy. Perfect for an authentic retro monochrome look with greenish tones.",colors:[{id:"gb-c0",name:"Darkest Green",color:"#0f380f"},{id:"gb-c1",name:"Dark Green",color:"#306230"},{id:"gb-c2",name:"Light Green",color:"#8bed81"},{id:"gb-c3",name:"Pale Green",color:"#9bbc0f"}]}),Bo=new A({locked:!0,id:"lospec500-palette",name:"LoSpec500",description:"A compact 5-color palette created by LoSpec. Perfect for a very limited, highly stylized look, ideal for small icons, simple sprites, or monochrome game concepts.",colors:[{id:"lospec500-c0",name:"Dark Grey",color:"#242424"},{id:"lospec500-c1",name:"Medium Grey",color:"#5b5b5b"},{id:"lospec500-c2",name:"Light Grey",color:"#939393"},{id:"lospec500-c3",name:"Lighter Grey",color:"#c4c4c4"},{id:"lospec500-c4",name:"White",color:"#fcfcfc"}]}),Oo=new A({locked:!0,name:"NES",description:"A selection of the fixed colors from the Nintendo Entertainment System.",colors:[{id:"nes-0",color:"#6F6F6F"},{id:"nes-1",color:"#000080"},{id:"nes-2",color:"#20008E"},{id:"nes-3",color:"#400078"},{id:"nes-4",color:"#800000"},{id:"nes-5",color:"#A00000"},{id:"nes-6",color:"#881400"},{id:"nes-7",color:"#604000"},{id:"nes-8",color:"#206000"},{id:"nes-9",color:"#007400"},{id:"nes-10",color:"#006C20"},{id:"nes-11",color:"#006464"},{id:"nes-12",color:"#004080"},{id:"nes-13",color:"#000000"},{id:"nes-14",color:"#000000"},{id:"nes-15",color:"#000000"}]}),Mo=new A({locked:!0,id:"pico8-palette",name:"PICO-8",description:"The classic 16-color palette of the PICO-8 Fantasy Console. Known for its vibrant and slightly 'retro' Lo-Fi look, ideal for stylized games.",colors:[{id:"pico8-c0",name:"Black",color:"#000000"},{id:"pico8-c1",name:"Dark Blue",color:"#1d2b53"},{id:"pico8-c2",name:"Dark Purple",color:"#7e2553"},{id:"pico8-c3",name:"Dark Green",color:"#008751"},{id:"pico8-c4",name:"Brown",color:"#ab5236"},{id:"pico8-c5",name:"Dark Gray",color:"#5f574f"},{id:"pico8-c6",name:"Light Gray",color:"#c2c3c7"},{id:"pico8-c7",name:"White",color:"#fff1e8"},{id:"pico8-c8",name:"Red",color:"#ff004d"},{id:"pico8-c9",name:"Orange",color:"#ffa300"},{id:"pico8-c10",name:"Yellow",color:"#ffec27"},{id:"pico8-c11",name:"Green",color:"#00e436"},{id:"pico8-c12",name:"Blue",color:"#29adff"},{id:"pico8-c13",name:"Indigo",color:"#83769c"},{id:"pico8-c14",name:"Pink",color:"#ff77a8"},{id:"pico8-c15",name:"Peach",color:"#ffccaa"}]});function Fo(){const t=[],e=[[0,0,0],[128,0,0],[0,128,0],[128,128,0],[0,0,128],[128,0,128],[0,128,128],[192,192,192],[128,128,128],[255,0,0],[0,255,0],[255,255,0],[0,0,255],[255,0,255],[0,255,255],[255,255,255],[0,0,0,0],[0,0,0,0]];t.push(...e);const o=[0,51,102,153,204,255];for(let i=0;i<6;i++)for(let n=0;n<6;n++)for(let a=0;a<6;a++){const r=o[i],l=o[n],d=o[a];t.push([r,l,d])}for(let i=0;i<24;i++){const n=8+i*10;t.push([n,n,n])}return t.map(i=>new p(i[0],i[1],i[2]))}const Uo=new A({locked:!0,name:"Windows 256 Color",description:"A palette inspired by the classic Windows 256 color set, including VGA colors, web-safe colors, and grayscale.",colors:Fo().map(t=>new M({color:t}))}),Ho=new A({locked:!0,name:"ZX Spectrum Palette",description:"The 15 colors of the ZX Spectrum, including bright variants.",colors:[{id:"zx-0",color:"#000000"},{id:"zx-1",color:"#0000D7"},{id:"zx-2",color:"#D70000"},{id:"zx-3",color:"#D700D7"},{id:"zx-4",color:"#00D700"},{id:"zx-5",color:"#00D7D7"},{id:"zx-6",color:"#D7D700"},{id:"zx-7",color:"#D7D7D7"},{id:"zx-8",color:"#000000"},{id:"zx-9",color:"#0000FF"},{id:"zx-10",color:"#FF0000"},{id:"zx-11",color:"#FF00FF"},{id:"zx-12",color:"#00FF00"},{id:"zx-13",color:"#00FFFF"},{id:"zx-14",color:"#FFFF00"},{id:"zx-15",color:"#FFFFFF"}]});var No=(t=>(t.AAP_64="aap_64",t.APPLE_2="apple_2",t.ARNE_16="arne_16",t.BOB_ROSS="bob_ross",t.BUBBLEGUM_16="bubblegum_16",t.C64="c64",t.CGA_0="cga_0",t.CGA_1="cga_1",t.CGA_2="cga_2",t.DB_16="db_16",t.EDG_20="edg_20",t.GAME_BOY="game_boy",t.LOSPEC_500="lospec_500",t.NES="nes",t.PICO_8="pico_8",t.WIN_256="win_256",t.ZX_SPECTRUM="zx_spectrum",t))(No||{});const Ne={aap_64:_o,apple_2:vo,arne_16:Eo,bob_ross:Co,bubblegum_16:Do,c64:Lo,cga_0:Io,cga_1:ko,cga_2:xo,db_16:To,edg_20:Ro,game_boy:Po,lospec_500:Bo,nes:Oo,pico_8:Mo,win_256:Uo,zx_spectrum:Ho};function nn(){return Object.values(Ne)}function zo(t){if(!t||typeof t!="string")throw new Error("Invalid palette name");return Ne[t]}function Go(){const{colors:t}=zo("aap_64");return new A({id:"default",name:"Default Palette",colors:[new M({id:"black",color:new p(0,0,0,255)}),new M({id:"white",color:new p(255,255,255,255)}),...t]})}var Vo=(t=>(t[t.ROTATE_90_DEGRESS=0]="ROTATE_90_DEGRESS",t[t.ROTATE_180_DEGRESS=1]="ROTATE_180_DEGRESS",t[t.ROTATE_270_DEGRESS=2]="ROTATE_270_DEGRESS",t))(Vo||{}),Qo=(t=>(t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t))(Qo||{}),J=(t=>(t.NEAREST_NEIGHBOR="nearestNeighbor",t.BILINEAR="bilinear",t.BICUBIC="bicubic",t.LANCZOS="lanczos",t))(J||{}),Wo=(t=>(t.GRAYSCALE="grayscale",t.INVERT="invert",t.SEPIA="sepia",t.BRIGHTNESS="brightness",t.CONTRAST="contrast",t.SATURATION="saturation",t.SHARPEN="sharpen",t.BLUR="blur",t.EMBOSS="emboss",t.ROTATE="rotate",t.FLIP="flip",t.EDGE_DETECT="edge_detect",t.THRESHOLD="threshold",t.COLORIZE="colorize",t.CUSTOM="custom",t))(Wo||{});const Zo={warning:{page_change:"Do you really want to leave the page?"},resize_type:{[J.NEAREST_NEIGHBOR]:"Nearest Neighbor",[J.BICUBIC]:"Bicubic",[J.BILINEAR]:"Bilinear",[J.LANCZOS]:"LANCZOS"},blend_mode:{[R.NORMAL]:"Normal",[R.MULTIPLY]:"Multiply",[R.SCREEN]:"Screen",[R.OVERLAY]:"Overlay",[R.DARKEN]:"Darken",[R.LIGHTEN]:"Lighten",[R.COLOR_DODGE]:"Color Dodge",[R.COLOR_BURN]:"Color Burn",[R.HARD_LIGHT]:"Hard Light",[R.SOFT_LIGHT]:"Soft Light",[R.DIFFERENCE]:"Difference",[R.EXCLUSION]:"Exclusion"},brush_mode:{[v.NORMAL]:"Normal",[v.REPLACE]:"Replace",[v.MULTIPLY]:"Multiply",[v.SCREEN]:"Screen",[v.OVERLAY]:"Overlay",[v.SOFT_LIGHT]:"Soft Light",[v.HARD_LIGHT]:"Hard Light",[v.DIFFERENCE]:"Difference",[v.EXCLUSION]:"Exclusion",[v.COLOR_BURN]:"Color Burn",[v.LINEAR_BURN]:"Linear Burn",[v.COLOR_DODGE]:"Color Dodge",[v.LINEAR_DODGE]:"Linear Dodge",[v.VIVID_LIGHT]:"Vivid Light",[v.LINEAR_LIGHT]:"Linear Light",[v.PIN_LIGHT]:"Pin Light",[v.HARD_MIX]:"Hard Mix",[v.SUBSTRACT]:"Substract",[v.DIVIDE]:"Divide"},tool:{[s.DOTTED_FREEHAND]:"Dotted Freehand",[s.CONTINUOUS_FREEHAND]:"Continuous Freehand",[s.STRAIGHT_LINE]:"Straight Line",[s.CURVE_LINE]:"Curve",[s.FILL_TOOL]:"Fill Tool",[s.AIR_BRUSH]:"Air Brush",[s.RECTANGLE]:"Rectangle",[s.CIRCLE]:"Circle",[s.ELLIPSE]:"Ellipse",[s.POLYGON]:"Polygon",[s.COLOR_PICKER]:"Color Picker",[s.CROP]:"Crop",[s.GRID]:"Grid",[s.ZOOM_FIT]:"Fit to Screen",[s.MAGNIFY]:"Magnify",[s.ZOOM]:"Zoom",[s.STACK_UNDO]:"Undo",[s.STACK_REDO]:"Redo",[s.CLEAR]:"Clear"},brush_size:{[y.CIRCLE]:{small:"Small Circle",medium:"Medium Circle",large:"Large Circle",extra_large:"Extra Large Circle"},[y.SQUARE]:{small:"Small Square",medium:"Medium Square",large:"Large Square",extra_large:"Extra Large Square"},[y.DOTS]:{sma:"Small Dots",medi:"Medium Dots",lar:"Large Dots",extra_lar:"Extra Large Dots"}},brush_type:{[y.CIRCLE]:"Circle",[y.SQUARE]:"Square",[y.DOTS]:"Dots"},shape_style:{[j.STROKED]:"Stroked",[j.FILLED]:"Filled",[j.STROKED_FILLED]:"Stroked & Filled"},context_menu:{general:{title:"Web Paint",items:{settings:{title:"Settings"},help:{title:"Help"},info:{title:"Info"},close:{title:"Close"}}},file:{title:"File",items:{new:{title:"New"},open:{title:"Open"},save:{title:"Save"},save_as:{title:"Save As"},export_document:{title:"Export Document"},import_document:{title:"Import Document"},export:{title:"Export"},import:{title:"Import"},import_clipboard:{title:"Clipboard Import"},document_settings:{title:"Document Settings"}}},edit:{title:"Edit",items:{undo:{title:"Undo"},redo:{title:"Redo"},copy:{title:"Copy"},insert_image:{title:"Insert Image",items:{paste:{title:"Paste"},open:{title:"Open"},import:{title:"Import"}}}}},tools:{title:"Tools",items:{select_tool:{title:"Select Tool"},brush_type:{title:"Brush Type ({{type}})"},brush_mode:{title:"Brush Mode ({{mode}})"},brush_size:{title:"Brush Size ({{size}}px)",items:{set_custom:{title:"Set custom",text:"Set custom brush size"}}},dotted_gap:{title:"Dotted Gap ({{gap}})",items:{set_custom:{title:"Set custom",text:"Set custom dotted gap"}}},segment_length:{title:"Segment Length ({{length}}px)",items:{set_custom:{title:"Set custom",text:"Set custom segment length"}}},gap_length:{title:"Gap Length ({{length}})",items:{set_custom:{title:"Set custom",text:"Set custom gap length"}}},air_brush_strength:{title:"Air Brush Strength ({{strength}})",text:"Set custom AirBrush strength (1 - 1000)"},air_brush_weight:{title:"Air Brush Weight ({{weight}})",text:"Set custom AirBrush weight (ms)"},air_brush_interval:{title:"Air Brush Interval ({{interval}})",text:"Set custom AirBrush interval (ms)"},interpolate_segments:{title:"Interpolate Segments"}}},image:{title:"Image",items:{rotate:{title:"Rotate",items:{rotate_90:{title:"Rotate 90"},rotate_180:{title:"Rotate 180"},rotate_270:{title:"Rotate 270"}}},flip:{title:"Flip",items:{horizontal:{title:"Horizontal"},vertical:{title:"Vertical"}}},operation:{title:"Operation",items:{invert:{title:"Invert"},grayscale:{title:"Grayscale"},sepia:{title:"Sepia"},brightness:{title:"Brightness",text:"Adjust Brightness <br>-100% to 100%"},contrast:{title:"Contrast",text:"Adjust Contrast <br>-100% to 100%"},saturation:{title:"Saturation",text:"Adjust Saturation <br>-100% to 100%"},sharpen:{title:"Sharpen"},blur:{title:"Blur",text:"Blur (px)"},emboss:{title:"Emboss",text:"Emboss (px)"},resize:{title:"Resize"},resize_canvas:{title:"Resize Canvas"}}}}},color_palette:{title:"Color Palette",items:{settings:{title:"Settings"},no_palettes:{title:"No custom palettes"}}},display:{title:"Display",items:{grid:{title:"Grid"},split:{title:"Split View",items:{one_display:{title:"One Display"},two_displays:{title:"Two Displays"},three_displays:{title:"Three Displays"},four_displays:{title:"Four Displays"}}},reset:{title:"Reset View",items:{all:{title:"All"},position:{title:"Position"},zoom:{title:"Zoom"}}}}},dimension:{text:"Dimension: {{x}}x{{y}}"},position:{text:"Position: {{x}}/{{y}}"},zoom:{title:"Zoom: {{zoom}}",items:{set_zoom:{title:"Set Zoom",text:"Enter zoom level:"},reset:{title:"Reset Zoom",text:"Reset zoom to 100%"},fit:{title:"Fit to Screen",text:"Fit the image to the screen"}}},brush_mode:{title:"Brush Mode: {{mode}}"},layers:{title:"Layers ({{name}})",items:{visible:{title:"Visible Layer"},lock:{title:"Lock Layer"},move_up:{title:"Move Layer Up"},move_down:{title:"Move Layer Down"},add:{title:"Add Layer"},rename:{title:"Rename Layer",text:"Enter new layer name:"},remove:{title:"Remove Layer"},duplicate:{title:"Duplicate Layer"},merge:{title:"Merge Layer"},blend_mode:{title:"Blend Mode: {{mode}}",items:{normal:{title:"Normal"},multiply:{title:"Multiply"},screen:{title:"Screen"},overlay:{title:"Overlay"},darken:{title:"Darken"},lighten:{title:"Lighten"},color_dodge:{title:"Color Dodge"},color_burn:{title:"Color Burn"},hard_light:{title:"Hard Light"},soft_light:{title:"Soft Light"},difference:{title:"Difference"},exclusion:{title:"Exclusion"}}},opacity:{title:"Opacity: {{opacity}}%",text:"Set layer opacity (0 - 100)"}}}},window:{info:{title:"Info"},help:{title:"Help"},value_input:{title:"Value Input"},settings:{title:"Settings",general:{title:"General",text:"For this Settings you need restart Web Paint.",items:{native_theme:{label:"Native Theme"},debug:{label:"Debug"}}},display:{title:"Display",items:{background:{label:"Background"},foreground:{label:"Foreground"}}},pixel_grid:{title:"Pixel Grid",items:{grid_color:{label:"Grid Color"},line_width:{label:"Line Width (px)"},visible_count:{label:"Visible Count"}}},fit_zoom:{title:"Fit Zoom",items:{active:{label:"Active"},offset:{label:"Offset (px)"}}},document:{title:"Document",items:{background:{label:"Background"}}},save:{label:"Save"},reset:{label:"Reset"}},image_sharpness:{title:"Image Sharpness",radius:{label:"Radius"},threshold:{label:"Threshold"},apply:{label:"Apply"}},document_resize:{title:"Document Resize",width:{label:"Width"},height:{label:"Height"},resize_type:{label:"Resize Type"},save:{label:"Save"}},document_resize_canvas:{title:"Document Resize Canvas",width:{label:"Width"},height:{label:"Height"},resize_type:{label:"Resize Type"},save:{label:"Save"}},document_settings:{title:"Document Settings"},color_palette:{title:"Color Palette",colors_from_palette:{label:"Colors from Palette",items:{default:{label:"Colors from Palette"},custom_palettes:{label:"Custom Palettes"},builtin_palettes:{label:"Built-in Palettes"}}},palette:{label:"Palette",items:{new:{label:"New Palette"},custom_palettes:{label:"Custom Palettes"},builtin_palettes:{label:"Built-in Palettes"}}},add_color:{label:"Add"},remove_color:{label:"Del"},move_color_backward:{label:"<"},move_color_forward:{label:">"},colors_from_image:{label:"Colors from Image"},add_palette:{label:"Add Palette"},remove_palette:{label:"Del Palette"},rename_palette:{label:"Rename Palette"},import_palette:{label:"Import"},export_palette:{label:"Export"},save_palette:{label:"Apply Palette"}},color_picker:{title:"Color Picker",apply:{label:"Apply"}},export_document:{title:"Export",filename:{label:"Filename"},type:{label:"Type"},quality:{label:"Quality"},width:{label:"Width"},height:{label:"Height"},dimension_type:{label:"Type",items:{pixel:{label:"Pixel"},percent:{label:"Percent"}}},apply:{label:"Export"}},insert_image:{title:"Insert Image",width:{label:"Width"},height:{label:"Height"},resize_type:{label:"Type"},position_x:{label:"X"},position_y:{label:"Y"},apply:{label:"Insert Image"}},grid_settings:{title:"Grid Settings",no_display:"No display is currently active. Please select a display to configure the grid settings.",active:{label:"Active"},width:{label:"Width"},height:{label:"Height"},position_x:{label:"X"},position_y:{label:"Y"},primary_line_color:{label:"Primary Line Color"},secondary_line_color:{label:"Secondary Line Color"},apply:{label:"Apply"}},new_document:{title:"New Document",width:{label:"Width",placeholder:"Width in pixels"},height:{label:"Height",placeholder:"Height in pixels"},document_title:{label:"Title",placeholder:"Document title"},template:{label:"Template"},aspect_ratio_info:"**Aspect Ratio** {{x}}x{{y}}",apply:{label:"Apply"}}}};function ge(){return{t:(t,{overrides:e={},default:o}={})=>{const i=t.split(".").reduce((n,a)=>typeof n=="object"&&n[a]?n[a]:o||t,Zo);if(typeof i!="string")throw new Error(`Translation for key "${t}" not found`);return Object.entries(e).reduce((n,[a,r])=>n.replace(`{{${a}}}`,String(r)),i)}}}function ze(){return{type:y.CIRCLE,size:1,mode:v.NORMAL}}function Ge(){return{shapeStyle:j.STROKED_FILLED,value:s.CONTINUOUS_FREEHAND,dottedGap:2,segmentLength:1,gapLength:0,interpolateSegments:!0,airBrushStrength:50,airBrushWeight:.5,airBrushInterval:50}}function Ve(){return{primaryColor:new M({color:new p(0,0,0)}),secondaryColor:new M({color:new p(255,255,255)}),palette:Go()}}function sn(){const{t}=ge();return[{value:{type:y.CIRCLE,size:1},title:t(`brush_size.${y.CIRCLE}.small`)},{value:{type:y.CIRCLE,size:3},title:t(`brush_size.${y.CIRCLE}.medium`)},{value:{type:y.CIRCLE,size:5},title:t(`brush_size.${y.CIRCLE}.large`)},{value:{type:y.CIRCLE,size:7},title:t(`brush_size.${y.CIRCLE}.extra_large`)},{value:{type:y.SQUARE,size:5},title:t(`brush_size.${y.SQUARE}.extra_large`)},{value:{type:y.SQUARE,size:4},title:t(`brush_size.${y.SQUARE}.large`)},{value:{type:y.SQUARE,size:3},title:t(`brush_size.${y.SQUARE}.medium`)},{value:{type:y.SQUARE,size:2},title:t(`brush_size.${y.SQUARE}.small`)},{value:{type:y.DOTS,size:4},title:t(`brush_size.${y.DOTS}.small`)},{value:{type:y.DOTS,size:8},title:t(`brush_size.${y.SQUARE}.medium`)}]}function an({app:t,shiftActive:e,canRedo:o,canUndo:i}){const{t:n}=ge();return[{value:s.DOTTED_FREEHAND,title:n(`tool.${s.DOTTED_FREEHAND}`),hotKey:{code:K.KEY_D,title:"D"}},{value:s.CONTINUOUS_FREEHAND,title:n(`tool.${s.CONTINUOUS_FREEHAND}`),hotKey:{code:K.KEY_B,title:"B"}},{value:s.STRAIGHT_LINE,title:n(`tool.${s.STRAIGHT_LINE}`)},{value:s.CURVE_LINE,title:n(`tool.${s.CURVE_LINE}`)},{value:s.FILL_TOOL,title:n(`tool.${s.FILL_TOOL}`),hotKey:{code:K.KEY_F,title:"F"}},{value:s.AIR_BRUSH,title:n(`tool.${s.AIR_BRUSH}`)},{value:s.RECTANGLE,title:n(`tool.${s.RECTANGLE}`)},{value:s.CIRCLE,title:n(`tool.${s.CIRCLE}`)},{value:s.ELLIPSE,title:n(`tool.${s.ELLIPSE}`)},{value:s.POLYGON,title:n(`tool.${s.POLYGON}`)},{value:s.COLOR_PICKER,title:n(`tool.${s.COLOR_PICKER}`),hotKey:{code:K.KEY_I,title:"I"}},{value:s.CROP,title:n(`tool.${s.CROP}`)},{passive:!0,value:s.GRID,title:n(`tool.${s.GRID}`),selected:t.currentDisplay?.options.grid.active},{passive:!0,value:s.ZOOM_FIT,title:n(`tool.${s.ZOOM_FIT}`)},{value:s.MAGNIFY,title:n(`tool.${s.MAGNIFY}`)},{value:s.ZOOM,title:n(`tool.${s.ZOOM}`)},...e?[{disabled:!o,value:s.STACK_REDO,passive:!0,title:n(`tool.${s.STACK_REDO}`)}]:[{disabled:!i,value:s.STACK_UNDO,passive:!0,title:n(`tool.${s.STACK_UNDO}`)}],{value:s.CLEAR,passive:!0,title:n(`tool.${s.CLEAR}`)}]}var V=(t=>(t.START="start",t.STOP="stop",t.ABORT="abort",t.FORWARD="forward",t.BACKWARD="backward",t))(V||{});class Jo{constructor(e){this.app=e}startStack(){return this.app.workerManager.action({type:h.STACK,payload:{action:V.START}})}stopStack(){return this.app.workerManager.action({type:h.STACK,payload:{action:V.STOP}})}abortStack(){return this.app.workerManager.action({type:h.STACK,payload:{action:V.ABORT}})}stackUndo(){return this.app.workerManager.action({type:h.STACK,payload:{action:V.BACKWARD}})}stackRedo(){return this.app.workerManager.action({type:h.STACK,payload:{action:V.FORWARD}})}setSelectOptions(e){return this.app.workerManager.action({type:h.SET_SELECT_OPTIONS,payload:e})}getData(e={}){return this.app.workerManager.action({type:h.GET_DATA,payload:e})}insertImage(e){return this.app.workerManager.action({type:h.INSERT_IMAGE,payload:e})}resize(e){return this.app.workerManager.action({type:h.RESIZE,payload:e})}resizeCanvas(e){return this.app.workerManager.action({type:h.RESIZE_CANVAS,payload:e})}flip(e){return this.app.workerManager.action({type:h.FLIP,payload:{type:e}})}rotate(e){return this.app.workerManager.action({type:h.ROTATE,payload:{type:e}})}async getColors(){return this.app.workerManager.action({type:h.GET_COLORS,payload:{}})}selectLayer(e){return this.app.workerManager.action({type:h.SELECT_LAYER,payload:{id:e}})}updateLayer(e,o){return this.app.workerManager.action({type:h.UPDATE_LAYER,payload:{id:e,data:{...this.app.state.layers.find(i=>i.id===e),...o}}})}moveLayers(e){return this.app.workerManager.action({type:h.MOVE_LAYERS,payload:{layers:e}})}addLayer(e){return this.app.workerManager.action({type:h.ADD_LAYER,payload:{name:e.name}})}removeLayer(e){return this.app.workerManager.action({type:h.REMOVE_LAYER,payload:{id:e}})}getLayers(){return this.app.workerManager.action({type:h.GET_LAYERS,payload:{}})}duplicateLayer(e){return this.app.workerManager.action({type:h.DUPLICATE_LAYER,payload:{id:e}})}mergeLayers(e){return this.app.workerManager.action({type:h.MERGE_LAYERS,payload:{ids:e}})}}async function rn(t){const e=URL.createObjectURL(t);let o;try{o=await $(e)}catch(a){throw URL.revokeObjectURL(e),new Error(`Failed to load image from blob: ${a}`)}const i=document.createElement("canvas"),n=i.getContext("2d");if(!n)throw URL.revokeObjectURL(e),new Error("Could not get 2D rendering context for canvas.");return i.width=o.naturalWidth,i.height=o.naturalHeight,n.drawImage(o,0,0),URL.revokeObjectURL(e),n.getImageData(0,0,o.width,o.height)}function Qe(t,e){const o=new Uint8ClampedArray(e.x*e.y*4);return o.set(t),new ImageData(o,e.x,e.y)}class jo{select;display;zoomStep;constructor(e){const{select:o,display:i,zoomStep:n}=e||{};this.select=o||{brush:ze(),tool:Ge(),color:Ve()},this.display=i||{colors:{background:new p(255,255,255),foreground:new p(0,0,0)},grid:{color:new p(0,0,0,.2),lineWidth:1,visibleCount:10}},this.zoomStep=n||.2}}class Xo{actions=new Jo(this);state={stackCount:0,stackIndex:-1,stackMaxSize:0,layers:[],currentLayerId:void 0};workerManager;currentDocument;currentDisplay;canvas;options;displays=[];constructor({options:e},o){this.options=new jo(e),this.workerManager=new uo(this,o),this.setDisplay(this.addDisplay())}async setup(){await this.workerManager.setup(),this.setDocument(bo())}closeDocument(){this.currentDocument=void 0}addDisplay(e){const o=new fo(this,{colors:this.options.display.colors,pixelGrid:this.options.display.grid,...e||{}});return this.displays.push(o),o}setDisplays(e){if(e<1||e>4)throw new Error("Display count must be between 1 and 4");const o=e-this.displays.length;for(let i=0;i<Math.abs(o);i++)o<0?this.removeDisplay(this.displays[this.displays.length-1]):this.addDisplay()}setDisplayColors(e){this.displays.forEach(o=>{o.setColors(e)})}setDisplayPixelGrid(e){this.displays.forEach(o=>{o.setPixelGrid(e)})}get hasMaxDisplays(){return this.displays.length>=4}async setDisplayCanvas(e,o){await this.workerManager.addDisplay(e,o)}removeDisplayCanvas(e){this.workerManager.removeDisplay(e)}removeDisplay(e){this.workerManager.removeDisplay(e),this.displays=this.displays.filter(o=>o!==e)}removeDisplays(){return Promise.all(this.displays.map(e=>this.workerManager.removeDisplay(e)))}async setDocument(e){this.currentDocument&&this.currentDocument.destroy(),this.currentDocument=e;const o=e.layers.map(n=>n.imageBitmap),i={type:h.LOAD_DOCUMENT,payload:{layers:e.layers}};await this.workerManager.action(i,o)}setDisplay(e){typeof e=="string"&&(e=this.displays.find(o=>o.id===e)),this.currentDisplay=e}actionDisplay(e,o,i){return this.workerManager.action(o,i,e.worker)}get ready(){return Promise.all([this.workerManager.ready])}setState(e){Object.keys(e).forEach(o=>{this.state[o]=e[o]})}setBrush(e){this.options.select.brush=e}setSelectOptions(e,o,i=!1){let n;i&&(n={...this.options.select[e],...o}),this.options.select={...this.options.select,[e]:n||o},this.actions.setSelectOptions(this.options.select)}setColor(e){this.options.select.color=e}setColorPalette(e){this.options.select.color.palette=e}currentTool;setTool(e){this.currentTool&&this.currentTool.destroy(),this.currentTool=e}async getImageData(){const{payload:e}=await this.actions.getData(),{buffer:o,dimension:i}=e,n=new Uint8ClampedArray(o.length);return n.set(o),new ImageData(n,i.x,i.y)}async importDocument(e){const i=await(await b(()=>import("./D9jdACNK.js").then(r=>r.j),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.default)).loadAsync(e),n=await le(xe(i.file("document.json").async("text").then(JSON.parse)).pipe(ho())),a=new Y({...n});return await Promise.all(a.layers.map(async r=>{const l=await i.folder("layers").file(r.id+".png").async("blob");console.log(l),r.imageBitmap=await Lt(l)})),this.setDocument(a)}async exportDocument(e){const{payload:o}=await this.actions.getLayers(),i={...e.toJSON(),layers:[]},n=await b(()=>import("./D9jdACNK.js").then(d=>d.j),__vite__mapDeps([0,1]),import.meta.url).then(d=>d.default),a=new n,r=a.folder("layers");await Promise.all(o.layers.map(async d=>{const m=await It(Qe(d.buffer,d.dimension));r?.file(`${d.id}.png`,m,{binary:!0}),delete d.dimension,delete d.buffer,i.layers.push({...d})}));const l=await le(X(i).pipe(mo()));return a.file("document.json",JSON.stringify(l),{binary:!1}),a.generateAsync({type:"blob"})}}const $o=new Pt({name:"Pastel Beige",colorOptions:{layout:{primary:"#F5F5DC",secondary:"#000000",tertiary:"#D2B48C",quaternary:"#6B4226",invert:{primary:"#6B4226",secondary:"#D2B48C",tertiary:"#000000",quaternary:"#F5F5DC"}},content:{primary:"#F5F5DC",secondary:"#000000",tertiary:"#D2B48C",quaternary:"#6B4226",invert:{primary:"#F5F5DC",secondary:"#6B4226",tertiary:"#000000",quaternary:"#F5F5DC"}}}});function qo(t){if(!t.colorOptions)throw new Error("Theme must have colorOptions defined");return t.extend({name:"Web Paint",colors:{disks:{webPaint:We(Bt(t.colorOptions))}}})}function We(t=["#FFF","#000","#FFAA55","#0055AA"]){return{originSelect:{background:t[2],foreground:t[0],selected:{background:t[1],foreground:t[0]}},aspectRatioPreview:{background:t[3],foreground:t[0],filled:{background:t[0],foreground:t[3]}},colorSelect:{border:t[3],selcted:{border:t[0]},filled:{border:t[0],selected:{border:t[3]}}},iconButton:{background:t[1],foreground:t[0],hover:{background:t[1],foreground:t[0]},filled:{background:t[3],foreground:t[0],hover:{background:t[2],foreground:t[3]}}},sidebar:{background:{primary:t[2],secondary:t[0]},border:t[2],brushSelect:{background:t[0],item:{foreground:t[2],selected:{foreground:t[3]}}},toolSelect:{background:t[2],item:{background:t[0],foreground:t[3],selected:{background:t[2],foreground:t[3]}}},colorSelect:{background:"#000",item:{selected:{border:"#fff"}}}},grid:{warning:{border:t[3],background:t[0],foreground:t[1]}}}}const Yo=$o.extend({name:"Web Painting",colors:{disks:{webPaint:We(["#F5F5DC","#6B4226","#D2B48C","#000000"])}}});class Ze{type;app;actions;options;domEvents;constructor({type:e,app:o,actions:i,domEvents:n,options:a}){this.type=e,this.app=o,this.actions=i,this.options=a||{},this.domEvents=n}destroy(){}getDisplay(){return this.app.currentDisplay}action(e={},o){}}class L extends Ze{interactingMove=!1;currentEvent;constructor({domEvents:e,interactingMove:o,...i}){super({...i,options:{...i.options,lastPosition:c(0,0)}}),this.interactingMove=o??!0,this.domEvents=e}click(e,o){}async pointerDown(e){this.currentEvent=e,this.options.lastPosition=e.normalizedPosition}async pointerUp(e){this.currentEvent=e,this.options.lastPosition=e.normalizedPosition}pointerOver(e){this.currentEvent=e}pointerMove(e){this.currentEvent=e,this.options.lastPosition=e.normalizedPosition}pointerMoveStatic(e){this.currentEvent=e}contextMenu(e){}pointerCancel(e){}cancel(e){}reset(e){e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height)}action(e={},{event:{dimension:o,normalizedPosition:i,seed:n}}){const a={...this.options,...e},r=this.app.workerManager,l=this.getDisplay();return r.action({type:h.USE_TOOL,payload:{tool:this.type,toolOptions:a,meta:{dimension:o,displayPosition:l.options.position,position:i,zoomLevel:l.options.zoomLevel,seed:n}}})}}class Ko extends L{}class ei extends L{constructor(e){super({...e,type:s.ZOOM})}async pointerUp(e){const o=this.getDisplay(),i=this.app.options.zoomStep,n=1+(this.domEvents?.shiftLeftActive?-i:i);o.options.zoomLevel=n,await o.action({type:h.SET_ZOOM,payload:{zoomLevel:n,position:e.normalizedPosition}})}}class ti extends L{bounds;startPosition;color=new p(255,170,85,1);constructor(e){super({...e,type:s.MAGNIFY})}async pointerUp(e){const o=e.ctx;if(o.clearRect(0,0,o.canvas.width,o.canvas.height),!this.startPosition||!this.bounds)return;const i=this.bounds,n=this.getDisplay(),a=c(()=>Math.abs(e.dimension/i.dimension*n.app.options.zoomStep));if(a.x===1/0||a.y===1/0)return;const r=e.normalizePosition(c(()=>i.position+i.dimension/2)),l=1+(this.domEvents?.shiftLeftActive?-1:1)*Math.max(a.x,a.y);this.startPosition=void 0,await n.action({type:h.SET_ZOOM,payload:{zoomLevel:l,position:r}})}async pointerDown(e){this.startPosition=e.position,e.ctx.beginPath()}pointerMove(e){if(!this.startPosition)return;const o=e.ctx;o.clearRect(0,0,o.canvas.width,o.canvas.height),o.strokeStyle=`2px ${this.color.toHex()}`,o.lineWidth=2,this.bounds={position:this.startPosition,dimension:c(()=>e.position-this.startPosition)},o.strokeRect(this.bounds.position.x,this.bounds.position.y,this.bounds.dimension.x,this.bounds.dimension.y)}}class oi extends L{active=!1;constructor(e){super({...e,options:{...e.options,stackable:!0}})}async pointerMove(e){e.isIntersecting()&&await this.action({state:"DRAW"},{event:e}),super.pointerMove(e)}async pointerMoveStatic(e){this.active||await this.action({state:"MOVE",stackable:!1},{event:e}),super.pointerMoveStatic(e)}async pointerDown(e){await super.pointerDown(e),await this.app.actions.startStack(),this.active=!0,await this.action({state:"DRAW"},{event:e})}async pointerCancel(e){this.cancel(e),await super.pointerCancel(e)}async cancel(e){this.active=!1,await this.action({state:"RESET"},{event:e}),await super.pointerCancel(e)}async pointerUp(e){return this.active=!1,await this.app.actions.stopStack(),super.pointerUp(e)}}class Je extends oi{timer;canPressHold;holdEvent;constructor(e){super({...e,type:e.type||s.DOTTED_FREEHAND,options:{...e.options,gap:e.options?.gap||e.app.options.select.tool.dottedGap||2}})}async pointerUp(e){return this.timer&&(this.timer.unsubscribe(),this.timer=void 0,this.holdEvent=void 0),super.pointerUp(e)}}class je extends Je{constructor(e){super({...e,type:e.type||s.CONTINUOUS_FREEHAND})}}function de(t,{dimension:e}){return c(()=>(t/e-.5)*2)}function ii(t,{dimension:e}){return c(()=>(t/2+.5)*e)}function me(t,{dimension:e}){return c(()=>t/e)}function ni(t,{dimension:e}){return c(()=>t*e)}function Le(t,{documentMeta:e,dimension:o,displayOptions:i}){return t=$e(de(t,{dimension:o}),{documentMeta:e,dimension:o,displayPosition:i.position,zoomLevel:i.zoomLevel}),t=qe(c(()=>Math.round(t)),{documentMeta:e,dimension:o,displayPosition:i.position,zoomLevel:i.zoomLevel}),t}function Xe(t,{dimension:e,zoomLevel:o}){return c(()=>Math.round(t*(e/o)))}function si(t,{dimension:e,zoomLevel:o}){return c(()=>t/(e/o))}function ai(t,{dimension:e,displayOptions:o}){return t=Xe(me(t,{dimension:e}),{dimension:e,zoomLevel:o.zoomLevel}),t=si(t,{dimension:e,displayPosition:o.position,zoomLevel:o.zoomLevel}),t}function $e(t,{documentMeta:e,dimension:o,displayPosition:i,zoomLevel:n}){const a=e.dimension;return c(()=>i*a+a/2+t/n*o/2)}function qe(t,{documentMeta:e,dimension:o,displayPosition:i,zoomLevel:n}){const a=e.dimension;return c(()=>(t-(i*a+a/2))*n/(o/2))}class ri{documentMeta;displayOptions;dimension;ctx;position;seed;isIntersecting(){const e=this.realPosition;return e.x>=0&&e.y>=0&&e.x<this.documentMeta.dimension.x&&e.y<this.documentMeta.dimension.y}constructor({dimension:e,position:o,ctx:i,documentMeta:n,displayOptions:a,seed:r}){this.dimension=e,this.position=o,this.ctx=i,this.documentMeta=n,this.displayOptions=a,this.seed=r||ci(0,1e6)}get normalizedPosition(){return de(this.position,{dimension:this.dimension})}get realPosition(){return this.positionToRealPosition(this.normalizedPosition)}normalizePosition(e){return de(e,{dimension:this.dimension})}unnormalizePosition(e){return ii(e,{dimension:this.dimension})}normalizeDimension(e){return me(e,{dimension:this.dimension})}unnormalizeDimension(e){return ni(e,{dimension:this.dimension})}positionToRealPosition(e){return $e(e,{documentMeta:this.documentMeta,dimension:this.dimension,displayPosition:this.displayOptions.position,zoomLevel:this.displayOptions.zoomLevel})}realPositionToPosition(e){return qe(e,{documentMeta:this.documentMeta,dimension:this.dimension,displayPosition:this.displayOptions.position,zoomLevel:this.displayOptions.zoomLevel})}dimensionToRealDimension(e){return Xe(e,{dimension:this.dimension,zoomLevel:this.displayOptions.zoomLevel})}fixedPosition(e){return Le(e,{documentMeta:this.documentMeta,dimension:this.dimension,displayOptions:this.displayOptions})}fixedDimension(e){return ai(e,{dimension:this.dimension,normalizedDimension:me(e,{dimension:this.dimension}),displayOptions:this.displayOptions})}fixedRealPosition(e){return Le(e,{documentMeta:this.documentMeta,displayOptions:this.displayOptions,dimension:this.dimension})}}function ci(t,e){return Math.floor(Math.random()*(e-t+1))+t}class li extends L{timer;holdEvent;constructor(e){super({...e,type:s.AIR_BRUSH,options:{...e.options,stackable:!0,round:!0}})}_pointerMove(e){super.pointerMove(e),this.action({...this.options},{event:e})}pointerMove(e){this.holdEvent=e}async pointerDown(e){await super.pointerDown(e),await this.app.actions.startStack(),this.timer=Ot(0,this.app.options.select.tool.airBrushInterval).subscribe(()=>{this._pointerMove(new ri({...e,...this.holdEvent,seed:void 0}))})}async pointerUp(e){this.timer&&(this.timer.unsubscribe(),this.timer=void 0,this.holdEvent=void 0),await super.pointerUp(e),await this.app.actions.stopStack()}}class pi{dimension=c(11,11);position=c(0,0);intersectMap;selected=!1;constructor(e){this.position=c(e.x,e.y)}intersect(e){const o=e.x<this.position.x+this.dimension.x&&e.x+this.dimension.x>this.position.x,i=e.y<this.position.y+this.dimension.y&&e.y+this.dimension.y>this.position.y;return o&&i}}var H=(t=>(t.START="start",t.MOVE="move",t.STOP="stop",t))(H||{});class fe extends L{startEvent;selectedAnchor;anchors;constructor(e){super({...e,options:{...e.options,stackable:!0}}),this.selectedAnchor=void 0,this.anchors=[]}async pointerDown(e){await super.pointerDown(e),this.startEvent=e}cancel(e){super.cancel(e),this.reset(e)}drawAnchors(e,o={stroke:!0}){this.anchors.forEach(i=>{this.drawAnchor(e,i,o)})}drawAnchor(e,o,{stroke:i}={stroke:!0}){e.ctx.lineWidth=1,e.ctx.fillStyle=this.app.options.select.color.secondaryColor.color.toHex(),(o===this.selectedAnchor||!i)&&(e.ctx.fillStyle=this.app.options.select.color.primaryColor.color.toInverted().toHex()),e.ctx.strokeStyle=`solid ${this.app.options.select.color.primaryColor.color.toHex()}`;const n=c(()=>Math.round(o.position-o.dimension/2));e.ctx.fillRect(n.x,n.y,o.dimension.x,o.dimension.y),e.ctx.strokeRect(n.x,n.y,o.dimension.x,o.dimension.y)}getAnchorByPosition(e){return this.anchors.find(o=>o.intersect(e)?o:!1)}addAnchor(e){const o=new pi(e);return this.anchors.push(o),o}reset(e){super.reset(e),this.anchors=[],this.selectedAnchor=void 0}}class di extends fe{lineWidth=2;started=!1;constructor(e){super({...e,type:s.STRAIGHT_LINE})}async pointerDown(e){if(await super.pointerDown(e),this.selectedAnchor){const o=this.getAnchorByPosition(e.position);o?this.selectedAnchor=o:(await this.app.actions.startStack(),await this.action({state:H.STOP,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(i=>e.normalizePosition(i.position))},{event:e}),await this.app.actions.stopStack(),this.reset(e))}else this.action({state:H.START,stackable:!1},{event:e}),this.started=!0;this.render(e)}async pointerMove(e){this.started&&(await super.pointerMove(e),this.domEvents?.pointerActive&&(this.anchors.length<1&&(this.addAnchor(e.position),this.selectedAnchor=this.addAnchor(e.position)),this.selectedAnchor&&(this.selectedAnchor.position=e.position),this.render(e),this.action({stackable:!1,state:H.MOVE,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(o=>e.normalizePosition(o.position))},{event:e})))}reset(e){super.reset(e),this.started=!1}render(e){e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),this.anchors.length>1&&this.drawAnchors(e)}}class mi extends fe{lineWidth=2;started=!1;primaryHelperOffset;secondaryHelperOffset;constructor(e){super({...e,type:s.CURVE_LINE})}async pointerUp(e){await super.pointerUp(e),this.anchors.length>1&&this.anchors.length!==4&&this.createHelpers(e),this.selectedAnchor=void 0}async pointerDown(e){await super.pointerDown(e);const o=this.getAnchorByPosition(e.position);if(o&&this.selectedAnchor!==o)this.selectedAnchor=o;else if(this.anchors.length===4&&!o){await this.app.actions.startStack(),await this.action({state:H.STOP,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(i=>e.normalizePosition(i.position))},{event:e}),await this.app.actions.stopStack(),this.reset(e);return}else this.anchors.length>1&&this.anchors.length!==4?this.createHelpers(e):this.selectedAnchor||(this.addAnchor(e.position),this.selectedAnchor=this.addAnchor(e.position),this.action({state:H.START,stackable:!1},{event:e}),this.started=!0);this.render(e)}async pointerMove(e){if(this.started&&(await super.pointerMove(e),this.domEvents?.pointerActive)){if(this.anchors.length<2&&(this.addAnchor(e.position),this.selectedAnchor=this.addAnchor(e.position)),this.selectedAnchor){let o=e.position;o=e.position,this.selectedAnchor.position=o,this.selectedAnchor===this.primaryAnchor&&this.primaryHelper?this.primaryHelper.position=this.primaryHelperOffset:this.selectedAnchor===this.secondaryAnchor&&this.secondaryHelper?this.secondaryHelper.position=c(()=>this.selectedAnchor.position+this.secondaryHelperOffset):(this.selectedAnchor===this.primaryHelper||this.selectedAnchor===this.secondaryHelper)&&this.refreshHelperOffset()}this.render(e),this.action({state:H.MOVE,stackable:!1,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(o=>e.normalizePosition(o.position))},{event:e})}}reset(e){super.reset(e),this.started=!1,this.primaryHelperOffset=void 0,this.secondaryHelperOffset=void 0}get primaryAnchor(){return this.anchors[0]}get secondaryAnchor(){return this.anchors[1]}get primaryHelper(){return this.anchors[2]}get secondaryHelper(){return this.anchors[3]}refreshHelperOffset(){this.primaryHelper&&(this.primaryHelperOffset=c(()=>this.primaryHelper.position-this.primaryAnchor.position)),this.secondaryHelper&&(this.secondaryHelperOffset=c(()=>this.secondaryHelper.position-this.secondaryAnchor.position))}createHelpers(e){let o=Ie(this.primaryAnchor,this.secondaryAnchor);this.addAnchor(c(o[0],o[1])),o=Ie(this.secondaryAnchor,this.primaryAnchor),this.addAnchor(c(o[0],o[1])),this.refreshHelperOffset(),this.render(e)}render(e){if(e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),this.anchors.length>1){const o=new Path2D;this.anchors.length>2?(o.moveTo(this.primaryAnchor.position.x,this.primaryAnchor.position.y),o.bezierCurveTo(this.primaryHelper.position.x,this.primaryHelper.position.y,this.secondaryHelper.position.x,this.secondaryHelper.position.y,this.secondaryAnchor.position.x,this.secondaryAnchor.position.y)):(o.moveTo(this.primaryAnchor.position.x,this.primaryAnchor.position.y),o.lineTo(this.secondaryAnchor.position.x,this.secondaryAnchor.position.y)),e.ctx.strokeStyle=this.app.options.select.color.primaryColor.color.toInverted().toHex(),e.ctx.lineWidth=this.lineWidth,e.ctx.stroke(o)}this.drawAnchors(e,{stroke:!1})}}function Ie(t,e){const o=hi(Math.round(t.position.x),Math.round(t.position.y),Math.round(e.position.x),Math.round(e.position.y));return o[Math.floor(o.length/4)]}function hi(t,e,o,i,n=0){const a=Math.abs(o-t),r=t<o?1:-1,l=Math.abs(i-e),d=e<i?1:-1;let m=(a>l?a:-l)/2;const I=[];let _=0;for(;n===0||_>=1?(I.push([t,e]),_=0):_+=1/n,!(t===o&&e===i);){const N=m;N>-a&&(m-=l,t+=r),N<l&&(m+=a,e+=d)}return I}class ui extends L{startEvent;bounds={position:c(0,0),dimension:c(0,0)};constructor(e){super({...e,type:s.RECTANGLE,options:{...e.options,stackable:!0,position:c(0,0),dimension:c(0,0)}})}async pointerUp(e){if(!this.startEvent)return;const o=this.bounds;this.startEvent=void 0,await this.app.actions.startStack(),await this.action({state:"STOP",position:e.normalizePosition(o.position),dimension:e.normalizeDimension(o.dimension)},{event:e}),await this.app.actions.stopStack(),this.reset(e)}async pointerDown(e){await super.pointerDown(e),this.startEvent=e,e.ctx.beginPath(),this.action({state:"START",stackable:!1,position:e.normalizePosition(this.bounds.position),dimension:e.normalizeDimension(this.bounds.dimension)},{event:e})}pointerMove(e){this.startEvent&&(this.bounds={position:this.startEvent.position,dimension:c(()=>e.position-this.startEvent.position)},this.action({state:"MOVE",stackable:!1,position:e.normalizePosition(this.bounds.position),dimension:e.normalizeDimension(this.bounds.dimension)},{event:e}))}reset(e){super.reset(e);const{ctx:o}=e;o.clearRect(0,0,o.canvas.width,o.canvas.height)}}class gi extends L{constructor(e){super({...e,type:s.STACK_REDO})}click(e,o){super.click(e,o),this.app.actions.stackRedo()}}class fi extends L{constructor(e){super({...e,type:s.STACK_UNDO})}click(e,o){super.click(e,o),this.app.actions.stackUndo()}}class yi extends L{constructor(e){super({...e,type:s.CLEAR,options:{...e.options,passive:!0}})}async click(e,o){super.click(e,o),await this.app.actions.startStack(),await this.app.workerManager.action({type:h.USE_TOOL,payload:{tool:this.type,toolOptions:this.options}}),await this.app.actions.stopStack()}}class Ye extends L{bounds={position:c(0,0),dimension:c(0,0)};startEvent;constructor(e){super({...e,type:s.ELLIPSE,options:{...e.options,stackable:!0,position:c(0,0),dimension:c(0,0)}})}async pointerUp(e){if(!this.startEvent)return;const o=this.bounds;this.startEvent=void 0,await this.app.actions.startStack(),await this.action({state:"STOP",position:e.normalizePosition(o.position),dimension:e.normalizeDimension(o.dimension)},{event:e}),await this.app.actions.stopStack(),this.reset(e)}async pointerDown(e){this.startEvent=e,e.ctx.beginPath(),this.action({state:"START",stackable:!1,position:e.normalizePosition(this.bounds.position),dimension:e.normalizeDimension(this.bounds.dimension)},{event:e})}actionTimeout;pointerMove(e){if(!this.startEvent)return;let o=c(()=>e.position-this.startEvent.position);this.options.square&&(o=c(o.x,Math.abs(o.x)*(o.y<0?-1:1))),this.bounds={position:this.startEvent.position,dimension:o},window.clearTimeout(this.actionTimeout),this.actionTimeout=window.setTimeout(()=>{this.action({state:"MOVE",stackable:!1,position:e.normalizePosition(this.bounds.position),dimension:e.normalizeDimension(this.bounds.dimension)},{event:e})},1e3/60)}reset(e){super.reset(e);const{ctx:o}=e;o.clearRect(0,0,o.canvas.width,o.canvas.height)}}class wi extends Ye{constructor(e){super({...e,type:s.CIRCLE,options:{...e.options,square:!0}})}}class Ai extends fe{lineWidth=2;subscription=new Te;started=!1;preComplete=!1;complete=!1;constructor(e){super({...e,type:s.POLYGON}),this.subscription.add(this.domEvents?.keyDown.subscribe(async o=>{this.startEvent&&(o.key===_e.BACKSPACE||o.key===_e.DELETE)&&(this.anchors=this.anchors.filter(i=>i!==this.selectedAnchor),this.render(this.startEvent))}))}destroy(){super.destroy(),this.subscription.unsubscribe()}async pointerDown(e){await super.pointerDown(e);const o=this.getAnchorByPosition(e.position);this.selectedAnchor?o?o!==this.selectedAnchor?(this.preComplete=!1,this.selectedAnchor=o):this.preComplete?(this.complete=!0,this.selectedAnchor=void 0,await this.app.actions.startStack(),await this.action({state:H.STOP,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(i=>e.normalizePosition(i.position)),complete:!0},{event:e}),await this.app.actions.stopStack(),this.reset(e)):o===o&&(this.preComplete=!0):this.complete||(this.selectedAnchor=this.addAnchor(e.position),this.action({stackable:!1,state:H.MOVE,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(i=>e.normalizePosition(i.position))},{event:e})):o?(this.preComplete=!1,this.selectedAnchor=o):(this.action({state:H.START,stackable:!1},{event:e}),this.selectedAnchor=this.addAnchor(e.position),this.started=!0),this.render(e)}async pointerMove(e){this.started&&(await super.pointerMove(e),this.domEvents?.pointerActive&&(this.selectedAnchor&&(this.selectedAnchor.position=e.position),this.render(e),this.action({stackable:!1,state:H.MOVE,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(o=>e.normalizePosition(o.position))},{event:e})))}reset(e){super.reset(e),this.started=!1,this.complete=!1,this.preComplete=!1}render(e){this.anchors.forEach(o=>{o.selected=this.selectedAnchor===o}),e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),this.drawAnchors(e,{stroke:!this.preComplete})}}class bi extends L{constructor(e){super({...e,type:s.FILL_TOOL,options:{...e.options,stackable:!0}})}async pointerDown(e){await super.pointerDown(e),await this.app.actions.startStack(),await this.action({},{event:e}),await this.app.actions.stopStack()}}const Si="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6%2018H2V16H6V18Z'%20/%3e%3cpath%20d='M12%208H14V10H12V18H10V0H12V8Z'%20/%3e%3cpath%20d='M18%2018H16V14H18V18Z'%20/%3e%3cpath%20d='M2%2016H0V2H2V16Z'%20/%3e%3cpath%20d='M8%2016H6V2H8V16Z'%20/%3e%3cpath%20d='M16%2014H14V10H16V14Z'%20/%3e%3cpath%20d='M16%208H14V4H16V8Z'%20/%3e%3cpath%20d='M18%204H16V0H18V4Z'%20/%3e%3cpath%20d='M6%202H2V0H6V2Z'%20/%3e%3c/svg%3e",_i="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M2%2018H0V16H2V18Z'%20/%3e%3cpath%20d='M18%2018H16V16H18V18Z'%20/%3e%3cpath%20d='M4%2016H2V14H4V16Z'%20/%3e%3cpath%20d='M16%2016H14V14H16V16Z'%20/%3e%3cpath%20d='M6%2014H4V12H6V14Z'%20/%3e%3cpath%20d='M14%2014H12V12H14V14Z'%20/%3e%3cpath%20d='M8%2012H6V10H8V12Z'%20/%3e%3cpath%20d='M12%2012H10V10H12V12Z'%20/%3e%3cpath%20d='M10%2010H8V8H10V10Z'%20/%3e%3cpath%20d='M8%208H6V6H8V8Z'%20/%3e%3cpath%20d='M12%208H10V6H12V8Z'%20/%3e%3cpath%20d='M6%206H4V4H6V6Z'%20/%3e%3cpath%20d='M14%206H12V4H14V6Z'%20/%3e%3cpath%20d='M4%204H2V2H4V4Z'%20/%3e%3cpath%20d='M16%204H14V2H16V4Z'%20/%3e%3cpath%20d='M2%202H0V0H2V2Z'%20/%3e%3cpath%20d='M18%202H16V0H18V2Z'%20/%3e%3c/svg%3e";function vi(t,e){const o=c(()=>Math.min(e.dimension,0)),i=c(()=>Math.round(e.position+o));return t.x>=i.x&&t.x<=i.x+Math.abs(e.dimension.x)&&t.y>=i.y&&t.y<=i.y+Math.abs(e.dimension.y)}class Ei extends L{bounds;color=new p(255,0,0,255);moving=!1;startEvent;lastEvent;moveOffset;constructor(e){super({...e,type:s.CROP,options:{...e.options,stackable:!0}})}cancel(e){this.reset(e)}images;async pointerDown(e){this.images=this.images||{apply:await $(Si),abort:await $(_i)};const o=this.bounds&&vi(e.position,this.bounds)||!1;this.isIntersectingButton(e,"apply")?(await this.app.actions.startStack(),this.action({state:"STOP",stackable:!0},{event:e}),await this.app.actions.stopStack(),this.reset(e)):this.isIntersectingButton(e,"abort")?(this.action({state:"ABORT",stackable:!0},{event:e}),this.reset(e)):this.bounds&&!this.moving&&o&&(this.moving=!0,this.action({state:"START",stackable:!1},{event:e})),this.moving?this.moveOffset=c(()=>e.position-this.bounds.position):(this.startEvent=e,this.lastEvent=void 0,await super.pointerDown(e)),this.render(e)}action(e,{event:o}){const i=c(()=>Math.min(this.bounds.dimension,0)),n=c(()=>this.bounds.position+i);return super.action({position:o.normalizePosition(n),dimension:o.normalizeDimension(c(()=>Math.abs(this.bounds.dimension))),cut:this.domEvents?.shiftActive||!1,...e},{event:o})}pointerMove(e){this.startEvent&&(this.moving?this.bounds.position=e.unnormalizePosition(e.fixedPosition(c(()=>e.position-this.moveOffset))):(this.bounds={position:e.unnormalizePosition(e.fixedPosition(this.startEvent.position)),dimension:e.unnormalizeDimension(e.fixedDimension(c(()=>e.position-this.startEvent.position)))},this.lastEvent=e),this.render(e),this.action({state:"MOVE",stackable:!1},{event:e}))}render(e){if(!this.bounds)return;const o=e.ctx;if(o.clearRect(0,0,o.canvas.width,o.canvas.height),o.strokeStyle=`dotted ${this.color.toHex()}`,o.lineWidth=1,o.setLineDash([6]),o.strokeRect(this.bounds.position.x,this.bounds.position.y,this.bounds.dimension.x,this.bounds.dimension.y),this.moving){o.fillStyle="white";const i=32,n=this.bounds.position.x+Math.max(this.bounds.dimension.x,0)-i,a=this.bounds.position.y+Math.max(this.bounds.dimension.y,0)-i;o.fillRect(n-i,a,i*2,i),this.images&&(o.drawImage(this.images.apply,n+(i-18)/2,a+(i-18)/2,18,18),o.drawImage(this.images.abort,n+(i-18)/2-i,a+(i-18)/2,18,18))}}isIntersectingButton(e,o="apply"){if(!this.bounds)return!1;let i=this.bounds.position.x+Math.max(this.bounds.dimension.x,0)-32;const n=this.bounds.position.y+Math.max(this.bounds.dimension.y,0)-32;return o==="abort"&&(i-=32),e.position.x>=i&&e.position.x<=i+32&&e.position.y>=n&&e.position.y<=n+32}reset(e){super.reset(e),this.bounds=void 0,this.moving=!1,this.startEvent=void 0,this.lastEvent=void 0,this.moveOffset=void 0}}class Ci extends L{lastColor;constructor(e){super({...e,interactingMove:!1,type:s.COLOR_PICKER})}cancel(e){this.reset(e)}async pointerDown(e){await super.pointerDown(e),this.lastColor&&this.app.options.select.color.primaryColor.setColor(this.lastColor)}async pointerMove(e){if(this.getDisplay()){const{payload:i}=await this.action({},{event:e}),n=e.ctx;n.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height);const{color:a,position:r}=i;i.color&&(this.lastColor=a,Di(n,c(10,10),{color:a,position:r}))}}reset(e){e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),this.lastColor=void 0,super.reset(e)}}function Di(t,e,o){t.fillStyle="#000",t.fillRect(e.x,e.y,188,32),t.fillStyle=o.color.toHex(),t.fillRect(e.x+6,e.y+6,20,20),t.fillStyle="#fff";const i=10,n=c(()=>e+c(32,4+i));t.font=`${i}px "BitFontCanvas"`,t.fontKerning="normal",t.letterSpacing="0px",t.fillText(`Color   : ${o.color.toHex()}`,n.x,n.y),t.fillText(`Position: ${o.position.x},${o.position.y}`,n.x,n.y+i+4)}class Li extends L{constructor(e){super({...e,type:s.ZOOM,options:{...e.options,passive:!0}})}async click(){const e=this.getDisplay();e&&(await Promise.all([e.actions.setPosition(c(0,0)),e.actions.setZoom(c(0,0),0)]),await e.action({type:h.ZOOM_FIT,payload:{}}))}}class Ii extends L{constructor(e){super({...e,type:s.GRID})}async click(e,o){super.click(e,o),await this.actions.openGridSettings()}}class ki extends L{constructor(e){super({...e,type:s.SPLIT_SCREEN})}async click(e,o){super.click(e,o);const{value:i}=await this.actions.prompt({type:"number",text:"Screen Count? (1-4)",value:1,min:1,max:4,size:1,step:1,required:!0});this.app.setDisplays(i)}}class xi extends je{constructor(e){super({...e,type:s.ERASER,options:{...e.options,replaceColor:!0}})}}class Ti extends Ze{constructor(e){super({...e,options:{...e.options,abstract:!0}})}async execute(e){this.options.stackable&&await this.app.actions.startStack(),await this.app.workerManager.action({type:h.USE_TOOL,payload:{tool:this.type,toolOptions:{...this.options,...e}}}),this.options.stackable&&await this.app.actions.stopStack()}action(e={}){const o={...this.options,...e};this.app.workerManager.action({type:h.USE_TOOL,payload:{tool:this.type,toolOptions:o}})}}class Ri extends Ti{constructor(e){super({...e,type:s.IMAGE_OPERATION,options:{stackable:!0}})}}const S={[s.NONE]:Ko,[s.ZOOM]:ei,[s.MAGNIFY]:ti,[s.CONTINUOUS_FREEHAND]:je,[s.STRAIGHT_LINE]:di,[s.CURVE_LINE]:mi,[s.DOTTED_FREEHAND]:Je,[s.AIR_BRUSH]:li,[s.RECTANGLE]:ui,[s.CIRCLE]:wi,[s.ELLIPSE]:Ye,[s.POLYGON]:Ai,[s.STACK_REDO]:gi,[s.STACK_UNDO]:fi,[s.FILL_TOOL]:bi,[s.CROP]:Ei,[s.CLEAR]:yi,[s.ZOOM_FIT]:Li,[s.COLOR_PICKER]:Ci,[s.GRID]:Ii,[s.SPLIT_SCREEN]:ki,[s.ERASER]:xi},Pi={[s.IMAGE_OPERATION]:Ri};function Bi(t){switch(t){case s.IMAGE_OPERATION:return Pi[s.IMAGE_OPERATION];default:throw new Error(`Tool ${t} is not implemented.`)}}function cn(t){switch(t){case s.NONE:return S[s.NONE];case s.ZOOM:return S[s.ZOOM];case s.MAGNIFY:return S[s.MAGNIFY];case s.CONTINUOUS_FREEHAND:return S[s.CONTINUOUS_FREEHAND];case s.DOTTED_FREEHAND:return S[s.DOTTED_FREEHAND];case s.STRAIGHT_LINE:return S[s.STRAIGHT_LINE];case s.CURVE_LINE:return S[s.CURVE_LINE];case s.AIR_BRUSH:return S[s.AIR_BRUSH];case s.RECTANGLE:return S[s.RECTANGLE];case s.CIRCLE:return S[s.CIRCLE];case s.ELLIPSE:return S[s.ELLIPSE];case s.POLYGON:return S[s.POLYGON];case s.FILL_TOOL:return S[s.FILL_TOOL];case s.CROP:return S[s.CROP];case s.STACK_REDO:return S[s.STACK_REDO];case s.STACK_UNDO:return S[s.STACK_UNDO];case s.CLEAR:return S[s.CLEAR];case s.ZOOM_FIT:return S[s.ZOOM_FIT];case s.COLOR_PICKER:return S[s.COLOR_PICKER];case s.SPLIT_SCREEN:return S[s.SPLIT_SCREEN];case s.GRID:return S[s.GRID];case s.ERASER:return S[s.ERASER];default:throw new Error(`Tool ${t} is not implemented.`)}}const Ke=[{group:"Web & Screen",formats:[{name:"Default",dimension:{x:800,y:600}},{name:"VGA",dimension:{x:640,y:480}},{name:"SVGA",dimension:{x:800,y:600}},{name:"XGA",dimension:{x:1024,y:768}},{name:"HD (720p)",dimension:{x:1280,y:720}},{name:"Full HD (1080p)",dimension:{x:1920,y:1080}},{name:"QHD (1440p)",dimension:{x:2560,y:1440}},{name:"2K (DCI)",dimension:{x:2048,y:1080}},{name:"4K (UHD)",dimension:{x:3840,y:2160}},{name:"4K (DCI)",dimension:{x:4096,y:2160}},{name:"5K",dimension:{x:5120,y:2880}},{name:"8K (UHD)",dimension:{x:7680,y:4320}},{name:"WUXGA",dimension:{x:1920,y:1200}},{name:"Ultrawide (21:9)",dimension:{x:2560,y:1080}},{name:"Ultrawide+ (21:9)",dimension:{x:3440,y:1440}}]},{group:"Web Banners (Common Sizes)",formats:[{name:"Full x Hero",dimension:{x:1920,y:600}},{name:"Large Leaderboard",dimension:{x:970,y:250}},{name:"Leaderboard",dimension:{x:728,y:90}},{name:"Billboard",dimension:{x:800,y:250}},{name:"Medium Rectangle",dimension:{x:300,y:250}},{name:"Large Rectangle",dimension:{x:336,y:280}},{name:"Skyscraper",dimension:{x:120,y:600}},{name:"Wide Skyscraper",dimension:{x:160,y:600}},{name:"Half Page Ad",dimension:{x:300,y:600}},{name:"Mobile Leaderboard",dimension:{x:320,y:50}}]},{group:"Icons & Favicons",formats:[{name:"Small Icon (16x16)",dimension:{x:16,y:16}},{name:"Favicon (32x32)",dimension:{x:32,y:32}},{name:"Standard Icon (48x48)",dimension:{x:48,y:48}},{name:"Large Icon (64x64)",dimension:{x:64,y:64}},{name:"App Icon (128x128)",dimension:{x:128,y:128}},{name:"High-Res Icon (256x256)",dimension:{x:256,y:256}},{name:"Social Profile (512x512)",dimension:{x:512,y:512}}]},{group:"Retro Gaming (Nintendo Game Boy)",formats:[{name:"Game Boy / GBC",dimension:{x:160,y:144}},{name:"Game Boy Advance",dimension:{x:240,y:160}}]},{group:"Pixel Art",formats:[{name:"Tiny Sprite (8x8)",dimension:{x:8,y:8}},{name:"Small Sprite (16x16)",dimension:{x:16,y:16}},{name:"Medium Sprite (32x32)",dimension:{x:32,y:32}},{name:"Large Sprite (64x64)",dimension:{x:64,y:64}},{name:"Small Scene (128x128)",dimension:{x:128,y:128}},{name:"Medium Scene (256x256)",dimension:{x:256,y:256}}]},{group:"Print (ISO 216 / A-Serie)",formats:[{name:"A0",dimension:{x:841,y:1189}},{name:"A1",dimension:{x:594,y:841}},{name:"A2",dimension:{x:420,y:594}},{name:"A3",dimension:{x:297,y:420}},{name:"A4",dimension:{x:210,y:297}},{name:"A5",dimension:{x:148,y:210}}]},{group:"Print (US Standard)",formats:[{name:"Letter",dimension:{x:216,y:279}},{name:"Legal",dimension:{x:216,y:356}},{name:"Tabloid",dimension:{x:279,y:432}}]},{group:"Common Aspect Ratios & Custom",formats:[{name:"Square (1:1)",dimension:{x:1e3,y:1e3}},{name:"Custom",dimension:{x:800,y:600}}]}],ln=Ke[0].formats[0],Oi=At(({core:t})=>{let e,o,i,n,a,r,l,d,m,I,_,N;const{t:T}=ge();return[{meta:[[G.SYMBOL,he.WEB_PAINT]],id:"WebPaint.app",name:"Web Paint",createdDate:new Date(2017,7,5).getTime(),editedDate:new Date(2025,5,29).getTime(),async action(){const g=t.addExecution();if(!t.modules.screen?.contentLayout)throw new Error("Content layout not found");const F=new Xo({options:{select:{brush:ze(),tool:Ge(),color:Ve()},display:{colors:{background:p.fromHex(t.config.get(E.WEB_PAINT_DISPLAY_BACKGROUND)),foreground:p.fromHex(t.config.get(E.WEB_PAINT_DISPLAY_FOREGROUND))},grid:{color:p.fromHex(t.config.get(E.WEB_PAINT_PIXEL_GRID_COLOR)),lineWidth:t.config.get(E.WEB_PAINT_PIXEL_GRID_LINE_WIDTH),visibleCount:t.config.get(E.WEB_PAINT_PIXEL_GRID_VISIBLE_COUNT)}}}},t.config),f=wt({fsItem:void 0,app:F,actions:gt(F)}),oe=f.app;await oe.setup(),await oe.workerManager.ready.then(async()=>{oe.setDocument(So(Ke[4].formats[2]))}),g();const ie=t.modules.windows.addWindow({component:await b(()=>import("./DRnnhBLv.js"),__vite__mapDeps([2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,1,45,46,47,48,49,50,51,52,53]),import.meta.url).then(k=>k.default),componentData:{core:t,model:f},options:{title:T("window.general.title"),embed:!0,borderless:!0}},{group:"extras13WebPaint",full:!0});f.actions.setTheme(Yo),ie.awaitClose().then(()=>{[e,i,n,a,r,l,d,m,I,_,N].forEach(k=>k?.close()),t.modules.screen?.setTheme(void 0)});function gt(k){const we={setTheme:u=>{t.config.get(E.WEB_PAINT_NATIVE_THEME)&&t.modules.screen?.currentTheme?t.modules.screen.setTheme(qo(t.modules.screen.currentTheme)):t.modules.screen?.setTheme(u)},import:async u=>{k.setDocument(await wo(u))},export:async u=>{const P=await b(()=>import("./CshrRwMP.js").then(C=>C.F),__vite__mapDeps([54,1]),import.meta.url).then(C=>C.default);try{const C=await k.getImageData();let O=await Se(C);u.resize&&(O=await kt(O,u.resize.x,u.resize.y));const ne=await O.convertToBlob({type:u.type,quality:u.quality}),ft=u.type.split("/")[1]||"png",yt=(u.filename||`webpainting_${Date.now()}`)+`.${ft}`;await P.saveAs(ne,yt)}catch(C){console.error("An error occurred during export.",C)}},importClipboard:async()=>{const u=["image/png","image/jpeg","image/webp","image/gif"],C=(await navigator.clipboard.read()).find(O=>O.types.find(ne=>u.includes(ne)));if(C){const O=await C?.getType(C.types[0]);k.setDocument(await Ao(O))}},clipboardCopy:async()=>{const u=await k.getImageData(),C=await(await Se(u)).convertToBlob({type:"image/png"});await navigator.clipboard.write([new ClipboardItem({"image/png":C})])},importDocument:async u=>f.app.importDocument(u),exportDocument:async()=>{if(!k.currentDocument)return;const u=k.currentDocument.name,P=await k.exportDocument(k.currentDocument);return(await b(()=>import("./CshrRwMP.js").then(O=>O.F),__vite__mapDeps([54,1]),import.meta.url).then(O=>O.default)).saveAs(P,`${Mt(new Date)}_${Ft(u)}.wpd`)},useAbstractTool:(u,P)=>{const C=Bi(u);if(!C)throw new Error(`Tool ${u} is not implemented`);return new C({app:k,actions:we}).execute(P)},openValueInput:u=>ye(u),async prompt(u){return(await ye(u)).awaitClose()},openInfo:()=>tt(f),openNewDocument:()=>it(f),openSettings:()=>et(f),openExport:()=>lt(f),close:()=>{ie?.close()},focus:()=>{ie?.focus()},newDocument:async u=>{f.fsItem=void 0,await k.setDocument(new Y({name:u?.name||"New Document",meta:{colors:{background:p.fromHex(t.config.get(E.WEB_PAINT_DOCUMENT_BACKGROUND))},dimension:u?.dimension||c(640,480)}}))},openDocument:async()=>{await Mi(t,f)},openHelp:()=>ot(),saveDocument:async()=>{await ke(t,f)},saveAsDocument:async()=>{await ke(t,f,!0)},documentResize:async u=>{const{payload:P}=await k.actions.resize(u);P&&f.app.currentDocument&&f.app.currentDocument?.setDimension(P.dimension)},documentResizeCanvas:async u=>{const{payload:P}=await k.actions.resizeCanvas(u);P&&f.app.currentDocument&&f.app.currentDocument.setDimension(P.dimension)},openDocumentResize:()=>mt(t,f),openDocumentResizeCanvas:()=>ht(t,f),openDocumentSettings:()=>ut(t,f),openColorPalette:()=>nt(t,f),openColorPicker:u=>ct(u),openGridSettings:()=>st(t,f),openInsertImage:u=>at(t,f,u),openImageSharpness:()=>rt(),openDebugColorPickers:()=>pt(),openDebugColorPicker:()=>dt()};return we}}}];async function et(g){return a||(a=t.modules.windows.addWindow({component:await b(()=>import("./NpjbJe0L.js"),__vite__mapDeps([55,26,4,5,27,56,57,58,59,60,61,62,28,3,6,7,29,63,64,65,66,67,68,69,70,71,11,18,17,19,16,20,21,37,38,39,40,41,42,12,13,10,43,44,36,1,45,46,24,47,48,49,50,51,52,72]),import.meta.url).then(w=>w.default),componentData:{model:g},options:{title:T("window.settings.title")}},{group:"extras13WebPaint"}),a.awaitClose().then(()=>{a=void 0}),a)}async function ye(g){return N||(N=t.modules.windows.addWindow({component:await b(()=>import("./C1BFwIiJ.js"),__vite__mapDeps([73,26,4,5,27,64,57,58,65,74]),import.meta.url).then(w=>w.default),componentData:{...g},options:{title:T("window.value_input.title"),embed:!0,center:!0,borderless:!0,filled:!0}},{group:"extras13WebPaint"}),N.awaitClose().then(()=>{N=void 0}),N)}async function tt(g){return e||(e=t.modules.windows.addWindow({component:await b(()=>import("./DwmuoBLz.js"),__vite__mapDeps([75,76,3,4,5,6,7,77,78]),import.meta.url).then(w=>w.default),componentData:{model:g},options:{title:T("window.info.title")}},{group:"extras13WebPaint"}),e.awaitClose().then(()=>{e=void 0}),e)}async function ot(){return o||(o=t.modules.windows.addWindow({component:await b(()=>import("./C1Ql79V5.js"),__vite__mapDeps([79,76,3,4,5,6,7,77,80]),import.meta.url).then(g=>g.default),componentData:{},options:{title:T("window.help.title"),scrollY:!0,scale:!0},layout:{size:c(360,280)}},{group:"extras13WebPaint"}),o.awaitClose().then(()=>{o=void 0}),o)}async function it(g){return i||(i=t.modules.windows.addWindow({component:await b(()=>import("./-oOCArvC.js"),__vite__mapDeps([81,26,4,5,27,68,69,70,71,82,57,58,83,64,65,76,3,6,7,77,11,18,17,19,16,20,21,37,38,39,40,41,42,12,13,10,43,44,36,1,45,46,24,47,48,49,50,51,52,84]),import.meta.url).then(w=>w.default),componentData:{model:g},options:{title:T("window.new_document.title")}},{group:"extras13WebPaint"}),i.awaitClose().then(()=>{i=void 0}),i)}async function nt(g,w){return m||(m=g.modules.windows.addWindow({component:await b(()=>import("./C3_arNxO.js"),__vite__mapDeps([85,4,5,26,27,68,69,70,71,82,57,58,83,28,3,6,7,29,22,15,11,10,23,17,19,16,20,24,18,21,25,37,38,39,40,41,42,12,13,43,44,36,1,45,46,47,48,49,50,51,52,86]),import.meta.url).then(F=>F.default),componentData:{core:g,model:w},options:{title:T("window.color_palette.title"),filled:!0}},{group:"extras13WebPaint"}),m.awaitClose().then(()=>{m=void 0}),m)}async function st(g,w){return r||(r=g.modules.windows.addWindow({component:await b(()=>import("./Ds_9MjU1.js"),__vite__mapDeps([87,26,4,5,27,66,57,58,59,60,67,64,65,62,28,3,6,7,29,63,68,69,70,71,11,18,17,19,16,20,21,37,38,39,40,41,42,12,13,10,43,44,36,1,45,46,24,47,48,49,50,51,52,88]),import.meta.url).then(F=>F.default),componentData:{core:g,model:w},options:{title:T("window.grid_settings.title")}},{group:"extras13WebPaint"}),r.awaitClose().then(()=>{r=void 0}),r)}async function at(g,w,F){return l||(l=g.modules.windows.addWindow({component:await b(()=>import("./w5dx6wz8.js"),__vite__mapDeps([89,26,4,5,27,64,57,58,65,82,83,68,69,70,71,90,91,11,12,13,3,6,7,18,17,19,16,20,21,37,38,39,40,41,42,10,43,44,36,1,45,46,24,47,48,49,50,51,52,92]),import.meta.url).then(f=>f.default),componentData:{core:g,model:w,blob:F},options:{title:T("window.insert_image.title")}},{group:"extras13WebPaint"}),l.awaitClose().then(()=>{l=void 0}),l)}async function rt(){return d||(d=t.modules.windows.addWindow({component:await b(()=>import("./pyJXcLcS.js"),__vite__mapDeps([93,26,4,5,27,64,57,58,65,68,69,70,71,3,6,7,11,18,17,19,16,20,21,37,38,39,40,41,42,12,13,10,43,44,36,1,45,46,24,47,48,49,50,51,52,94]),import.meta.url).then(g=>g.default),componentData:{},options:{title:T("window.image_sharpness.title"),filled:!0}},{group:"extras13WebPaint"}),d.awaitClose().then(()=>{d=void 0}),d)}async function ct(g){return m||(m=t.modules.windows.addWindow({component:await b(()=>import("./DNu4xERN.js"),__vite__mapDeps([95,96,11,4,5,97,82,57,58,83,64,65,26,27,68,69,70,71,3,6,7,18,17,19,16,20,21,37,38,39,40,41,42,12,13,10,43,44,36,1,45,46,24,47,48,49,50,51,52,98]),import.meta.url).then(w=>w.default),componentData:{color:g},options:{title:T("window.color_picker.title"),filled:!0}},{group:"extras13WebPaint"}),m.awaitClose().then(()=>{m=void 0}),m)}async function lt(g){return n||(n=t.modules.windows.addWindow({component:await b(()=>import("./HH2gEuxu.js"),__vite__mapDeps([99,11,26,4,5,27,64,57,58,65,82,83,68,69,70,71,3,6,7,18,17,19,16,20,21,37,38,39,40,41,42,12,13,10,43,44,36,1,45,46,24,47,48,49,50,51,52,100]),import.meta.url).then(w=>w.default),componentData:{model:g},options:{title:T("window.export_document.title")}},{group:"extras13WebPaint"}),n.awaitClose().then(()=>{n=void 0}),n)}async function pt(){return I||(I=t.modules.windows.addWindow({component:await b(()=>import("./6XNQL8lN.js"),__vite__mapDeps([101,96,11,4,5,97,64,57,58,65,3,6,7,18,17,19,16,20,21,37,38,39,40,41,42,12,13,10,43,44,36,1,45,46,24,47,48,49,50,51,52,102]),import.meta.url).then(g=>g.default),componentData:{},options:{title:"Debug Color Pickers",scrollY:!0}},{group:"extras13WebPaint"}),I.awaitClose().then(()=>{I=void 0}),I)}async function dt(){return _||(_=t.modules.windows.addWindow({component:await b(()=>import("./DNu4xERN.js"),__vite__mapDeps([95,96,11,4,5,97,82,57,58,83,64,65,26,27,68,69,70,71,3,6,7,18,17,19,16,20,21,37,38,39,40,41,42,12,13,10,43,44,36,1,45,46,24,47,48,49,50,51,52,98]),import.meta.url).then(g=>g.default),componentData:{},options:{title:"Debug Color Picker",filled:!0}},{group:"extras13WebPaint"}),_.awaitClose().then(()=>{_=void 0}),_)}async function mt(g,w){return g.modules.windows.addWindow({component:await b(()=>import("./C8JhhZaP.js"),__vite__mapDeps([103,11,26,4,5,27,64,57,58,65,82,83,68,69,70,71,3,6,7,18,17,19,16,20,21,37,38,39,40,41,42,12,13,10,43,44,36,1,45,46,24,47,48,49,50,51,52,104]),import.meta.url).then(f=>f.default),componentData:{model:w},options:{title:T("window.document_resize.title")}},{group:"extras13WebPaint"})}async function ht(g,w){return g.modules.windows.addWindow({component:await b(()=>import("./DcZLzrFo.js"),__vite__mapDeps([105,11,26,4,5,27,64,57,58,65,68,69,70,71,90,91,3,6,7,18,17,19,16,20,21,37,38,39,40,41,42,12,13,10,43,44,36,1,45,46,24,47,48,49,50,51,52,106]),import.meta.url).then(f=>f.default),componentData:{model:w},options:{title:T("window.document_resize_canvas.title")}},{group:"extras13WebPaint"})}async function ut(g,w){return g.modules.windows.addWindow({component:await b(()=>import("./Dyyg_CrM.js"),__vite__mapDeps([107,26,4,5,27,62,57,58,28,3,6,7,29,63,64,65,68,69,70,71,11,18,17,19,16,20,21,37,38,39,40,41,42,12,13,10,43,44,36,1,45,46,24,47,48,49,50,51,52,108]),import.meta.url).then(f=>f.default),componentData:{model:w},options:{title:T("window.document_settings.title")}},{group:"extras13WebPaint"})}});async function ke(t,e,o=!1){const{payload:i}=await e.app.actions.getLayers(),n=1024*1024;i.layers.reduce((d,m)=>{if(d+m.buffer.byteLength>n)throw new Error("Document size exceeds the maximum allowed size of 1 MB.");return d+m.buffer.byteLength},0);const a=await Promise.all(i.layers.map(async d=>{const{buffer:m,dimension:I}=d;return{...d,dataUri:await xt(Qe(m,I))}}));let r=Object.assign({[q.OUTPUT_TYPE]:Fi,[q.CONTENT]:{...e.app.currentDocument.toJSON(),layers:a}});r=await btoa(JSON.stringify(r));let l;return!o&&e.fsItem?(l=await Tt(t,{path:e.fsItem.getPath(),data:r}),l?await t.executeCommand('openDialog "File saved."'):await t.executeCommand('openDialog "File could not be saved."'),l):(e.fsItem=await Rt(t,{data:r,extension:"wpd"}),e.fsItem)}async function Mi(t,e){const o=await t.executeCommand("openFileDialog");if(o)if(q.CONTENT in o.value){const{name:i,meta:n,layers:a}=o.value[q.CONTENT],r=await Promise.all(a.map(async l=>{const d=await Pe(await $(l.dataUri)),m={...l};return delete m.dataUri,{...m,imageBitmap:d.transferToImageBitmap()}}));e.app.setDocument(new Y({name:i,meta:n,layers:r}))}else throw new Error("Can't read file content")}const Fi="webPaintDocument",Ui=bt(async({core:t})=>{const[e]=(await Promise.all([b(()=>import("./CgKHepJx.js"),[],import.meta.url)])).map(o=>o.default||o);return t.config.setDefaults(Qt()),t.modules.symbols?.addSymbols([{key:he.WEB_PAINT,component:await b(()=>import("./DZtr8k2A.js"),__vite__mapDeps([109,4,5]),import.meta.url).then(o=>o.default),group:"disk_web_paint"}]),{meta:[[G.SYMBOL,Ae.DISK_2],[G.WINDOW_SYMBOL_REARRANGE,!0],[G.VISIBLE,!0]],name:"Web Paint",items:[{id:"Readme.md",name:"Readme",data:{type:"markdown",content:e,fontSize:16},meta:[[G.POSITION,{x:90,y:5}],[G.IGNORE_SYMBOL_REARRANGE,!0],[G.SYMBOL,Ae.LARGE_NOTE_RICH]]},...await Oi({core:t})]}}),pn=Object.freeze(Object.defineProperty({__proto__:null,default:Ui},Symbol.toStringTag,{value:"Module"}));export{y as B,E as C,tn as D,Qo as F,Wo as I,Ut as O,q as P,Vo as R,j as S,s as T,h as W,an as a,v as b,on as c,nn as d,A as e,p as f,sn as g,ri as h,M as i,R as j,cn as k,Qt as l,ln as m,Ke as n,Go as o,zo as p,No as q,J as r,rn as s,Yo as t,ge as u,Wt as v,pn as w};
