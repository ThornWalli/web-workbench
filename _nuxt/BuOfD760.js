const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CL5Hp3VC.js","./00wGeTvv.js","./BrpFI5cJ.js","./C0_snZds.js","./D_5a1Xw6.js"])))=>i.map(i=>d[i]);
var Zt=Object.defineProperty;var It=n=>{throw TypeError(n)};var Jt=(n,e,t)=>e in n?Zt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var g=(n,e,t)=>Jt(n,typeof e!="symbol"?e+"":e,t),vt=(n,e,t)=>e.has(n)||It("Cannot "+t);var f=(n,e,t)=>(vt(n,e,"read from private field"),t?t.call(n):e.get(n)),y=(n,e,t)=>e.has(n)?It("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),v=(n,e,t,s)=>(vt(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t);import{g as W}from"./C0_snZds.js";import{a as ft,E as L,I as w,e as x,d as N,k as qt,f as at,g as Qt,r as Wt,h as Rt,j as en,S as V,l as qe,m as j,n as ge,C as tn,o as nn,p as G,s as Y,q as sn,t as an,u as rn,v as ht,w as on,c as ln,x as cn}from"./Bk_zE6I5.js";import{v as Pt}from"./Ch9TGLTe.js";import{f as _t}from"./CMn89ocD.js";import{V as me,I as D,r as Qe,a8 as Tt,_ as te,t as I,v as F,x as k,G as dn,Y as un,g as S,z as _,A as q,C as X,F as B,L as $,$ as rt,a0 as ot,y as lt,H as et}from"./DhVLdAEy.js";import{c as mn,a as Nt}from"./C5mdboMC.js";import{C as fn,u as fe,M as Be}from"./D9s5NzWA.js";import{g as hn}from"./Cpj98o6Y.js";import{W as pn,b as Xe,d as Ge,c as Bt,a as gn}from"./Bl7v0_lh.js";import{W as Te}from"./B0ueQ7OP.js";import{A as xn}from"./CD8Wqi-R.js";const wn=W(0,0);class St{constructor({title:e,sidebarComponent:t,sidebarComponentData:s,component:i,componentData:a,options:r,symbolWrapper:c,wrapper:o,layout:l,parentWindow:d}){g(this,"events",new ft);g(this,"id",Pt());g(this,"component");g(this,"componentData");g(this,"sidebarComponent");g(this,"sidebarComponentData");g(this,"parentWindow");g(this,"options",me({title:"Unnamed",scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0,clampX:!0,clampY:!1,freeze:!1,focused:!1,center:!0,close:!0,overlay:!0,embed:!1,borderless:!1,hideRootHeader:!1,sidebar:!0}));g(this,"symbolWrapper",null);g(this,"group",null);g(this,"wrapper",null);g(this,"layout",me({focused:!1,position:W(0,0),size:wn,scrollOffset:W(0,0)}));this.options.title=e,this.parentWindow=d,t&&(this.sidebarComponent=D(t)),s&&(this.sidebarComponentData=D(s)),this.component=D(i),this.componentData={...a,window:this},c&&(this.symbolWrapper=D(c)),o&&(this.wrapper=D(o)),this.options=Object.assign(this.options,r),this.layout=Object.assign(this.layout,l)}ready(){this.options.ready=!0,this.events.next(new L("ready"))}focus(){this.options.focused=!0,this.events.next(new L("focus"))}unfocus(){this.options.focused=!1,this.events.next(new L("unfocus"))}close(e){this.wrapper&&(this.events.next(new L("close",e)),this.wrapper.remove(this.id),this.wrapper=null)}setWrapper(e){this.wrapper=D(e)}setGroup(e){this.group=e}awaitClose(){return new Promise(e=>{const t=this.events.pipe(_t(({name:s})=>s==="close")).subscribe((...s)=>{t.unsubscribe(),e(...s)})})}awaitReady(){return new Promise(e=>{if(this.options.ready)e();else{const t=this.events.pipe(_t(({name:s})=>s==="ready")).subscribe((...s)=>{t.unsubscribe(),e(...s)})}})}}const ee={CENTER:0,ORDER_HORIZONTAL:1,ORDER_VERTICAL:2,ORDER_DIAGONAL_LEFT:3,ORDER_DIAGONAL_RIGHT:4,SPLIT_HORIZONTAL:5,SPLIT_VERTICAL:6,FULL:7};class xs{constructor(e,t=[]){g(this,"events",new ft);g(this,"id",Pt());g(this,"core");g(this,"layout",{size:W(0,0),position:W(0,0)});g(this,"groups",new Map);g(this,"modelMap",new Map);g(this,"models",Qe([]));g(this,"activeWindow",Qe(null));this.core=e,t.forEach(s=>this.add(s))}getActiveWindow(){return this.models.value.find(e=>e.options.focused)}setActiveWindow(e){this.models.value.forEach(t=>{t.options.focused=e===t.id,e===t.id&&(this.activeWindow.value=t,this.events.next(new L("setActiveWindow",t)))})}hasEmbbedWindow(){return!!this.models.value.find(e=>e.options.embed)}isHeaderVsible(){return!this.models.value.find(e=>e.options.embed&&e.options.hideRootHeader)}add(e,t){const{full:s,active:i,group:a}={full:!1,active:!0,group:null,...t};if(e instanceof St||(e=new St(e)),e.setWrapper(this),s&&(e.layout.size=this.layout.size),a){let r;this.groups.has(a)?(r=this.groups.get(a),r.windows.push(e)):(r={primary:e,windows:[],name:a},this.groups.set(a,r)),e.setGroup(r)}return e.layout.zIndex=this.models.value.length,this.models.value.push(e),this.events.next(new L("add",e)),this.modelMap.set(e.id,e),i&&this.setActiveWindow(e.id),e}remove(e){typeof e=="string"&&(e=this.get(e)),e.group&&(e.group.primary===e?(e.group.windows.forEach(t=>t.close()),this.groups.delete(e.group.name)):e.group.primary.focus()),this.models.value.splice(this.models.value.indexOf(e),1),this.modelMap.delete(e.id)}get(e){return this.modelMap.get(e)}clear(){this.models=Qe([].splice(0,this.models.value.length)),this.modelMap.clear()}setWindowUpDown(e,t){const s=this.models.value,i=Array.from(s).filter(o=>!o.options.embed).sort((o,l)=>o.layout.zIndex-l.layout.zIndex).map(Tt),a=this.get(e),r=i.indexOf(a),c=i[t?r-1:r+1];if(c){const o=a.layout.zIndex;a.layout.zIndex=c.layout.zIndex,c.layout.zIndex=o}}centerWindow(e){typeof e=="string"&&(e=this.get(e)),ct(e,this.layout)}setWindowPositions(e,t=[],s){const{embed:i}={embed:!1,...s};switch(t.length<1&&t.push(...this.models.value),i||(t=t.filter(a=>!a.options.embed)),e){case ee.FULL:t.forEach(a=>{bn(a,this.layout)});break;case ee.CENTER:t.forEach(a=>{ct(a,this.layout)});break;case ee.ORDER_DIAGONAL_LEFT:case ee.ORDER_DIAGONAL_RIGHT:yn(t,this.layout,ee.ORDER_DIAGONAL_RIGHT===e);break;case ee.SPLIT_HORIZONTAL:case ee.SPLIT_VERTICAL:In(t,this.layout,ee.SPLIT_VERTICAL===e);break}}saveSize(e,t){if(this.get(e).symbolWrapper&&this.get(e).symbolWrapper.fsItem){const s=this.get(e).symbolWrapper.fsItem;s.meta.set(w.WINDOW_SIZE,t),this.core.modules.files.fs.saveItem(s)}}savePosition(e,t){if(this.get(e).symbolWrapper&&this.get(e).symbolWrapper.fsItem){const s=this.get(e).symbolWrapper.fsItem;s.meta.set(w.WINDOW_POSITION,t),this.core.modules.files.fs.saveItem(s)}}}function bn(n,e){n.layout.size=e.size}function ct(n,e){n.layout.position=W(()=>(e.size-n.layout.size)/2)}function yn(n,e,t){const s=1/n.length;n.forEach((i,a)=>{ct(i,e),a=-Math.floor(n.length/2)+a;const r=W(i.layout.position.x+(t?-1:1)*(s*i.layout.size.x)*a,i.layout.position.y+s*i.layout.size.y*a),c=W(()=>e.size-i.layout.size);i.layout.position=W(()=>Math.max(Math.min(r,c),0))})}function In(n,e,t){let s;const i=n.length;t?(s=W(e.size.x,e.size.y/i),n.forEach((a,r)=>{a.layout.position=W(0,r*s.y),a.layout.size=s})):(s=W(e.size.x/i,e.size.y),n.forEach((a,r)=>{a.layout.position=W(r*s.x,0),a.layout.size=s}))}class vn{constructor(e){g(this,"items",[]);g(this,"itemsMapping",new Map);g(this,"key");this.key=e}add(e){e.forEach(t=>{[].concat(t[this.key]).forEach(s=>{this.itemsMapping.set(s,t)})}),this.items.push(...e)}remove(e){e.forEach(t=>{this.items.splice(this.items.indexOf(t),1)})}has(e){return this.itemsMapping.has(e)}get(e){return this.itemsMapping.get(e)}}class _n extends vn{constructor(){super("name")}}const Sn=new _n;var ve,_e,oe,Se;class En{constructor({name:e,description:t,args:s,action:i}){y(this,ve);y(this,_e);y(this,oe,[]);y(this,Se);v(this,ve,[].concat(e)),v(this,_e,t),v(this,oe,s||f(this,oe)),v(this,Se,i)}action(...e){return f(this,Se).call(this,...e)}get description(){return f(this,_e)}get name(){return f(this,ve)}get args(){return f(this,oe)}}ve=new WeakMap,_e=new WeakMap,oe=new WeakMap,Se=new WeakMap;function Dn(n){return n.map(e=>new En(e))}function ws(n,e){return n.args.reduce((t,s)=>{const i=[].concat(s.name);i.length<1&&(i.push=`argument-${s.index}`);const a=mn(s.name[0]);if("index"in s&&s.index!==void 0&&Number(s.index)in e.args){const r=s.index;let c=e.args[Number(r)];c=c===void 0?!0:c,t[Number(r)]=c,t.unresolved[Number(r)]=e.unresolved.args[Number(r)],t[String(a)]=c,t.unresolved[String(a)]=e.unresolved.args[Number(r)]}return i.forEach(r=>{if(r in e.kwargs){const c=e.kwargs[String(r)];t[String(a)]=c===void 0?!0:c,t.unresolved[String(a)]=e.kwargs[String(r)]===void 0?!0:c}}),t},{unresolved:{}})}var Ee,De,Ae,Ce;class p{constructor({name:e,index:t,flag:s,description:i}){y(this,Ee);y(this,De);y(this,Ae);y(this,Ce);v(this,Ee,[].concat(e)),v(this,De,t),v(this,Ae,s),v(this,Ce,i)}get name(){return f(this,Ee)}get index(){return f(this,De)}get flag(){return f(this,Ae)}get description(){return f(this,Ce)}}Ee=new WeakMap,De=new WeakMap,Ae=new WeakMap,Ce=new WeakMap;class An{constructor({config:e={},commands:t,contextMenu:s=null,core:i}){g(this,"commands",[]);g(this,"contextMenu",[]);g(this,"config",{});g(this,"core");this.core=i,this.config=e,this.commands=t,this.contextMenu=s}beforeSetup(){const e=this.core;e.config.setDefaults(this.config),typeof this.commands=="function"&&(this.commands=Dn(this.commands({core:e,module:this})),Sn.add(this.commands)),typeof this.contextMenu=="function"&&(this.contextMenu=new fn(this.contextMenu,{core:e,module:this}),this.core.modules.windows.contextMenu.addDefaultItems(this.contextMenu))}setup(){this.log(this.name)}destroy(){this.core.removeCommands(this.commands)}log(e){this.core.logger.add(e,{namespace:this.constructor.NAME})}get name(){return this.constructor.NAME}}var le,ne,Me,K,Lt;let pt=(Lt=class{constructor(e){y(this,le,!1);y(this,ne);y(this,Me);y(this,K,{});e=Object.assign({locked:f(this,le),storage:void 0,name:void 0},e),v(this,le,e.locked),v(this,ne,e.storage),v(this,Me,e.name)}get locked(){return f(this,le)}get name(){return f(this,Me)}get storage(){return f(this,ne)}get data(){return f(this,K)}set data(e){v(this,K,e)}mount(){return new Promise(e=>{e(this)})}unmount(){return new Promise(e=>{e(this)})}load(){if(!f(this,ne))throw new Error("no storage");return Promise.resolve(f(this,K))}save(e){if(!f(this,ne))throw new Error("no storage");return v(this,K,e||f(this,K)),Promise.resolve(f(this,K))}},le=new WeakMap,ne=new WeakMap,Me=new WeakMap,K=new WeakMap,Lt);var ie;class jt{constructor(){y(this,ie,new Map)}getItem(e){return f(this,ie).get(e)}setItem(e,t){f(this,ie).set(e,t)}removeItem(e){f(this,ie).delete(e)}clear(){f(this,ie).clear()}}ie=new WeakMap;class Cn extends pt{constructor(e){e=Object.assign({storage:new jt},e),super(e)}}class $t extends pt{mount(){return new Promise(e=>{try{let t;try{if(t=this.storage.getItem(this.name),t){if(t=JSON.parse(t),!t||!(t instanceof Object))throw new Error("json invalid")}else throw new Error("json invalid")}catch(s){console.error(s),t={}}this.storage.setItem(this.name,JSON.stringify(t)),e(this)}catch(t){throw new Error(t)}})}load(){return new Promise(e=>{if(this.storage)try{this.data=JSON.parse(this.storage.getItem(this.name)),e(this.data)}catch(t){throw new Error(t)}})}save(e){return new Promise(t=>{if(this.storage)try{this.data=e||this.data,this.storage.setItem(this.name,JSON.stringify(this.data)),t(this.data)}catch(s){throw new Error(s)}})}}class Mn extends $t{constructor(e){e=Object.assign({storage:window.localStorage},e),super(e)}}class Fn extends $t{constructor(e){e=Object.assign({storage:window.sessionStorage||new jt},e),super(e)}}class zt extends pt{}const P={NONE:0,AUTO:1,TEMP:3,LOCAL:4,SESSION:5,CLOUD:6};function On(n){switch(n){case P.TEMP:return Cn;case P.LOCAL:return Mn;case P.SESSION:return Fn;case P.CLOUD:return zt;default:return Storage}}var R,se;const He=class He extends N{constructor(t){t=Object.assign({},t);super(t);y(this,R,new Map);y(this,se,qt(1));this.addItems(t.items||f(this,R)),v(this,se,t.maxSize||f(this,se))}async export(...t){const s=await N.prototype.export.apply(this,...t);return delete s.data,s.items=await Promise.all(Array.from(f(this,R).values()).map(i=>i.export())),s}async addItems(t,s=!1){return t instanceof Map&&(t=Array.from(t.values())),t=t.map(i=>(typeof i.data=="string"&&(i.data=at(i.data)),i)),t=this.parseItems(t),Promise.all(t.map(i=>this.addItem(i,s)))}static normalizeItemData(t){const s=[];return"items"in t&&!(t.items instanceof Map)&&(t.items=new Map(t.items.map(i=>[i.id,i]))),"info"in t&&(t.meta=[t.info],delete t.info,s.push("info")),"extension"in t&&(t.id+="."+t.extension,delete t.extension,s.push("extension")),"createTime"in t&&(t.createdDate=t.createTime,delete t.createTime,s.push("createTime")),"editTime"in t&&(t.editedDate=t.editTime,delete t.editTime,s.push("editTime")),"icon"in t&&(delete t.icon,s.push("icon")),s.length&&console.warn("@deprecated TODO: muss weg, hier werden die alten Items angepasst.",t,s),t}parseItems(t){return t.map(s=>{s=He.normalizeItemData(s);let i;return s.type?i=tt(s.type):s.items?i=tt("Directory"):i=tt(),new i(s)})}async addItem(t,s=!1){const i=t.parent;if(!s&&this.hasItem(t.id))throw new Error(`File ${t.id} exists`);if(i&&await i.removeItem(t),s){const a=Qt(t.id),r=Wt(t.id);t.setId(Rt(en(r,this,a),a))}return f(this,R).set(t.id,t),t.setParent(this),t.events.next(new L("move",{item:t,lastParent:i})),this.events.next(new L("addItem",t)),t}removeItem(t){return t.setParent(null),f(this,R).delete(t.id),this.events.next(new L("removeItem",t)),Promise.resolve()}async remove(t){const{recursive:s}=Object.assign({recursive:!1},t);if(s){let i=await this.getItems();return i=await Promise.all(Array.from(i.values()).map(a=>a.remove(t))),i=i.reduce((a,r)=>a.concat(r),[]),i.push(await N.prototype.remove.apply(this,[t])),i}else{if((await this.getItems()).size>0)throw new Error(x.get("FileSystemItem_itemContainerNotEmpty",await this.getPath()));return[await N.prototype.remove.apply(this,arguments)]}}changeItemId(t,s,i){f(this,R).delete(s),f(this,R).set(i,t),this.parent&&console.log("changeItemId by parent",s,i,this.parent.items)}getItems(){return Promise.resolve(f(this,R))}getItem(t){return f(this,R).get(t)}hasItem(t){return f(this,R).has(t)}get items(){return f(this,R)}get size(){return Array.from(f(this,R).values()).reduce(function(t,s){return s instanceof He||(t+=s.size),t},0)}get maxSize(){return t(this);function t(s){return s.parent&&f(s,se)?t(s.parent):f(s,se)}}};R=new WeakMap,se=new WeakMap;let A=He;x.add([["FileSystemItem_itemContainerNotEmpty",["ItemWrapp Not Empty","ItemContainer not empty… %1"]]]);class gt extends A{constructor(e){e=Object.assign({},e,{locked:!0,id:"ROOT"}),super(e)}}g(gt,"NAME","Root");var st,Z;let Q=(st=class extends A{constructor(t){t=Object.assign({storage:null},t,{locked:!0});super(t);y(this,Z);v(this,Z,t.storage)}get storage(){return f(this,Z)}get locked(){return f(this,Z).locked}mount(...t){return f(this,Z).mount(...t)}unmount(...t){return f(this,Z).unmount(...t)}async save(){return f(this,Z).save(await this.export())}},Z=new WeakMap,g(st,"NAME","Storage"),st);class $e extends Q{constructor(...e){super(...e),this.meta.set(w.VISIBLE,!1)}}g($e,"NAME","TmpDisk"),g($e,"SYMBOL",V.TMP_DISK);class ze extends Q{}g(ze,"NAME","RamDisk"),g(ze,"SYMBOL",V.RAM_DISK);class xt extends A{}g(xt,"NAME","FloppyDisk");class Ve extends Q{}g(Ve,"NAME","HardDisk"),g(Ve,"SYMBOL",V.HARD_DISK);class Ue extends Q{isLogged(){return this.storage.storage.isLogged()}}g(Ue,"NAME","CloudDisk"),g(Ue,"SYMBOL",V.CLOUD_DISK);class ae extends A{constructor(...e){super(...e),[w.WINDOW_SCALE,w.WINDOW_SCROLL_X,w.WINDOW_SCROLL_Y].forEach(t=>{this.meta.has(t,!0)||this.meta.set(t,!0)})}}g(ae,"NAME","Directory"),g(ae,"SYMBOL",V.DIRECTORY);class z extends A{}g(z,"NAME","Trashcan"),g(z,"SYMBOL",V.TRASHCAN);class Ke extends N{}g(Ke,"NAME","File");var ce;class wt extends N{constructor(t){t=Object.assign({refPath:null},t);super(t);y(this,ce);v(this,ce,t.refPath)}get refPath(){return f(this,ce)}set refPath(t){v(this,ce,t)}}ce=new WeakMap,g(wt,"NAME","Link");var Fe,H,T,Oe,de;const M=class M{constructor(e){y(this,Fe);y(this,H);y(this,T);y(this,Oe,new Map);y(this,de,new ft);v(this,Fe,e),this.setup()}get root(){return f(this,H)}setup(){v(this,H,new gt),v(this,T,f(this,H));const e=[this.addStorage(M.RAM_DISK_TITLE,P.SESSION,{id:M.RAM_DISK_NAME}),this.addStorage(M.HARD_DISK_NAME,P.LOCAL,{trashcan:!0}),this.addStorage(M.TMP_DISK_TITLE,P.TEMP,{id:M.TMP_DISK_NAME,trashcan:!1})];return Promise.all(e).catch(t=>{throw t})}createTmpFile(e,t,s,i){return this.createRootFile(`TMP:${e}`,t,s,i)}createRootDir(e,t,s){const i=`${e}`;return this.makedir(i,t,Object.assign({},s,{override:!0}))}createRootFile(e,t,s,i){typeof t=="object"&&(s=t,t=null);const a=`${e}`;return this.makefile(a,t,s,Object.assign({},i,{override:!0}))}async get(e,t){if(e instanceof N)return e;if(qe(e))try{return await this.parsePath(e)}catch(s){if(t)return new N({name:j(e)});throw s}else throw x.get("FileSystem_pathInvalid",j(e),ge(e))}async parsePath(e){let t=e,s=f(this,T);const i=e.match(/^([^:\\/]+):(.*)$/);if(i?(s=f(this,H).getItem(i[1]),t=i[2]):t[0]==="/"?(t=t.slice(1),s=f(this,T).getStorageItem()):t==="ROOT"&&(s=f(this,H),t=""),t&&t.length>0&&(s=ut(t.split("/"),s)),s)return s;throw x.get("FileSystem_pathInvalid",e,await f(this,T).getBase())}async addFloppyDisk(e){typeof e=="function"&&(e=e());const t=await e;return this.addStorage(t)}async removeFloppyDisk(e){await e.remove(!0)}async addStorage(e,t=P.NONE,s){s=Object.assign({id:null},s);let i;typeof t=="function"&&(i=t,t=P.CLOUD);const a={id:this.getFreeSlot(M.PREFIX.FLOPPY_DISK),itemClass:xt};let r={};if(typeof e=="object"){const c=e;a.name=c.name,a.items=c.items,a.meta=Array.from(new Map([[w.SYMBOL,V.DISK_1]].concat(c.meta||[])))}else{switch(t){case P.SESSION:a.id=M.PREFIX.RAM,a.itemClass=ze;break;case P.TEMP:a.id=M.PREFIX.TMP,a.itemClass=$e;break;case P.LOCAL:a.id=this.getFreeSlot(M.PREFIX.HARD_DISK),a.itemClass=Ve;break;case P.CLOUD:a.id=this.getFreeSlot(M.PREFIX.CLOUD_DISK),a.itemClass=Ue;break}a.id=s.id||a.id,i=await this.registerStorage(a.id,i||t).mount(s);const c=await i.load();r=A.normalizeItemData(c),a.storage=i,P.NONE!==t&&(a.name=r.name||e)}return(a.meta=a.meta||[]).push(...r.meta||[]),this.addDisk(Object.assign(r,a),s)}removeStorage(e){return e.unmount().then(()=>(f(this,de).next(new L("removeStorage",{itemStorage:e})),e))}registerStorage(e,t){let s;typeof t=="function"?s=t:s=On(t);const i=`${f(this,Fe)}_${e}`,a=new s({id:e,name:i});return f(this,Oe).set(i,a),a}connect(e,t){return this.addStorage(tn,e,t).then(s=>s).catch(s=>{throw s})}async disconnect(e){return e=await this.removeStorage(e),e.remove({silent:!0,recursive:!0}),e}addDisk({id:e,name:t,meta:s,items:i,itemClass:a,storage:r},c){c=Object.assign({trashcan:!1},c),c.trashcan&&(!i||i&&!i.has(z.NAME))&&(i=i||new Map,i.set(z.NAME,{type:z.NAME,id:z.NAME,name:z.NAME}));const o=a;if(!o)throw new Error("ItemClass is empty!");const l=new o({id:e,name:t,meta:s,items:i,storage:r});return f(this,H).addItem(l),f(this,de).next(new L("addDisk",{id:e,item:l})),l}get currentItem(){return f(this,T)}get events(){return f(this,de)}get storages(){return f(this,Oe)}getFreeSlot(e){let t=0;for(;f(this,H).hasItem(`${e}${t}`);)t++;return`${e}${t}`}async exist(e){try{return!!await this.get(e)}catch(t){return console.error(t),!1}}async changeDirectory(e){const t=await this.get(e);return v(this,T,t),this.events.next(new L("changeDirectory",t)),t}async makedir(e,t,s){const{ignore:i,meta:a}=Object.assign({ignore:!1,override:!1,meta:[]},s);let r;e&&nn(e)&&e!==t?r=await this.get(ge(e)):r=f(this,T);const c=new ae({id:j(e),name:t||"",createdDate:Date.now(),meta:a});if(await G(r),i||!r.getItem(c.id))r.addItem(c,i),this.events.next(new L("writeItem",c));else throw x.get("FileSystem_fileExist",c.id);return await Y(r),c}async makefile(e,t,s,i){const{override:a,meta:r}=Object.assign({override:!1,meta:[]},i),c=new Ke({id:j(e),name:t,data:s,meta:r,createdDate:Date.now()});if(!qe(e))throw x.get("FileSystem_invalidPath",e);let o=sn(e);const l=an(e);o===l&&(o=".");let d;if(rn(o)?d=await this.get(o):f(this,T).id!=="ROOT"?d=await this.get(ht(await f(this,T).getPath(),o)):d=await this.get(o),d.hasItem(l))if(a)await d.getItem(l).remove(),d.addItem(c);else throw x.get("FileSystem_fileExist",c.id);else d.addItem(c),this.events.next(new L("writeItem",c));return await Y(d),c}async editfile(e,t){const s=await this.get(e).then(G);return await G(s),s.data=t,Y(s)}async editfileMeta(e,t,s){const i=await this.get(e);return Array.isArray(t)?t.map(a=>({name:a[0],value:a[1]})):i.meta.set(t,s),Y(i)}async saveItem(e){const t=await this.get(e);return Y(t)}async makelink(e,t=null){const s=await this.get(e);await G(s);const i=f(this,T),a=new wt({id:Wt(s.id)+".ref",name:`${t||s.name}`,refPath:await s.getPath(),createdDate:Date.now()});return await i.addItem(a),await Y(s),a}async editlink(e,t){const s=await this.get(e);await G(s);const i=await this.get(t);return s.refPath=await i.getPath(),Y(s)}async rename(e,t,{name:s=!1,removeName:i=!1}){let a;if(e instanceof N)a=e;else if(qe(e)||typeof e=="string")a=await this.get(e);else throw x.get("FileSystem_pathInvalid",ge(e),e);return await G(a),i&&(s=!0,t=null),await a.rename(t,{ignore:!0,name:s}),Y(a)}async copy(e,t,s){const{ignore:i}=Object.assign({ignore:!1},s);let a,r,c;if(e instanceof N?(r=e,a=e.id):(r=await this.get(e),a=j(e)),t instanceof N)t instanceof A||(t=t.parent),c=t;else{a=j(t);const l=await this.get(t,!0);if(l instanceof A?a=j(e):l.parent?c=l.parent:c=await this.get(ge(t)),!(c instanceof A))throw new TypeError("no ItemContainer")}await G(r);const o=await r.copy();if(i||!c.getItem(a))o.rename(a),c.addItem(o,i),this.events.next(new L("copyItem",o));else throw x.get("FileSystem_fileExist",a);return Y(o)}async move(e,t,{override:s=!1}){let i,a,r;if(e instanceof N)a=e,i=e.id;else{if(a=await this.get(e),a instanceof Q)throw x.get("FileSystem_cantMoveStorage",a.displayName);i=j(e)}if(t instanceof N)t instanceof A||(t=t.parent),r=t;else{if(i=j(t),r=await this.get(t),r instanceof A)i=j(e);else return this.get(ge(t));if(!(r instanceof A))throw new TypeError("no ItemContainer")}let c;if(await G(a),s||!await r.getItem(i))c=a.getStorageItem(),await a.rename(i),await r.addItem(a,s),this.events.next(new L("moveItem",a));else throw x.get("FileSystem_fileExist",a.id,i);return await Y(a),c?c.save().then(()=>a):a}async remove(e,t,s){const{ignore:i}=Object.assign({ignore:!1},s),a=await this.get(e);await G(a);try{const r=await on(t,a);return r[r.length-1].storage&&await r[r.length-1].storage.save(),r}catch(r){if(!i)throw new Error(r)}}};Fe=new WeakMap,H=new WeakMap,T=new WeakMap,Oe=new WeakMap,de=new WeakMap,g(M,"PREFIX",{FLOPPY_DISK:"DF",TMP:"TMP",RAM:"RAM",HARD_DISK:"HD",CLOUD_DISK:"CD"}),g(M,"TMP_DISK_NAME","TMP"),g(M,"TMP_DISK_TITLE","TMP DISK"),g(M,"RAM_DISK_NAME","RAM"),g(M,"RAM_DISK_TITLE","RAM DISK"),g(M,"HARD_DISK_NAME","HARD DISK");let dt=M;function ut(n,e){const t=n.shift();if(t===void 0)return e;if(t===".."){if(e.parent)return e.parent}else if(t==="."||t==="")return ut(n,e);if(e){const s=e.getItem(t);return n.length>0&&s instanceof A?ut(n,s):s}}const Ln=[ae,z,Q,$e,ze,Ve,xt,Ue,wt,Ke].reduce((n,e)=>(n[e.NAME]=e,n),{});function tt(n){return Ln[String(n)]||Ke}x.add([["FileSystem_invalidPath",["Invalid File",'Invalid path "%1"']],["FileSystem_invalidFile",["Invalid File",'Invalid file… "%1"']],["FileSystem_fileExist",["File Ready",'File already exists… "%1"']],["FileSystem_pathInvalid",["Path Invalid",'Path invalid… "%1"; base: "%2"']],["FileSystem_itemInvalid",["Item Invalid",'Item id invalid… "%1" from "%2"']],["FileSystem_cantMoveStorage",["Can't Move",`Can't move Storage "%1"`]],["FileSystem_permissionsNeeded",["Permissions needed","Permissions needed"]]]);var kn=({onlyFirst:n=!1}={})=>{const e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,n?void 0:"g")};const Wn=kn;var Rn=n=>typeof n=="string"?n.replace(Wn(),""):n,bt={exports:{}},Vt={exports:{}};(function(n){var e=function(){function t(o,l,d,u){typeof l=="object"&&(d=l.depth,u=l.prototype,l.filter,l=l.circular);var m=[],h=[],E=typeof Buffer<"u";typeof l>"u"&&(l=!0),typeof d>"u"&&(d=1/0);function O(b,pe){if(b===null)return null;if(pe==0)return b;var C,U;if(typeof b!="object")return b;if(t.__isArray(b))C=[];else if(t.__isRegExp(b))C=new RegExp(b.source,c(b)),b.lastIndex&&(C.lastIndex=b.lastIndex);else if(t.__isDate(b))C=new Date(b.getTime());else{if(E&&Buffer.isBuffer(b))return Buffer.allocUnsafe?C=Buffer.allocUnsafe(b.length):C=new Buffer(b.length),b.copy(C),C;typeof u>"u"?(U=Object.getPrototypeOf(b),C=Object.create(U)):(C=Object.create(u),U=u)}if(l){var yt=m.indexOf(b);if(yt!=-1)return h[yt];m.push(b),h.push(C)}for(var Ze in b){var Je;U&&(Je=Object.getOwnPropertyDescriptor(U,Ze)),!(Je&&Je.set==null)&&(C[Ze]=O(b[Ze],pe-1))}return C}return O(o,d)}t.clonePrototype=function(l){if(l===null)return null;var d=function(){};return d.prototype=l,new d};function s(o){return Object.prototype.toString.call(o)}t.__objToStr=s;function i(o){return typeof o=="object"&&s(o)==="[object Date]"}t.__isDate=i;function a(o){return typeof o=="object"&&s(o)==="[object Array]"}t.__isArray=a;function r(o){return typeof o=="object"&&s(o)==="[object RegExp]"}t.__isRegExp=r;function c(o){var l="";return o.global&&(l+="g"),o.ignoreCase&&(l+="i"),o.multiline&&(l+="m"),l}return t.__getRegExpFlags=c,t}();n.exports&&(n.exports=e)})(Vt);var Pn=Vt.exports,Tn=Pn,Nn=function(n,e){return n=n||{},Object.keys(e).forEach(function(t){typeof n[t]>"u"&&(n[t]=Tn(e[t]))}),n},Bn=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],jn=Nn,xe=Bn,Ut={nul:0,control:0};bt.exports=function(e){return Yt(e,Ut)};bt.exports.config=function(n){return n=jn(n||{},Ut),function(t){return Yt(t,n)}};function Yt(n,e){if(typeof n!="string")return Et(n,e);for(var t=0,s=0;s<n.length;s++){var i=Et(n.charCodeAt(s),e);if(i<0)return-1;t+=i}return t}function Et(n,e){return n===0?e.nul:n<32||n>=127&&n<160?e.control:$n(n)?0:1+(n>=4352&&(n<=4447||n==9001||n==9002||n>=11904&&n<=42191&&n!=12351||n>=44032&&n<=55203||n>=63744&&n<=64255||n>=65040&&n<=65049||n>=65072&&n<=65135||n>=65280&&n<=65376||n>=65504&&n<=65510||n>=131072&&n<=196605||n>=196608&&n<=262141))}function $n(n){var e=0,t=xe.length-1,s;if(n<xe[0][0]||n>xe[t][1])return!1;for(;t>=e;)if(s=Math.floor((e+t)/2),n>xe[s][1])e=s+1;else if(n<xe[s][0])t=s-1;else return!0;return!1}var zn=bt.exports,Vn=Rn,Un=zn,Ht=function(n){return Un(Vn(n))},re={},J=Ht;function Ye(n,e){return Array.apply(null,{length:e+1}).join(n).slice(0,e)}function Yn(n,e,t){n=n??"",n=String(n);var s=e-J(n);return s<=0?n:n+Ye(t||" ",s)}function Hn(n,e,t){n=n??"",n=String(n);var s=e-J(n);if(s<=0)return n;var i=Math.floor(s/2),a=s-i;return Ye(t||" ",i)+n+Ye(t||" ",a)}function Xn(n,e,t){n=n??"",n=String(n);var s=e-J(n);return s<=0?n:Ye(t||" ",s)+n}function Gn(n,e){function t(s,i){return s.trim().split(" ").reduce(function(a,r){var c=a[a.length-1];return c&&J(c.join(" "))+J(r)<i?a[a.length-1].push(r):a.push([r]),a},[]).map(function(a){return a.join(" ")})}return n.split(`
`).map(function(s){return t(s,e)}).reduce(function(s,i){return s.concat(i)},[])}function Kn(n,e,t){n=n.trim();for(var s=[],i=n.split(" "),a="",r=J(t);a||i.length;){if(a){var c=a;a=""}else var c=i.shift();if(J(c)>e){for(var o=0,l=0,d=e-r;o<c.length;){var u=J(c.charAt(o));if(u+l>d)break;l+=u,++o}a=c.slice(o),c=c.slice(0,o),c+=t}s.push(c)}return s.join(" ")}function Zn(n,e){if(n=n??"",n=String(n),e==1/0)return n;for(var t=0,s=0;t<n.length;){var i=J(n.charAt(t));if(i+s>e)break;s+=i,++t}return n.slice(0,t)}re.padRight=Yn;re.padCenter=Hn;re.padLeft=Xn;re.splitIntoLines=Gn;re.splitLongWords=Kn;re.truncateString=Zn;var nt=Ht,he=re,Jn=he.padRight,qn=he.padCenter,Qn=he.padLeft,Dt=he.splitIntoLines,ei=he.splitLongWords,ti=he.truncateString,Xt=function(e){return e.toUpperCase()},ni=function(e,t,s){return e},ii=Object.freeze({maxWidth:1/0,minWidth:0,columnSplitter:" ",truncate:!1,truncateMarker:"…",preserveNewLines:!1,paddingChr:" ",showHeaders:!0,headingTransform:Xt,dataTransform:ni}),si=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.config||{};delete e.config;var s=e.maxLineWidth||1/0;s==="auto"&&(s=process.stdout.columns||1/0),delete e.maxLineWidth,e=At({},ii,e),e.config=e.config||Object.create(null),e.spacing=e.spacing||`
`,e.preserveNewLines=!!e.preserveNewLines,e.showHeaders=!!e.showHeaders,e.columns=e.columns||e.include;var i=e.columns||[];n=li(n,i),i.length||n.forEach(function(o){for(var l in o)i.indexOf(l)===-1&&i.push(l)});var a=i.reduce(function(o,l){var d=Object.create(e);return o[l]=At(d,t[l]),o},Object.create(null));i.forEach(function(o){var l=a[o];l.name=o,l.maxWidth=Math.ceil(l.maxWidth),l.minWidth=Math.ceil(l.minWidth),l.truncate=!!l.truncate,l.align=l.align||"left"}),n=n.map(function(o){var l=Object.create(null);return i.forEach(function(d){l[d]=o[d]!=null?o[d]:"",l[d]=""+l[d],a[d].preserveNewLines?l[d]=l[d].replace(/[^\S\n]/gmi," "):l[d]=l[d].replace(/\s/gmi," ")}),l}),i.forEach(function(o){var l=a[o];n=n.map(function(d,u){var m=Object.create(l);d[o]=l.dataTransform(d[o],m,u);var h=Object.keys(m);if(h.indexOf("name")!==-1){if(l.headingTransform!==Xt)return;l.headingTransform=function(E){return E}}return h.forEach(function(E){return l[E]=m[E]}),d})});var r={};e.showHeaders&&(i.forEach(function(o){var l=a[o];if(!l.showHeaders){r[o]="";return}r[o]=l.headingTransform(l.name)}),n.unshift(r)),i.forEach(function(o){var l=a[o];l.width=n.map(function(d){return d[o]}).reduce(function(d,u){return d>=l.maxWidth?d:Math.max(d,Math.min(l.maxWidth,Math.max(l.minWidth,nt(u))))},0)}),i.forEach(function(o){var l=a[o];n=n.map(function(d){return d[o]=ei(d[o],l.width,l.truncateMarker),d})}),i.forEach(function(o){var l=a[o];n=n.map(function(d,u){var m=d[o];if(d[o]=Dt(m,l.width),l.truncate&&d[o].length>1){d[o]=Dt(m,l.width-nt(l.truncateMarker));var h=d[o][0];oi(h,l.truncateMarker)||(d[o][0]+=l.truncateMarker),d[o]=d[o].slice(0,1)}return d})}),i.forEach(function(o){var l=a[o];l.width=n.map(function(d){return d[o].reduce(function(u,m){return u>=l.maxWidth?u:Math.max(u,Math.min(l.maxWidth,Math.max(l.minWidth,nt(m))))},0)}).reduce(function(d,u){return d>=l.maxWidth?d:Math.max(d,Math.min(l.maxWidth,Math.max(l.minWidth,u)))},0)});var c=ai(n,a,i,e.paddingChr);return c.reduce(function(o,l){return o.concat(l.reduce(function(d,u){return d.concat(u.join(e.columnSplitter))},[]))},[]).map(function(o){return ti(o,s)}).join(e.spacing)};function ai(n,e,t,s){return n.map(function(i){var a=[],r=0;t.forEach(function(l){r=Math.max(r,i[l].length)});for(var c=function(d){a[d]=a[d]||[],t.forEach(function(u){var m=e[u],h=i[u][d]||"";m.align==="right"?a[d].push(Qn(h,m.width,s)):m.align==="center"||m.align==="centre"?a[d].push(qn(h,m.width,s)):a[d].push(Jn(h,m.width,s))})},o=0;o<r;o++)c(o);return a})}function At(){return Object.assign?Object.assign.apply(Object,arguments):ri.apply(void 0,arguments)}function ri(n,e){if(n==null)throw new TypeError("Cannot convert first argument to object");for(var t=Object(n),s=!1,i,a=1;a<arguments.length;a++){var r=arguments[a];if(r!=null){for(var c=Object.keys(Object(r)),o=0,l=c.length;o<l;o++){var d=c[o];try{var u=Object.getOwnPropertyDescriptor(r,d);u!==void 0&&u.enumerable&&(t[d]=r[d])}catch(m){s||(s=!0,i=m)}}if(s)throw i}}return t}function oi(n,e,t){t=t||n.length,t=t-e.length;var s=n.lastIndexOf(e);return s!==-1&&s===t}function li(n,e){if(Array.isArray(n))return n;var t=[];for(var s in n){var i={};i[e[0]||"key"]=s,i[e[1]||"value"]=n[s],t.push(i)}return t}const ci=hn(si);var Le,ke,We,ue;class je{constructor(e){y(this,Le,0);y(this,ke,!0);y(this,We,[]);y(this,ue,[]);const{showHeader:t,headerPadding:s,columns:i}=Object.assign({showHeader:!0,headerPadding:0,columns:[]},e);v(this,ke,t),v(this,Le,s),this.addColumn(i)}addColumn(e){Array.isArray(e)?f(this,ue).push(...[].concat(e)):f(this,ue).push(Object.assign({value:null,align:"left",minWidth:0,maxWidth:0,spacerChar:" "},e))}addRow(e){f(this,We).push(...[].concat(e))}static createSpacer(e,t,s){if(e.length<t){t=t-e.length;for(let i=0;i<t;i++)e+=s}return e}get columns(){return f(this,ue)}get rows(){return f(this,We)}get showHeader(){return f(this,ke)}get headerPadding(){return f(this,Le)}toColumnify(){const e=this.columns.map(i=>i.value),t=this.rows.reduce((i,a,r)=>(r<1&&this.showHeader&&this.headerPadding&&i.push(...Array(this.headerPadding).fill("")),i.push(this.columns.reduce((c,o,l)=>(c[o.value]=a[Number(l)],c),{})),i),[]),s=this.columns.reduce((i,a)=>(i[a.value]={},a.align&&(i[a.value].align=a.align),a.minWidth&&(i[a.value].minWidth=a.minWidth),a.maxWidth&&(i[a.value].maxWidth=a.maxWidth),i[a.value].headingTransform=r=>r,i),{});return ci(t,{showHeaders:this.showHeader,preserveNewLines:!0,config:s,columns:e}).replace(/\xC2/g," ")}}Le=new WeakMap,ke=new WeakMap,We=new WeakMap,ue=new WeakMap;function Is(n){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","\n":`&nbsp;
`," ":"&nbsp;"};return n.replace(/[&<>"'\n ]/g,function(t){return e[String(t)]})}function di(n,e,t,s=" "){if(n.length<e)for(let i=n.length;i<=e-1;i++)t?n=s+n:n=n+s;return n}function Ie(n){return n>2e3?(n=parseInt(n/1e3),n>1e3?(n=parseInt(n/1e3),n>1e3?(n=parseInt(n/1e3),`${n}g`):`${n}m`):`${n}k`):`${n}b`}function mt(n,e){const t=new Date(e),s=[[/y/g,`${t.getFullYear()}`.slice(2)],[/Y/g,t.getFullYear()],[/dd/g,Ct(t.getDate())],[/d/g,t.getDate()],[/DD/g,Ct(t.getDate())],[/D/g,we(t.getDate())],[/mm/g,Mt(t.getMonth(),!0)],[/m/g,t.getMonth()+1],[/MM/g,Mt(t.getMonth()+1,!1)],[/M/g,we(t.getMonth()+1)],[/h/g,t.getHours()],[/H/g,we(t.getHours())],[/i/g,t.getMinutes()],[/I/g,we(t.getMinutes())],[/s/g,t.getSeconds()],[/S/g,we(t.getSeconds())]];return s.forEach((i,a)=>{n=n.replace(i[0],`%${a}%`)}),s.forEach((i,a)=>{n=n.replace(`%${a}%`,i[1])}),n}const ui=[["Sunday","Sun"],["Monday","Mon"],["Tuesday","Tue"],["Wednesday","Wed"],["Thursday","Thu"],["Friday","Fri"],["Saturday","Sat"]];function Ct(n){return ui[String(n)]}const mi=[["Januar","Jan"],["February","Feb"],["March","Mar"],["April","Apr"],["May"],["June"],["July"],["August","Aug"],["September","Sept"],["October","Oct"],["November","Nov"],["December","Dec"]];function Mt(n,e){return n=mi[n-1],n.length>1?e?n[1]:n[0]:n}function we(n){return n=String(n),n.length<2?`0${n}`:n}function vs(n,e){return e<=0?"":e>String(n).length?n:String(n).substring(0,e)}function _s(n,e){if(e<=0)return"";if(e>String(n).length)return n;{const t=String(n).length;return String(n).substring(t,t-e)}}function Ss(n,e=" "){return Array(parseInt(n)).fill(e).join("")}const fi={props:{full:{type:Boolean,required:!1,default:!1},align:{type:String,required:!1,validate:n=>["center","left","right","outer"].includes(n),default:"left"},direction:{type:String,required:!1,validate:n=>["horizontal","vertical"].includes(n),default:"horizontal"}},computed:{styleClasses(){return{[`direction-${this.direction}`]:!0,[`align-${this.align}`]:!0,full:this.full}}}};function hi(n,e,t,s,i,a){return I(),F("div",{class:un(["wb-env-molecule-button-wrapper",a.styleClasses])},[k("div",null,[dn(n.$slots,"default",{},void 0,!0)])],2)}const Ne=te(fi,[["render",hi],["__scopeId","data-v-13c4bed6"]]),pi={components:{WbButton:Te,WbButtonWrapper:Ne,WbItemSelect:pn},props:{fileSystem:{type:Object,default(){return null}},fsItem:{type:Object,default(){return null}},name:{type:String,default(){return"fsItem"}},model:{type:Object,default(){return{fsItem:null}}},backLabel:{type:String,default(){return"../"}},upLabel:{type:String,default(){return"Up"}},downLabel:{type:String,default(){return"Down"}},maxVisibleItems:{type:Number,default(){return 5}}},emits:["select","refresh"],data(){return{currentFsItem:this.fsItem||D(this.fileSystem.root),fsItems:[],currentIndex:0}},computed:{disableds(){return{back:!this.currentFsItem.parent,up:this.currentIndex-1<0,down:this.currentIndex+1>this.fsItems.length-this.maxVisibleItems}},currentPath(){return this.model[this.name]},items(){const n=this.fsItems.slice(this.currentIndex,this.currentIndex+this.maxVisibleItems).map(e=>({label:e.id,value:e.getPath()})).concat(Array(Math.max(this.maxVisibleItems-this.fsItems.length,0)).fill({label:"&nbsp;",disabled:!0}));return this.fsItems.length<1&&(n[Math.floor(n.length/2)]={label:"Empty",disabled:!0}),n}},watch:{async currentPath(){this.currentFsItem=D(await this.fileSystem.get(this.model[this.name])),this.currentFsItem instanceof A&&(this.fsItems=Array.from((await this.currentFsItem.getItems()).values()).map(D),this.currentIndex=0),this.$emit("select",this.currentFsItem)}},async mounted(){this.fsItems=Array.from((await this.currentFsItem.getItems()).values()).map(D),this.$nextTick(()=>{this.$emit("refresh",{reset:!0,resize:!1,scroll:!1})})},methods:{onClicBack(){this.currentFsItem instanceof A?this.model[this.name]=this.currentFsItem.parent.getPath():this.model[this.name]=this.currentFsItem.parent.parent.getPath()},onClickUp(){this.currentIndex=Math.max(this.currentIndex-1,0)},onClickDown(){this.currentIndex=Math.min(this.currentIndex+1,this.fsItems.length-this.maxVisibleItems)}}},gi={class:"wb-module-files-atoms-file-select"};function xi(n,e,t,s,i,a){const r=S("wb-item-select"),c=S("wb-button"),o=S("wb-button-wrapper");return I(),F("div",gi,[k("div",null,[_(r,{title:null,items:a.items,name:t.name,model:t.model},null,8,["items","name","model"])]),k("div",null,[_(o,{align:"outer",full:"",direction:"vertical"},{default:q(()=>[_(c,{"style-type":"secondary",label:t.backLabel,disabled:a.disableds.back,onClick:a.onClicBack},null,8,["label","disabled","onClick"]),_(c,{"style-type":"secondary",label:t.upLabel,disabled:a.disableds.up,onClick:a.onClickUp},null,8,["label","disabled","onClick"]),t.downLabel?(I(),X(c,{key:0,"style-type":"secondary",label:t.downLabel,disabled:a.disableds.down,onClick:a.onClickDown},null,8,["label","disabled","onClick"])):B("",!0)]),_:1})])])}const Gt=te(pi,[["render",xi],["__scopeId","data-v-456ecefa"]]),wi={components:{WbForm:Xe,WbButton:Te,WbButtonWrapper:Ne,WbFormFieldTextbox:Ge,WbFileSelect:Gt},props:{fsItem:{type:Object,default(){return null}},id:{type:String,default(){return null}},model:{type:Object,default(){return me({path:null,filename:null,file:null})}}},emits:["close"],setup(){return fe()},data(){return{currentModel:{...this.model},filesModule:D(this.core.modules.files),cancelLabel:"Cancel",saveLabel:"Save",fields:{path:{label:null,placeholder:"Path…"},filename:{label:null,placeholder:"Filename…"}},currentFsItem:this.fsItem||D(this.core.modules.files.fs.root)}},computed:{fileSelectFsItem(){return this.fsItem||D(this.core.modules.files.fs.root)},isLocked(){return this.currentFsItem?this.currentFsItem.locked:!1},saveDisabled(){return!this.currentModel.filename}},mounted(){this.id&&(this.currentModel.filename=this.id)},methods:{onSelect(n){this.currentFsItem=n,n instanceof A?this.currentModel.path=n.getPath():(this.currentModel.path=n.getBase(),this.currentModel.filename=n.id)},onClickCancel(){this.$emit("close")},onSubmit(){const n=ht(this.currentModel.path,this.currentModel.filename);this.$emit("close",n)}}},bi={class:"wb-module-files-save"};function yi(n,e,t,s,i,a){const r=S("wb-form-field-textbox"),c=S("wb-file-select"),o=S("wb-button"),l=S("wb-button-wrapper"),d=S("wb-form");return I(),F("div",bi,[_(d,{onSubmit:a.onSubmit},{default:q(()=>[_(r,$(i.fields.path,{modelValue:i.currentModel.path,"onUpdate:modelValue":e[0]||(e[0]=u=>i.currentModel.path=u),readonly:""}),null,16,["modelValue"]),_(c,{"file-system":i.filesModule.fileSystem,"fs-item":a.fileSelectFsItem,model:t.model,name:"file",onSelect:a.onSelect},null,8,["file-system","fs-item","model","onSelect"]),_(r,$(i.fields.filename,{modelValue:i.currentModel.filename,"onUpdate:modelValue":e[1]||(e[1]=u=>i.currentModel.filename=u)}),null,16,["modelValue"]),_(l,{align:"outer",full:""},{default:q(()=>[i.cancelLabel?(I(),X(o,{key:0,"style-type":"secondary",label:i.cancelLabel,onClick:a.onClickCancel},null,8,["label","onClick"])):B("",!0),i.saveLabel?(I(),X(o,{key:1,"style-type":"primary",label:i.saveLabel,type:"submit",disabled:a.isLocked||a.saveDisabled},null,8,["label","disabled"])):B("",!0)]),_:1})]),_:1},8,["onSubmit"])])}const Ii=te(wi,[["render",yi],["__scopeId","data-v-370a57da"]]),vi={components:{WbForm:Xe,WbButton:Te,WbButtonWrapper:Ne,WbFormFieldTextbox:Ge,WbFileSelect:Gt},props:{fsItem:{type:Object,default(){return null}},model:{type:Object,default(){return me({path:null})}}},emits:["close"],setup(){return fe()},data(){return{currentModel:{...this.model,path:this.model.path||this.fsItem.getPath()},filesModule:D(this.core.modules.files),cancelLabel:"Cancel",openLabel:"Open",fields:{path:{label:null,placeholder:"Path…"},fileSelect:{name:"path"},filename:{name:"filename",label:null,placeholder:"Filename…"}},currentFsItem:this.fsItem||D(this.core.modules.files.fs.root)}},computed:{isItemContainer(){return this.currentFsItem instanceof A},fileSelectFsItem(){return this.fsItem||D(this.core.modules.files.fs.root)}},methods:{onSelect(n){this.currentFsItem=D(n),n instanceof A&&(this.currentModel.path=n.getPath())},onClickCancel(){this.$emit("close")},onSubmit(){this.$emit("close",this.currentModel.path)}}},_i={class:"wb-module-files-open"};function Si(n,e,t,s,i,a){const r=S("wb-form-field-textbox"),c=S("wb-file-select"),o=S("wb-button"),l=S("wb-button-wrapper"),d=S("wb-form");return I(),F("div",_i,[_(d,{onSubmit:a.onSubmit},{default:q(()=>[_(r,$(i.fields.path,{modelValue:i.currentModel.path,"onUpdate:modelValue":e[0]||(e[0]=u=>i.currentModel.path=u),readonly:""}),null,16,["modelValue"]),_(c,$(i.fields.fileSelect,{"file-system":i.filesModule.fileSystem,"fs-item":a.fileSelectFsItem,model:t.model,onSelect:a.onSelect}),null,16,["file-system","fs-item","model","onSelect"]),_(l,{align:"outer",full:""},{default:q(()=>[i.cancelLabel?(I(),X(o,{key:0,"style-type":"secondary",label:i.cancelLabel,onClick:a.onClickCancel},null,8,["label","onClick"])):B("",!0),i.openLabel?(I(),X(o,{key:1,"style-type":"primary",label:i.openLabel,type:"submit",disabled:a.isItemContainer},null,8,["label","disabled"])):B("",!0)]),_:1})]),_:1},8,["onSubmit"])])}const Ei=te(vi,[["render",Si],["__scopeId","data-v-03ef60e0"]]),Di={components:{WbMarkdown:xn},props:{type:{type:String,default:null},content:{type:[String,Array],default:null}},setup(){return fe()},data(){return{lines:[]}},mounted(){this.type==="basic"&&window.requestAnimationFrame(()=>{this.lines=[],this.core.modules.parser.parseBasic(this.content,async(n,e)=>{const t=await this.core.executeCommand(n,e);return e.message&&this.lines.push(ln(e.message)),t})})}},Ai={class:"wb-module-files-preview"},Ci={key:0,class:"basic"},Mi=["innerHTML"],Fi=["src"];function Oi(n,e,t,s,i,a){const r=S("wb-markdown");return I(),F("div",Ai,[t.type==="basic"?(I(),F("ul",Ci,[(I(!0),F(rt,null,ot(i.lines,(c,o)=>(I(),F("li",{key:o},lt(c),1))),128))])):B("",!0),t.type==="markdown"?(I(),X(r,{key:1,content:t.content},null,8,["content"])):B("",!0),t.type==="html"?(I(),F("div",{key:2,innerHTML:t.content},null,8,Mi)):B("",!0),t.type==="image"?(I(),F("img",{key:3,src:t.content},null,8,Fi)):B("",!0)])}const Li=te(Di,[["render",Oi],["__scopeId","data-v-bc8c72b8"]]),ki={HAS_WINDOW_OUTPUT:"has_window_output"};async function Wi(n,e,t){const s=await n.executeCommand(`exist "${e}"`);let i=!1;s&&(i=await n.executeCommand('openDialog "File exist, overwrite?" --confirm'));const a=[`makefile "${e}"`];return t&&a.push(`--data="${t}"`),i?a.push("--override"):a.push("--ignore"),n.executeCommand(a.join(" "))}const Ri=({module:n,core:e})=>{const t=e.modules.windows,{fileSystem:s}=n;return[{name:"openPreview",args:[new p({index:0,name:"path",description:"Path to the file"}),new p({name:"maximized",description:"If set, window is maximized."})],async action({path:i,maximized:a}){const r=await s.get(i),{type:c,content:o,openMaximized:l}=r.data;c==="basic"&&!r.data[ki.HAS_WINDOW_OUTPUT]?await e.modules.parser.parseBasic(o,async(d,u)=>await e.executeCommand(d,u)):t.addWindow({title:r.name,component:Li,componentData:{type:c,content:o},options:{scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0},layout:{size:W(420,360)}},{full:l||a||!1})}},{name:"saveFileDialog",args:[new p({index:0,name:"data",description:"File Content"}),new p({index:1,name:"id",description:"File Id"}),new p({index:2,name:"extension",description:"File Extension"})],async action({data:i,id:a,extension:r}){const c=t.addWindow({title:"Save File",component:Ii,componentData:{fsItem:D(s.root),id:a},options:{scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}),{value:o}=await c.awaitClose();if(o){const l=Rt(o,r),d=await Wi(e,l,i);if(d)return D(Tt(d))}}},{name:"openFileDialog",args:[],async action(){await t.addWindow({title:"Open File",component:Ei,componentData:{fsItem:D(s.root)},options:{scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}},{name:"fileinfo",description:"Get info from File or Directory",args:[new p({index:0,name:"path",description:"Path to the file"}),new p({index:1,name:"name",description:"Name from the Info"}),new p({index:2,name:["list","ls"],flag:!0,description:"List all Infos"})],async action({path:i,name:a,list:r},c){const o=await s.itemMeta(i,a,r);if(Array.isArray(o)){const l=new je;l.addColumn({value:"Name",align:"left",minWidth:20}),l.addColumn({value:"Value",align:"left",minWidth:20}),l.addRow(o.map(d=>{let u=d.value;return Array.isArray(u)&&(u=u.join(" ")),[d.name,u]})),c.message([l])}return o}},{name:["info","i"],args:[new p({index:0,name:"path",description:"Path to the file"})],async action({path:i},a){let r=s.root;i&&(r=await s.get(i)),r instanceof A||(r=r.parent);let c=await r.getItems();const o=new je;o.addColumn([{value:"Unit",align:"left",minWidth:8},{value:"Size",align:"right",minWidth:6},{value:"Used",align:"right",minWidth:6},{value:"Free",align:"right",minWidth:6},{value:"Full",minWidth:4},{value:"Errs",align:"center",minWidth:4},{value:"Status",align:"center",minWidth:10},{value:"Name",align:"right",minWidth:14}]),c=Array.from(c.values()).filter(d=>d instanceof Q),o.addRow(c.map(d=>{let u=0;return(d.size>0||d.maxSize>0)&&(u=parseInt(d.size/d.maxSize*100)),[`${d.id}:`,Ie(d.maxSize),Ie(d.size),Ie(d.maxSize-d.size),`${u}%`,"0",d.locked?"Read":"Read/Write",`${d.name||""}`]}));const l=["","Mounted disks:",o,"","Volumes available:"];c.forEach(d=>{l.push(`${d.name}: [Mounted]`)}),l.push(""),a.message(l)}},{name:["list","ls"],args:[new p({index:0,name:"path",description:"Path to the file"}),new p({name:"dir-size",flag:!0,description:"Show Directory Size."})],async action({path:i,dirSize:a},r){let c=s.currentItem;i&&(c=await s.get(i));const o=Array.from((await c.getItems()).values()),l=new je;l.addColumn({value:"Name",align:"left",minWidth:13}),l.addColumn({value:"Size",align:"right",minWidth:8}),l.addColumn({value:"Access",align:"center",minWidth:12}),l.addColumn({value:"Date / Time",align:"center",minWidth:18}),l.addRow(o.reduce((m,h)=>{let E;h instanceof A&&!a?E="DIR":E=di(Ie(h.size),8,!0,"0");const O=h.isLocked()?"Read":"Read/Write";return m.push([`${h.id}:`,E,O,h.createdDate?mt("D-mm-y H:I:S",h.createdDate):""]),m},[]));const d=o.reduce((m,h)=>(h instanceof ae&&m++,m),0),u=o.reduce((m,h)=>(m+=h.size,m),0);return r.message([l,`${o.length} files - ${d} directories - ${u} blocks used`]),Promise.resolve()}}]},Pi={components:{WbForm:Xe,WbButton:Te,WbButtonWrapper:Ne,WbFormFieldTextbox:Ge,WbFormFieldDropdown:Bt,WbFormFieldCheckboxGroup:gn},props:{fsItem:{type:Object,default(){return null}},model:{type:Object,default(){return{actions:{save(){}},id:null,name:null,symbol:null,visible:!1}}}},emits:["close"],setup(){return fe()},data(){const n=this.fsItem.locked;return{currentModel:{...this.model},cancelLabel:"Cancel",saveLabel:"Save",fields:{id:{disabled:n,label:"Id",name:"id"},name:{disabled:n,label:"Name",name:"name"},checkboxes:{disabled:n,label:"Others",name:null,items:[{label:"Symbol Visible",name:w.VISIBLE},{label:"Ignore Symbol Rearrange ",name:w.IGNORE_SYMBOL_REARRANGE}]},windowSettings:{disabled:n,label:"Window Settings",name:null,items:[{label:"Has Scale ?",name:w.WINDOW_SCALE},{label:"Has Scroll-X ?",name:w.WINDOW_SCROLL_X},{label:"Has Scroll-Y ?",name:w.WINDOW_SCROLL_Y},{label:"Is Full-Size ?",name:w.WINDOW_FULL_SIZE},{label:"Sort Symbols (Directory)",name:w.WINDOW_SYMBOL_REARRANGE},{label:"Has Sidebar?",name:w.WINDOW_SIDEBAR}]},symbol:{disabled:n,label:"Symbol",name:"symbol",options:Object.keys(V).map(e=>({title:Nt(e),value:V[String(e)]}))}}}},methods:{onClickCancel(){this.$emit("close")},async onSubmit(){this.locked||await this.model.actions.save(this.currentModel,this.fsItem),this.$emit("close")}}},Ti={class:"wb-module-files-edit"},Ni={class:"cols"},Bi={class:"col-2"},ji={class:"col-2"};function $i(n,e,t,s,i,a){const r=S("wb-form-field-textbox"),c=S("wb-form-field-dropdown"),o=S("wb-form-field-checkbox-group"),l=S("wb-button"),d=S("wb-button-wrapper"),u=S("wb-form");return I(),F("div",Ti,[_(u,{class:"form",onSubmit:a.onSubmit},{default:q(()=>[k("div",null,[_(r,$(i.fields.id,{modelValue:i.currentModel.id,"onUpdate:modelValue":e[0]||(e[0]=m=>i.currentModel.id=m)}),null,16,["modelValue"]),_(r,$(i.fields.name,{modelValue:i.currentModel.name,"onUpdate:modelValue":e[1]||(e[1]=m=>i.currentModel.name=m)}),null,16,["modelValue"]),_(c,$(i.fields.symbol,{modelValue:i.currentModel.symbol,"onUpdate:modelValue":e[2]||(e[2]=m=>i.currentModel.symbol=m)}),null,16,["modelValue"]),k("div",Ni,[k("div",Bi,[_(o,$(i.fields.checkboxes,{model:i.currentModel}),null,16,["model"])]),k("div",ji,[_(o,$(i.fields.windowSettings,{modelValue:i.currentModel.windowSettings,"onUpdate:modelValue":e[3]||(e[3]=m=>i.currentModel.windowSettings=m)}),null,16,["modelValue"])])])]),_(d,{align:"outer",full:""},{default:q(()=>[i.cancelLabel?(I(),X(l,{key:0,"style-type":"secondary",label:i.cancelLabel,onClick:a.onClickCancel},null,8,["label","onClick"])):B("",!0),i.saveLabel?(I(),X(l,{key:1,"style-type":"primary",label:i.saveLabel,type:"submit"},null,8,["label"])):B("",!0)]),_:1})]),_:1},8,["onSubmit"])])}const zi=te(Pi,[["render",$i],["__scopeId","data-v-43900761"]]),Vi={components:{WbForm:Xe,WbButton:Te,WbButtonWrapper:Ne,WbFormFieldTextbox:Ge,WbFormFieldDropdown:Bt},props:{fsItem:{type:Object,default(){return null}},model:{type:Object,default(){return{actions:{save:()=>{}},name:null,url:null,symbol:null}}}},emits:["close"],setup(){return fe()},data(){const n=(this.fsItem||{}).locked;return{currentModel:{...this.model},cancelLabel:"Cancel",saveLabel:"Save",fields:{name:{disabled:n,placeholder:"Name",label:"Name"},url:{disabled:n,placeholder:"http://…",label:"Url"},symbol:{disabled:n,label:"Symbol",options:Object.keys(V).map(e=>({title:Nt(e),value:V[String(e)]}))}}}},computed:{disabledSave(){return!this.currentModel.name||!this.currentModel.url||!this.currentModel.symbol}},methods:{onClickCancel(){this.$emit("close")},async onSubmit(){await this.model.actions.save(this.currentModel,this.fsItem)&&this.$emit("close")}}},Ui={class:"wb-module-files-web-link"};function Yi(n,e,t,s,i,a){const r=S("wb-form-field-textbox"),c=S("wb-form-field-dropdown"),o=S("wb-button"),l=S("wb-button-wrapper"),d=S("wb-form");return I(),F("div",Ui,[_(d,{onSubmit:a.onSubmit},{default:q(()=>[_(r,$(i.fields.name,{modelValue:i.currentModel.name,"onUpdate:modelValue":e[0]||(e[0]=u=>i.currentModel.name=u)}),null,16,["modelValue"]),_(r,$(i.fields.url,{modelValue:i.currentModel.url,"onUpdate:modelValue":e[1]||(e[1]=u=>i.currentModel.url=u),type:"url"}),null,16,["modelValue"]),_(c,$(i.fields.symbol,{modelValue:i.currentModel.symbol,"onUpdate:modelValue":e[2]||(e[2]=u=>i.currentModel.symbol=u)}),null,16,["modelValue"]),_(l,{align:"outer",full:""},{default:q(()=>[i.cancelLabel?(I(),X(o,{key:0,"style-type":"secondary",label:i.cancelLabel,onClick:a.onClickCancel},null,8,["label","onClick"])):B("",!0),i.saveLabel?(I(),X(o,{key:1,"style-type":"primary",label:i.saveLabel,type:"submit",disabled:a.disabledSave},null,8,["label","disabled"])):B("",!0)]),_:1})]),_:1},8,["onSubmit"])])}const Ft=te(Vi,[["render",Yi],["__scopeId","data-v-26955dd6"]]),Hi={components:{},props:{fsItem:{type:Object,default(){return null}}},setup(){return fe()},computed:{meta(){return Array.from(this.fsItem.meta).map(([n,e])=>{if(typeof e=="object")try{e=JSON.stringify(e)}catch(t){console.error(t)}return{title:n,value:e}})},items(){return[{title:"Id",value:this.fsItem.id},{title:"Name",value:this.fsItem.name},{title:"Type",value:this.fsItem.constructor.NAME},{title:"Path",value:this.fsItem.getPath()},{title:"Size",value:Ie(this.fsItem.size)},{title:"Locked",value:this.fsItem.locked?"Yes":"No"},{title:"Created Date",value:`<nobr>${mt("H:I:S D.M.Y",this.fsItem.createdDate)}</nobr>`},{title:"Modified Date",value:`<nobr>${mt("H:I:S D.M.Y",this.fsItem.editedDate)}</nobr>`}]}}},Xi={class:"wb-module-files-info"},Gi=["innerHTML"],Ki=["innerHTML"];function Zi(n,e,t,s,i,a){return I(),F("div",Xi,[k("table",null,[(I(!0),F(rt,null,ot(a.items,({title:r,value:c},o)=>(I(),F("tr",{key:o},[k("td",null,lt(r)+":",1),k("td",{innerHTML:c},null,8,Gi)]))),128))]),k("fieldset",null,[e[0]||(e[0]=k("legend",null,"Meta:",-1)),k("table",null,[(I(!0),F(rt,null,ot(a.meta,({title:r,value:c},o)=>(I(),F("tr",{key:o},[k("td",null,lt(r)+":",1),k("td",{innerHTML:c},null,8,Ki)]))),128))])])])}const Ji=te(Hi,[["render",Zi],["__scopeId","data-v-85b541a0"]]),qi=({core:n})=>{const{windows:e,symbols:t}=n.modules,s=me({open:{disabled:!1},edit:{disabled:!1},duplicate:{disabled:!1},container:{disabled:!1},emptyTrashcan:{disabled:!1},discard:{disabled:!1},info:{disabled:!1},webLink:{disabled:!1},webLinkNew:{disabled:!1},webLinkEdit:{disabled:!1}});function i(){const u=t.getSelectedItems(),m=t.getPrimaryWrapper();s.info.disabled=u.length<1,s.open.disabled=u.length<1,s.edit.disabled=u.length<1||u.find(h=>h.locked||h instanceof z),s.duplicate.disabled=u.length<1||u.find(({fsItem:h})=>h.locked||h instanceof z||h instanceof Q),s.container.disabled=!s.open.disabled||m&&m.fsItem&&(m.fsItem instanceof gt||m.fsItem.locked)||!m,s.webLinkEdit.disabled=u.length<1||u.find(h=>!h.fsItem.meta.get(w.WEB_URL)),s.webLinkNew.disabled=s.container.disabled,s.webLink.disabled=s.webLinkNew.disabled&&s.webLinkEdit.disabled,s.emptyTrashcan.disabled=u.length<1||u.find(h=>!(h.fsItem instanceof z)),s.discard.disabled=u.length<1||u.find(({fsItem:h})=>h.locked||h instanceof z||h instanceof Q)}return t.events.subscribe(()=>i()),i(),[{order:1,title:"File",items:[{title:"Open",options:s.open,action:a},{title:"Edit",options:s.edit,action:l},{type:Be.SEPARATOR},{title:"Web Link",options:s.webLink,items:[{title:"New",options:s.webLinkNew,action:c},{title:"Edit",options:s.webLinkEdit,action:o}]},{type:Be.SEPARATOR},{title:"Duplicate",options:s.duplicate,action(){const u=t.getSelectedItems();return Promise.all(u.filter(m=>m.fsItem).map(async({fsItem:m})=>{const h=await m.getPath();return n.executeCommand(`copy "${h}" "${h}" -ignore`)}))}},{title:"Make Dir",options:s.container,async action(){const u=t.getPrimaryWrapper().fsItem,m=ht(await u.getPath(),"Directory");return console.log(`makedir "${m}" -ignore`),n.executeCommand(`makedir "${m}" -ignore`)}},{type:Be.SEPARATOR},{title:"Discard",options:s.discard,action(){const u=t.getSelectedItems();return Promise.all(u.filter(m=>m.fsItem).map(async({fsItem:m})=>{const h=await m.getPath();return n.executeCommand(`remove "${h}" -r`)}))}},{title:"Empty Trashcan",options:s.emptyTrashcan,action(){const u=t.getSelectedItems();return Promise.all(u.filter(m=>m.fsItem).map(async({fsItem:m})=>Promise.all(Array.from((await m.getItems()).values()).map(async h=>{const E=await h.getPath();return n.executeCommand(`remove "${E}" -r -ignore`)}))))}},{type:Be.SEPARATOR},{title:"Info",options:s.info,action(){t.getSelectedItems().filter(m=>m.fsItem).forEach(m=>{e.addWindow({title:`Info File ${m.fsItem.name}`,component:Ji,componentData:{fsItem:D(m.fsItem)},layout:{size:W(460,280)},options:{scaleX:!0,scaleY:!0,prompt:!1,scrollX:!0,scrollY:!0}})})}}]}];function a(){t.getSelectedItems().filter(m=>m.fsItem).forEach(m=>{if(m.command){const h={showCommand:!1,show:!0};return n.executeCommand(m.command,h)}})}async function r({name:u,url:m,symbol:h},E){if(E||(E=await n.executeCommand(`saveFileDialog --id="${cn(u)}"`)),E){const O=n.addExecution();try{const b=E.getPath();await n.executeCommand(`rename "${b}" "${u}" -n`),await n.executeCommand(`editfilemeta "${b}" "${w.WEB_URL}" "${m}"`),await n.executeCommand(`editfilemeta "${b}" "${w.SYMBOL}" "${h}"`)}catch(b){throw O(),new Error(b)}return O(),!0}return!1}function c(){return e.addWindow({title:"Make Link",component:Ft,componentData:{model:{actions:{save:r},name:null,url:null,symbol:"default"}},options:{prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}function o(){t.getSelectedItems().filter(m=>m.fsItem).forEach(m=>{const h=m.fsItem;e.addWindow({title:"Edit Link",component:Ft,componentData:{fsItem:D(h),model:{actions:{save:r},name:h.name,url:h.meta.get(w.WEB_URL),symbol:h.meta.get(w.SYMBOL)}},options:{prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})})}function l(){t.getSelectedItems().filter(m=>m.fsItem).forEach(m=>{const h=m.fsItem,E=me({actions:{save:d},id:h.id,name:h.name});[w.SYMBOL,w.VISIBLE,w.IGNORE_SYMBOL_REARRANGE,w.WINDOW_SCALE,w.WINDOW_SCROLL_X,w.WINDOW_SCROLL_Y,w.WINDOW_FULL_SIZE,w.WINDOW_SYMBOL_REARRANGE,w.WINDOW_SIDEBAR].forEach(O=>{E[String(O)]=h.meta.has(O)?h.meta.get(O):!1}),e.addWindow({title:`Edit File ${h.name}`,component:zi,componentData:{fsItem:D(h),model:E},options:{prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})})}async function d(u,m){const{id:h,name:E}=u,O=m.getPath();if(!h)throw new Error("Id is emoty!");let b;const pe=n.addExecution();try{await Promise.all([w.SYMBOL,w.VISIBLE,w.IGNORE_SYMBOL_REARRANGE,w.WINDOW_SCALE,w.WINDOW_SCROLL_X,w.WINDOW_SCROLL_Y,w.WINDOW_FULL_SIZE,w.WINDOW_SYMBOL_REARRANGE,w.WINDOW_SIDEBAR].map(C=>{let U=u[String(C)];return typeof U=="string"&&(U=`"${U}"`),n.executeCommand(`editfilemeta "${O}" "${C}" ${U}`)})),E&&h!==E?await n.executeCommand(`rename "${O}" "${E}" -n`):b=n.executeCommand(`rename "${O}" "${h}" -rn`),b=n.executeCommand(`rename "${O}" "${h}"`)}catch(C){throw pe(),new Error(C)}return pe(),b}},Qi=({module:n})=>{const{fileSystem:e,core:t,disks:s}=n;return[{name:["mountDisk"],description:"Mount Disk",args:[new p({index:0,name:"id",description:"Disk ID"})],async action({id:i},a){const r=t.addExecution(),c=await s[String(i)]();try{const o=await e.addFloppyDisk(c({core:t}));a.message(`Mount Disk <strong>${o.name}</strong> <strong>(${o.id})</strong> successful!`),r()}catch(o){throw console.error(o),x.get("cant_find_disk",i)}}},{name:["changeDirectory","cd"],description:"cd %path%",args:[new p({index:0,name:"path",description:"Directory path"})],async action({path:i}){if(!i)throw x.get("bad_args");try{await e.changeDirectory(i)}catch(a){throw console.error(a),x.get("cant_find",i)}}},{name:["exist"],description:"Check if file exists.",args:[new p({index:0,name:"path",description:"Filename"})],async action({path:i},a){if(!i)throw x.get("bad_args");const r=j(i),c=await e.exist(i);return c?a.message(`File ${r} exists`):a.message(`File ${r} does not exist`),c}},{name:["makedir","mkdir"],args:[new p({index:0,name:"path",description:"Filename"}),new p({index:1,name:"name",description:"Name"}),new p({name:"ignore",flag:!0,description:"Ignore file exist."})],async action({path:i,name:a,ignore:r},c){if(!i)throw x.get("bad_args");const o=await e.makedir(i,a||j(i),{ignore:r});return c.message(`Directory "${o.name}" created`),o}},{name:["remove","rm"],args:[new p({index:0,name:"path",description:"Filename"}),new p({name:["recursive","r"],flag:!0,description:"Remove Directory Items and Directories."}),new p({name:["ignore"],flag:!0,description:"Ignore the specified file is deleted."})],async action({path:i,recursive:a,ignore:r},c){if(!i)throw x.get("bad_args");const o=await e.remove(i,a,{ignore:r});return[].concat(o).map(l=>{const d=l.type===ae.NAME?"Directory":"File";return c.message(`Removed ${d}: ${l.name}`),l})}},{name:["readfile","getfile"],description:"Get file content",args:[new p({index:0,name:"path",description:"Filename"})],async action({path:i}){if(!i)throw x.get("bad_args");return(await e.get(i)).data}},{name:["makefile","mkfile"],description:"Creates a file with the specified attributes.",args:[new p({index:0,name:"path",description:"Filename"}),new p({index:1,name:"name",description:"Name"}),new p({index:3,name:"data",description:"Data"}),new p({name:"override",flag:!0,description:"Deletes existing file and recreates."})],async action({path:i,name:a,data:r,override:c=!1},o){if(!i)throw x.get("bad_args");typeof r=="string"&&(r=at(r));const l=await e.makefile(i,a,r,{override:c});return o.message(`File "${l.name}" created`),l}},{name:["editfile"],description:"Edits file with specified attributes.",args:[new p({index:0,name:"path",description:"Filename"}),new p({index:1,name:"data",description:"Data"})],async action({path:i,data:a},r){if(!i)throw x.get("bad_args");typeof a=="string"&&(a=at(a));const c=await e.editfile(i,a);return r.message(`File "${c.name}" edited`),c}},{name:["editfilemeta"],description:"Edits file with specified attributes.",args:[new p({index:0,name:"path",description:"Filename"}),new p({index:1,name:"name",description:"Name"}),new p({index:2,name:"value",description:"Value"})],async action({path:i,name:a,value:r},c){if(!i)throw x.get("bad_args");const o=await e.editfileMeta(i,a,r);return c.message(`File  "${o.name}" Meta edited`),o}},{name:["makelink","mklink"],description:"Creates a link to the specified path.",args:[new p({index:0,name:"ref",description:"Reference path with id (example.ext)."}),new p({index:1,name:"name",description:"Displayed Name"}),new p({index:2,name:"dest",description:"Destination directory."})],async action({ref:i,name:a,dest:r},c){if(!i)throw x.get("bad_args");r=r||".";const o=await e.get(i),l=await e.makelink(o,a);return await e.get(r)!==e.currentItem&&await e.move(l,r,{ignore:!0}),c.message(`Created link "${a}" with "${await o.getPath()}"`),l}},{name:["editlink"],description:"",args:[new p({index:0,name:"path",description:"Reference filepath with id (example.ext)."}),new p({index:1,name:"ref",description:"Destination directory."})],async action({path:i,ref:a},r){if(!(i&&a))throw x.get("bad_args");const c=await e.get(a),o=await e.editlink(i,c);return r.message(`Edited link "${name}" with "${await c.getPath()}"`),o}},{name:"rename",description:"Renamed a file",args:[new p({index:0,name:"path",description:"Filepath with id (example.ext)."}),new p({index:1,name:"value",description:"Value for id or displayed name."}),new p({name:["name","n"],flag:!0,description:"When set, changes the display name."}),new p({name:["removeName","rn"],flag:!0,description:"When set, removes the display name."})],async action({path:i,value:a,name:r,removeName:c},o){if(!c&&(!i||!a))throw x.get("bad_args");const l=await e.get(i),d=r?l.name:l.id;return await e.rename(i,a,{name:r,removeName:c}),o.message(`Renamed from "${d}" to "${a}"`),l}},{name:["cp","copy"],args:[new p({index:0,name:"from",description:"Source Filepath with id (example.ext)."}),new p({index:1,name:"dest",description:"Destination Filepath with id (example.ext)."}),new p({name:["ignore","i"],flag:!0,description:"When sets, creates a new file if exists."})],async action({from:i,dest:a,ignore:r},c){let o=a;if(!o&&r&&(o=i),!o||!i)throw x.get("bad_args");const l=await e.copy(i,o,{ignore:r});return c.message(`Copied from "${i}" to "${o}"`),l}},{name:["mv","move"],description:"move %from% %to%",args:[new p({index:0,name:"from",description:"From path"}),new p({index:1,name:"to",description:"To path"}),new p({index:2,name:"item-position",description:"Sets the position in the Icon view. (x,y)"})],async action({from:i,to:a,itemPosition:r},c){if(!a||!i)throw x.get("bad_args");const o=new Map;r&&o.set("itemPosition",[0,0].map((u,m)=>{const h=r.split(",");return parseInt(h[Number(m)]||0)}));const l=await e.move(i,a,{meta:o});let d;return l instanceof ae?d="Directory":d="File",c.message(`${d} moved ${l.name}`),l}},{name:["executeFile"],description:"Execute file.",args:[new p({index:0,name:"path",description:"Path to the file"})],async action({path:i}){if(!i)throw x.get("bad_args");const a=await e.get(i);if(typeof a.action=="function")return a.action(t);throw x.get("cant_find_action",i)}}]};x.add("cant_find_action","Can't find action %1");x.add("cant_find_disk","Can't find disk %1");var Re,kt;const es=new(kt=class{constructor(){y(this,Re)}get(){return f(this,Re)||v(this,Re,this.getImports())}getImports(){return Promise.all([et(()=>import("./CL5Hp3VC.js"),__vite__mapDeps([0,1]),import.meta.url),et(()=>import("./BrpFI5cJ.js"),__vite__mapDeps([2,1,3]),import.meta.url),et(()=>import("./D_5a1Xw6.js"),__vite__mapDeps([4,1]),import.meta.url)]).then(([e,t,s])=>({app:e.default||e,auth:t.default||t,database:s.default||s}))}},Re=new WeakMap,kt),it=new Map;class ts{constructor(){g(this,"services");g(this,"app");g(this,"firebase")}get name(){return this.app.name}async connect(e,{apiKey:t,url:s}){if(this.services=await es.get(),this.firebase=this.services.app,this.app)it.has(e)&&(this.app=it.get(e));else{const i=this.services.app.initializeApp({apiKey:t,databaseURL:s},e);it.set(i.name,i),this.app=i}return this.app}async disconnect(){if(!this.app)throw x.get("FirebaseWrapper_noApp");be(this),await this.logout(),await this.services.app.deleteApp(this.app),this.app=null}get locked(){return!!this.app&&!this.isLogged()}get currentUser(){const{getAuth:e}=this.services.auth;return e(this.app).currentUser}isLogged(){return!!this.app&&!!this.currentUser}login(e,t){const{getAuth:s,signInWithEmailAndPassword:i}=this.services.auth,a=s(this.app);return be(this),i(a,e,t)}logout(){if(this.app){const{getAuth:e,signOut:t}=this.services.auth,s=e(this.app);return t(s)}else throw x.get("FirebaseWrapper_notConnected")}remove(e){be(this);const{remove:t,ref:s,getDatabase:i}=this.services.database,a=i(this.app),r=s(a,e);return t(r)}get(e){be(this);const{ref:t,onValue:s,getDatabase:i}=this.services.database,a=i(this.app),r=t(a,e);return new Promise(c=>{s(r,o=>c(o.val()))})}async set(e,t){be(this);const{ref:s,set:i,getDatabase:a}=this.services.database,r=a(this.app),c=s(r,e);return await i(c,t),t}}function be(n){if(!n.app)throw x.get("FirebaseWrapper_notConnected")}x.add([["FirebaseWrapper_notConnected",["Not connected","Not connected"]],["FirebaseWrapper_noApp",["No app available","No app available"]],["FirebaseWrapper_hasApp",["App already available",'App "%1" already available']]]);class ns extends zt{constructor(e){e=Object.assign({storage:new ts},e),super(e)}mount(e){return e.onDisconnect=()=>{this.unmount()},this.storage.connect(e.id,e).then(()=>this)}unmount(){return this.storage.disconnect().then(()=>this)}async load(){try{let e=await this.storage.get(this.name);return!e&&(e={},!this.storage.locked)?this.storage.set(this.name,e).then(t=>t):(this.data=e,e)}catch(e){throw new Error(e)}}save(e){return e=Kt(e),this.data=e||this.data,this.storage.set(this.name,e).then(()=>this.data)}get locked(){return this.storage.locked}}function Kt(n){return Object.keys(n).reduce((e,t)=>{const s=e[String(t)];return s&&typeof s=="object"&&Kt(s),(s==null||s==="")&&delete e[String(t)],e},n)}const ye=new Map,is=({module:n,core:e})=>{const{fileSystem:t}=n;return[{name:"cloudList",args:[new p({name:"json",flag:!0,description:"Get JSON Export"})],action({json:s},i){const a=Array.from(ye.values());if(s)return Promise.resolve(a);{const r=new je;return r.addColumn({value:"Storage (Id)",align:"left",minWidth:15}),r.addColumn({value:"Name",align:"left",minWidth:15}),r.addColumn({value:"Logged In",align:"center",minWidth:9}),r.addRow(a.reduce((c,o)=>(c.push([o.id,o.name,o.storage.storage.isLogged()?"yes":"no"]),c),[])),i.message([r]),Promise.resolve()}}},{name:"cloudMount",args:[new p({index:0,name:"id",flag:!0,description:"Id from Storage."}),new p({index:1,name:"apiKey",description:"Firebase Api-Key."}),new p({index:2,name:"url",description:"Firebase Database-Url."})],async action({id:s,apiKey:i,url:a},r){if(!i||!a)throw x.get("bad_args");const c=e.addExecution(),o=await t.connect(ns,{id:s,apiKey:i,url:a});return ye.set(o.id,o),r.message(`Mount <strong>${o.name}</strong> <strong>(${o.id})</strong> successful!`),c(),o}},{name:"cloudUnmount",args:[new p({index:0,name:"id",flag:!0,description:"Id from Storage."})],async action({id:s},i){if(!s)throw x.get("bad_args");const a=e.addExecution();try{const r=ye.get(s);await t.disconnect(r),ye.delete(r.id),i.message(`Unmount "${r.name}" successful!`),a()}catch(r){throw a(),new Error(r)}}},{name:"cloudAuth",args:[new p({name:"login",flag:!0,description:"Storage Login"}),new p({name:"logout",flag:!0,description:"Logout from Storage."}),new p({name:"email",description:"Email for Login."}),new p({name:"password",description:"Password for Login."}),new p({name:"storage",description:"Specifies which drive is logged on."})],async action({email:s,password:i,storage:a,login:r,logout:c},o){const l=a;if(!l)throw x.get("bad_args");const d=e.addExecution(),u=ye.get(l);let m;if(u)try{if(r){if(!s||!i)throw x.get("bad_args");m=await u.storage.storage.login(s,i),o.message(`Login with ${u.id} (${u.id}) successful!`)}else c&&(m=await u.storage.storage.logout(),o.message(`Logout from ${u.id} (${u.id}) successful!`))}catch(h){switch(d(),h.code){case"auth/user-not-found":case"auth/wrong-password":return h}throw new Error(h)}else throw new Error(`${l} is not mounted.`);return d(),m}}]},Ot=new dt("web_workbench_FS");var Pe;class ss extends An{constructor({core:t}){super({commands:(...s)=>[...Ri(...s),...Qi(...s),...is(...s)],contextMenu:qi,core:t});y(this,Pe,{})}get disks(){return f(this,Pe)}async addDisks(t){Object.entries(t).forEach(([s,i])=>{f(this,Pe)[String(s)]=i})}get fileSystem(){return Ot}get fs(){return Ot}}Pe=new WeakMap,g(ss,"NAME","Files");export{p as A,_n as C,ae as D,Ke as F,A as I,An as M,ki as P,je as T,ee as W,xs as a,En as b,Ne as c,P as d,Is as e,Sn as f,On as g,ci as h,Dn as i,di as j,Ss as k,vs as l,St as m,ss as n,ws as p,_s as r};
