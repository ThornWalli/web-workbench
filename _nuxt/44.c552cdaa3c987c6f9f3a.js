(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{184:function(t,n,e){"use strict";e.r(n),function(t){e.d(n,"default",(function(){return c}));var o,r=e(73),h=e(84);class c{constructor(t){this.subscriptions=[],this.displaySubscriptions=new Map,this.runSubscriptions=[],this._app=t,this._pressed=!1}registerDisplay(t){this.displaySubscriptions.set(t,[h.a.get("mousedown",t.canvas).subscribe(this.onPointerDown(t).bind(this)),h.a.get("mouseenter",t.canvas).subscribe(this.onPointerEnter(t).bind(this))])}unregisterDisplay(t){this.displaySubscriptions.has(t)&&(this.displaySubscriptions.get(t).forEach((t=>t.unsubscribe())),this.displaySubscriptions.delete(t))}register(){}unregister(){}onContextMenu(t){return n=>{this.runActionResult(y.bind(this)(n,t))}}onPointerEnter(t){return n=>{this.app.setDisplay(t);var e=h.a.get("mouseleave",n.target).subscribe((n=>{e.unsubscribe(),this.onPointerLeave(t)(n)}))}}onPointerLeave(t){return t=>{}}onPointerDown(t){return n=>{this.app.setDisplay(t),this._pointerEvent=d.bind(this)(n,t),this._pressed=!0,this.runActionResult(v.bind(this)(n,t),n,t),this.app.display.renderCanvas()}}onPointerLeaveAndUp(t){return n=>{l(),this.runActionResult(m.bind(this)(n,t))}}onPointerMove(t){return n=>{this.runActionResult(P.bind(this)(n,t))}}get app(){return this._app}get pressed(){return this._pressed}runActionResult(t,n,e){t&&(t.events&&(this.runSubscriptions=[h.a.get("contextmenu",n.target).subscribe(this.onContextMenu(e).bind(this)),h.a.get("mouseleave",n.target).subscribe(this.onPointerLeaveAndUp(e).bind(this)),h.a.get("mousemove",n.target).subscribe(this.onPointerMove(e).bind(this)),h.a.get("mouseup",n.target).subscribe(this.onPointerLeaveAndUp(e).bind(this))]),t.save&&this.app.canvas.saveStack(),t.revert&&this.app.canvas.revertStack(),t.render&&this.app.canvas.render())}unsubscribeRun(){this.runSubscriptions.filter((t=>!t.unsubscribe()))}}function l(){t.clearInterval(o),o=null}function d(t,n){var e=n.canvasLayout,o=Object(r.e)(t.clientX-n.bounds.min.x,t.clientY-n.bounds.min.y),c=Object(r.e)((()=>o-e.position));this.app.globalBounds&&(console.log(this.app.globalBounds.min.toString()),o=Object(r.e)((()=>o-this.app.globalBounds.min)),c=Object(r.e)((()=>c-this.app.globalBounds.min)));var l=Object(r.e)((()=>Math.round(c))),d=Object(r.e)((()=>Math.round(c/n.zoomFactor+n.zoomBounds.min)));return{position:d,origin:l,app:this.app,x:d.x,y:d.y,originX:l.x,originY:l.y,leftClick:2!==t.button,rightClick:2===t.button,holdAlt:h.a.altActive,holdCtrl:h.a.cmdActive}}function v(){var n,e={events:!0};return this.app.tool.pointerDownHold?(n=()=>{this.runActionResult(this.app.tool.onPointerDown(this._pointerEvent,this)),this.app.canvas.render()},l(),o=t.setInterval(n,20),e):Object.assign(e,this.app.tool.onPointerDown(this._pointerEvent,this))}function m(t,n){return this._pressed=!1,this._pointerEvent=null,this.unsubscribeRun(),this.app.tool.onPointerUp(d.bind(this)(t,n),this)}function P(t,n){return this._pointerEvent=d.bind(this)(t,n),this.app.tool.onPointerMove(this._pointerEvent,this)}function y(t,n){return t.preventDefault(),t.stopPropagation(),this.app.tool.onContextMenu(d.bind(this)(t,n),this)}}.call(this,e(8))}}]);