import{E as H,F as L,G as w,b as d,i as T,f as v,t as y,j as M}from"./index.a41cd4d9.js";import{_ as g,k as u,l as o,m as i,M as h,B as f,O as k,a2 as b,K as E}from"./entry.3fa5f88e.js";import{a as _}from"./async.0b84cdae.js";function C(l,t){return t===void 0&&(t=_),H(function(r,c){var n=null,e=null,s=null,m=function(){if(n){n.unsubscribe(),n=null;var a=e;e=null,c.next(a)}};function S(){var a=s+l,p=t.now();if(p<a){n=this.schedule(void 0,a-p),c.add(n);return}m()}r.subscribe(L(c,function(a){e=a,s=t.now(),n||(n=t.schedule(S,l),c.add(n))},function(){m(),c.complete()},void 0,function(){e=n=null}))})}const K={props:{rootElement:{type:HTMLElement,default(){return null}},options:{type:Object,default(){return{focused:!1}}},readonly:{type:Boolean,required:!1,default:!1},multiline:{type:Boolean,required:!1,default:!0},name:{type:String,default:"value"},model:{type:Object,required:!1,default(){return{value:"Input Value"}}}},emits:["input","refresh","keydown","keyup","enter"],data(){return{escapeHtml:w,selectionLength:null,selectionStart:null,selectionEnd:null,controlShiftActive:!1,controlCapsLockActive:!1,focusedSubscriptions:[],refreshFrame:null}},computed:{focused(){return this.options.focused},value:{get(){return this.model[this.name]},set(l){this.model[this.name]=l}},styleClasses(){return{readonly:this.readonly,multiline:this.multiline,"selection-empty":!this.selectionLength,focused:this.focused,"shift-active":this.controlShiftActive,"caps-lock-active":this.controlCapsLockActive}}},watch:{focused(l){l?(this.focusedSubscriptions.push(d.get("click").pipe(T(({target:t})=>!M(t,this.rootElement||this.$parent.$el)),v()).subscribe(this.blur.bind(this)),d.get("keypress").subscribe(function(){this.$refs.input.focus()}.bind(this)),d.get("keydown").subscribe(({keyCode:t})=>{switch(t){case 16:this.controlShiftActive=!0;break;case 20:this.controlCapsLockActive=!this.controlCapsLockActive;break}}),d.get("keyup").subscribe(({keyCode:t})=>{switch(t){case 16:this.controlShiftActive=!1;break}this.$emit("keyup",t)})),this.$refs.input.focus()):(this.focusedSubscriptions.forEach(t=>t.unsubscribe()),this.focusedSubscriptions=[],this.$refs.input.blur())}},unmounted(){window.cancelAnimationFrame(this.refreshFrame),this.focusedSubscriptions.forEach(l=>l.unsubscribe())},mounted(){this.$refs.input.setSelectionRange(this.value.length,this.value.length),this.refresh(),this.focused&&this.$refs.input.focus()},methods:{focus(){this.setFocus(!0)},blur(){this.setFocus(!1)},resetSelection(){const l=this.$refs.input;this.selectionStart=l.selectionStart=0,this.selectionEnd=l.selectionEnd=0,this.selectionLength=0},refresh(){const l=this.$refs.input;this.selectionStart=l.selectionStart,this.selectionEnd=l.selectionEnd,this.selectionLength=this.selectionEnd-this.selectionStart,this.$emit("refresh")},setFocus(l){this.options.focused=l},onPointerDown(l){const t=d.pointerMove.pipe(C(128)).subscribe(r=>{y(r),this.refresh()});d.pointerUp.pipe(v()).subscribe(r=>{y(r),t.unsubscribe()})},onInput(){this.refresh(),this.$emit("input")},onClick(){this.focused?this.refresh():this.setFocus(!0)},onKeydown(l){!this.multiline&&l.keyCode===13?(l.preventDefault(),l.stopPropagation(),this.$emit("enter",this.model[this.name]),this.refresh()):(this.$emit("keydown",l),this.refresh())},onKeyup(l){this.$emit("keyup",l.keyCode),this.refresh()}}},I={class:"result"},x=["innerHTML"],A=["innerHTML"],F=["innerHTML"],P=["innerHTML"],D=["innerHTML"],B=["innerHTML"],V=["innerHTML"],O=["innerHTML"],j={key:1,class:"selected"},q=["innerHTML"],U=["innerHTML"],N={class:"input"},z=["readonly"],G=["readonly"];function R(l,t,r,c,n,e){return u(),o("div",{class:E(["wb-env-atom-input-text",e.styleClasses])},[i("div",null,[i("div",I,[e.value.length>0&&n.selectionEnd>0?(u(),o(h,{key:0},[n.selectionStart>=0&&n.selectionEnd===e.value.length?(u(),o(h,{key:0},[i("span",{innerHTML:n.escapeHtml(e.value.slice(0,n.selectionStart))},null,8,x),i("span",{class:"selected",innerHTML:n.escapeHtml(e.value.slice(n.selectionStart,n.selectionEnd+1))||" "},null,8,A)],64)):n.selectionStart&&n.selectionStart===n.selectionEnd?(u(),o(h,{key:1},[i("span",{innerHTML:n.escapeHtml(e.value.slice(0,n.selectionStart))},null,8,F),i("span",{class:"selected",innerHTML:n.escapeHtml(e.value.slice(n.selectionStart,n.selectionStart+1))||" "},null,8,P),i("span",{innerHTML:n.escapeHtml(e.value.slice(n.selectionStart+1,e.value.length))},null,8,D)],64)):(u(),o(h,{key:2},[i("span",{innerHTML:n.escapeHtml(e.value.slice(0,n.selectionStart))},null,8,B),i("span",{class:"selected",innerHTML:n.escapeHtml(e.value.slice(n.selectionStart,n.selectionEnd))},null,8,V),i("span",{innerHTML:n.escapeHtml(e.value.slice(n.selectionEnd,e.value.length))},null,8,O)],64))],64)):f("",!0),!n.selectionStart&&e.value===""?(u(),o("span",j," ")):e.value.length>0&&!n.selectionStart&&n.selectionStart===n.selectionEnd?(u(),o(h,{key:2},[i("span",{class:"selected",innerHTML:n.escapeHtml(e.value.slice(0,1))},null,8,q),i("span",{innerHTML:n.escapeHtml(e.value.slice(1,e.value.length))},null,8,U)],64)):f("",!0)]),i("div",N,[r.multiline?k((u(),o("textarea",{key:0,ref:"input","onUpdate:modelValue":t[0]||(t[0]=s=>e.value=s),readonly:r.readonly,onPointerdown:t[1]||(t[1]=(...s)=>e.onPointerDown&&e.onPointerDown(...s)),onInput:t[2]||(t[2]=(...s)=>e.onInput&&e.onInput(...s)),onClick:t[3]||(t[3]=(...s)=>e.onClick&&e.onClick(...s)),onKeydown:t[4]||(t[4]=(...s)=>e.onKeydown&&e.onKeydown(...s)),onKeyup:t[5]||(t[5]=(...s)=>e.onKeyup&&e.onKeyup(...s)),onFocus:t[6]||(t[6]=(...s)=>e.onClick&&e.onClick(...s))},null,40,z)),[[b,e.value]]):f("",!0),r.multiline?f("",!0):k((u(),o("input",{key:1,ref:"input","onUpdate:modelValue":t[7]||(t[7]=s=>e.value=s),type:"text",readonly:r.readonly,onPointerdown:t[8]||(t[8]=(...s)=>e.onPointerDown&&e.onPointerDown(...s)),onInput:t[9]||(t[9]=(...s)=>e.onInput&&e.onInput(...s)),onClick:t[10]||(t[10]=(...s)=>e.onClick&&e.onClick(...s)),onKeydown:t[11]||(t[11]=(...s)=>e.onKeydown&&e.onKeydown(...s)),onKeyup:t[12]||(t[12]=(...s)=>e.onKeyup&&e.onKeyup(...s)),onFocus:t[13]||(t[13]=(...s)=>e.onClick&&e.onClick(...s))},null,40,G)),[[b,e.value]])])])],2)}const X=g(K,[["render",R],["__scopeId","data-v-5640cddb"]]);export{X as A};
