import{M as h,T as k}from"./D2bZ6ctC.js";import{C as f}from"./uY512OOx.js";import{g as v,T as _}from"./uFgmqckw.js";import{T,c as y}from"./cEQ-NZ90.js";import{C as m}from"./C_Yut5KD.js";import{N as C,u as g}from"./I3M8u4_e.js";import{T as b}from"./CLW0yw2f.js";import{u as x}from"./BukgkFri.js";import{_ as N,a6 as E,Q as $,g as l,t as o,v as n,z as u,K as w,a9 as M,x as p,F as P,$ as R,a0 as V,L as S,C as j}from"./C5IvAcAs.js";import"./BxO05Tpb.js";import"./BhIZyK9R.js";import"./C5mdboMC.js";import"./CNH8ZBaJ.js";import"./BmG3vGke.js";import"./DwAjpAW9.js";import"./Bq1CIWZA.js";import"./AgLYVh2m.js";import"./PIkGlXJS.js";import"./DxOVdChq.js";import"./BuD4WQ83.js";import"./CFhzTvZQ.js";import"./DJ7tQarU.js";import"./C1Z8QYso.js";import"./BrQUI1fL.js";import"./AEwztriR.js";const I={components:{Navigation:C,SynthesizerTimelineCanvas:b},props:{model:{type:Object,required:!0}},emits:["refresh"],async setup(t){const e=E(t,"model"),s=x();return $(e,()=>{s.setContextMenu(y,{model:e.value,preserveContextMenu:s.preserveContextMenu})},{immediate:!0,deep:!0}),{...s,...await g()}},data:function(){return{toneDestination:null,tracksEdit:{}}},computed:{timelineRefreshKey(){return`timeline-${this.bpm}`},project(){return this.model[m.SYNTHESIZER_PROJECT]},tracks:{get(){return this.project.tracks},set(t){this.project.tracks=t}},bpm(){return Number(this.model[m.SYNTHESIZER_BPM])},controlsNavigation(){return{model:this.model,items:[[{text:`Project: ${this.project.name} | Tracks: ${this.tracks.length}`}]]}},masterVolume(){return this.core.config.observable[f.SCREEN_CONFIG].soundVolume},decibelValue(){return v(this.masterVolume)}},watch:{masterVolume:{handler(){h.volume.value=this.decibelValue},immediate:!0},tracks(){this.$nextTick(()=>{this.$emit("refresh")})},bpm:{handler(t){const e=this.tone.transport;e.stop(),e.bpm.value=120,e.seconds=0,e.bpm.value=t,e.start()}}},mounted(){this.$nextTick(()=>{console.log(this.tracks),this.editTrack(this.tracks[0],{})}),this.$nextTick(()=>{this.$emit("refresh")})},unmounted(){this.model.actions.closeTracks()},methods:{async onClickPlay(){await this.tone.start(),this.players=this.tracks.map(s=>{const r=new T(s,{autoplay:!1});return r.createInstrument("Synth"),r});const t=k;t.stop(),t.seconds=0,t.start(),this.players.map(s=>s.play()).map(s=>s.start(0))},getControls(t){const e=t.getDuration();return{items:[{text:t.name},{spacer:!0},{text:` ${e}`},{label:"Edit",onClick:async()=>{await this.tone.start(),this.editTrack(new _(t),{toneDestination:this.toneDestination})}},{label:"Remove",onClick:async()=>{this.preserveContextMenu(!0),await this.model.actions.removeTrack(t),this.preserveContextMenu(!1),this.$emit("refresh")}}]}},async editTrack(t){this.tracksEdit[t.id]=!0;const{close:e}=this.model.actions.editTrack(t),s=await e;this.tracks=this.tracks.map(r=>r.id===s.id?s:r),this.tracksEdit[t.id]=!1,this.$nextTick(()=>{this.$emit("refresh")})}}},z={class:"wb-disks-extras13-synthesizer-project"},D={class:"tracks"},F={key:0,class:"no-tracks"},B={class:"sheet"};function O(t,e,s,r,q,a){const c=l("navigation"),d=l("synthesizer-timeline-canvas");return o(),n("div",z,[u(c,w(M(a.controlsNavigation)),null,16),p("div",D,[a.tracks.length<1?(o(),n("div",F,"No tracks availableâ€¦")):P("",!0),(o(!0),n(R,null,V(a.tracks,i=>(o(),n("div",{key:i.id,class:"track"},[u(c,S({ref_for:!0},a.getControls(i)),null,16),p("div",B,[(o(),j(d,{key:a.timelineRefreshKey,track:i,static:t.tracksEdit[i.id],onRefresh:e[0]||(e[0]=G=>t.$emit("refresh"))},null,8,["track","static"]))])]))),128))])])}const ht=N(I,[["render",O],["__scopeId","data-v-10b743b1"]]);export{ht as default};
