(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{385:function(r,e,t){"use strict";t.r(e),t.d(e,"default",(function(){return m}));t(127),t(34),t(262),t(17),t(256),t(48),t(35);var n=t(254),c=t(255),h=t(259),o=t(257),d=t(258),y=t(318),l=t(303),f=t(302),v=t(317);function A(r){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(r){return!1}}();return function(){var t,n=Object(d.a)(r);if(e){var c=Object(d.a)(this).constructor;t=Reflect.construct(n,arguments,c)}else t=n.apply(this,arguments);return Object(o.a)(this,t)}}var m=function(r){Object(h.a)(t,r);var e=A(t);function t(r){var c;return Object(n.a)(this,t),(c=e.call(this,r)).status=0,c.locked=!1,c}return Object(c.a)(t,[{key:"refreshHelperOffset",value:function(){this.primaryHelper&&(this.primaryHelperOffset=[this.primaryHelper.x-this.primaryAnchor.x,this.primaryHelper.y-this.primaryAnchor.y]),this.secondaryHelper&&(this.secondaryHelperOffset=[this.secondaryHelper.x-this.secondaryAnchor.x,this.secondaryHelper.y-this.secondaryAnchor.y])}},{key:"onPointerDown",value:function(r){var e=this;if(this.moved||this.reset(),!this.locked){this.locked=!0,1===this.anchors.length&&this.reset();var t=this.getAnchorByPosition(r.x,r.y);if(t&&this.selectedAnchor!==t)this.selectedAnchor=t;else{if(2===this.status&&!t)return x.bind(this)();1===this.status?H.bind(this)():this.selectedAnchor||(this.addAnchor(r.x,r.y),this.selectedAnchor=this.addAnchor(r.x,r.y))}return this._app.canvas.addPassiveRenderAction((function(){e.render(!0),e.locked=!1})),{render:!0}}}},{key:"onPointerUp",value:function(){var r=this;if(this.status<3&&0===this.status)return this.selectedAnchor=null,this.status++,this._app.canvas.addPassiveRenderAction((function(){r.render(!0)})),{render:!0}}},{key:"onPointerMove",value:function(r,e){var t=this;if(e.pressed&&this.selectedAnchor)return this.moved=!0,this.selectedAnchor.x=r.x,this.selectedAnchor.y=r.y,this.selectedAnchor===this.primaryAnchor&&this.primaryHelper?(this.primaryHelper.x=this.selectedAnchor.x+this.primaryHelperOffset[0],this.primaryHelper.y=this.selectedAnchor.y+this.primaryHelperOffset[1]):this.selectedAnchor===this.secondaryAnchor&&this.secondaryHelper?(this.secondaryHelper.x=this.selectedAnchor.x+this.secondaryHelperOffset[0],this.secondaryHelper.y=this.selectedAnchor.y+this.secondaryHelperOffset[1]):this.selectedAnchor!==this.primaryHelper&&this.selectedAnchor!==this.secondaryHelper||this.refreshHelperOffset(),this._app.canvas.addPassiveRenderAction((function(){t.render(!0)})),{render:!0}}},{key:"addPoints",value:function(r){var e=this;r.forEach((function(r){e.points[Object(y.b)(r[0]-1,0,e._app.canvas.width-1)][Object(y.b)(r[1]-1,0,e._app.canvas.height-1)]=!0}))}},{key:"render",value:function(){var r=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.status>1?Object(l.curve)((function(e,t){var data=[].concat(r._brush.data);f.default.drawBrush({color:r._brush.primaryColor,data:data,x:e,y:t,app:r._app})}),this.primaryAnchor.x,this.primaryAnchor.y,this.primaryHelper.x,this.primaryHelper.y,this.secondaryHelper.x,this.secondaryHelper.y,this.secondaryAnchor.x,this.secondaryAnchor.y):Object(l.line)((function(e,t){var data=[].concat(r._brush.data);v.default.drawBrush({color:r._brush.primaryColor,data:data,x:e,y:t,app:r._app})}),this.primaryAnchor.x,this.primaryAnchor.y,this.secondaryAnchor.x,this.secondaryAnchor.y,{}),e&&(this.primaryHelper&&Object(l.line)((function(e,t){var n=r._app.canvas.getColorFromPixel(e,t);0===n.alpha?n=r.anchorBrush.primaryColor:n.invert();var data=[].concat(r.anchorBrush.data);v.default.drawBrush({color:n,data:data,x:e,y:t,app:r._app})}),this.primaryAnchor.x,this.primaryAnchor.y,this.primaryHelper.x,this.primaryHelper.y,{}),this.secondaryHelper&&Object(l.line)((function(e,t){var n=r._app.canvas.getColorFromPixel(e,t);0===n.alpha?n=r.anchorBrush.primaryColor:n.invert();var data=[].concat(r.anchorBrush.data);v.default.drawBrush({color:n,data:data,x:e,y:t,app:r._app})}),this.secondaryAnchor.x,this.secondaryAnchor.y,this.secondaryHelper.x,this.secondaryHelper.y,{}),this.drawAnchors())}},{key:"reset",value:function(){v.default.prototype.reset.apply(this,arguments),this.status=0,this.locked=!1}},{key:"intersect",value:function(r,e){for(var t=[[0,0],[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]],i=0;i<t.length;i++)if(this.points[r+t[Number(i)][0]][e+t[Number(i)][1]])return!0;return!1}},{key:"primaryAnchor",get:function(){return this.anchors[0]}},{key:"secondaryAnchor",get:function(){return this.anchors[1]}},{key:"primaryHelper",get:function(){return this.anchors[2]}},{key:"secondaryHelper",get:function(){return this.anchors[3]}}]),t}(v.default);function H(){var r=this,e=O(this.primaryAnchor,this.secondaryAnchor);this.addAnchor(e[0],e[1]),e=O(this.secondaryAnchor,this.primaryAnchor),this.addAnchor(e[0],e[1]),this.refreshHelperOffset(),this._app.canvas.addPassiveRenderAction((function(){r.render(!0),r.locked=!1})),this.status++}function x(){var r=this;return this._app.canvas.addRenderAction((function(){r.render(!1),r.reset()})),{events:!1,save:!0,render:!0}}function O(r,e){var t=Object(l.getLinePoints)(r.x,r.y,e.x,e.y);return t[Math.floor(t.length/4)]}}}]);