import{a as h,M as k}from"./BLIBATZL.js";import{C as f}from"./BJmh0rUk.js";import{C as m}from"./CzhYkgbF.js";import{T as v,g as _}from"./BkwK4Cot.js";import{T as y,c as C}from"./ErHjaCTb.js";import{N as T,u as g}from"./bd_6fOsN.js";import{T as b}from"./DanT3k3X.js";import{u as N}from"./B96-jXH8.js";import{_ as x,g as l,t as n,v as o,z as u,x as p,O as E,aa as w,F as $,Z as M,$ as P,L as R,C as V,a6 as S,a0 as j}from"./DoVacF4u.js";import"./D4lI5vpz.js";import"./ByT9DFw9.js";import"./W_y6kICn.js";import"./DoGjLmTD.js";import"./C5mdboMC.js";import"./yCANq8zb.js";import"./ey0azPGz.js";import"./BX5FD6hc.js";import"./BGIFtisS.js";import"./BG0OyHeb.js";import"./CNkvSXuu.js";import"./CzBXAPyu.js";import"./BUrrky6l.js";const I={components:{Navigation:T,SynthesizerTimelineCanvas:b},props:{model:{type:Object,required:!0}},emits:["refresh"],async setup(e){const t=S(e,"model"),s=N();return j(t,()=>{s.setContextMenu(C,{model:t.value,preserveContextMenu:s.preserveContextMenu})},{immediate:!0,deep:!0}),{...s,...await g()}},data:function(){return{toneDestination:null,tracksEdit:{}}},computed:{timelineRefreshKey(){return`timeline-${this.bpm}`},project(){return this.model[m.SYNTHESIZER_PROJECT]},tracks:{get(){return this.project.tracks},set(e){this.project.tracks=e}},bpm(){return Number(this.model[m.SYNTHESIZER_BPM])},controlsNavigation(){return{model:this.model,items:[[{text:`Project: ${this.project.name} | Tracks: ${this.tracks.length}`}]]}},masterVolume(){return this.core.config.observable[f.SCREEN_CONFIG].soundVolume},decibelValue(){return _(this.masterVolume)}},watch:{masterVolume:{handler(){k.volume.value=this.decibelValue},immediate:!0},tracks(){this.$nextTick(()=>{this.$emit("refresh")})},bpm:{handler(e){const t=this.tone.transport;t.stop(),t.bpm.value=120,t.seconds=0,t.bpm.value=e,t.start()}}},mounted(){this.$nextTick(()=>{this.$emit("refresh")})},unmounted(){this.model.actions.closeTracks()},methods:{async onClickPlay(){await this.tone.start(),this.players=this.tracks.map(s=>{const r=new y(s,{autoplay:!1});return r.createInstrument("Synth"),r});const e=h;e.stop(),e.seconds=0,e.start(),this.players.map(s=>s.play()).map(s=>s.start(0))},getControls(e){const t=e.getDuration();return{items:[{text:e.name},{spacer:!0},{text:` ${t}`},{label:"Edit",onClick:async()=>{console.log("Edit track",e),await this.tone.start(),this.editTrack(new v(e),{toneDestination:this.toneDestination})}},{label:"Remove",onClick:async()=>{this.preserveContextMenu(!0),await this.model.actions.removeTrack(e),this.preserveContextMenu(!1),this.$emit("refresh")}}]}},async editTrack(e){this.tracksEdit[e.id]=!0;const{close:t}=this.model.actions.editTrack(e),s=await t;this.tracks=this.tracks.map(r=>r.id===s.id?s:r),this.tracksEdit[e.id]=!1,this.$nextTick(()=>{this.$emit("refresh")})}}},z={class:"wb-disks-extras13-synthesizer-project"},D={class:"tracks"},F={key:0,class:"no-tracks"},O={class:"sheet"};function B(e,t,s,r,q,a){const c=l("navigation"),d=l("synthesizer-timeline-canvas");return o(),n("div",z,[u(c,E(w(a.controlsNavigation)),null,16),p("div",D,[a.tracks.length<1?(o(),n("div",F,"No tracks availableâ€¦")):$("",!0),(o(!0),n(M,null,P(a.tracks,i=>(o(),n("div",{key:i.id,class:"track"},[u(c,R({ref_for:!0},a.getControls(i)),null,16),p("div",O,[(o(),V(d,{key:a.timelineRefreshKey,track:i,static:e.tracksEdit[i.id],onRefresh:t[0]||(t[0]=G=>e.$emit("refresh"))},null,8,["track","static"]))])]))),128))])])}const ue=x(I,[["render",B],["__scopeId","data-v-5a4b88fd"]]);export{ue as default};
