var Ns=Object.defineProperty;var qs=(rt,J,Et)=>J in rt?Ns(rt,J,{enumerable:!0,configurable:!0,writable:!0,value:Et}):rt[J]=Et;var b=(rt,J,Et)=>qs(rt,typeof J!="symbol"?J+"":J,Et);(function(){"use strict";var rt=function(e,t){return rt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},rt(e,t)};function J(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");rt(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function Et(e,t,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function c(f){try{a(n.next(f))}catch(_){s(_)}}function u(f){try{a(n.throw(f))}catch(_){s(_)}}function a(f){f.done?i(f.value):o(f.value).then(c,u)}a((n=n.apply(e,t||[])).next())})}function Sr(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=c(0),s.throw=c(1),s.return=c(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function c(a){return function(f){return u([a,f])}}function u(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=a[0]&2?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[a[0]&2,i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(f){a=[6,f],o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}function qt(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ht(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],s;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(c){s={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i}function ue(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function zt(e){return this instanceof zt?(this.v=e,this):new zt(e)}function Fn(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(h){return function(m){return Promise.resolve(m).then(h,_)}}function c(h,m){n[h]&&(o[h]=function(g){return new Promise(function(L,x){i.push([h,g,L,x])>1||u(h,g)})},m&&(o[h]=m(o[h])))}function u(h,m){try{a(n[h](m))}catch(g){p(i[0][3],g)}}function a(h){h.value instanceof zt?Promise.resolve(h.value.v).then(f,_):p(i[0][2],h)}function f(h){u("next",h)}function _(h){u("throw",h)}function p(h,m){h(m),i.shift(),i.length&&u(i[0][0],i[0][1])}}function Rn(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof qt=="function"?qt(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(s){return new Promise(function(c,u){s=e[i](s),o(c,u,s.done,s.value)})}}function o(i,s,c,u){Promise.resolve(u).then(function(a){i({value:a,done:c})},s)}}typeof SuppressedError=="function"&&SuppressedError;function S(e){return typeof e=="function"}function vr(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var Le=vr(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function Er(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Me=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,o,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var c=qt(s),u=c.next();!u.done;u=c.next()){var a=u.value;a.remove(this)}}catch(g){t={error:g}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}else s.remove(this);var f=this.initialTeardown;if(S(f))try{f()}catch(g){i=g instanceof Le?g.errors:[g]}var _=this._finalizers;if(_){this._finalizers=null;try{for(var p=qt(_),h=p.next();!h.done;h=p.next()){var m=h.value;try{Cr(m)}catch(g){i=i??[],g instanceof Le?i=ue(ue([],Ht(i)),Ht(g.errors)):i.push(g)}}}catch(g){n={error:g}}finally{try{h&&!h.done&&(o=p.return)&&o.call(p)}finally{if(n)throw n.error}}}if(i)throw new Le(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)Cr(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&Er(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&Er(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}();Me.EMPTY;function zr(e){return e instanceof Me||e&&"closed"in e&&S(e.remove)&&S(e.add)&&S(e.unsubscribe)}function Cr(e){S(e)?e():e.unsubscribe()}var In={Promise:void 0},Vn={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,ue([e,t],Ht(r)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function kr(e){Vn.setTimeout(function(){throw e})}function Ar(){}function $n(e){e()}var Te=function(e){J(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,zr(r)&&r.add(n)):n.destination=Hn,n}return t.create=function(r,n,o){return new xe(r,n,o)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Me),Nn=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){le(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){le(n)}else le(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){le(r)}},e}(),xe=function(e){J(t,e);function t(r,n,o){var i=e.call(this)||this,s;return S(r)||!r?s={next:r??void 0,error:n??void 0,complete:o??void 0}:s=r,i.destination=new Nn(s),i}return t}(Te);function le(e){kr(e)}function qn(e){throw e}var Hn={closed:!0,next:Ar,error:qn,complete:Ar},Ue=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Dr(e){return e}function jn(e){return e.length===0?Dr:e.length===1?e[0]:function(r){return e.reduce(function(n,o){return o(n)},r)}}var G=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var o=this,i=Gn(t)?t:new xe(t,r,n);return $n(function(){var s=o,c=s.operator,u=s.source;i.add(c?c.call(i,u):u?o._subscribe(i):o._trySubscribe(i))}),i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=Or(r),new r(function(o,i){var s=new xe({next:function(c){try{t(c)}catch(u){i(u),s.unsubscribe()}},error:i,complete:o});n.subscribe(s)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[Ue]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return jn(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=Or(t),new t(function(n,o){var i;r.subscribe(function(s){return i=s},function(s){return o(s)},function(){return n(i)})})},e.create=function(t){return new e(t)},e}();function Or(e){var t;return(t=e??In.Promise)!==null&&t!==void 0?t:Promise}function Jn(e){return e&&S(e.next)&&S(e.error)&&S(e.complete)}function Gn(e){return e&&e instanceof Te||Jn(e)&&zr(e)}function Xn(e){return S(e==null?void 0:e.lift)}function Ct(e){return function(t){if(Xn(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function jt(e,t,r,n,o){return new Zn(e,t,r,n,o)}var Zn=function(e){J(t,e);function t(r,n,o,i,s,c){var u=e.call(this,r)||this;return u.onFinalize=s,u.shouldUnsubscribe=c,u._next=n?function(a){try{n(a)}catch(f){r.error(f)}}:e.prototype._next,u._error=i?function(a){try{i(a)}catch(f){r.error(f)}finally{this.unsubscribe()}}:e.prototype._error,u._complete=o?function(){try{o()}catch(a){r.error(a)}finally{this.unsubscribe()}}:e.prototype._complete,u}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t}(Te);function Qn(e){return e&&S(e.schedule)}function Kn(e){return e[e.length-1]}function Wn(e){return Qn(Kn(e))?e.pop():void 0}var Pe=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Lr(e){return S(e==null?void 0:e.then)}function Mr(e){return S(e[Ue])}function Tr(e){return Symbol.asyncIterator&&S(e==null?void 0:e[Symbol.asyncIterator])}function xr(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Yn(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Ur=Yn();function Pr(e){return S(e==null?void 0:e[Ur])}function Br(e){return Fn(this,arguments,function(){var r,n,o,i;return Sr(this,function(s){switch(s.label){case 0:r=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,zt(r.read())];case 3:return n=s.sent(),o=n.value,i=n.done,i?[4,zt(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,zt(o)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function Fr(e){return S(e==null?void 0:e.getReader)}function kt(e){if(e instanceof G)return e;if(e!=null){if(Mr(e))return to(e);if(Pe(e))return eo(e);if(Lr(e))return ro(e);if(Tr(e))return Rr(e);if(Pr(e))return no(e);if(Fr(e))return oo(e)}throw xr(e)}function to(e){return new G(function(t){var r=e[Ue]();if(S(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function eo(e){return new G(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function ro(e){return new G(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,kr)})}function no(e){return new G(function(t){var r,n;try{for(var o=qt(e),i=o.next();!i.done;i=o.next()){var s=i.value;if(t.next(s),t.closed)return}}catch(c){r={error:c}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}t.complete()})}function Rr(e){return new G(function(t){io(e,t).catch(function(r){return t.error(r)})})}function oo(e){return Rr(Br(e))}function io(e,t){var r,n,o,i;return Et(this,void 0,void 0,function(){var s,c;return Sr(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),r=Rn(e),u.label=1;case 1:return[4,r.next()];case 2:if(n=u.sent(),!!n.done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=u.sent(),o={error:c},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function dt(e,t,r,n,o){n===void 0&&(n=0),o===void 0&&(o=!1);var i=t.schedule(function(){r(),o?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!o)return i}function Ir(e,t){return t===void 0&&(t=0),Ct(function(r,n){r.subscribe(jt(n,function(o){return dt(n,e,function(){return n.next(o)},t)},function(){return dt(n,e,function(){return n.complete()},t)},function(o){return dt(n,e,function(){return n.error(o)},t)}))})}function Vr(e,t){return t===void 0&&(t=0),Ct(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function so(e,t){return kt(e).pipe(Vr(t),Ir(t))}function ao(e,t){return kt(e).pipe(Vr(t),Ir(t))}function co(e,t){return new G(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function uo(e,t){return new G(function(r){var n;return dt(r,t,function(){n=e[Ur](),dt(r,t,function(){var o,i,s;try{o=n.next(),i=o.value,s=o.done}catch(c){r.error(c);return}s?r.complete():r.next(i)},0,!0)}),function(){return S(n==null?void 0:n.return)&&n.return()}})}function $r(e,t){if(!e)throw new Error("Iterable cannot be null");return new G(function(r){dt(r,t,function(){var n=e[Symbol.asyncIterator]();dt(r,t,function(){n.next().then(function(o){o.done?r.complete():r.next(o.value)})},0,!0)})})}function lo(e,t){return $r(Br(e),t)}function fo(e,t){if(e!=null){if(Mr(e))return so(e,t);if(Pe(e))return co(e,t);if(Lr(e))return ao(e,t);if(Tr(e))return $r(e,t);if(Pr(e))return uo(e,t);if(Fr(e))return lo(e,t)}throw xr(e)}function Nr(e,t){return t?fo(e,t):kt(e)}function fe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Wn(e);return Nr(e,r)}var _o=vr(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function ho(e,t){return new Promise(function(r,n){var o=!1,i;e.subscribe({next:function(s){i=s,o=!0},error:n,complete:function(){o?r(i):n(new _o)}})})}function U(e,t){return Ct(function(r,n){var o=0;r.subscribe(jt(n,function(i){n.next(e.call(t,i,o++))}))})}var po=Array.isArray;function go(e,t){return po(t)?e.apply(void 0,ue([],Ht(t))):e(t)}function wo(e){return U(function(t){return go(e,t)})}function yo(e,t,r,n,o,i,s,c){var u=[],a=0,f=0,_=!1,p=function(){_&&!u.length&&!a&&t.complete()},h=function(g){return a<n?m(g):u.push(g)},m=function(g){a++;var L=!1;kt(r(g,f++)).subscribe(jt(t,function(x){t.next(x)},function(){L=!0},void 0,function(){if(L)try{a--;for(var x=function(){var D=u.shift();s||m(D)};u.length&&a<n;)x();p()}catch(D){t.error(D)}}))};return e.subscribe(jt(t,h,function(){_=!0,p()})),function(){}}function At(e,t,r){return r===void 0&&(r=1/0),S(t)?At(function(n,o){return U(function(i,s){return t(n,i,o,s)})(kt(e(n,o)))},r):(typeof t=="number"&&(r=t),Ct(function(n,o){return yo(n,o,e,r)}))}function mo(e){return At(Dr,e)}function bo(){return mo(1)}var So=["addListener","removeListener"],vo=["addEventListener","removeEventListener"],Eo=["on","off"];function Be(e,t,r,n){if(S(r)&&(n=r,r=void 0),n)return Be(e,t,r).pipe(wo(n));var o=Ht(ko(e)?vo.map(function(c){return function(u){return e[c](t,u,r)}}):zo(e)?So.map(qr(e,t)):Co(e)?Eo.map(qr(e,t)):[],2),i=o[0],s=o[1];if(!i&&Pe(e))return At(function(c){return Be(c,t,r)})(kt(e));if(!i)throw new TypeError("Invalid event target");return new G(function(c){var u=function(){for(var a=[],f=0;f<arguments.length;f++)a[f]=arguments[f];return c.next(1<a.length?a:a[0])};return i(u),function(){return s(u)}})}function qr(e,t){return function(r){return function(n){return e[r](t,n)}}}function zo(e){return S(e.addListener)&&S(e.removeListener)}function Co(e){return S(e.on)&&S(e.off)}function ko(e){return S(e.addEventListener)&&S(e.removeEventListener)}function Ao(e,t,r,n,o){return function(i,s){var c=r,u=t,a=0;i.subscribe(jt(s,function(f){var _=a++;u=c?e(u,f,_):(c=!0,f)},function(){c&&s.next(u),s.complete()}))}}function Do(e,t){return Ct(Ao(e,t,arguments.length>=2,!1,!0))}var Oo=function(e,t){return e.push(t),e};function Lo(){return Ct(function(e,t){Do(Oo,[])(e).subscribe(t)})}function Fe(e,t){return S(t)?At(e,t,1):At(e,1)}function _e(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function Hr(e,t){const{x:r,y:n,z:o}=t,{x:i,y:s,z:c,w:u}=e,a=u*r+s*o-c*n,f=u*n+c*r-i*o,_=u*o+i*n-s*r,p=-i*r-s*n-c*o,h=a*u+p*-i+f*-c-_*-s,m=f*u+p*-s+_*-i-a*-c,g=_*u+p*-c+a*-s-f*-i;return new t.constructor(h,m,g)}const Re=Math.PI,Ie=Math.PI*2;function Jt(e){let t=e%Ie;return t<-Re?t+=Ie:t>Re&&(t-=Ie),t}function Mo(e){return e>-1?e<1?Math.acos(e):0:Re}function To(e,[t,r,n]){const[o,i,s]=e;return new e.constructor(new o.constructor(o.x*t.x+i.x*t.y+s.x*t.z,o.y*t.x+i.y*t.y+s.y*t.z,o.z*t.x+i.z*t.y+s.z*t.z),new o.constructor(o.x*r.x+i.x*r.y+s.x*r.z,o.y*r.x+i.y*r.y+s.y*r.z,o.z*r.x+i.z*r.y+s.z*r.z),new o.constructor(o.x*n.x+i.x*n.y+s.x*n.z,o.y*n.x+i.y*n.y+s.y*n.z,o.z*n.x+i.z*n.y+s.z*n.z))}function xo(e,{x:t,y:r,z:n}){const[o,i,s]=e;return new o.constructor(o.x*t+i.x*r+s.x*n,o.y*t+i.y*r+s.y*n,o.z*t+i.z*r+s.z*n)}function Uo(e,[t,r,n]){return new e.constructor(e.dot(t),e.dot(r),e.dot(n))}function ut(e){return typeof e=="number"||(e==null?void 0:e.constructor)===Number}const Po=e=>{try{Ot(e),Zt(e,4)}catch(t){console.error("error while hijackDOMPoint"),console.error(t)}},Gt=0,Ve=1,$e=2,Ne=3,he=9999999999999,pe=void 0,jr=Symbol("vector length"),ge=Symbol("get source"),Jr=Symbol("checked");let q=pe,lt,Dt;const Bo=[0,1,2,6,24,120,720,5760,51840,518400,5702400,68428800,889574400,12454041600,186810624e3],qe=[];let nt=-1,He=!1;const de=[];function je(e,t,r){q=e,nt=-1,Dt=1;const n=t(r);if(!ut(n))throw new Error(`
      your assigned progress did not not return a primitive!
      calc() does not support logical operators (|| && ==) directly

      instead of calc(() => v1 || v2);
      use        calc(() => +v1 || +v2);

      instead of calc(() => v1);
      use        calc(v1);
      `);return n}function we(e){const t=e[ge];return t?t(e).length:e[jr]||3}function Fo(e,t){return we(e)>we(t)?e:t}function Ro(e,t){if(Dt+=1,t===he)return Dt;if(t>=we(e))return 0;const r=e[ge];if(r)return 1*r(e)[t];if(t===Gt)return 1*e.x;if(t===Ve)return 1*e.y;if(t===$e)return 1*e.z;if(t===Ne)return 1*e.w}function Gr(e,t,r){const n=e[ge];if(n){n(e)[t]=r;return}if(t===Gt){e.x=r;return}if(t===Ve){e.y=r;return}t===$e&&(e.z=r),t===Ne&&(e.w=r)}function Xt(e,t=void 0){if(typeof e!="function")throw new Error("no function assigned");if(q!==pe)throw new Error("something wrong, do you use calc() inside calc?");try{const r=typeof t>"u",n=typeof t=="function",o=!n&&!r?t:void 0,i=je(Gt,e,o);if(r&&typeof lt>"u")return i;const s=lt?we(lt):0;if(s===he){if(!e[Jr]){const f=je(he,e),_=Bo[Dt];if(Math.abs(f-_)>Number.EPSILON)throw new Error(`
            algebraic multiplication works only in calls with *

            calc(() => v * m);
            calc(() => m * v);
            calc(() => m * m);
            calc(() => m * m * v);

            `);e[Jr]=!0}let a=qe[0];for(let f=1;f<Dt-1;f+=1){const _=qe[f];if(!a.multiply)throw new Error(`cannot find method multiply() on ${a}`);a=a.multiply(_)}return a}let c=n?t.length:s;if(c||(c=s),c<s)throw new Error("Your assigned result Vector cant use higher space Operands than it has");const u=new Array(c);u[0]=i,o&&Gr(o,q,u[0]);for(let a=1;a<c;a+=1){const f=je(a,e,o);u[a]=f,o&&Gr(o,q,f)}return r?new lt.constructor(...u):n?t(...u):o}finally{q=pe,lt=void 0}}function Ot(e,t){const r=e.prototype;r[ge]=t;const n=r[Symbol.toPrimitive]||function(o){return o==="string"?this.toString():this.valueOf()};r[Symbol.toPrimitive]=function(o){return q===Gt&&(lt=lt?Fo(lt,this):this,qe[Dt-1]=this),q===pe?n.call(this,o):Ro(this,q)}}function Je(e){return function(...t){if(q===Gt){if(He)return e.apply(this,t);try{He=!0,nt+=1;const r=e.apply(this,t);return de[nt]=r,r}finally{He=!1}}return q===Ve||q===$e||q===Ne?(nt+=1,de[nt]):e.apply(this,t)}}function I(e,t){const r=e.prototype,n=r[t];r[t]=Je(n)}function ye(e,t){const r=e.prototype,n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(r,t,{get:Je(function(){return n.get.call(this)})})}function Zt(e,t){const r=e.prototype;Object.defineProperty(r,jr,{value:t})}function Xr(e){Zt(e,he)}function me(e){return Je(e)}typeof DOMPoint<"u"&&Po(DOMPoint);function Io(e){let t="";return e&&(t=`${e}-`),t}function Qt(e,t,r={}){const n=Io(e);return Object.entries(t).forEach(([o,i])=>{r[`--${n}${o}`]=i}),r}const Ge=0,Xe=1,X=Symbol("axes");function Vo(e,t,r,n){const o=Math.atan2(e,t),i=Math.atan2(r,n);return Jt(o-i)}function Zr(e){return e*e}class Z{constructor(...t){typeof t[0]=="function"?Xt(t[0],(r,n)=>{this[X]=[r,n]}):_e(t[0])?this[X]=[...t[0]]:t[0]&&ut(t[0].x)?this[X]=[t[0].x||0,t[0].y||0]:this[X]=[t[0]||0,t[1]||0]}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}normalize(){const{length:t}=this;return new this.constructor(this.x/t,this.y/t)}norm(){return this.normalize()}dot(t){return this.x*t.x+this.y*t.y}getRad(){return Jt(Math.atan2(this.y,this.x))}angleTo(t){return Vo(this.y,this.x,t.y,t.x)}rotate(t){const r=Math.sin(t),n=Math.cos(t),o=this.x*n-this.y*r,i=this.x*r+this.y*n;return new this.constructor(o,i)}distance(t){return Math.sqrt(Zr(this.x-t.x)+Zr(this.y-t.y))}dist(t){return this.distance(t)}toArray(){return[this.x,this.y]}calc(t){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(t){return this.x===t.x&&this.y===t.y}toJSON(){return{x:this.x,y:this.y}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,r={}){return Qt(t,this.toJSON(),r)}get lengthSq(){return this.dot(this)}get length(){return Math.sqrt(this.lengthSq)}get lensq(){return this.lengthSq}get len(){return this.length}get x(){return this[X][Ge]}set x(t){throw new Error("set x() not implemented")}get y(){return this[X][Xe]}set y(t){throw new Error("set y() not implemented")}get z(){throw new Error("get z() not implemented")}set z(t){throw new Error("set z() not implemented")}[Symbol.iterator](){return this[X].values()}}Ot(Z),Zt(Z,2),I(Z,"dot"),I(Z,"angleTo"),I(Z,"distance"),I(Z,"toArray"),I(Z,"getRad"),ye(Z,"length"),ye(Z,"lengthSq");let Qr=class Bn extends Z{set x(t){this[X][Ge]=t}set y(t){this[X][Xe]=t}get x(){return this[X][Ge]}get y(){return this[X][Xe]}calc(t){return Xt(t,this)}clone(){return new Bn(this.x,this.y)}};class Lt extends Z{toPoint(){return new Qr(this.x,this.y)}}const $o=me((e,t)=>new Qr(e,t)),Kt=(e,t)=>$o(e,t),No=me((e,t)=>new Lt(e,t)),y=(e,t)=>No(e,t);y(0,0),y(0,-1),y(-1,0);const Mt=0,Tt=1,xt=2,k=Symbol("axes");function Ze(e){return e*e}class V{constructor(...t){typeof t[0]=="function"?Xt(t[0],(r,n,o)=>{this[k]=[r,n,o]}):_e(t[0])?this[k]=[...t[0]]:t[0]&&ut(t[0].x)?this[k]=[t[0].x||0,t[0].y||0,t[0].z||0]:this[k]=[t[0]||0,t[1]||0,t[2]||0]}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}normalize(){const{length:t}=this;return new this.constructor(this.x/t,this.y/t,this.z/t)}norm(){return this.normalize()}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new this.constructor(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossNormalize(t){const r=this.cross(t),{length:n}=r;return r[k][Mt]/=n,r[k][Tt]/=n,r[k][xt]/=n,r}cn(t){return this.crossNormalize(t)}toAngles(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length)}}angleTo(t){return Jt(Mo(this.dot(t)/(this.length*t.length)))}multiply(t){return t.x===void 0?this.multiplyMat3(t):t.w===void 0?this.multiplyVec3(t):Hr(t,this)}multiplyMat3(t){return Uo(this,t)}multiplyVec3({x:t,y:r,z:n}){return new this.constructor(this.x*t,this.y*r,this.z*n)}distance(t){return Math.sqrt(Ze(this.x-t.x)+Ze(this.y-t.y)+Ze(this.z-t.z))}dist(t){return this.distance(t)}toArray(){return[this.x,this.y,this.z]}swizzle(t){const r=t.split("").map(n=>this[n]);return r.length===2?new Lt(r[0],r[1]):new this.constructor(r[0],r[1],r[2])}calc(t){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}toJSON(){return{x:this.x,y:this.y,z:this.z}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,r={}){return Qt(t,this.toJSON(),r)}get lengthSq(){return this.dot(this)}set lengthSq(t){throw new Error("set lengthSq() not implemented")}get length(){return Math.sqrt(this.lengthSq)}set length(t){throw new Error("set length() not implemented")}get lensq(){return this.lengthSq}set lensq(t){throw new Error("set lensq() not implemented")}get len(){return this.length}set len(t){throw new Error("set len() not implemented")}get x(){return this[k][Mt]}set x(t){throw new Error("set x() not implemented")}get y(){return this[k][Tt]}set y(t){throw new Error("set y() not implemented")}get z(){return this[k][xt]}set z(t){throw new Error("set z() not implemented")}get xy(){return new Lt(this[k][Mt],this[k][Tt])}set xy(t){throw new Error("set xz() not implemented")}get xz(){return new Lt(this[k][Mt],this[k][xt])}set xz(t){throw new Error("set xz() not implemented")}get yz(){return new Lt(this[k][Tt],this[k][xt])}set yz(t){throw new Error("set yz() not implemented")}[Symbol.iterator](){return this[k].values()}}Ot(V),Zt(V,3),I(V,"dot"),I(V,"cross"),I(V,"crossNormalize"),I(V,"toAngles"),I(V,"angleTo"),I(V,"rotate"),I(V,"distance"),I(V,"toArray"),ye(V,"length"),ye(V,"lengthSq");class Qe extends V{set x(t){this[k][Mt]=t}set y(t){this[k][Tt]=t}set z(t){this[k][xt]=t}get x(){return this[k][Mt]}get y(){return this[k][Tt]}get z(){return this[k][xt]}calc(t){return Xt(t,this)}clone(){return new Qe(this.x,this.y,this.z)}}class qo extends V{toVector(){return new Qe(this.x,this.y,this.z)}clone(){return this}}const Ho=me((e,t,r)=>new qo(e,t,r)),ft=(e,t,r)=>Ho(e,t,r);ft(0,0,0);const Kr=ft(0,0,-1);ft(0,0,1);const Ke=ft(-1,0,0);ft(1,0,0);const Wr=ft(0,1,0);ft(0,-1,0),ft(1,1,1);const ot=Symbol("angle rad"),Yr=Math.PI/180;class Ut{constructor(t){t instanceof Ut?this[ot]=t[ot]:this[ot]=Jt(t*Yr)}valueOf(){return this[ot]}toJSON(){return{angle:this[ot]}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,r={}){return Qt(t,this.toJSON(),r)}}class tn extends Ut{set(t){t instanceof Ut?this[ot]=t[ot]:this[ot]=Jt((t||0)*Yr)}}class jo extends Ut{toDegree(){return new tn(this[ot])}}new jo(0);function Jo(e){return new tn(e)}function Go(e){return ut(e)||e instanceof Ut}const wt=0,yt=1,mt=2,bt=3,Pt=Symbol("axes"),Xo=Symbol("forward cache"),Zo=Symbol("left cache"),Qo=Symbol("up cache"),Ko=Symbol("inverse cache");function Wo([e,t,r,n]){return Math.sqrt(e*e+t*t+r*r+n*n)}function Yo(e){const t=Wo(e);e[wt]/=t,e[yt]/=t,e[mt]/=t,e[bt]/=t}function ti(e,t){const r=e.normalize(),n=t.crossNormalize(r),o=r.crossNormalize(n),i=n.x,s=n.y,c=n.z,u=o.x,a=o.y,f=o.z,_=r.x,p=r.y,h=r.z,m=i+a+h,g=new Array(4);if(m>0){let D=Math.sqrt(m+1);return g[bt]=D*.5,D=.5/D,g[wt]=(f-p)*D,g[yt]=(_-c)*D,g[mt]=(s-u)*D,g}if(i>=a&&i>=h){const D=Math.sqrt(1+i-a-h),R=.5/D;return g[wt]=.5*D,g[yt]=(s+u)*R,g[mt]=(c+_)*R,g[bt]=(f-p)*R,g}if(a>h){const D=Math.sqrt(1+a-i-h),R=.5/D;return g[wt]=(u+s)*R,g[yt]=.5*D,g[mt]=(p+f)*R,g[bt]=(_-c)*R,g}const L=Math.sqrt(1+h-i-a),x=.5/L;return g[wt]=(_+c)*x,g[yt]=(p+f)*x,g[mt]=.5*L,g[bt]=(s-u)*x,g}function ei(e,t){const r=new Array(4),n=t*.5,o=Math.sin(n),i=Math.cos(n);return r[wt]=o*e.x,r[yt]=o*e.y,r[mt]=o*e.z,r[bt]=i,r}function We(e,t,r,n){if(ut(e))return[e,t,r,n];if(_e(e))return[...e];if(Go(t))return ei(e,t);if(e&&t)return ti(e,t)}function ri(e,t,r,n){return e&&ut(e.w)?We(e.x,e.y,e.z,e.w):We(e,t,r,n)||[0,0,0,1]}class Ye{constructor(t,r,n,o){this[Pt]=ri(t,r,n,o),Yo(this[Pt])}set(t,r,n,o){throw new Error("set x() not implemented")}multiply(t,r,n,o){if(ut(t.w))return this.multiplyQuaternion(t);const i=We(t,r,n,o);return i?this.multiplyQuaternion(new this.constructor(i)):this.multiplyVector(t)}multiplyVector(t){return Hr(this,t)}multiplyQuaternion(t){const r=this.x,n=this.y,o=this.z,i=this.w,s=t.x,c=t.y,u=t.z,a=t.w,f=i*s+r*a+n*u-o*c,_=i*c+n*a+o*s-r*u,p=i*u+o*a+r*c-n*s,h=i*a-r*s-n*c-o*u;return new this.constructor(f,_,p,h)}mul(t,r,n,o){return this.multiply(t,r,n,o)}get inverse(){const{x:t,y:r,z:n,w:o}=this;return this.constructor(t*-1,r*-1,n*-1,o)}get inv(){return this.inverse}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}get left(){return this.multiplyVector(Ke)}get dir(){return this.multiplyVector(Kr)}get up(){return this.multiplyVector(Wr)}get 0(){return this.left}get 1(){return this.dir}get 2(){return this.up}get x(){return this[Pt][wt]}set x(t){throw new Error("set x() not implemented")}get y(){return this[Pt][yt]}set y(t){throw new Error("set y() not implemented")}get z(){return this[Pt][mt]}set z(t){throw new Error("set z() not implemented")}get w(){return this[Pt][bt]}set w(t){throw new Error("set w() not implemented")}toJSON(){const{x:t,y:r,z:n,w:o}=this;return{x:t,y:r,z:n,w:o,a1:1-r*r*2-n*n*2,a2:t*r*2-n*o*2,a3:t*n*2+r*o*2,b1:t*r*2+n*o*2,b2:1-t*t*2-n*n*2,b3:r*n*2-t*o*2,c1:t*n*2-r*o*2,c2:r*n*2+t*o*2,c3:1-t*t*2-r*r*2}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,r={}){return Qt(t,this.toJSON(),r)}}Ot(Ye),Xr(Ye);function be(e,t,r){let n=e[t];return n||(n=r(),e[t]=n),n}class en extends Ye{get left(){return be(this,Zo,()=>this.multiplyVector(Ke))}get dir(){return be(this,Xo,()=>this.multiplyVector(Kr))}get up(){return be(this,Qo,()=>this.multiplyVector(Wr))}get inverse(){return be(this,Ko,()=>{const{x:t,y:r,z:n,w:o}=this;return this.constructor(t*-1,r*-1,n*-1,o)})}}const ni=me((e,t,r,n)=>new en(e,t,r,n)),oi=(e,t,r,n)=>ni(e,t,r,n);new en(Ke,Jo(90)),oi(0,0,0,1);const ii=0,si=1,ai=2,ci=3,it=Symbol("axes");class tr{constructor(t,r,n,o){typeof t=="function"?Xt(t,(i,s,c,u)=>{this[it]=[i,s,c,u]}):_e(t)?this[it]=[...t]:t&&ut(t.x)?this[it]=[t.x||0,t.y||0,t.z||0,t.w||0]:this[it]=[t||0,r||0,n||0,o||0]}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}toArray(){return[this.x,this.y,this.z,this.w]}calc(t){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}toJSON(){return{x:this.x,y:this.y,z:this.z,w:this.w}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,r={}){return Qt(t,this.toJSON(),r)}get x(){return this[it][ii]}set x(t){throw new Error("set x() not implemented")}get y(){return this[it][si]}set y(t){throw new Error("set y() not implemented")}get z(){return this[it][ai]}set z(t){throw new Error("set z() not implemented")}get w(){return this[it][ci]}set w(t){throw new Error("set w() not implemented")}[Symbol.iterator](){return this[it].values()}}Ot(tr),Zt(tr,4),I(tr,"toArray");const Wt=Symbol("data");class Se{constructor(...t){this[Wt]=t}get 0(){return this[Wt][0]}set 0(t){throw new Error("set [0] not implemented")}get 1(){return this[Wt][1]}set 1(t){throw new Error("set [1] not implemented")}get 2(){return this[Wt][2]}set 2(t){throw new Error("set [2] not implemented")}multiplyMat(t){return To(this,t)}multiplyVec(t){return xo(this,t)}multiply(t){if(t instanceof Se)return this.multiplyMat(t);const{x:r,y:n,z:o}=t;if(r===void 0||n===void 0||o===void 0)throw new Error(`multiply only works with mat3 and vec3, not supported ${t}`);return this.multiplyVec(t)}[Symbol.iterator](){return this[Wt].values()}}Ot(Se),Xr(Se);const ui=[{validator:()=>!0,handler:()=>e=>e.pipe(U(t=>t))}];class K{constructor(t,r){b(this,"validator");b(this,"handler");this.validator=t,this.handler=r}}const li=(e=[])=>[...e,...ui],fi=[{validator:()=>!0,handler:()=>e=>e.pipe(U(t=>t))}],_i=(e=[])=>[...e,...fi],rn={[Object.prototype.constructor.name]:e=>t=>t.pipe(U(Object.entries),Bt(e),U(Object.fromEntries)),[Array.prototype.constructor.name]:e=>t=>t.pipe(bo(),Bt(e),Lo()),[Promise.prototype.constructor.name]:e=>t=>t.pipe(Fe(r=>Nr(r)),Bt(e)),[G.prototype.constructor.name]:e=>t=>t.pipe(Fe(r=>r),Bt(e)),[void 0]:()=>e=>e};function hi(e=[]){return t=>t.pipe(Bt(li(e)))}function pi(e=[]){return t=>t.pipe(Bt(_i(e)))}function Bt(e){return t=>t.pipe(At(r=>{const n=gi(r),o=n&&rn[n];return o?fe(r).pipe(o(e)):fe(r)}),di(e))}function gi(e){if(e==null)return;const t=e.constructor;if(t){const r=t.name;if(Object.prototype.hasOwnProperty.call(rn,r))return r}}function di(e){return t=>t.pipe(Fe(r=>fe(r).pipe(wi(e,r).handler())))}const wi=(e,t)=>{const r=e.find(({validator:n})=>n(t));return r||{validator:()=>!0,handler:n=>n}};function yi(e,t,r){let n,o,i;if(t===0)n=o=i=r;else{const s=(a,f,_)=>(_<0&&(_+=1),_>1&&(_-=1),_<.16666666666666666?a+(f-a)*6*_:_<.5?f:_<.6666666666666666?a+(f-a)*(.6666666666666666-_)*6:a),c=r<.5?r*(1+t):r+t-r*t,u=2*r-c;n=s(u,c,e/360+1/3),o=s(u,c,e/360),i=s(u,c,e/360-1/3)}return{r:Math.round(n*255),g:Math.round(o*255),b:Math.round(i*255)}}let v=class gt{constructor(t,r=0,n=0,o=255){b(this,"r");if(this.g=r,this.b=n,this.a=o,Array.isArray(t))[this.r,this.g,this.b,this.a]=t;else if(typeof t=="string"){const i=gt.fromHex(t);this.r=i.r,this.g=i.g,this.b=i.b,this.a=i.a}else typeof t=="object"?(this.r=t.r||0,this.g=t.g||0,this.b=t.b||0,this.a=t.a!==void 0?t.a:255):(this.r=t,this.g=r||0,this.b=n||0,this.a=o===void 0?255:o);this.r=Math.min(Math.max(this.r,0),255),this.g=Math.min(Math.max(this.g,0),255),this.b=Math.min(Math.max(this.b,0),255),this.a=Math.min(Math.max(this.a,0),255)}static fromHex(t){t.length===4&&(t=`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`);const r=parseInt(t.slice(1,3),16),n=parseInt(t.slice(3,5),16),o=parseInt(t.slice(5,7),16),i=parseInt(t.slice(7,9),16);return new gt(r,n,o,isNaN(i)?255:i)}static fromHsl(t,r,n,o=255){const{r:i,g:s,b:c}=yi(t,r,n);return new gt(i,s,c,o)}static isValidHex(t){return/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(t)}toInverted(){return new gt(255-this.r,255-this.g,255-this.b,this.a)}toJSON(){return{_type:this.constructor.name,r:this.r,g:this.g,b:this.b,a:this.a}}toHex(){return`#${this.toRGBA().map(t=>t.toString(16).padStart(2,"0")).join("")}`}toRGB(){return[this.r,this.g,this.b]}toRGBA(){return[...this.toRGB(),this.a]}toCSSRGBA(){return[...this.toRGB(),this.a/255]}toHsl(){const t=this.r/255,r=this.g/255,n=this.b/255,o=Math.max(t,r,n),i=Math.min(t,r,n);let s=0,c=0;const u=(o+i)/2;if(o===i)s=c=0;else{const a=o-i;switch(c=u>.5?a/(2-o-i):a/(o+i),o){case t:s=(r-n)/a+(r<n?6:0);break;case r:s=(n-t)/a+2;break;case n:s=(t-r)/a+4;break}s/=6}return[Math.round(s*360),c,u]}toHsla(){const[t,r,n]=this.toHsl();return[t,r,n,this.a]}toHsv(){const t=this.r/255,r=this.g/255,n=this.b/255,o=Math.max(t,r,n),i=Math.min(t,r,n);let s=0,c=0;const u=o,a=o-i;if(o!==0)c=a/o;else return[0,0,0];if(o===i)s=0;else{switch(o){case t:s=(r-n)/a+(r<n?6:0);break;case r:s=(n-t)/a+2;break;case n:s=(t-r)/a+4;break}s/=6}return[Math.round(s*360),c,u]}toHsva(){const[t,r,n]=this.toHsv();return[t,r,n,this.a]}getHslaHue(){const[t]=this.toHsl();return t}getHslaSaturation(){const[t]=this.toHsl();return t}getHslaLightness(){const[t]=this.toHsl();return t}setHslaHue(t){const[r,n,o]=this.toHsl();return gt.fromHsl(r+t,n,o,this.a)}setHslaSaturation(t){const[r,n,o]=this.toHsl();return gt.fromHsl(r,n+t,o,this.a)}setHslaLightness(t){const[r,n,o]=this.toHsl();return gt.fromHsl(r,n,o+t,this.a)}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}};var E=(e=>(e.DEFAULT="default",e.REFRESH="refresh",e.REFRESH_SUCCESS="refreshSuccess",e.DEBUG="debug",e.INIT="init",e.INIT_SUCCESS="initSuccess",e.SYNC_STATE="syncState",e.SYNC_STATE_SUCCESS="syncStateSuccess",e.ADD_RENDER_WORKER_PORT="addRenderWorkerPort",e.ADD_RENDER_WORKER_PORT_SUCCESS="addRenderWorkerPortSuccess",e.LOAD_IMAGE="loadImage",e.LOAD_IMAGE_SUCCESS="loadImageSuccess",e.UPDATE_CANVAS="updateCanvas",e.UPDATE_BUFFER="updateBuffer",e.UPDATE_BUFFER_SUCCESS="updateBufferSuccess",e.STACK="stack",e.STACK_SUCCESS="stackSuccess",e.UNDO_STACK="undoStack",e.UNDO_STACK_SUCCESS="undoStackSuccess",e.REDO_STACK="redoStack",e.REDO_STACK_SUCCESS="redoStackSuccess",e.CLEAR="clear",e.CLEAR_SUCCESS="clearSuccess",e.SET_ZOOM="setZoom",e.SET_ZOOM_SUCCESS="setZoomSuccess",e.ZOOM_FIT="zoomFit",e.ZOOM_FIT_SUCCESS="zoomFitSuccess",e.SET_POSITION="setPosition",e.SET_POSITION_SUCCESS="setPositionSuccess",e.USE_TOOL="useTool",e.USE_TOOL_SUCCESS="useToolSuccess",e.SET_SELECT_OPTIONS="setSelectOptions",e.SET_SELECT_OPTIONS_SUCCESS="setSelectOptionsSuccess",e.GET_DATA="getData",e.GET_DATA_SUCCESS="getDataSuccess",e.RESIZE="resize",e.RESIZE_SUCCESS="resizeSuccess",e.RESIZE_CANVAS="resizeCanvas",e.RESIZE_CANVAS_SUCCESS="resizeCanvasSuccess",e.GET_COLORS="getColors",e.GET_COLORS_SUCCESS="getColorsSuccess",e.IMAGE_OPERATION="imageOperation",e.IMAGE_OPERATION_SUCCESS="imageOperationSuccess",e.COLOR_PICKER="colorPicker",e.COLOR_PICKER_SUCCESS="colorPickerSuccess",e.SET_OPTIONS="setOptions",e.SET_OPTIONS_SUCCESS="setOptionsSuccess",e.DRAW_RECTANGLE="drawRectangle",e.DRAW_RECTANGLE_SUCCESS="drawRectangleSuccess",e.DRAW_BRUSH="drawBrush",e))(E||{}),_t=(e=>(e.FILLED="filled",e.STROKED="stroked",e.STROKED_FILLED="stroked_filled",e))(_t||{}),Yt=(e=>(e.CIRCLE="circle",e.SQUARE="square",e.DOTS="dots",e))(Yt||{}),F=(e=>(e.NONE="none",e.DOTTED_FREEHAND="dotted_freehand",e.CONTINUOUS_FREEHAND="continuous_freehand",e.STRAIGHT_LINE="straight_line",e.CURVE_LINE="curve_line",e.FILL_TOOL="fill_tool",e.AIR_BRUSH="airbrush",e.RECTANGLE="rectangle",e.CIRCLE="circle",e.ELLIPSE="ellipse",e.POLYGON="polygon",e.CROP="crop",e.TEXT="text",e.SPLIT_SCREEN="splitScreen",e.MAGNIFY="magnify",e.ZOOM="zoom",e.STACK_REDO="stack_redo",e.STACK_UNDO="stack_undo",e.CLEAR="clear",e.ZOOM_FIT="zoom_fit",e.COLOR_PICKER="color_picker",e.IMAGE_OPERATION="image_operation",e))(F||{}),te=(e=>(e[e.CENTER=0]="CENTER",e[e.INSIDE=1]="INSIDE",e[e.OUTSIDE=2]="OUTSIDE",e))(te||{});y(-1,-1),y(0,-1),y(1,-1),y(-1,0),y(0,0),y(1,0),y(-1,1),y(0,1),y(1,1);class er{constructor(t){b(this,"origin");b(this,"position");b(this,"colors");b(this,"zoomLevel");b(this,"precision");const{origin:r,position:n,colors:o,zoomLevel:i}=t||{};this.origin=r||"center",this.position=n?y(n.x,n.y):y(0,0),this.colors={background:o!=null&&o.background?new v(o.background):new v(0,0,0),foreground:o!=null&&o.foreground?new v(o.foreground):new v(255,255,255),grid:o!=null&&o.grid?new v(o.grid):new v(0,0,0,.2)},this.zoomLevel=i||1,this.precision=3}toJSON(){return{_type:this.constructor.name,origin:this.origin,position:this.position.toJSON(),colors:{background:this.colors.background.toJSON(),foreground:this.colors.foreground.toJSON(),grid:this.colors.grid.toJSON()},zoomLevel:this.zoomLevel,precision:this.precision}}}class Q{constructor(t){b(this,"id");b(this,"color");const{id:r,color:n}=t||{};this.id=r||crypto.randomUUID(),this.color=n?new v(n):new v(0,0,0)}setColor(t){this.color=t}equal(t){return this.id===(t==null?void 0:t.id)}toJSON(){return{_type:this.constructor.name,id:this.id,color:this.color.toJSON()}}}class ve{constructor(t){b(this,"id");b(this,"name");b(this,"description");b(this,"colors");b(this,"locked");const{id:r,name:n,description:o,colors:i,locked:s}=t||{};this.id=r||crypto.randomUUID(),this.name=n||"",this.description=o,this.colors=(i||[]).map(c=>new Q(c)),this.locked=s}toJSON(){return{_type:this.constructor.name,id:this.id,name:this.name,description:this.description,colors:this.colors.map(t=>t.toJSON()),locked:this.locked}}}const mi=[new K(e=>e&&e instanceof Lt,()=>e=>e.pipe(U(t=>t.toJSON()))),new K(e=>e&&e instanceof er,()=>e=>e.pipe(U(t=>t.toJSON()))),new K(e=>e&&e instanceof v,()=>e=>e.pipe(U(t=>t.toJSON()))),new K(e=>e&&e instanceof Q,()=>e=>e.pipe(U(t=>t.toJSON()))),new K(e=>e&&e instanceof ve,()=>e=>e.pipe(U(t=>t.toJSON())))],bi=[new K(e=>typeof e=="object"&&"x"in e&&"y"in e,()=>e=>e.pipe(U(t=>y(t.x,t.y)))),new K(e=>e&&er.prototype.constructor.name===e._type,()=>e=>e.pipe(U(t=>new er(t)))),new K(e=>e&&v.prototype.constructor.name===e._type,()=>e=>e.pipe(U(t=>new v(t)))),new K(e=>e&&Q.prototype.constructor.name===e._type,()=>e=>e.pipe(U(t=>new Q(t)))),new K(e=>e&&ve.prototype.constructor.name===e._type,()=>e=>e.pipe(U(t=>new ve(t))))];function Si(){return e=>e.pipe(hi(mi))}function vi(){return e=>e.pipe(pi(bi))}const $={fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},nn={silent:{level:-1},fatal:{level:$.fatal},error:{level:$.error},warn:{level:$.warn},log:{level:$.log},info:{level:$.info},success:{level:$.success},fail:{level:$.fail},ready:{level:$.info},start:{level:$.info},box:{level:$.info},debug:{level:$.debug},trace:{level:$.trace},verbose:{level:$.verbose}};function rr(e){if(e===null||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.iterator in e?!1:Symbol.toStringTag in e?Object.prototype.toString.call(e)==="[object Module]":!0}function nr(e,t,r=".",n){if(!rr(t))return nr(e,{},r);const o=Object.assign({},t);for(const i in e){if(i==="__proto__"||i==="constructor")continue;const s=e[i];s!=null&&(Array.isArray(s)&&Array.isArray(o[i])?o[i]=[...s,...o[i]]:rr(s)&&rr(o[i])?o[i]=nr(s,o[i],(r?`${r}.`:"")+i.toString()):o[i]=s)}return o}function Ei(e){return(...t)=>t.reduce((r,n)=>nr(r,n,""),{})}const zi=Ei();function Ci(e){return Object.prototype.toString.call(e)==="[object Object]"}function ki(e){return!(!Ci(e)||!e.message&&!e.args||e.stack)}let or=!1;const on=[];class P{constructor(t={}){b(this,"options");b(this,"_lastLog");b(this,"_mockFn");const r=t.types||nn;this.options=zi({...t,defaults:{...t.defaults},level:ir(t.level,r),reporters:[...t.reporters||[]]},{types:nn,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const n in r){const o={type:n,...this.options.defaults,...r[n]};this[n]=this._wrapLogFn(o),this[n].raw=this._wrapLogFn(o,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(t){this.options.level=ir(t,this.options.types,this.options.level)}prompt(t,r){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(t,r)}create(t){const r=new P({...this.options,...t});return this._mockFn&&r.mockTypes(this._mockFn),r}withDefaults(t){return this.create({...this.options,defaults:{...this.options.defaults,...t}})}withTag(t){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+t:t})}addReporter(t){return this.options.reporters.push(t),this}removeReporter(t){if(t){const r=this.options.reporters.indexOf(t);if(r!==-1)return this.options.reporters.splice(r,1)}else this.options.reporters.splice(0);return this}setReporters(t){return this.options.reporters=Array.isArray(t)?t:[t],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const t in this.options.types)console["__"+t]||(console["__"+t]=console[t]),console[t]=this[t].raw}restoreConsole(){for(const t in this.options.types)console["__"+t]&&(console[t]=console["__"+t],delete console["__"+t])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(t,r){t&&(t.__write||(t.__write=t.write),t.write=n=>{this[r].raw(String(n).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(t){t&&t.__write&&(t.write=t.__write,delete t.__write)}pauseLogs(){or=!0}resumeLogs(){or=!1;const t=on.splice(0);for(const r of t)r[0]._logFn(r[1],r[2])}mockTypes(t){const r=t||this.options.mockFn;if(this._mockFn=r,typeof r=="function")for(const n in this.options.types)this[n]=r(n,this.options.types[n])||this[n],this[n].raw=this[n]}_wrapLogFn(t,r){return(...n)=>{if(or){on.push([this,t,n,r]);return}return this._logFn(t,n,r)}}_logFn(t,r,n){if((t.level||0)>this.level)return!1;const o={date:new Date,args:[],...t,level:ir(t.level,this.options.types)};!n&&r.length===1&&ki(r[0])?Object.assign(o,r[0]):o.args=[...r],o.message&&(o.args.unshift(o.message),delete o.message),o.additional&&(Array.isArray(o.additional)||(o.additional=o.additional.split(`
`)),o.args.push(`
`+o.additional.join(`
`)),delete o.additional),o.type=typeof o.type=="string"?o.type.toLowerCase():"log",o.tag=typeof o.tag=="string"?o.tag:"";const i=(c=!1)=>{const u=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&u>0){const a=[...this._lastLog.object.args];u>1&&a.push(`(repeated ${u} times)`),this._log({...this._lastLog.object,args:a}),this._lastLog.count=1}c&&(this._lastLog.object=o,this._log(o))};clearTimeout(this._lastLog.timeout);const s=this._lastLog.time&&o.date?o.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=o.date,s<this.options.throttle)try{const c=JSON.stringify([o.type,o.tag,o.args]),u=this._lastLog.serialized===c;if(this._lastLog.serialized=c,u&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin)){this._lastLog.timeout=setTimeout(i,this.options.throttle);return}}catch{}i(!0)}_log(t){for(const r of this.options.reporters)r.log(t,{options:this.options})}}function ir(e,t={},r=3){return e===void 0?r:typeof e=="number"?e:t[e]&&t[e].level!==void 0?t[e].level:r}P.prototype.add=P.prototype.addReporter,P.prototype.remove=P.prototype.removeReporter,P.prototype.clear=P.prototype.removeReporter,P.prototype.withScope=P.prototype.withTag,P.prototype.mock=P.prototype.mockTypes,P.prototype.pause=P.prototype.pauseLogs,P.prototype.resume=P.prototype.resumeLogs;function Ai(e={}){return new P(e)}class Di{constructor(t){b(this,"options");b(this,"defaultColor");b(this,"levelColorMap");b(this,"typeColorMap");this.options={...t},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(t){return t<1?console.__error||console.error:t===1?console.__warn||console.warn:console.__log||console.log}log(t){const r=this._getLogFn(t.level),n=t.type==="log"?"":t.type,o=t.tag||"",s=`
      background: ${this.typeColorMap[t.type]||this.levelColorMap[t.level]||this.defaultColor};
      border-radius: 0.5em;
      color: white;
      font-weight: bold;
      padding: 2px 0.5em;
    `,c=`%c${[o,n].filter(Boolean).join(":")}`;typeof t.args[0]=="string"?r(`${c}%c ${t.args[0]}`,s,"",...t.args.slice(1)):r(c,s,...t.args)}}function Oi(e={}){return Ai({reporters:e.reporters||[new Di({})],prompt(r,n={}){return n.type==="confirm"?Promise.resolve(confirm(r)):Promise.resolve(prompt(r))},...e})}const sr=Oi().withTag("webPaint");sr.withTag("workerManager"),sr.withTag("display");const sn=sr.withTag("worker"),ar=sn.withTag("main");sn.withTag("display");function Li(e,t){const r=t.payload;return r.port&&(e.displayWorkerPorts.push(r.port),e.debug&&ar.withTag("action").success("Added zoom worker port. Total ports:",e.displayWorkerPorts.length),e.setupDisplays()),{type:E.ADD_RENDER_WORKER_PORT_SUCCESS}}let l,ee=null;function cr(){return(ee===null||ee.byteLength===0)&&(ee=new Uint8Array(l.memory.buffer)),ee}function H(e,t){return e=e>>>0,cr().subarray(e/1,e/1+t)}function an(e){const t=l.__externref_table_alloc();return l.__wbindgen_export_2.set(t,e),t}function Mi(e,t){try{return e.apply(this,t)}catch(r){const n=an(r);l.__wbindgen_exn_store(n)}}const cn=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&cn.decode();function un(e,t){return e=e>>>0,cn.decode(cr().subarray(e,e+t))}function ht(e){return e==null}function d(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`)}function O(e){const t=l.__wbindgen_export_2.get(e);return l.__externref_table_dealloc(e),t}function Ti(e,t,r,n){d(r,st);var o=r.__destroy_into_raw();d(n,st);var i=n.__destroy_into_raw();const s=l.initBrush(e,t,o,i);if(s[1])throw O(s[0])}function xi(e,t,r,n){d(r,st);var o=r.__destroy_into_raw();d(n,st);var i=n.__destroy_into_raw();const s=l.setBrushSolid(e,t,o,i);if(s[1])throw O(s[0])}let A=0;function M(e,t){const r=t(e.length*1,1)>>>0;return cr().set(e,r/1),A=e.length,r}function Ui(e,t,r,n,o,i,s){var c=M(e,l.__wbindgen_malloc),u=A;d(t,z);var a=t.__destroy_into_raw();d(r,B);var f=r.__destroy_into_raw();d(n,B);var _=n.__destroy_into_raw();d(o,B);var p=o.__destroy_into_raw();d(i,B);var h=i.__destroy_into_raw();let m=0;ht(s)||(d(s,gn),m=s.__destroy_into_raw());const g=l.drawBezier(c,u,e,a,f,_,p,h,m);if(g[1])throw O(g[0])}function ur(e,t,r,n,o){var i=M(e,l.__wbindgen_malloc),s=A;d(t,z);var c=t.__destroy_into_raw();d(r,B);var u=r.__destroy_into_raw();d(n,B);var a=n.__destroy_into_raw();let f=0;ht(o)||(d(o,N),f=o.__destroy_into_raw());const _=l.drawLine(i,s,e,c,u,a,f);if(_[1])throw O(_[0])}let St=null;function Pi(){return(St===null||St.buffer.detached===!0||St.buffer.detached===void 0&&St.buffer!==l.memory.buffer)&&(St=new DataView(l.memory.buffer)),St}function Bi(e,t){const r=t(e.length*4,4)>>>0;for(let n=0;n<e.length;n++){const o=an(e[n]);Pi().setUint32(r+4*n,o,!0)}return A=e.length,r}function Fi(e,t,r,n){var o=M(e,l.__wbindgen_malloc),i=A;d(t,z);var s=t.__destroy_into_raw();const c=Bi(r,l.__wbindgen_malloc),u=A;d(n,vn);var a=n.__destroy_into_raw();const f=l.drawPolygon(o,i,e,s,c,u,a);if(f[1])throw O(f[0])}function Ri(e,t,r){var n=M(e,l.__wbindgen_malloc),o=A;d(t,z);var i=t.__destroy_into_raw();d(r,B);var s=r.__destroy_into_raw();const c=l.drawBrush(n,o,e,i,s);if(c[1])throw O(c[0])}function Ii(e,t,r,n,o){var i=M(e,l.__wbindgen_malloc),s=A;d(t,z);var c=t.__destroy_into_raw();d(r,B);var u=r.__destroy_into_raw();d(n,z);var a=n.__destroy_into_raw();d(o,zn);var f=o.__destroy_into_raw();const _=l.drawRectangle(i,s,e,c,u,a,f);if(_[1])throw O(_[0])}function Vi(e,t,r,n,o){var i=M(e,l.__wbindgen_malloc),s=A;d(t,z);var c=t.__destroy_into_raw();d(r,B);var u=r.__destroy_into_raw();d(n,z);var a=n.__destroy_into_raw();d(o,mn);var f=o.__destroy_into_raw();const _=l.drawEllipse(i,s,e,c,u,a,f);if(_[1])throw O(_[0])}function $i(e,t,r,n){var o=M(e,l.__wbindgen_malloc),i=A;d(t,z);var s=t.__destroy_into_raw();d(r,B);var c=r.__destroy_into_raw();d(n,st);var u=n.__destroy_into_raw();const a=l.drawFill(o,i,e,s,c,u);if(a[1])throw O(a[0])}function Ni(e,t,r,n,o,i){var s=M(e,l.__wbindgen_malloc),c=A;d(t,z);var u=t.__destroy_into_raw();d(r,B);var a=r.__destroy_into_raw();d(n,z);var f=n.__destroy_into_raw();d(o,st);var _=o.__destroy_into_raw();d(i,hn);var p=i.__destroy_into_raw();const h=l.drawAirBrush(s,c,e,u,a,f,_,p);if(h[1])throw O(h[0])}function ln(e,t,r,n){var o=M(e,l.__wbindgen_malloc),i=A;d(t,z);var s=t.__destroy_into_raw();d(r,B);var c=r.__destroy_into_raw();d(n,z);var u=n.__destroy_into_raw();const a=l.getPixels(o,i,e,s,c,u);if(a[3])throw O(a[2]);var f=H(a[0],a[1]).slice();return l.__wbindgen_free(a[0],a[1]*1,1),f}function fn(e,t,r,n,o,i){var s=M(e,l.__wbindgen_malloc),c=A;d(t,z);var u=t.__destroy_into_raw();d(r,B);var a=r.__destroy_into_raw();const f=M(n,l.__wbindgen_malloc),_=A;d(o,z);var p=o.__destroy_into_raw();const h=l.setPixels(s,c,e,u,a,f,_,p,i);if(h[1])throw O(h[0])}const lr=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}};lr.encodeInto;function fr(e,t){var r=M(e,l.__wbindgen_malloc),n=A;d(t,z);var o=t.__destroy_into_raw();const i=l.invert(r,n,e,o);if(i[3])throw O(i[2]);var s=H(i[0],i[1]).slice();return l.__wbindgen_free(i[0],i[1]*1,1),s}function qi(e,t){var r=M(e,l.__wbindgen_malloc),n=A;d(t,z);var o=t.__destroy_into_raw();const i=l.grayScale(r,n,e,o);if(i[3])throw O(i[2]);var s=H(i[0],i[1]).slice();return l.__wbindgen_free(i[0],i[1]*1,1),s}function Hi(e,t){var r=M(e,l.__wbindgen_malloc),n=A;d(t,z);var o=t.__destroy_into_raw();const i=l.sepia(r,n,e,o);if(i[3])throw O(i[2]);var s=H(i[0],i[1]).slice();return l.__wbindgen_free(i[0],i[1]*1,1),s}function ji(e,t,r){var n=M(e,l.__wbindgen_malloc),o=A;d(t,z);var i=t.__destroy_into_raw();const s=l.adjustBrightness(n,o,e,i,r);if(s[3])throw O(s[2]);var c=H(s[0],s[1]).slice();return l.__wbindgen_free(s[0],s[1]*1,1),c}function Ji(e,t,r){var n=M(e,l.__wbindgen_malloc),o=A;d(t,z);var i=t.__destroy_into_raw();const s=l.adjustContrast(n,o,e,i,r);if(s[3])throw O(s[2]);var c=H(s[0],s[1]).slice();return l.__wbindgen_free(s[0],s[1]*1,1),c}function Gi(e,t,r){var n=M(e,l.__wbindgen_malloc),o=A;d(t,z);var i=t.__destroy_into_raw();const s=l.adjustSaturation(n,o,e,i,r);if(s[3])throw O(s[2]);var c=H(s[0],s[1]).slice();return l.__wbindgen_free(s[0],s[1]*1,1),c}function Xi(e,t,r){var n=M(e,l.__wbindgen_malloc),o=A;d(t,z);var i=t.__destroy_into_raw();const s=l.sharpen(n,o,e,i,r);if(s[3])throw O(s[2]);var c=H(s[0],s[1]).slice();return l.__wbindgen_free(s[0],s[1]*1,1),c}function Zi(e,t,r){var n=M(e,l.__wbindgen_malloc),o=A;d(t,z);var i=t.__destroy_into_raw();const s=l.blur(n,o,e,i,r);if(s[3])throw O(s[2]);var c=H(s[0],s[1]).slice();return l.__wbindgen_free(s[0],s[1]*1,1),c}function Qi(e,t,r){var n=M(e,l.__wbindgen_malloc),o=A;d(t,z);var i=t.__destroy_into_raw();const s=l.emboss(n,o,e,i,r);if(s[3])throw O(s[2]);var c=H(s[0],s[1]).slice();return l.__wbindgen_free(s[0],s[1]*1,1),c}const _r=Object.freeze({Round:0,0:"Round",Square:1,1:"Square",Dots:2,2:"Dots"}),_n=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>l.__wbg_airburshoptions_free(e>>>0,1));class hn{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,_n.unregister(this),t}free(){const t=this.__destroy_into_raw();l.__wbg_airburshoptions_free(t,0)}get is_round(){return l.__wbg_get_airburshoptions_is_round(this.__wbg_ptr)!==0}set is_round(t){l.__wbg_set_airburshoptions_is_round(this.__wbg_ptr,t)}get num_dots(){return l.__wbg_get_airburshoptions_num_dots(this.__wbg_ptr)>>>0}set num_dots(t){l.__wbg_set_airburshoptions_num_dots(this.__wbg_ptr,t)}get max_alpha_factor(){return l.__wbg_get_airburshoptions_max_alpha_factor(this.__wbg_ptr)}set max_alpha_factor(t){l.__wbg_set_airburshoptions_max_alpha_factor(this.__wbg_ptr,t)}constructor(t,r,n){const o=l.airburshoptions_new(t,r,n);return this.__wbg_ptr=o>>>0,_n.register(this,this.__wbg_ptr,this),this}}const pn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>l.__wbg_bezieroptions_free(e>>>0,1));class gn{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,pn.unregister(this),t}free(){const t=this.__destroy_into_raw();l.__wbg_bezieroptions_free(t,0)}get segment_length(){return l.__wbg_get_bezieroptions_segment_length(this.__wbg_ptr)}set segment_length(t){l.__wbg_set_bezieroptions_segment_length(this.__wbg_ptr,t)}get gap_length(){return l.__wbg_get_bezieroptions_gap_length(this.__wbg_ptr)}set gap_length(t){l.__wbg_set_bezieroptions_gap_length(this.__wbg_ptr,t)}get interpolate_segments(){return l.__wbg_get_bezieroptions_interpolate_segments(this.__wbg_ptr)!==0}set interpolate_segments(t){l.__wbg_set_bezieroptions_interpolate_segments(this.__wbg_ptr,t)}constructor(t,r,n){const o=l.bezieroptions_new(t,r,n);return this.__wbg_ptr=o>>>0,pn.register(this,this.__wbg_ptr,this),this}}const dn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>l.__wbg_color_free(e>>>0,1));class st{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,dn.unregister(this),t}free(){const t=this.__destroy_into_raw();l.__wbg_color_free(t,0)}get r(){return l.__wbg_get_color_r(this.__wbg_ptr)}set r(t){l.__wbg_set_color_r(this.__wbg_ptr,t)}get g(){return l.__wbg_get_color_g(this.__wbg_ptr)}set g(t){l.__wbg_set_color_g(this.__wbg_ptr,t)}get b(){return l.__wbg_get_color_b(this.__wbg_ptr)}set b(t){l.__wbg_set_color_b(this.__wbg_ptr,t)}get a(){return l.__wbg_get_color_a(this.__wbg_ptr)}set a(t){l.__wbg_set_color_a(this.__wbg_ptr,t)}constructor(t,r,n,o){const i=l.color_new(t,r,n,o);return this.__wbg_ptr=i>>>0,dn.register(this,this.__wbg_ptr,this),this}equals(t){return d(t,st),l.color_equals(this.__wbg_ptr,t.__wbg_ptr)!==0}}const wn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>l.__wbg_dimension_free(e>>>0,1));class z{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,wn.unregister(this),t}free(){const t=this.__destroy_into_raw();l.__wbg_dimension_free(t,0)}constructor(t,r){const n=l.dimension_new(t,r);return this.__wbg_ptr=n>>>0,wn.register(this,this.__wbg_ptr,this),this}to_viewport_dimension(){const t=l.dimension_to_viewport_dimension(this.__wbg_ptr);return Ee.__wrap(t)}get x(){return l.__wbg_get_dimension_x(this.__wbg_ptr)>>>0}set x(t){l.__wbg_set_dimension_x(this.__wbg_ptr,t)}get y(){return l.__wbg_get_dimension_y(this.__wbg_ptr)>>>0}set y(t){l.__wbg_set_dimension_y(this.__wbg_ptr,t)}}const yn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>l.__wbg_ellipseoptions_free(e>>>0,1));class mn{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,yn.unregister(this),t}free(){const t=this.__destroy_into_raw();l.__wbg_ellipseoptions_free(t,0)}get style(){return l.__wbg_get_ellipseoptions_style(this.__wbg_ptr)}set style(t){l.__wbg_set_ellipseoptions_style(this.__wbg_ptr,t)}get line_options(){const t=l.__wbg_get_ellipseoptions_line_options(this.__wbg_ptr);return t===0?void 0:N.__wrap(t)}set line_options(t){let r=0;ht(t)||(d(t,N),r=t.__destroy_into_raw()),l.__wbg_set_ellipseoptions_line_options(this.__wbg_ptr,r)}get interpolate_segments(){return l.__wbg_get_ellipseoptions_interpolate_segments(this.__wbg_ptr)!==0}set interpolate_segments(t){l.__wbg_set_ellipseoptions_interpolate_segments(this.__wbg_ptr,t)}constructor(t,r,n){let o=0;ht(r)||(d(r,N),o=r.__destroy_into_raw());const i=l.ellipseoptions_new(t,o,n);return this.__wbg_ptr=i>>>0,yn.register(this,this.__wbg_ptr,this),this}}const hr=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>l.__wbg_lineoptions_free(e>>>0,1));class N{static __wrap(t){t=t>>>0;const r=Object.create(N.prototype);return r.__wbg_ptr=t,hr.register(r,r.__wbg_ptr,r),r}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,hr.unregister(this),t}free(){const t=this.__destroy_into_raw();l.__wbg_lineoptions_free(t,0)}get segment_length(){return l.__wbg_get_lineoptions_segment_length(this.__wbg_ptr)>>>0}set segment_length(t){l.__wbg_set_lineoptions_segment_length(this.__wbg_ptr,t)}get gap_length(){return l.__wbg_get_lineoptions_gap_length(this.__wbg_ptr)>>>0}set gap_length(t){l.__wbg_set_lineoptions_gap_length(this.__wbg_ptr,t)}constructor(t,r){const n=l.lineoptions_new(t,r);return this.__wbg_ptr=n>>>0,hr.register(this,this.__wbg_ptr,this),this}}const bn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>l.__wbg_point_free(e>>>0,1));class B{static __unwrap(t){return t instanceof B?t.__destroy_into_raw():0}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,bn.unregister(this),t}free(){const t=this.__destroy_into_raw();l.__wbg_point_free(t,0)}constructor(t,r){const n=l.dimension_new(t,r);return this.__wbg_ptr=n>>>0,bn.register(this,this.__wbg_ptr,this),this}to_render_point(){const t=l.dimension_to_viewport_dimension(this.__wbg_ptr);return dr.__wrap(t)}get x(){return l.__wbg_get_dimension_x(this.__wbg_ptr)>>>0}set x(t){l.__wbg_set_dimension_x(this.__wbg_ptr,t)}get y(){return l.__wbg_get_dimension_y(this.__wbg_ptr)>>>0}set y(t){l.__wbg_set_dimension_y(this.__wbg_ptr,t)}}const Sn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>l.__wbg_polygonoptions_free(e>>>0,1));class vn{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,Sn.unregister(this),t}free(){const t=this.__destroy_into_raw();l.__wbg_polygonoptions_free(t,0)}get style(){return l.__wbg_get_polygonoptions_style(this.__wbg_ptr)}set style(t){l.__wbg_set_polygonoptions_style(this.__wbg_ptr,t)}get line_options(){const t=l.__wbg_get_polygonoptions_line_options(this.__wbg_ptr);return t===0?void 0:N.__wrap(t)}set line_options(t){let r=0;ht(t)||(d(t,N),r=t.__destroy_into_raw()),l.__wbg_set_polygonoptions_line_options(this.__wbg_ptr,r)}constructor(t,r){let n=0;ht(r)||(d(r,N),n=r.__destroy_into_raw());const o=l.polygonoptions_new(t,n);return this.__wbg_ptr=o>>>0,Sn.register(this,this.__wbg_ptr,this),this}}const En=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>l.__wbg_rectangleoptions_free(e>>>0,1));class zn{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,En.unregister(this),t}free(){const t=this.__destroy_into_raw();l.__wbg_rectangleoptions_free(t,0)}get style(){return l.__wbg_get_rectangleoptions_style(this.__wbg_ptr)}set style(t){l.__wbg_set_rectangleoptions_style(this.__wbg_ptr,t)}get line_options(){const t=l.__wbg_get_rectangleoptions_line_options(this.__wbg_ptr);return t===0?void 0:N.__wrap(t)}set line_options(t){let r=0;ht(t)||(d(t,N),r=t.__destroy_into_raw()),l.__wbg_set_rectangleoptions_line_options(this.__wbg_ptr,r)}get stroke_align(){return l.__wbg_get_rectangleoptions_stroke_align(this.__wbg_ptr)}set stroke_align(t){l.__wbg_set_rectangleoptions_stroke_align(this.__wbg_ptr,t)}constructor(t,r,n){let o=0;ht(n)||(d(n,N),o=n.__destroy_into_raw());const i=l.rectangleoptions_new(t,r,o);return this.__wbg_ptr=i>>>0,En.register(this,this.__wbg_ptr,this),this}}const pr=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>l.__wbg_renderdimension_free(e>>>0,1));class Ee{static __wrap(t){t=t>>>0;const r=Object.create(Ee.prototype);return r.__wbg_ptr=t,pr.register(r,r.__wbg_ptr,r),r}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,pr.unregister(this),t}free(){const t=this.__destroy_into_raw();l.__wbg_renderdimension_free(t,0)}constructor(t,r){const n=l.dimension_new(t,r);return this.__wbg_ptr=n>>>0,pr.register(this,this.__wbg_ptr,this),this}abs(){const t=l.renderdimension_abs(this.__wbg_ptr);return Ee.__wrap(t)}get x(){return l.__wbg_get_dimension_x(this.__wbg_ptr)}set x(t){l.__wbg_set_dimension_x(this.__wbg_ptr,t)}get y(){return l.__wbg_get_dimension_y(this.__wbg_ptr)}set y(t){l.__wbg_set_dimension_y(this.__wbg_ptr,t)}}const gr=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>l.__wbg_renderposition_free(e>>>0,1));class dr{static __wrap(t){t=t>>>0;const r=Object.create(dr.prototype);return r.__wbg_ptr=t,gr.register(r,r.__wbg_ptr,r),r}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,gr.unregister(this),t}free(){const t=this.__destroy_into_raw();l.__wbg_renderposition_free(t,0)}constructor(t,r){const n=l.dimension_new(t,r);return this.__wbg_ptr=n>>>0,gr.register(this,this.__wbg_ptr,this),this}get x(){return l.__wbg_get_dimension_x(this.__wbg_ptr)}set x(t){l.__wbg_set_dimension_x(this.__wbg_ptr,t)}get y(){return l.__wbg_get_dimension_y(this.__wbg_ptr)}set y(t){l.__wbg_set_dimension_y(this.__wbg_ptr,t)}}async function Ki(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}else{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}function Wi(){const e={};return e.wbg={},e.wbg.__wbg_buffer_609cc3eee51ed158=function(t){return t.buffer},e.wbg.__wbg_getRandomValues_3c9c0d586e575a16=function(){return Mi(function(t,r){globalThis.crypto.getRandomValues(H(t,r))},arguments)},e.wbg.__wbg_new_a12002a7f91c75be=function(t){return new Uint8Array(t)},e.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(t,r,n){return new Uint8Array(t,r>>>0,n>>>0)},e.wbg.__wbg_point_unwrap=function(t){return B.__unwrap(t)},e.wbg.__wbindgen_copy_to_typed_array=function(t,r,n){new Uint8Array(n.buffer,n.byteOffset,n.byteLength).set(H(t,r))},e.wbg.__wbindgen_init_externref_table=function(){const t=l.__wbindgen_export_2,r=t.grow(4);t.set(0,void 0),t.set(r+0,void 0),t.set(r+1,null),t.set(r+2,!0),t.set(r+3,!1)},e.wbg.__wbindgen_memory=function(){return l.memory},e.wbg.__wbindgen_string_new=function(t,r){return un(t,r)},e.wbg.__wbindgen_throw=function(t,r){throw new Error(un(t,r))},e}function Yi(e,t){return l=e.exports,Cn.__wbindgen_wasm_module=t,St=null,ee=null,l.__wbindgen_start(),l}async function Cn(e){if(l!==void 0)return l;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL(""+new URL("wasm_bg-DT5IclWf.wasm",self.location.href).href,self.location.href));const t=Wi();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:n}=await Ki(await e,t);return Yi(r,n)}async function ts(e,t){return e.debug=t.payload.debug,await Cn(),{type:E.INIT_SUCCESS}}async function es({setSharedBuffer:e,setupDisplays:t},r){const{imageBitmap:n}=r.payload,o=n.width,i=n.height,s=o*i*4,c=new SharedArrayBuffer(s);return await rs(n,c,o,i),n.close(),e(c,y(o,i)),t(),{type:E.LOAD_IMAGE_SUCCESS}}async function rs(e,t,r,n){const i=new OffscreenCanvas(r,n).getContext("2d");i.drawImage(e,0,0,r,n);const s=i.getImageData(0,0,r,n);new Uint8ClampedArray(t).set(s.data)}async function ns(e,t){return await e.setSelectOptions(t.payload),{type:E.SET_SELECT_OPTIONS_SUCCESS}}function T(e){return new B(e.x,e.y)}function C(e){return new z(e.x,e.y)}function Ft(e){return new st(e.r,e.g,e.b,e.a)}function Rt(e){return new N(e.segmentLength||1,e.gapLength||0)}function os(e){return new gn(e.segmentLength||1,e.gapLength||0,e.interpolateSegments??!1)}function is(e){return new hn(e.round??!0,e.strength??100,e.weight??1)}function wr(e){switch(e){case _t.FILLED:return 0;case _t.STROKED:return 1;case _t.STROKED_FILLED:return 2;default:throw new Error(`Unknown shape style: ${e}`)}}function ss(e){switch(e){case te.INSIDE:return 0;case te.CENTER:return 1;case te.OUTSIDE:return 2;default:throw new Error(`Unknown stroke align: ${e}`)}}function as(e){return new zn(wr(e.style),ss(e.strokeAlign),Rt({segmentLength:e.segmentLength,gapLength:e.gapLength}))}function cs(e){return new mn(wr(e.style),Rt({segmentLength:e.segmentLength,gapLength:e.gapLength}),e.interpolateSegments??!1)}function us(e){return new vn(wr(e.style),Rt({segmentLength:e.segmentLength,gapLength:e.gapLength}))}function ls(e,t,r){let n=e.getTargetPosition(t.position,t);n=y(()=>Math.round(n));const o=e.getTargetPosition(r.lastPosition,{...t}),i=e.getDimension();ur(e.viewTest,C(i),T(o),T(n),Rt({segmentLength:e.useOptions.tool.segmentLength,gapLength:e.useOptions.tool.gapLength}))}function fs(e,t){const r=e.getTargetPosition(t.position,t),n=e.getDimension();Ri(e.viewTest,C(n),T(r))}var W=(e=>(e.START="start",e.MOVE="move",e.STOP="stop",e))(W||{});let re;function _s(e,t,r){switch(r.state){case W.START:re=new Uint8ClampedArray(e.sharedBuffer.buffer.slice(0)),console.log("GEOMETRY_LINE_STATE.START");break;case W.STOP:re&&(re=void 0),kn(e,t,r),console.log("GEOMETRY_LINE_STATE.STOP");break;case W.MOVE:re&&kn(e,t,r,re),console.log("GEOMETRY_LINE_STATE.MOVE");break}}function kn(e,t,r,n){var i;const{position:o}=t;if(r.anchorPositions&&r.anchorPositions.length>1){const[s,c]=r.anchorPositions,u=y(0,0);let a=e.getTargetPosition(s,t);a=y(()=>Math.round(a+u));let f=e.getTargetPosition(c||o,t);f=y(()=>Math.round(f+u)),n&&((i=e.view)==null||i.set(n)),ur(e.viewTest,C(e.getDimension()),T(a),T(f),Rt({segmentLength:e.useOptions.tool.segmentLength||1,gapLength:e.useOptions.tool.gapLength||0}))}}let ne;function hs(e,t,r){switch(r.state){case W.START:ne=new Uint8ClampedArray(e.sharedBuffer.buffer.slice(0));break;case W.STOP:ne&&(ne=void 0),An(e,t,r);break;case W.MOVE:ne&&An(e,t,r,ne);break}}function An(e,t,r,n){var i;const{position:o}=t;if(r.anchorPositions&&r.anchorPositions.length>1){const[s,c,u,a]=r.anchorPositions;if(r.anchorPositions.length>1){n&&((i=e.view)==null||i.set(n));const f=y(0,0);let _=e.getTargetPosition(s,t);_=y(()=>Math.round(_+f));let p=e.getTargetPosition(c||o,t);p=y(()=>Math.round(p+f));let h=e.getTargetPosition(u,t);h=y(()=>Math.round(h+f));let m=e.getTargetPosition(a,t);m=y(()=>Math.round(m+f)),r.anchorPositions.length>2?Ui(e.viewTest,C(e.getDimension()),T(_),T(h),T(p),T(m),os({segmentLength:e.useOptions.tool.segmentLength||1,gapLength:e.useOptions.tool.gapLength||0,interpolateSegments:e.useOptions.tool.interpolateSegments||!1})):ur(e.viewTest,C(e.getDimension()),T(_),T(p),Rt({segmentLength:e.useOptions.tool.segmentLength||1,gapLength:e.useOptions.tool.gapLength||0}))}}}function ps(e,t,r){var s;const n=e.getTargetPosition(t.position,t),o=((s=e.brushDescription)==null?void 0:s.getSize())||1,i=y(o,o);Ni(e.viewTest,C(e.getDimension()),T(y(n.x,n.y)),C(i),Ft(e.brushDescription.primaryColor),is({round:r.round,strength:e.useOptions.tool.airBrushStrength||100,weight:e.useOptions.tool.airBrushWeight||100}))}var ze=(e=>(e.START="START",e.MOVE="MOVE",e.STOP="STOP",e))(ze||{});let It;function gs(e,t,r){switch(r.state){case ze.START:It=new Uint8ClampedArray(e.sharedBuffer.buffer.slice(0));break;case ze.STOP:Dn(e,t,r,It),It&&(It=void 0);break;case ze.MOVE:It&&Dn(e,t,r,It);break}}function Dn(e,t,r,n){var a;const o=e.brushDescription.getScaledSize(!0),i=y(()=>-o/2);let s=e.getTargetPosition(r.position,t);s=y(()=>Math.round(s+i));const c=e.getTargetDimension(r.dimension,t);n&&((a=e.view)==null||a.set(n));const u=y(()=>Math.min(c,0));s=y(()=>Math.round(s+u)),Ii(e.viewTest,C(e.getDimension()),T(s),C(y(()=>Math.abs(c))),as({style:e.useOptions.tool.shapeStyle||_t.STROKED,strokeAlign:te.CENTER,fillColor:e.useOptions.color.secondaryColor.color,segmentLength:e.useOptions.tool.segmentLength||0,gapLength:e.useOptions.tool.gapLength||0}))}var Ce=(e=>(e.START="START",e.MOVE="MOVE",e.STOP="STOP",e))(Ce||{});let Vt;function On(e,t,r){switch(r.state){case Ce.START:Vt=new Uint8ClampedArray(e.sharedBuffer.buffer.slice(0));break;case Ce.STOP:Ln(e,t,r,Vt),Vt&&(Vt=void 0);break;case Ce.MOVE:Vt&&Ln(e,t,r,Vt);break}}function Ln(e,t,r,n){var a;const o=y(0,0),i=e.getTargetDimension(r.dimension,t),s=y(()=>Math.min(i,0));let c=e.getTargetPosition(r.position,t);c=y(()=>Math.round(c+o)+s);const u=y(()=>Math.abs(i));!u.x||!u.y||(n&&((a=e.view)==null||a.set(n)),Vi(e.viewTest,C(e.getDimension()),T(c),C(u),cs({style:e.useOptions.tool.shapeStyle||_t.STROKED,fillColor:e.brushDescription.secondaryColor,segmentLength:e.useOptions.tool.segmentLength||0,gapLength:e.useOptions.tool.gapLength||0,interpolateSegments:e.useOptions.tool.interpolateSegments})))}let oe;function ds(e,t,r){switch(r.state){case W.START:oe=new Uint8ClampedArray(e.sharedBuffer.buffer.slice(0));break;case W.STOP:oe&&(oe=void 0),Mn(e,t,r);break;case W.MOVE:oe&&Mn(e,t,r,oe);break}}function Mn(e,t,r,n){var o;if(r.anchorPositions&&r.anchorPositions.length>1){const i=y(0,0),s=c=>{const u=e.getTargetPosition(c,t);return y(()=>Math.round(u+i))};n&&((o=e.view)==null||o.set(n)),Fi(e.viewTest,C(e.getDimension()),r.anchorPositions.map(s).map(T),us({style:e.useOptions.tool.shapeStyle||_t.STROKED,segmentLength:e.useOptions.tool.segmentLength||0,gapLength:e.useOptions.tool.gapLength||0}))}}var ke=(e=>(e.START="START",e.MOVE="MOVE",e.STOP="STOP",e))(ke||{});let $t,ie;function ws(e,t,r){switch(r.state){case ke.START:{const{position:n,dimension:o}=r,i=y(()=>Math.min(o,0)),s=y(()=>n+i),c=Math.abs(o.x),u=Math.abs(o.y),a=e.getTargetDimension(y(c,u),t),f=ln(e.view,C(e.getDimension()),T(e.getTargetPosition(s,t)),C(a));ie=fr(f,C(a)),fn(e.view,C(e.getDimension()),T(e.getTargetPosition(s,t)),new Uint8Array(Array(ie.length/4).fill([0,0,0,0]).flat()),C(a),r.copy||!1),$t=new Uint8Array(e.sharedBuffer.buffer.slice(0))}break;case ke.STOP:{const n=Math.abs(r.dimension.x),o=Math.abs(r.dimension.y),i=e.getTargetDimension(y(n,o),t);ie=fr(ie,C(i)),Tn(e,t,r,$t),$t&&($t=void 0)}break;case ke.MOVE:$t&&Tn(e,t,r,$t);break}}function Tn(e,t,r,n){var u;n&&((u=e.view)==null||u.set(n));const o=y(()=>Math.abs(r.dimension)),i=y(()=>Math.min(r.dimension,0)),s=y(()=>r.position+i),c=e.getTargetPosition(s,t,{round:!0});fn(e.view,C(e.getDimension()),T(y(()=>Math.round(c))),ie,C(e.getTargetDimension(o,t)),!1)}function ys(e){var t,r,n;(n=e.view)==null||n.set(new Uint8ClampedArray(new Array(((t=e.sharedBuffer)==null?void 0:t.dimension.x)*((r=e.sharedBuffer)==null?void 0:r.dimension.y)*4).fill(255)))}function ms(e,t,r){const n=e.getTargetPosition(t.position,t),o=e.getDimension();$i(e.viewTest,C(o),T(n),Ft(e.brushDescription.primaryColor))}function bs(e,t){const r=e.getTargetPosition(t.position,t);return{type:E.COLOR_PICKER_SUCCESS,payload:{position:r,color:e.isIntersect(r)?e.getColorAtPosition(r):void 0}}}var se=(e=>(e.NEAREST_NEIGHBOR="nearestNeighbor",e.BILINEAR="bilinear",e.BICUBIC="bicubic",e.LANCZOS="lanczos",e))(se||{}),Y=(e=>(e.GRAYSCALE="grayscale",e.INVERT="invert",e.SEPIA="sepia",e.BRIGHTNESS="brightness",e.CONTRAST="contrast",e.SATURATION="saturation",e.SHARPEN="sharpen",e.BLUR="blur",e.EMBOSS="emboss",e.EDGE_DETECT="edge_detect",e.THRESHOLD="threshold",e.COLORIZE="colorize",e.CUSTOM="custom",e))(Y||{});function Ss(e,t){var n,o,i,s,c,u,a,f,_;const r=C(e.getDimension());switch(t.type){case Y.GRAYSCALE:(n=e.view)==null||n.set(qi(e.view,r));break;case Y.INVERT:(o=e.view)==null||o.set(fr(e.view,r));break;case Y.SEPIA:(i=e.view)==null||i.set(Hi(e.view,r));break;case Y.BRIGHTNESS:(s=e.view)==null||s.set(ji(e.view,r,t.value/100));break;case Y.CONTRAST:(c=e.view)==null||c.set(Ji(e.view,r,t.value/100));break;case Y.SATURATION:(u=e.view)==null||u.set(Gi(e.view,r,t.value/100));break;case Y.SHARPEN:(a=e.view)==null||a.set(Xi(e.view,r,t.value));break;case Y.BLUR:(f=e.view)==null||f.set(Zi(e.view,r,t.value));break;case Y.EMBOSS:(_=e.view)==null||_.set(Qi(e.view,r,t.value/100));break}}async function vs(e,t){const{payload:r}=t,{tool:n,meta:o,toolOptions:i}=r;r.toolOptions.stackable&&e.actionStack.active&&e.addActionStack(n,r);const s=await Ae(e,{tool:n,meta:o,toolOptions:i});return e.updateDisplays(),s||{type:E.USE_TOOL_SUCCESS}}function Ae(e,{tool:t,meta:r,toolOptions:n}){switch(t){case F.CLEAR:ys(e);break;case F.DOTTED_FREEHAND:fs(e,r);break;case F.CONTINUOUS_FREEHAND:ls(e,r,n);break;case F.STRAIGHT_LINE:_s(e,r,n);break;case F.CURVE_LINE:hs(e,r,n);break;case F.AIR_BRUSH:ps(e,r,n);break;case F.RECTANGLE:gs(e,r,n);break;case F.CIRCLE:On(e,r,n);break;case F.ELLIPSE:On(e,r,n);break;case F.POLYGON:ds(e,r,n);break;case F.FILL_TOOL:ms(e,r);break;case F.CROP:ws(e,r,n);break;case F.IMAGE_OPERATION:Ss(e,n);break;case F.COLOR_PICKER:return bs(e,r);default:console.warn(`Tool ${t} is not implemented or not supported in this context.`)}}var ae=(e=>(e.START="start",e.STOP="stop",e.FORWARD="forward",e.BACKWARD="backward",e))(ae||{});async function Es(e,t){switch(t.payload.action){case ae.START:e.actionStack.start();break;case ae.STOP:e.actionStack.stop();break;case ae.FORWARD:await e.actionStack.forward();break;case ae.BACKWARD:await e.actionStack.backward()}return{type:E.STACK_SUCCESS}}async function zs(e,t){const r=new Uint8ClampedArray(e.sharedBuffer.buffer);return[{type:E.GET_DATA_SUCCESS,payload:{dimension:e.getDimension(),buffer:r}},[]]}function Cs(e,t,r,n,o){const i=new Uint8ClampedArray(n*o*4),s=t/n,c=r/o;for(let u=0;u<o;u++)for(let a=0;a<n;a++){const f=Math.floor(a*s),p=(Math.floor(u*c)*t+f)*4,h=(u*n+a)*4;i[h]=e[p],i[h+1]=e[p+1],i[h+2]=e[p+2],i[h+3]=e[p+3]}return i}function ks(e,t,r,n,o){const i=new Uint8ClampedArray(n*o*4),s=t/n,c=r/o,u=(a,f,_)=>Math.max(f,Math.min(a,_));for(let a=0;a<o;a++)for(let f=0;f<n;f++){const _=f*s,p=a*c,h=Math.floor(_),m=Math.floor(p),g=Math.ceil(_),L=Math.ceil(p),x=_-h,D=p-m,R=(u(m,0,r-1)*t+u(h,0,t-1))*4,ct=(u(m,0,r-1)*t+u(g,0,t-1))*4,vt=(u(L,0,r-1)*t+u(h,0,t-1))*4,tt=(u(L,0,r-1)*t+u(g,0,t-1))*4,et=(a*n+f)*4;for(let j=0;j<4;j++){const Nt=e[R+j],ce=e[ct+j],mr=e[vt+j],br=e[tt+j],Oe=Nt*(1-x)+ce*x,$s=mr*(1-x)+br*x;i[et+j]=Math.round(Oe*(1-D)+$s*D)}}return i}function As(e,t,r,n,o){const i=new Uint8ClampedArray(n*o*4),s=t/n,c=r/o,u=_=>(_=Math.abs(_),_<=1?(1.5*_-2.5)*_*_+1:_<=2?((-.5*_+2.5)*_-4)*_+2:0),a=(_,p,h,m,g,L)=>(m=Math.round(f(m,0,p-1)),g=Math.round(f(g,0,h-1)),_[(g*p+m)*4+L]),f=(_,p,h)=>Math.max(p,Math.min(_,h));for(let _=0;_<o;_++)for(let p=0;p<n;p++){const h=p*s,m=_*c,g=Math.floor(h),L=Math.floor(m),x=h-g,D=m-L,R=(_*n+p)*4;for(let ct=0;ct<4;ct++){let vt=0;for(let tt=-1;tt<=2;tt++)for(let et=-1;et<=2;et++){const j=a(e,t,r,g+et,L+tt,ct),Nt=u(x-et),ce=u(D-tt);vt+=j*Nt*ce}i[R+ct]=Math.round(f(vt,0,255))}}return i}function Ds(e,t,r,n,o){const i=new Uint8ClampedArray(n*o*4),s=t/n,c=r/o,u=3,a=p=>{if(p=Math.abs(p),p===0)return 1;if(p>=u)return 0;const h=Math.PI*p;return u*Math.sin(h)*Math.sin(h/u)/(h*h)},f=(p,h,m,g,L,x)=>(g=Math.round(_(g,0,h-1)),L=Math.round(_(L,0,m-1)),p[(L*h+g)*4+x]),_=(p,h,m)=>Math.max(h,Math.min(p,m));for(let p=0;p<o;p++)for(let h=0;h<n;h++){const m=h*s,g=p*c,L=Math.floor(m),x=Math.floor(g),D=(p*n+h)*4;for(let R=0;R<4;R++){let ct=0,vt=0;for(let tt=-2;tt<=u;tt++)for(let et=-2;et<=u;et++){const j=L+et,Nt=x+tt,ce=f(e,t,r,j,Nt,R),mr=a(m-j),br=a(g-Nt),Oe=mr*br;ct+=ce*Oe,vt+=Oe}i[D+R]=Math.round(_(ct/vt,0,255))}}return i}async function Os(e,t){const{payload:r}=t,n=new SharedArrayBuffer(r.dimension.x*r.dimension.y*4),o=new Uint8ClampedArray(n),i={[se.NEAREST_NEIGHBOR]:Cs,[se.BILINEAR]:ks,[se.BICUBIC]:As,[se.LANCZOS]:Ds},{x:s,y:c}=e.getDimension(),u=i[r.type](e.view,s,c,r.dimension.x,r.dimension.y);return o.set(u,0),e.setSharedBuffer(n,r.dimension),e.setupDisplays(),[{type:E.RESIZE_CANVAS_SUCCESS,payload:{dimension:e.getDimension()}},[]]}var pt=(e=>(e.LEFT_TOP="left_top",e.TOP="top",e.RIGHT_TOP="right_top",e.LEFT="left",e.CENTER="center",e.RIGHT="right",e.LEFT_BOTTOM="left_bottom",e.BOTTOM="bottom",e.RIGHT_BOTTOM="right_bottom",e))(pt||{});async function Ls(e,t){const r=e.getDimension(),{payload:n}=t,o=new SharedArrayBuffer(n.dimension.x*n.dimension.y*4),i=new Uint8ClampedArray(o);let s=Kt(0,0);[pt.RIGHT,pt.RIGHT_TOP,pt.RIGHT_BOTTOM].includes(n.origin)&&(s.x=n.dimension.x-r.x),[pt.BOTTOM,pt.LEFT_BOTTOM,pt.RIGHT_BOTTOM].includes(n.origin)&&(s.y=n.dimension.y-r.y),[pt.CENTER].includes(n.origin)&&(s=Kt(()=>(n.dimension-r)/2));const c=Kt(()=>Math.floor(s)),u=Kt(()=>Math.min(c,0)),a=Kt(()=>Math.max(c,0)),f=Math.min(e.view.length/(r.x*4),n.dimension.y);for(let _=0;_<f;_++){const p=_*r.x*4+Math.abs(u.y)*r.x*4,h=new Uint8ClampedArray(n.dimension.x*4);console.log("y",JSON.stringify({y_:p,offsetN:u,offsetP:a,offset:s,x:[p,p+Math.min(r.x,n.dimension.x)*4]},null,2)),h.set(e.view.subarray(p+Math.abs(u.x*4),p+Math.min(r.x,n.dimension.x)*4+Math.abs(u.x*4)),a.x*4),i.set(h,_*n.dimension.x*4+a.y*n.dimension.x*4)}return e.setSharedBuffer(o,n.dimension),e.setupDisplays(),[{type:E.RESIZE_CANVAS_SUCCESS,payload:{dimension:e.getDimension()}},[]]}async function Ms(e,t){const r=e.view,n=new Set;for(let o=0;o<r.length;o+=4){const i=new v(r[o],r[o+1],r[o+2],r[o+3]);n.add(i.toHex())}return[{type:E.GET_DATA_SUCCESS,payload:{colors:Array.from(n).map(o=>v.fromHex(o))}},[]]}async function Ts(e,t){const{type:r}=t,n=ar.withTag("Incoming").withTag("action");switch(e.debug&&n.withTag(r).start(t),r){case E.INIT:return ts(e,t);case E.ADD_RENDER_WORKER_PORT:return Li(e,t);case E.SET_SELECT_OPTIONS:return ns(e,t);case E.USE_TOOL:return vs(e,t);case E.LOAD_IMAGE:return es(e,t);case E.STACK:return Es(e,t);case E.GET_DATA:return zs(e);case E.RESIZE:return Os(e,t);case E.RESIZE_CANVAS:return Ls(e,t);case E.GET_COLORS:return Ms(e);default:e.debug&&n.warn("Unknown message type from Creator Thread:",r)}}function xs(){return{type:Yt.CIRCLE,size:5}}function Us(){return{shapeStyle:_t.STROKED_FILLED,value:F.NONE,segmentLength:1,gapLength:0,interpolateSegments:!1,airBrushStrength:50,airBrushWeight:1}}function Ps(){return{primaryColor:new Q({color:new v(0,0,0)}),secondaryColor:new Q({color:new v(255,0,0)}),palette:new ve({name:"Default Palette",colors:[new Q({color:new v(0,0,0,0)}),new Q({color:new v(0,0,0)}),new Q({color:new v(255,0,0)}),new Q({color:new v(0,255,0)}),new Q({color:new v(0,0,255)})]}),paletteSteps:new v(4,1,1)}}class yr{constructor(t={}){b(this,"size");b(this,"primaryColor");b(this,"secondaryColor");b(this,"scale",1);const{size:r,primaryColor:n,secondaryColor:o}=t;this.size=r!==void 0?r:1,this.primaryColor=n||new v(0,0,0),this.secondaryColor=o||new v(255,255,255)}getSize(){return this.size}async setSize(t){this.size=t}getScaledSize(t=!1){const r=this.getSize();return t?r*this.scale:r}}class Bs extends yr{getScaledSize(t=!1){const r=this.getSize();return t?r*this.scale:r}}class xn extends yr{}class Un extends yr{getScaledSize(t=!1){const r=(this.getSize()-1)*2+1;return t?r*this.scale:r}}function Fs(e){switch(e){case Yt.CIRCLE:return Bs;case Yt.SQUARE:return xn;case Yt.DOTS:return Un;default:throw new Error(`Unknown brush type: ${e}`)}}class Rs{constructor({maxStackSize:t,onForward:r,onBackward:n,onComplete:o,onLimitReached:i}){b(this,"maxStackSize",20);b(this,"stack",[]);b(this,"subStack");b(this,"onAdd");b(this,"onForward");b(this,"onBackward");b(this,"onComplete");b(this,"onLimitReached");b(this,"index",-1);t&&(this.maxStackSize=t),this.onForward=r,this.onBackward=n,this.onComplete=o,this.onLimitReached=i}start(){this.index<this.stack.length-1&&(this.stack=this.getStackAtIndex(this.index)),this.subStack=[]}async add(t){var r;if(!this.subStack)throw new Error("Stack not started. Call start() before adding items.");t=await((r=this.onAdd)==null?void 0:r.call(this,t))||t,this.subStack.push(t)}stop(){var t;if(this.subStack&&(this.stack.push(this.subStack),this.subStack=void 0),this.stack.length>this.maxStackSize){const r=this.stack.shift();this.onLimitReached&&r&&this.onLimitReached(r)}this.index=this.stack.length-1,(t=this.onComplete)==null||t.call(this)}async forward(){var t;if(this.index<this.stack.length-1){const r=this.index;this.index++,await((t=this.onForward)==null?void 0:t.call(this,this,this.index,r))}}async backward(){var t;if(this.index>-1){const r=this.index;this.index--,await((t=this.onBackward)==null?void 0:t.call(this,this,this.index,r))}}getStackAtIndex(t){return console.log("getStackAtIndex",0,Math.max(t+1,0),this.stack),this.stack.slice(0,Math.max(t+1,0))}getStack(){return this.stack}get active(){return this.subStack!==void 0}get length(){return this.stack.length}get subStackLength(){return this.stack.reduce((t,r)=>t+r.length,0)}clear(){this.stack=[],this.subStack=void 0,this.index=-1}}let Pn=!0,at;const w={debug:!1,displayWorkerPorts:[],sharedBuffer:void 0,tmpSharedBuffer:void 0,view:void 0,useOptions:{tool:Us(),brush:xs(),color:Ps()},brushDescription:void 0,actionStack:new Rs({maxStackSize:50,onForward:async(e,t)=>{var r;at=w.useOptions,(r=w.view)==null||r.set(new Uint8ClampedArray(w.tmpSharedBuffer.buffer));for(const{payload:n,selectOptions:o}of e.getStackAtIndex(t).flat())w.setBrush(o.brush,o.color),await Ae({...w,useOptions:o},n);w.updateClient(),w.updateDisplays(),at&&w.setSelectOptions(at)},onBackward:async(e,t)=>{var r;at=w.useOptions,(r=w.view)==null||r.set(new Uint8ClampedArray(w.tmpSharedBuffer.buffer));for(const{payload:n,selectOptions:o}of e.getStackAtIndex(t).flat())w.setBrush(o.brush,o.color),await Ae({...w,useOptions:o},n);w.updateClient(),w.updateDisplays(),at&&w.setSelectOptions(at)},onComplete:async()=>{w.updateClient()},onLimitReached:e=>{var t,r;if((t=w.tmpSharedBuffer)!=null&&t.buffer){const n=(r=w.tmpSharedBuffer)==null?void 0:r.buffer,o=new Uint8Array(n);at=w.useOptions,e.forEach(({payload:i,selectOptions:s})=>{const{tool:c,meta:u,toolOptions:a}=i;w.setBrush(s.brush,s.color),Ae({...w,useOptions:s,view:o},{tool:c,meta:u,toolOptions:a})}),at&&w.setSelectOptions(at)}}}),async addActionStack(e,t){await w.actionStack.add({name:e,payload:t,selectOptions:structuredClone(w.useOptions)})},setBrush(e,t){const r=Fs(e.type),n=new r({size:e.size||1,primaryColor:t.primaryColor.color,secondaryColor:t.secondaryColor.color}),o=n.getScaledSize(!0);let i;n instanceof xn?i=_r.Square:n instanceof Un?i=_r.Dots:i=_r.Round,Pn?(Ti(i,o,Ft(n.primaryColor),Ft(n.secondaryColor)),Pn=!1):xi(i,o,Ft(n.primaryColor),Ft(n.secondaryColor)),w.brushDescription=n},setSelectOptions({tool:e,brush:t,color:r}){if(t){const n=r||w.useOptions.color;w.setBrush(t,n)}e&&(w.useOptions.tool=e),t&&(w.useOptions.brush=t),r&&(w.useOptions.color=r)},setSharedBuffer(e,t){w.sharedBuffer={buffer:e,dimension:t},w.tmpSharedBuffer={buffer:e.slice(0),dimension:t},w.view=new Uint8Array(e),w.viewTest=new Uint8Array(e)},getColorByPosition:e=>{const t=ln(w.view,C(w.getDimension()),T(e),C(y(1,1)));if(t.length<4)throw new Error(`Data length is too short: ${t.length}. Expected at least 4 bytes for RGBA.`);return new v(t[0],t[1],t[2],t[3])},getDimension(){if(w.sharedBuffer)return y(w.sharedBuffer.dimension.x,w.sharedBuffer.dimension.y);throw new Error("Shared buffer is not set.")},getTargetPosition(e,{dimension:t,displayPosition:r,zoomLevel:n},o){const i=w.getDimension();let s=y(()=>r*i+i/2+e/n*t/2);return s=y(()=>Math[o!=null&&o.round?"round":"floor"](s)),s},getTargetDimension(e,{dimension:t,zoomLevel:r}){return y(()=>Math.round(e/r*t))},getColorAtPosition(e){if(!w.view||!w.sharedBuffer)throw new Error("No image data available.");const t=Math.floor(e.x),n=(Math.floor(e.y)*w.sharedBuffer.dimension.x+t)*4,o=w.view;if(o[n]!==void 0)return new v(o[n],o[n+1],o[n+2],o[n+3])},isIntersect(e){const t=w.getDimension();return e.x>=0&&e.y>=0&&e.x<=t.x-1&&e.y<=t.y-1},action(e,t){return De(self,e,t)},actionDisplay(){w.displayWorkerPorts.forEach(e=>(t,r)=>De(e,t,r))},setupDisplays(){return Is(w.displayWorkerPorts,w.sharedBuffer)},updateDisplays(){return Vs(w.displayWorkerPorts)},updateClient(){const e={id:crypto.randomUUID(),data:{type:E.SYNC_STATE,payload:{stackMaxSize:w.actionStack.maxStackSize,stackCount:w.actionStack.length,stackIndex:w.actionStack.index}}};w.action(e)}};async function De(e,t,r){const n=await ho(fe(t).pipe(Si()));e.postMessage(n,r||[])}async function Is(e,t){const r={id:crypto.randomUUID(),data:{type:E.UPDATE_BUFFER,payload:{sharedBuffer:t}}};await Promise.all(e.map(n=>De(n,r)))}async function Vs(e){const t={id:crypto.randomUUID(),data:{type:E.UPDATE_CANVAS}};await Promise.all(e.map(r=>De(r,t)))}Be(self,"message").pipe(U(e=>e.data),vi()).subscribe(async({id:e,data:t,transfer:r})=>{try{let n=await Ts(w,t);Array.isArray(n)&&(r=n[1],n=n[0]),n&&w.action({id:e,data:n},r)}catch(n){ar.error("Error processing action:",n)}})})();
