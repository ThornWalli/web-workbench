import{E as e}from"./CEDL6M7l.js";import{r as t,u as o}from"./BSzGBLGV.js";import{C as a}from"./GLWL0ZEA.js";import{C as s,P as n}from"./zg7u1j7i.js";import{d as r,a as i,b as l,u as m}from"./D1WZfvAb.js";import{S as u}from"./BB6FUOrg.js";import{K as c}from"./Cy0zoxeo.js";import{O as p,d,r as v,k as f,a0 as j,o as w,a1 as C,y as E,z as I,C as _,G as g,_ as h}from"./BfpYGSxR.js";import{u as O}from"./Dkhtr-D7.js";import"./CxZzHJhT.js";import"./DdO-3S9B.js";import"./B1k18Rg6.js";import"./BHmTNEz3.js";import"./CIasQYz1.js";import"./B-meQdOw.js";import"./Caivkp23.js";import"./CrNGlbV0.js";import"./D7Us3e3D.js";import"./D3MPJlJW.js";import"./DL1FsYWj.js";import"./tbUmQ5LT.js";import"./D3xLGof4.js";import"./N5kgPtk_.js";import"./B15fucc8.js";import"./CJYzpMQ6.js";import"./I81pZH22.js";import"./CV0dHcg-.js";import"./BlFo7Aw2.js";import"./l2pW2FB2.js";import"./Cah-phv7.js";import"./C98WWl5r.js";import"./BKiSbNd3.js";import"./CJbzZ8Mo.js";import"./mZmTw9Uu.js";import"./jSR9Z_uS.js";const S=r(({core:e,model:r})=>{return[new i({order:0,title:"Editor",items:[new i({title:"New",hotKey:{alt:!0,code:c.KEY_N,title:"N"},action:function actionNew(){var e;null==(e=r.actions)||e.reset()}}),new i({title:"Open…",hotKey:{alt:!0,code:c.KEY_O,title:"O"},action:async function actionOpen(){const t=await e.executeCommand("openFileDialog");if(t){if(!(n.CONTENT in t.value))throw new Error("Can't read file content");{const e={...t.value,[n.CONTENT]:[].concat(t.value[n.CONTENT]).join("\n")};r.fsItem=t.fsItem,r.value=e}}}}),new i({title:"Save",hotKey:{alt:!0,code:c.KEY_S,title:"S"},action:function actionSave(){return save()}}),new i({title:"Save As…",action:function actionSaveAs(){return save(!0)}}),new u,new i({hotKey:{alt:!0,code:c.KEY_I,title:"I"},title:"Info",action(){var e;return null==(e=r.actions)?void 0:e.openInfo()}}),new i({title:"Close",action(){var e;return null==(e=r.actions)?void 0:e.close()}})]}),new i({order:1,title:"Document Settings",items:[new i({title:"Has Window Output",type:l.CHECKBOX,name:a.HAS_WINDOW_OUTPUT,model:r.value})]}),new i({order:1,title:"Run",hotKey:{code:c.KEY_R,title:"R"},action:async function actionRun(){var t;const a=[];await(null==(t=e.modules.parser)?void 0:t.parseBasic(r.value[n.CONTENT].split(/\n/),async(t,o)=>{const s=await e.executeCommand(t,o);return o.message&&(Array.isArray(o.message)?a.push(...o.message):a.push(o.message)),s})),r.output=a.map(e=>o(e))}}),new i({order:2,title:"Preview",type:l.CHECKBOX,name:s.WEB_BASIC_SHOW_PREVIEW,model:e.config.observable,action:({value:t})=>e.config.set(s.WEB_BASIC_SHOW_PREVIEW,t)})];async function save(o=!1){const a={...r.value,content:r.value[n.CONTENT].split(/\n/g)},s=await t(JSON.stringify(a));let i;if(!o&&r.fsItem)return i=await e.executeCommand(`editfile "${r.fsItem.getPath()}" --data="${s}"`),i?e.executeCommand('openDialog "File saved."'):e.executeCommand('openDialog "File could not be saved."');{const t=await e.executeCommand(`saveFileDialog --data="${s}" --extension="bs"`);return t?(r.fsItem=p(t),r.fsItem):null}}}),y={class:"wb-disks-extras13-web-basic"},N=h(d({__name:"WebBasic",props:{model:{}},emits:["refresh","update:value"],setup(t,{emit:o}){const a=v(null),n=o,r=t,{core:i}=m(),{setContextMenu:l,preserveContextMenu:u,parentFocused:c}=O();l(S,{model:r.model}),u();const p=f(()=>r.model.value.content),d=f(()=>{var e;return Boolean((null==(e=i.value)?void 0:e.config.observable[s.WEB_BASIC_SHOW_PREVIEW])||!1)});function onUpdateModelValue(e){n("update:value",{...r.model.value,content:e})}function onRefreshInputText(){refresh()}function refresh(){C(()=>{n("refresh",{scroll:!0})})}return j(()=>r.model.value,()=>{refresh()}),j(()=>p.value,e=>{e&&(n("update:value",{...r.model.value,content:e}),C(()=>{var e;null==(e=a.value)||e.resetSelection(),n("refresh",{scroll:!0})}))}),j(()=>d.value,e=>{var t;null==(t=r.model.actions)||t.togglePreview(e)}),w(()=>{d.value&&C(()=>{var e;null==(e=r.model.actions)||e.togglePreview()})}),(t,o)=>(I(),E("div",y,[_(e,{ref:"input","override-focused":g(c)||!1,"model-value":t.model.value.content,"onUpdate:modelValue":onUpdateModelValue,onRefresh:onRefreshInputText},null,8,["override-focused","model-value"])]))}}),[["__scopeId","data-v-9b45f472"]]);export{N as default};
