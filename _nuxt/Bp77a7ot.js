var ge=Object.defineProperty;var U=i=>{throw TypeError(i)};var ke=(i,o,c)=>o in i?ge(i,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):i[o]=c;var G=(i,o,c)=>ke(i,typeof o!="symbol"?o+"":o,c),be=(i,o,c)=>o.has(i)||U("Cannot "+c);var X=(i,o,c)=>(be(i,o,"read from private field"),c?c.call(i):o.get(i)),Y=(i,o,c)=>o.has(i)?U("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(i):o.set(i,c);import{i as p,o as Ce}from"./CpIyErmU.js";import{R as xe}from"./BH9FFkim.js";import{d as q}from"./On0xenC3.js";import{S as Ie,a as Se,W as _e}from"./DQ8WbIb3.js";import{S as Me}from"./M0-75C7T.js";import{y as k,z as u,A as R,d as Te,a7 as E,k as r,r as m,o as ze,a1 as J,W as Ee,a0 as Re,F as g,D as Q,I as f,R as Z,P as Oe,G as d,C as ee,B as te,$ as Ve,_ as De}from"./CotJlvW-.js";import{i as Fe}from"./D-Cgqglr.js";import{b as v,a as s,p as He}from"./DOMGF9Hs.js";import{S as Ae}from"./CQXTE7NH.js";import{S as Be}from"./CZ5jXLoK.js";import{S as Ke}from"./6C4StZv5.js";import"./D4lI5vpz.js";import"./RAasLaaH.js";import"./DdQrQ7-5.js";import"./CV0dHcg-.js";import"./CZZPvNTk.js";import"./B2exwp0w.js";import"./djI3_XgP.js";import"./Ce6njBYG.js";import"./BE-N3i2n.js";import"./6jpuwjT2.js";import"./Bnsp_u8C.js";import"./DNvW6rqi.js";import"./DKrsSnpo.js";var S;class Le{constructor(){G(this,"screenSize",p(0,0));Y(this,S,new xe(0));window.addEventListener("resize",this.onResize.bind(this),!1)}destroy(){window.removeEventListener("resize",this.onResize.bind(this),!1)}onResize(){this.screenSize=p(window.innerWidth,window.innerHeight)}getElementSize(o){return p(o.offsetWidth,o.offsetHeight)}get resize(){return X(this,S)}}S=new WeakMap;let oe;const Ne=oe||(oe=new Le),Pe={xmlns:"http://www.w3.org/2000/svg",width:"6",height:"10"};function $e(i,o){return u(),k("svg",Pe,o[0]||(o[0]=[R("path",{d:"M0 0h2v2h2v2h2v2H4v2H2v2H0z",class:"svg-primary"},null,-1)]))}const We={render:$e},je=["type","name","value","checked"],Ue={key:1,class:"checkbox"},Ge={class:"title"},Xe={key:2,class:"hotkey"},Ye={key:3,class:"indicator-context"},qe=Te({__name:"MenuItem",props:{item:{},parentLayout:{},tag:{},direction:{},core:{}},emits:["click","update:model-value"],setup(i,{expose:o,emit:c}){const h=E("closeContextMenu",()=>{});o({closeContextMenu:h});const ne="bottom",ie={size:Ne.screenSize};function se(e){return e&&typeof e=="object"&&"value"in e,e}const ae=r(()=>{const e=t.item;return e.type===v.CUSTOM?se(e.options.checked):F.value?e.getValue()===e.value:!!e.getValue()}),O=r(()=>t.item.items.filter(e=>!(e instanceof Ae||e instanceof Be)&&!e.options.disabled).length>0),t=i,b=c,V=m(),re=m(),l=m(),C=m(!1),_=m(!1),y=m(!1),w=m(p(2,3)),D=new Ke,ce=r(()=>t.item instanceof s&&t.item.type===v.RADIO?"radio":"checkbox"),M=r(()=>{if(t.item instanceof s){const e=t.item.type;return e!==void 0&&[v.CUSTOM,v.CHECKBOX,v.RADIO].includes(e)}return!1}),T=r(()=>t.item instanceof s&&t.item.name!==void 0&&t.item.name.length>0),ue=r(()=>{if(t.item instanceof s)return t.item.title||""}),x=r(()=>{if(t.item instanceof s)return t.item.hotKey}),F=r(()=>t.item instanceof s&&t.item.type===v.RADIO),le=r(()=>T.value?"label":t.item instanceof s&&t.item.url?"a":"button"),me=r(()=>{const e={class:"inner",is:void 0};return T.value?e.is="label":t.item instanceof s&&t.item.url&&(e.is="a",e.href=t.item.url),e}),fe=r(()=>({focused:C.value,"force-visible":_.value,"context-ready":y.value,"context-halign-left":w.value.x===0,"context-halign-right":w.value.x===2,"context-valign-top":w.value.y===1,"context-valign-bottom":w.value.y===3,disabled:H.value})),H=r(()=>t.item instanceof s&&!t.item.action&&(!O.value&&l.value||pe.value.disabled)),pe=r(()=>t.item.options);ze(()=>{J(()=>{t.item instanceof s&&t.item.hotKey&&D.add(q.keyDown.subscribe(e=>{t.item instanceof s&&t.item.hotKey&&q.resolveHotKey(t.item.hotKey,e)&&ve()}))})}),Ee(()=>{D.unsubscribe()});function de(e,n){b("update:model-value",e,n)}async function ve(){var e;if(t.item instanceof s&&typeof t.item.action=="function")try{await t.item.action({closeContextMenu:h})}catch(n){console.error(n),(e=t.core)==null||e.errorObserver.next(n)}else V.value.click()}function he(e){if(!(t.item instanceof s))return;let n;const a=e.target;F.value?n=a==null?void 0:a.value:n=a==null?void 0:a.checked,Fe(n)?t.item.setValue(Number(n)):t.item.setValue(n),b("update:model-value",t.item.name||"",n),typeof t.item.action=="function"&&Promise.resolve(t.item.action({closeContextMenu:h,value:n})).catch(I=>{throw I})}async function ye(e){var n;if(e.pointerType===""&&l.value&&O.value&&!y.value&&C.value)A();else if(t.item instanceof s&&!T.value&&typeof t.item.action=="function")try{await t.item.action({closeContextMenu:h})}catch(a){console.error(a),(n=t.core)==null||n.errorObserver.next(a)}else b("click",e)}async function we(e){var n;if(t.item instanceof s&&!M.value&&typeof t.item.action=="function")try{await t.item.action({closeContextMenu:h})}catch(a){console.error(a),(n=t.core)==null||n.errorObserver.next(a)}else b("click",e)}function A(){y.value||(_.value=!0),B()}function B(){y.value||(y.value=!0,J(()=>{window.setTimeout(()=>{if(l.value&&l.value.$el instanceof HTMLElement){const e=l.value.$el.getBoundingClientRect(),{size:n,position:a}=t.parentLayout||ie,I=Ce(()=>p(e.left,e.top)-(a.x>0?a:0)+p(e.width,e.height)),j=(t.direction||ne)==="bottom";w.value=p(n.x<I.x?0:2,n.y-2<=I.y?j?1:3:j?3:1)}_.value=!1},0)}))}const K=E("addItemFocus"),L=E("removeItemFocus"),N=()=>{C.value=!0,K&&K(t.item.id)},P=r(()=>{var e;return((e=l.value)==null?void 0:e.hasFocusedItem)||!1});let $=-1;Re(()=>P.value,e=>{window.clearTimeout($),$=window.setTimeout(()=>{e||z()},0)});let W=-1;const z=()=>{window.clearTimeout(W),W=window.setTimeout(()=>{P.value||(C.value=!1,L&&L(t.item.id))})};return(e,n)=>(u(),g(Z(e.tag),{class:Ve(["wb-env-element-context-menu-item",fe.value])},{default:Q(()=>[(u(),g(Z(le.value),Oe({ref_key:"clickEl",ref:V,disabled:H.value},me.value,{onFocus:N,onBlur:z,onClick:ye,onPointerover:B,onTouchstart:A}),{default:Q(()=>[e.item instanceof d(s)&&M.value?(u(),k("input",{key:0,ref_key:"inputEl",ref:re,type:ce.value,name:e.item.name,value:e.item.value,checked:ae.value,onFocus:N,onBlur:z,onClick:we,onInput:he},null,40,je)):f("",!0),M.value?(u(),k("span",Ue,[ee(d(Me))])):f("",!0),R("span",Ge,te(ue.value),1),x.value?(u(),k("span",Xe,[x.value.alt?(u(),g(d(Ie),{key:0})):f("",!0),x.value.shift?(u(),g(d(Se),{key:1})):f("",!0),R("span",null,te(x.value.title),1)])):f("",!0),e.item.items.length>0?(u(),k("span",Ye,[ee(d(We))])):f("",!0)]),_:1},16,["disabled"])),e.item.items.length>0?(u(),g(_e,{key:0,ref_key:"contextMenuEl",ref:l,core:e.core,items:d(He)(e.item.items),"parent-layout":e.parentLayout,onInput:de},null,8,["core","items","parent-layout"])):f("",!0)]),_:1},8,["class"]))}}),Ct=De(qe,[["__scopeId","data-v-34e50cf5"]]);export{Ct as default};
