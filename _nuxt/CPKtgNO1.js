const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B6uZlb6g.js","./DXdLLGcu.js","./ZY2YCu9D.js","./IyfdwxKR.js","./D4lI5vpz.js","./T9U8N4lZ.js","./BDmXNm4k.js","./h2bsdWGK.js","./BUE24yXb.js","./CotJlvW-.js","./CHLd88nu.css","./E3_DWDMo.js","./6Hezpcw1.css","./W7H9nAKY.js","./Bn0T8SwD.css","./B1jPSlgX.js","./DxpqQ76W.js","./DEAznjDA.css","./BSKES50A.css","./Byx36QzX.js","./DcRMuGxK.js","./CuhyRvkQ.css","./9V19AFUE.js","./DhnHJytn.js","./M0-75C7T.js","./CJlLddzR.js","./BVZzrE_-.css","./DOMGF9Hs.js","./DKrsSnpo.js","./CXbNF4JJ.css","./BII7ONQG.js","./DWp2AHFe.css","./DLNEB7Ra.js","./CTrxkmWA.js","./CpIyErmU.js","./DNMHntIy.css","./VtS9hTy9.js","./BADSAepT.css","./hGXT4LQG.css","./DBmp0OMG.js","./D-Cgqglr.js","./RAasLaaH.js","./DdQrQ7-5.js","./6C4StZv5.js","./DNvW6rqi.js","./6jpuwjT2.js","./D5AYwgt_.js","./CYV3YR6m.css","./DBqxOoOp.css","./CchF1Gkl.js","./DHhoFbsw.js","./DZ3G1ikB.js","./D2cSW_QH.js","./DXzWvMI2.css","./CaQYtOeA.css","./DiRiyE1W.css","./Bgkcf4yJ.js","./CUWQgAUy.css"])))=>i.map(i=>d[i]);
var W=Object.defineProperty;var S=(m,t,r)=>t in m?W(m,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[t]=r;var h=(m,t,r)=>S(m,typeof t!="symbol"?t+"":t,r);import{K as g,L as E,O as _,a9 as A}from"./CotJlvW-.js";import{D as O}from"./Cc_Og2B_.js";import{i as F}from"./CpIyErmU.js";import{d as C,A as o,T as v}from"./Bu9-HbQ4.js";import{s as y,f as P,b as L}from"./DG6QdPnO.js";import{w as N,e as p,o as I,D,u as T,q as k,f as M,k as z,t as V}from"./D-Cgqglr.js";import{C as Y}from"./CxKYomUj.js";import{I as w}from"./DOMGF9Hs.js";const se=new class{constructor(){h(this,"app");h(this,"initDeferred");h(this,"config");h(this,"firebase",null)}async initAppCheck(t,r){var e,i;const d=(e=t.appCheck)==null?void 0:e.recaptchaPublicKey;if(d){(i=t.appCheck)!=null&&i.debugToken&&(self.FIREBASE_APPCHECK_DEBUG_TOKEN=t.appCheck.debugToken);const{initializeAppCheck:n,ReCaptchaV3Provider:a}=await g(async()=>{const{initializeAppCheck:l,ReCaptchaV3Provider:c}=await import("./B6uZlb6g.js");return{initializeAppCheck:l,ReCaptchaV3Provider:c}},__vite__mapDeps([0,1]),import.meta.url);return n(r,{provider:new a(d),isTokenAutoRefreshEnabled:!0})}else{console.warn("Firebase AppCheck is not configured. Please set the recaptchaPublicKey in the config.");return}}async initApp(t,r=!1){this.initDeferred||(this.initDeferred=new O,this.initDeferred.promise=this.initDeferred.promise.then(async()=>{const{app:d}=await this.get();this.config=t;const e=d.initializeApp(t);return await this.initAppCheck(t,e),this.app=e,e}),r&&this.initDeferred.resolve())}async getFunction(t){var i,n,a;if(this.app||(i=this.initDeferred)==null||i.resolve(),await((n=this.initDeferred)==null?void 0:n.promise),!this.app)throw new Error("Firebase app not initialized");const{functions:{httpsCallable:r,getFunctions:d}}=await this.get(),e=d(this.app,(a=this.config)==null?void 0:a.region);return r(e,t,{limitedUseAppCheckTokens:!1})}get(){return this.firebase||(this.firebase=this.getImports())}getImports(){return Promise.all([g(()=>import("./ZY2YCu9D.js"),__vite__mapDeps([2,1]),import.meta.url).then(t=>t.default||t),g(()=>import("./IyfdwxKR.js"),__vite__mapDeps([3,1,4]),import.meta.url).then(t=>t.default||t),g(()=>import("./T9U8N4lZ.js"),__vite__mapDeps([5,1]),import.meta.url).then(t=>t.default||t),g(()=>import("./BDmXNm4k.js"),__vite__mapDeps([6,1]),import.meta.url).then(t=>t.default||t)]).then(([t,r,d,e])=>({app:t,auth:r,database:d,functions:e}))}};async function U(m,t){let r;const d=m.modules.symbols,e=m.modules.windows,i=t||d.getSelectedItems().filter(a=>{if(a.fsItem)return a.fsItem;throw new Error(`Item has no fsItem. ${a.id}`)}).map(a=>a.fsItem);await Promise.all(i.map(async a=>{const s=E({actions:{openItemMeta:()=>n(s),save:(c,f)=>B(m,c,f),saveItemMeta:(c,f,u)=>b(m,c,f,u)},id:a.id,name:a.name,fsItem:a});[w.SYMBOL,w.VISIBLE,w.IGNORE_SYMBOL_REARRANGE,w.WINDOW_SCALE,w.WINDOW_SCROLL_X,w.WINDOW_SCROLL_Y,w.WINDOW_FULL_SIZE,w.WINDOW_SYMBOL_REARRANGE,w.WINDOW_SIDEBAR].forEach(c=>{s[c]=a.meta.has(c)?a.meta.get(c):!1}),e.addWindow({component:await g(()=>import("./h2bsdWGK.js"),__vite__mapDeps([7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]),import.meta.url).then(c=>c.default),componentData:{fsItem:_(a),model:s},options:{title:`Edit File ${a.name}`,prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose().then(()=>{})}));async function n(a){const s=a.fsItem;return r=e.addWindow({component:await g(()=>import("./DLNEB7Ra.js"),__vite__mapDeps([32,8,9,10,11,12,13,14,33,16,17,34,35,36,24,25,37,20,21,19,22,27,28,29,30,38]),import.meta.url).then(l=>l.default),componentData:{fsItem:_(s),model:a},options:{title:`Item Meta ${s.name}`,scale:!0,scrollY:!0},layout:{size:F(420,360)}},{full:!0}),r.awaitClose().then(()=>{r=void 0})}}async function B(m,t,r){const{id:d,name:e}=r,i=t.getPath();if(!d)throw new Error("Id is emoty!");let n;const a=m.addExecution();try{await b(m,t,r),e&&d!==e?n=await m.executeCommand(`rename "${i}" "${e}" -n`):n=await m.executeCommand(`rename "${i}" "${d}" -rn`),n=m.executeCommand(`rename "${i}" "${d}"`)}catch(s){throw a(),s}return a(),n}function X(){return Object.values(w)}async function b(m,t,r,d=!1){const e=m.addExecution();await m.executeCommand(`cleanfilemeta "${t.getPath()}" ${d?"--force":""}`),await X().filter(n=>r[n]!==void 0).reduce((n,a)=>n.then(async()=>{let s=r[a],l=!1;typeof s=="string"?s=`"${s}"`:typeof s=="object"&&(l=!0,s=N(encodeURIComponent(JSON.stringify(s)))),await m.executeCommand(`editfilemeta "${t.getPath()}" "${a}" ${s} ${l?"--json":""}`)}),Promise.resolve()),e()}const oe=C(({module:m})=>{const{fileSystem:t,core:r,disks:d}=m;return[{name:["mountDisk"],description:"Mount Disk",args:[new o({index:0,name:"id",description:"Disk ID"})],async action({id:e},i){const n=r.addExecution();try{const a=await d[e].data(),s=await t.addFloppyDisk(()=>a({core:r}));d[e].hidden||i.message(`Mount Disk <strong>${s.name}</strong> <strong>(${s.id})</strong> successful!`),n()}catch(a){throw console.error(a),p.get("cant_find_disk",e)}}},{name:["changeDirectory","cd"],description:"cd %path%",args:[new o({index:0,name:"path",description:"Directory path"})],async action({path:e}){if(!e)throw p.get("bad_args");try{await t.changeDirectory(e)}catch(i){throw console.error(i),p.get("cant_find",e)}}},{name:["exist"],description:"Check if file exists.",args:[new o({index:0,name:"path",description:"Filename"})],async action({path:e},i){if(!e)throw p.get("bad_args");const n=I(e),a=await t.exist(e);return a?i.message(`File ${n} exists`):i.message(`File ${n} does not exist`),a}},{name:["makedir","mkdir"],args:[new o({index:0,name:"path",description:"Filename"}),new o({index:1,name:"name",description:"Name"}),new o({name:"ignore",flag:!0,description:"Ignore file exist."})],async action({path:e,name:i,ignore:n},a){if(!e)throw p.get("bad_args");const s=await t.makedir(e,i||I(e),{override:n});return a.message(`Directory "${s.name}" created`),s}},{name:["remove","rm"],args:[new o({index:0,name:"path",description:"Filename"}),new o({name:["recursive","r"],flag:!0,description:"Remove Directory Items and Directories."}),new o({name:["ignore"],flag:!0,description:"Ignore the specified file is deleted."})],async action({path:e,recursive:i,ignore:n},a){if(!e)throw p.get("bad_args");return(await t.remove(e,i,{ignore:n})||[]).map(l=>{const c=l.type===D.TYPE?"Directory":"File";return a.message(`Removed ${c}: ${l.name}`),l})}},{name:["readfile","getfile"],description:"Get file content",args:[new o({index:0,name:"path",description:"Filename"})],async action({path:e}){if(!e)throw p.get("bad_args");return(await t.get(e)).data}},{name:["makefile","mkfile"],description:"Creates a file with the specified attributes.",args:[new o({index:0,name:"path",description:"Filename"}),new o({index:1,name:"name",description:"Name"}),new o({index:3,name:"data",description:"Data"}),new o({name:"override",flag:!0,description:"Deletes existing file and recreates."})],action:async(e,i)=>{const n=await $(r,e);return i.message(`File "${n.name}" created`),n}},{name:["editfile"],description:"Edits file with specified attributes.",args:[new o({index:0,name:"path",description:"Filename"}),new o({index:1,name:"data",description:"Data"})],action:async(e,i)=>{const n=await G(r,e);return i.message(`File "${n.name}" edited`),n}},{name:["openEditFileDialog"],description:"Opens a file dialog to edit the file.",args:[new o({index:0,name:"path",description:"Filename"})],async action({path:e}){if(!e)throw p.get("bad_args");const i=await t.get(e);return U(r,[i])}},{name:["editfilemeta"],description:"Edits file with specified attributes.",args:[new o({index:0,name:"path",description:"Filename"}),new o({index:1,name:"name",description:"Name"}),new o({index:2,name:"value",description:"Value"}),new o({index:3,name:"json",description:"Is JSON value?",flag:!0})],async action({path:e,name:i,value:n,json:a},s){if(!e)throw p.get("bad_args");a&&(n=JSON.parse(decodeURIComponent(T(n))));const l=await t.editFileMeta(e,i,n);return s.message(`File  "${l.name}" Meta edited`),l}},{name:["cleanfilemeta"],description:"Removes all undefined meta values from the file.",args:[new o({index:0,name:"path",description:"Filename"}),new o({name:"force",flag:!0,description:"When set, forces the cleaning of meta values."})],async action({path:e,force:i},n){if(!e)throw p.get("bad_args");const a=await t.cleanFileMeta(e,{force:i});return n.message(`File  "${a.name}" Meta cleaned`),a}},{name:["makelink","mklink"],description:"Creates a link to the specified path.",args:[new o({index:0,name:"ref",description:"Reference path with id (example.ext)."}),new o({index:1,name:"name",description:"Displayed Name"}),new o({index:2,name:"dest",description:"Destination directory."})],async action({ref:e,name:i,dest:n},a){if(!e)throw p.get("bad_args");n=n||".";const s=await t.get(e),l=await t.makelink(s,i);return await t.get(n)!==t.currentItem&&await t.move(l,n,{override:!0}),a.message(`Created link "${i}" with "${await s.getPath()}"`),l}},{name:["editlink"],description:"",args:[new o({index:0,name:"path",description:"Reference filepath with id (example.ext)."}),new o({index:1,name:"ref",description:"Destination directory."})],async action({path:e,ref:i},n){if(!(e&&i))throw p.get("bad_args");const a=await t.get(i),s=await t.editlink(e,a);return n.message(`Edited link "${name}" with "${await a.getPath()}"`),s}},{name:"rename",description:"Renamed a file",args:[new o({index:0,name:"path",description:"Filepath with id (example.ext)."}),new o({index:1,name:"value",description:"Value for id or displayed name."}),new o({name:["name","n"],flag:!0,description:"When set, changes the display name."}),new o({name:["removeName","rn"],flag:!0,description:"When set, removes the display name."})],async action({path:e,value:i,name:n,removeName:a},s){if(!a&&(!e||!i))throw p.get("bad_args");const l=await t.get(e),c=n?l.name:l.id;return await t.rename(e,i,{name:n,removeName:a}),s.message(`Renamed from "${c}" to "${i}"`),l}},{name:["cp","copy"],args:[new o({index:0,name:"from",description:"Source Filepath with id (example.ext)."}),new o({index:1,name:"dest",description:"Destination Filepath with id (example.ext)."}),new o({name:["ignore","i"],flag:!0,description:"When sets, creates a new file if exists."})],async action({from:e,dest:i,ignore:n},a){let s=i;if(!s&&n&&(s=e),!s||!e)throw p.get("bad_args");const l=await t.copy(e,s,{ignore:n});return a.message(`Copied from "${e}" to "${s}"`),l}},{name:["mv","move"],description:"move %from% %to%",args:[new o({index:0,name:"from",description:"From path"}),new o({index:1,name:"to",description:"To path"}),new o({index:2,name:"item-position",description:"Sets the position in the Icon view. (x,y)"})],async action({from:e,to:i,itemPosition:n},a){if(!i||!e)throw p.get("bad_args");const s=await t.move(e,i);n&&s.meta.set(w.POSITION,[0,0].map((c,f)=>{const u=n.split(",");return parseInt(u[Number(f)]||"0")})),s.save();let l;return s instanceof D?l="Directory":l="File",a.message(`${l} moved ${s.name}`),s}},{name:["executeFile"],description:"Execute file.",args:[new o({index:0,name:"path",description:"Path to the file"})],async action({path:e}){if(!e)throw p.get("bad_args");const i=await t.get(e);if(typeof i.action=="function")return i.action(r);throw p.get("cant_find_action",e)}}]});p.add("cant_find_action","Can't find action %1");p.add("cant_find_disk","Can't find disk %1");async function $(m,{path:t,name:r,data:d,override:e=!1}){if(!t)throw p.get("bad_args");return typeof d=="string"&&(d=k(d)),await m.modules.files.fs.makeFile(t,r,d,{override:e||!1,meta:[]})}function G(m,{path:t,data:r}){if(!t)throw p.get("bad_args");return typeof r=="string"&&(r=k(r)),m.modules.files.fs.editFile(t,r)}async function j(m,t,r){const d=await m.executeCommand(`exist "${t}"`);let e=!1;return d&&(e=await m.executeCommand('openDialog "File exist, overwrite?" --confirm')),$(m,{path:t,data:r,override:e})}async function K(m,t){var e;const r=await((e=m.modules.files)==null?void 0:e.fs.get(t)),d=await m.executeCommand(`readfile "${t}"`);return{fsItem:r,value:d}}const de=C(({module:m,core:t})=>{const{fileSystem:r}=m;return[{name:"openPreview",args:[new o({index:0,name:"path",description:"Path to the file"}),new o({name:"maximized",description:"If set, window is maximized."})],async action({path:d,maximized:e}){var l,c;const i=await r.get(d),{type:n,content:a,openMaximized:s}=i.data;if(n==="basic"&&!i.data[Y.HAS_WINDOW_OUTPUT])await((l=t.modules.parser)==null?void 0:l.parseBasic(a,async(f,u)=>await t.executeCommand(f,u)));else{const f=await g(()=>import("./DBmp0OMG.js"),__vite__mapDeps([39,40,34,41,4,42,43,44,45,9,27,28,29,46,47,30,48]),import.meta.url).then(u=>u.default);(c=t.modules.windows)==null||c.addWindow({component:f,componentData:{type:n,content:a},options:{title:i.name,scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0},layout:{size:F(420,360)}},{full:s||e||!1})}}},{name:"saveFileDialog",args:[new o({index:0,name:"data",description:"File Content"}),new o({index:1,name:"id",description:"File Id"}),new o({index:2,name:"extension",description:"File Extension"})],action:d=>H(t,d)},{name:"openFileDialog",args:[new o({index:0,name:"type",description:"Type for File or Directory to open."})],async action({type:d}){var a;const e=E({}),i=await g(()=>import("./CchF1Gkl.js"),__vite__mapDeps([49,50,8,9,10,11,12,13,14,51,52,53,40,34,41,4,42,43,44,45,27,28,29,54,15,16,17,18,30,55]),import.meta.url).then(s=>s.default),n=(a=t.modules.windows)==null?void 0:a.addWindow({component:i,componentData:{type:d,model:e,fsItem:r.root&&_(r.root)},options:{title:"Open File",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}});if(n){const{value:s}=await n.awaitClose();return s&&K(t,s)}}},{name:"fileinfo",description:"Get info from File or Directory",args:[new o({index:0,name:"path",description:"Path to the file"}),new o({index:1,name:"name",description:"Name from the Info"}),new o({index:2,name:["list","ls"],flag:!0,description:"List all Infos"})],async action({path:d,name:e,list:i},n){const a=await r.getItemMetaList(d);if(i){const s=new v;s.addColumns([{value:"Name",align:"left",minWidth:20},{value:"Value",align:"left",minWidth:20}]),s.addRows(a.map(({name:l,value:c})=>{let f=c;return Array.isArray(c)&&(f=c.join(" ")),[l,f]})),n.message([s])}else return a.find(s=>s.name===e)}},{name:["info","i"],args:[new o({index:0,name:"path",description:"Path to the file"})],async action({path:d},e){let i=r.root;d&&(i=await r.get(d)),i!=null&&i.parent&&(i=i.parent);const n=await(i==null?void 0:i.getItems()),a=new v;a.addColumns([{value:"Unit",align:"left",minWidth:8},{value:"Size",align:"right",minWidth:6},{value:"Used",align:"right",minWidth:6},{value:"Free",align:"right",minWidth:6},{value:"Full",minWidth:4},{value:"Errs",align:"center",minWidth:4},{value:"Status",align:"center",minWidth:10},{value:"Name",align:"right",minWidth:14}]);const s=Array.from((n==null?void 0:n.values())||[]).filter(c=>c instanceof M);a.addRows(s.map(c=>{let f=0;return(c.size>0||c.maxSize>0)&&(f=c.size/c.maxSize*100),[`${c.id}:`,y(c.maxSize),y(c.size),y(c.maxSize-c.size),`${f}%`,"0",c.locked?"Read":"Read/Write",`${c.name||""}`]}));const l=["","Mounted disks:",a,"","Volumes available:"];s.forEach(c=>{l.push(`${c.name}: [Mounted]`)}),l.push(""),e.message(l)}},{name:["list","ls"],args:[new o({index:0,name:"path",description:"Path to the file"}),new o({name:"dir-size",flag:!0,description:"Show Directory Size."})],async action({path:d,dirSize:e},i){let n=r.currentItem;d&&(n=await r.get(d));const a=Array.from((await(n==null?void 0:n.getItems())||[]).values()),s=new v;s.addColumns([{value:"Name",align:"left",minWidth:26},{value:"Size",align:"right",minWidth:8},{value:"Access",align:"center",minWidth:12},{value:"Date / Time",align:"center",minWidth:18}]),s.addRows(a.reduce((f,u)=>{let x;u instanceof z&&!e?x="DIR":x=P(y(u.size),8,!0,"0");const R=u.isLocked()?"Read":"Read/Write";return f.push([`${u.id}:`,x,R,u.createdDate?L("D-mm-y H:I:S",u.createdDate):""]),f},[]));const l=a.reduce((f,u)=>(u instanceof D&&f++,f),0),c=a.reduce((f,u)=>(f+=u.size,f),0);return i.message([s,`${a.length} files - ${l} directories - ${c} blocks used`]),Promise.resolve()}}]});async function H(m,{data:t,id:r,extension:d}){var n,a;const e=await g(()=>import("./Bgkcf4yJ.js"),__vite__mapDeps([56,8,9,10,11,12,13,14,51,52,53,40,34,41,4,42,43,44,45,27,28,29,54,15,16,17,18,57]),import.meta.url).then(s=>s.default),i=(a=m.modules.windows)==null?void 0:a.addWindow({component:e,componentData:{fsItem:((n=m.modules.files)==null?void 0:n.fs.root)&&_(m.modules.files.fs.root),id:r},options:{title:"Save File",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}});if(i){const{value:s}=await i.awaitClose();if(s){let l=s;d&&(l=V(s,d));const c=await j(m,l,t);if(c)return _(A(c))}}}export{oe as a,de as c,G as e,se as f,U as o,H as s};
