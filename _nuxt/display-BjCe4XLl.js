var __defProp=Object.defineProperty,__defNormalProp=(t,e,r)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,__publicField=(t,e,r)=>__defNormalProp(t,"symbol"!=typeof e?e+"":e,r);!function(){"use strict";var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function __extends(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}function __awaiter(t,e,r,n){return new(r||(r=Promise))(function(o,i){function fulfilled(t){try{step(n.next(t))}catch(e){i(e)}}function rejected(t){try{step(n.throw(t))}catch(e){i(e)}}function step(t){t.done?o(t.value):function adopt(t){return t instanceof r?t:new r(function(e){e(t)})}(t.value).then(fulfilled,rejected)}step((n=n.apply(t,e||[])).next())})}function __generator(t,e){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=verb(0),s.throw=verb(1),s.return=verb(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(a){return function(c){return function step(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(c){a=[6,c],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function __values(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function __spreadArray(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}function __await(t){return this instanceof __await?(this.v=t,this):new __await(t)}function __asyncGenerator(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(t,e||[]),i=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),verb("next"),verb("throw"),verb("return",function awaitReturn(t){return function(e){return Promise.resolve(e).then(t,reject)}}),n[Symbol.asyncIterator]=function(){return this},n;function verb(t,e){o[t]&&(n[t]=function(e){return new Promise(function(r,n){i.push([t,e,r,n])>1||resume(t,e)})},e&&(n[t]=e(n[t])))}function resume(t,e){try{!function step(t){t.value instanceof __await?Promise.resolve(t.value.v).then(fulfill,reject):settle(i[0][2],t)}(o[t](e))}catch(r){settle(i[0][3],r)}}function fulfill(t){resume("next",t)}function reject(t){resume("throw",t)}function settle(t,e){t(e),i.shift(),i.length&&resume(i[0][0],i[0][1])}}function __asyncValues(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t=__values(t),e={},verb("next"),verb("throw"),verb("return"),e[Symbol.asyncIterator]=function(){return this},e);function verb(r){e[r]=t[r]&&function(e){return new Promise(function(n,o){(function settle(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)})(n,o,(e=t[r](e)).done,e.value)})}}}function isFunction(t){return"function"==typeof t}function createErrorClass(t){var e=t(function(t){Error.call(t),t.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}"function"==typeof SuppressedError&&SuppressedError;var t=createErrorClass(function(t){return function UnsubscriptionErrorImpl(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}});function arrRemove(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var e=function(){function Subscription2(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}var e;return Subscription2.prototype.unsubscribe=function(){var e,r,n,o,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=__values(s),c=a.next();!c.done;c=a.next()){c.value.remove(this)}}catch(d){e={error:d}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}else s.remove(this);var u=this.initialTeardown;if(isFunction(u))try{u()}catch(y){i=y instanceof t?y.errors:[y]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var h=__values(l),p=h.next();!p.done;p=h.next()){var f=p.value;try{execFinalizer(f)}catch(m){i=null!=i?i:[],m instanceof t?i=__spreadArray(__spreadArray([],__read(i)),__read(m.errors)):i.push(m)}}}catch(b){n={error:b}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(n)throw n.error}}}if(i)throw new t(i)}},Subscription2.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)execFinalizer(t);else{if(t instanceof Subscription2){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}},Subscription2.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},Subscription2.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},Subscription2.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&arrRemove(e,t)},Subscription2.prototype.remove=function(t){var e=this._finalizers;e&&arrRemove(e,t),t instanceof Subscription2&&t._removeParent(this)},Subscription2.EMPTY=((e=new Subscription2).closed=!0,e),Subscription2}();function isSubscription(t){return t instanceof e||t&&"closed"in t&&isFunction(t.remove)&&isFunction(t.add)&&isFunction(t.unsubscribe)}function execFinalizer(t){isFunction(t)?t():t.unsubscribe()}e.EMPTY;var r=void 0,timeoutProvider_setTimeout=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,__spreadArray([t,e],__read(r)))};function reportUnhandledError(t){timeoutProvider_setTimeout(function(){throw t})}function noop(){}var n=function(t){function Subscriber2(e){var r=t.call(this)||this;return r.isStopped=!1,e?(r.destination=e,isSubscription(e)&&e.add(r)):r.destination=s,r}return __extends(Subscriber2,t),Subscriber2.create=function(t,e,r){return new i(t,e,r)},Subscriber2.prototype.next=function(t){this.isStopped||this._next(t)},Subscriber2.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},Subscriber2.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},Subscriber2.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},Subscriber2.prototype._next=function(t){this.destination.next(t)},Subscriber2.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},Subscriber2.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},Subscriber2}(e),o=function(){function ConsumerObserver2(t){this.partialObserver=t}return ConsumerObserver2.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(r){handleUnhandledError(r)}},ConsumerObserver2.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(r){handleUnhandledError(r)}else handleUnhandledError(t)},ConsumerObserver2.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){handleUnhandledError(e)}},ConsumerObserver2}(),i=function(t){function SafeSubscriber2(e,r,n){var i,s=t.call(this)||this;return i=isFunction(e)||!e?{next:null!=e?e:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:e,s.destination=new o(i),s}return __extends(SafeSubscriber2,t),SafeSubscriber2}(n);function handleUnhandledError(t){reportUnhandledError(t)}var s={closed:!0,next:noop,error:function defaultErrorHandler(t){throw t},complete:noop},a="function"==typeof Symbol&&Symbol.observable||"@@observable";function identity(t){return t}var c=function(){function Observable2(t){t&&(this._subscribe=t)}return Observable2.prototype.lift=function(t){var e=new Observable2;return e.source=this,e.operator=t,e},Observable2.prototype.subscribe=function(t,e,r){var o=this,s=function isSubscriber(t){return t&&t instanceof n||function isObserver(t){return t&&isFunction(t.next)&&isFunction(t.error)&&isFunction(t.complete)}(t)&&isSubscription(t)}(t)?t:new i(t,e,r);return function errorContext(t){t()}(function(){var t=o,e=t.operator,r=t.source;s.add(e?e.call(s,r):r?o._subscribe(s):o._trySubscribe(s))}),s},Observable2.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},Observable2.prototype.forEach=function(t,e){var r=this;return new(e=getPromiseCtor(e))(function(e,n){var o=new i({next:function(e){try{t(e)}catch(r){n(r),o.unsubscribe()}},error:n,complete:e});r.subscribe(o)})},Observable2.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},Observable2.prototype[a]=function(){return this},Observable2.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function pipeFromArray(t){return 0===t.length?identity:1===t.length?t[0]:function piped(e){return t.reduce(function(t,e){return e(t)},e)}}(t)(this)},Observable2.prototype.toPromise=function(t){var e=this;return new(t=getPromiseCtor(t))(function(t,r){var n;e.subscribe(function(t){return n=t},function(t){return r(t)},function(){return t(n)})})},Observable2.create=function(t){return new Observable2(t)},Observable2}();function getPromiseCtor(t){var e;return null!==(e=null!=t?t:r)&&void 0!==e?e:Promise}function operate(t){return function(e){if(function hasLift(t){return isFunction(null==t?void 0:t.lift)}(e))return e.lift(function(e){try{return t(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function createOperatorSubscriber(t,e,r,n,o){return new u(t,e,r,n,o)}var u=function(t){function OperatorSubscriber2(e,r,n,o,i,s){var a=t.call(this,e)||this;return a.onFinalize=i,a.shouldUnsubscribe=s,a._next=r?function(t){try{r(t)}catch(n){e.error(n)}}:t.prototype._next,a._error=o?function(t){try{o(t)}catch(r){e.error(r)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return __extends(OperatorSubscriber2,t),OperatorSubscriber2.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},OperatorSubscriber2}(n);function popScheduler(t){return function isScheduler(t){return t&&isFunction(t.schedule)}(function last(t){return t[t.length-1]}(t))?t.pop():void 0}var isArrayLike=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function isPromise(t){return isFunction(null==t?void 0:t.then)}function isInteropObservable(t){return isFunction(t[a])}function isAsyncIterable(t){return Symbol.asyncIterator&&isFunction(null==t?void 0:t[Symbol.asyncIterator])}function createInvalidObservableTypeError(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var l=function getSymbolIterator(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function isIterable(t){return isFunction(null==t?void 0:t[l])}function readableStreamLikeToAsyncGenerator(t){return __asyncGenerator(this,arguments,function readableStreamLikeToAsyncGenerator_1(){var e,r,n;return __generator(this,function(o){switch(o.label){case 0:e=t.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,__await(e.read())];case 3:return r=o.sent(),n=r.value,r.done?[4,__await(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,__await(n)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function isReadableStreamLike(t){return isFunction(null==t?void 0:t.getReader)}function innerFrom(t){if(t instanceof c)return t;if(null!=t){if(isInteropObservable(t))return function fromInteropObservable(t){return new c(function(e){var r=t[a]();if(isFunction(r.subscribe))return r.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(isArrayLike(t))return function fromArrayLike(t){return new c(function(e){for(var r=0;r<t.length&&!e.closed;r++)e.next(t[r]);e.complete()})}(t);if(isPromise(t))return function fromPromise(t){return new c(function(e){t.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,reportUnhandledError)})}(t);if(isAsyncIterable(t))return fromAsyncIterable(t);if(isIterable(t))return function fromIterable(t){return new c(function(e){var r,n;try{for(var o=__values(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.next(s),e.closed)return}}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}e.complete()})}(t);if(isReadableStreamLike(t))return function fromReadableStreamLike(t){return fromAsyncIterable(readableStreamLikeToAsyncGenerator(t))}(t)}throw createInvalidObservableTypeError(t)}function fromAsyncIterable(t){return new c(function(e){(function process(t,e){var r,n,o,i;return __awaiter(this,void 0,void 0,function(){var s,a;return __generator(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=__asyncValues(t),c.label=1;case 1:return[4,r.next()];case 2:if((n=c.sent()).done)return[3,4];if(s=n.value,e.next(s),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),o={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})})(t,e).catch(function(t){return e.error(t)})})}function executeSchedule(t,e,r,n,o){void 0===n&&(n=0),void 0===o&&(o=!1);var i=e.schedule(function(){r(),o?t.add(this.schedule(null,n)):this.unsubscribe()},n);if(t.add(i),!o)return i}function observeOn(t,e){return void 0===e&&(e=0),operate(function(r,n){r.subscribe(createOperatorSubscriber(n,function(r){return executeSchedule(n,t,function(){return n.next(r)},e)},function(){return executeSchedule(n,t,function(){return n.complete()},e)},function(r){return executeSchedule(n,t,function(){return n.error(r)},e)}))})}function subscribeOn(t,e){return void 0===e&&(e=0),operate(function(r,n){n.add(t.schedule(function(){return r.subscribe(n)},e))})}function scheduleAsyncIterable(t,e){if(!t)throw new Error("Iterable cannot be null");return new c(function(r){executeSchedule(r,e,function(){var n=t[Symbol.asyncIterator]();executeSchedule(r,e,function(){n.next().then(function(t){t.done?r.complete():r.next(t.value)})},0,!0)})})}function scheduled(t,e){if(null!=t){if(isInteropObservable(t))return function scheduleObservable(t,e){return innerFrom(t).pipe(subscribeOn(e),observeOn(e))}(t,e);if(isArrayLike(t))return function scheduleArray(t,e){return new c(function(r){var n=0;return e.schedule(function(){n===t.length?r.complete():(r.next(t[n++]),r.closed||this.schedule())})})}(t,e);if(isPromise(t))return function schedulePromise(t,e){return innerFrom(t).pipe(subscribeOn(e),observeOn(e))}(t,e);if(isAsyncIterable(t))return scheduleAsyncIterable(t,e);if(isIterable(t))return function scheduleIterable(t,e){return new c(function(r){var n;return executeSchedule(r,e,function(){n=t[l](),executeSchedule(r,e,function(){var t,e,o;try{e=(t=n.next()).value,o=t.done}catch(i){return void r.error(i)}o?r.complete():r.next(e)},0,!0)}),function(){return isFunction(null==n?void 0:n.return)&&n.return()}})}(t,e);if(isReadableStreamLike(t))return function scheduleReadableStreamLike(t,e){return scheduleAsyncIterable(readableStreamLikeToAsyncGenerator(t),e)}(t,e)}throw createInvalidObservableTypeError(t)}function from$1(t,e){return e?scheduled(t,e):innerFrom(t)}function of(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return from$1(t,popScheduler(t))}var h=createErrorClass(function(t){return function EmptyErrorImpl(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function map(t,e){return operate(function(r,n){var o=0;r.subscribe(createOperatorSubscriber(n,function(r){n.next(t.call(e,r,o++))}))})}var p=Array.isArray;function mapOneOrManyArgs(t){return map(function(e){return function callOrApply(t,e){return p(e)?t.apply(void 0,__spreadArray([],__read(e))):t(e)}(t,e)})}function mergeMap(t,e,r){return void 0===r&&(r=1/0),isFunction(e)?mergeMap(function(r,n){return map(function(t,o){return e(r,t,n,o)})(innerFrom(t(r,n)))},r):("number"==typeof e&&(r=e),operate(function(e,n){return function mergeInternals(t,e,r,n,o,i,s,a){var c=[],u=0,l=0,h=!1,checkComplete=function(){!h||c.length||u||e.complete()},doInnerSub=function(t){u++;var o=!1;innerFrom(r(t,l++)).subscribe(createOperatorSubscriber(e,function(t){e.next(t)},function(){o=!0},void 0,function(){if(o)try{u--;for(var _loop_1=function(){var t=c.shift();s||doInnerSub(t)};c.length&&u<n;)_loop_1();checkComplete()}catch(t){e.error(t)}}))};return t.subscribe(createOperatorSubscriber(e,function(t){return u<n?doInnerSub(t):c.push(t)},function(){h=!0,checkComplete()})),function(){}}(e,n,t,r)}))}function concatAll(){return function mergeAll(t){return mergeMap(identity,t)}(1)}var f=["addListener","removeListener"],d=["addEventListener","removeEventListener"],y=["on","off"];function toCommonHandlerRegistry(t,e){return function(r){return function(n){return t[r](e,n)}}}function reduce(t,e){return operate(function scanInternals(t,e,r,n,o){return function(n,o){var i=r,s=e,a=0;n.subscribe(createOperatorSubscriber(o,function(e){var r=a++;s=i?t(s,e,r):(i=!0,e)},function(){i&&o.next(s),o.complete()}))}}(t,e,arguments.length>=2))}var arrReducer=function(t,e){return t.push(e),t};function concatMap(t,e){return isFunction(e)?mergeMap(t,e,1):mergeMap(t,1)}function isArray(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function multQuatVec(t,e){const{x:r,y:n,z:o}=e,{x:i,y:s,z:a,w:c}=t,u=c*r+s*o-a*n,l=c*n+a*r-i*o,h=c*o+i*n-s*r,p=-i*r-s*n-a*o,f=u*c+p*-i+l*-a-h*-s,d=l*c+p*-s+h*-i-u*-a,y=h*c+p*-a+u*-s-l*-i;return new e.constructor(f,d,y)}const m=Math.PI,b=2*Math.PI;function normRad(t){let e=t%b;return e<-m?e+=b:e>m&&(e-=b),e}function isNumber(t){return"number"==typeof t||(null==t?void 0:t.constructor)===Number}const g=0,v=1,S=2,_=3,w=9999999999999,O=void 0,x=Symbol("vector length"),E=Symbol("get source"),C=Symbol("checked");let A,T,z=O;const P=[0,1,2,6,24,120,720,5760,51840,518400,5702400,68428800,889574400,12454041600,186810624e3],I=[];let M=-1,F=!1;const L=[];function handleProgess(t,e,r){z=t,M=-1,T=1;const n=e(r);if(!isNumber(n))throw new Error("\n      your assigned progress did not not return a primitive!\n      calc() does not support logical operators (|| && ==) directly\n\n      instead of calc(() => v1 || v2);\n      use        calc(() => +v1 || +v2);\n\n      instead of calc(() => v1);\n      use        calc(v1);\n      ");return n}function getVectorLength(t){const e=t[E];return e?e(t).length:t[x]||3}function setVectorValue(t,e,r){const n=t[E];n?n(t)[e]=r:e!==g?e!==v?(e===S&&(t.z=r),e===_&&(t.w=r)):t.y=r:t.x=r}function operatorCalc(t,e=void 0){if("function"!=typeof t)throw new Error("no function assigned");if(z!==O)throw new Error("something wrong, do you use calc() inside calc?");try{const r=void 0===e,n="function"==typeof e,o=n||r?void 0:e,i=handleProgess(g,t,o);if(r&&void 0===A)return i;const s=A?getVectorLength(A):0;if(s===w){if(!t[C]){const e=handleProgess(w,t),r=P[T];if(Math.abs(e-r)>Number.EPSILON)throw new Error("\n            algebraic multiplication works only in calls with *\n\n            calc(() => v * m);\n            calc(() => m * v);\n            calc(() => m * m);\n            calc(() => m * m * v);\n\n            ");t[C]=!0}let e=I[0];for(let t=1;t<T-1;t+=1){const r=I[t];if(!e.multiply)throw new Error(`cannot find method multiply() on ${e}`);e=e.multiply(r)}return e}let a=n?e.length:s;if(a||(a=s),a<s)throw new Error("Your assigned result Vector cant use higher space Operands than it has");const c=new Array(a);c[0]=i,o&&setVectorValue(o,z,c[0]);for(let e=1;e<a;e+=1){const r=handleProgess(e,t,o);c[e]=r,o&&setVectorValue(o,z,r)}return r?new A.constructor(...c):n?e(...c):o}finally{z=O,A=void 0}}function cachedValueOf(t,e){const r=t.prototype;r[E]=e;const n=r[Symbol.toPrimitive]||function(t){return"string"===t?this.toString():this.valueOf()};r[Symbol.toPrimitive]=function(t){return z===g&&(A=A?function maxVector(t,e){return getVectorLength(t)>getVectorLength(e)?t:e}(A,this):this,I[T-1]=this),z===O?n.call(this,t):function getVectorValue(t,e){if(T+=1,e===w)return T;if(e>=getVectorLength(t))return 0;const r=t[E];return r?1*r(t)[e]:e===g?1*t.x:e===v?1*t.y:e===S?1*t.z:e===_?1*t.w:void 0}(this,z)}}function bindCache(t){return function(...e){if(z===g){if(F)return t.apply(this,e);try{F=!0,M+=1;const r=t.apply(this,e);return L[M]=r,r}finally{F=!1}}return z===v||z===S||z===_?(M+=1,L[M]):t.apply(this,e)}}function cachedMethod(t,e){const r=t.prototype,n=r[e];r[e]=bindCache(n)}function cachedGetter(t,e){const r=t.prototype,n=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(r,e,{get:bindCache(function(){return n.get.call(this)})})}function defineVectorLength(t,e){const r=t.prototype;Object.defineProperty(r,x,{value:e})}function defineMatrixLength(t){defineVectorLength(t,w)}function cachedFunction(t){return bindCache(t)}function convertToCSSVars(t,e,r={}){const n=function getVarPrefix(t){let e="";return t&&(e=`${t}-`),e}(t);return Object.entries(e).forEach(([t,e])=>{r[`--${n}${t}`]=e}),r}"undefined"!=typeof DOMPoint&&(t=>{try{cachedValueOf(t),defineVectorLength(t,4)}catch(e){console.error("error while hijackDOMPoint"),console.error(e)}})(DOMPoint);const R=Symbol("axes");function square$1(t){return t*t}class APoint{constructor(...t){"function"==typeof t[0]?operatorCalc(t[0],(t,e)=>{this[R]=[t,e]}):isArray(t[0])?this[R]=[...t[0]]:t[0]&&isNumber(t[0].x)?this[R]=[t[0].x||0,t[0].y||0]:this[R]=[t[0]||0,t[1]||0]}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}normalize(){const{length:t}=this;return new this.constructor(this.x/t,this.y/t)}norm(){return this.normalize()}dot(t){return this.x*t.x+this.y*t.y}getRad(){return normRad(Math.atan2(this.y,this.x))}angleTo(t){return function angleOverGround(t,e,r,n){return normRad(Math.atan2(t,e)-Math.atan2(r,n))}(this.y,this.x,t.y,t.x)}rotate(t){const e=Math.sin(t),r=Math.cos(t),n=this.x*r-this.y*e,o=this.x*e+this.y*r;return new this.constructor(n,o)}distance(t){return Math.sqrt(square$1(this.x-t.x)+square$1(this.y-t.y))}dist(t){return this.distance(t)}toArray(){return[this.x,this.y]}calc(t){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(t){return this.x===t.x&&this.y===t.y}toJSON(){return{x:this.x,y:this.y}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,e={}){return convertToCSSVars(t,this.toJSON(),e)}get lengthSq(){return this.dot(this)}get length(){return Math.sqrt(this.lengthSq)}get lensq(){return this.lengthSq}get len(){return this.length}get x(){return this[R][0]}set x(t){throw new Error("set x() not implemented")}get y(){return this[R][1]}set y(t){throw new Error("set y() not implemented")}get z(){throw new Error("get z() not implemented")}set z(t){throw new Error("set z() not implemented")}[Symbol.iterator](){return this[R].values()}}cachedValueOf(APoint),defineVectorLength(APoint,2),cachedMethod(APoint,"dot"),cachedMethod(APoint,"angleTo"),cachedMethod(APoint,"distance"),cachedMethod(APoint,"toArray"),cachedMethod(APoint,"getRad"),cachedGetter(APoint,"length"),cachedGetter(APoint,"lengthSq");class Point extends APoint{set x(t){this[R][0]=t}set y(t){this[R][1]=t}get x(){return this[R][0]}get y(){return this[R][1]}calc(t){return operatorCalc(t,this)}clone(){return new Point(this.x,this.y)}}class IPoint extends APoint{toPoint(){return new Point(this.x,this.y)}}const N=cachedFunction((t,e)=>new IPoint(t,e)),ipoint=(t,e)=>N(t,e);ipoint(0,0),ipoint(0,-1),ipoint(-1,0);const V=Symbol("axes");function square(t){return t*t}class AVector{constructor(...t){"function"==typeof t[0]?operatorCalc(t[0],(t,e,r)=>{this[V]=[t,e,r]}):isArray(t[0])?this[V]=[...t[0]]:t[0]&&isNumber(t[0].x)?this[V]=[t[0].x||0,t[0].y||0,t[0].z||0]:this[V]=[t[0]||0,t[1]||0,t[2]||0]}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}normalize(){const{length:t}=this;return new this.constructor(this.x/t,this.y/t,this.z/t)}norm(){return this.normalize()}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new this.constructor(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossNormalize(t){const e=this.cross(t),{length:r}=e;return e[V][0]/=r,e[V][1]/=r,e[V][2]/=r,e}cn(t){return this.crossNormalize(t)}toAngles(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length)}}angleTo(t){return normRad(function acos(t){return t>-1?t<1?Math.acos(t):0:m}(this.dot(t)/(this.length*t.length)))}multiply(t){return void 0===t.x?this.multiplyMat3(t):void 0===t.w?this.multiplyVec3(t):multQuatVec(t,this)}multiplyMat3(t){return function multiplyVecMat3(t,[e,r,n]){return new t.constructor(t.dot(e),t.dot(r),t.dot(n))}(this,t)}multiplyVec3({x:t,y:e,z:r}){return new this.constructor(this.x*t,this.y*e,this.z*r)}distance(t){return Math.sqrt(square(this.x-t.x)+square(this.y-t.y)+square(this.z-t.z))}dist(t){return this.distance(t)}toArray(){return[this.x,this.y,this.z]}swizzle(t){const e=t.split("").map(t=>this[t]);return 2===e.length?new IPoint(e[0],e[1]):new this.constructor(e[0],e[1],e[2])}calc(t){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}toJSON(){return{x:this.x,y:this.y,z:this.z}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,e={}){return convertToCSSVars(t,this.toJSON(),e)}get lengthSq(){return this.dot(this)}set lengthSq(t){throw new Error("set lengthSq() not implemented")}get length(){return Math.sqrt(this.lengthSq)}set length(t){throw new Error("set length() not implemented")}get lensq(){return this.lengthSq}set lensq(t){throw new Error("set lensq() not implemented")}get len(){return this.length}set len(t){throw new Error("set len() not implemented")}get x(){return this[V][0]}set x(t){throw new Error("set x() not implemented")}get y(){return this[V][1]}set y(t){throw new Error("set y() not implemented")}get z(){return this[V][2]}set z(t){throw new Error("set z() not implemented")}get xy(){return new IPoint(this[V][0],this[V][1])}set xy(t){throw new Error("set xz() not implemented")}get xz(){return new IPoint(this[V][0],this[V][2])}set xz(t){throw new Error("set xz() not implemented")}get yz(){return new IPoint(this[V][1],this[V][2])}set yz(t){throw new Error("set yz() not implemented")}[Symbol.iterator](){return this[V].values()}}cachedValueOf(AVector),defineVectorLength(AVector,3),cachedMethod(AVector,"dot"),cachedMethod(AVector,"cross"),cachedMethod(AVector,"crossNormalize"),cachedMethod(AVector,"toAngles"),cachedMethod(AVector,"angleTo"),cachedMethod(AVector,"rotate"),cachedMethod(AVector,"distance"),cachedMethod(AVector,"toArray"),cachedGetter(AVector,"length"),cachedGetter(AVector,"lengthSq");class Vector extends AVector{set x(t){this[V][0]=t}set y(t){this[V][1]=t}set z(t){this[V][2]=t}get x(){return this[V][0]}get y(){return this[V][1]}get z(){return this[V][2]}calc(t){return operatorCalc(t,this)}clone(){return new Vector(this.x,this.y,this.z)}}class Victor extends AVector{toVector(){return new Vector(this.x,this.y,this.z)}clone(){return this}}const D=cachedFunction((t,e,r)=>new Victor(t,e,r)),victor=(t,e,r)=>D(t,e,r);victor(0,0,0);const k=victor(0,0,-1);victor(0,0,1);const U=victor(-1,0,0);victor(1,0,0);const j=victor(0,1,0);victor(0,-1,0),victor(1,1,1);const H=Symbol("angle rad"),G=Math.PI/180;class ADegree{constructor(t){this[H]=t instanceof ADegree?t[H]:normRad(t*G)}valueOf(){return this[H]}toJSON(){return{angle:this[H]}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,e={}){return convertToCSSVars(t,this.toJSON(),e)}}class Degree extends ADegree{set(t){this[H]=t instanceof ADegree?t[H]:normRad((t||0)*G)}}new class IDegree extends ADegree{toDegree(){return new Degree(this[H])}}(0);const q=Symbol("axes"),J=Symbol("forward cache"),B=Symbol("left cache"),$=Symbol("up cache"),Z=Symbol("inverse cache");function normalize(t){const e=function length([t,e,r,n]){return Math.sqrt(t*t+e*e+r*r+n*n)}(t);t[0]/=e,t[1]/=e,t[2]/=e,t[3]/=e}function getQuat(t,e,r,n){return isNumber(t)?[t,e,r,n]:isArray(t)?[...t]:function isAngle(t){return isNumber(t)||t instanceof ADegree}(e)?function axisAngle(t,e){const r=new Array(4),n=.5*e,o=Math.sin(n),i=Math.cos(n);return r[0]=o*t.x,r[1]=o*t.y,r[2]=o*t.z,r[3]=i,r}(t,e):t&&e?function look(t,e){const r=t.normalize(),n=e.crossNormalize(r),o=r.crossNormalize(n),i=n.x,s=n.y,a=n.z,c=o.x,u=o.y,l=o.z,h=r.x,p=r.y,f=r.z,d=i+u+f,y=new Array(4);if(d>0){let t=Math.sqrt(d+1);return y[3]=.5*t,t=.5/t,y[0]=(l-p)*t,y[1]=(h-a)*t,y[2]=(s-c)*t,y}if(i>=u&&i>=f){const t=Math.sqrt(1+i-u-f),e=.5/t;return y[0]=.5*t,y[1]=(s+c)*e,y[2]=(a+h)*e,y[3]=(l-p)*e,y}if(u>f){const t=Math.sqrt(1+u-i-f),e=.5/t;return y[0]=(c+s)*e,y[1]=.5*t,y[2]=(p+l)*e,y[3]=(h-a)*e,y}const m=Math.sqrt(1+f-i-u),b=.5/m;return y[0]=(h+a)*b,y[1]=(p+l)*b,y[2]=.5*m,y[3]=(s-c)*b,y}(t,e):void 0}class AQuaternion{constructor(t,e,r,n){this[q]=function from(t,e,r,n){return t&&isNumber(t.w)?getQuat(t.x,t.y,t.z,t.w):getQuat(t,e,r,n)||[0,0,0,1]}(t,e,r,n),normalize(this[q])}set(t,e,r,n){throw new Error("set x() not implemented")}multiply(t,e,r,n){if(isNumber(t.w))return this.multiplyQuaternion(t);const o=getQuat(t,e,r,n);return o?this.multiplyQuaternion(new this.constructor(o)):this.multiplyVector(t)}multiplyVector(t){return multQuatVec(this,t)}multiplyQuaternion(t){const e=this.x,r=this.y,n=this.z,o=this.w,i=t.x,s=t.y,a=t.z,c=t.w,u=o*i+e*c+r*a-n*s,l=o*s+r*c+n*i-e*a,h=o*a+n*c+e*s-r*i,p=o*c-e*i-r*s-n*a;return new this.constructor(u,l,h,p)}mul(t,e,r,n){return this.multiply(t,e,r,n)}get inverse(){const{x:t,y:e,z:r,w:n}=this;return this.constructor(-1*t,-1*e,-1*r,n)}get inv(){return this.inverse}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}get left(){return this.multiplyVector(U)}get dir(){return this.multiplyVector(k)}get up(){return this.multiplyVector(j)}get 0(){return this.left}get 1(){return this.dir}get 2(){return this.up}get x(){return this[q][0]}set x(t){throw new Error("set x() not implemented")}get y(){return this[q][1]}set y(t){throw new Error("set y() not implemented")}get z(){return this[q][2]}set z(t){throw new Error("set z() not implemented")}get w(){return this[q][3]}set w(t){throw new Error("set w() not implemented")}toJSON(){const{x:t,y:e,z:r,w:n}=this;return{x:t,y:e,z:r,w:n,a1:1-e*e*2-r*r*2,a2:t*e*2-r*n*2,a3:t*r*2+e*n*2,b1:t*e*2+r*n*2,b2:1-t*t*2-r*r*2,b3:e*r*2-t*n*2,c1:t*r*2-e*n*2,c2:e*r*2+t*n*2,c3:1-t*t*2-e*e*2}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,e={}){return convertToCSSVars(t,this.toJSON(),e)}}function fromCache(t,e,r){let n=t[e];return n||(n=r(),t[e]=n),n}cachedValueOf(AQuaternion),defineMatrixLength(AQuaternion);class IQuaternion extends AQuaternion{get left(){return fromCache(this,B,()=>this.multiplyVector(U))}get dir(){return fromCache(this,J,()=>this.multiplyVector(k))}get up(){return fromCache(this,$,()=>this.multiplyVector(j))}get inverse(){return fromCache(this,Z,()=>{const{x:t,y:e,z:r,w:n}=this;return this.constructor(-1*t,-1*e,-1*r,n)})}}const Q=cachedFunction((t,e,r,n)=>new IQuaternion(t,e,r,n));new IQuaternion(U,function degree(t){return new Degree(t)}(90)),Q(0,0,0,1);const W=Symbol("axes");class AColor{constructor(t,e,r,n){"function"==typeof t?operatorCalc(t,(t,e,r,n)=>{this[W]=[t,e,r,n]}):isArray(t)?this[W]=[...t]:t&&isNumber(t.x)?this[W]=[t.x||0,t.y||0,t.z||0,t.w||0]:this[W]=[t||0,e||0,r||0,n||0]}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}toArray(){return[this.x,this.y,this.z,this.w]}calc(t){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}toJSON(){return{x:this.x,y:this.y,z:this.z,w:this.w}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,e={}){return convertToCSSVars(t,this.toJSON(),e)}get x(){return this[W][0]}set x(t){throw new Error("set x() not implemented")}get y(){return this[W][1]}set y(t){throw new Error("set y() not implemented")}get z(){return this[W][2]}set z(t){throw new Error("set z() not implemented")}get w(){return this[W][3]}set w(t){throw new Error("set w() not implemented")}[Symbol.iterator](){return this[W].values()}}cachedValueOf(AColor),defineVectorLength(AColor,4),cachedMethod(AColor,"toArray");const K=Symbol("data");class AMat3{constructor(...t){this[K]=t}get 0(){return this[K][0]}set 0(t){throw new Error("set [0] not implemented")}get 1(){return this[K][1]}set 1(t){throw new Error("set [1] not implemented")}get 2(){return this[K][2]}set 2(t){throw new Error("set [2] not implemented")}multiplyMat(t){return function multiplyMat3Mat3(t,[e,r,n]){const[o,i,s]=t;return new t.constructor(new o.constructor(o.x*e.x+i.x*e.y+s.x*e.z,o.y*e.x+i.y*e.y+s.y*e.z,o.z*e.x+i.z*e.y+s.z*e.z),new o.constructor(o.x*r.x+i.x*r.y+s.x*r.z,o.y*r.x+i.y*r.y+s.y*r.z,o.z*r.x+i.z*r.y+s.z*r.z),new o.constructor(o.x*n.x+i.x*n.y+s.x*n.z,o.y*n.x+i.y*n.y+s.y*n.z,o.z*n.x+i.z*n.y+s.z*n.z))}(this,t)}multiplyVec(t){return function multiplyMat3Vec(t,{x:e,y:r,z:n}){const[o,i,s]=t;return new o.constructor(o.x*e+i.x*r+s.x*n,o.y*e+i.y*r+s.y*n,o.z*e+i.z*r+s.z*n)}(this,t)}multiply(t){if(t instanceof AMat3)return this.multiplyMat(t);const{x:e,y:r,z:n}=t;if(void 0===e||void 0===r||void 0===n)throw new Error(`multiply only works with mat3 and vec3, not supported ${t}`);return this.multiplyVec(t)}[Symbol.iterator](){return this[K].values()}}cachedValueOf(AMat3),defineMatrixLength(AMat3);const Y=[{validator:()=>!0,handler:()=>t=>t.pipe(map(t=>t))}];class AsyncTransform{constructor(t,e){__publicField(this,"validator"),__publicField(this,"handler"),this.validator=t,this.handler=e}}const X=[{validator:()=>!0,handler:()=>t=>t.pipe(map(t=>t))}],tt={[Object.prototype.constructor.name]:t=>e=>e.pipe(map(Object.entries),traverse(t),map(Object.fromEntries)),[Array.prototype.constructor.name]:t=>e=>e.pipe(concatAll(),traverse(t),function toArray(){return operate(function(t,e){reduce(arrReducer,[])(t).subscribe(e)})}()),[Promise.prototype.constructor.name]:t=>e=>e.pipe(concatMap(t=>from$1(t)),traverse(t)),[c.prototype.constructor.name]:t=>e=>e.pipe(concatMap(t=>t),traverse(t)),[void 0]:()=>t=>t};function serialize(t=[]){return e=>e.pipe(traverse(((t=[])=>[...t,...Y])(t)))}function deserialize(t=[]){return e=>e.pipe(traverse(((t=[])=>[...t,...X])(t)))}function traverse(t){return e=>e.pipe(mergeMap(e=>{const r=function getInstructionKey(t){if(null==t)return;const e=t.constructor;if(e){const t=e.name;if(Object.prototype.hasOwnProperty.call(tt,t))return t}return}(e),n=r&&tt[r];return n?of(e).pipe(n(t)):of(e)}),function transform(t){return e=>e.pipe(concatMap(e=>of(e).pipe(findTransform(t,e).handler())))}(t))}const findTransform=(t,e)=>{const r=t.find(({validator:t})=>t(e));return r||{validator:()=>!0,handler:t=>t}};class Color{constructor(t,e=0,r=0,n=255){if(__publicField(this,"r"),this.g=e,this.b=r,this.a=n,Array.isArray(t))[this.r,this.g,this.b,this.a]=t;else if("string"==typeof t){const e=Color.fromHex(t);this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a}else"object"==typeof t?(this.r=t.r||0,this.g=t.g||0,this.b=t.b||0,this.a=void 0!==t.a?t.a:255):(this.r=t,this.g=e||0,this.b=r||0,this.a=void 0===n?255:n);this.r=Math.min(Math.max(this.r,0),255),this.g=Math.min(Math.max(this.g,0),255),this.b=Math.min(Math.max(this.b,0),255),this.a=Math.min(Math.max(this.a,0),255)}static fromHex(t){4===t.length&&(t=`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`);const e=parseInt(t.slice(1,3),16),r=parseInt(t.slice(3,5),16),n=parseInt(t.slice(5,7),16),o=parseInt(t.slice(7,9),16);return new Color(e,r,n,isNaN(o)?255:o)}static fromHsl(t,e,r,n=255){const{r:o,g:i,b:s}=function hslToRgb(t,e,r){let n,o,i;if(0===e)n=o=i=r;else{const hue2rgb=(t,e,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t),s=r<.5?r*(1+e):r+e-r*e,a=2*r-s;n=hue2rgb(a,s,t/360+1/3),o=hue2rgb(a,s,t/360),i=hue2rgb(a,s,t/360-1/3)}return{r:Math.round(255*n),g:Math.round(255*o),b:Math.round(255*i)}}(t,e,r);return new Color(o,i,s,n)}static isValidHex(t){return/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(t)}toInverted(){return new Color(255-this.r,255-this.g,255-this.b,this.a)}toJSON(){return{_type:this.constructor.name,r:this.r,g:this.g,b:this.b,a:this.a}}toHex(){return`#${this.toRGBA().map(t=>t.toString(16).padStart(2,"0")).join("")}`}toRGB(){return[this.r,this.g,this.b]}toRGBA(){return[...this.toRGB(),this.a]}toCSSRGB(){return[...this.toRGB()]}toCSSRGBA(){return[...this.toRGB(),this.a/255]}toHsl(){const t=this.r/255,e=this.g/255,r=this.b/255,n=Math.max(t,e,r),o=Math.min(t,e,r);let i=0,s=0;const a=(n+o)/2;if(n===o)i=s=0;else{const c=n-o;switch(s=a>.5?c/(2-n-o):c/(n+o),n){case t:i=(e-r)/c+(e<r?6:0);break;case e:i=(r-t)/c+2;break;case r:i=(t-e)/c+4}i/=6}return[Math.round(360*i),s,a]}toHsla(){const[t,e,r]=this.toHsl();return[t,e,r,this.a]}toHsv(){const t=this.r/255,e=this.g/255,r=this.b/255,n=Math.max(t,e,r),o=Math.min(t,e,r);let i=0,s=0;const a=n,c=n-o;if(0===n)return[0,0,0];if(s=c/n,n===o)i=0;else{switch(n){case t:i=(e-r)/c+(e<r?6:0);break;case e:i=(r-t)/c+2;break;case r:i=(t-e)/c+4}i/=6}return[Math.round(360*i),s,a]}toHsva(){const[t,e,r]=this.toHsv();return[t,e,r,this.a]}getHslaHue(){const[t]=this.toHsl();return t}getHslaSaturation(){const[t]=this.toHsl();return t}getHslaLightness(){const[t]=this.toHsl();return t}setHslaHue(t){const[e,r,n]=this.toHsl();return Color.fromHsl(e+t,r,n,this.a)}setHslaSaturation(t){const[e,r,n]=this.toHsl();return Color.fromHsl(e,r+t,n,this.a)}setHslaLightness(t){const[e,r,n]=this.toHsl();return Color.fromHsl(e,r,n+t,this.a)}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}clone(){return new Color(this.r,this.g,this.b,this.a)}}var et=(t=>(t.DEFAULT="default",t.REFRESH="refresh",t.REFRESH_SUCCESS="refreshSuccess",t.DEBUG="debug",t.INIT="init",t.INIT_SUCCESS="initSuccess",t.SYNC_STATE="syncState",t.SYNC_STATE_SUCCESS="syncStateSuccess",t.ADD_RENDER_WORKER_PORT="addRenderWorkerPort",t.ADD_RENDER_WORKER_PORT_SUCCESS="addRenderWorkerPortSuccess",t.LOAD_IMAGE="loadImage",t.LOAD_IMAGE_SUCCESS="loadImageSuccess",t.UPDATE_CANVAS="updateCanvas",t.UPDATE_BUFFER="updateBuffer",t.UPDATE_BUFFER_SUCCESS="updateBufferSuccess",t.STACK="stack",t.STACK_SUCCESS="stackSuccess",t.UNDO_STACK="undoStack",t.UNDO_STACK_SUCCESS="undoStackSuccess",t.REDO_STACK="redoStack",t.REDO_STACK_SUCCESS="redoStackSuccess",t.CLEAR="clear",t.CLEAR_SUCCESS="clearSuccess",t.SET_ZOOM="setZoom",t.SET_ZOOM_SUCCESS="setZoomSuccess",t.ZOOM_FIT="zoomFit",t.ZOOM_FIT_SUCCESS="zoomFitSuccess",t.SET_POSITION="setPosition",t.SET_POSITION_SUCCESS="setPositionSuccess",t.USE_TOOL="useTool",t.USE_TOOL_SUCCESS="useToolSuccess",t.SET_SELECT_OPTIONS="setSelectOptions",t.SET_SELECT_OPTIONS_SUCCESS="setSelectOptionsSuccess",t.GET_DATA="getData",t.GET_DATA_SUCCESS="getDataSuccess",t.RESIZE="resize",t.RESIZE_SUCCESS="resizeSuccess",t.RESIZE_CANVAS="resizeCanvas",t.RESIZE_CANVAS_SUCCESS="resizeCanvasSuccess",t.GET_COLORS="getColors",t.GET_COLORS_SUCCESS="getColorsSuccess",t.IMAGE_OPERATION="imageOperation",t.IMAGE_OPERATION_SUCCESS="imageOperationSuccess",t.COLOR_PICKER="colorPicker",t.COLOR_PICKER_SUCCESS="colorPickerSuccess",t.SET_OPTIONS="setOptions",t.SET_OPTIONS_SUCCESS="setOptionsSuccess",t))(et||{}),rt=(t=>(t.TOP_LEFT="top_left",t.TOP_CENTER="top_center",t.TOP_RIGHT="top_right",t.CENTER_LEFT="center_left",t.CENTER="center",t.CENTER_RIGHT="center_right",t.BOTTOM_LEFT="bottom_left",t.BOTTOM_CENTER="bottom_center",t.BOTTOM_RIGHT="bottom_right",t))(rt||{});ipoint(-1,-1),ipoint(0,-1),ipoint(1,-1),ipoint(-1,0),ipoint(0,0),ipoint(1,0),ipoint(-1,1),ipoint(0,1),ipoint(1,1);class DisplayOptions{constructor(t){__publicField(this,"origin"),__publicField(this,"position"),__publicField(this,"colors"),__publicField(this,"grid"),__publicField(this,"zoomLevel"),__publicField(this,"precision");const{origin:e,position:r,colors:n,grid:o,zoomLevel:i}=t||{};this.origin=e||"center",this.position=r?ipoint(r.x,r.y):ipoint(0,0),this.colors={background:(null==n?void 0:n.background)?new Color(n.background):new Color(0,0,0),foreground:(null==n?void 0:n.foreground)?new Color(n.foreground):new Color(255,255,255)},this.grid={color:(null==o?void 0:o.color)?new Color(o.color):new Color(0,0,0,51),lineWidth:(null==o?void 0:o.lineWidth)||1,visibleCount:(null==o?void 0:o.visibleCount)||10},this.zoomLevel=i||1,this.precision=3}toJSON(){return{_type:this.constructor.name,origin:this.origin,position:this.position.toJSON(),colors:{background:this.colors.background.toJSON(),foreground:this.colors.foreground.toJSON()},grid:{color:this.grid.color.toJSON(),lineWidth:this.grid.lineWidth,visibleCount:this.grid.visibleCount},zoomLevel:this.zoomLevel,precision:this.precision}}}class PaletteColor{constructor(t){__publicField(this,"id"),__publicField(this,"color");const{id:e,color:r}=t||{};this.id=e||crypto.randomUUID(),this.color=r?new Color(r):new Color(0,0,0)}setColor(t){this.color=t}equal(t){return this.id===(null==t?void 0:t.id)}toJSON(){return{_type:this.constructor.name,id:this.id,color:this.color.toJSON()}}clone(){return new PaletteColor({id:this.id,color:this.color.clone()})}}class Palette{constructor(t){__publicField(this,"id"),__publicField(this,"name"),__publicField(this,"description"),__publicField(this,"colors"),__publicField(this,"locked");const{id:e,name:r,description:n,colors:o,locked:i}=t||{};this.id=e||crypto.randomUUID(),this.name=r||"",this.description=n,this.colors=(o||[]).map(t=>new PaletteColor(t)),this.locked=i}clone(){return new Palette({id:this.id,name:this.name,description:this.description,colors:this.colors.map(t=>t.clone()),locked:this.locked})}toJSON(){return{_type:this.constructor.name,id:this.id,name:this.name,description:this.description,colors:this.colors.map(t=>t.toJSON()),locked:this.locked}}}const nt=[new AsyncTransform(t=>t&&t instanceof IPoint,()=>t=>t.pipe(map(t=>t.toJSON()))),new AsyncTransform(t=>t&&t instanceof DisplayOptions,()=>t=>t.pipe(map(t=>t.toJSON()))),new AsyncTransform(t=>t&&t instanceof Color,()=>t=>t.pipe(map(t=>t.toJSON()))),new AsyncTransform(t=>t&&t instanceof PaletteColor,()=>t=>t.pipe(map(t=>t.toJSON()))),new AsyncTransform(t=>t&&t instanceof Palette,()=>t=>t.pipe(map(t=>t.toJSON())))],ot=[new AsyncTransform(t=>"object"==typeof t&&"x"in t&&"y"in t,()=>t=>t.pipe(map(t=>ipoint(t.x,t.y)))),new AsyncTransform(t=>t&&DisplayOptions.prototype.constructor.name===t._type,()=>t=>t.pipe(map(t=>new DisplayOptions(t)))),new AsyncTransform(t=>t&&Color.prototype.constructor.name===t._type,()=>t=>t.pipe(map(t=>new Color(t)))),new AsyncTransform(t=>t&&PaletteColor.prototype.constructor.name===t._type,()=>t=>t.pipe(map(t=>new PaletteColor(t)))),new AsyncTransform(t=>t&&Palette.prototype.constructor.name===t._type,()=>t=>t.pipe(map(t=>new Palette(t))))];const it={fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},st={silent:{level:-1},fatal:{level:it.fatal},error:{level:it.error},warn:{level:it.warn},log:{level:it.log},info:{level:it.info},success:{level:it.success},fail:{level:it.fail},ready:{level:it.info},start:{level:it.info},box:{level:it.info},debug:{level:it.debug},trace:{level:it.trace},verbose:{level:it.verbose}};function isPlainObject$1(t){if(null===t||"object"!=typeof t)return!1;const e=Object.getPrototypeOf(t);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&(!(Symbol.iterator in t)&&(!(Symbol.toStringTag in t)||"[object Module]"===Object.prototype.toString.call(t)))}function _defu(t,e,r=".",n){if(!isPlainObject$1(e))return _defu(t,{},r);const o=Object.assign({},e);for(const i in t){if("__proto__"===i||"constructor"===i)continue;const e=t[i];null!=e&&(Array.isArray(e)&&Array.isArray(o[i])?o[i]=[...e,...o[i]]:isPlainObject$1(e)&&isPlainObject$1(o[i])?o[i]=_defu(e,o[i],(r?`${r}.`:"")+i.toString()):o[i]=e)}return o}const at=function createDefu(t){return(...t)=>t.reduce((t,e)=>_defu(t,e,""),{})}();function isLogObj(t){return!!function isPlainObject(t){return"[object Object]"===Object.prototype.toString.call(t)}(t)&&(!(!t.message&&!t.args)&&!t.stack)}let ct=!1;const ut=[];class Consola{constructor(t={}){__publicField(this,"options"),__publicField(this,"_lastLog"),__publicField(this,"_mockFn");const e=t.types||st;this.options=at({...t,defaults:{...t.defaults},level:_normalizeLogLevel(t.level,e),reporters:[...t.reporters||[]]},{types:st,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const r in e){const t={type:r,...this.options.defaults,...e[r]};this[r]=this._wrapLogFn(t),this[r].raw=this._wrapLogFn(t,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(t){this.options.level=_normalizeLogLevel(t,this.options.types,this.options.level)}prompt(t,e){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(t,e)}create(t){const e=new Consola({...this.options,...t});return this._mockFn&&e.mockTypes(this._mockFn),e}withDefaults(t){return this.create({...this.options,defaults:{...this.options.defaults,...t}})}withTag(t){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+t:t})}addReporter(t){return this.options.reporters.push(t),this}removeReporter(t){if(t){const e=this.options.reporters.indexOf(t);if(-1!==e)return this.options.reporters.splice(e,1)}else this.options.reporters.splice(0);return this}setReporters(t){return this.options.reporters=Array.isArray(t)?t:[t],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const t in this.options.types)console["__"+t]||(console["__"+t]=console[t]),console[t]=this[t].raw}restoreConsole(){for(const t in this.options.types)console["__"+t]&&(console[t]=console["__"+t],delete console["__"+t])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(t,e){t&&(t.__write||(t.__write=t.write),t.write=t=>{this[e].raw(String(t).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(t){t&&t.__write&&(t.write=t.__write,delete t.__write)}pauseLogs(){ct=!0}resumeLogs(){ct=!1;const t=ut.splice(0);for(const e of t)e[0]._logFn(e[1],e[2])}mockTypes(t){const e=t||this.options.mockFn;if(this._mockFn=e,"function"==typeof e)for(const r in this.options.types)this[r]=e(r,this.options.types[r])||this[r],this[r].raw=this[r]}_wrapLogFn(t,e){return(...r)=>{if(!ct)return this._logFn(t,r,e);ut.push([this,t,r,e])}}_logFn(t,e,r){if((t.level||0)>this.level)return!1;const n={date:new Date,args:[],...t,level:_normalizeLogLevel(t.level,this.options.types)};!r&&1===e.length&&isLogObj(e[0])?Object.assign(n,e[0]):n.args=[...e],n.message&&(n.args.unshift(n.message),delete n.message),n.additional&&(Array.isArray(n.additional)||(n.additional=n.additional.split("\n")),n.args.push("\n"+n.additional.join("\n")),delete n.additional),n.type="string"==typeof n.type?n.type.toLowerCase():"log",n.tag="string"==typeof n.tag?n.tag:"";const resolveLog=(t=!1)=>{const e=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&e>0){const t=[...this._lastLog.object.args];e>1&&t.push(`(repeated ${e} times)`),this._log({...this._lastLog.object,args:t}),this._lastLog.count=1}t&&(this._lastLog.object=n,this._log(n))};clearTimeout(this._lastLog.timeout);const o=this._lastLog.time&&n.date?n.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=n.date,o<this.options.throttle)try{const t=JSON.stringify([n.type,n.tag,n.args]),e=this._lastLog.serialized===t;if(this._lastLog.serialized=t,e&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin))return void(this._lastLog.timeout=setTimeout(resolveLog,this.options.throttle))}catch{}resolveLog(!0)}_log(t){for(const e of this.options.reporters)e.log(t,{options:this.options})}}function _normalizeLogLevel(t,e={},r=3){return void 0===t?r:"number"==typeof t?t:e[t]&&void 0!==e[t].level?e[t].level:r}Consola.prototype.add=Consola.prototype.addReporter,Consola.prototype.remove=Consola.prototype.removeReporter,Consola.prototype.clear=Consola.prototype.removeReporter,Consola.prototype.withScope=Consola.prototype.withTag,Consola.prototype.mock=Consola.prototype.mockTypes,Consola.prototype.pause=Consola.prototype.pauseLogs,Consola.prototype.resume=Consola.prototype.resumeLogs;class BrowserReporter{constructor(t){__publicField(this,"options"),__publicField(this,"defaultColor"),__publicField(this,"levelColorMap"),__publicField(this,"typeColorMap"),this.options={...t},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(t){return t<1?console.__error||console.error:1===t?console.__warn||console.warn:console.__log||console.log}log(t){const e=this._getLogFn(t.level),r="log"===t.type?"":t.type,n=t.tag||"",o=`\n      background: ${this.typeColorMap[t.type]||this.levelColorMap[t.level]||this.defaultColor};\n      border-radius: 0.5em;\n      color: white;\n      font-weight: bold;\n      padding: 2px 0.5em;\n    `,i=`%c${[n,r].filter(Boolean).join(":")}`;"string"==typeof t.args[0]?e(`${i}%c ${t.args[0]}`,o,"",...t.args.slice(1)):e(i,o,...t.args)}}const lt=function createConsola(t={}){return function createConsola$1(t={}){return new Consola(t)}({reporters:t.reporters||[new BrowserReporter({})],prompt:(t,e={})=>"confirm"===e.type?Promise.resolve(confirm(t)):Promise.resolve(prompt(t)),...t})}().withTag("webPaint");lt.withTag("workerManager");const ht=lt.withTag("display"),pt=lt.withTag("worker");pt.withTag("main"),pt.withTag("display");async function initMessage(t,e){const{debug:r,canvas:n,port:o,options:i}=e.payload;return t.debug=r,t.options=i,t.canvas=n,t.ctx=t.canvas.getContext("2d",{willReadFrequently:!0}),t.ctx.imageSmoothingEnabled=!1,t.mainWorkerPort=o,t.mainWorkerPort?t.mainWorkerPort.onmessage=function onMessage(t){return e=>{actions(t,e.data.data)}}(t):function throwError(t){throw t instanceof Error&&(t=t.message||t.toString()),new Error(`[RenderWorker]: ${t}`)}("mainWorkerPort not received in init message!"),{type:et.INIT_SUCCESS}}async function zoomFit(t,e){return function fitToDisplay(t,e,r=1){r<=0&&(r=1);const n=t.getDimensionOffscreenCanvas(),o=.1;let i=Math.min(n.x/e.x,n.y/e.y);i-=Math.min(n.x/e.x,n.y/e.y)*o,i*=r,1!==i&&(t.setZoom(ipoint(0,0),i,!0),t.updateCanvas(),t.action({id:crypto.randomUUID(),data:{type:et.SET_ZOOM_SUCCESS,payload:{position:t.options.position,currentZoomLevel:t.currentZoomLevel}}}))}(t,t.getDimensionImageData(),e.payload.value),t.updateCanvas(),{type:et.ZOOM_FIT_SUCCESS}}async function actions(t,e){const{type:r}=e,n=ht.withTag("Incoming").withTag("action");switch(t.debug&&n.withTag(r).start(e),r){case et.INIT:return initMessage(t,e);case et.UPDATE_BUFFER:return async function updateCanvasMessage(t,e){const{sharedBuffer:r}=e.payload;return t.setSharedBuffer(r),t.updateCanvas(),{type:et.UPDATE_BUFFER_SUCCESS}}(t,e);case et.UPDATE_CANVAS:return async function updateCanvas(t,e){return t.updateCanvas(),{type:e.type}}(t,e);case et.REFRESH:return async function replaceCanvas(t,e){const{dimension:r}=e.payload;return t.canvas&&(t.canvas.width=r.x,t.canvas.height=r.y,t.ctx.imageSmoothingEnabled=!1,t.draw()),{type:et.REFRESH_SUCCESS}}(t,e);case et.SET_OPTIONS:return async function setOptions(t,e){const{options:r}=e.payload;return t.options=r,t.updateCanvas(),{type:et.SET_OPTIONS_SUCCESS}}(t,e);case et.SET_ZOOM:return async function setZoom$1(t,e){return t.setZoom(e.payload.position,e.payload.zoomLevel),t.updateCanvas(),{type:et.SET_ZOOM_SUCCESS,payload:{position:t.options.position,currentZoomLevel:t.currentZoomLevel}}}(t,e);case et.ZOOM_FIT:return zoomFit(t,e);case et.SET_POSITION:return function setPosition$1(t,e){return t.setPosition(e.payload.position),t.updateCanvas(),{type:et.SET_POSITION_SUCCESS,payload:{}}}(t,e);case et.DEBUG:return function debug(t,e){return t.canvas&&(t.canvas.height=405),t.draw(),console.log("DEBUG"),Promise.resolve({type:e.type})}(t,e);default:t.debug&&n.warn("Unknown message type from Creator Thread:",r)}}const ft={[rt.TOP_LEFT]:ipoint(-.5,-.5),[rt.TOP_CENTER]:ipoint(0,-.5),[rt.TOP_RIGHT]:ipoint(.5,-.5),[rt.CENTER_LEFT]:ipoint(-.5,0),[rt.CENTER]:ipoint(0,0),[rt.CENTER_RIGHT]:ipoint(.5,0),[rt.BOTTOM_LEFT]:ipoint(-.5,.5),[rt.BOTTOM_CENTER]:ipoint(0,.5),[rt.BOTTOM_RIGHT]:ipoint(.5,.5)};function render(t,e=t.lastImageData){if(!(t.canvas&&t.ctx&&e))throw new Error("Display render failed: Offscreen canvas or context is not available.");{t.lastImageData=e;const r=function getCanvasFromImageData(t){const e=new OffscreenCanvas(t.width,t.height),r=e.getContext("2d",{willReadFrequently:!0});return r&&(r.imageSmoothingEnabled=!1,r.putImageData(t,0,0)),e}(e);t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height);const n=t.getDimensionOffscreenCanvas(),o=t.getDimensionImageData(),i=t.getDimensionImageData(!0),s=ipoint(()=>((n-i)/2+(n-i)*ft[t.options.origin])/i);let a=ipoint(()=>o*s*-1);const c=ipoint(()=>n/i*o),u=ipoint(()=>t.options.position*o);a=ipoint(()=>u+a);const l={position:a,dimension:c},h={position:ipoint(0,0),dimension:n};t.ctx.drawImage(r,l.position.x,l.position.y,l.dimension.x,l.dimension.y,h.position.x,h.position.y,h.dimension.x,h.dimension.y),function drawGrid(t,e,r,n=new Color(0,0,0,51),o=1,i=10){const s=t.options.zoomLevel,a=t.getDimensionImageData(!0),c=ipoint(()=>a/s),u=ipoint(()=>a/c),l=ipoint(()=>r.position*s*-1);if(e.lineWidth=o,e.strokeRect(l.x,l.y,a.x,a.y),u.x<i)return;const h=new Path2D;for(let p=0;p<=c.x;p++)h.moveTo(l.x+u.x*p,l.y),h.lineTo(l.x+u.x*p,l.y+a.y);for(let p=0;p<=c.y;p++)h.moveTo(l.x,l.y+u.y*p),h.lineTo(l.x+a.x,l.y+u.y*p);e.strokeStyle=`rgba(${n.toCSSRGBA()})`,e.stroke(h),e.globalCompositeOperation="source-over"}(t,t.ctx,l,t.options.grid.color,t.options.grid.lineWidth,t.options.grid.visibleCount)}}const dt={debug:!1,options:new DisplayOptions,currentZoomLevel:1,lastImageData:void 0,canvas:void 0,ctx:void 0,view:void 0,sharedBuffer:void 0,mainWorkerPort:void 0,setOptions:t=>dt.options=t,setSharedBuffer:t=>{dt.sharedBuffer=t,dt.view=new Uint8ClampedArray(t.buffer)},setZoom:function setZoom(t,e,r=!1){let n;const o=dt.options.zoomLevel;n=r?e:0===e?1:o*e;if(dt.currentZoomLevel=n,dt.canvas&&dt.lastImageData){const e=dt.getDimensionOffscreenCanvas(),r=dt.getDimensionImageData(),i=ipoint(()=>t/o*e/r/2);dt.options.zoomLevel=n,dt.options.position=ipoint(()=>dt.precisionNumber(dt.options.position+i))}},setPosition:function setPosition(t){dt.options.position=ipoint(()=>dt.precisionNumber(t))},getDimensionImageData:t=>{var e,r;const n=t?dt.options.zoomLevel:1;return ipoint(((null==(e=dt.lastImageData)?void 0:e.width)||0)*n,((null==(r=dt.lastImageData)?void 0:r.height)||0)*n)},getDimensionOffscreenCanvas:()=>{var t,e;return ipoint((null==(t=dt.canvas)?void 0:t.width)||0,(null==(e=dt.canvas)?void 0:e.height)||0)},precisionNumber:t=>function precisionNumber(t,e=2){const r=Math.pow(10,e);return Math.round(t*r)/r}(t,dt.options.precision),updateCanvas(){if(!dt.view)throw new Error("View is not set.");const t=new Uint8ClampedArray(dt.view.length);t.set(dt.view);const e=new ImageData(t,dt.sharedBuffer.dimension.x,dt.sharedBuffer.dimension.y);render(dt,e)},action:(t,e)=>async function action(t,e,r){const n=await function lastValueFrom(t,e){return new Promise(function(e,r){var n,o=!1;t.subscribe({next:function(t){n=t,o=!0},error:r,complete:function(){o?e(n):r(new h)}})})}(of(e).pipe(function serializeWorkerPostMessage(){return t=>t.pipe(serialize(nt))}()));t.postMessage(n,r||[])}(self,t,e),draw:(t=dt.lastImageData)=>render(dt,t)};(function fromEvent(t,e,r,n){if(isFunction(r)&&(n=r,r=void 0),n)return fromEvent(t,e,r).pipe(mapOneOrManyArgs(n));var o=__read(function isEventTarget(t){return isFunction(t.addEventListener)&&isFunction(t.removeEventListener)}(t)?d.map(function(n){return function(o){return t[n](e,o,r)}}):function isNodeStyleEventEmitter(t){return isFunction(t.addListener)&&isFunction(t.removeListener)}(t)?f.map(toCommonHandlerRegistry(t,e)):function isJQueryStyleEventEmitter(t){return isFunction(t.on)&&isFunction(t.off)}(t)?y.map(toCommonHandlerRegistry(t,e)):[],2),i=o[0],s=o[1];if(!i&&isArrayLike(t))return mergeMap(function(t){return fromEvent(t,e,r)})(innerFrom(t));if(!i)throw new TypeError("Invalid event target");return new c(function(t){var handler=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.next(1<e.length?e:e[0])};return i(handler),function(){return s(handler)}})})(self,"message").pipe(map(t=>t.data),function deserializeWorkerPostMessage(){return t=>t.pipe(deserialize(ot))}()).subscribe(async({id:t,data:e})=>{try{const r=await actions(dt,e);r&&dt.action({id:t,data:r})}catch(r){lt.error("Error processing action:",r)}})}();
