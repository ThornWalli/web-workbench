var __defProp=Object.defineProperty,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__publicField=(e,t,r)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,r);!function(){"use strict";var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function __(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}function __awaiter(e,t,r,o){return new(r||(r=Promise))(function(n,i){function fulfilled(e){try{step(o.next(e))}catch(t){i(t)}}function rejected(e){try{step(o.throw(e))}catch(t){i(t)}}function step(e){e.done?n(e.value):function adopt(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())})}function __generator(e,t){var r,o,n,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=verb(0),s.throw=verb(1),s.return=verb(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function verb(a){return function(c){return function step(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(r=1,o&&(n=2&a[0]?o.return:a[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,a[1])).done)return n;switch(o=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,o=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(n=i.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){i.label=a[1];break}if(6===a[0]&&i.label<n[1]){i.label=n[1],n=a;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(a);break}n[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(c){a=[6,c],o=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],o=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s}function __spreadArray(e,t,r){if(r||2===arguments.length)for(var o,n=0,i=t.length;n<i;n++)!o&&n in t||(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function __await(e){return this instanceof __await?(this.v=e,this):new __await(e)}function __asyncGenerator(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,n=r.apply(e,t||[]),i=[];return o=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),verb("next"),verb("throw"),verb("return",function awaitReturn(e){return function(t){return Promise.resolve(t).then(e,reject)}}),o[Symbol.asyncIterator]=function(){return this},o;function verb(e,t){n[e]&&(o[e]=function(t){return new Promise(function(r,o){i.push([e,t,r,o])>1||resume(e,t)})},t&&(o[e]=t(o[e])))}function resume(e,t){try{!function step(e){e.value instanceof __await?Promise.resolve(e.value.v).then(fulfill,reject):settle(i[0][2],e)}(n[e](t))}catch(r){settle(i[0][3],r)}}function fulfill(e){resume("next",e)}function reject(e){resume("throw",e)}function settle(e,t){e(t),i.shift(),i.length&&resume(i[0][0],i[0][1])}}function __asyncValues(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=__values(e),t={},verb("next"),verb("throw"),verb("return"),t[Symbol.asyncIterator]=function(){return this},t);function verb(r){t[r]=e[r]&&function(t){return new Promise(function(o,n){(function settle(e,t,r,o){Promise.resolve(o).then(function(t){e({value:t,done:r})},t)})(o,n,(t=e[r](t)).done,t.value)})}}}function isFunction(e){return"function"==typeof e}function createErrorClass(e){var t=e(function(e){Error.call(e),e.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}"function"==typeof SuppressedError&&SuppressedError;var e=createErrorClass(function(e){return function UnsubscriptionErrorImpl(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}});function arrRemove(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var t=function(){function Subscription2(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return Subscription2.prototype.unsubscribe=function(){var t,r,o,n,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=__values(s),c=a.next();!c.done;c=a.next()){c.value.remove(this)}}catch(p){t={error:p}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}else s.remove(this);var l=this.initialTeardown;if(isFunction(l))try{l()}catch(f){i=f instanceof e?f.errors:[f]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var _=__values(u),d=_.next();!d.done;d=_.next()){var h=d.value;try{execFinalizer(h)}catch(g){i=null!=i?i:[],g instanceof e?i=__spreadArray(__spreadArray([],__read(i)),__read(g.errors)):i.push(g)}}}catch(m){o={error:m}}finally{try{d&&!d.done&&(n=_.return)&&n.call(_)}finally{if(o)throw o.error}}}if(i)throw new e(i)}},Subscription2.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)execFinalizer(e);else{if(e instanceof Subscription2){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}},Subscription2.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},Subscription2.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},Subscription2.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&arrRemove(t,e)},Subscription2.prototype.remove=function(e){var t=this._finalizers;t&&arrRemove(t,e),e instanceof Subscription2&&e._removeParent(this)},Subscription2.EMPTY=((t=new Subscription2).closed=!0,t),Subscription2}();function isSubscription(e){return e instanceof t||e&&"closed"in e&&isFunction(e.remove)&&isFunction(e.add)&&isFunction(e.unsubscribe)}function execFinalizer(e){isFunction(e)?e():e.unsubscribe()}t.EMPTY;var r=void 0,timeoutProvider_setTimeout=function(e,t){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];return setTimeout.apply(void 0,__spreadArray([e,t],__read(r)))};function reportUnhandledError(e){timeoutProvider_setTimeout(function(){throw e})}function noop(){}var o=function(e){function Subscriber2(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,isSubscription(t)&&t.add(r)):r.destination=s,r}return __extends(Subscriber2,e),Subscriber2.create=function(e,t,r){return new i(e,t,r)},Subscriber2.prototype.next=function(e){this.isStopped||this._next(e)},Subscriber2.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},Subscriber2.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},Subscriber2.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},Subscriber2.prototype._next=function(e){this.destination.next(e)},Subscriber2.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},Subscriber2.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},Subscriber2}(t),n=function(){function ConsumerObserver2(e){this.partialObserver=e}return ConsumerObserver2.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){handleUnhandledError(r)}},ConsumerObserver2.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){handleUnhandledError(r)}else handleUnhandledError(e)},ConsumerObserver2.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){handleUnhandledError(t)}},ConsumerObserver2}(),i=function(e){function SafeSubscriber2(t,r,o){var i,s=e.call(this)||this;return i=isFunction(t)||!t?{next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=o?o:void 0}:t,s.destination=new n(i),s}return __extends(SafeSubscriber2,e),SafeSubscriber2}(o);function handleUnhandledError(e){reportUnhandledError(e)}var s={closed:!0,next:noop,error:function defaultErrorHandler(e){throw e},complete:noop},a="function"==typeof Symbol&&Symbol.observable||"@@observable";function identity(e){return e}var c=function(){function Observable2(e){e&&(this._subscribe=e)}return Observable2.prototype.lift=function(e){var t=new Observable2;return t.source=this,t.operator=e,t},Observable2.prototype.subscribe=function(e,t,r){var n=this,s=function isSubscriber(e){return e&&e instanceof o||function isObserver(e){return e&&isFunction(e.next)&&isFunction(e.error)&&isFunction(e.complete)}(e)&&isSubscription(e)}(e)?e:new i(e,t,r);return function errorContext(e){e()}(function(){var e=n,t=e.operator,r=e.source;s.add(t?t.call(s,r):r?n._subscribe(s):n._trySubscribe(s))}),s},Observable2.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},Observable2.prototype.forEach=function(e,t){var r=this;return new(t=getPromiseCtor(t))(function(t,o){var n=new i({next:function(t){try{e(t)}catch(r){o(r),n.unsubscribe()}},error:o,complete:t});r.subscribe(n)})},Observable2.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},Observable2.prototype[a]=function(){return this},Observable2.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function pipeFromArray(e){return 0===e.length?identity:1===e.length?e[0]:function piped(t){return e.reduce(function(e,t){return t(e)},t)}}(e)(this)},Observable2.prototype.toPromise=function(e){var t=this;return new(e=getPromiseCtor(e))(function(e,r){var o;t.subscribe(function(e){return o=e},function(e){return r(e)},function(){return e(o)})})},Observable2.create=function(e){return new Observable2(e)},Observable2}();function getPromiseCtor(e){var t;return null!==(t=null!=e?e:r)&&void 0!==t?t:Promise}function operate(e){return function(t){if(function hasLift(e){return isFunction(null==e?void 0:e.lift)}(t))return t.lift(function(t){try{return e(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function createOperatorSubscriber(e,t,r,o,n){return new l(e,t,r,o,n)}var l=function(e){function OperatorSubscriber2(t,r,o,n,i,s){var a=e.call(this,t)||this;return a.onFinalize=i,a.shouldUnsubscribe=s,a._next=r?function(e){try{r(e)}catch(o){t.error(o)}}:e.prototype._next,a._error=n?function(e){try{n(e)}catch(r){t.error(r)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=o?function(){try{o()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return __extends(OperatorSubscriber2,e),OperatorSubscriber2.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},OperatorSubscriber2}(o);function popScheduler(e){return function isScheduler(e){return e&&isFunction(e.schedule)}(function last(e){return e[e.length-1]}(e))?e.pop():void 0}var isArrayLike=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function isPromise(e){return isFunction(null==e?void 0:e.then)}function isInteropObservable(e){return isFunction(e[a])}function isAsyncIterable(e){return Symbol.asyncIterator&&isFunction(null==e?void 0:e[Symbol.asyncIterator])}function createInvalidObservableTypeError(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var u=function getSymbolIterator(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function isIterable(e){return isFunction(null==e?void 0:e[u])}function readableStreamLikeToAsyncGenerator(e){return __asyncGenerator(this,arguments,function readableStreamLikeToAsyncGenerator_1(){var t,r,o;return __generator(this,function(n){switch(n.label){case 0:t=e.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,__await(t.read())];case 3:return r=n.sent(),o=r.value,r.done?[4,__await(void 0)]:[3,5];case 4:return[2,n.sent()];case 5:return[4,__await(o)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function isReadableStreamLike(e){return isFunction(null==e?void 0:e.getReader)}function innerFrom(e){if(e instanceof c)return e;if(null!=e){if(isInteropObservable(e))return function fromInteropObservable(e){return new c(function(t){var r=e[a]();if(isFunction(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(isArrayLike(e))return function fromArrayLike(e){return new c(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}(e);if(isPromise(e))return function fromPromise(e){return new c(function(t){e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,reportUnhandledError)})}(e);if(isAsyncIterable(e))return fromAsyncIterable(e);if(isIterable(e))return function fromIterable(e){return new c(function(t){var r,o;try{for(var n=__values(e),i=n.next();!i.done;i=n.next()){var s=i.value;if(t.next(s),t.closed)return}}catch(a){r={error:a}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}t.complete()})}(e);if(isReadableStreamLike(e))return function fromReadableStreamLike(e){return fromAsyncIterable(readableStreamLikeToAsyncGenerator(e))}(e)}throw createInvalidObservableTypeError(e)}function fromAsyncIterable(e){return new c(function(t){(function process(e,t){var r,o,n,i;return __awaiter(this,void 0,void 0,function(){var s,a;return __generator(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=__asyncValues(e),c.label=1;case 1:return[4,r.next()];case 2:if((o=c.sent()).done)return[3,4];if(s=o.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),n={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),o&&!o.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})})(e,t).catch(function(e){return t.error(e)})})}function executeSchedule(e,t,r,o,n){void 0===o&&(o=0),void 0===n&&(n=!1);var i=t.schedule(function(){r(),n?e.add(this.schedule(null,o)):this.unsubscribe()},o);if(e.add(i),!n)return i}function observeOn(e,t){return void 0===t&&(t=0),operate(function(r,o){r.subscribe(createOperatorSubscriber(o,function(r){return executeSchedule(o,e,function(){return o.next(r)},t)},function(){return executeSchedule(o,e,function(){return o.complete()},t)},function(r){return executeSchedule(o,e,function(){return o.error(r)},t)}))})}function subscribeOn(e,t){return void 0===t&&(t=0),operate(function(r,o){o.add(e.schedule(function(){return r.subscribe(o)},t))})}function scheduleAsyncIterable(e,t){if(!e)throw new Error("Iterable cannot be null");return new c(function(r){executeSchedule(r,t,function(){var o=e[Symbol.asyncIterator]();executeSchedule(r,t,function(){o.next().then(function(e){e.done?r.complete():r.next(e.value)})},0,!0)})})}function scheduled(e,t){if(null!=e){if(isInteropObservable(e))return function scheduleObservable(e,t){return innerFrom(e).pipe(subscribeOn(t),observeOn(t))}(e,t);if(isArrayLike(e))return function scheduleArray(e,t){return new c(function(r){var o=0;return t.schedule(function(){o===e.length?r.complete():(r.next(e[o++]),r.closed||this.schedule())})})}(e,t);if(isPromise(e))return function schedulePromise(e,t){return innerFrom(e).pipe(subscribeOn(t),observeOn(t))}(e,t);if(isAsyncIterable(e))return scheduleAsyncIterable(e,t);if(isIterable(e))return function scheduleIterable(e,t){return new c(function(r){var o;return executeSchedule(r,t,function(){o=e[u](),executeSchedule(r,t,function(){var e,t,n;try{t=(e=o.next()).value,n=e.done}catch(i){return void r.error(i)}n?r.complete():r.next(t)},0,!0)}),function(){return isFunction(null==o?void 0:o.return)&&o.return()}})}(e,t);if(isReadableStreamLike(e))return function scheduleReadableStreamLike(e,t){return scheduleAsyncIterable(readableStreamLikeToAsyncGenerator(e),t)}(e,t)}throw createInvalidObservableTypeError(e)}function from$1(e,t){return t?scheduled(e,t):innerFrom(e)}function of(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return from$1(e,popScheduler(e))}var _=createErrorClass(function(e){return function EmptyErrorImpl(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function map(e,t){return operate(function(r,o){var n=0;r.subscribe(createOperatorSubscriber(o,function(r){o.next(e.call(t,r,n++))}))})}var d=Array.isArray;function mapOneOrManyArgs(e){return map(function(t){return function callOrApply(e,t){return d(t)?e.apply(void 0,__spreadArray([],__read(t))):e(t)}(e,t)})}function mergeMap(e,t,r){return void 0===r&&(r=1/0),isFunction(t)?mergeMap(function(r,o){return map(function(e,n){return t(r,e,o,n)})(innerFrom(e(r,o)))},r):("number"==typeof t&&(r=t),operate(function(t,o){return function mergeInternals(e,t,r,o,n,i,s,a){var c=[],l=0,u=0,_=!1,checkComplete=function(){!_||c.length||l||t.complete()},doInnerSub=function(e){l++;var n=!1;innerFrom(r(e,u++)).subscribe(createOperatorSubscriber(t,function(e){t.next(e)},function(){n=!0},void 0,function(){if(n)try{l--;for(var _loop_1=function(){var e=c.shift();s||doInnerSub(e)};c.length&&l<o;)_loop_1();checkComplete()}catch(e){t.error(e)}}))};return e.subscribe(createOperatorSubscriber(t,function(e){return l<o?doInnerSub(e):c.push(e)},function(){_=!0,checkComplete()})),function(){}}(t,o,e,r)}))}function concatAll(){return function mergeAll(e){return mergeMap(identity,e)}(1)}var h=["addListener","removeListener"],p=["addEventListener","removeEventListener"],f=["on","off"];function toCommonHandlerRegistry(e,t){return function(r){return function(o){return e[r](t,o)}}}function reduce(e,t){return operate(function scanInternals(e,t,r,o,n){return function(o,n){var i=r,s=t,a=0;o.subscribe(createOperatorSubscriber(n,function(t){var r=a++;s=i?e(s,t,r):(i=!0,t)},function(){i&&n.next(s),n.complete()}))}}(e,t,arguments.length>=2))}var arrReducer=function(e,t){return e.push(t),e};function concatMap(e,t){return isFunction(t)?mergeMap(e,t,1):mergeMap(e,1)}function isArray(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function multQuatVec(e,t){const{x:r,y:o,z:n}=t,{x:i,y:s,z:a,w:c}=e,l=c*r+s*n-a*o,u=c*o+a*r-i*n,_=c*n+i*o-s*r,d=-i*r-s*o-a*n,h=l*c+d*-i+u*-a-_*-s,p=u*c+d*-s+_*-i-l*-a,f=_*c+d*-a+l*-s-u*-i;return new t.constructor(h,p,f)}const g=Math.PI,m=2*Math.PI;function normRad(e){let t=e%m;return t<-g?t+=m:t>g&&(t-=m),t}function isNumber(e){return"number"==typeof e||(null==e?void 0:e.constructor)===Number}const b=0,w=1,y=2,S=3,v=9999999999999,O=void 0,C=Symbol("vector length"),A=Symbol("get source"),E=Symbol("checked");let T,x,P=O;const k=[0,1,2,6,24,120,720,5760,51840,518400,5702400,68428800,889574400,12454041600,186810624e3],D=[];let L=-1,F=!1;const R=[];function handleProgess(e,t,r){P=e,L=-1,x=1;const o=t(r);if(!isNumber(o))throw new Error("\n      your assigned progress did not not return a primitive!\n      calc() does not support logical operators (|| && ==) directly\n\n      instead of calc(() => v1 || v2);\n      use        calc(() => +v1 || +v2);\n\n      instead of calc(() => v1);\n      use        calc(v1);\n      ");return o}function getVectorLength(e){const t=e[A];return t?t(e).length:e[C]||3}function setVectorValue(e,t,r){const o=e[A];o?o(e)[t]=r:t!==b?t!==w?(t===y&&(e.z=r),t===S&&(e.w=r)):e.y=r:e.x=r}function operatorCalc(e,t=void 0){if("function"!=typeof e)throw new Error("no function assigned");if(P!==O)throw new Error("something wrong, do you use calc() inside calc?");try{const r=void 0===t,o="function"==typeof t,n=o||r?void 0:t,i=handleProgess(b,e,n);if(r&&void 0===T)return i;const s=T?getVectorLength(T):0;if(s===v){if(!e[E]){const t=handleProgess(v,e),r=k[x];if(Math.abs(t-r)>Number.EPSILON)throw new Error("\n            algebraic multiplication works only in calls with *\n\n            calc(() => v * m);\n            calc(() => m * v);\n            calc(() => m * m);\n            calc(() => m * m * v);\n\n            ");e[E]=!0}let t=D[0];for(let e=1;e<x-1;e+=1){const r=D[e];if(!t.multiply)throw new Error(`cannot find method multiply() on ${t}`);t=t.multiply(r)}return t}let a=o?t.length:s;if(a||(a=s),a<s)throw new Error("Your assigned result Vector cant use higher space Operands than it has");const c=new Array(a);c[0]=i,n&&setVectorValue(n,P,c[0]);for(let t=1;t<a;t+=1){const r=handleProgess(t,e,n);c[t]=r,n&&setVectorValue(n,P,r)}return r?new T.constructor(...c):o?t(...c):n}finally{P=O,T=void 0}}function cachedValueOf(e,t){const r=e.prototype;r[A]=t;const o=r[Symbol.toPrimitive]||function(e){return"string"===e?this.toString():this.valueOf()};r[Symbol.toPrimitive]=function(e){return P===b&&(T=T?function maxVector(e,t){return getVectorLength(e)>getVectorLength(t)?e:t}(T,this):this,D[x-1]=this),P===O?o.call(this,e):function getVectorValue(e,t){if(x+=1,t===v)return x;if(t>=getVectorLength(e))return 0;const r=e[A];return r?1*r(e)[t]:t===b?1*e.x:t===w?1*e.y:t===y?1*e.z:t===S?1*e.w:void 0}(this,P)}}function bindCache(e){return function(...t){if(P===b){if(F)return e.apply(this,t);try{F=!0,L+=1;const r=e.apply(this,t);return R[L]=r,r}finally{F=!1}}return P===w||P===y||P===S?(L+=1,R[L]):e.apply(this,t)}}function cachedMethod(e,t){const r=e.prototype,o=r[t];r[t]=bindCache(o)}function cachedGetter(e,t){const r=e.prototype,o=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(r,t,{get:bindCache(function(){return o.get.call(this)})})}function defineVectorLength(e,t){const r=e.prototype;Object.defineProperty(r,C,{value:t})}function defineMatrixLength(e){defineVectorLength(e,v)}function cachedFunction(e){return bindCache(e)}function convertToCSSVars(e,t,r={}){const o=function getVarPrefix(e){let t="";return e&&(t=`${e}-`),t}(e);return Object.entries(t).forEach(([e,t])=>{r[`--${o}${e}`]=t}),r}"undefined"!=typeof DOMPoint&&(e=>{try{cachedValueOf(e),defineVectorLength(e,4)}catch(t){console.error("error while hijackDOMPoint"),console.error(t)}})(DOMPoint);const M=Symbol("axes");function square$1(e){return e*e}class APoint{constructor(...e){"function"==typeof e[0]?operatorCalc(e[0],(e,t)=>{this[M]=[e,t]}):isArray(e[0])?this[M]=[...e[0]]:e[0]&&isNumber(e[0].x)?this[M]=[e[0].x||0,e[0].y||0]:this[M]=[e[0]||0,e[1]||0]}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}normalize(){const{length:e}=this;return new this.constructor(this.x/e,this.y/e)}norm(){return this.normalize()}dot(e){return this.x*e.x+this.y*e.y}getRad(){return normRad(Math.atan2(this.y,this.x))}angleTo(e){return function angleOverGround(e,t,r,o){return normRad(Math.atan2(e,t)-Math.atan2(r,o))}(this.y,this.x,e.y,e.x)}rotate(e){const t=Math.sin(e),r=Math.cos(e),o=this.x*r-this.y*t,n=this.x*t+this.y*r;return new this.constructor(o,n)}distance(e){return Math.sqrt(square$1(this.x-e.x)+square$1(this.y-e.y))}dist(e){return this.distance(e)}toArray(){return[this.x,this.y]}calc(e){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(e){return this.x===e.x&&this.y===e.y}toJSON(){return{x:this.x,y:this.y}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(e,t={}){return convertToCSSVars(e,this.toJSON(),t)}get lengthSq(){return this.dot(this)}get length(){return Math.sqrt(this.lengthSq)}get lensq(){return this.lengthSq}get len(){return this.length}get x(){return this[M][0]}set x(e){throw new Error("set x() not implemented")}get y(){return this[M][1]}set y(e){throw new Error("set y() not implemented")}get z(){throw new Error("get z() not implemented")}set z(e){throw new Error("set z() not implemented")}[Symbol.iterator](){return this[M].values()}}cachedValueOf(APoint),defineVectorLength(APoint,2),cachedMethod(APoint,"dot"),cachedMethod(APoint,"angleTo"),cachedMethod(APoint,"distance"),cachedMethod(APoint,"toArray"),cachedMethod(APoint,"getRad"),cachedGetter(APoint,"length"),cachedGetter(APoint,"lengthSq");let z=class Point2 extends APoint{set x(e){this[M][0]=e}set y(e){this[M][1]=e}get x(){return this[M][0]}get y(){return this[M][1]}calc(e){return operatorCalc(e,this)}clone(){return new Point2(this.x,this.y)}};class IPoint extends APoint{toPoint(){return new z(this.x,this.y)}}const I=cachedFunction((e,t)=>new z(e,t)),point=(e,t)=>I(e,t),B=cachedFunction((e,t)=>new IPoint(e,t)),ipoint=(e,t)=>B(e,t);ipoint(0,0),ipoint(0,-1),ipoint(-1,0);const N=Symbol("axes");function square(e){return e*e}class AVector{constructor(...e){"function"==typeof e[0]?operatorCalc(e[0],(e,t,r)=>{this[N]=[e,t,r]}):isArray(e[0])?this[N]=[...e[0]]:e[0]&&isNumber(e[0].x)?this[N]=[e[0].x||0,e[0].y||0,e[0].z||0]:this[N]=[e[0]||0,e[1]||0,e[2]||0]}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}normalize(){const{length:e}=this;return new this.constructor(this.x/e,this.y/e,this.z/e)}norm(){return this.normalize()}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}cross(e){return new this.constructor(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}crossNormalize(e){const t=this.cross(e),{length:r}=t;return t[N][0]/=r,t[N][1]/=r,t[N][2]/=r,t}cn(e){return this.crossNormalize(e)}toAngles(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length)}}angleTo(e){return normRad(function acos(e){return e>-1?e<1?Math.acos(e):0:g}(this.dot(e)/(this.length*e.length)))}multiply(e){return void 0===e.x?this.multiplyMat3(e):void 0===e.w?this.multiplyVec3(e):multQuatVec(e,this)}multiplyMat3(e){return function multiplyVecMat3(e,[t,r,o]){return new e.constructor(e.dot(t),e.dot(r),e.dot(o))}(this,e)}multiplyVec3({x:e,y:t,z:r}){return new this.constructor(this.x*e,this.y*t,this.z*r)}distance(e){return Math.sqrt(square(this.x-e.x)+square(this.y-e.y)+square(this.z-e.z))}dist(e){return this.distance(e)}toArray(){return[this.x,this.y,this.z]}swizzle(e){const t=e.split("").map(e=>this[e]);return 2===t.length?new IPoint(t[0],t[1]):new this.constructor(t[0],t[1],t[2])}calc(e){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}toJSON(){return{x:this.x,y:this.y,z:this.z}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(e,t={}){return convertToCSSVars(e,this.toJSON(),t)}get lengthSq(){return this.dot(this)}set lengthSq(e){throw new Error("set lengthSq() not implemented")}get length(){return Math.sqrt(this.lengthSq)}set length(e){throw new Error("set length() not implemented")}get lensq(){return this.lengthSq}set lensq(e){throw new Error("set lensq() not implemented")}get len(){return this.length}set len(e){throw new Error("set len() not implemented")}get x(){return this[N][0]}set x(e){throw new Error("set x() not implemented")}get y(){return this[N][1]}set y(e){throw new Error("set y() not implemented")}get z(){return this[N][2]}set z(e){throw new Error("set z() not implemented")}get xy(){return new IPoint(this[N][0],this[N][1])}set xy(e){throw new Error("set xz() not implemented")}get xz(){return new IPoint(this[N][0],this[N][2])}set xz(e){throw new Error("set xz() not implemented")}get yz(){return new IPoint(this[N][1],this[N][2])}set yz(e){throw new Error("set yz() not implemented")}[Symbol.iterator](){return this[N].values()}}cachedValueOf(AVector),defineVectorLength(AVector,3),cachedMethod(AVector,"dot"),cachedMethod(AVector,"cross"),cachedMethod(AVector,"crossNormalize"),cachedMethod(AVector,"toAngles"),cachedMethod(AVector,"angleTo"),cachedMethod(AVector,"rotate"),cachedMethod(AVector,"distance"),cachedMethod(AVector,"toArray"),cachedGetter(AVector,"length"),cachedGetter(AVector,"lengthSq");class Vector extends AVector{set x(e){this[N][0]=e}set y(e){this[N][1]=e}set z(e){this[N][2]=e}get x(){return this[N][0]}get y(){return this[N][1]}get z(){return this[N][2]}calc(e){return operatorCalc(e,this)}clone(){return new Vector(this.x,this.y,this.z)}}class Victor extends AVector{toVector(){return new Vector(this.x,this.y,this.z)}clone(){return this}}const U=cachedFunction((e,t,r)=>new Victor(e,t,r)),victor=(e,t,r)=>U(e,t,r);victor(0,0,0);const G=victor(0,0,-1);victor(0,0,1);const V=victor(-1,0,0);victor(1,0,0);const W=victor(0,1,0);victor(0,-1,0),victor(1,1,1);const j=Symbol("angle rad"),H=Math.PI/180;class ADegree{constructor(e){this[j]=e instanceof ADegree?e[j]:normRad(e*H)}valueOf(){return this[j]}toJSON(){return{angle:this[j]}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(e,t={}){return convertToCSSVars(e,this.toJSON(),t)}}class Degree extends ADegree{set(e){this[j]=e instanceof ADegree?e[j]:normRad((e||0)*H)}}new class IDegree extends ADegree{toDegree(){return new Degree(this[j])}}(0);const $=Symbol("axes"),q=Symbol("forward cache"),J=Symbol("left cache"),Y=Symbol("up cache"),K=Symbol("inverse cache");function normalize(e){const t=function length([e,t,r,o]){return Math.sqrt(e*e+t*t+r*r+o*o)}(e);e[0]/=t,e[1]/=t,e[2]/=t,e[3]/=t}function getQuat(e,t,r,o){return isNumber(e)?[e,t,r,o]:isArray(e)?[...e]:function isAngle(e){return isNumber(e)||e instanceof ADegree}(t)?function axisAngle(e,t){const r=new Array(4),o=.5*t,n=Math.sin(o),i=Math.cos(o);return r[0]=n*e.x,r[1]=n*e.y,r[2]=n*e.z,r[3]=i,r}(e,t):e&&t?function look(e,t){const r=e.normalize(),o=t.crossNormalize(r),n=r.crossNormalize(o),i=o.x,s=o.y,a=o.z,c=n.x,l=n.y,u=n.z,_=r.x,d=r.y,h=r.z,p=i+l+h,f=new Array(4);if(p>0){let e=Math.sqrt(p+1);return f[3]=.5*e,e=.5/e,f[0]=(u-d)*e,f[1]=(_-a)*e,f[2]=(s-c)*e,f}if(i>=l&&i>=h){const e=Math.sqrt(1+i-l-h),t=.5/e;return f[0]=.5*e,f[1]=(s+c)*t,f[2]=(a+_)*t,f[3]=(u-d)*t,f}if(l>h){const e=Math.sqrt(1+l-i-h),t=.5/e;return f[0]=(c+s)*t,f[1]=.5*e,f[2]=(d+u)*t,f[3]=(_-a)*t,f}const g=Math.sqrt(1+h-i-l),m=.5/g;return f[0]=(_+a)*m,f[1]=(d+u)*m,f[2]=.5*g,f[3]=(s-c)*m,f}(e,t):void 0}class AQuaternion{constructor(e,t,r,o){this[$]=function from(e,t,r,o){return e&&isNumber(e.w)?getQuat(e.x,e.y,e.z,e.w):getQuat(e,t,r,o)||[0,0,0,1]}(e,t,r,o),normalize(this[$])}set(e,t,r,o){throw new Error("set x() not implemented")}multiply(e,t,r,o){if(isNumber(e.w))return this.multiplyQuaternion(e);const n=getQuat(e,t,r,o);return n?this.multiplyQuaternion(new this.constructor(n)):this.multiplyVector(e)}multiplyVector(e){return multQuatVec(this,e)}multiplyQuaternion(e){const t=this.x,r=this.y,o=this.z,n=this.w,i=e.x,s=e.y,a=e.z,c=e.w,l=n*i+t*c+r*a-o*s,u=n*s+r*c+o*i-t*a,_=n*a+o*c+t*s-r*i,d=n*c-t*i-r*s-o*a;return new this.constructor(l,u,_,d)}mul(e,t,r,o){return this.multiply(e,t,r,o)}get inverse(){const{x:e,y:t,z:r,w:o}=this;return this.constructor(-1*e,-1*t,-1*r,o)}get inv(){return this.inverse}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}get left(){return this.multiplyVector(V)}get dir(){return this.multiplyVector(G)}get up(){return this.multiplyVector(W)}get 0(){return this.left}get 1(){return this.dir}get 2(){return this.up}get x(){return this[$][0]}set x(e){throw new Error("set x() not implemented")}get y(){return this[$][1]}set y(e){throw new Error("set y() not implemented")}get z(){return this[$][2]}set z(e){throw new Error("set z() not implemented")}get w(){return this[$][3]}set w(e){throw new Error("set w() not implemented")}toJSON(){const{x:e,y:t,z:r,w:o}=this;return{x:e,y:t,z:r,w:o,a1:1-t*t*2-r*r*2,a2:e*t*2-r*o*2,a3:e*r*2+t*o*2,b1:e*t*2+r*o*2,b2:1-e*e*2-r*r*2,b3:t*r*2-e*o*2,c1:e*r*2-t*o*2,c2:t*r*2+e*o*2,c3:1-e*e*2-t*t*2}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(e,t={}){return convertToCSSVars(e,this.toJSON(),t)}}function fromCache(e,t,r){let o=e[t];return o||(o=r(),e[t]=o),o}cachedValueOf(AQuaternion),defineMatrixLength(AQuaternion);class IQuaternion extends AQuaternion{get left(){return fromCache(this,J,()=>this.multiplyVector(V))}get dir(){return fromCache(this,q,()=>this.multiplyVector(G))}get up(){return fromCache(this,Y,()=>this.multiplyVector(W))}get inverse(){return fromCache(this,K,()=>{const{x:e,y:t,z:r,w:o}=this;return this.constructor(-1*e,-1*t,-1*r,o)})}}const Z=cachedFunction((e,t,r,o)=>new IQuaternion(e,t,r,o));new IQuaternion(V,function degree(e){return new Degree(e)}(90)),Z(0,0,0,1);const Q=Symbol("axes");class AColor{constructor(e,t,r,o){"function"==typeof e?operatorCalc(e,(e,t,r,o)=>{this[Q]=[e,t,r,o]}):isArray(e)?this[Q]=[...e]:e&&isNumber(e.x)?this[Q]=[e.x||0,e.y||0,e.z||0,e.w||0]:this[Q]=[e||0,t||0,r||0,o||0]}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}toArray(){return[this.x,this.y,this.z,this.w]}calc(e){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}toJSON(){return{x:this.x,y:this.y,z:this.z,w:this.w}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(e,t={}){return convertToCSSVars(e,this.toJSON(),t)}get x(){return this[Q][0]}set x(e){throw new Error("set x() not implemented")}get y(){return this[Q][1]}set y(e){throw new Error("set y() not implemented")}get z(){return this[Q][2]}set z(e){throw new Error("set z() not implemented")}get w(){return this[Q][3]}set w(e){throw new Error("set w() not implemented")}[Symbol.iterator](){return this[Q].values()}}cachedValueOf(AColor),defineVectorLength(AColor,4),cachedMethod(AColor,"toArray");const X=Symbol("data");class AMat3{constructor(...e){this[X]=e}get 0(){return this[X][0]}set 0(e){throw new Error("set [0] not implemented")}get 1(){return this[X][1]}set 1(e){throw new Error("set [1] not implemented")}get 2(){return this[X][2]}set 2(e){throw new Error("set [2] not implemented")}multiplyMat(e){return function multiplyMat3Mat3(e,[t,r,o]){const[n,i,s]=e;return new e.constructor(new n.constructor(n.x*t.x+i.x*t.y+s.x*t.z,n.y*t.x+i.y*t.y+s.y*t.z,n.z*t.x+i.z*t.y+s.z*t.z),new n.constructor(n.x*r.x+i.x*r.y+s.x*r.z,n.y*r.x+i.y*r.y+s.y*r.z,n.z*r.x+i.z*r.y+s.z*r.z),new n.constructor(n.x*o.x+i.x*o.y+s.x*o.z,n.y*o.x+i.y*o.y+s.y*o.z,n.z*o.x+i.z*o.y+s.z*o.z))}(this,e)}multiplyVec(e){return function multiplyMat3Vec(e,{x:t,y:r,z:o}){const[n,i,s]=e;return new n.constructor(n.x*t+i.x*r+s.x*o,n.y*t+i.y*r+s.y*o,n.z*t+i.z*r+s.z*o)}(this,e)}multiply(e){if(e instanceof AMat3)return this.multiplyMat(e);const{x:t,y:r,z:o}=e;if(void 0===t||void 0===r||void 0===o)throw new Error(`multiply only works with mat3 and vec3, not supported ${e}`);return this.multiplyVec(e)}[Symbol.iterator](){return this[X].values()}}cachedValueOf(AMat3),defineMatrixLength(AMat3);const ee=[{validator:()=>!0,handler:()=>e=>e.pipe(map(e=>e))}];class AsyncTransform{constructor(e,t){__publicField(this,"validator"),__publicField(this,"handler"),this.validator=e,this.handler=t}}const te=[{validator:()=>!0,handler:()=>e=>e.pipe(map(e=>e))}],re={[Object.prototype.constructor.name]:e=>t=>t.pipe(map(Object.entries),traverse(e),map(Object.fromEntries)),[Array.prototype.constructor.name]:e=>t=>t.pipe(concatAll(),traverse(e),function toArray(){return operate(function(e,t){reduce(arrReducer,[])(e).subscribe(t)})}()),[Promise.prototype.constructor.name]:e=>t=>t.pipe(concatMap(e=>from$1(e)),traverse(e)),[c.prototype.constructor.name]:e=>t=>t.pipe(concatMap(e=>e),traverse(e)),[void 0]:()=>e=>e};function serialize(e=[]){return t=>t.pipe(traverse(((e=[])=>[...e,...ee])(e)))}function deserialize(e=[]){return t=>t.pipe(traverse(((e=[])=>[...e,...te])(e)))}function traverse(e){return t=>t.pipe(mergeMap(t=>{const r=function getInstructionKey(e){if(null==e)return;const t=e.constructor;if(t){const e=t.name;if(Object.prototype.hasOwnProperty.call(re,e))return e}return}(t),o=r&&re[r];return o?of(t).pipe(o(e)):of(t)}),function transform(e){return t=>t.pipe(concatMap(t=>of(t).pipe(findTransform(e,t).handler())))}(e))}const findTransform=(e,t)=>{const r=e.find(({validator:e})=>e(t));return r||{validator:()=>!0,handler:e=>e}};let oe=class Color2{constructor(e,t=0,r=0,o=255){if(__publicField(this,"r"),this.g=t,this.b=r,this.a=o,Array.isArray(e))[this.r,this.g,this.b,this.a]=e;else if("string"==typeof e){const t=Color2.fromHex(e);this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}else"object"==typeof e?(this.r=e.r||0,this.g=e.g||0,this.b=e.b||0,this.a=void 0!==e.a?e.a:255):(this.r=e,this.g=t||0,this.b=r||0,this.a=void 0===o?255:o);this.r=Math.min(Math.max(this.r,0),255),this.g=Math.min(Math.max(this.g,0),255),this.b=Math.min(Math.max(this.b,0),255),this.a=Math.min(Math.max(this.a,0),255)}static fromHex(e){4===e.length&&(e=`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`);const t=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),o=parseInt(e.slice(5,7),16),n=parseInt(e.slice(7,9),16);return new Color2(t,r,o,isNaN(n)?255:n)}static fromHsl(e,t,r,o=255){const{r:n,g:i,b:s}=function hslToRgb(e,t,r){let o,n,i;if(0===t)o=n=i=r;else{const hue2rgb=(e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e),s=r<.5?r*(1+t):r+t-r*t,a=2*r-s;o=hue2rgb(a,s,e/360+1/3),n=hue2rgb(a,s,e/360),i=hue2rgb(a,s,e/360-1/3)}return{r:Math.round(255*o),g:Math.round(255*n),b:Math.round(255*i)}}(e,t,r);return new Color2(n,i,s,o)}static isValidHex(e){return/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(e)}toInverted(){return new Color2(255-this.r,255-this.g,255-this.b,this.a)}toJSON(){return{_type:this.constructor.name,r:this.r,g:this.g,b:this.b,a:this.a}}toHex(){return`#${this.toRGBA().map(e=>e.toString(16).padStart(2,"0")).join("")}`}toRGB(){return[this.r,this.g,this.b]}toRGBA(){return[...this.toRGB(),this.a]}toCSSRGB(){return[...this.toRGB()]}toCSSRGBA(){return[...this.toRGB(),this.a/255]}toHsl(){const e=this.r/255,t=this.g/255,r=this.b/255,o=Math.max(e,t,r),n=Math.min(e,t,r);let i=0,s=0;const a=(o+n)/2;if(o===n)i=s=0;else{const c=o-n;switch(s=a>.5?c/(2-o-n):c/(o+n),o){case e:i=(t-r)/c+(t<r?6:0);break;case t:i=(r-e)/c+2;break;case r:i=(e-t)/c+4}i/=6}return[Math.round(360*i),s,a]}toHsla(){const[e,t,r]=this.toHsl();return[e,t,r,this.a]}toHsv(){const e=this.r/255,t=this.g/255,r=this.b/255,o=Math.max(e,t,r),n=Math.min(e,t,r);let i=0,s=0;const a=o,c=o-n;if(0===o)return[0,0,0];if(s=c/o,o===n)i=0;else{switch(o){case e:i=(t-r)/c+(t<r?6:0);break;case t:i=(r-e)/c+2;break;case r:i=(e-t)/c+4}i/=6}return[Math.round(360*i),s,a]}toHsva(){const[e,t,r]=this.toHsv();return[e,t,r,this.a]}getHslaHue(){const[e]=this.toHsl();return e}getHslaSaturation(){const[e]=this.toHsl();return e}getHslaLightness(){const[e]=this.toHsl();return e}setHslaHue(e){const[t,r,o]=this.toHsl();return Color2.fromHsl(t+e,r,o,this.a)}setHslaSaturation(e){const[t,r,o]=this.toHsl();return Color2.fromHsl(t,r+e,o,this.a)}setHslaLightness(e){const[t,r,o]=this.toHsl();return Color2.fromHsl(t,r,o+e,this.a)}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}clone(){return new Color2(this.r,this.g,this.b,this.a)}};var ne=(e=>(e.DEFAULT="default",e.REFRESH="refresh",e.REFRESH_SUCCESS="refreshSuccess",e.DEBUG="debug",e.INIT="init",e.INIT_SUCCESS="initSuccess",e.SYNC_STATE="syncState",e.SYNC_STATE_SUCCESS="syncStateSuccess",e.ADD_RENDER_WORKER_PORT="addRenderWorkerPort",e.ADD_RENDER_WORKER_PORT_SUCCESS="addRenderWorkerPortSuccess",e.LOAD_IMAGE="loadImage",e.LOAD_IMAGE_SUCCESS="loadImageSuccess",e.UPDATE_CANVAS="updateCanvas",e.UPDATE_BUFFER="updateBuffer",e.UPDATE_BUFFER_SUCCESS="updateBufferSuccess",e.STACK="stack",e.STACK_SUCCESS="stackSuccess",e.UNDO_STACK="undoStack",e.UNDO_STACK_SUCCESS="undoStackSuccess",e.REDO_STACK="redoStack",e.REDO_STACK_SUCCESS="redoStackSuccess",e.CLEAR="clear",e.CLEAR_SUCCESS="clearSuccess",e.SET_ZOOM="setZoom",e.SET_ZOOM_SUCCESS="setZoomSuccess",e.ZOOM_FIT="zoomFit",e.ZOOM_FIT_SUCCESS="zoomFitSuccess",e.SET_POSITION="setPosition",e.SET_POSITION_SUCCESS="setPositionSuccess",e.USE_TOOL="useTool",e.USE_TOOL_SUCCESS="useToolSuccess",e.SET_SELECT_OPTIONS="setSelectOptions",e.SET_SELECT_OPTIONS_SUCCESS="setSelectOptionsSuccess",e.GET_DATA="getData",e.GET_DATA_SUCCESS="getDataSuccess",e.RESIZE="resize",e.RESIZE_SUCCESS="resizeSuccess",e.RESIZE_CANVAS="resizeCanvas",e.RESIZE_CANVAS_SUCCESS="resizeCanvasSuccess",e.GET_COLORS="getColors",e.GET_COLORS_SUCCESS="getColorsSuccess",e.IMAGE_OPERATION="imageOperation",e.IMAGE_OPERATION_SUCCESS="imageOperationSuccess",e.COLOR_PICKER="colorPicker",e.COLOR_PICKER_SUCCESS="colorPickerSuccess",e.SET_OPTIONS="setOptions",e.SET_OPTIONS_SUCCESS="setOptionsSuccess",e))(ne||{}),ie=(e=>(e.FILLED="filled",e.STROKED="stroked",e.STROKED_FILLED="stroked_filled",e))(ie||{}),se=(e=>(e.CIRCLE="circle",e.SQUARE="square",e.DOTS="dots",e))(se||{}),ae=(e=>(e.NONE="none",e.DOTTED_FREEHAND="dotted_freehand",e.CONTINUOUS_FREEHAND="continuous_freehand",e.STRAIGHT_LINE="straight_line",e.CURVE_LINE="curve_line",e.FILL_TOOL="fill_tool",e.AIR_BRUSH="airbrush",e.RECTANGLE="rectangle",e.CIRCLE="circle",e.ELLIPSE="ellipse",e.POLYGON="polygon",e.CROP="crop",e.TEXT="text",e.SPLIT_SCREEN="splitScreen",e.MAGNIFY="magnify",e.ZOOM="zoom",e.STACK_REDO="stack_redo",e.STACK_UNDO="stack_undo",e.CLEAR="clear",e.ZOOM_FIT="zoom_fit",e.COLOR_PICKER="color_picker",e.IMAGE_OPERATION="image_operation",e))(ae||{}),ce=(e=>(e[e.CENTER=0]="CENTER",e[e.INSIDE=1]="INSIDE",e[e.OUTSIDE=2]="OUTSIDE",e))(ce||{});ipoint(-1,-1),ipoint(0,-1),ipoint(1,-1),ipoint(-1,0),ipoint(0,0),ipoint(1,0),ipoint(-1,1),ipoint(0,1),ipoint(1,1);class DisplayOptions{constructor(e){__publicField(this,"origin"),__publicField(this,"position"),__publicField(this,"colors"),__publicField(this,"grid"),__publicField(this,"zoomLevel"),__publicField(this,"precision");const{origin:t,position:r,colors:o,grid:n,zoomLevel:i}=e||{};this.origin=t||"center",this.position=r?ipoint(r.x,r.y):ipoint(0,0),this.colors={background:(null==o?void 0:o.background)?new oe(o.background):new oe(0,0,0),foreground:(null==o?void 0:o.foreground)?new oe(o.foreground):new oe(255,255,255)},this.grid={color:(null==n?void 0:n.color)?new oe(n.color):new oe(0,0,0,51),lineWidth:(null==n?void 0:n.lineWidth)||1,visibleCount:(null==n?void 0:n.visibleCount)||10},this.zoomLevel=i||1,this.precision=3}toJSON(){return{_type:this.constructor.name,origin:this.origin,position:this.position.toJSON(),colors:{background:this.colors.background.toJSON(),foreground:this.colors.foreground.toJSON()},grid:{color:this.grid.color.toJSON(),lineWidth:this.grid.lineWidth,visibleCount:this.grid.visibleCount},zoomLevel:this.zoomLevel,precision:this.precision}}}class PaletteColor{constructor(e){__publicField(this,"id"),__publicField(this,"color");const{id:t,color:r}=e||{};this.id=t||crypto.randomUUID(),this.color=r?new oe(r):new oe(0,0,0)}setColor(e){this.color=e}equal(e){return this.id===(null==e?void 0:e.id)}toJSON(){return{_type:this.constructor.name,id:this.id,color:this.color.toJSON()}}clone(){return new PaletteColor({id:this.id,color:this.color.clone()})}}class Palette{constructor(e){__publicField(this,"id"),__publicField(this,"name"),__publicField(this,"description"),__publicField(this,"colors"),__publicField(this,"locked");const{id:t,name:r,description:o,colors:n,locked:i}=e||{};this.id=t||crypto.randomUUID(),this.name=r||"",this.description=o,this.colors=(n||[]).map(e=>new PaletteColor(e)),this.locked=i}clone(){return new Palette({id:this.id,name:this.name,description:this.description,colors:this.colors.map(e=>e.clone()),locked:this.locked})}toJSON(){return{_type:this.constructor.name,id:this.id,name:this.name,description:this.description,colors:this.colors.map(e=>e.toJSON()),locked:this.locked}}}const le=[new AsyncTransform(e=>e&&e instanceof IPoint,()=>e=>e.pipe(map(e=>e.toJSON()))),new AsyncTransform(e=>e&&e instanceof DisplayOptions,()=>e=>e.pipe(map(e=>e.toJSON()))),new AsyncTransform(e=>e&&e instanceof oe,()=>e=>e.pipe(map(e=>e.toJSON()))),new AsyncTransform(e=>e&&e instanceof PaletteColor,()=>e=>e.pipe(map(e=>e.toJSON()))),new AsyncTransform(e=>e&&e instanceof Palette,()=>e=>e.pipe(map(e=>e.toJSON())))],ue=[new AsyncTransform(e=>"object"==typeof e&&"x"in e&&"y"in e,()=>e=>e.pipe(map(e=>ipoint(e.x,e.y)))),new AsyncTransform(e=>e&&DisplayOptions.prototype.constructor.name===e._type,()=>e=>e.pipe(map(e=>new DisplayOptions(e)))),new AsyncTransform(e=>e&&oe.prototype.constructor.name===e._type,()=>e=>e.pipe(map(e=>new oe(e)))),new AsyncTransform(e=>e&&PaletteColor.prototype.constructor.name===e._type,()=>e=>e.pipe(map(e=>new PaletteColor(e)))),new AsyncTransform(e=>e&&Palette.prototype.constructor.name===e._type,()=>e=>e.pipe(map(e=>new Palette(e))))];const _e={fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},de={silent:{level:-1},fatal:{level:_e.fatal},error:{level:_e.error},warn:{level:_e.warn},log:{level:_e.log},info:{level:_e.info},success:{level:_e.success},fail:{level:_e.fail},ready:{level:_e.info},start:{level:_e.info},box:{level:_e.info},debug:{level:_e.debug},trace:{level:_e.trace},verbose:{level:_e.verbose}};function isPlainObject$1(e){if(null===e||"object"!=typeof e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&(!(Symbol.iterator in e)&&(!(Symbol.toStringTag in e)||"[object Module]"===Object.prototype.toString.call(e)))}function _defu(e,t,r=".",o){if(!isPlainObject$1(t))return _defu(e,{},r);const n=Object.assign({},t);for(const i in e){if("__proto__"===i||"constructor"===i)continue;const t=e[i];null!=t&&(Array.isArray(t)&&Array.isArray(n[i])?n[i]=[...t,...n[i]]:isPlainObject$1(t)&&isPlainObject$1(n[i])?n[i]=_defu(t,n[i],(r?`${r}.`:"")+i.toString()):n[i]=t)}return n}const he=function createDefu(e){return(...e)=>e.reduce((e,t)=>_defu(e,t,""),{})}();function isLogObj(e){return!!function isPlainObject(e){return"[object Object]"===Object.prototype.toString.call(e)}(e)&&(!(!e.message&&!e.args)&&!e.stack)}let pe=!1;const fe=[];class Consola{constructor(e={}){__publicField(this,"options"),__publicField(this,"_lastLog"),__publicField(this,"_mockFn");const t=e.types||de;this.options=he({...e,defaults:{...e.defaults},level:_normalizeLogLevel(e.level,t),reporters:[...e.reporters||[]]},{types:de,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const r in t){const e={type:r,...this.options.defaults,...t[r]};this[r]=this._wrapLogFn(e),this[r].raw=this._wrapLogFn(e,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(e){this.options.level=_normalizeLogLevel(e,this.options.types,this.options.level)}prompt(e,t){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(e,t)}create(e){const t=new Consola({...this.options,...e});return this._mockFn&&t.mockTypes(this._mockFn),t}withDefaults(e){return this.create({...this.options,defaults:{...this.options.defaults,...e}})}withTag(e){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+e:e})}addReporter(e){return this.options.reporters.push(e),this}removeReporter(e){if(e){const t=this.options.reporters.indexOf(e);if(-1!==t)return this.options.reporters.splice(t,1)}else this.options.reporters.splice(0);return this}setReporters(e){return this.options.reporters=Array.isArray(e)?e:[e],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const e in this.options.types)console["__"+e]||(console["__"+e]=console[e]),console[e]=this[e].raw}restoreConsole(){for(const e in this.options.types)console["__"+e]&&(console[e]=console["__"+e],delete console["__"+e])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(e,t){e&&(e.__write||(e.__write=e.write),e.write=e=>{this[t].raw(String(e).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(e){e&&e.__write&&(e.write=e.__write,delete e.__write)}pauseLogs(){pe=!0}resumeLogs(){pe=!1;const e=fe.splice(0);for(const t of e)t[0]._logFn(t[1],t[2])}mockTypes(e){const t=e||this.options.mockFn;if(this._mockFn=t,"function"==typeof t)for(const r in this.options.types)this[r]=t(r,this.options.types[r])||this[r],this[r].raw=this[r]}_wrapLogFn(e,t){return(...r)=>{if(!pe)return this._logFn(e,r,t);fe.push([this,e,r,t])}}_logFn(e,t,r){if((e.level||0)>this.level)return!1;const o={date:new Date,args:[],...e,level:_normalizeLogLevel(e.level,this.options.types)};!r&&1===t.length&&isLogObj(t[0])?Object.assign(o,t[0]):o.args=[...t],o.message&&(o.args.unshift(o.message),delete o.message),o.additional&&(Array.isArray(o.additional)||(o.additional=o.additional.split("\n")),o.args.push("\n"+o.additional.join("\n")),delete o.additional),o.type="string"==typeof o.type?o.type.toLowerCase():"log",o.tag="string"==typeof o.tag?o.tag:"";const resolveLog=(e=!1)=>{const t=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&t>0){const e=[...this._lastLog.object.args];t>1&&e.push(`(repeated ${t} times)`),this._log({...this._lastLog.object,args:e}),this._lastLog.count=1}e&&(this._lastLog.object=o,this._log(o))};clearTimeout(this._lastLog.timeout);const n=this._lastLog.time&&o.date?o.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=o.date,n<this.options.throttle)try{const e=JSON.stringify([o.type,o.tag,o.args]),t=this._lastLog.serialized===e;if(this._lastLog.serialized=e,t&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin))return void(this._lastLog.timeout=setTimeout(resolveLog,this.options.throttle))}catch{}resolveLog(!0)}_log(e){for(const t of this.options.reporters)t.log(e,{options:this.options})}}function _normalizeLogLevel(e,t={},r=3){return void 0===e?r:"number"==typeof e?e:t[e]&&void 0!==t[e].level?t[e].level:r}Consola.prototype.add=Consola.prototype.addReporter,Consola.prototype.remove=Consola.prototype.removeReporter,Consola.prototype.clear=Consola.prototype.removeReporter,Consola.prototype.withScope=Consola.prototype.withTag,Consola.prototype.mock=Consola.prototype.mockTypes,Consola.prototype.pause=Consola.prototype.pauseLogs,Consola.prototype.resume=Consola.prototype.resumeLogs;class BrowserReporter{constructor(e){__publicField(this,"options"),__publicField(this,"defaultColor"),__publicField(this,"levelColorMap"),__publicField(this,"typeColorMap"),this.options={...e},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(e){return e<1?console.__error||console.error:1===e?console.__warn||console.warn:console.__log||console.log}log(e){const t=this._getLogFn(e.level),r="log"===e.type?"":e.type,o=e.tag||"",n=`\n      background: ${this.typeColorMap[e.type]||this.levelColorMap[e.level]||this.defaultColor};\n      border-radius: 0.5em;\n      color: white;\n      font-weight: bold;\n      padding: 2px 0.5em;\n    `,i=`%c${[o,r].filter(Boolean).join(":")}`;"string"==typeof e.args[0]?t(`${i}%c ${e.args[0]}`,n,"",...e.args.slice(1)):t(i,n,...e.args)}}const ge=function createConsola(e={}){return function createConsola$1(e={}){return new Consola(e)}({reporters:e.reporters||[new BrowserReporter({})],prompt:(e,t={})=>"confirm"===t.type?Promise.resolve(confirm(e)):Promise.resolve(prompt(e)),...e})}().withTag("webPaint");ge.withTag("workerManager"),ge.withTag("display");const me=ge.withTag("worker"),be=me.withTag("main");let we;me.withTag("display");let ye=null;function getUint8ArrayMemory0(){return null!==ye&&0!==ye.byteLength||(ye=new Uint8Array(we.memory.buffer)),ye}function getArrayU8FromWasm0(e,t){return e>>>=0,getUint8ArrayMemory0().subarray(e/1,e/1+t)}function addToExternrefTable0(e){const t=we.__externref_table_alloc();return we.__wbindgen_export_2.set(t,e),t}const Se="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};function getStringFromWasm0(e,t){return e>>>=0,Se.decode(getUint8ArrayMemory0().subarray(e,e+t))}function isLikeNone(e){return null==e}function _assertClass(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`)}"undefined"!=typeof TextDecoder&&Se.decode();let ve=0;function passArray8ToWasm0(e,t){const r=t(1*e.length,1)>>>0;return getUint8ArrayMemory0().set(e,r/1),ve=e.length,r}const Oe="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}};function takeFromExternrefTable0(e){const t=we.__wbindgen_export_2.get(e);return we.__externref_table_dealloc(e),t}function drawLine(e,t,r,o,n){var i=passArray8ToWasm0(e,we.__wbindgen_malloc),s=ve;_assertClass(t,Dimension);var a=t.__destroy_into_raw();_assertClass(r,Point);var c=r.__destroy_into_raw();_assertClass(o,Point);var l=o.__destroy_into_raw();let u=0;isLikeNone(n)||(_assertClass(n,LineOptions),u=n.__destroy_into_raw());const _=we.drawLine(i,s,e,a,c,l,u);if(_[1])throw takeFromExternrefTable0(_[0])}Oe.encodeInto;let Ce=null;function getDataViewMemory0(){return(null===Ce||!0===Ce.buffer.detached||void 0===Ce.buffer.detached&&Ce.buffer!==we.memory.buffer)&&(Ce=new DataView(we.memory.buffer)),Ce}function drawPolygon(e,t,r,o){var n=passArray8ToWasm0(e,we.__wbindgen_malloc),i=ve;_assertClass(t,Dimension);var s=t.__destroy_into_raw();const a=function passArrayJsValueToWasm0(e,t){const r=t(4*e.length,4)>>>0;for(let o=0;o<e.length;o++){const t=addToExternrefTable0(e[o]);getDataViewMemory0().setUint32(r+4*o,t,!0)}return ve=e.length,r}(r,we.__wbindgen_malloc),c=ve;_assertClass(o,PolygonOptions);var l=o.__destroy_into_raw();const u=we.drawPolygon(n,i,e,s,a,c,l);if(u[1])throw takeFromExternrefTable0(u[0])}function getPixels(e,t,r,o){var n=passArray8ToWasm0(e,we.__wbindgen_malloc),i=ve;_assertClass(t,Dimension);var s=t.__destroy_into_raw();_assertClass(r,Point);var a=r.__destroy_into_raw();_assertClass(o,Dimension);var c=o.__destroy_into_raw();const l=we.getPixels(n,i,e,s,a,c);if(l[3])throw takeFromExternrefTable0(l[2]);var u=getArrayU8FromWasm0(l[0],l[1]).slice();return we.__wbindgen_free(l[0],1*l[1],1),u}function setPixels(e,t,r,o,n,i){var s=passArray8ToWasm0(e,we.__wbindgen_malloc),a=ve;_assertClass(t,Dimension);var c=t.__destroy_into_raw();_assertClass(r,Point);var l=r.__destroy_into_raw();const u=passArray8ToWasm0(o,we.__wbindgen_malloc),_=ve;_assertClass(n,Dimension);var d=n.__destroy_into_raw();const h=we.setPixels(s,a,e,c,l,u,_,d,i);if(h[1])throw takeFromExternrefTable0(h[0])}function invert(e,t){var r=passArray8ToWasm0(e,we.__wbindgen_malloc),o=ve;_assertClass(t,Dimension);var n=t.__destroy_into_raw();const i=we.invert(r,o,e,n);if(i[3])throw takeFromExternrefTable0(i[2]);var s=getArrayU8FromWasm0(i[0],i[1]).slice();return we.__wbindgen_free(i[0],1*i[1],1),s}const Ae=Object.freeze({Round:0,0:"Round",Square:1,1:"Square",Dots:2,2:"Dots"}),Ee="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>we.__wbg_airburshoptions_free(e>>>0,1));class AirBurshOptions{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ee.unregister(this),e}free(){const e=this.__destroy_into_raw();we.__wbg_airburshoptions_free(e,0)}get is_round(){return 0!==we.__wbg_get_airburshoptions_is_round(this.__wbg_ptr)}set is_round(e){we.__wbg_set_airburshoptions_is_round(this.__wbg_ptr,e)}get num_dots(){return we.__wbg_get_airburshoptions_num_dots(this.__wbg_ptr)>>>0}set num_dots(e){we.__wbg_set_airburshoptions_num_dots(this.__wbg_ptr,e)}get max_alpha_factor(){return we.__wbg_get_airburshoptions_max_alpha_factor(this.__wbg_ptr)}set max_alpha_factor(e){we.__wbg_set_airburshoptions_max_alpha_factor(this.__wbg_ptr,e)}constructor(e,t,r){const o=we.airburshoptions_new(e,t,r);return this.__wbg_ptr=o>>>0,Ee.register(this,this.__wbg_ptr,this),this}}const Te="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>we.__wbg_bezieroptions_free(e>>>0,1));class BezierOptions{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Te.unregister(this),e}free(){const e=this.__destroy_into_raw();we.__wbg_bezieroptions_free(e,0)}get segment_length(){return we.__wbg_get_bezieroptions_segment_length(this.__wbg_ptr)}set segment_length(e){we.__wbg_set_bezieroptions_segment_length(this.__wbg_ptr,e)}get gap_length(){return we.__wbg_get_bezieroptions_gap_length(this.__wbg_ptr)}set gap_length(e){we.__wbg_set_bezieroptions_gap_length(this.__wbg_ptr,e)}get interpolate_segments(){return 0!==we.__wbg_get_bezieroptions_interpolate_segments(this.__wbg_ptr)}set interpolate_segments(e){we.__wbg_set_bezieroptions_interpolate_segments(this.__wbg_ptr,e)}constructor(e,t,r){const o=we.bezieroptions_new(e,t,r);return this.__wbg_ptr=o>>>0,Te.register(this,this.__wbg_ptr,this),this}}const xe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>we.__wbg_color_free(e>>>0,1));class Color{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xe.unregister(this),e}free(){const e=this.__destroy_into_raw();we.__wbg_color_free(e,0)}get r(){return we.__wbg_get_color_r(this.__wbg_ptr)}set r(e){we.__wbg_set_color_r(this.__wbg_ptr,e)}get g(){return we.__wbg_get_color_g(this.__wbg_ptr)}set g(e){we.__wbg_set_color_g(this.__wbg_ptr,e)}get b(){return we.__wbg_get_color_b(this.__wbg_ptr)}set b(e){we.__wbg_set_color_b(this.__wbg_ptr,e)}get a(){return we.__wbg_get_color_a(this.__wbg_ptr)}set a(e){we.__wbg_set_color_a(this.__wbg_ptr,e)}constructor(e,t,r,o){const n=we.color_new(e,t,r,o);return this.__wbg_ptr=n>>>0,xe.register(this,this.__wbg_ptr,this),this}equals(e){_assertClass(e,Color);return 0!==we.color_equals(this.__wbg_ptr,e.__wbg_ptr)}to_data(){const e=we.color_to_data(this.__wbg_ptr);var t=getArrayU8FromWasm0(e[0],e[1]).slice();return we.__wbindgen_free(e[0],1*e[1],1),t}}const Pe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>we.__wbg_dimension_free(e>>>0,1));class Dimension{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Pe.unregister(this),e}free(){const e=this.__destroy_into_raw();we.__wbg_dimension_free(e,0)}get x(){return we.__wbg_get_dimension_x(this.__wbg_ptr)>>>0}set x(e){we.__wbg_set_dimension_x(this.__wbg_ptr,e)}get y(){return we.__wbg_get_dimension_y(this.__wbg_ptr)>>>0}set y(e){we.__wbg_set_dimension_y(this.__wbg_ptr,e)}constructor(e,t){const r=we.dimension_new(e,t);return this.__wbg_ptr=r>>>0,Pe.register(this,this.__wbg_ptr,this),this}to_viewport_dimension(){const e=we.dimension_to_viewport_dimension(this.__wbg_ptr);return RenderDimension.__wrap(e)}}const ke="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>we.__wbg_ellipseoptions_free(e>>>0,1));class EllipseOptions{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ke.unregister(this),e}free(){const e=this.__destroy_into_raw();we.__wbg_ellipseoptions_free(e,0)}get style(){return we.__wbg_get_ellipseoptions_style(this.__wbg_ptr)}set style(e){we.__wbg_set_ellipseoptions_style(this.__wbg_ptr,e)}get line_options(){const e=we.__wbg_get_ellipseoptions_line_options(this.__wbg_ptr);return 0===e?void 0:LineOptions.__wrap(e)}set line_options(e){let t=0;isLikeNone(e)||(_assertClass(e,LineOptions),t=e.__destroy_into_raw()),we.__wbg_set_ellipseoptions_line_options(this.__wbg_ptr,t)}get interpolate_segments(){return 0!==we.__wbg_get_ellipseoptions_interpolate_segments(this.__wbg_ptr)}set interpolate_segments(e){we.__wbg_set_ellipseoptions_interpolate_segments(this.__wbg_ptr,e)}constructor(e,t,r){let o=0;isLikeNone(t)||(_assertClass(t,LineOptions),o=t.__destroy_into_raw());const n=we.ellipseoptions_new(e,o,r);return this.__wbg_ptr=n>>>0,ke.register(this,this.__wbg_ptr,this),this}}const De="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>we.__wbg_lineoptions_free(e>>>0,1));class LineOptions{static __wrap(e){e>>>=0;const t=Object.create(LineOptions.prototype);return t.__wbg_ptr=e,De.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,De.unregister(this),e}free(){const e=this.__destroy_into_raw();we.__wbg_lineoptions_free(e,0)}get segment_length(){return we.__wbg_get_lineoptions_segment_length(this.__wbg_ptr)>>>0}set segment_length(e){we.__wbg_set_lineoptions_segment_length(this.__wbg_ptr,e)}get gap_length(){return we.__wbg_get_lineoptions_gap_length(this.__wbg_ptr)>>>0}set gap_length(e){we.__wbg_set_lineoptions_gap_length(this.__wbg_ptr,e)}constructor(e,t){const r=we.lineoptions_new(e,t);return this.__wbg_ptr=r>>>0,De.register(this,this.__wbg_ptr,this),this}}const Le="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>we.__wbg_point_free(e>>>0,1));class Point{static __unwrap(e){return e instanceof Point?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Le.unregister(this),e}free(){const e=this.__destroy_into_raw();we.__wbg_point_free(e,0)}get x(){return we.__wbg_get_dimension_x(this.__wbg_ptr)>>>0}set x(e){we.__wbg_set_dimension_x(this.__wbg_ptr,e)}get y(){return we.__wbg_get_dimension_y(this.__wbg_ptr)>>>0}set y(e){we.__wbg_set_dimension_y(this.__wbg_ptr,e)}constructor(e,t){const r=we.dimension_new(e,t);return this.__wbg_ptr=r>>>0,Le.register(this,this.__wbg_ptr,this),this}to_render_point(){const e=we.dimension_to_viewport_dimension(this.__wbg_ptr);return RenderPosition.__wrap(e)}}const Fe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>we.__wbg_polygonoptions_free(e>>>0,1));class PolygonOptions{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Fe.unregister(this),e}free(){const e=this.__destroy_into_raw();we.__wbg_polygonoptions_free(e,0)}get style(){return we.__wbg_get_polygonoptions_style(this.__wbg_ptr)}set style(e){we.__wbg_set_polygonoptions_style(this.__wbg_ptr,e)}get line_options(){const e=we.__wbg_get_polygonoptions_line_options(this.__wbg_ptr);return 0===e?void 0:LineOptions.__wrap(e)}set line_options(e){let t=0;isLikeNone(e)||(_assertClass(e,LineOptions),t=e.__destroy_into_raw()),we.__wbg_set_polygonoptions_line_options(this.__wbg_ptr,t)}constructor(e,t){let r=0;isLikeNone(t)||(_assertClass(t,LineOptions),r=t.__destroy_into_raw());const o=we.polygonoptions_new(e,r);return this.__wbg_ptr=o>>>0,Fe.register(this,this.__wbg_ptr,this),this}}const Re="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>we.__wbg_rectangleoptions_free(e>>>0,1));class RectangleOptions{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Re.unregister(this),e}free(){const e=this.__destroy_into_raw();we.__wbg_rectangleoptions_free(e,0)}get style(){return we.__wbg_get_rectangleoptions_style(this.__wbg_ptr)}set style(e){we.__wbg_set_rectangleoptions_style(this.__wbg_ptr,e)}get line_options(){const e=we.__wbg_get_rectangleoptions_line_options(this.__wbg_ptr);return 0===e?void 0:LineOptions.__wrap(e)}set line_options(e){let t=0;isLikeNone(e)||(_assertClass(e,LineOptions),t=e.__destroy_into_raw()),we.__wbg_set_rectangleoptions_line_options(this.__wbg_ptr,t)}get stroke_align(){return we.__wbg_get_rectangleoptions_stroke_align(this.__wbg_ptr)}set stroke_align(e){we.__wbg_set_rectangleoptions_stroke_align(this.__wbg_ptr,e)}constructor(e,t,r){let o=0;isLikeNone(r)||(_assertClass(r,LineOptions),o=r.__destroy_into_raw());const n=we.rectangleoptions_new(e,t,o);return this.__wbg_ptr=n>>>0,Re.register(this,this.__wbg_ptr,this),this}}const Me="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>we.__wbg_renderdimension_free(e>>>0,1));class RenderDimension{static __wrap(e){e>>>=0;const t=Object.create(RenderDimension.prototype);return t.__wbg_ptr=e,Me.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Me.unregister(this),e}free(){const e=this.__destroy_into_raw();we.__wbg_renderdimension_free(e,0)}get x(){return we.__wbg_get_dimension_x(this.__wbg_ptr)}set x(e){we.__wbg_set_dimension_x(this.__wbg_ptr,e)}get y(){return we.__wbg_get_dimension_y(this.__wbg_ptr)}set y(e){we.__wbg_set_dimension_y(this.__wbg_ptr,e)}constructor(e,t){const r=we.dimension_new(e,t);return this.__wbg_ptr=r>>>0,Me.register(this,this.__wbg_ptr,this),this}abs(){const e=we.renderdimension_abs(this.__wbg_ptr);return RenderDimension.__wrap(e)}}const ze="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>we.__wbg_renderposition_free(e>>>0,1));class RenderPosition{static __wrap(e){e>>>=0;const t=Object.create(RenderPosition.prototype);return t.__wbg_ptr=e,ze.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ze.unregister(this),e}free(){const e=this.__destroy_into_raw();we.__wbg_renderposition_free(e,0)}get x(){return we.__wbg_get_dimension_x(this.__wbg_ptr)}set x(e){we.__wbg_set_dimension_x(this.__wbg_ptr,e)}get y(){return we.__wbg_get_dimension_y(this.__wbg_ptr)}set y(e){we.__wbg_set_dimension_y(this.__wbg_ptr,e)}constructor(e,t){const r=we.dimension_new(e,t);return this.__wbg_ptr=r>>>0,ze.register(this,this.__wbg_ptr,this),this}}function __wbg_get_imports(){const e={wbg:{}};return e.wbg.__wbg_buffer_609cc3eee51ed158=function(e){return e.buffer},e.wbg.__wbg_getRandomValues_3c9c0d586e575a16=function(){return function handleError(e,t){try{return e.apply(this,t)}catch(r){const e=addToExternrefTable0(r);we.__wbindgen_exn_store(e)}}(function(e,t){globalThis.crypto.getRandomValues(getArrayU8FromWasm0(e,t))},arguments)},e.wbg.__wbg_new_a12002a7f91c75be=function(e){return new Uint8Array(e)},e.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(e,t,r){return new Uint8Array(e,t>>>0,r>>>0)},e.wbg.__wbg_point_unwrap=function(e){return Point.__unwrap(e)},e.wbg.__wbindgen_copy_to_typed_array=function(e,t,r){new Uint8Array(r.buffer,r.byteOffset,r.byteLength).set(getArrayU8FromWasm0(e,t))},e.wbg.__wbindgen_init_externref_table=function(){const e=we.__wbindgen_export_2,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},e.wbg.__wbindgen_memory=function(){return we.memory},e.wbg.__wbindgen_string_new=function(e,t){return getStringFromWasm0(e,t)},e.wbg.__wbindgen_throw=function(e,t){throw new Error(getStringFromWasm0(e,t))},e}async function __wbg_init(e){if(void 0!==we)return we;void 0!==e&&(Object.getPrototypeOf(e)===Object.prototype?({module_or_path:e}=e):console.warn("using deprecated parameters for the initialization function; pass a single object instead")),void 0===e&&(e=new URL(""+new URL("wasm_bg-C0cLv2oh.wasm",self.location.href).href,self.location.href));const t=__wbg_get_imports();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:o}=await async function __wbg_load(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(r){if("application/wasm"==e.headers.get("Content-Type"))throw r;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r)}const o=await e.arrayBuffer();return await WebAssembly.instantiate(o,t)}{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}(await e,t);return function __wbg_finalize_init(e,t){return we=e.exports,__wbg_init.__wbindgen_wasm_module=t,Ce=null,ye=null,we.__wbindgen_start(),we}(r,o)}async function loadImage({setSharedBuffer:e,setupDisplays:t},r){const{imageBitmap:o}=r.payload,n=o.width,i=o.height,s=new SharedArrayBuffer(n*i*4);return await async function imageBitmapToSharedBuffer(e,t,r,o){const n=new OffscreenCanvas(r,o),i=n.getContext("2d");i.drawImage(e,0,0,r,o);const s=i.getImageData(0,0,r,o),a=new Uint8ClampedArray(t);a.set(s.data)}(o,s,n,i),o.close(),e(s,ipoint(n,i)),t(),{type:ne.LOAD_IMAGE_SUCCESS}}function toPoint(e){return new Point(e.x,e.y)}function toDimension(e){return new Dimension(e.x,e.y)}function toColor(e){return new Color(e.r,e.g,e.b,e.a)}function toLineOptions(e){return new LineOptions(e.segmentLength||1,e.gapLength||0)}function toShapeStyle(e){switch(e){case ie.FILLED:return 0;case ie.STROKED:return 1;case ie.STROKED_FILLED:return 2;default:throw new Error(`Unknown shape style: ${e}`)}}function toRectangleOptions(e){return new RectangleOptions(toShapeStyle(e.style),function toStrokeAlign(e){switch(e){case ce.INSIDE:return 0;case ce.CENTER:return 1;case ce.OUTSIDE:return 2;default:throw new Error(`Unknown stroke align: ${e}`)}}(e.strokeAlign),toLineOptions({segmentLength:e.segmentLength,gapLength:e.gapLength}))}function dottedFreehand(e,t){let r=e.getTargetPosition(t.position,t);r=ipoint(()=>Math.round(r-e.useOptions.brush.size/2));const o=e.getDimension();!function drawBrush(e,t,r){var o=passArray8ToWasm0(e,we.__wbindgen_malloc),n=ve;_assertClass(t,Dimension);var i=t.__destroy_into_raw();_assertClass(r,Point);var s=r.__destroy_into_raw();const a=we.drawBrush(o,n,e,i,s);if(a[1])throw takeFromExternrefTable0(a[0])}(e.viewTest,toDimension(o),toPoint(r))}var Ie=(e=>(e.START="start",e.MOVE="move",e.STOP="stop",e))(Ie||{});let Be,Ne;function draw$5(e,t,r,o){var n;const{position:i}=t;if(r.anchorPositions&&r.anchorPositions.length>1){const[s,a]=r.anchorPositions,c=ipoint(0,0);let l=e.getTargetPosition(s,t);l=ipoint(()=>Math.round(l+c));let u=e.getTargetPosition(a||i,t);u=ipoint(()=>Math.round(u+c)),o&&(null==(n=e.view)||n.set(o)),drawLine(e.viewTest,toDimension(e.getDimension()),toPoint(l),toPoint(u),toLineOptions({segmentLength:e.useOptions.tool.segmentLength||1,gapLength:e.useOptions.tool.gapLength||0}))}}function draw$4(e,t,r,o){var n;const{position:i}=t;if(r.anchorPositions&&r.anchorPositions.length>1){const[s,a,c,l]=r.anchorPositions;if(r.anchorPositions.length>1){o&&(null==(n=e.view)||n.set(o));const u=ipoint(0,0);let _=e.getTargetPosition(s,t);_=ipoint(()=>Math.round(_+u));let d=e.getTargetPosition(a||i,t);d=ipoint(()=>Math.round(d+u));let h=e.getTargetPosition(c,t);h=ipoint(()=>Math.round(h+u));let p=e.getTargetPosition(l,t);p=ipoint(()=>Math.round(p+u)),r.anchorPositions.length>2?function drawBezier(e,t,r,o,n,i,s){var a=passArray8ToWasm0(e,we.__wbindgen_malloc),c=ve;_assertClass(t,Dimension);var l=t.__destroy_into_raw();_assertClass(r,Point);var u=r.__destroy_into_raw();_assertClass(o,Point);var _=o.__destroy_into_raw();_assertClass(n,Point);var d=n.__destroy_into_raw();_assertClass(i,Point);var h=i.__destroy_into_raw();let p=0;isLikeNone(s)||(_assertClass(s,BezierOptions),p=s.__destroy_into_raw());const f=we.drawBezier(a,c,e,l,u,_,d,h,p);if(f[1])throw takeFromExternrefTable0(f[0])}(e.viewTest,toDimension(e.getDimension()),toPoint(_),toPoint(h),toPoint(d),toPoint(p),function toBezierOptions(e){return new BezierOptions(e.segmentLength||1,e.gapLength||0,e.interpolateSegments??!1)}({segmentLength:e.useOptions.tool.segmentLength||1,gapLength:e.useOptions.tool.gapLength||0,interpolateSegments:e.useOptions.tool.interpolateSegments||!1})):drawLine(e.viewTest,toDimension(e.getDimension()),toPoint(_),toPoint(d),toLineOptions({segmentLength:e.useOptions.tool.segmentLength||1,gapLength:e.useOptions.tool.gapLength||0}))}}}function airBrush(e,t,r){var o;const n=e.getTargetPosition(t.position,t),i=(null==(o=e.brushDescription)?void 0:o.getSize())||1,s=ipoint(i,i);!function drawAirBrush(e,t,r,o,n,i){var s=passArray8ToWasm0(e,we.__wbindgen_malloc),a=ve;_assertClass(t,Dimension);var c=t.__destroy_into_raw();_assertClass(r,Point);var l=r.__destroy_into_raw();_assertClass(o,Dimension);var u=o.__destroy_into_raw();_assertClass(n,Color);var _=n.__destroy_into_raw();_assertClass(i,AirBurshOptions);var d=i.__destroy_into_raw();const h=we.drawAirBrush(s,a,e,c,l,u,_,d);if(h[1])throw takeFromExternrefTable0(h[0])}(e.viewTest,toDimension(e.getDimension()),toPoint(ipoint(n.x,n.y)),toDimension(s),toColor(e.brushDescription.primaryColor),function toAirBrushOptions(e){return new AirBurshOptions(e.round??!0,e.strength??100,e.weight??1)}({round:r.round,strength:e.useOptions.tool.airBrushStrength||100,weight:e.useOptions.tool.airBrushWeight||100}))}var Ue=(e=>(e.START="START",e.MOVE="MOVE",e.STOP="STOP",e))(Ue||{});let Ge;function draw$3(e,t,r,o){var n;const i=e.useOptions.tool.shapeStyle||ie.STROKED,s=e.brushDescription.getScaledSize(!0),a=e.getTargetDimension(r.dimension,t),c=ipoint(()=>Math.min(a,0)),l=ipoint(()=>Math.sign(c)),u=ipoint(()=>-s*l);let _=e.getTargetPosition(r.position,t);i!==ie.FILLED&&(_=ipoint(()=>Math.round(_+u))),o&&(null==(n=e.view)||n.set(o)),_=ipoint(()=>Math.round(_+c)),function drawRectangle(e,t,r,o,n){var i=passArray8ToWasm0(e,we.__wbindgen_malloc),s=ve;_assertClass(t,Dimension);var a=t.__destroy_into_raw();_assertClass(r,Point);var c=r.__destroy_into_raw();_assertClass(o,Dimension);var l=o.__destroy_into_raw();_assertClass(n,RectangleOptions);var u=n.__destroy_into_raw();const _=we.drawRectangle(i,s,e,a,c,l,u);if(_[1])throw takeFromExternrefTable0(_[0])}(e.viewTest,toDimension(e.getDimension()),toPoint(_),toDimension(ipoint(()=>Math.abs(a))),toRectangleOptions({style:i,strokeAlign:ce.CENTER,fillColor:e.useOptions.color.secondaryColor.color,segmentLength:e.useOptions.tool.segmentLength||0,gapLength:e.useOptions.tool.gapLength||0}))}var Ve=(e=>(e.START="START",e.MOVE="MOVE",e.STOP="STOP",e))(Ve||{});let We,je;function ellipse(e,t,r){switch(r.state){case Ve.START:We=new Uint8ClampedArray(e.sharedBuffer.buffer.slice(0));break;case Ve.STOP:draw$2(e,t,r,We),We&&(We=void 0);break;case Ve.MOVE:We&&draw$2(e,t,r,We)}}function draw$2(e,t,r,o){var n;const i=e.useOptions.tool.shapeStyle||ie.STROKED,s=e.brushDescription.getScaledSize(!0),a=e.getTargetDimension(r.dimension,t),c=ipoint(()=>Math.min(a,0)),l=ipoint(()=>Math.sign(c)),u=ipoint(()=>-s*l);let _=e.getTargetPosition(r.position,t);i!==ie.FILLED&&(_=ipoint(()=>Math.round(_+u))),_=ipoint(()=>Math.round(_+c));const d=ipoint(()=>Math.abs(a));d.x&&d.y&&(o&&(null==(n=e.view)||n.set(o)),function drawEllipse(e,t,r,o,n){var i=passArray8ToWasm0(e,we.__wbindgen_malloc),s=ve;_assertClass(t,Dimension);var a=t.__destroy_into_raw();_assertClass(r,Point);var c=r.__destroy_into_raw();_assertClass(o,Dimension);var l=o.__destroy_into_raw();_assertClass(n,EllipseOptions);var u=n.__destroy_into_raw();const _=we.drawEllipse(i,s,e,a,c,l,u);if(_[1])throw takeFromExternrefTable0(_[0])}(e.viewTest,toDimension(e.getDimension()),toPoint(_),toDimension(d),function toEllipseOptions(e){return new EllipseOptions(toShapeStyle(e.style),toLineOptions({segmentLength:e.segmentLength,gapLength:e.gapLength}),e.interpolateSegments??!1)}({style:i,fillColor:e.brushDescription.secondaryColor,segmentLength:e.useOptions.tool.segmentLength||0,gapLength:e.useOptions.tool.gapLength||0,interpolateSegments:e.useOptions.tool.interpolateSegments})))}function draw$1(e,t,r,o){var n;if(r.anchorPositions&&r.anchorPositions.length>1){const i=ipoint(0,0),getAnchorPosition=r=>{const o=e.getTargetPosition(r,t);return ipoint(()=>Math.round(o+i))};o&&(null==(n=e.view)||n.set(o)),drawPolygon(e.viewTest,toDimension(e.getDimension()),r.anchorPositions.map(getAnchorPosition).map(toPoint),function toPolygonOptions(e){return new PolygonOptions(toShapeStyle(e.style),toLineOptions({segmentLength:e.segmentLength,gapLength:e.gapLength}))}({style:e.useOptions.tool.shapeStyle||ie.STROKED,segmentLength:e.useOptions.tool.segmentLength||0,gapLength:e.useOptions.tool.gapLength||0}))}}var He=(e=>(e.START="START",e.MOVE="MOVE",e.STOP="STOP",e))(He||{});let $e,qe;function draw(e,t,r,o){var n;o&&(null==(n=e.view)||n.set(o));const i=ipoint(()=>Math.abs(r.dimension)),s=ipoint(()=>Math.min(r.dimension,0)),a=ipoint(()=>r.position+s),c=e.getTargetPosition(a,t,{round:!0});setPixels(e.view,toDimension(e.getDimension()),toPoint(ipoint(()=>Math.round(c))),qe,toDimension(e.getTargetDimension(i,t)),!1)}function fill(e,t,r){const o=e.getTargetPosition(t.position,t),n=e.getDimension();!function drawFill(e,t,r,o){var n=passArray8ToWasm0(e,we.__wbindgen_malloc),i=ve;_assertClass(t,Dimension);var s=t.__destroy_into_raw();_assertClass(r,Point);var a=r.__destroy_into_raw();_assertClass(o,Color);var c=o.__destroy_into_raw();const l=we.drawFill(n,i,e,s,a,c);if(l[1])throw takeFromExternrefTable0(l[0])}(e.viewTest,toDimension(n),toPoint(o),toColor(e.brushDescription.primaryColor))}var Je=(e=>(e.NEAREST_NEIGHBOR="nearestNeighbor",e.BILINEAR="bilinear",e.BICUBIC="bicubic",e.LANCZOS="lanczos",e))(Je||{}),Ye=(e=>(e.GRAYSCALE="grayscale",e.INVERT="invert",e.SEPIA="sepia",e.BRIGHTNESS="brightness",e.CONTRAST="contrast",e.SATURATION="saturation",e.SHARPEN="sharpen",e.BLUR="blur",e.EMBOSS="emboss",e.EDGE_DETECT="edge_detect",e.THRESHOLD="threshold",e.COLORIZE="colorize",e.CUSTOM="custom",e))(Ye||{});function imageOperation(e,t){var r,o,n,i,s,a,c,l,u;const _=toDimension(e.getDimension());switch(t.type){case Ye.GRAYSCALE:null==(r=e.view)||r.set(function grayScale(e,t){var r=passArray8ToWasm0(e,we.__wbindgen_malloc),o=ve;_assertClass(t,Dimension);var n=t.__destroy_into_raw();const i=we.grayScale(r,o,e,n);if(i[3])throw takeFromExternrefTable0(i[2]);var s=getArrayU8FromWasm0(i[0],i[1]).slice();return we.__wbindgen_free(i[0],1*i[1],1),s}(e.view,_));break;case Ye.INVERT:null==(o=e.view)||o.set(invert(e.view,_));break;case Ye.SEPIA:null==(n=e.view)||n.set(function sepia(e,t){var r=passArray8ToWasm0(e,we.__wbindgen_malloc),o=ve;_assertClass(t,Dimension);var n=t.__destroy_into_raw();const i=we.sepia(r,o,e,n);if(i[3])throw takeFromExternrefTable0(i[2]);var s=getArrayU8FromWasm0(i[0],i[1]).slice();return we.__wbindgen_free(i[0],1*i[1],1),s}(e.view,_));break;case Ye.BRIGHTNESS:null==(i=e.view)||i.set(function adjustBrightness(e,t,r){var o=passArray8ToWasm0(e,we.__wbindgen_malloc),n=ve;_assertClass(t,Dimension);var i=t.__destroy_into_raw();const s=we.adjustBrightness(o,n,e,i,r);if(s[3])throw takeFromExternrefTable0(s[2]);var a=getArrayU8FromWasm0(s[0],s[1]).slice();return we.__wbindgen_free(s[0],1*s[1],1),a}(e.view,_,t.value/100));break;case Ye.CONTRAST:null==(s=e.view)||s.set(function adjustContrast(e,t,r){var o=passArray8ToWasm0(e,we.__wbindgen_malloc),n=ve;_assertClass(t,Dimension);var i=t.__destroy_into_raw();const s=we.adjustContrast(o,n,e,i,r);if(s[3])throw takeFromExternrefTable0(s[2]);var a=getArrayU8FromWasm0(s[0],s[1]).slice();return we.__wbindgen_free(s[0],1*s[1],1),a}(e.view,_,t.value/100));break;case Ye.SATURATION:null==(a=e.view)||a.set(function adjustSaturation(e,t,r){var o=passArray8ToWasm0(e,we.__wbindgen_malloc),n=ve;_assertClass(t,Dimension);var i=t.__destroy_into_raw();const s=we.adjustSaturation(o,n,e,i,r);if(s[3])throw takeFromExternrefTable0(s[2]);var a=getArrayU8FromWasm0(s[0],s[1]).slice();return we.__wbindgen_free(s[0],1*s[1],1),a}(e.view,_,t.value/100));break;case Ye.SHARPEN:null==(c=e.view)||c.set(function sharpen(e,t,r){var o=passArray8ToWasm0(e,we.__wbindgen_malloc),n=ve;_assertClass(t,Dimension);var i=t.__destroy_into_raw();const s=we.sharpen(o,n,e,i,r);if(s[3])throw takeFromExternrefTable0(s[2]);var a=getArrayU8FromWasm0(s[0],s[1]).slice();return we.__wbindgen_free(s[0],1*s[1],1),a}(e.view,_,t.value));break;case Ye.BLUR:null==(l=e.view)||l.set(function blur(e,t,r){var o=passArray8ToWasm0(e,we.__wbindgen_malloc),n=ve;_assertClass(t,Dimension);var i=t.__destroy_into_raw();const s=we.blur(o,n,e,i,r);if(s[3])throw takeFromExternrefTable0(s[2]);var a=getArrayU8FromWasm0(s[0],s[1]).slice();return we.__wbindgen_free(s[0],1*s[1],1),a}(e.view,_,t.value));break;case Ye.EMBOSS:null==(u=e.view)||u.set(function emboss(e,t,r){var o=passArray8ToWasm0(e,we.__wbindgen_malloc),n=ve;_assertClass(t,Dimension);var i=t.__destroy_into_raw();const s=we.emboss(o,n,e,i,r);if(s[3])throw takeFromExternrefTable0(s[2]);var a=getArrayU8FromWasm0(s[0],s[1]).slice();return we.__wbindgen_free(s[0],1*s[1],1),a}(e.view,_,t.value/100))}}function executeAction(e,{tool:t,meta:r,toolOptions:o}){switch(t){case ae.CLEAR:!function clear(e){var t,r,o;null==(o=e.view)||o.set(new Uint8ClampedArray(new Array((null==(t=e.sharedBuffer)?void 0:t.dimension.x)*(null==(r=e.sharedBuffer)?void 0:r.dimension.y)*4).fill(255)))}(e);break;case ae.DOTTED_FREEHAND:dottedFreehand(e,r);break;case ae.CONTINUOUS_FREEHAND:!function continuousFreehand(e,t,r){let o=e.getTargetPosition(t.position,t);o=ipoint(()=>Math.round(o-e.useOptions.brush.size/2));let n=e.getTargetPosition(r.lastPosition,{...t});n=ipoint(()=>Math.round(n-e.useOptions.brush.size/2));const i=e.getDimension();drawLine(e.viewTest,toDimension(i),toPoint(n),toPoint(o),toLineOptions({segmentLength:e.useOptions.tool.segmentLength,gapLength:e.useOptions.tool.gapLength}))}(e,r,o);break;case ae.STRAIGHT_LINE:!function straightLine$1(e,t,r){switch(r.state){case Ie.START:Be=new Uint8ClampedArray(e.sharedBuffer.buffer.slice(0)),console.log("GEOMETRY_LINE_STATE.START");break;case Ie.STOP:Be&&(Be=void 0),draw$5(e,t,r),console.log("GEOMETRY_LINE_STATE.STOP");break;case Ie.MOVE:Be&&draw$5(e,t,r,Be),console.log("GEOMETRY_LINE_STATE.MOVE")}}(e,r,o);break;case ae.CURVE_LINE:!function straightLine(e,t,r){switch(r.state){case Ie.START:Ne=new Uint8ClampedArray(e.sharedBuffer.buffer.slice(0));break;case Ie.STOP:Ne&&(Ne=void 0),draw$4(e,t,r);break;case Ie.MOVE:Ne&&draw$4(e,t,r,Ne)}}(e,r,o);break;case ae.AIR_BRUSH:airBrush(e,r,o);break;case ae.RECTANGLE:!function rectangle(e,t,r){switch(r.state){case Ue.START:Ge=new Uint8ClampedArray(e.sharedBuffer.buffer.slice(0));break;case Ue.STOP:draw$3(e,t,r,Ge),Ge&&(Ge=void 0);break;case Ue.MOVE:Ge&&draw$3(e,t,r,Ge)}}(e,r,o);break;case ae.CIRCLE:case ae.ELLIPSE:ellipse(e,r,o);break;case ae.POLYGON:!function polygon(e,t,r){switch(r.state){case Ie.START:je=new Uint8ClampedArray(e.sharedBuffer.buffer.slice(0));break;case Ie.STOP:je&&(je=void 0),draw$1(e,t,r);break;case Ie.MOVE:je&&draw$1(e,t,r,je)}}(e,r,o);break;case ae.FILL_TOOL:fill(e,r);break;case ae.CROP:!function crop(e,t,r){switch(r.state){case He.START:{const{position:o,dimension:n}=r,i=ipoint(()=>Math.min(n,0)),s=ipoint(()=>o+i),a=Math.abs(n.x),c=Math.abs(n.y),l=e.getTargetDimension(ipoint(a,c),t),u=getPixels(e.view,toDimension(e.getDimension()),toPoint(e.getTargetPosition(s,t)),toDimension(l));qe=invert(u,toDimension(l)),setPixels(e.view,toDimension(e.getDimension()),toPoint(e.getTargetPosition(s,t)),new Uint8Array(Array(qe.length/4).fill([0,0,0,0]).flat()),toDimension(l),r.copy||!1),$e=new Uint8Array(e.sharedBuffer.buffer.slice(0))}break;case He.STOP:{const o=Math.abs(r.dimension.x),n=Math.abs(r.dimension.y),i=e.getTargetDimension(ipoint(o,n),t);qe=invert(qe,toDimension(i)),draw(e,t,r,$e),$e&&($e=void 0)}break;case He.MOVE:$e&&draw(e,t,r,$e)}}(e,r,o);break;case ae.IMAGE_OPERATION:imageOperation(e,o);break;case ae.COLOR_PICKER:return function colorPicker(e,t){const r=e.getTargetPosition(t.position,t);return{type:ne.COLOR_PICKER_SUCCESS,payload:{position:r,color:e.isIntersect(r)?e.getColorAtPosition(r):void 0}}}(e,r);default:console.warn(`Tool ${t} is not implemented or not supported in this context.`)}}var Ke=(e=>(e.START="start",e.STOP="stop",e.FORWARD="forward",e.BACKWARD="backward",e))(Ke||{});function resizeImageNearestNeighbor(e,t,r,o,n){const i=new Uint8ClampedArray(o*n*4),s=t/o,a=r/n;for(let c=0;c<n;c++)for(let r=0;r<o;r++){const n=Math.floor(r*s),l=4*(Math.floor(c*a)*t+n),u=4*(c*o+r);i[u]=e[l],i[u+1]=e[l+1],i[u+2]=e[l+2],i[u+3]=e[l+3]}return i}function resizeImageBilinear(e,t,r,o,n){const i=new Uint8ClampedArray(o*n*4),s=t/o,a=r/n,clamp=(e,t,r)=>Math.max(t,Math.min(e,r));for(let c=0;c<n;c++)for(let n=0;n<o;n++){const l=n*s,u=c*a,_=Math.floor(l),d=Math.floor(u),h=Math.ceil(l),p=Math.ceil(u),f=l-_,g=u-d,m=4*(clamp(d,0,r-1)*t+clamp(_,0,t-1)),b=4*(clamp(d,0,r-1)*t+clamp(h,0,t-1)),w=4*(clamp(p,0,r-1)*t+clamp(_,0,t-1)),y=4*(clamp(p,0,r-1)*t+clamp(h,0,t-1)),S=4*(c*o+n);for(let t=0;t<4;t++){const r=e[m+t]*(1-f)+e[b+t]*f,o=e[w+t]*(1-f)+e[y+t]*f;i[S+t]=Math.round(r*(1-g)+o*g)}}return i}function resizeImageBicubic(e,t,r,o,n){const i=new Uint8ClampedArray(o*n*4),s=t/o,a=r/n,bicubicKernel=e=>(e=Math.abs(e))<=1?(1.5*e-2.5)*e*e+1:e<=2?((-.5*e+2.5)*e-4)*e+2:0,getPixelValue=(e,t,r,o,n,i)=>(o=Math.round(clamp(o,0,t-1)),e[4*((n=Math.round(clamp(n,0,r-1)))*t+o)+i]),clamp=(e,t,r)=>Math.max(t,Math.min(e,r));for(let c=0;c<n;c++)for(let n=0;n<o;n++){const l=n*s,u=c*a,_=Math.floor(l),d=Math.floor(u),h=l-_,p=u-d,f=4*(c*o+n);for(let o=0;o<4;o++){let n=0;for(let i=-1;i<=2;i++)for(let s=-1;s<=2;s++){n+=getPixelValue(e,t,r,_+s,d+i,o)*bicubicKernel(h-s)*bicubicKernel(p-i)}i[f+o]=Math.round(clamp(n,0,255))}}return i}function resizeImageLanczos(e,t,r,o,n){const i=new Uint8ClampedArray(o*n*4),s=t/o,a=r/n,lanczosKernel=e=>{if(0===(e=Math.abs(e)))return 1;if(e>=3)return 0;const t=Math.PI*e;return 3*Math.sin(t)*Math.sin(t/3)/(t*t)},getPixelValue=(e,t,r,o,n,i)=>(o=Math.round(clamp(o,0,t-1)),e[4*((n=Math.round(clamp(n,0,r-1)))*t+o)+i]),clamp=(e,t,r)=>Math.max(t,Math.min(e,r));for(let c=0;c<n;c++)for(let n=0;n<o;n++){const l=n*s,u=c*a,_=Math.floor(l),d=Math.floor(u),h=4*(c*o+n);for(let o=0;o<4;o++){let n=0,s=0;for(let i=-2;i<=3;i++)for(let a=-2;a<=3;a++){const c=_+a,h=d+i,p=getPixelValue(e,t,r,c,h,o),f=lanczosKernel(l-c)*lanczosKernel(u-h);n+=p*f,s+=f}i[h+o]=Math.round(clamp(n/s,0,255))}}return i}var Ze=(e=>(e.LEFT_TOP="left_top",e.TOP="top",e.RIGHT_TOP="right_top",e.LEFT="left",e.CENTER="center",e.RIGHT="right",e.LEFT_BOTTOM="left_bottom",e.BOTTOM="bottom",e.RIGHT_BOTTOM="right_bottom",e))(Ze||{});async function actions(e,t){const{type:r}=t,o=be.withTag("Incoming").withTag("action");switch(e.debug&&o.withTag(r).start(t),r){case ne.INIT:return async function initMessage(e,t){return e.debug=t.payload.debug,await __wbg_init(),{type:ne.INIT_SUCCESS}}(e,t);case ne.ADD_RENDER_WORKER_PORT:return function addDisplayWorkerPort(e,t){const r=t.payload;return r.port&&(e.displayWorkerPorts.push(r.port),e.debug&&be.withTag("action").success("Added zoom worker port. Total ports:",e.displayWorkerPorts.length),e.setupDisplays()),{type:ne.ADD_RENDER_WORKER_PORT_SUCCESS}}(e,t);case ne.SET_SELECT_OPTIONS:return async function setSelectOptions(e,t){return await e.setSelectOptions(t.payload),{type:ne.SET_SELECT_OPTIONS_SUCCESS}}(e,t);case ne.USE_TOOL:return async function useTool(e,t){const{payload:r}=t,{tool:o,meta:n,toolOptions:i}=r;r.toolOptions.stackable&&e.actionStack.active&&e.addActionStack(o,r);const s=await executeAction(e,{tool:o,meta:n,toolOptions:i});return e.updateDisplays(),s||{type:ne.USE_TOOL_SUCCESS}}(e,t);case ne.LOAD_IMAGE:return loadImage(e,t);case ne.STACK:return async function stack(e,t){switch(t.payload.action){case Ke.START:e.actionStack.start();break;case Ke.STOP:e.actionStack.stop();break;case Ke.FORWARD:await e.actionStack.forward();break;case Ke.BACKWARD:await e.actionStack.backward()}return{type:ne.STACK_SUCCESS}}(e,t);case ne.GET_DATA:return async function getData(e,t){const r=new Uint8ClampedArray(e.sharedBuffer.buffer);return[{type:ne.GET_DATA_SUCCESS,payload:{dimension:e.getDimension(),buffer:r}},[]]}(e);case ne.RESIZE:return async function resize(e,t){const{payload:r}=t,o=new SharedArrayBuffer(r.dimension.x*r.dimension.y*4),n=new Uint8ClampedArray(o),i={[Je.NEAREST_NEIGHBOR]:resizeImageNearestNeighbor,[Je.BILINEAR]:resizeImageBilinear,[Je.BICUBIC]:resizeImageBicubic,[Je.LANCZOS]:resizeImageLanczos},{x:s,y:a}=e.getDimension(),c=i[r.type](e.view,s,a,r.dimension.x,r.dimension.y);return n.set(c,0),e.setSharedBuffer(o,r.dimension),e.setupDisplays(),[{type:ne.RESIZE_CANVAS_SUCCESS,payload:{dimension:e.getDimension()}},[]]}(e,t);case ne.RESIZE_CANVAS:return async function resizeCanvas(e,t){const r=e.getDimension(),{payload:o}=t,n=new SharedArrayBuffer(o.dimension.x*o.dimension.y*4),i=new Uint8ClampedArray(n);let s=point(0,0);[Ze.RIGHT,Ze.RIGHT_TOP,Ze.RIGHT_BOTTOM].includes(o.origin)&&(s.x=o.dimension.x-r.x),[Ze.BOTTOM,Ze.LEFT_BOTTOM,Ze.RIGHT_BOTTOM].includes(o.origin)&&(s.y=o.dimension.y-r.y),[Ze.CENTER].includes(o.origin)&&(s=point(()=>(o.dimension-r)/2));const a=point(()=>Math.floor(s)),c=point(()=>Math.min(a,0)),l=point(()=>Math.max(a,0)),u=Math.min(e.view.length/(4*r.x),o.dimension.y);for(let _=0;_<u;_++){const t=_*r.x*4+Math.abs(c.y)*r.x*4,n=new Uint8ClampedArray(4*o.dimension.x);console.log("y",JSON.stringify({y_:t,offsetN:c,offsetP:l,offset:s,x:[t,t+4*Math.min(r.x,o.dimension.x)]},null,2)),n.set(e.view.subarray(t+Math.abs(4*c.x),t+4*Math.min(r.x,o.dimension.x)+Math.abs(4*c.x)),4*l.x),i.set(n,_*o.dimension.x*4+l.y*o.dimension.x*4)}return e.setSharedBuffer(n,o.dimension),e.setupDisplays(),[{type:ne.RESIZE_CANVAS_SUCCESS,payload:{dimension:e.getDimension()}},[]]}(e,t);case ne.GET_COLORS:return async function getColors(e,t){const r=e.view,o=new Set;for(let n=0;n<r.length;n+=4){const e=new oe(r[n],r[n+1],r[n+2],r[n+3]);o.add(e.toHex())}return[{type:ne.GET_DATA_SUCCESS,payload:{colors:Array.from(o).map(e=>oe.fromHex(e))}},[]]}(e);default:e.debug&&o.warn("Unknown message type from Creator Thread:",r)}}const Qe={aap_64:new Palette({locked:!0,id:"aap64-palette",name:"AAP-64",description:"A large, versatile palette with 64 colors that provides a wide range of tones for almost any type of scene or object. Ideal if you want a richer and more detailed color scheme without being overwhelmed.",colors:[{id:"aap64-c0",name:"Darkest Grey",color:"#161320"},{id:"aap64-c1",name:"Dark Grey",color:"#2a2139"},{id:"aap64-c2",name:"Medium Dark Grey",color:"#473b4f"},{id:"aap64-c3",name:"Medium Grey",color:"#63586f"},{id:"aap64-c4",name:"Light Grey",color:"#817b96"},{id:"aap64-c5",name:"Pale Grey",color:"#a8a8bb"},{id:"aap64-c6",name:"White",color:"#d0d2dd"},{id:"aap64-c7",name:"Bright White",color:"#f8f7f9"},{id:"aap64-c8",name:"Deep Red",color:"#330000"},{id:"aap64-c9",name:"Dark Red",color:"#680000"},{id:"aap64-c10",name:"Red",color:"#a20000"},{id:"aap64-c11",name:"Bright Red",color:"#d70000"},{id:"aap64-c12",name:"Light Red",color:"#ff3838"},{id:"aap64-c13",name:"Pink",color:"#ff7575"},{id:"aap64-c14",name:"Pale Pink",color:"#ffb2b2"},{id:"aap64-c15",name:"Lightest Pink",color:"#ffecec"},{id:"aap64-c16",name:"Dark Brown",color:"#3f1a00"},{id:"aap64-c17",name:"Brown",color:"#7e3300"},{id:"aap64-c18",name:"Orange Brown",color:"#bb4e00"},{id:"aap64-c19",name:"Dark Orange",color:"#ed6900"},{id:"aap64-c20",name:"Orange",color:"#ff9e3b"},{id:"aap64-c21",name:"Bright Orange",color:"#ffba78"},{id:"aap64-c22",name:"Light Orange",color:"#ffd7b5"},{id:"aap64-c23",name:"Pale Orange",color:"#ffefe6"},{id:"aap64-c24",name:"Dark Yellow",color:"#3f3000"},{id:"aap64-c25",name:"Yellow Brown",color:"#7e6000"},{id:"aap64-c26",name:"Mustard Yellow",color:"#bbaa00"},{id:"aap64-c27",name:"Bright Yellow",color:"#edde00"},{id:"aap64-c28",name:"Yellow",color:"#fff04d"},{id:"aap64-c29",name:"Light Yellow",color:"#fff68b"},{id:"aap64-c30",name:"Pale Yellow",color:"#fffcc8"},{id:"aap64-c31",name:"Lightest Yellow",color:"#fffee0"},{id:"aap64-c32",name:"Dark Green Blue",color:"#002a20"},{id:"aap64-c33",name:"Green Blue",color:"#005540"},{id:"aap64-c34",name:"Teal",color:"#008060"},{id:"aap64-c35",name:"Bright Teal",color:"#00aa80"},{id:"aap64-c36",name:"Cyan",color:"#00ffc0"},{id:"aap64-c37",name:"Light Cyan",color:"#4dffdb"},{id:"aap64-c38",name:"Pale Cyan",color:"#80ffe6"},{id:"aap64-c39",name:"Lightest Cyan",color:"#e6fff4"},{id:"aap64-c40",name:"Dark Blue Green",color:"#001a2f"},{id:"aap64-c41",name:"Blue Green",color:"#00335f"},{id:"aap64-c42",name:"Medium Blue Green",color:"#004d8e"},{id:"aap64-c43",name:"Bright Blue Green",color:"#0066bd"},{id:"aap64-c44",name:"Blue",color:"#0088ff"},{id:"aap64-c45",name:"Light Blue",color:"#4daaff"},{id:"aap64-c46",name:"Pale Blue",color:"#80ccff"},{id:"aap64-c47",name:"Lightest Blue",color:"#e6f4ff"},{id:"aap64-c48",name:"Dark Violet",color:"#0a0026"},{id:"aap64-c49",name:"Violet",color:"#14004c"},{id:"aap64-c50",name:"Medium Violet",color:"#230075"},{id:"aap64-c51",name:"Bright Violet",color:"#330099"},{id:"aap64-c52",name:"Purple",color:"#5e00ff"},{id:"aap64-c53",name:"Light Purple",color:"#8f4dff"},{id:"aap64-c54",name:"Pale Purple",color:"#bf80ff"},{id:"aap64-c55",name:"Lightest Purple",color:"#f2e6ff"},{id:"aap64-c56",name:"Dark Magenta",color:"#260026"},{id:"aap64-c57",name:"Magenta",color:"#4c004c"},{id:"aap64-c58",name:"Medium Magenta",color:"#750075"},{id:"aap64-c59",name:"Bright Magenta",color:"#990099"},{id:"aap64-c60",name:"Fuchsia",color:"#ff00ff"},{id:"aap64-c61",name:"Light Fuchsia",color:"#ff4dff"},{id:"aap64-c62",name:"Pale Fuchsia",color:"#ff80ff"},{id:"aap64-c63",name:"Lightest Fuchsia",color:"#ffe6ff"}]}),apple_2:new Palette({locked:!0,name:"Apple II High-Res Palette",description:"The characteristic colors of the Apple II High-Resolution graphics mode.",colors:[{id:"apple2-0",color:"#000000"},{id:"apple2-1",color:"#FFFFFF"},{id:"apple2-2",color:"#00FF00"},{id:"apple2-3",color:"#FF00FF"},{id:"apple2-4",color:"#FFA500"},{id:"apple2-5",color:"#0000FF"}]}),arne_16:new Palette({locked:!0,id:"arne-16",name:"Arne16",description:"Another well-known 16-color palette by Arne Niklas Jansson (Skeddles), often with a slightly cooler color scheme than DB16, but also very versatile and balanced for various pixel art projects.",colors:[{id:"arne16-c0",name:"Deep Blue",color:"#1a1c2c"},{id:"arne16-c1",name:"Dark Purple",color:"#43283c"},{id:"arne16-c2",name:"Dark Green",color:"#4a444a"},{id:"arne16-c3",name:"Dark Cyan",color:"#633c58"},{id:"arne16-c4",name:"Dark Brown",color:"#76425a"},{id:"arne16-c5",name:"Forest Green",color:"#945c56"},{id:"arne16-c6",name:"Gray Blue",color:"#bc4a4a"},{id:"arne16-c7",name:"Light Brown",color:"#de7b72"},{id:"arne16-c8",name:"Orange Red",color:"#efb28e"},{id:"arne16-c9",name:"Pale Yellow",color:"#fecf65"},{id:"arne16-c10",name:"Bright Yellow",color:"#fff79c"},{id:"arne16-c11",name:"Light Green",color:"#227772"},{id:"arne16-c12",name:"Medium Green",color:"#28a773"},{id:"arne16-c13",name:"Teal",color:"#54d3ed"},{id:"arne16-c14",name:"Sky Blue",color:"#80f0c0"},{id:"arne16-c15",name:"White",color:"#b8f7ed"}]}),bob_ross:new Palette({locked:!0,id:"bob-ross-palette",name:"Bob Ross Inspired",description:"A color palette inspired by the typical colors Bob Ross used in his 'The Joy of Painting' shows. Ideal for serene nature landscapes with mountains, trees, and water.",colors:[{id:"br-c0",name:"Midnight Black (Alizarin Crimson/Prussian Blue-like)",color:"#140c1c"},{id:"br-c1",name:"Dark Umber (Dark Sienna/Van Dyke Brown-like)",color:"#2a1e1b"},{id:"br-c2",name:"Forest Green (Dark Phthalo Green-like)",color:"#1f3a2c"},{id:"br-c3",name:"Mountain Blue (Prussian Blue-like)",color:"#2c2a3f"},{id:"br-c4",name:"Deep Red (Alizarin Crimson-like)",color:"#5b1e2c"},{id:"br-c5",name:"Warm Brown (Burnt Umber-like)",color:"#6d372c"},{id:"br-c6",name:"Moss Green (Sap Green-like)",color:"#4a6d38"},{id:"br-c7",name:"Sky Blue (Phthalo Blue-like)",color:"#4b6c8d"},{id:"br-c8",name:"Bright Red (Cadmium Red Light-like)",color:"#9b3c4f"},{id:"br-c9",name:"Golden Yellow (Cadmium Yellow-like)",color:"#e0a656"},{id:"br-c10",name:"Bright Green (Bright Sap Green-like)",color:"#76c04f"},{id:"br-c11",name:"Soft Blue (Light Phthalo Blue-like)",color:"#81a2cc"},{id:"br-c12",name:"Cream (Titanium White with a hint of color)",color:"#d6cec2"},{id:"br-c13",name:"Off-White (Liquid White-like)",color:"#f0f0e8"},{id:"br-c14",name:"Cloud Grey (Grey Mix-like)",color:"#b0b0b0"},{id:"br-c15",name:"Pure White (Titanium White-like)",color:"#ffffff"}]}),bubblegum_16:new Palette({locked:!0,id:"bubblegum-16",name:"Bubblegum 16",description:"A vibrant and cheerful 16-color palette, well-suited for bright, friendly, or 'cute' aesthetics. Ideal for characters, UI elements, or colorful environments.",colors:[{id:"bubblegum-c0",name:"Dark Purple",color:"#2e203c"},{id:"bubblegum-c1",name:"Dark Blue",color:"#4b3064"},{id:"bubblegum-c2",name:"Medium Blue",color:"#6d5494"},{id:"bubblegum-c3",name:"Light Blue",color:"#8a7ba7"},{id:"bubblegum-c4",name:"Dark Pink",color:"#a75276"},{id:"bubblegum-c5",name:"Pink",color:"#d284ae"},{id:"bubblegum-c6",name:"Pale Pink",color:"#ffadd8"},{id:"bubblegum-c7",name:"Light Yellow",color:"#fffefb"},{id:"bubblegum-c8",name:"Dark Green",color:"#366e44"},{id:"bubblegum-c9",name:"Green",color:"#5cb064"},{id:"bubblegum-c10",name:"Lime Green",color:"#94d682"},{id:"bubblegum-c11",name:"Yellow Green",color:"#d2f7ae"},{id:"bubblegum-c12",name:"Orange",color:"#de7061"},{id:"bubblegum-c13",name:"Red Orange",color:"#ff9e7f"},{id:"bubblegum-c14",name:"Light Orange",color:"#ffbe9c"},{id:"bubblegum-c15",name:"Cream",color:"#ffe8c6"}]}),c64:new Palette({locked:!0,name:"Commodore 64 (C64) Palette",description:"The characteristic 16 colors of the C64, generated by the VIC-II chip.",colors:[{id:"c64-0",color:"#000000"},{id:"c64-1",color:"#FFFFFF"},{id:"c64-2",color:"#68372B"},{id:"c64-3",color:"#70A4B2"},{id:"c64-4",color:"#6F3D86"},{id:"c64-5",color:"#588D43"},{id:"c64-6",color:"#352879"},{id:"c64-7",color:"#B8C76F"},{id:"c64-8",color:"#6F4F25"},{id:"c64-9",color:"#433900"},{id:"c64-10",color:"#9A6759"},{id:"c64-11",color:"#444444"},{id:"c64-12",color:"#6F6F6F"},{id:"c64-13",color:"#9AD284"},{id:"c64-14",color:"#6565EB"},{id:"c64-15",color:"#787878"}]}),cga_0:new Palette({locked:!0,name:"CGA 0 (High Intensity)",description:"The most well-known 4-color palette of the IBM PC Color Graphics Adapter.",colors:[{id:"cga-p0-0",color:"#000000"},{id:"cga-p0-1",color:"#00AA00"},{id:"cga-p0-2",color:"#AA0000"},{id:"cga-p0-3",color:"#AA5500"}]}),cga_1:new Palette({locked:!0,name:"CGA 1 (High Intensity)",description:"Another iconic 4-color palette of the CGA, often responsible for the cyan-magenta look.",colors:[{id:"cga-p1-0",color:"#000000"},{id:"cga-p1-1",color:"#00AAAA"},{id:"cga-p1-2",color:"#AA00AA"},{id:"cga-p1-3",color:"#AAAAAA"}]}),cga_2:new Palette({locked:!0,id:"cga-palette",name:"CGA Palette (Mode 4 High Intensity)",description:"A historical 16-color palette inspired by the IBM CGA graphics standard. Known for its bright, sometimes unsaturated colors and distinctive retro computer look. Challenging but very characteristic.",colors:[{id:"cga-c0",name:"Black",color:"#000000"},{id:"cga-c1",name:"Dark Blue",color:"#0000aa"},{id:"cga-c2",name:"Dark Green",color:"#00aa00"},{id:"cga-c3",name:"Dark Cyan",color:"#00aaaa"},{id:"cga-c4",name:"Dark Red",color:"#aa0000"},{id:"cga-c5",name:"Dark Magenta",color:"#aa00aa"},{id:"cga-c6",name:"Brown",color:"#aa5500"},{id:"cga-c7",name:"Light Gray",color:"#aaaaaa"},{id:"cga-c8",name:"Dark Gray",color:"#555555"},{id:"cga-c9",name:"Blue",color:"#5555ff"},{id:"cga-c10",name:"Green",color:"#55ff55"},{id:"cga-c11",name:"Cyan",color:"#55ffff"},{id:"cga-c12",name:"Red",color:"#ff5555"},{id:"cga-c13",name:"Magenta",color:"#ff55ff"},{id:"cga-c14",name:"Yellow",color:"#ffff55"},{id:"cga-c15",name:"White",color:"#ffffff"}]}),db_16:new Palette({locked:!0,id:"db16-palette",name:"Dawnbringer 16 (DB16)",description:"A versatile and balanced palette by Arne Niklas Jansson, ideal for various moods and scenarios. Known for its earthy and muted tones.",colors:[{id:"db16-c0",name:"Dark Plum",color:"#140c1c"},{id:"db16-c1",name:"Dark Blue",color:"#442434"},{id:"db16-c2",name:"Dark Green",color:"#30346d"},{id:"db16-c3",name:"Brown",color:"#4e4a68"},{id:"db16-c4",name:"Dark Red",color:"#69512c"},{id:"db16-c5",name:"Dark Orange",color:"#636357"},{id:"db16-c6",name:"Gray Blue",color:"#6f6451"},{id:"db16-c7",name:"Light Brown",color:"#76864d"},{id:"db16-c8",name:"Red Orange",color:"#816d56"},{id:"db16-c9",name:"Light Green",color:"#7b707c"},{id:"db16-c10",name:"Light Blue",color:"#80a254"},{id:"db16-c11",name:"Sand",color:"#a8b97d"},{id:"db16-c12",name:"Light Yellow",color:"#a2d28f"},{id:"db16-c13",name:"Pale Yellow",color:"#c6f5d0"},{id:"db16-c14",name:"Sky Blue",color:"#e0f6ee"},{id:"db16-c15",name:"White",color:"#f8f8f8"}]}),edg_20:new Palette({locked:!0,id:"edg20-palette",name:"EDG20",description:"An Endesga-created 20-color palette. It offers a good selection of rich colors with various ramps for lights and shadows, ideal for more detailed scenes and illustrations.",colors:[{id:"edg20-c0",name:"Dark Grey",color:"#181425"},{id:"edg20-c1",name:"Deep Violet",color:"#241d3b"},{id:"edg20-c2",name:"Dark Violet",color:"#382552"},{id:"edg20-c3",name:"Medium Violet",color:"#5b3164"},{id:"edg20-c4",name:"Bright Violet",color:"#81396f"},{id:"edg20-c5",name:"Dark Blue",color:"#114c62"},{id:"edg20-c6",name:"Medium Blue",color:"#316f7c"},{id:"edg20-c7",name:"Light Blue",color:"#5e9a93"},{id:"edg20-c8",name:"Cyan",color:"#85c596"},{id:"edg20-c9",name:"Light Green",color:"#a8eb9b"},{id:"edg20-c10",name:"Dark Green",color:"#2c726f"},{id:"edg20-c11",name:"Olive Green",color:"#58916d"},{id:"edg20-c12",name:"Yellow Green",color:"#90c57c"},{id:"edg20-c13",name:"Dark Brown",color:"#4a2a4f"},{id:"edg20-c14",name:"Brown",color:"#793c66"},{id:"edg20-c15",name:"Light Brown",color:"#ae4f6b"},{id:"edg20-c16",name:"Dark Red",color:"#dd6e6c"},{id:"edg20-c17",name:"Red",color:"#ff9a8a"},{id:"edg20-c18",name:"Orange",color:"#ffca9a"},{id:"edg20-c19",name:"White",color:"#fff5ea"}]}),game_boy:new Palette({locked:!0,id:"gameboy-palette",name:"Game Boy (Original)",description:"The iconic 4-color palette of the classic Game Boy. Perfect for an authentic retro monochrome look with greenish tones.",colors:[{id:"gb-c0",name:"Darkest Green",color:"#0f380f"},{id:"gb-c1",name:"Dark Green",color:"#306230"},{id:"gb-c2",name:"Light Green",color:"#8bed81"},{id:"gb-c3",name:"Pale Green",color:"#9bbc0f"}]}),lospec_500:new Palette({locked:!0,id:"lospec500-palette",name:"LoSpec500",description:"A compact 5-color palette created by LoSpec. Perfect for a very limited, highly stylized look, ideal for small icons, simple sprites, or monochrome game concepts.",colors:[{id:"lospec500-c0",name:"Dark Grey",color:"#242424"},{id:"lospec500-c1",name:"Medium Grey",color:"#5b5b5b"},{id:"lospec500-c2",name:"Light Grey",color:"#939393"},{id:"lospec500-c3",name:"Lighter Grey",color:"#c4c4c4"},{id:"lospec500-c4",name:"White",color:"#fcfcfc"}]}),nes:new Palette({locked:!0,name:"NES",description:"A selection of the fixed colors from the Nintendo Entertainment System.",colors:[{id:"nes-0",color:"#6F6F6F"},{id:"nes-1",color:"#000080"},{id:"nes-2",color:"#20008E"},{id:"nes-3",color:"#400078"},{id:"nes-4",color:"#800000"},{id:"nes-5",color:"#A00000"},{id:"nes-6",color:"#881400"},{id:"nes-7",color:"#604000"},{id:"nes-8",color:"#206000"},{id:"nes-9",color:"#007400"},{id:"nes-10",color:"#006C20"},{id:"nes-11",color:"#006464"},{id:"nes-12",color:"#004080"},{id:"nes-13",color:"#000000"},{id:"nes-14",color:"#000000"},{id:"nes-15",color:"#000000"}]}),pico_8:new Palette({locked:!0,id:"pico8-palette",name:"PICO-8",description:"The classic 16-color palette of the PICO-8 Fantasy Console. Known for its vibrant and slightly 'retro' Lo-Fi look, ideal for stylized games.",colors:[{id:"pico8-c0",name:"Black",color:"#000000"},{id:"pico8-c1",name:"Dark Blue",color:"#1d2b53"},{id:"pico8-c2",name:"Dark Purple",color:"#7e2553"},{id:"pico8-c3",name:"Dark Green",color:"#008751"},{id:"pico8-c4",name:"Brown",color:"#ab5236"},{id:"pico8-c5",name:"Dark Gray",color:"#5f574f"},{id:"pico8-c6",name:"Light Gray",color:"#c2c3c7"},{id:"pico8-c7",name:"White",color:"#fff1e8"},{id:"pico8-c8",name:"Red",color:"#ff004d"},{id:"pico8-c9",name:"Orange",color:"#ffa300"},{id:"pico8-c10",name:"Yellow",color:"#ffec27"},{id:"pico8-c11",name:"Green",color:"#00e436"},{id:"pico8-c12",name:"Blue",color:"#29adff"},{id:"pico8-c13",name:"Indigo",color:"#83769c"},{id:"pico8-c14",name:"Pink",color:"#ff77a8"},{id:"pico8-c15",name:"Peach",color:"#ffccaa"}]}),win_256:new Palette({locked:!0,name:"Windows 256 Color",description:"A palette inspired by the classic Windows 256 color set, including VGA colors, web-safe colors, and grayscale.",colors:function generateWindows98_256ColorPalette(){const e=[];e.push([0,0,0],[128,0,0],[0,128,0],[128,128,0],[0,0,128],[128,0,128],[0,128,128],[192,192,192],[128,128,128],[255,0,0],[0,255,0],[255,255,0],[0,0,255],[255,0,255],[0,255,255],[255,255,255],[0,0,0,0],[0,0,0,0]);const t=[0,51,102,153,204,255];for(let r=0;r<6;r++)for(let o=0;o<6;o++)for(let n=0;n<6;n++){const i=t[r],s=t[o],a=t[n];e.push([i,s,a])}for(let r=0;r<24;r++){const t=8+10*r;e.push([t,t,t])}return e.map(e=>new oe(e[0],e[1],e[2]))}().map(e=>new PaletteColor({color:e}))}),zx_spectrum:new Palette({locked:!0,name:"ZX Spectrum Palette",description:"The 15 colors of the ZX Spectrum, including bright variants.",colors:[{id:"zx-0",color:"#000000"},{id:"zx-1",color:"#0000D7"},{id:"zx-2",color:"#D70000"},{id:"zx-3",color:"#D700D7"},{id:"zx-4",color:"#00D700"},{id:"zx-5",color:"#00D7D7"},{id:"zx-6",color:"#D7D700"},{id:"zx-7",color:"#D7D7D7"},{id:"zx-8",color:"#000000"},{id:"zx-9",color:"#0000FF"},{id:"zx-10",color:"#FF0000"},{id:"zx-11",color:"#FF00FF"},{id:"zx-12",color:"#00FF00"},{id:"zx-13",color:"#00FFFF"},{id:"zx-14",color:"#FFFF00"},{id:"zx-15",color:"#FFFFFF"}]})};function getDefaultPalette(){return function getPalette(e){return Qe[e]}("aap_64")}class BrushDescription{constructor(e={}){__publicField(this,"size"),__publicField(this,"primaryColor"),__publicField(this,"secondaryColor"),__publicField(this,"scale",1);const{size:t,primaryColor:r,secondaryColor:o}=e;this.size=void 0!==t?t:1,this.primaryColor=r||new oe(0,0,0),this.secondaryColor=o||new oe(255,255,255)}getSize(){return this.size}async setSize(e){this.size=e}getScaledSize(e=!1){const t=this.getSize();return e?t*this.scale:t}}class Circle extends BrushDescription{getScaledSize(e=!1){const t=this.getSize();return e?t*this.scale:t}}class Square extends BrushDescription{}class Dots extends BrushDescription{getScaledSize(e=!1){const t=2*(this.getSize()-1)+1;return e?t*this.scale:t}}let Xe,et=!0;const tt={debug:!1,displayWorkerPorts:[],sharedBuffer:void 0,tmpSharedBuffer:void 0,view:void 0,useOptions:{tool:function getDefaultToolSelect(){return{shapeStyle:ie.STROKED_FILLED,value:ae.NONE,segmentLength:1,gapLength:0,interpolateSegments:!1,airBrushStrength:50,airBrushWeight:1}}(),brush:function getDefaultBrushSelect(){return{type:se.CIRCLE,size:1}}(),color:function getDefaultColorSelect(){return{primaryColor:new PaletteColor({color:new oe(0,0,0)}),secondaryColor:new PaletteColor({color:new oe(255,0,0)}),palette:getDefaultPalette()}}()},brushDescription:void 0,actionStack:new class Stacker{constructor({maxStackSize:e,onForward:t,onBackward:r,onComplete:o,onLimitReached:n}){__publicField(this,"maxStackSize",20),__publicField(this,"stack",[]),__publicField(this,"subStack"),__publicField(this,"onAdd"),__publicField(this,"onForward"),__publicField(this,"onBackward"),__publicField(this,"onComplete"),__publicField(this,"onLimitReached"),__publicField(this,"index",-1),e&&(this.maxStackSize=e),this.onForward=t,this.onBackward=r,this.onComplete=o,this.onLimitReached=n}start(){this.index<this.stack.length-1&&(this.stack=this.getStackAtIndex(this.index)),this.subStack=[]}async add(e){var t;if(!this.subStack)throw new Error("Stack not started. Call start() before adding items.");e=await(null==(t=this.onAdd)?void 0:t.call(this,e))||e,this.subStack.push(e)}stop(){var e;if(this.subStack&&(this.stack.push(this.subStack),this.subStack=void 0),this.stack.length>this.maxStackSize){const e=this.stack.shift();this.onLimitReached&&e&&this.onLimitReached(e)}this.index=this.stack.length-1,null==(e=this.onComplete)||e.call(this)}async forward(){var e;if(this.index<this.stack.length-1){const t=this.index;this.index++,await(null==(e=this.onForward)?void 0:e.call(this,this,this.index,t))}}async backward(){var e;if(this.index>-1){const t=this.index;this.index--,await(null==(e=this.onBackward)?void 0:e.call(this,this,this.index,t))}}getStackAtIndex(e){return this.stack.slice(0,Math.max(e+1,0))}getStack(){return this.stack}get active(){return void 0!==this.subStack}get length(){return this.stack.length}get subStackLength(){return this.stack.reduce((e,t)=>e+t.length,0)}clear(){this.stack=[],this.subStack=void 0,this.index=-1}}({maxStackSize:1/0,onForward:async(e,t)=>{var r;Xe=tt.useOptions,null==(r=tt.view)||r.set(new Uint8ClampedArray(tt.tmpSharedBuffer.buffer));for(const{payload:o,selectOptions:n}of e.getStackAtIndex(t).flat())tt.setBrush(n.brush,n.color),await executeAction({...tt,useOptions:n},o);tt.updateClient(),tt.updateDisplays(),Xe&&tt.setSelectOptions(Xe)},onBackward:async(e,t)=>{var r;Xe=tt.useOptions,null==(r=tt.view)||r.set(new Uint8ClampedArray(tt.tmpSharedBuffer.buffer));for(const{payload:o,selectOptions:n}of e.getStackAtIndex(t).flat())tt.setBrush(n.brush,n.color),await executeAction({...tt,useOptions:n},o);tt.updateClient(),tt.updateDisplays(),Xe&&tt.setSelectOptions(Xe)},onComplete:async()=>{tt.updateClient()},onLimitReached:e=>{var t,r;if(null==(t=tt.tmpSharedBuffer)?void 0:t.buffer){const t=null==(r=tt.tmpSharedBuffer)?void 0:r.buffer,o=new Uint8Array(t);Xe=tt.useOptions,e.forEach(({payload:e,selectOptions:t})=>{const{tool:r,meta:n,toolOptions:i}=e;tt.setBrush(t.brush,t.color),executeAction({...tt,useOptions:t,view:o},{tool:r,meta:n,toolOptions:i})}),Xe&&tt.setSelectOptions(Xe)}}}),async addActionStack(e,t){var r;await tt.actionStack.add({name:e,payload:t,selectOptions:(r=tt.useOptions,{tool:{...r.tool},brush:{...r.brush},color:{primaryColor:r.color.primaryColor.clone(),secondaryColor:r.color.secondaryColor.clone(),palette:r.color.palette.clone()}})})},setBrush(e,t){const r=new(function getBrushData(e){switch(e){case se.CIRCLE:return Circle;case se.SQUARE:return Square;case se.DOTS:return Dots;default:throw new Error(`Unknown brush type: ${e}`)}}(e.type))({size:e.size||1,primaryColor:t.primaryColor.color,secondaryColor:t.secondaryColor.color}),o=r.getScaledSize(!0);let n;n=r instanceof Square?Ae.Square:r instanceof Dots?Ae.Dots:Ae.Round,et?(!function initBrush(e,t,r,o){_assertClass(r,Color);var n=r.__destroy_into_raw();_assertClass(o,Color);var i=o.__destroy_into_raw();const s=we.initBrush(e,t,n,i);if(s[1])throw takeFromExternrefTable0(s[0])}(n,o,toColor(r.primaryColor),toColor(r.secondaryColor)),et=!1):function setBrushSolid(e,t,r,o){_assertClass(r,Color);var n=r.__destroy_into_raw();_assertClass(o,Color);var i=o.__destroy_into_raw();const s=we.setBrushSolid(e,t,n,i);if(s[1])throw takeFromExternrefTable0(s[0])}(n,o,toColor(r.primaryColor),toColor(r.secondaryColor)),tt.brushDescription=r},setSelectOptions({tool:e,brush:t,color:r}){if(t){const e=r||tt.useOptions.color;tt.setBrush(t,e)}e&&(tt.useOptions.tool=e),t&&(tt.useOptions.brush=t),r&&(tt.useOptions.color=r)},setSharedBuffer(e,t){tt.sharedBuffer={buffer:e,dimension:t},tt.tmpSharedBuffer={buffer:e.slice(0),dimension:t},tt.view=new Uint8Array(e),tt.viewTest=new Uint8Array(e)},getColorByPosition:e=>{const t=getPixels(tt.view,toDimension(tt.getDimension()),toPoint(e),toDimension(ipoint(1,1)));if(t.length<4)throw new Error(`Data length is too short: ${t.length}. Expected at least 4 bytes for RGBA.`);return new oe(t[0],t[1],t[2],t[3])},getDimension(){if(tt.sharedBuffer)return ipoint(tt.sharedBuffer.dimension.x,tt.sharedBuffer.dimension.y);throw new Error("Shared buffer is not set.")},getTargetPosition(e,{dimension:t,displayPosition:r,zoomLevel:o},n){const i=tt.getDimension();let s=ipoint(()=>r*i+i/2+e/o*t/2);return s=ipoint(()=>Math[(null==n?void 0:n.round)?"round":"floor"](s)),s},getTargetDimension:(e,{dimension:t,zoomLevel:r})=>ipoint(()=>Math.round(e/r*t)),getColorAtPosition(e){if(!tt.view||!tt.sharedBuffer)throw new Error("No image data available.");const t=Math.floor(e.x),r=4*(Math.floor(e.y)*tt.sharedBuffer.dimension.x+t),o=tt.view;if(void 0!==o[r])return new oe(o[r],o[r+1],o[r+2],o[r+3])},isIntersect(e){const t=tt.getDimension();return e.x>=0&&e.y>=0&&e.x<=t.x-1&&e.y<=t.y-1},action:(e,t)=>action(self,e,t),actionDisplay(){tt.displayWorkerPorts.forEach(e=>(t,r)=>action(e,t,r))},setupDisplays:()=>async function sendSetupMessage(e,t){const r={id:crypto.randomUUID(),data:{type:ne.UPDATE_BUFFER,payload:{sharedBuffer:t}}};await Promise.all(e.map(e=>action(e,r)))}(tt.displayWorkerPorts,tt.sharedBuffer),updateDisplays:()=>async function sendUpdateMessage(e){const t={id:crypto.randomUUID(),data:{type:ne.UPDATE_CANVAS}};await Promise.all(e.map(e=>action(e,t)))}(tt.displayWorkerPorts),updateClient(){const e={id:crypto.randomUUID(),data:{type:ne.SYNC_STATE,payload:{stackMaxSize:tt.actionStack.maxStackSize,stackCount:tt.actionStack.length,stackIndex:tt.actionStack.index}}};tt.action(e)}};async function action(e,t,r){const o=await function lastValueFrom(e,t){return new Promise(function(t,r){var o,n=!1;e.subscribe({next:function(e){o=e,n=!0},error:r,complete:function(){n?t(o):r(new _)}})})}(of(t).pipe(function serializeWorkerPostMessage(){return e=>e.pipe(serialize(le))}()));e.postMessage(o,r||[])}(function fromEvent(e,t,r,o){if(isFunction(r)&&(o=r,r=void 0),o)return fromEvent(e,t,r).pipe(mapOneOrManyArgs(o));var n=__read(function isEventTarget(e){return isFunction(e.addEventListener)&&isFunction(e.removeEventListener)}(e)?p.map(function(o){return function(n){return e[o](t,n,r)}}):function isNodeStyleEventEmitter(e){return isFunction(e.addListener)&&isFunction(e.removeListener)}(e)?h.map(toCommonHandlerRegistry(e,t)):function isJQueryStyleEventEmitter(e){return isFunction(e.on)&&isFunction(e.off)}(e)?f.map(toCommonHandlerRegistry(e,t)):[],2),i=n[0],s=n[1];if(!i&&isArrayLike(e))return mergeMap(function(e){return fromEvent(e,t,r)})(innerFrom(e));if(!i)throw new TypeError("Invalid event target");return new c(function(e){var handler=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.next(1<t.length?t:t[0])};return i(handler),function(){return s(handler)}})})(self,"message").pipe(map(e=>e.data),function deserializeWorkerPostMessage(){return e=>e.pipe(deserialize(ue))}()).subscribe(async({id:e,data:t,transfer:r})=>{try{let o=await actions(tt,t);Array.isArray(o)&&(r=o[1],o=o[0]),o&&tt.action({id:e,data:o},r)}catch(o){be.error("Error processing action:",o)}})}();
