var we=Object.defineProperty;var ge=(u,n,o)=>n in u?we(u,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[n]=o;var w=(u,n,o)=>ge(u,typeof n!="symbol"?n+"":n,o);import{P as pe,D as fe,a as be}from"./CHpeLE9u.js";import{C}from"./BJmh0rUk.js";import{i as t,p as Ee}from"./CpIyErmU.js";import{r as Se,k as Ie,I as Z,l as Ce}from"./D-Cgqglr.js";import{d as J}from"./On0xenC3.js";import{n as _e,d as xe}from"./CZZPvNTk.js";import{u as Te,S as ie}from"./DOMGF9Hs.js";import{S as ze}from"./6C4StZv5.js";import{f as Oe}from"./DI3A0fxi.js";import{d as de,k as m,r as S,L as We,a0 as L,o as ve,W as he,F as te,z as k,R as le,P as Me,D as Pe,A as D,a9 as Fe,_ as ye,a7 as j,O as Re,a1 as ue,y as ce,X as Ne,Y as Ae,Z as Be,$ as Le,G as ke}from"./CotJlvW-.js";import{c as me}from"./Br_8hjjw.js";import{g as De,d as He,A as ee}from"./Bu9-HbQ4.js";import{C as Ve}from"./BII7ONQG.js";import{C as P,a as $e,W as Ge,b as Ue,P as Ye}from"./BflcHXSR.js";const gt=2e3;function bt(){return{[C.SCREEN_1084_FRAME]:!0,[C.SCREEN_REAL_LOOK]:!0,[C.SCREEN_SCAN_LINES]:!0,[C.SCREEN_ACTIVE_ANIMATION]:!0,[C.BOOT_WITH_SEQUENCE]:!0,[C.BOOT_WITH_WEBDOS]:!0,[C.THEME]:pe[fe],[C.FILE_EXTENSION_ASSIGNMENT]:[["md","DF0:DocumentReader.app"],["bas","DF1:WebBasic.app"],["basic","DF1:WebBasic.app"]],[C.SCREEN_CONFIG]:{contrast:.5,brightness:.5,color:.5,sharpness:0,horizontalCentering:.5,soundVolume:.5}}}const Et="web_workbench_CONFIG";class qe{constructor({name:n,core:o,config:s={},commands:v,contextMenu:h}){w(this,"config");w(this,"commands");w(this,"name");w(this,"core");w(this,"contextMenu");this.name=n||"Module",this.core=o,this.config=s,this.commands=v,this.contextMenu=h}beforeSetup(){var o,s;const n=this.core;n.config.setDefaults(this.config),typeof this.commands=="function"&&(this.commands=De(this.commands({core:n,module:this})),me.add(this.commands)),typeof this.contextMenu=="function"&&(this.contextMenu=new Ve(this.contextMenu,{core:n,module:this}),(s=(o=this.core.modules.windows)==null?void 0:o.contextMenu)==null||s.addDefaultItems(this.contextMenu))}setup(){this.log(this.name)}destroy(){Array.isArray(this.commands)&&me.remove(this.commands)}log(n){this.core.logger.add(n,{namespace:this.name})}}const Xe=["innerHTML"],je=de({__name:"Item",props:{parentLayout:{},clampGlobal:{type:Boolean},container:{type:Boolean},item:{},scrollOffset:{},wrapper:{}},emits:["click"],setup(u,{emit:n}){var oe,ne;const o=t(0,0),s=u,v=m(()=>{var i,p;const r=((i=y==null?void 0:y.symbols.get(g.value.symbol||ie.DEFAULT))==null?void 0:i.component)||((p=y==null?void 0:y.symbols.get(ie.DEFAULT))==null?void 0:p.component);return r?Fe(r):void 0}),{core:h}=Te(),z=n,H=S(s.wrapper.selectedItems),f=S(!1),T=S(null),l=S(!1),a=We({start:t(0,0),move:t(0,0),lastPosition:t(0,0),offset:t(0,0),scrollOffset:t(0,0)}),F=new ze,W=S(null),R=S(null),N=(oe=h.value)==null?void 0:oe.modules.screen,y=(ne=h.value)==null?void 0:ne.modules.symbols,V=m(()=>s.item.command),I=m(()=>s.item.id),g=m(()=>s.item.model),b=m(()=>s.item.layout),$=m(()=>g.value.url?"a":"button"),K=m(()=>g.value.url?{href:g.value.url,target:g.value.url?"_blank":null,title:g.value.title}:{}),G=m(()=>(N==null?void 0:N.contentLayout)||{position:t(0,0),size:t(0,0)}),M=m(()=>H.value.includes(I.value)),A=m(()=>({moving:l.value,selected:M.value||f.value,"symbol-used":g.value.used}));L(()=>g.value,()=>{Y()},{deep:!0}),ve(()=>{var r;R.value=(r=W.value)==null?void 0:r.parentElement,Y()}),he(()=>{F.unsubscribe(),s.wrapper.unselectItem(I.value)});function O(r){var i;(i=s.item)==null||i.setLayout(r)}let U;function Y(){O({size:t(200,200)}),window.cancelAnimationFrame(U),U=window.requestAnimationFrame(()=>{var i;const r=(i=W.value)==null?void 0:i.children[0];r&&r instanceof HTMLElement&&O({size:t(r.offsetWidth||0,r.offsetHeight||0)})})}function q(r){const{width:i,height:p,left:E,top:d}=r.getBoundingClientRect();return{position:t(E,d),size:t(i,p)}}let e=!1;function c(r){var i;if(!e){const p=I.value;if(g.value.url&&M.value||(r.preventDefault(),g.value.used))return!0;if(V.value&&M.value){const E=Se(V.value);if(E){const d={showCommand:!1,show:!0};return s.wrapper.unselectItem(p),g.value.used=!0,(i=h.value)==null?void 0:i.executeCommand(E,d).then(()=>g.value.used=!1)}}J.shiftActive?s.wrapper.isSelectedItem(p)?s.wrapper.unselectItem(p):s.wrapper.selectItem(p):(y&&y.getSelectedItems().length>0&&y.clearSelectedItems(),s.wrapper.selectItem(p)),z("click")}e=!1}function _(r){if(r=_e(r),e=!1,c(r)){e=!0;return}e=!0,X(t(r.x,r.y))}function x(){if(y){const r=y.getSelectedItems().filter(p=>p.id!==I.value),i=s.wrapper.get(I.value);i&&r.length>0&&i.fsItem instanceof Ie&&r.forEach(p=>s.wrapper.moveItemToItem(p.fsItem,i.fsItem))}}const B=m(()=>s.scrollOffset||o);function X(r){if(R.value){const i=q(R.value);a.lastPosition=t(b.value.position.x,b.value.position.y),a.scrollOffset=t(B.value.x,B.value.y),a.start=r,a.offset=t(()=>a.start-b.value.position),Q(r,i,!0),l.value=!0;let p=r;const E=J.pointerMove.subscribe(d=>{p=t(d.x,d.y),Q(t(d.x,d.y),i,!0)});F.add(J.pointerUp.pipe(Oe()).subscribe(()=>{if(E.unsubscribe(),y&&y.getSecondaryWrapper().id!==s.wrapper.id)return s.wrapper.moveItem(I.value,y.getSecondaryWrapper()).then(d=>{var re,ae;return d||O({position:t((re=a.lastPosition)==null?void 0:re.x,(ae=a.lastPosition)==null?void 0:ae.y)}),T.value=null,l.value=!1,d});if(l.value=!1,Q(p,i),!b.value.position.equals(t(()=>a.start-a.offset)))return s.wrapper.savePosition(I.value,b.value.position)}))}}function Q(r,i,p=!1){const E={min:t(0,0),max:t(()=>i.size-b.value.size)};a.move=t(()=>r-a.start);let d=t(()=>Math.round(a.start+a.move-a.offset));p?(E.min=i.position,E.max=t(()=>E.max+G.value.position),d=t(()=>Math.round(d+E.min)),s.clampGlobal?T.value=t(()=>Math.max(Math.min(d,G.value.position+s.wrapper.size-b.value.size),E.min)):T.value=d):(s.wrapper.root?O({position:t(()=>Math.max(Math.min(d,s.wrapper.size-b.value.size),0))}):O({position:t(()=>Math.max(d,0))}),T.value=null)}return(r,i)=>(k(),te(le($.value),Me(K.value,{ref_key:"rootEl",ref:W,"data-id":I.value,class:["wb-env-element-symbol-wrapper-item",A.value],style:[b.value.size.toCSSVars("item-size"),(T.value||b.value.position).toCSSVars("item-position")],"touch-action":"none",onFocus:i[0]||(i[0]=p=>f.value=!0),onBlur:i[1]||(i[1]=p=>f.value=!1),onClick:c,onPointerdown:_,onPointerup:x}),{default:Pe(()=>[D("div",null,[D("i",null,[(k(),te(le(v.value)))]),D("span",{class:"label",innerHTML:g.value.title},null,8,Xe)])]),_:1},16,["data-id","class","style"]))}}),Ke=ye(je,[["__scopeId","data-v-0eaeb899"]]),Qe=de({__name:"SymbolWrapper",props:{clampSymbols:{type:Boolean},wrapperId:{}},emits:["ready","refresh"],setup(u,{emit:n}){var q;const o=S(null),s=S(null),v=S(null),h=u,z=j("window",void 0),H=m(()=>!!z),f=j("parentLayout",m(()=>({position:t(0,0),size:t(window==null?void 0:window.innerWidth,window==null?void 0:window.innerHeight)}))),T=j("parentFocused",!1),l=j("core");if(!l)throw new Error("Core not found");const a=S((q=l==null?void 0:l.modules.symbols)==null?void 0:q.get(h.wrapperId))||S(new Z(l)),F=n,W=m(()=>a.value.items.value),R=S(a.value.selectedItems),N=Re(l.config.observable),y=m(()=>a.value.layout),V=m(()=>{var e;return{"parent-scrollable":H.value,active:(((e=l.modules.symbols)==null?void 0:e.primaryWrapper)||{}).id===a.value.id}}),I=m(()=>f!=null&&f.value&&"scrollOffset"in f.value?f==null?void 0:f.value.scrollOffset:t(0,0)),g=m(()=>{var c;const e=[(c=I.value)==null?void 0:c.toCSSVars("symbol-wrapper-scroll-offset")];return H.value?e.push(b.value.toCSSVars("symbol-wrapper-size")):e.push(y.value.size.toCSSVars("symbol-wrapper-size")),e}),b=m(()=>W.value.map(e=>({item:e,index:R.value.indexOf(e.id)+1})).sort((e,c)=>e.index>c.index?1:e.index<c.index?-1:0).reduce((e,{item:c})=>{const _=c.layout.position.x+c.layout.size.x,x=c.layout.position.y+c.layout.size.y;return e.x=e.x<_?_:e.x,e.y=e.y<x?x:e.y,e},Ee(0,0))),$=m(()=>N[Ce.SHOW_INVISIBLE_SYMBOLS]),K=m(()=>W.value.filter(O)),G=m(()=>{var e;return((e=f==null?void 0:f.value)==null?void 0:e.size)||t(0,0)});L(()=>T,e=>{M(e)}),L(()=>h.wrapperId,e=>{var c;(c=l.modules.symbols)==null||c.get(e),A()}),L(()=>G,()=>{A()}),L(()=>b,()=>{ue(()=>{F("refresh",{scroll:!0})})}),ve(()=>{ue(()=>{A(),M(T),F("ready")})}),he(()=>{var e,c,_,x,B,X;(e=l.modules.symbols)!=null&&e.getPrimaryWrapper()&&((c=l.modules.symbols)==null?void 0:c.getPrimaryWrapper().id)===a.value.id&&((_=l.modules.symbols)==null||_.setPrimaryWrapper(null)),(x=l.modules.symbols)!=null&&x.getSecondaryWrapper()&&((B=l.modules.symbols)==null?void 0:B.getSecondaryWrapper().id)===a.value.id&&((X=l.modules.symbols)==null||X.setSecondaryWrapper(null))});function M(e=!1){l&&l.modules.symbols&&(e?a.value instanceof Z&&l.modules.symbols.setPrimaryWrapper(a.value):l.modules.symbols.getPrimaryWrapper()&&l.modules.symbols.getPrimaryWrapper().id===a.value.id&&l.modules.symbols.setPrimaryWrapper(null))}function A(){if(o.value&&(f!=null&&f.value)){const{left:e,top:c}=o.value.getBoundingClientRect();a.value.setLayout({position:t(e,c),size:f.value.size}),a.value.setSize(t(o.value.offsetWidth,o.value.offsetHeight)),a.value.setParentSize(f.value.size)}}function O(e){return $.value||!$.value&&e.model.visible}function U(){var e;a.value instanceof Z&&((e=l==null?void 0:l.modules.symbols)==null||e.setSecondaryWrapper(a.value))}function Y(e){(e.target===s.value||e.target===v.value)&&a.value.clearSelectedItems()}return(e,c)=>(k(),ce("div",{ref_key:"rootEl",ref:o,class:Le(["wb-env-symbol-wrapper",V.value]),style:Be(g.value),onPointerdown:Y,onPointermove:U},[D("div",{ref_key:"helperEl",ref:s,class:"helper"},null,512),D("div",{ref_key:"itemsEl",ref:v,class:"items"},[(k(!0),ce(Ne,null,Ae(K.value,(_,x)=>(k(),te(Ke,{key:x,item:_,"clamp-global":e.clampSymbols,wrapper:ke(a),"parent-layout":y.value,"scroll-offset":I.value},null,8,["item","clamp-global","wrapper","parent-layout","scroll-offset"]))),128))],512)],38))}}),St=ye(Qe,[["__scopeId","data-v-d5b716a1"]]);function Ze(u){u=u||document.body,u.requestFullscreen()}function Je(){document.exitFullscreen()}function et(u,n=void 0){u=u||document.body,n||n===void 0&&!se()?Ze(u):Je()}function se(){return!!document.fullscreenElement}const tt=He(({core:u})=>[{name:["fullscreen"],description:"Toggle Fullscreen",args:[new ee({name:"set",description:"Set Fullscreen"}),new ee({name:"toggle",description:"Toggle Fullscreen",flag:!0}),new ee({name:"is",description:"check fullscreen",flag:!0})],async action({is:n,fullscreen:o,toggle:s}){if(n)return se();if(o||s){let v="Enter Fullscreen?";se()&&(v="Leave Fullscreen?"),await u.executeCommand(`openDialog "${v}" -confirm`)&&et(document.body)}}}]);class st{constructor(){w(this,"cursors");w(this,"current");this.cursors={wait:this.getCursor(P.WAIT),default:this.getCursor(P.POINTER_1)},this.current=this.cursors.default}setWait(n){n?this.current=this.cursors.wait:this.current=this.cursors.default}getCursor(n){return new{[P.POINTER_1]:Ye,[P.POINTER_MOONCITY]:Ue,[P.WAIT]:Ge,[P.CROSSHAIR]:$e}[n]}setCurrent(n){var o;((o=this.current)==null?void 0:o.name)!==n&&(n?this.current=this.getCursor(n):this.current=this.cursors.default)}}class ot extends qe{constructor(o){const{core:s,contentEl:v}={contentEl:void 0,...o};super({name:"Screen",commands:tt,core:s});w(this,"defaultTheme");w(this,"currentTheme");w(this,"cursor",new st);w(this,"contentEl");w(this,"sizes",{content:t(0,0)});w(this,"positions",{content:t(0,0)});w(this,"screenLayout",{size:t(0,0),position:t(0,0)});w(this,"contentLayout",{size:t(0,0),position:t(0,0)});if(this.contentEl=v,this.defaultTheme=this.currentTheme=this.getDefaultTheme(),window===void 0)throw new Error("ScreenControl is only for Browser");xe.then(this.onReady.bind(this)).catch(h=>{throw h}),s.executionCounter>0&&this.cursor.setWait(!0)}destroy(){window.removeEventListener("resize",this.onResize.bind(this),!1)}updateContentLayout(o){const{x:s,y:v,width:h,height:z}=o.getBoundingClientRect();this.contentLayout={size:t(h,z),position:t(s,v)}}updateScreenLayout(o){const{x:s,y:v,width:h,height:z}=o.getBoundingClientRect();this.screenLayout={size:t(h,z),position:t(s,v)}}getDefaultTheme(){const o=this.core.config.get(C.THEME)||pe[fe];return new be("current",o)}setTheme(o){return this.currentTheme=o||this.getDefaultTheme()}onReady(){window.addEventListener("resize",this.onResize.bind(this),!1),this.onResize()}onResize(){if(this.contentEl){const{x:o,y:s,width:v,height:h}=this.contentEl.getBoundingClientRect();this.positions.content=t(o,s),this.sizes.content=t(v,h)}}}w(ot,"NAME","Screen");window.oncontextmenu=u=>{u.preventDefault()};export{gt as B,st as C,qe as M,ot as S,St as W,Et as a,bt as g};
