const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B-sd0E2v.js","./CFct_F1V.js","./oWuEt9Fj.js","./fnd6_Gtj.js","./CXbNF4JJ.css","./DIE1h8om.js","./BtlQwt4n.js","./B2exwp0w.js","./CpIyErmU.js","./BJWMXN3a.js","./BuJWj3tk.js","./CpPkMkLR.js","./CZZPvNTk.js","./6C4StZv5.js","./D4lI5vpz.js","./BE-N3i2n.js","./Ce6njBYG.js","./DdQrQ7-5.js","./6jpuwjT2.js","./On0xenC3.js","./djI3_XgP.js","./RAasLaaH.js","./DNvW6rqi.js","./C76rCs2v.js","./CHLd88nu.css","./eu9div-E.js","./BZaVfesc.css","./BflcHXSR.js","./9V19AFUE.js","./eeW43C70.js","./DMzq3-W3.js","./CJLX7oOC.js","./CNlRQWZy.js","./ol2dnVJx.js","./BlhZwPhK.js","./D9awfk1U.js","./CNkvSXuu.js","./Bn9oZkIo.js","./Bu9-HbQ4.js","./Cpj98o6Y.js","./DG6QdPnO.js","./Q6z_XoCT.js","./CxKYomUj.js","./CHpeLE9u.js","./WZmY4AAg.js","./BWR5uye1.js","./CV0dHcg-.js","./BpzDJwuK.css","./CshrRwMP.js","./BZV9yeIf.js","./Dz8kf3Cs.js","./BEIFRgqa.js","./DEAznjDA.css","./q06lhgNI.js","./Cm20VqKi.js","./BVZzrE_-.css","./DyLFza4E.js","./Bn0T8SwD.css","./C33XqYB4.js","./6Hezpcw1.css","./Dmu3TxfX.css","./CXNmtCei.js","./B5S5-ypg.js","./BSKES50A.css","./BN8hnlQc.css","./8BG5ErYJ.js","./BrshYivp.js","./CYV3YR6m.css","./Br-CP6Fo.css","./BhXCp3Nl.js","./B6s0wlVD.js","./CuhyRvkQ.css","./B4CxLz9G.css","./DjU6ewvR.js","./D6pIwfSs.js","./BqFfl9wP.css","./BJPTWp8v.css","./DwQFt5ES.js","./B2sL6krP.css","./D5c8sBxY.js","./Dm0I8L0q.css","./B09nj9Vp.js","./q-V_J1wu.css","./XHMkfcx0.js","./3NC3WPRC.css","./DMfFyVJu.js"])))=>i.map(i=>d[i]);
var Lt=Object.defineProperty;var Mt=(s,t,e)=>t in s?Lt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>Mt(s,typeof t!="symbol"?t+"":t,e);import{L as Bt,K as I}from"./oWuEt9Fj.js";import{c as Ut,I as W,h as Rt,S as Ft}from"./CFct_F1V.js";import{i as l,I as xt}from"./CpIyErmU.js";import{a as S,b as Nt,f as nt}from"./BE-N3i2n.js";import{o as Z,c as Qt}from"./eeW43C70.js";import{O as Ht}from"./DdQrQ7-5.js";import{c as Y,t as zt,l as Vt}from"./ol2dnVJx.js";import{f as Jt}from"./CNlRQWZy.js";import{S as ut}from"./6C4StZv5.js";import{u as Wt,i as Zt,a as Gt,b as jt,r as Xt,c as qt}from"./D9awfk1U.js";import{K as Kt}from"./B2exwp0w.js";import{e as $t,s as Yt}from"./Bn9oZkIo.js";import{T as te,g as ee}from"./CHpeLE9u.js";import{t as dt}from"./WZmY4AAg.js";import{K as rt}from"./CZZPvNTk.js";var Q=(s=>(s.CONTENT="content",s.OUTPUT_TYPE="type",s))(Q||{}),_=(s=>(s.WEB_PAINT_DISPLAY_BACKGROUND="extras13_web_paint_display_background",s.WEB_PAINT_DISPLAY_FOREGROUND="extras13_web_paint_display_foreground",s.WEB_PAINT_DISPLAY_GRID_COLOR="extras13_web_paint_display_grid_color",s.WEB_PAINT_FIT_IMAGE="extras13_web_paint_fit_image",s.WEB_PAINT_NATIVE_THEME="extras13_web_paint_native_theme",s.WEB_PAINT_PALETTES="extras13_web_paint_palettes",s.WEB_PAINT_DEBUG="extras13_web_paint_debug",s))(_||{}),se=(s=>(s.LEFT_TOP="left_top",s.TOP="top",s.RIGHT_TOP="right_top",s.LEFT="left",s.CENTER="center",s.RIGHT="right",s.LEFT_BOTTOM="left_bottom",s.BOTTOM="bottom",s.RIGHT_BOTTOM="right_bottom",s))(se||{});const oe=""+new URL("pWAMfWPQ.jpg",import.meta.url).href,ie="data:image/png;base64,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",ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAcCAYAAAATFf3WAAAACXBIWXMAAAWJAAAFiQFtaJ36AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFySURBVHgBzZcBksIgDACTTh9wT7hP6SP1U/eTHtQGaJrEhDqVnVGxk8IaAlSEMVmogTAeS2JtICJMMBZFjhgpgzu5nL31A8ZAlCtvX0aV2zUiHTrjPH2bct5O1A4t8Fg9aPUlyYkXPiEnwYU9cpnLtpksRFJeucyl+2CWichlLhPkU9zImnUzg4/z9Xd71DbAbrrTtfwFewWl1cYDZClik7PiNVpB8S7XVpAywOOWx+3Vvj9r4PMuyllZxBqj/yqqF6Ood08gJFfu3yRTzF/6+NXGkPqeQJHLN9DrLI3wDwSZW6G3A9WpOFx30i/YTKFJz2rOU9y7C8x8cFMyFfkKbRlUW7QgWP01tQe9IEhPsdK5SXJEkuQrlBN8sEBNECxJUU6TbOXYSu6Ry0w17pg1U+4DRM9iFOuPnQIcLVNaZreBXHJawOsEl+pHyiZbMKUTQbxJgHtztQJ10SA9YpEbimFElpVL93EU/k8SiD1/Rib+AQhe0VUs7Fs4AAAAAElFTkSuQmCC",re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAVCAYAAABCIB6VAAAACXBIWXMAAAWJAAAFiQFtaJ36AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAB7SURBVHgB7ZXdDoAgCIUPjmftoXpZ+7moaSjYoNbWd+HmPB4ZIhKAjAB4Hydn75mQEMT3jLmYrbm50Mq/ouV6LedzkUjYbNSKqdAMLdqkRaLR0rI1AometjQeeSiK9sVyG6FbbrhHHdJDqRBO9jF2bJ9/2zzY7irkz1sAUAkbb2UHezIAAAAASUVORK5CYII=";function ae(){return{[_.WEB_PAINT_DISPLAY_BACKGROUND]:"#CCCCCCFF",[_.WEB_PAINT_DISPLAY_FOREGROUND]:"#FFFFFFFF",[_.WEB_PAINT_DISPLAY_GRID_COLOR]:"#00000033",[_.WEB_PAINT_FIT_IMAGE]:!1,[_.WEB_PAINT_NATIVE_THEME]:!1,[_.WEB_PAINT_DEBUG]:!0}}const Qs={LENNA:oe,DISK:ie,WEB_PAINTING:ne,CUBY:re};var et=(s=>(s.WEB_PAINT="web_paint",s))(et||{}),u=(s=>(s.DEFAULT="default",s.REFRESH="refresh",s.REFRESH_SUCCESS="refreshSuccess",s.DEBUG="debug",s.INIT="init",s.INIT_SUCCESS="initSuccess",s.SYNC_STATE="syncState",s.SYNC_STATE_SUCCESS="syncStateSuccess",s.ADD_RENDER_WORKER_PORT="addRenderWorkerPort",s.ADD_RENDER_WORKER_PORT_SUCCESS="addRenderWorkerPortSuccess",s.LOAD_IMAGE="loadImage",s.LOAD_IMAGE_SUCCESS="loadImageSuccess",s.UPDATE_CANVAS="updateCanvas",s.UPDATE_BUFFER="updateBuffer",s.UPDATE_BUFFER_SUCCESS="updateBufferSuccess",s.STACK="stack",s.STACK_SUCCESS="stackSuccess",s.UNDO_STACK="undoStack",s.UNDO_STACK_SUCCESS="undoStackSuccess",s.REDO_STACK="redoStack",s.REDO_STACK_SUCCESS="redoStackSuccess",s.CLEAR="clear",s.CLEAR_SUCCESS="clearSuccess",s.SET_ZOOM="setZoom",s.SET_ZOOM_SUCCESS="setZoomSuccess",s.ZOOM_FIT="zoomFit",s.ZOOM_FIT_SUCCESS="zoomFitSuccess",s.SET_POSITION="setPosition",s.SET_POSITION_SUCCESS="setPositionSuccess",s.USE_TOOL="useTool",s.USE_TOOL_SUCCESS="useToolSuccess",s.SET_SELECT_OPTIONS="setSelectOptions",s.SET_SELECT_OPTIONS_SUCCESS="setSelectOptionsSuccess",s.GET_DATA="getData",s.GET_DATA_SUCCESS="getDataSuccess",s.RESIZE="resize",s.RESIZE_SUCCESS="resizeSuccess",s.RESIZE_CANVAS="resizeCanvas",s.RESIZE_CANVAS_SUCCESS="resizeCanvasSuccess",s.GET_COLORS="getColors",s.GET_COLORS_SUCCESS="getColorsSuccess",s.IMAGE_OPERATION="imageOperation",s.IMAGE_OPERATION_SUCCESS="imageOperationSuccess",s.COLOR_PICKER="colorPicker",s.COLOR_PICKER_SUCCESS="colorPickerSuccess",s.SET_OPTIONS="setOptions",s.SET_OPTIONS_SUCCESS="setOptionsSuccess",s.DRAW_RECTANGLE="drawRectangle",s.DRAW_RECTANGLE_SUCCESS="drawRectangleSuccess",s.DRAW_BRUSH="drawBrush",s))(u||{});function ce(s,t,e){let o,i,n;if(t===0)o=i=n=e;else{const c=(d,T,C)=>(C<0&&(C+=1),C>1&&(C-=1),C<.16666666666666666?d+(T-d)*6*C:C<.5?T:C<.6666666666666666?d+(T-d)*(.6666666666666666-C)*6:d),p=e<.5?e*(1+t):e+t-e*t,g=2*e-p;o=c(g,p,s/360+1/3),i=c(g,p,s/360),n=c(g,p,s/360-1/3)}return{r:Math.round(o*255),g:Math.round(i*255),b:Math.round(n*255)}}class h{constructor(t,e=0,o=0,i=255){a(this,"r");if(this.g=e,this.b=o,this.a=i,Array.isArray(t))[this.r,this.g,this.b,this.a]=t;else if(typeof t=="string"){const n=h.fromHex(t);this.r=n.r,this.g=n.g,this.b=n.b,this.a=n.a}else typeof t=="object"?(this.r=t.r||0,this.g=t.g||0,this.b=t.b||0,this.a=t.a!==void 0?t.a:255):(this.r=t,this.g=e||0,this.b=o||0,this.a=i===void 0?255:i);this.r=Math.min(Math.max(this.r,0),255),this.g=Math.min(Math.max(this.g,0),255),this.b=Math.min(Math.max(this.b,0),255),this.a=Math.min(Math.max(this.a,0),255)}static fromHex(t){t.length===4&&(t=`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`);const e=parseInt(t.slice(1,3),16),o=parseInt(t.slice(3,5),16),i=parseInt(t.slice(5,7),16),n=parseInt(t.slice(7,9),16);return new h(e,o,i,isNaN(n)?255:n)}static fromHsl(t,e,o,i=255){const{r:n,g:c,b:p}=ce(t,e,o);return new h(n,c,p,i)}static isValidHex(t){return/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(t)}toInverted(){return new h(255-this.r,255-this.g,255-this.b,this.a)}toJSON(){return{_type:this.constructor.name,r:this.r,g:this.g,b:this.b,a:this.a}}toHex(){return`#${this.toRGBA().map(t=>t.toString(16).padStart(2,"0")).join("")}`}toRGB(){return[this.r,this.g,this.b]}toRGBA(){return[...this.toRGB(),this.a]}toCSSRGBA(){return[...this.toRGB(),this.a/255]}toHsl(){const t=this.r/255,e=this.g/255,o=this.b/255,i=Math.max(t,e,o),n=Math.min(t,e,o);let c=0,p=0;const g=(i+n)/2;if(i===n)c=p=0;else{const d=i-n;switch(p=g>.5?d/(2-i-n):d/(i+n),i){case t:c=(e-o)/d+(e<o?6:0);break;case e:c=(o-t)/d+2;break;case o:c=(t-e)/d+4;break}c/=6}return[Math.round(c*360),p,g]}toHsla(){const[t,e,o]=this.toHsl();return[t,e,o,this.a]}toHsv(){const t=this.r/255,e=this.g/255,o=this.b/255,i=Math.max(t,e,o),n=Math.min(t,e,o);let c=0,p=0;const g=i,d=i-n;if(i!==0)p=d/i;else return[0,0,0];if(i===n)c=0;else{switch(i){case t:c=(e-o)/d+(e<o?6:0);break;case e:c=(o-t)/d+2;break;case o:c=(t-e)/d+4;break}c/=6}return[Math.round(c*360),p,g]}toHsva(){const[t,e,o]=this.toHsv();return[t,e,o,this.a]}getHslaHue(){const[t]=this.toHsl();return t}getHslaSaturation(){const[t]=this.toHsl();return t}getHslaLightness(){const[t]=this.toHsl();return t}setHslaHue(t){const[e,o,i]=this.toHsl();return h.fromHsl(e+t,o,i,this.a)}setHslaSaturation(t){const[e,o,i]=this.toHsl();return h.fromHsl(e,o+t,i,this.a)}setHslaLightness(t){const[e,o,i]=this.toHsl();return h.fromHsl(e,o,i+t,this.a)}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}}const b={fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},at={silent:{level:-1},fatal:{level:b.fatal},error:{level:b.error},warn:{level:b.warn},log:{level:b.log},info:{level:b.info},success:{level:b.success},fail:{level:b.fail},ready:{level:b.info},start:{level:b.info},box:{level:b.info},debug:{level:b.debug},trace:{level:b.trace},verbose:{level:b.verbose}};function q(s){if(s===null||typeof s!="object")return!1;const t=Object.getPrototypeOf(s);return t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.iterator in s?!1:Symbol.toStringTag in s?Object.prototype.toString.call(s)==="[object Module]":!0}function tt(s,t,e=".",o){if(!q(t))return tt(s,{},e);const i=Object.assign({},t);for(const n in s){if(n==="__proto__"||n==="constructor")continue;const c=s[n];c!=null&&(Array.isArray(c)&&Array.isArray(i[n])?i[n]=[...c,...i[n]]:q(c)&&q(i[n])?i[n]=tt(c,i[n],(e?`${e}.`:"")+n.toString()):i[n]=c)}return i}function le(s){return(...t)=>t.reduce((e,o)=>tt(e,o,""),{})}const pe=le();function he(s){return Object.prototype.toString.call(s)==="[object Object]"}function ue(s){return!(!he(s)||!s.message&&!s.args||s.stack)}let K=!1;const ct=[];class v{constructor(t={}){a(this,"options");a(this,"_lastLog");a(this,"_mockFn");const e=t.types||at;this.options=pe({...t,defaults:{...t.defaults},level:$(t.level,e),reporters:[...t.reporters||[]]},{types:at,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const o in e){const i={type:o,...this.options.defaults,...e[o]};this[o]=this._wrapLogFn(i),this[o].raw=this._wrapLogFn(i,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(t){this.options.level=$(t,this.options.types,this.options.level)}prompt(t,e){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(t,e)}create(t){const e=new v({...this.options,...t});return this._mockFn&&e.mockTypes(this._mockFn),e}withDefaults(t){return this.create({...this.options,defaults:{...this.options.defaults,...t}})}withTag(t){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+t:t})}addReporter(t){return this.options.reporters.push(t),this}removeReporter(t){if(t){const e=this.options.reporters.indexOf(t);if(e!==-1)return this.options.reporters.splice(e,1)}else this.options.reporters.splice(0);return this}setReporters(t){return this.options.reporters=Array.isArray(t)?t:[t],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const t in this.options.types)console["__"+t]||(console["__"+t]=console[t]),console[t]=this[t].raw}restoreConsole(){for(const t in this.options.types)console["__"+t]&&(console[t]=console["__"+t],delete console["__"+t])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(t,e){t&&(t.__write||(t.__write=t.write),t.write=o=>{this[e].raw(String(o).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(t){t&&t.__write&&(t.write=t.__write,delete t.__write)}pauseLogs(){K=!0}resumeLogs(){K=!1;const t=ct.splice(0);for(const e of t)e[0]._logFn(e[1],e[2])}mockTypes(t){const e=t||this.options.mockFn;if(this._mockFn=e,typeof e=="function")for(const o in this.options.types)this[o]=e(o,this.options.types[o])||this[o],this[o].raw=this[o]}_wrapLogFn(t,e){return(...o)=>{if(K){ct.push([this,t,o,e]);return}return this._logFn(t,o,e)}}_logFn(t,e,o){if((t.level||0)>this.level)return!1;const i={date:new Date,args:[],...t,level:$(t.level,this.options.types)};!o&&e.length===1&&ue(e[0])?Object.assign(i,e[0]):i.args=[...e],i.message&&(i.args.unshift(i.message),delete i.message),i.additional&&(Array.isArray(i.additional)||(i.additional=i.additional.split(`
`)),i.args.push(`
`+i.additional.join(`
`)),delete i.additional),i.type=typeof i.type=="string"?i.type.toLowerCase():"log",i.tag=typeof i.tag=="string"?i.tag:"";const n=(p=!1)=>{const g=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&g>0){const d=[...this._lastLog.object.args];g>1&&d.push(`(repeated ${g} times)`),this._log({...this._lastLog.object,args:d}),this._lastLog.count=1}p&&(this._lastLog.object=i,this._log(i))};clearTimeout(this._lastLog.timeout);const c=this._lastLog.time&&i.date?i.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=i.date,c<this.options.throttle)try{const p=JSON.stringify([i.type,i.tag,i.args]),g=this._lastLog.serialized===p;if(this._lastLog.serialized=p,g&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin)){this._lastLog.timeout=setTimeout(n,this.options.throttle);return}}catch{}n(!0)}_log(t){for(const e of this.options.reporters)e.log(t,{options:this.options})}}function $(s,t={},e=3){return s===void 0?e:typeof s=="number"?s:t[s]&&t[s].level!==void 0?t[s].level:e}v.prototype.add=v.prototype.addReporter;v.prototype.remove=v.prototype.removeReporter;v.prototype.clear=v.prototype.removeReporter;v.prototype.withScope=v.prototype.withTag;v.prototype.mock=v.prototype.mockTypes;v.prototype.pause=v.prototype.pauseLogs;v.prototype.resume=v.prototype.resumeLogs;function de(s={}){return new v(s)}class me{constructor(t){a(this,"options");a(this,"defaultColor");a(this,"levelColorMap");a(this,"typeColorMap");this.options={...t},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(t){return t<1?console.__error||console.error:t===1?console.__warn||console.warn:console.__log||console.log}log(t){const e=this._getLogFn(t.level),o=t.type==="log"?"":t.type,i=t.tag||"",c=`
      background: ${this.typeColorMap[t.type]||this.levelColorMap[t.level]||this.defaultColor};
      border-radius: 0.5em;
      color: white;
      font-weight: bold;
      padding: 2px 0.5em;
    `,p=`%c${[i,o].filter(Boolean).join(":")}`;typeof t.args[0]=="string"?e(`${p}%c ${t.args[0]}`,c,"",...t.args.slice(1)):e(p,c,...t.args)}}function fe(s={}){return de({reporters:s.reporters||[new me({})],prompt(e,o={}){return o.type==="confirm"?Promise.resolve(confirm(e)):Promise.resolve(prompt(e))},...s})}const ge=fe(),x=ge.withTag("webPaint"),Ae=x.withTag("workerManager");x.withTag("display");const mt=x.withTag("worker");mt.withTag("main");mt.withTag("display");async function ye(s,t,e){var o;switch(e.type){case u.INIT:s.options.debug&&x.withTag("Incoming").withTag("action").withTag(u.INIT).success(e);break;case u.SYNC_STATE:t.setState(e.payload);break;case u.UPDATE_BUFFER:console.log("[WorkerManager] BOOOOM",e);break;case u.RESIZE_CANVAS_SUCCESS:{const i=e.payload;(o=t.currentDocument)==null||o.setDimension(i.dimension)}break;default:s.options.debug&&x.withTag("Incoming").withTag("main").withTag("action").warn("Action not handled in WorkerManager:",e);break}}async function we(s,t,e,o){switch(o.type){case u.INIT_SUCCESS:s.config.get(_.WEB_PAINT_FIT_IMAGE)?e.actions.fitZoom():e.actions.setPosition(l(0,0));break;case u.SET_ZOOM_SUCCESS:{const{currentZoomLevel:i}=o.payload;e.setCurrentZoomLevel(i),o.payload&&"position"in o.payload&&(e.options.position=l(o.payload.position.x,o.payload.position.y))}break;default:s.options.debug&&x.withTag("Incoming").withTag("display").withTag("action").warn("Action not handled in WorkerManager:",o);break}}const ve=[{validator:()=>!0,handler:()=>s=>s.pipe(S(t=>t))}];class M{constructor(t,e){a(this,"validator");a(this,"handler");this.validator=t,this.handler=e}}const Se=(s=[])=>[...s,...ve],Ee=[{validator:()=>!0,handler:()=>s=>s.pipe(S(t=>t))}],Ce=(s=[])=>[...s,...Ee],ft={[Object.prototype.constructor.name]:s=>t=>t.pipe(S(Object.entries),F(s),S(Object.fromEntries)),[Array.prototype.constructor.name]:s=>t=>t.pipe(Qt(),F(s),zt()),[Promise.prototype.constructor.name]:s=>t=>t.pipe(Y(e=>Jt(e)),F(s)),[Ht.prototype.constructor.name]:s=>t=>t.pipe(Y(e=>e),F(s)),[void 0]:()=>s=>s};function De(s=[]){return t=>t.pipe(F(Se(s)))}function be(s=[]){return t=>t.pipe(F(Ce(s)))}function F(s){return t=>t.pipe(Nt(e=>{const o=Ie(e),i=o&&ft[o];return i?Z(e).pipe(i(s)):Z(e)}),ke(s))}function Ie(s){if(s==null)return;const t=s.constructor;if(t){const e=t.name;if(Object.prototype.hasOwnProperty.call(ft,e))return e}}function ke(s){return t=>t.pipe(Y(e=>Z(e).pipe(_e(s,e).handler())))}const _e=(s,t)=>{const e=s.find(({validator:o})=>o(t));return e||{validator:()=>!0,handler:o=>o}};var gt=(s=>(s.FILLED="filled",s.STROKED="stroked",s.STROKED_FILLED="stroked_filled",s))(gt||{}),k=(s=>(s.CIRCLE="circle",s.SQUARE="square",s.DOTS="dots",s))(k||{}),r=(s=>(s.NONE="none",s.DOTTED_FREEHAND="dotted_freehand",s.CONTINUOUS_FREEHAND="continuous_freehand",s.STRAIGHT_LINE="straight_line",s.CURVE_LINE="curve_line",s.FILL_TOOL="fill_tool",s.AIR_BRUSH="airbrush",s.RECTANGLE="rectangle",s.CIRCLE="circle",s.ELLIPSE="ellipse",s.POLYGON="polygon",s.CROP="crop",s.TEXT="text",s.SPLIT_SCREEN="splitScreen",s.MAGNIFY="magnify",s.ZOOM="zoom",s.STACK_REDO="stack_redo",s.STACK_UNDO="stack_undo",s.CLEAR="clear",s.ZOOM_FIT="zoom_fit",s.COLOR_PICKER="color_picker",s.IMAGE_OPERATION="image_operation",s))(r||{});class Te{constructor(t){this.display=t}useTool(t,{domEvents:e}){switch(this.display.app.options.select.tool.value){case r.ZOOM:{const i=this.display.app.options.zoomStep,n=1+(e.shiftLeftActive?-i:i);this.setZoom(t,n)}}}setPosition(t){return this.display.options.position=t,this.display.action({type:u.SET_POSITION,payload:{position:t}})}setZoom(t=l(0,0),e){return this.display.options.zoomLevel=e,this.display.action({type:u.SET_ZOOM,payload:{zoomLevel:e,position:t}})}colorPicker(t){return this.display.action({type:u.COLOR_PICKER,payload:{position:t}})}async fitZoom(){const t=this.display;await t.actions.setPosition(l(0,0)),await t.actions.setZoom(l(0,0),0),await t.action({type:u.ZOOM_FIT,payload:{}})}async setOptions(){const t=this.display;await t.action({type:u.SET_OPTIONS,payload:{options:t.options}})}}l(-1,-1),l(0,-1),l(1,-1),l(-1,0),l(0,0),l(1,0),l(-1,1),l(0,1),l(1,1);class G{constructor(t){a(this,"origin");a(this,"position");a(this,"colors");a(this,"zoomLevel");a(this,"precision");const{origin:e,position:o,colors:i,zoomLevel:n}=t||{};this.origin=e||"center",this.position=o?l(o.x,o.y):l(0,0),this.colors={background:i!=null&&i.background?new h(i.background):new h(0,0,0),foreground:i!=null&&i.foreground?new h(i.foreground):new h(255,255,255),grid:i!=null&&i.grid?new h(i.grid):new h(0,0,0,.2)},this.zoomLevel=n||1,this.precision=3}toJSON(){return{_type:this.constructor.name,origin:this.origin,position:this.position.toJSON(),colors:{background:this.colors.background.toJSON(),foreground:this.colors.foreground.toJSON(),grid:this.colors.grid.toJSON()},zoomLevel:this.zoomLevel,precision:this.precision}}}class Pe{constructor(t,e={}){a(this,"id",crypto.randomUUID());a(this,"actions");a(this,"app");a(this,"worker");a(this,"options");a(this,"currentZoomLevel",1);this.app=t,this.options=new G(e),this.actions=new Te(this)}setWorker(t){this.worker=t}setCurrentZoomLevel(t){this.options.zoomLevel=t}action(t,e){return this.app.workerManager.action(t,e,this.worker)}setColors(t){this.options.colors={background:new h(t.background),foreground:new h(t.foreground),grid:new h(t.grid)},this.actions.setOptions()}}class O{constructor(t){a(this,"id");a(this,"color");const{id:e,color:o}=t||{};this.id=e||crypto.randomUUID(),this.color=o?new h(o):new h(0,0,0)}setColor(t){this.color=t}equal(t){return this.id===(t==null?void 0:t.id)}toJSON(){return{_type:this.constructor.name,id:this.id,color:this.color.toJSON()}}}class j{constructor(t){a(this,"id");a(this,"name");a(this,"description");a(this,"colors");a(this,"locked");const{id:e,name:o,description:i,colors:n,locked:c}=t||{};this.id=e||crypto.randomUUID(),this.name=o||"",this.description=i,this.colors=(n||[]).map(p=>new O(p)),this.locked=c}toJSON(){return{_type:this.constructor.name,id:this.id,name:this.name,description:this.description,colors:this.colors.map(t=>t.toJSON()),locked:this.locked}}}const Oe=[new M(s=>s&&s instanceof xt,()=>s=>s.pipe(S(t=>t.toJSON()))),new M(s=>s&&s instanceof G,()=>s=>s.pipe(S(t=>t.toJSON()))),new M(s=>s&&s instanceof h,()=>s=>s.pipe(S(t=>t.toJSON()))),new M(s=>s&&s instanceof O,()=>s=>s.pipe(S(t=>t.toJSON()))),new M(s=>s&&s instanceof j,()=>s=>s.pipe(S(t=>t.toJSON())))],Le=[new M(s=>typeof s=="object"&&"x"in s&&"y"in s,()=>s=>s.pipe(S(t=>l(t.x,t.y)))),new M(s=>s&&G.prototype.constructor.name===s._type,()=>s=>s.pipe(S(t=>new G(t)))),new M(s=>s&&h.prototype.constructor.name===s._type,()=>s=>s.pipe(S(t=>new h(t)))),new M(s=>s&&O.prototype.constructor.name===s._type,()=>s=>s.pipe(S(t=>new O(t)))),new M(s=>s&&j.prototype.constructor.name===s._type,()=>s=>s.pipe(S(t=>new j(t))))];function Me(){return s=>s.pipe(De(Oe))}function lt(){return s=>s.pipe(be(Le))}class Be{constructor(t,e,o={debug:!1}){a(this,"subscription",new ut);a(this,"readyResolver",Promise.withResolvers());a(this,"mainWorker",null);a(this,"displayWorkers",[]);a(this,"resolveMap",new Map);this.app=t,this.config=e,this.options=o}async setup(){var o;const t=new Worker(new URL(""+new URL("main-CFN705aw.js",import.meta.url).href,import.meta.url),{type:"module"});this.mainWorker=t;const e={type:u.INIT,payload:{debug:this.options.debug}};(o=this.subscription)==null||o.add(nt(this.mainWorker,"message").pipe(S(i=>i.data),lt()).subscribe(i=>{this.onMessageMainWorker(i)})),await this.action(e),this.readyResolver.resolve()}get ready(){return this.readyResolver.promise}destroy(){var t;(t=this.subscription)==null||t.unsubscribe(),this.mainWorker&&(this.mainWorker.terminate(),this.mainWorker=null),this.displayWorkers.forEach(e=>e.terminate()),this.displayWorkers=[]}addDisplay(t,e){return new Promise(o=>{var n;const i=new Worker(new URL(""+new URL("display-zemnJUhE.js",import.meta.url).href,import.meta.url),{type:"module"});if(t.setWorker(i),(n=this.subscription)==null||n.add(nt(i,"message").pipe(S(c=>c.data),lt()).subscribe(c=>this.onMessageDisplayWorker(c,t))),this.displayWorkers.push(i),e){const c=e.transferControlToOffscreen(),p=new MessageChannel,g={type:u.INIT,payload:{debug:this.options.debug,options:t.options,canvas:c,port:p.port1}};if(this.mainWorker){const d={type:u.ADD_RENDER_WORKER_PORT,payload:{port:p.port2}};this.action(d,[p.port2]).then(()=>o())}this.action(g,[c,p.port1],i)}})}removeDisplay(t){var e;this.displayWorkers=this.displayWorkers.filter(o=>o!==t.worker),(e=t.worker)==null||e.terminate(),t.worker=void 0}async action(t,e,o=this.mainWorker){const i=crypto.randomUUID(),n=Promise.withResolvers();J.set(i,n.resolve),this.options.debug&&Ae.withTag("action").withTag(t.type).start(t,o);const c=await Vt(Z({id:i,data:t}).pipe(Me()));return o.postMessage(c,e||[]),n.promise.then(p=>(J.delete(i),p))}async onMessageMainWorker(t){var i;const{id:e,data:o}=t;await ye(this,this.app,o),(i=J.get(e))==null||i(o)}async onMessageDisplayWorker(t,e){var n;const{id:o,data:i}=t;await we(this,this.app,e,i),(n=J.get(o))==null||n(i)}}const J=new Map;class H{constructor({name:t,meta:e,data:o}){a(this,"name");a(this,"meta");a(this,"data");this.name=t,this.meta=e,this.data=o||Ue(e.dimension.x,e.dimension.y)}setDimension(t){this.meta.dimension=t}destroy(){this.data.close()}}function Ue(s,t){const e=new OffscreenCanvas(s,t),o=e.getContext("2d");if(!o)throw new Error("Failed to get 2D context from OffscreenCanvas");return o.fillStyle="white",o.fillRect(0,0,s,t),e.transferToImageBitmap()}async function Hs(s){const t=await Wt(s),e={dimension:l(t.width,t.height)};return new H({name:"Untitled Document",meta:e,data:t.transferToImageBitmap()})}async function Re(s){const t=await Zt(await createImageBitmap(s)),e={dimension:l(t.width,t.height)};return new H({name:s.name||"Untitled Document",meta:e,data:t.transferToImageBitmap()})}async function Fe(s){const t=await Gt(s),e={dimension:l(t.width,t.height)};return new H({name:"Untitled Document",meta:e,data:t.transferToImageBitmap()})}function xe(s,t){const e=new OffscreenCanvas(s,t),o=e.getContext("2d");if(!o)throw new Error("Failed to get 2D context from OffscreenCanvas");return o.fillStyle="white",o.fillRect(0,0,s,t),e.transferToImageBitmap()}function At(s=l(300,240)){return new H({name:"Blank Document",meta:{dimension:s},data:xe(s.x,s.y)})}function yt(){return{type:k.CIRCLE,size:5}}function wt(){return{shapeStyle:gt.STROKED_FILLED,value:r.NONE,segmentLength:1,gapLength:0,interpolateSegments:!1,airBrushStrength:50,airBrushWeight:1}}function vt(){return{primaryColor:new O({color:new h(0,0,0)}),secondaryColor:new O({color:new h(255,0,0)}),palette:new j({name:"Default Palette",colors:[new O({color:new h(0,0,0,0)}),new O({color:new h(0,0,0)}),new O({color:new h(255,0,0)}),new O({color:new h(0,255,0)}),new O({color:new h(0,0,255)})]}),paletteSteps:new h(4,1,1)}}function zs(){return[{value:{type:k.CIRCLE,size:1},title:"Small Circle"},{value:{type:k.CIRCLE,size:3},title:"Medium Circle"},{value:{type:k.CIRCLE,size:5},title:"Large Circle"},{value:{type:k.CIRCLE,size:7},title:"Extra Large Circle"},{value:{type:k.SQUARE,size:5},title:"Extra Large Square"},{value:{type:k.SQUARE,size:4},title:"Large Square"},{value:{type:k.SQUARE,size:3},title:"Medium Square"},{value:{type:k.SQUARE,size:2},title:"Small Square"},{value:{type:k.DOTS,size:4},title:"Small Dots"},{value:{type:k.DOTS,size:8},title:"Medium Dots"}]}function Vs({shiftActive:s,canRedo:t,canUndo:e}){return[{value:r.DOTTED_FREEHAND,title:"Dotted Freehand"},{value:r.CONTINUOUS_FREEHAND,title:"Continuous Freehand"},{value:r.STRAIGHT_LINE,title:"Straight Line"},{value:r.CURVE_LINE,title:"Curve"},{value:r.FILL_TOOL,title:"Fill Tool"},{value:r.AIR_BRUSH,title:"Air Brush"},{value:r.RECTANGLE,title:"Rectangle"},{value:r.CIRCLE,title:"Circle"},{value:r.ELLIPSE,title:"Ellipse"},{value:r.POLYGON,title:"Polygon"},{value:r.CROP,title:"Brush Selector"},{passive:!0,value:r.SPLIT_SCREEN,title:"Split Screen"},{value:r.COLOR_PICKER,title:"Color Picker",hotKey:{code:Kt.KEY_I,title:"I"}},{passive:!0,value:r.ZOOM_FIT,title:"Fit to Screen"},{value:r.MAGNIFY,title:"Magnify"},{value:r.ZOOM,title:"Zoom"},...s?[{disabled:!t,value:r.STACK_REDO,passive:!0,title:"Redo"}]:[{disabled:!e,value:r.STACK_UNDO,passive:!0,title:"Undo"}],{value:r.CLEAR,passive:!0,title:"Clear"}]}var N=(s=>(s.START="start",s.STOP="stop",s.FORWARD="forward",s.BACKWARD="backward",s))(N||{});class Ne{constructor(t){this.app=t}startStack(){return this.app.workerManager.action({type:u.STACK,payload:{action:N.START}})}stopStack(){return this.app.workerManager.action({type:u.STACK,payload:{action:N.STOP}})}stackUndo(){return this.app.workerManager.action({type:u.STACK,payload:{action:N.BACKWARD}})}stackRedo(){return this.app.workerManager.action({type:u.STACK,payload:{action:N.FORWARD}})}setSelectOptions(t){return this.app.workerManager.action({type:u.SET_SELECT_OPTIONS,payload:t})}getData(t={}){return this.app.workerManager.action({type:u.GET_DATA,payload:t})}resize(t){return this.app.workerManager.action({type:u.RESIZE,payload:t})}resizeCanvas(t){return this.app.workerManager.action({type:u.RESIZE_CANVAS,payload:t})}async getColors(){return await this.app.workerManager.action({type:u.GET_COLORS,payload:{}})}}class Qe{constructor(t){a(this,"select");a(this,"display");a(this,"zoomStep");const{select:e,display:o,zoomStep:i}=t||{};this.select=e||{brush:yt(),tool:wt(),color:vt()},this.display=o||{colors:{background:new h(255,255,255),foreground:new h(0,0,0),grid:new h(0,0,0,.2)}},this.zoomStep=i||.2}}class He{constructor({options:t},e){a(this,"actions",new Ne(this));a(this,"state",{stackCount:0,stackIndex:-1,stackMaxSize:0});a(this,"workerManager");a(this,"currentDocument");a(this,"currentDisplay");a(this,"canvas");a(this,"options");a(this,"displays",[]);this.options=new Qe(t),this.workerManager=new Be(this,e),this.setDisplay(this.addDisplay())}async setup(){await this.workerManager.setup(),this.setDocument(At())}closeDocument(){this.currentDocument=void 0}addDisplay(t){const e=new Pe(this,{colors:this.options.display.colors,...t||{}});return this.displays.push(e),e}setDisplays(t){if(t<1||t>4)throw new Error("Display count must be between 1 and 4");const e=t-this.displays.length;for(let o=0;o<Math.abs(e);o++)e<0?this.removeDisplay(this.displays[this.displays.length-1]):this.addDisplay()}setDisplayColors(t){this.displays.forEach(e=>{e.setColors(t)})}get hasMaxDisplays(){return this.displays.length>=4}async setDisplayCanvas(t,e){await this.workerManager.addDisplay(t,e)}removeDisplayCanvas(t){this.workerManager.removeDisplay(t)}removeDisplay(t){this.workerManager.removeDisplay(t),this.displays=this.displays.filter(e=>e!==t)}removeDisplays(){return Promise.all(this.displays.map(t=>this.workerManager.removeDisplay(t)))}async setDocument(t){this.currentDocument&&this.currentDocument.destroy();const e=t.data;this.currentDocument=t;const o={type:u.LOAD_IMAGE,payload:{imageBitmap:e}};await this.workerManager.action(o,[e])}setDisplay(t){typeof t=="string"&&(t=this.displays.find(e=>e.id===t)),this.currentDisplay=t}actionDisplay(t,e,o){return this.workerManager.action(e,o,t.worker)}get ready(){return Promise.all([this.workerManager.ready])}setState(t){this.state={...this.state,...t}}setBrush(t){this.options.select.brush=t}setSelectOptions(t,e,o=!1){let i;o&&(i={...this.options.select[t],...e}),this.options.select={...this.options.select,[t]:i||e},this.actions.setSelectOptions(this.options.select)}setColor(t){this.options.select.color=t}setColorPalette(t){this.options.select.color.palette=t}async getImageData(){const{payload:t}=await this.actions.getData(),{buffer:e,dimension:o}=t,i=new Uint8ClampedArray(e.length);return i.set(e),new ImageData(i,o.x,o.y)}}const ze=new te({name:"Pastel Beige",colorOptions:{layout:{primary:"#F5F5DC",secondary:"#000000",tertiary:"#D2B48C",quaternary:"#6B4226",invert:{primary:"#6B4226",secondary:"#D2B48C",tertiary:"#000000",quaternary:"#F5F5DC"}},content:{primary:"#F5F5DC",secondary:"#000000",tertiary:"#D2B48C",quaternary:"#6B4226",invert:{primary:"#F5F5DC",secondary:"#6B4226",tertiary:"#000000",quaternary:"#F5F5DC"}}}});function Ve(s){if(!s.colorOptions)throw new Error("Theme must have colorOptions defined");return s.extend({name:"Web Paint",colors:{disks:{webPaint:St(ee(s.colorOptions))}}})}function St(s=["#FFF","#000","#FFAA55","#0055AA"]){return{originSelect:{background:s[2],foreground:s[0],selected:{background:s[1],foreground:s[0]}},colorSelect:{border:s[3],selcted:{border:s[0]},filled:{border:s[0],selected:{border:s[3]}}},iconButton:{background:s[1],foreground:s[0],hover:{background:s[1],foreground:s[0]},filled:{background:s[3],foreground:s[0],hover:{background:s[2],foreground:s[3]}}},sidebar:{background:{primary:s[2],secondary:s[0]},border:s[2],brushSelect:{background:s[0],item:{foreground:s[2],selected:{foreground:s[3]}}},toolSelect:{background:s[2],item:{background:s[0],foreground:s[3],selected:{background:s[2],foreground:s[3]}}},colorSelect:{background:"#000",item:{selected:{border:"#fff"}}}}}}const Je=ze.extend({name:"Web Painting",colors:{disks:{webPaint:St(["#F5F5DC","#6B4226","#D2B48C","#000000"])}}});class Et{constructor({type:t,app:e,actions:o,domEvents:i,options:n}){a(this,"type");a(this,"app");a(this,"actions");a(this,"options");a(this,"domEvents");this.type=t,this.app=e,this.actions=o,this.options=n||{},this.domEvents=i}destroy(){}getDisplay(){return this.app.currentDisplay}action(t={},e){}}class E extends Et{constructor({domEvents:e,interactingMove:o,...i}){super({...i});a(this,"interactingMove",!1);this.interactingMove=o??!0,this.domEvents=e}click(e,o){}async pointerDown(e){}async pointerUp(e){}pointerMove(e){}contextMenu(e){}pointerCancel(e){}cancel(e){}reset(e){e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height)}action(e={},{event:{dimension:o,normalizedPosition:i}}){const n={...this.options,...e},c=this.app.workerManager,p=this.getDisplay();return c.action({type:u.USE_TOOL,payload:{tool:this.type,toolOptions:n,meta:{dimension:o,displayPosition:p.options.position,position:i,zoomLevel:p.options.zoomLevel}}})}}class We extends E{}class Ze extends E{constructor(t){super({...t,type:r.ZOOM,options:{}})}async pointerUp({normalizedPosition:t}){var n;const e=this.getDisplay(),o=this.app.options.zoomStep,i=1+((n=this.domEvents)!=null&&n.shiftLeftActive?-o:o);e.options.zoomLevel=i,await e.action({type:u.SET_ZOOM,payload:{zoomLevel:i,position:t}})}}class Ge extends E{constructor(e){super({...e,type:r.MAGNIFY,options:{}});a(this,"bounds");a(this,"startPosition");a(this,"color",new h(255,170,85,1))}async pointerUp({dimension:e,ctx:o,normalizePosition:i}){var T;if(o.clearRect(0,0,o.canvas.width,o.canvas.height),!this.startPosition||!this.bounds)return;const n=this.bounds,c=this.getDisplay(),p=l(()=>Math.abs(e/n.dimension*c.app.options.zoomStep));if(p.x===1/0||p.y===1/0)return;const g=i(l(()=>n.position+n.dimension/2)),d=1+((T=this.domEvents)!=null&&T.shiftLeftActive?-1:1)*Math.max(p.x,p.y);this.startPosition=void 0,await c.action({type:u.SET_ZOOM,payload:{zoomLevel:d,position:g}})}async pointerDown({position:e,ctx:o}){this.startPosition=e,o.beginPath()}pointerMove({position:e,ctx:o}){this.startPosition&&(o.clearRect(0,0,o.canvas.width,o.canvas.height),o.strokeStyle=`2px ${this.color.toHex()}`,o.lineWidth=2,this.bounds={position:this.startPosition,dimension:l(()=>e-this.startPosition)},o.strokeRect(this.bounds.position.x,this.bounds.position.y,this.bounds.dimension.x,this.bounds.dimension.y))}}class je extends E{constructor(t){super({...t,options:{...t.options,stackable:!0}})}pointerMove(t){super.pointerMove(t),this.action({},{event:t})}async pointerDown(t){await super.pointerDown(t),await this.app.actions.startStack(),this.action({},{event:t})}async pointerUp(t){await super.pointerUp(t),await this.app.actions.stopStack()}}class Ct extends je{constructor(e){var o;super({...e,type:e.type||r.DOTTED_FREEHAND,options:{...e.options,holdInterval:((o=e.options)==null?void 0:o.holdInterval)||20}});a(this,"timer");a(this,"canPressHold");a(this,"holdEvent");this.canPressHold=!1}async pointerDown(e){if(await super.pointerDown(e),this.canPressHold){if(!this.options.holdInterval)throw new Error("Hold interval must be defined for DottedFreehand tool.");this.timer=dt(0,this.options.holdInterval).subscribe(()=>{this.pointerMove({...e,...this.holdEvent})})}}pointerMove(e){this.canPressHold&&(this.holdEvent=e),super.pointerMove(e)}async pointerUp(e){return this.timer&&(this.timer.unsubscribe(),this.timer=void 0,this.holdEvent=void 0),super.pointerUp(e)}}class Xe extends Ct{constructor(t){super({...t,type:r.CONTINUOUS_FREEHAND,options:{lastPosition:l(0,0)}})}async pointerDown(t){this.options.lastPosition=t.normalizedPosition,await super.pointerDown(t)}pointerMove(t){super.pointerMove(t),this.options.lastPosition=t.normalizedPosition}async pointerUp(t){return this.options.lastPosition=t.normalizedPosition,super.pointerUp(t)}}class qe extends E{constructor(e){var o;super({...e,type:r.AIR_BRUSH,options:{...e.options,stackable:!0,holdInterval:((o=e.options)==null?void 0:o.holdInterval)||10,round:!0}});a(this,"timer");a(this,"holdEvent")}pointerMove(e){super.pointerMove(e),this.holdEvent=e,this.action(this.options,{event:e})}async pointerDown(e){if(await super.pointerDown(e),await this.app.actions.startStack(),!this.options.holdInterval)throw new Error("Hold interval must be defined for DottedFreehand tool.");this.timer=dt(0,this.options.holdInterval).subscribe(()=>{this.pointerMove({...e,...this.holdEvent})})}async pointerUp(e){this.timer&&(this.timer.unsubscribe(),this.timer=void 0,this.holdEvent=void 0),await super.pointerUp(e),await this.app.actions.stopStack()}}class Ke{constructor(t){a(this,"dimension",l(11,11));a(this,"position",l(0,0));a(this,"intersectMap");a(this,"selected",!1);this.position=l(t.x,t.y)}intersect(t){const e=t.x<this.position.x+this.dimension.x&&t.x+this.dimension.x>this.position.x,o=t.y<this.position.y+this.dimension.y&&t.y+this.dimension.y>this.position.y;return e&&o}}var L=(s=>(s.START="start",s.MOVE="move",s.STOP="stop",s))(L||{});class st extends E{constructor(e){super({...e,options:{...e.options,stackable:!0}});a(this,"startEvent");a(this,"selectedAnchor");a(this,"anchors");this.selectedAnchor=void 0,this.anchors=[]}async pointerDown(e){await super.pointerDown(e),this.startEvent=e}cancel(e){super.cancel(e),this.reset(e)}drawAnchors(e,o={stroke:!0}){this.anchors.forEach(i=>{this.drawAnchor(e,i,o)})}drawAnchor(e,o,{stroke:i}={stroke:!0}){e.ctx.lineWidth=1,e.ctx.fillStyle=this.app.options.select.color.secondaryColor.color.toHex(),(o===this.selectedAnchor||!i)&&(e.ctx.fillStyle=this.app.options.select.color.primaryColor.color.toInverted().toHex()),e.ctx.strokeStyle=this.app.options.select.color.primaryColor.color.toHex();const n=l(()=>Math.round(o.position-o.dimension/2));e.ctx.fillRect(n.x,n.y,o.dimension.x,o.dimension.y),e.ctx.strokeRect(n.x,n.y,o.dimension.x,o.dimension.y)}getAnchorByPosition(e){return this.anchors.find(o=>o.intersect(e)?o:!1)}addAnchor(e){const o=new Ke(e);return this.anchors.push(o),o}reset(e){super.reset(e),this.anchors=[],this.selectedAnchor=void 0}}class $e extends st{constructor(e){super({...e,type:r.STRAIGHT_LINE});a(this,"lineWidth",2);a(this,"started",!1)}async pointerDown(e){if(await super.pointerDown(e),this.selectedAnchor){const o=this.getAnchorByPosition(e.position);o?this.selectedAnchor=o:(await this.app.actions.startStack(),await this.action({state:L.STOP,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(i=>e.normalizePosition(i.position))},{event:e}),await this.app.actions.stopStack(),this.reset(e))}else this.action({state:L.START,stackable:!1},{event:e}),this.started=!0;this.render(e)}async pointerMove(e){var o;this.started&&(await super.pointerMove(e),(o=this.domEvents)!=null&&o.pointerActive&&(this.anchors.length<1&&(this.addAnchor(e.position),this.selectedAnchor=this.addAnchor(e.position)),this.selectedAnchor&&(this.selectedAnchor.position=e.position),this.render(e),this.action({stackable:!1,state:L.MOVE,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(i=>e.normalizePosition(i.position))},{event:e})))}reset(e){super.reset(e),this.started=!1}render(e){e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),this.anchors.length>1&&this.drawAnchors(e)}}class Ye extends st{constructor(e){super({...e,type:r.CURVE_LINE});a(this,"lineWidth",2);a(this,"started",!1);a(this,"primaryHelperOffset");a(this,"secondaryHelperOffset")}async pointerUp(e){await super.pointerUp(e),this.anchors.length>1&&this.anchors.length!==4&&this.createHelpers(e),this.selectedAnchor=void 0}async pointerDown(e){await super.pointerDown(e);const o=this.getAnchorByPosition(e.position);if(o&&this.selectedAnchor!==o)this.selectedAnchor=o;else if(this.anchors.length===4&&!o){await this.app.actions.startStack(),await this.action({state:L.STOP,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(i=>e.normalizePosition(i.position))},{event:e}),await this.app.actions.stopStack(),this.reset(e);return}else this.anchors.length>1&&this.anchors.length!==4?this.createHelpers(e):this.selectedAnchor||(this.addAnchor(e.position),this.selectedAnchor=this.addAnchor(e.position),this.action({state:L.START,stackable:!1},{event:e}),this.started=!0);this.render(e)}async pointerMove(e){var o;if(this.started&&(await super.pointerMove(e),(o=this.domEvents)!=null&&o.pointerActive)){if(this.anchors.length<2&&(this.addAnchor(e.position),this.selectedAnchor=this.addAnchor(e.position)),this.selectedAnchor){let i=e.position;i=e.position,this.selectedAnchor.position=i,this.selectedAnchor===this.primaryAnchor&&this.primaryHelper?this.primaryHelper.position=this.primaryHelperOffset:this.selectedAnchor===this.secondaryAnchor&&this.secondaryHelper?this.secondaryHelper.position=l(()=>this.selectedAnchor.position+this.secondaryHelperOffset):(this.selectedAnchor===this.primaryHelper||this.selectedAnchor===this.secondaryHelper)&&this.refreshHelperOffset()}this.render(e),this.action({state:L.MOVE,stackable:!1,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(i=>e.normalizePosition(i.position))},{event:e})}}reset(e){super.reset(e),this.started=!1,this.primaryHelperOffset=void 0,this.secondaryHelperOffset=void 0}get primaryAnchor(){return this.anchors[0]}get secondaryAnchor(){return this.anchors[1]}get primaryHelper(){return this.anchors[2]}get secondaryHelper(){return this.anchors[3]}refreshHelperOffset(){this.primaryHelper&&(this.primaryHelperOffset=l(()=>this.primaryHelper.position-this.primaryAnchor.position)),this.secondaryHelper&&(this.secondaryHelperOffset=l(()=>this.secondaryHelper.position-this.secondaryAnchor.position))}createHelpers(e){let o=pt(this.primaryAnchor,this.secondaryAnchor);this.addAnchor(l(o[0],o[1])),o=pt(this.secondaryAnchor,this.primaryAnchor),this.addAnchor(l(o[0],o[1])),this.refreshHelperOffset(),this.render(e)}render(e){if(e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),this.anchors.length>1){const o=new Path2D;this.anchors.length>2?(o.moveTo(this.primaryAnchor.position.x,this.primaryAnchor.position.y),o.bezierCurveTo(this.primaryHelper.position.x,this.primaryHelper.position.y,this.secondaryHelper.position.x,this.secondaryHelper.position.y,this.secondaryAnchor.position.x,this.secondaryAnchor.position.y)):(o.moveTo(this.primaryAnchor.position.x,this.primaryAnchor.position.y),o.lineTo(this.secondaryAnchor.position.x,this.secondaryAnchor.position.y)),e.ctx.strokeStyle=this.app.options.select.color.primaryColor.color.toInverted().toHex(),e.ctx.lineWidth=this.lineWidth,e.ctx.stroke(o)}this.drawAnchors(e,{stroke:!1})}}function pt(s,t){const e=ts(Math.round(s.position.x),Math.round(s.position.y),Math.round(t.position.x),Math.round(t.position.y));return e[Math.floor(e.length/4)]}function ts(s,t,e,o,i=0){const n=Math.abs(e-s),c=s<e?1:-1,p=Math.abs(o-t),g=t<o?1:-1;let d=(n>p?n:-p)/2;const T=[];let C=0;for(;i===0||C>=1?(T.push([s,t]),C=0):C+=1/i,!(s===e&&t===o);){const z=d;z>-n&&(d-=p,s+=c),z<p&&(d+=n,t+=g)}return T}class es extends E{constructor(e){super({...e,type:r.RECTANGLE,options:{...e.options,position:l(0,0),dimension:l(0,0)}});a(this,"startEvent");a(this,"bounds",{position:l(0,0),dimension:l(0,0)})}async pointerUp(e){const{normalizePosition:o,normalizeDimension:i}=e;if(!this.startEvent)return;const n=this.bounds;this.startEvent=void 0,await this.app.actions.startStack(),await this.action({state:"STOP",position:o(n.position),dimension:i(n.dimension)},{event:e}),await this.app.actions.stopStack(),this.reset(e)}async pointerDown(e){await super.pointerDown(e),this.startEvent=e;const{ctx:o,normalizePosition:i,normalizeDimension:n}=e;o.beginPath(),this.action({state:"START",stackable:!1,position:i(this.bounds.position),dimension:n(this.bounds.dimension)},{event:e})}pointerMove(e){const{position:o,normalizePosition:i,normalizeDimension:n}=e;this.startEvent&&(this.bounds={position:this.startEvent.position,dimension:l(()=>o-this.startEvent.position)},this.action({state:"MOVE",stackable:!1,position:i(this.bounds.position),dimension:n(this.bounds.dimension)},{event:e}))}reset(e){super.reset(e);const{ctx:o}=e;o.clearRect(0,0,o.canvas.width,o.canvas.height)}}class ss extends E{constructor(t){super({...t,type:r.STACK_REDO,options:{}})}click(t,e){super.click(t,e),this.app.actions.stackRedo()}}class os extends E{constructor(t){super({...t,type:r.STACK_UNDO,options:{}})}click(t,e){super.click(t,e),this.app.actions.stackUndo()}}class is extends E{constructor(t){super({...t,type:r.CLEAR,options:{stackable:!0,passive:!0}})}async click(t,e){super.click(t,e),await this.app.actions.startStack(),await this.app.workerManager.action({type:u.USE_TOOL,payload:{tool:this.type,toolOptions:this.options}}),await this.app.actions.stopStack()}}class Dt extends E{constructor(e){super({...e,type:r.ELLIPSE,options:{...e.options,position:l(0,0),dimension:l(0,0)}});a(this,"bounds",{position:l(0,0),dimension:l(0,0)});a(this,"startEvent");a(this,"actionTimeout")}async pointerUp(e){const{normalizePosition:o,normalizeDimension:i}=e;if(!this.startEvent)return;const n=this.bounds;this.startEvent=void 0,await this.app.actions.startStack(),await this.action({state:"STOP",position:o(n.position),dimension:i(n.dimension)},{event:e}),await this.app.actions.stopStack(),this.reset(e)}async pointerDown(e){this.startEvent=e;const{ctx:o,normalizePosition:i,normalizeDimension:n}=e;o.beginPath(),this.action({state:"START",stackable:!1,position:i(this.bounds.position),dimension:n(this.bounds.dimension)},{event:e})}pointerMove(e){const{position:o,normalizePosition:i,normalizeDimension:n}=e;if(!this.startEvent)return;let c=l(()=>o-this.startEvent.position);this.options.square&&(c=l(c.x,Math.abs(c.x)*(c.y<0?-1:1))),this.bounds={position:this.startEvent.position,dimension:c},window.clearTimeout(this.actionTimeout),this.actionTimeout=window.setTimeout(()=>{this.action({state:"MOVE",stackable:!1,position:i(this.bounds.position),dimension:n(this.bounds.dimension)},{event:e})},1e3/60)}reset(e){super.reset(e);const{ctx:o}=e;o.clearRect(0,0,o.canvas.width,o.canvas.height)}}class ns extends Dt{constructor(t){super({...t,type:r.CIRCLE,options:{...t.options,square:!0}})}}class rs extends st{constructor(e){var o;super({...e,type:r.POLYGON});a(this,"lineWidth",2);a(this,"subscription",new ut);a(this,"started",!1);a(this,"preComplete",!1);a(this,"complete",!1);this.subscription.add((o=this.domEvents)==null?void 0:o.keyDown.subscribe(async i=>{this.startEvent&&(i.key===rt.BACKSPACE||i.key===rt.DELETE)&&(this.anchors=this.anchors.filter(n=>n!==this.selectedAnchor),this.render(this.startEvent))}))}destroy(){super.destroy(),this.subscription.unsubscribe()}async pointerDown(e){await super.pointerDown(e);const o=this.getAnchorByPosition(e.position);this.selectedAnchor?o?o!==this.selectedAnchor?(this.preComplete=!1,this.selectedAnchor=o):this.preComplete?(this.complete=!0,this.selectedAnchor=void 0,await this.app.actions.startStack(),await this.action({state:L.STOP,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(i=>e.normalizePosition(i.position)),complete:!0},{event:e}),await this.app.actions.stopStack(),this.reset(e)):o===o&&(this.preComplete=!0):this.complete||(this.selectedAnchor=this.addAnchor(e.position),this.action({stackable:!1,state:L.MOVE,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(i=>e.normalizePosition(i.position))},{event:e})):o?(this.preComplete=!1,this.selectedAnchor=o):(this.action({state:L.START,stackable:!1},{event:e}),this.selectedAnchor=this.addAnchor(e.position),this.started=!0),this.render(e)}async pointerMove(e){var o;this.started&&(await super.pointerMove(e),(o=this.domEvents)!=null&&o.pointerActive&&(this.selectedAnchor&&(this.selectedAnchor.position=e.position),this.render(e),this.action({stackable:!1,state:L.MOVE,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(i=>e.normalizePosition(i.position))},{event:e})))}reset(e){super.reset(e),this.started=!1,this.complete=!1,this.preComplete=!1}render(e){this.anchors.forEach(o=>{o.selected=this.selectedAnchor===o}),e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),this.drawAnchors(e,{stroke:!this.preComplete})}}class as extends E{constructor(t){super({...t,type:r.FILL_TOOL,options:{...t.options,stackable:!0}})}async pointerDown(t){await super.pointerDown(t),await this.app.actions.startStack(),await this.action({},{event:t}),await this.app.actions.stopStack()}}function cs(s,t){const e=l(()=>Math.min(t.dimension,0)),o=l(()=>Math.round(t.position+e));return s.x>=o.x&&s.x<=o.x+Math.abs(t.dimension.x)&&s.y>=o.y&&s.y<=o.y+Math.abs(t.dimension.y)}class ls extends E{constructor(e){super({...e,type:r.CROP,options:{...e.options,stackable:!0}});a(this,"bounds");a(this,"color",new h(255,0,0,255));a(this,"moving",!1);a(this,"startEvent");a(this,"lastEvent");a(this,"moveOffset")}async pointerDown(e){const o=this.bounds&&cs(e.position,this.bounds)||!1;this.moving&&this.bounds&&!o?(await this.app.actions.startStack(),this.action({state:"STOP",stackable:!0},{event:e}),await this.app.actions.stopStack(),this.reset(e)):this.bounds&&!this.moving&&o&&(this.moving=!0,this.action({state:"START",stackable:!1},{event:e})),this.moving?this.moveOffset=l(()=>e.position-this.bounds.position):(this.startEvent=e,this.lastEvent=void 0,await super.pointerDown(e)),this.render(e)}action(e,{event:o}){var c;const i=l(()=>Math.min(this.bounds.dimension,0)),n=l(()=>this.bounds.position+i);return super.action({position:o.normalizePosition(n),dimension:o.normalizeDimension(l(()=>Math.abs(this.bounds.dimension))),copy:((c=this.domEvents)==null?void 0:c.shiftActive)||!1,...e},{event:o})}pointerMove(e){this.startEvent&&(this.moving?this.bounds.position=e.unnormalizePosition(e.fixedPosition(l(()=>e.position-this.moveOffset))):(this.bounds={position:e.unnormalizePosition(e.fixedPosition(this.startEvent.position)),dimension:e.unnormalizeDimension(e.fixedDimension(l(()=>e.position-this.startEvent.position)))},this.lastEvent=e),this.render(e),this.action({state:"MOVE",stackable:!1},{event:e}))}render(e){if(!this.bounds)return;const o=e.ctx;o.clearRect(0,0,o.canvas.width,o.canvas.height),o.strokeStyle=`dotted ${this.color.toHex()}`,o.lineWidth=1,o.setLineDash([6]),o.strokeRect(this.bounds.position.x,this.bounds.position.y,this.bounds.dimension.x,this.bounds.dimension.y)}reset(e){super.reset(e),this.bounds=void 0,this.moving=!1,this.startEvent=void 0,this.lastEvent=void 0,this.moveOffset=void 0}}class ps extends E{constructor(e){super({...e,interactingMove:!1,type:r.COLOR_PICKER,options:{}});a(this,"lastColor")}async pointerDown(e){await super.pointerDown(e),this.lastColor&&this.app.options.select.color.primaryColor.setColor(this.lastColor)}async pointerMove(e){if(this.getDisplay()){const{payload:i}=await this.action({},{event:e}),n=e.ctx;n.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height);const{color:c,position:p}=i;i.color&&(this.lastColor=c,hs(n,l(10,10),{color:c,position:p}))}}}function hs(s,t,e){s.fillStyle="#000",s.fillRect(t.x,t.y,188,32),s.fillStyle=e.color.toHex(),s.fillRect(t.x+6,t.y+6,20,20),s.fillStyle="#fff";const o=10,i=l(()=>t+l(32,4+o));s.font=`${o}px "BitFontCanvas"`,s.fontKerning="normal",s.letterSpacing="0px",s.fillText(`Color   : ${e.color.toHex()}`,i.x,i.y),s.fillText(`Position: ${e.position.x},${e.position.y}`,i.x,i.y+o+4)}class us extends E{constructor(t){super({...t,type:r.ZOOM,options:{passive:!0}})}async click(){const t=this.getDisplay();t&&(await t.actions.setPosition(l(0,0)),await t.actions.setZoom(l(0,0),0),await t.action({type:u.ZOOM_FIT,payload:{}}))}}class ds extends E{constructor(t){super({...t,type:r.SPLIT_SCREEN,options:{}})}async click(t,e){super.click(t,e);const{value:o}=await this.actions.prompt({type:"number",text:"Screen Count? (1-4)",value:1,min:1,max:4,size:1,step:1,required:!0});this.app.setDisplays(o)}}class ms extends Et{constructor(t){super({...t,options:{...t.options,abstract:!0}})}async execute(t){this.options.stackable&&await this.app.actions.startStack(),await this.app.workerManager.action({type:u.USE_TOOL,payload:{tool:this.type,toolOptions:{...this.options,...t}}}),this.options.stackable&&await this.app.actions.stopStack()}action(t={}){const e={...this.options,...t};this.app.workerManager.action({type:u.USE_TOOL,payload:{tool:this.type,toolOptions:e}})}}class fs extends ms{constructor(t){super({...t,type:r.IMAGE_OPERATION,options:{stackable:!0}})}}const A={[r.NONE]:We,[r.ZOOM]:Ze,[r.MAGNIFY]:Ge,[r.CONTINUOUS_FREEHAND]:Xe,[r.STRAIGHT_LINE]:$e,[r.CURVE_LINE]:Ye,[r.DOTTED_FREEHAND]:Ct,[r.AIR_BRUSH]:qe,[r.RECTANGLE]:es,[r.CIRCLE]:ns,[r.ELLIPSE]:Dt,[r.POLYGON]:rs,[r.STACK_REDO]:ss,[r.STACK_UNDO]:os,[r.FILL_TOOL]:as,[r.CROP]:ls,[r.CLEAR]:is,[r.ZOOM_FIT]:us,[r.COLOR_PICKER]:ps,[r.SPLIT_SCREEN]:ds},gs={[r.IMAGE_OPERATION]:fs};function As(s){switch(s){case r.IMAGE_OPERATION:return gs[r.IMAGE_OPERATION];default:throw new Error(`Tool ${s} is not implemented.`)}}function Js(s){switch(s){case r.NONE:return A[r.NONE];case r.ZOOM:return A[r.ZOOM];case r.MAGNIFY:return A[r.MAGNIFY];case r.CONTINUOUS_FREEHAND:return A[r.CONTINUOUS_FREEHAND];case r.DOTTED_FREEHAND:return A[r.DOTTED_FREEHAND];case r.STRAIGHT_LINE:return A[r.STRAIGHT_LINE];case r.CURVE_LINE:return A[r.CURVE_LINE];case r.AIR_BRUSH:return A[r.AIR_BRUSH];case r.RECTANGLE:return A[r.RECTANGLE];case r.CIRCLE:return A[r.CIRCLE];case r.ELLIPSE:return A[r.ELLIPSE];case r.POLYGON:return A[r.POLYGON];case r.FILL_TOOL:return A[r.FILL_TOOL];case r.CROP:return A[r.CROP];case r.STACK_REDO:return A[r.STACK_REDO];case r.STACK_UNDO:return A[r.STACK_UNDO];case r.CLEAR:return A[r.CLEAR];case r.ZOOM_FIT:return A[r.ZOOM_FIT];case r.COLOR_PICKER:return A[r.COLOR_PICKER];case r.SPLIT_SCREEN:return A[r.SPLIT_SCREEN];default:throw new Error(`Tool ${s} is not implemented.`)}}const ys=Ut(({core:s})=>{let t,e,o,i,n,c,p;return[{meta:[[W.SYMBOL,et.WEB_PAINT]],id:"WebPaint.app",name:"Web Paint",createdDate:new Date(2017,7,5).getTime(),editedDate:new Date(2025,5,29).getTime(),async action(){var ot,it;if(!((ot=s.modules.screen)==null?void 0:ot.contentLayout))throw new Error("Content layout not found");const y=new He({options:{select:{brush:yt(),tool:wt(),color:vt()},display:{colors:{background:h.fromHex(s.config.get(_.WEB_PAINT_DISPLAY_BACKGROUND)),foreground:h.fromHex(s.config.get(_.WEB_PAINT_DISPLAY_FOREGROUND)),grid:h.fromHex(s.config.get(_.WEB_PAINT_DISPLAY_GRID_COLOR))}}}},s.config),f=Bt({fsItem:void 0,app:y,actions:_t(y)}),X=f.app;await X.setup(),X.workerManager.ready.then(async()=>{X.setDocument(At(l(256,256)))});const B=(it=s.modules.windows)==null?void 0:it.addWindow({component:await I(()=>import("./B-sd0E2v.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47]),import.meta.url).then(P=>P.default),componentData:{core:s,model:f},options:{title:"Web Paint",embed:!0,borderless:!0}},{group:"extras13WebPaint",full:!0});f.actions.setTheme(Je),B==null||B.awaitClose().then(()=>{var P;[t,e,o,i,n].forEach(U=>U==null?void 0:U.close()),(P=s.modules.screen)==null||P.setTheme(void 0)});function _t(P){const U={setTheme:m=>{var R,D;s.config.get(_.WEB_PAINT_NATIVE_THEME)&&((R=s.modules.screen)!=null&&R.currentTheme)?s.modules.screen.setTheme(Ve(s.modules.screen.currentTheme)):(D=s.modules.screen)==null||D.setTheme(m)},import:async m=>{P.setDocument(await Re(m))},export:async m=>{const R=await I(()=>import("./CshrRwMP.js").then(D=>D.F),__vite__mapDeps([48,39]),import.meta.url).then(D=>D.default);try{const D=await P.getImageData();let V=await jt(D);m.resize&&(V=await Xt(V,m.resize.x,m.resize.y));const Tt=await V.convertToBlob({type:m.type,quality:m.quality}),Pt=m.type.split("/")[1]||"png",Ot=(m.filename||`webpainting_${Date.now()}`)+`.${Pt}`;await R.saveAs(Tt,Ot)}catch(D){console.error("An error occurred during export.",D)}},useAbstractTool:(m,R)=>{const D=As(m);if(!D)throw new Error(`Tool ${m} is not implemented`);return new D({app:P,actions:U}).execute(R)},openValueInput:m=>d(m),async prompt(m){return(await d(m)).awaitClose()},openInfo:()=>T(f),openSettings:()=>g(f),openExport:()=>bt(f),close:()=>{B==null||B.close()},focus:()=>{B==null||B.focus()},newDocument:async()=>{f.fsItem=void 0,await P.setDocument(new H({name:"New Document",meta:{dimension:l(640,480)}}))},openDocument:async()=>{await Ss(s,f)},saveDocument:async()=>{await ht(s,f)},saveAsDocument:async()=>{await ht(s,f,!0)},documentResize:async m=>{await P.actions.resize(m)},documentResizeCanvas:async m=>{await P.actions.resizeCanvas(m)},openResize:()=>ws(s,f,!0),openResizeCanvas:()=>vs(s,f,!0),openColorPalette:()=>C(s,f),openColorPicker:m=>z(m),openDebugColorPickers:()=>It(),openDebugColorPicker:()=>kt()};return U}}}];async function g(w){var y;return o||(o=(y=s.modules.windows)==null?void 0:y.addWindow({component:await I(()=>import("./BZV9yeIf.js"),__vite__mapDeps([49,23,2,24,50,51,52,53,54,55,25,1,3,4,26,56,57,58,59,8,15,14,16,13,17,18,29,30,31,32,33,34,35,36,7,37,38,28,39,40,41,21,42,43,44,45,46,12,60]),import.meta.url).then(f=>f.default),componentData:{model:w},options:{title:"Settings"}},{group:"extras13WebPaint"}),o==null||o.awaitClose().then(()=>{o=void 0}),o)}async function d(w){var y;return p||(p=(y=s.modules.windows)==null?void 0:y.addWindow({component:await I(()=>import("./CXNmtCei.js"),__vite__mapDeps([61,23,2,24,62,51,52,63,64]),import.meta.url).then(f=>f.default),componentData:{...w},options:{title:"Value Input",embed:!0,center:!0,borderless:!0,filled:!0}},{group:"extras13WebPaint"}),p==null||p.awaitClose().then(()=>{p=void 0}),p)}async function T(w){var y;return t||(t=(y=s.modules.windows)==null?void 0:y.addWindow({component:await I(()=>import("./8BG5ErYJ.js"),__vite__mapDeps([65,66,1,2,3,4,67,68]),import.meta.url).then(f=>f.default),componentData:{model:w},options:{title:"Info"}},{group:"extras13WebPaint"}),t==null||t.awaitClose().then(()=>{t=void 0}),t)}async function C(w,y){return i||(i=w.modules.windows.addWindow({component:await I(()=>import("./BhXCp3Nl.js"),__vite__mapDeps([69,2,23,24,56,57,58,59,70,51,52,71,25,1,3,4,26,19,12,8,7,20,14,16,13,17,21,15,18,10,22,29,30,31,32,33,34,35,36,37,38,28,39,40,41,42,43,44,45,46,72]),import.meta.url).then(f=>f.default),componentData:{core:w,model:y},options:{title:"Color Palette",filled:!0}},{group:"extras13WebPaint"}),i.awaitClose().then(()=>{i=void 0}),i)}async function z(w){return i||(i=s.modules.windows.addWindow({component:await I(()=>import("./DjU6ewvR.js"),__vite__mapDeps([73,74,8,2,75,70,51,52,71,62,63,23,24,56,57,58,59,1,3,4,15,14,16,13,17,18,29,30,31,32,33,34,35,36,7,37,38,28,39,40,41,21,42,43,44,45,46,12,76]),import.meta.url).then(y=>y.default),componentData:{color:w},options:{title:"Color Picker",filled:!0}},{group:"extras13WebPaint"}),i.awaitClose().then(()=>{i=void 0}),i)}async function bt(w){var y;return e||(e=(y=s.modules.windows)==null?void 0:y.addWindow({component:await I(()=>import("./DwQFt5ES.js"),__vite__mapDeps([77,8,23,2,24,62,51,52,63,70,71,56,57,58,59,78]),import.meta.url).then(f=>f.default),componentData:{model:w},options:{title:"Export"}},{group:"extras13WebPaint"}),e==null||e.awaitClose().then(()=>{e=void 0}),e)}async function It(){return n||(n=s.modules.windows.addWindow({component:await I(()=>import("./D5c8sBxY.js"),__vite__mapDeps([79,74,8,2,75,62,51,52,63,1,3,4,15,14,16,13,17,18,29,30,31,32,33,34,35,36,7,37,38,28,39,40,41,21,42,43,44,45,46,12,80]),import.meta.url).then(w=>w.default),componentData:{},options:{title:"Debug Color Pickers",scrollY:!0}},{group:"extras13WebPaint"}),n==null||n.awaitClose().then(()=>{n=void 0}),n)}async function kt(){return c||(c=s.modules.windows.addWindow({component:await I(()=>import("./DjU6ewvR.js"),__vite__mapDeps([73,74,8,2,75,70,51,52,71,62,63,23,24,56,57,58,59,1,3,4,15,14,16,13,17,18,29,30,31,32,33,34,35,36,7,37,38,28,39,40,41,21,42,43,44,45,46,12,76]),import.meta.url).then(w=>w.default),componentData:{},options:{title:"Debug Color Picker",filled:!0}},{group:"extras13WebPaint"}),c.awaitClose().then(()=>{c=void 0}),c)}});async function ws(s,t,e=!1){var i;const o=(i=s.modules.windows)==null?void 0:i.addWindow({component:await I(()=>import("./B09nj9Vp.js"),__vite__mapDeps([81,8,23,2,24,62,51,52,63,70,71,56,57,58,59,9,82]),import.meta.url).then(n=>n.default),componentData:{model:t},options:{title:"Document Resize"}},{group:"extras13WebPaint"});return e?o:o==null?void 0:o.awaitClose()}async function vs(s,t,e=!1){var i;const o=(i=s.modules.windows)==null?void 0:i.addWindow({component:await I(()=>import("./XHMkfcx0.js"),__vite__mapDeps([83,8,23,2,24,62,51,52,63,56,57,58,59,1,3,4,15,14,16,13,17,18,29,30,31,32,33,34,35,36,7,37,38,28,39,40,41,21,42,43,44,45,46,12,84]),import.meta.url).then(n=>n.default),componentData:{model:t},options:{title:"Document Resize Canvas"}},{group:"extras13WebPaint"});return e?o:o==null?void 0:o.awaitClose()}async function ht(s,t,e=!1){const o=await t.app.getImageData(),i=await qt(o);console.log("Saving content:",i);let n=Object.assign({[Q.OUTPUT_TYPE]:"image",[Q.CONTENT]:i});n=await btoa(JSON.stringify(n));let c;return!e&&t.fsItem?(c=await $t(s,{path:t.fsItem.getPath(),data:n}),c?await s.executeCommand('openDialog "File saved."'):await s.executeCommand('openDialog "File could not be saved."'),c):(t.fsItem=await Yt(s,{data:n,extension:"img"}),t.fsItem)}async function Ss(s,t){const e=await s.executeCommand("openFileDialog");if(e)if(Q.CONTENT in e.value)t.app.setDocument(await Fe(await Es(e.value[Q.CONTENT]))),t.fsItem=e.fsItem;else throw new Error("Can't read file content")}function Es(s){return new Promise(t=>{const e=new Image;e.src=s,e.onload=()=>t(e)})}const Cs=Rt(async({core:s})=>{var t;return s.config.setDefaults(ae()),(t=s.modules.symbols)==null||t.addSymbols([{key:et.WEB_PAINT,component:await I(()=>import("./DMfFyVJu.js"),__vite__mapDeps([85,2]),import.meta.url).then(e=>e.default),group:"disk_web_paint"}]),{meta:[[W.SYMBOL,Ft.DISK_2],[W.WINDOW_SYMBOL_REARRANGE,!0],[W.VISIBLE,!0]],name:"Web Paint",items:[...await ys({core:s})]}}),Ws=Object.freeze(Object.defineProperty({__proto__:null,default:Cs},Symbol.toStringTag,{value:"Module"}));export{k as B,_ as C,Qs as D,se as O,j as P,gt as S,r as T,u as W,Vs as a,Hs as b,h as c,Js as d,O as e,ae as f,zs as g,ce as h,Ws as i,Je as t};
