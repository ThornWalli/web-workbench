import{M as p,a as k}from"./Ca2pXi7A.js";import{C as f}from"./uY512OOx.js";import{g as v,T as _}from"./Ch88JnIe.js";import{T,c as y}from"./C5CmDDFA.js";import{C as m}from"./CqY9ri8T.js";import{N as C,u as g}from"./Dh1w0NNw.js";import{T as b}from"./Bifp7azt.js";import{u as x}from"./CIYo2XrQ.js";import{_ as N,a6 as E,Q as $,g as l,t as o,v as n,z as u,K as w,a9 as M,x as d,F as P,$ as R,a0 as V,L as S,C as j}from"./CI217tZ_.js";import"./C0_snZds.js";import"./BhIZyK9R.js";import"./C5mdboMC.js";import"./Ch9TGLTe.js";import"./BPi9IPjj.js";import"./B7OE2rZX.js";import"./C1Z8QYso.js";import"./BrQUI1fL.js";import"./CDk6Z4eJ.js";const I={components:{Navigation:C,SynthesizerTimelineCanvas:b},props:{model:{type:Object,required:!0}},emits:["refresh"],async setup(t){const e=E(t,"model"),s=x();return $(e,()=>{s.setContextMenu(y,{model:e.value,preserveContextMenu:s.preserveContextMenu})},{immediate:!0,deep:!0}),{...s,...await g()}},data:function(){return{toneDestination:null,tracksEdit:{}}},computed:{timelineRefreshKey(){return`timeline-${this.bpm}`},project(){return this.model[m.SYNTHESIZER_PROJECT]},tracks:{get(){return this.project.tracks},set(t){this.project.tracks=t}},bpm(){return Number(this.model[m.SYNTHESIZER_BPM])},controlsNavigation(){return{model:this.model,items:[[{text:`Project: ${this.project.name} | Tracks: ${this.tracks.length}`}]]}},masterVolume(){return this.core.config.observable[f.SCREEN_CONFIG].soundVolume},decibelValue(){return v(this.masterVolume)}},watch:{masterVolume:{handler(){p.volume.value=this.decibelValue},immediate:!0},tracks(){this.$nextTick(()=>{this.$emit("refresh")})},bpm:{handler(t){const e=this.tone.transport;e.stop(),e.bpm.value=120,e.seconds=0,e.bpm.value=t,e.start()}}},mounted(){this.$nextTick(()=>{console.log(this.tracks),this.editTrack(this.tracks[0],{})}),this.$nextTick(()=>{this.$emit("refresh")})},unmounted(){this.model.actions.closeTracks()},methods:{async onClickPlay(){await this.tone.start(),this.players=this.tracks.map(s=>{const r=new T(s,{autoplay:!1});return r.createInstrument("Synth"),r});const t=k;t.stop(),t.seconds=0,t.start(),this.players.map(s=>s.play()).map(s=>s.start(0))},getControls(t){const e=t.getDuration();return{items:[{text:t.name},{spacer:!0},{text:` ${e}`},{label:"Edit",onClick:async()=>{await this.tone.start(),this.editTrack(new _(t),{toneDestination:this.toneDestination})}},{label:"Remove",onClick:async()=>{this.preserveContextMenu(!0),await this.model.actions.removeTrack(t),this.preserveContextMenu(!1),this.$emit("refresh")}}]}},async editTrack(t){this.tracksEdit[t.id]=!0;const{close:e}=this.model.actions.editTrack(t),s=await e;this.tracks=this.tracks.map(r=>r.id===s.id?s:r),this.tracksEdit[t.id]=!1,this.$nextTick(()=>{this.$emit("refresh")})}}},z={class:"wb-disks-extras13-synthesizer-project"},D={class:"tracks"},F={key:0,class:"no-tracks"},B={class:"sheet"};function O(t,e,s,r,q,a){const c=l("navigation"),h=l("synthesizer-timeline-canvas");return o(),n("div",z,[u(c,w(M(a.controlsNavigation)),null,16),d("div",D,[a.tracks.length<1?(o(),n("div",F,"No tracks availableâ€¦")):P("",!0),(o(!0),n(R,null,V(a.tracks,i=>(o(),n("div",{key:i.id,class:"track"},[u(c,S({ref_for:!0},a.getControls(i)),null,16),d("div",B,[(o(),j(h,{key:a.timelineRefreshKey,track:i,static:t.tracksEdit[i.id],onRefresh:e[0]||(e[0]=G=>t.$emit("refresh"))},null,8,["track","static"]))])]))),128))])])}const nt=N(I,[["render",O],["__scopeId","data-v-5995b8bf"]]);export{nt as default};
