const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DrLItpjK.js","./CVVDEXDJ.js","./DS57oB6w.js","./B2YYxTED.js","./D1WZfvAb.js","./BfpYGSxR.js","./jSR9Z_uS.js","./CXbNF4JJ.css","./CYV3YR6m.css","./CqSni2Z7.css","./BoPkp3Jd.js","./Dnkwg0NB.js","./CHLd88nu.css","./CnxF4DWy.js","./Bn0T8SwD.css","./Caob76XJ.js","./CiACgkXc.css","./CP7cPb5u.js","./BWKGU6Bw.js","./DEAznjDA.css","./CuhyRvkQ.css","./CCnhm4BD.js","./DaDAJXAw.css","./BHmTNEz3.js","./DL1FsYWj.js","./B-meQdOw.js","./Caivkp23.js","./CrNGlbV0.js","./D7Us3e3D.js","./tbUmQ5LT.js","./CS1Zomql.js","./CcnVWkhV.js","./CY5IK1Gp.js","./Dw-z6kis.js","./ytSRQE8W.js","./B15fucc8.js","./BteAwo4N.js","./BVLmgizW.js","./Cy0zoxeo.js","./BENg2Ku2.js","./CJFEEUyp.js","./C98WWl5r.js","./CxZzHJhT.js","./BSzGBLGV.js","./D3MPJlJW.js","./GLWL0ZEA.js","./Cah-phv7.js","./DAKnsb8o.js","./I81pZH22.js","./CV0dHcg-.js","./BwmmqXVL.css","./WX6nxCVc.js","./QXLAWCbs.js","./DDPzVXKz.js","./BEk8nzL5.js","./4lgYwaTL.css","./BD_7eT_q.js","./DYBHEnkm.css","./Hx5fWSap.js","./DRWqrzG7.css","./DrHRnNNk.css","./CVDnhf5e.js","./CW9EoNRC.css","./CdaMbG_B.js","./CKWlAQDQ.js","./wrAs3tFC.css","./CWuLX2Uz.js","./Dibm4qJw.css","./B-pwzKj4.js","./DdO-3S9B.js","./B1k18Rg6.js","./CIasQYz1.js","./D3xLGof4.js","./XpcfcaDj.css","./Bsj8ZD74.js","./SfinneV3.js","./BqFfl9wP.css","./BJPTWp8v.css","./jToR-qje.js","./Dm0I8L0q.css","./Bez2b_CZ.js","./BfgCdWpr.js","./BB6FUOrg.js","./Dkhtr-D7.js","./CB0fCJMd.js","./D9cLd5gA.css","./fyetJ82d.js","./BN8hnlQc.css","./BkgtTaLw.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,__publicField=(t,o,i)=>((t,o,i)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i)(t,"symbol"!=typeof o?o+"":o,i);import{L as t,K as o}from"./BfpYGSxR.js";import{c as i,I as s,h as n,S as a}from"./D1WZfvAb.js";import{i as r,I as c}from"./BHmTNEz3.js";import{a as l,b as p,f as d}from"./DL1FsYWj.js";import{o as h,c as m}from"./CS1Zomql.js";import{O as u}from"./D7Us3e3D.js";import{c as g,t as f,l as A}from"./ytSRQE8W.js";import{f as y}from"./Dw-z6kis.js";import{S as w}from"./CrNGlbV0.js";import{u as C,i as E,a as b,b as _,r as v,c as S}from"./BteAwo4N.js";import{K as I,a as T}from"./Cy0zoxeo.js";import{e as O,s as D}from"./BENg2Ku2.js";import{T as P,g as k}from"./Cah-phv7.js";import{t as R}from"./DAKnsb8o.js";var B=(e=>(e.CONTENT="content",e.OUTPUT_TYPE="type",e))(B||{}),L=(e=>(e.WEB_PAINT_DISPLAY_BACKGROUND="extras13_web_paint_display_background",e.WEB_PAINT_DISPLAY_FOREGROUND="extras13_web_paint_display_foreground",e.WEB_PAINT_GRID_COLOR="extras13_web_paint_display_grid_color",e.WEB_PAINT_FIT_IMAGE_ACTIVE="extras13_web_paint_fit_image_active",e.WEB_PAINT_FIT_IMAGE_OFFSET="extras13_web_paint_fit_image_offset",e.WEB_PAINT_NATIVE_THEME="extras13_web_paint_native_theme",e.WEB_PAINT_PALETTES="extras13_web_paint_palettes",e.WEB_PAINT_GRID_LINE_WIDTH="extras13_web_paint_grid_line_width",e.WEB_PAINT_GRID_VISIBLE_COUNT="extras13_web_paint_grid_visible_count",e.WEB_PAINT_DEBUG="extras13_web_paint_debug",e))(L||{}),x=(e=>(e.LEFT_TOP="left_top",e.TOP="top",e.RIGHT_TOP="right_top",e.LEFT="left",e.CENTER="center",e.RIGHT="right",e.LEFT_BOTTOM="left_bottom",e.BOTTOM="bottom",e.RIGHT_BOTTOM="right_bottom",e))(x||{});function getDefaultConfig(){return{[L.WEB_PAINT_DISPLAY_BACKGROUND]:"#CCCCCCFF",[L.WEB_PAINT_DISPLAY_FOREGROUND]:"#FFFFFFFF",[L.WEB_PAINT_FIT_IMAGE_ACTIVE]:!0,[L.WEB_PAINT_FIT_IMAGE_OFFSET]:.1,[L.WEB_PAINT_NATIVE_THEME]:!1,[L.WEB_PAINT_DEBUG]:!1,[L.WEB_PAINT_GRID_COLOR]:"#00000033",[L.WEB_PAINT_GRID_LINE_WIDTH]:1,[L.WEB_PAINT_GRID_VISIBLE_COUNT]:10}}const M={LENNA:""+new URL("pWAMfWPQ.jpg",import.meta.url).href,DISK:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQQAAAEGCAYAAACDwOsBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAkTSURBVHgB7d1Bctw2FgZgaioHic8wuYCrrDM5O2/jM8kLHyBzBh9FU0qZr2RGEAESJAHw+zapSM1md0d5+PkAoh+m/j1PcB8P04H+MwH8dGi1OYmEwB0d8v+uhACEYRPC589/Tz35+vWPN3/+9PQ00Y7Hx8c3f37031vq72Oq/P+whAAEBQE68JJAEinkearYR1MQgPDbBB1KXcvX0mrvZk4Jb/QU5pSwq6cgIQBBQYAOHdVTUBCAoIfAUErXA7wzv9+F2j0FCQEICgIMoFZPQUEAgoIAA9mbFBQEICgIMKCtSUFBAIKCAAMrTQoKAhAUBLiB3KSgIADBvQxwI2v3PkgIQFAQgKAgAEFBAIKCAAQFAQgKAhAUBCAoCECwUpGh9L6L8tUkBCAoCEBQEICgh0CXWv125t5JCEBQEICgIABBQQCCggAEswyNe3x8nOAsEgIQFAQgKAhA0ENoROJbdeBUEgIQFAQgKAhAUBCAoCAAQUEAgoIABAUBCAoCEBQEICgIQFAQgKAgAEFBAIKCAAQFAQgKAhAUBCAoCEBQEICgIABBQQCCggAEBQEICgIQFAQgKAhAUBCAoCAAQUEAgoIABAUBCAoCEBQEICgIQFAQgKAgAEFBAIKCAITfpn49Tw37+vWP6QifP/89wVEkBCD0lBCaTgQpz89vv+yHh4dpizl5SAocQUIAQssJ4c2hdTnibh1pcx3VC0glh9n8vlLv96jXRR+OSogSAhBaSgjvDplrI2pr9r7e+fhlUjg7IXEvEgIQWkgIWb2C1pw9Uqd6Cku9JSned3YClBCAcGVC+GUoM7LB9SQEIPR8L0MTltd4kg49kxCAcEVCGKJ3YP6fEUkIQFAQKntJDtIDvVIQgHBmD+FW6w5yVxZCSyQEIFiHUNnyLsVeksKff/4v63F//fXfTcetPU9K6vlzj89V+j5qn78VEgIQzkgIt+gdLN9XKim0ah7xSkfk3MRQOqJuTR6ltp5nPm60pCAhAEEPYSF3r8LcpLNMClv12oNYJo+1RDH/vrRXUauXkXo9qfONlhQkBCCclhBaH+FqJ4Nax9WyNvKVXvuXjqRnO+r1XPV+ziIhAOHI1vcpswupa/PcfeuPTgZHK92PIfdaf/nz0udLPf/e51l7vqNfz9bPaau9f98pqb97CQEIt5tl6D0R7FV7JKv1fKM+T28kBCAckRCaXJk4WjI4ay/HUVfk1TbK5yQhAKHmLENWMqh991+tewQkA1pklgG4zJ4ewqbvZEyt7a890v348eOXf//w4cOh5ztKaoSQDDjCsNOOv//++wSU2VIQqswirO0XsNaDWNP7tbZeAVfQQwBCSUI4ZH1Bqqcw+v4BKVclg713L+7dI3HrebceX3ovw13WYUgIQMgZhi9deZibFHq/xm6lZ1C6b8LWkXNrItn6uNxkc9Yuz7msQwAu814PoelkMErXvbXZhOX9/qX7FPR27T36DkilJAQgNLcwaXmvw6jfkdjqOoOt1+Jbn/8qazsf3TU5SAhAeCshXNI7SK1DkAzOUevaf60HkRqBU/sJlPY0Sl+3fR5+JSEA4XVCODUZ3OUuvl7e59l7LRrJ2yQhAOH0WQazCGOx5+JYJAQgvAxjl37DkmQAae5lAC5zWA/hbnsBSgaMQEIAQvWEcJdZBBiRhACEagnhLvcinOXbt29Fj//06dOu40stz3fWeVOvI3Xetd/vPe8s9/lTn1srJAQgVFuHcPdEcPQsw9oImHtc7shWOrJuTQy1jiv9fLa+772fdynrEIDLVOsh6BVc4+hr19ykMP8+9zx7X8/yvLn2juCj9ApSJAQgDPtlr3exNmJuvUZfjvhHdeu3OjsZpI6r3TO4moQABAlhEKUj1dEjWa0ufenv1x5f632PlgxmEgIQJITOPD4+vvnzp6enf/5ZOlLlrh+ZR8Tl+VPnTT1uTeq4tfMe9U1ftT/v1kkIQJAQOldrpEqtI8hNBltXJC7Ps5SbSFJyk0muUZPBTEIAgoTQqdojVepaeXm+2TIZrB0/X+OnRuzc85e+3/l5935eoyeDmYQAhNN2XR6dPRU5grsdgcsoCJW8JILXqeClsq/NjUNrFAQg6CFUJhXQMwkBCApCZcteAvREQQCClYonmVPDx48fp+/fv//r51fJ7Xns3Y379Y8mmiUhnOzLly8TtMosw0FyVy5etcLx6GTwznkkhIZJCEDQQ7hIaoQ+OjGclQzok4QABAnhJFtXMNb6zkzJgBwSAhAkhIutjcjzyL41KQycDHJf8MPG49aeJ+V55/G5St9H1vklBCBYh3CQ5Yi+txdQOvtwdTI4cf3B3hG51oi+9kHWev97/4O9+zokBCDoIXRimTRSicNsQrazkkEtpQnkeeV53nyfEgIQJITOpJJC6fFH6eDehdqzALVmMUrPc8jzSAhAkBBOVnu2IZeewWnrA65SZZZDQgCChHCwrbMBtUb03PMOvO/B6MmgKgkBCBLCSY5aaVjrvAN+N+XdksHabMe76w9mEgIQJISTbF1RWPu8uY/LnQ3paM/E3pNBrXslrFQE8kgIF6l1jX5U0qh1l2YDjk4GuR/M8nEPhb9/SDxuWvn5tPK8v5AQgPCvhDDAiMAJOugdjD6bYMck4Fivq4adkyo6e14/tUPT1vMXrLC04m8gEgIQzDIMIpUMcp21LoK2SQhAkBAGVbqzUqpX8M5xIsWAJAQgSAiDSa0wXEsIa7MSr34vGQxMQgCChDCo0lmHjH0SJIMbkBCAICFU1trOQ6X7GViJeG8SAhAkhEp635NQr4AXEgIQJISdek0GegW8RUIAwm0TQu27++wfwQgkBCDoIezU8WxC/GiCnyQEIEgIP43eA5AMyCEhAEFBAIKCAAQ9hMHpHVBCQgCChDAoyYAtJAQgKAhAUBCAoIcwCN+wRA0SAhAkhE5l7OcgGVBMQgCChNC4gp2dJAJ2kxCAICE0JrWLs5WHnEFCAIKE0DjfqMSZJAQgSAjtkww4jYQABAUBCAoCEBQEICgIQFAQgKAgAEFBAIKCAAQFAQgKAhAUBCAoCEBQEICgIABBQQCCggCE17vxPE+0yI5JnEZCAIKCAAQFAQj/BxP176+Lo3jpAAAAAElFTkSuQmCC",WEB_PAINTING:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAcCAYAAAATFf3WAAAACXBIWXMAAAWJAAAFiQFtaJ36AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFySURBVHgBzZcBksIgDACTTh9wT7hP6SP1U/eTHtQGaJrEhDqVnVGxk8IaAlSEMVmogTAeS2JtICJMMBZFjhgpgzu5nL31A8ZAlCtvX0aV2zUiHTrjPH2bct5O1A4t8Fg9aPUlyYkXPiEnwYU9cpnLtpksRFJeucyl+2CWichlLhPkU9zImnUzg4/z9Xd71DbAbrrTtfwFewWl1cYDZClik7PiNVpB8S7XVpAywOOWx+3Vvj9r4PMuyllZxBqj/yqqF6Ood08gJFfu3yRTzF/6+NXGkPqeQJHLN9DrLI3wDwSZW6G3A9WpOFx30i/YTKFJz2rOU9y7C8x8cFMyFfkKbRlUW7QgWP01tQe9IEhPsdK5SXJEkuQrlBN8sEBNECxJUU6TbOXYSu6Ry0w17pg1U+4DRM9iFOuPnQIcLVNaZreBXHJawOsEl+pHyiZbMKUTQbxJgHtztQJ10SA9YpEbimFElpVL93EU/k8SiD1/Rib+AQhe0VUs7Fs4AAAAAElFTkSuQmCC",CUBY:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAVCAYAAABCIB6VAAAACXBIWXMAAAWJAAAFiQFtaJ36AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAB7SURBVHgB7ZXdDoAgCIUPjmftoXpZ+7moaSjYoNbWd+HmPB4ZIhKAjAB4Hydn75mQEMT3jLmYrbm50Mq/ouV6LedzkUjYbNSKqdAMLdqkRaLR0rI1AometjQeeSiK9sVyG6FbbrhHHdJDqRBO9jF2bJ9/2zzY7irkz1sAUAkbb2UHezIAAAAASUVORK5CYII="};var F=(e=>(e.WEB_PAINT="web_paint",e))(F||{}),N=(e=>(e.DEFAULT="default",e.REFRESH="refresh",e.REFRESH_SUCCESS="refreshSuccess",e.DEBUG="debug",e.INIT="init",e.INIT_SUCCESS="initSuccess",e.SYNC_STATE="syncState",e.SYNC_STATE_SUCCESS="syncStateSuccess",e.ADD_RENDER_WORKER_PORT="addRenderWorkerPort",e.ADD_RENDER_WORKER_PORT_SUCCESS="addRenderWorkerPortSuccess",e.LOAD_IMAGE="loadImage",e.LOAD_IMAGE_SUCCESS="loadImageSuccess",e.UPDATE_CANVAS="updateCanvas",e.UPDATE_BUFFER="updateBuffer",e.UPDATE_BUFFER_SUCCESS="updateBufferSuccess",e.STACK="stack",e.STACK_SUCCESS="stackSuccess",e.UNDO_STACK="undoStack",e.UNDO_STACK_SUCCESS="undoStackSuccess",e.REDO_STACK="redoStack",e.REDO_STACK_SUCCESS="redoStackSuccess",e.CLEAR="clear",e.CLEAR_SUCCESS="clearSuccess",e.SET_ZOOM="setZoom",e.SET_ZOOM_SUCCESS="setZoomSuccess",e.ZOOM_FIT="zoomFit",e.ZOOM_FIT_SUCCESS="zoomFitSuccess",e.SET_POSITION="setPosition",e.SET_POSITION_SUCCESS="setPositionSuccess",e.USE_TOOL="useTool",e.USE_TOOL_SUCCESS="useToolSuccess",e.SET_SELECT_OPTIONS="setSelectOptions",e.SET_SELECT_OPTIONS_SUCCESS="setSelectOptionsSuccess",e.GET_DATA="getData",e.GET_DATA_SUCCESS="getDataSuccess",e.RESIZE="resize",e.RESIZE_SUCCESS="resizeSuccess",e.RESIZE_CANVAS="resizeCanvas",e.RESIZE_CANVAS_SUCCESS="resizeCanvasSuccess",e.GET_COLORS="getColors",e.GET_COLORS_SUCCESS="getColorsSuccess",e.IMAGE_OPERATION="imageOperation",e.IMAGE_OPERATION_SUCCESS="imageOperationSuccess",e.COLOR_PICKER="colorPicker",e.COLOR_PICKER_SUCCESS="colorPickerSuccess",e.SET_OPTIONS="setOptions",e.SET_OPTIONS_SUCCESS="setOptionsSuccess",e))(N||{});function hslToRgb(e,t,o){let i,s,n;if(0===t)i=s=n=o;else{const hue2rgb=(e,t,o)=>(o<0&&(o+=1),o>1&&(o-=1),o<1/6?e+6*(t-e)*o:o<.5?t:o<2/3?e+(t-e)*(2/3-o)*6:e),a=o<.5?o*(1+t):o+t-o*t,r=2*o-a;i=hue2rgb(r,a,e/360+1/3),s=hue2rgb(r,a,e/360),n=hue2rgb(r,a,e/360-1/3)}return{r:Math.round(255*i),g:Math.round(255*s),b:Math.round(255*n)}}class Color{constructor(e,t=0,o=0,i=255){if(__publicField(this,"r"),this.g=t,this.b=o,this.a=i,Array.isArray(e))[this.r,this.g,this.b,this.a]=e;else if("string"==typeof e){const t=Color.fromHex(e);this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}else"object"==typeof e?(this.r=e.r||0,this.g=e.g||0,this.b=e.b||0,this.a=void 0!==e.a?e.a:255):(this.r=e,this.g=t||0,this.b=o||0,this.a=void 0===i?255:i);this.r=Math.min(Math.max(this.r,0),255),this.g=Math.min(Math.max(this.g,0),255),this.b=Math.min(Math.max(this.b,0),255),this.a=Math.min(Math.max(this.a,0),255)}static fromHex(e){4===e.length&&(e=`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`);const t=parseInt(e.slice(1,3),16),o=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16),s=parseInt(e.slice(7,9),16);return new Color(t,o,i,isNaN(s)?255:s)}static fromHsl(e,t,o,i=255){const{r:s,g:n,b:a}=hslToRgb(e,t,o);return new Color(s,n,a,i)}static isValidHex(e){return/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(e)}toInverted(){return new Color(255-this.r,255-this.g,255-this.b,this.a)}toJSON(){return{_type:this.constructor.name,r:this.r,g:this.g,b:this.b,a:this.a}}toHex(){return`#${this.toRGBA().map(e=>e.toString(16).padStart(2,"0")).join("")}`}toRGB(){return[this.r,this.g,this.b]}toRGBA(){return[...this.toRGB(),this.a]}toCSSRGB(){return[...this.toRGB()]}toCSSRGBA(){return[...this.toRGB(),this.a/255]}toHsl(){const e=this.r/255,t=this.g/255,o=this.b/255,i=Math.max(e,t,o),s=Math.min(e,t,o);let n=0,a=0;const r=(i+s)/2;if(i===s)n=a=0;else{const c=i-s;switch(a=r>.5?c/(2-i-s):c/(i+s),i){case e:n=(t-o)/c+(t<o?6:0);break;case t:n=(o-e)/c+2;break;case o:n=(e-t)/c+4}n/=6}return[Math.round(360*n),a,r]}toHsla(){const[e,t,o]=this.toHsl();return[e,t,o,this.a]}toHsv(){const e=this.r/255,t=this.g/255,o=this.b/255,i=Math.max(e,t,o),s=Math.min(e,t,o);let n=0,a=0;const r=i,c=i-s;if(0===i)return[0,0,0];if(a=c/i,i===s)n=0;else{switch(i){case e:n=(t-o)/c+(t<o?6:0);break;case t:n=(o-e)/c+2;break;case o:n=(e-t)/c+4}n/=6}return[Math.round(360*n),a,r]}toHsva(){const[e,t,o]=this.toHsv();return[e,t,o,this.a]}getHslaHue(){const[e]=this.toHsl();return e}getHslaSaturation(){const[e]=this.toHsl();return e}getHslaLightness(){const[e]=this.toHsl();return e}setHslaHue(e){const[t,o,i]=this.toHsl();return Color.fromHsl(t+e,o,i,this.a)}setHslaSaturation(e){const[t,o,i]=this.toHsl();return Color.fromHsl(t,o+e,i,this.a)}setHslaLightness(e){const[t,o,i]=this.toHsl();return Color.fromHsl(t,o,i+e,this.a)}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}clone(){return new Color(this.r,this.g,this.b,this.a)}}const U={fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},G={silent:{level:-1},fatal:{level:U.fatal},error:{level:U.error},warn:{level:U.warn},log:{level:U.log},info:{level:U.info},success:{level:U.success},fail:{level:U.fail},ready:{level:U.info},start:{level:U.info},box:{level:U.info},debug:{level:U.debug},trace:{level:U.trace},verbose:{level:U.verbose}};function isPlainObject$1(e){if(null===e||"object"!=typeof e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&(!(Symbol.iterator in e)&&(!(Symbol.toStringTag in e)||"[object Module]"===Object.prototype.toString.call(e)))}function _defu(e,t,o=".",i){if(!isPlainObject$1(t))return _defu(e,{},o);const s=Object.assign({},t);for(const n in e){if("__proto__"===n||"constructor"===n)continue;const t=e[n];null!=t&&(Array.isArray(t)&&Array.isArray(s[n])?s[n]=[...t,...s[n]]:isPlainObject$1(t)&&isPlainObject$1(s[n])?s[n]=_defu(t,s[n],(o?`${o}.`:"")+n.toString()):s[n]=t)}return s}const W=function createDefu(e){return(...e)=>e.reduce((e,t)=>_defu(e,t,""),{})}();function isLogObj(e){return!!function isPlainObject(e){return"[object Object]"===Object.prototype.toString.call(e)}(e)&&(!(!e.message&&!e.args)&&!e.stack)}let z=!1;const H=[];class Consola{constructor(e={}){__publicField(this,"options"),__publicField(this,"_lastLog"),__publicField(this,"_mockFn");const t=e.types||G;this.options=W({...e,defaults:{...e.defaults},level:_normalizeLogLevel(e.level,t),reporters:[...e.reporters||[]]},{types:G,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const o in t){const e={type:o,...this.options.defaults,...t[o]};this[o]=this._wrapLogFn(e),this[o].raw=this._wrapLogFn(e,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(e){this.options.level=_normalizeLogLevel(e,this.options.types,this.options.level)}prompt(e,t){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(e,t)}create(e){const t=new Consola({...this.options,...e});return this._mockFn&&t.mockTypes(this._mockFn),t}withDefaults(e){return this.create({...this.options,defaults:{...this.options.defaults,...e}})}withTag(e){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+e:e})}addReporter(e){return this.options.reporters.push(e),this}removeReporter(e){if(e){const t=this.options.reporters.indexOf(e);if(-1!==t)return this.options.reporters.splice(t,1)}else this.options.reporters.splice(0);return this}setReporters(e){return this.options.reporters=Array.isArray(e)?e:[e],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const e in this.options.types)console["__"+e]||(console["__"+e]=console[e]),console[e]=this[e].raw}restoreConsole(){for(const e in this.options.types)console["__"+e]&&(console[e]=console["__"+e],delete console["__"+e])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(e,t){e&&(e.__write||(e.__write=e.write),e.write=e=>{this[t].raw(String(e).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(e){e&&e.__write&&(e.write=e.__write,delete e.__write)}pauseLogs(){z=!0}resumeLogs(){z=!1;const e=H.splice(0);for(const t of e)t[0]._logFn(t[1],t[2])}mockTypes(e){const t=e||this.options.mockFn;if(this._mockFn=t,"function"==typeof t)for(const o in this.options.types)this[o]=t(o,this.options.types[o])||this[o],this[o].raw=this[o]}_wrapLogFn(e,t){return(...o)=>{if(!z)return this._logFn(e,o,t);H.push([this,e,o,t])}}_logFn(e,t,o){if((e.level||0)>this.level)return!1;const i={date:new Date,args:[],...e,level:_normalizeLogLevel(e.level,this.options.types)};!o&&1===t.length&&isLogObj(t[0])?Object.assign(i,t[0]):i.args=[...t],i.message&&(i.args.unshift(i.message),delete i.message),i.additional&&(Array.isArray(i.additional)||(i.additional=i.additional.split("\n")),i.args.push("\n"+i.additional.join("\n")),delete i.additional),i.type="string"==typeof i.type?i.type.toLowerCase():"log",i.tag="string"==typeof i.tag?i.tag:"";const resolveLog=(e=!1)=>{const t=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&t>0){const e=[...this._lastLog.object.args];t>1&&e.push(`(repeated ${t} times)`),this._log({...this._lastLog.object,args:e}),this._lastLog.count=1}e&&(this._lastLog.object=i,this._log(i))};clearTimeout(this._lastLog.timeout);const s=this._lastLog.time&&i.date?i.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=i.date,s<this.options.throttle)try{const e=JSON.stringify([i.type,i.tag,i.args]),t=this._lastLog.serialized===e;if(this._lastLog.serialized=e,t&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin))return void(this._lastLog.timeout=setTimeout(resolveLog,this.options.throttle))}catch{}resolveLog(!0)}_log(e){for(const t of this.options.reporters)t.log(e,{options:this.options})}}function _normalizeLogLevel(e,t={},o=3){return void 0===e?o:"number"==typeof e?e:t[e]&&void 0!==t[e].level?t[e].level:o}Consola.prototype.add=Consola.prototype.addReporter,Consola.prototype.remove=Consola.prototype.removeReporter,Consola.prototype.clear=Consola.prototype.removeReporter,Consola.prototype.withScope=Consola.prototype.withTag,Consola.prototype.mock=Consola.prototype.mockTypes,Consola.prototype.pause=Consola.prototype.pauseLogs,Consola.prototype.resume=Consola.prototype.resumeLogs;class BrowserReporter{constructor(e){__publicField(this,"options"),__publicField(this,"defaultColor"),__publicField(this,"levelColorMap"),__publicField(this,"typeColorMap"),this.options={...e},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(e){return e<1?console.__error||console.error:1===e?console.__warn||console.warn:console.__log||console.log}log(e){const t=this._getLogFn(e.level),o="log"===e.type?"":e.type,i=e.tag||"",s=`\n      background: ${this.typeColorMap[e.type]||this.levelColorMap[e.level]||this.defaultColor};\n      border-radius: 0.5em;\n      color: white;\n      font-weight: bold;\n      padding: 2px 0.5em;\n    `,n=`%c${[i,o].filter(Boolean).join(":")}`;"string"==typeof e.args[0]?t(`${n}%c ${e.args[0]}`,s,"",...e.args.slice(1)):t(n,s,...e.args)}}const Q=function createConsola(e={}){return function createConsola$1(e={}){return new Consola(e)}({reporters:e.reporters||[new BrowserReporter({})],prompt:(e,t={})=>"confirm"===t.type?Promise.resolve(confirm(e)):Promise.resolve(prompt(e)),...e})}().withTag("webPaint"),j=Q.withTag("workerManager");Q.withTag("display");const V=Q.withTag("worker");V.withTag("main"),V.withTag("display");const K=[{validator:()=>!0,handler:()=>e=>e.pipe(l(e=>e))}];class AsyncTransform{constructor(e,t){__publicField(this,"validator"),__publicField(this,"handler"),this.validator=e,this.handler=t}}const Y=[{validator:()=>!0,handler:()=>e=>e.pipe(l(e=>e))}],J={[Object.prototype.constructor.name]:e=>t=>t.pipe(l(Object.entries),traverse(e),l(Object.fromEntries)),[Array.prototype.constructor.name]:e=>t=>t.pipe(m(),traverse(e),f()),[Promise.prototype.constructor.name]:e=>t=>t.pipe(g(e=>y(e)),traverse(e)),[u.prototype.constructor.name]:e=>t=>t.pipe(g(e=>e),traverse(e)),[void 0]:()=>e=>e};function serialize(e=[]){return t=>t.pipe(traverse(((e=[])=>[...e,...K])(e)))}function deserialize(e=[]){return t=>t.pipe(traverse(((e=[])=>[...e,...Y])(e)))}function traverse(e){return t=>t.pipe(p(t=>{const o=function getInstructionKey(e){if(null==e)return;const t=e.constructor;if(t){const e=t.name;if(Object.prototype.hasOwnProperty.call(J,e))return e}return}(t),i=o&&J[o];return i?h(t).pipe(i(e)):h(t)}),function transform(e){return t=>t.pipe(g(t=>h(t).pipe(findTransform(e,t).handler())))}(e))}const findTransform=(e,t)=>{const o=e.find(({validator:e})=>e(t));return o||{validator:()=>!0,handler:e=>e}};var Z=(e=>(e.FILLED="filled",e.STROKED="stroked",e.STROKED_FILLED="stroked_filled",e))(Z||{}),X=(e=>(e.CIRCLE="circle",e.SQUARE="square",e.DOTS="dots",e))(X||{}),q=(e=>(e.NONE="none",e.DOTTED_FREEHAND="dotted_freehand",e.CONTINUOUS_FREEHAND="continuous_freehand",e.STRAIGHT_LINE="straight_line",e.CURVE_LINE="curve_line",e.FILL_TOOL="fill_tool",e.AIR_BRUSH="airbrush",e.RECTANGLE="rectangle",e.CIRCLE="circle",e.ELLIPSE="ellipse",e.POLYGON="polygon",e.CROP="crop",e.TEXT="text",e.SPLIT_SCREEN="splitScreen",e.MAGNIFY="magnify",e.ZOOM="zoom",e.STACK_REDO="stack_redo",e.STACK_UNDO="stack_undo",e.CLEAR="clear",e.ZOOM_FIT="zoom_fit",e.COLOR_PICKER="color_picker",e.IMAGE_OPERATION="image_operation",e))(q||{});class DisplayActions{constructor(e){this.display=e}useTool(e,{domEvents:t}){if(this.display.app.options.select.tool.value===q.ZOOM){const o=this.display.app.options.zoomStep,i=1+(t.shiftLeftActive?-o:o);this.setZoom(e,i)}}setPosition(e){return this.display.options.position=e,this.display.action({type:N.SET_POSITION,payload:{position:e}})}setZoom(e=r(0,0),t){return this.display.options.zoomLevel=t,this.display.action({type:N.SET_ZOOM,payload:{zoomLevel:t,position:e}})}colorPicker(e){return this.display.action({type:N.COLOR_PICKER,payload:{position:e}})}async fitZoom(){const e=this.display;await e.actions.setPosition(r(0,0)),await e.actions.setZoom(r(0,0),0),await e.action({type:N.ZOOM_FIT,payload:{}})}async setOptions(){const e=this.display;await e.action({type:N.SET_OPTIONS,payload:{options:e.options}})}}r(-1,-1),r(0,-1),r(1,-1),r(-1,0),r(0,0),r(1,0),r(-1,1),r(0,1),r(1,1);class DisplayOptions{constructor(e){__publicField(this,"origin"),__publicField(this,"position"),__publicField(this,"colors"),__publicField(this,"grid"),__publicField(this,"zoomLevel"),__publicField(this,"precision");const{origin:t,position:o,colors:i,grid:s,zoomLevel:n}=e||{};this.origin=t||"center",this.position=o?r(o.x,o.y):r(0,0),this.colors={background:(null==i?void 0:i.background)?new Color(i.background):new Color(0,0,0),foreground:(null==i?void 0:i.foreground)?new Color(i.foreground):new Color(255,255,255)},this.grid={color:(null==s?void 0:s.color)?new Color(s.color):new Color(0,0,0,51),lineWidth:(null==s?void 0:s.lineWidth)||1,visibleCount:(null==s?void 0:s.visibleCount)||10},this.zoomLevel=n||1,this.precision=3}toJSON(){return{_type:this.constructor.name,origin:this.origin,position:this.position.toJSON(),colors:{background:this.colors.background.toJSON(),foreground:this.colors.foreground.toJSON()},grid:{color:this.grid.color.toJSON(),lineWidth:this.grid.lineWidth,visibleCount:this.grid.visibleCount},zoomLevel:this.zoomLevel,precision:this.precision}}}class Display{constructor(e,t={}){__publicField(this,"id",crypto.randomUUID()),__publicField(this,"actions"),__publicField(this,"app"),__publicField(this,"worker"),__publicField(this,"options"),__publicField(this,"currentZoomLevel",1),this.app=e,this.options=new DisplayOptions(t),this.actions=new DisplayActions(this)}setWorker(e){this.worker=e}setCurrentZoomLevel(e){this.options.zoomLevel=e}action(e,t){return this.app.workerManager.action(e,t,this.worker)}setColors(e){this.options.colors={background:new Color(e.background),foreground:new Color(e.foreground)},this.actions.setOptions()}setGrid(e){this.options.grid={...e,color:new Color(e.color)},this.actions.setOptions()}}class PaletteColor{constructor(e){__publicField(this,"id"),__publicField(this,"color");const{id:t,color:o}=e||{};this.id=t||crypto.randomUUID(),this.color=o?new Color(o):new Color(0,0,0)}setColor(e){this.color=e}equal(e){return this.id===(null==e?void 0:e.id)}toJSON(){return{_type:this.constructor.name,id:this.id,color:this.color.toJSON()}}clone(){return new PaletteColor({id:this.id,color:this.color.clone()})}}class Palette{constructor(e){__publicField(this,"id"),__publicField(this,"name"),__publicField(this,"description"),__publicField(this,"colors"),__publicField(this,"locked");const{id:t,name:o,description:i,colors:s,locked:n}=e||{};this.id=t||crypto.randomUUID(),this.name=o||"",this.description=i,this.colors=(s||[]).map(e=>new PaletteColor(e)),this.locked=n}clone(){return new Palette({id:this.id,name:this.name,description:this.description,colors:this.colors.map(e=>e.clone()),locked:this.locked})}toJSON(){return{_type:this.constructor.name,id:this.id,name:this.name,description:this.description,colors:this.colors.map(e=>e.toJSON()),locked:this.locked}}}const $=[new AsyncTransform(e=>e&&e instanceof c,()=>e=>e.pipe(l(e=>e.toJSON()))),new AsyncTransform(e=>e&&e instanceof DisplayOptions,()=>e=>e.pipe(l(e=>e.toJSON()))),new AsyncTransform(e=>e&&e instanceof Color,()=>e=>e.pipe(l(e=>e.toJSON()))),new AsyncTransform(e=>e&&e instanceof PaletteColor,()=>e=>e.pipe(l(e=>e.toJSON()))),new AsyncTransform(e=>e&&e instanceof Palette,()=>e=>e.pipe(l(e=>e.toJSON())))],ee=[new AsyncTransform(e=>"object"==typeof e&&"x"in e&&"y"in e,()=>e=>e.pipe(l(e=>r(e.x,e.y)))),new AsyncTransform(e=>e&&DisplayOptions.prototype.constructor.name===e._type,()=>e=>e.pipe(l(e=>new DisplayOptions(e)))),new AsyncTransform(e=>e&&Color.prototype.constructor.name===e._type,()=>e=>e.pipe(l(e=>new Color(e)))),new AsyncTransform(e=>e&&PaletteColor.prototype.constructor.name===e._type,()=>e=>e.pipe(l(e=>new PaletteColor(e)))),new AsyncTransform(e=>e&&Palette.prototype.constructor.name===e._type,()=>e=>e.pipe(l(e=>new Palette(e))))];function deserializeWorkerPostMessage(){return e=>e.pipe(deserialize(ee))}class WorkerManager{constructor(e,t,o={debug:!1}){__publicField(this,"subscription",new w),__publicField(this,"readyResolver",Promise.withResolvers()),__publicField(this,"mainWorker",null),__publicField(this,"displayWorkers",[]),__publicField(this,"resolveMap",new Map),this.app=e,this.config=t,this.options=o}async setup(){var e;const t=new Worker(new URL(""+new URL("main-B_IW7NcO.js",import.meta.url).href,import.meta.url),{type:"module"});this.mainWorker=t;const o={type:N.INIT,payload:{debug:this.options.debug}};null==(e=this.subscription)||e.add(d(this.mainWorker,"message").pipe(l(e=>e.data),deserializeWorkerPostMessage()).subscribe(e=>{this.onMessageMainWorker(e)})),await this.action(o),this.readyResolver.resolve()}get ready(){return this.readyResolver.promise}destroy(){var e;null==(e=this.subscription)||e.unsubscribe(),this.mainWorker&&(this.mainWorker.terminate(),this.mainWorker=null),this.displayWorkers.forEach(e=>e.terminate()),this.displayWorkers=[]}addDisplay(e,t){return new Promise(o=>{var i;const s=new Worker(new URL(""+new URL("display-BjCe4XLl.js",import.meta.url).href,import.meta.url),{type:"module"});if(e.setWorker(s),null==(i=this.subscription)||i.add(d(s,"message").pipe(l(e=>e.data),deserializeWorkerPostMessage()).subscribe(t=>this.onMessageDisplayWorker(t,e))),this.displayWorkers.push(s),t){const i=t.transferControlToOffscreen(),n=new MessageChannel,a={type:N.INIT,payload:{debug:this.options.debug,options:e.options,canvas:i,port:n.port1}};if(this.mainWorker){const e={type:N.ADD_RENDER_WORKER_PORT,payload:{port:n.port2}};this.action(e,[n.port2]).then(()=>o())}this.action(a,[i,n.port1],s)}})}removeDisplay(e){var t;this.displayWorkers=this.displayWorkers.filter(t=>t!==e.worker),null==(t=e.worker)||t.terminate(),e.worker=void 0}async action(e,t,o=this.mainWorker){const i=crypto.randomUUID(),s=Promise.withResolvers();te.set(i,s.resolve),this.options.debug&&j.withTag("action").withTag(e.type).start(e,o);const n=await A(h({id:i,data:e}).pipe(function serializeWorkerPostMessage(){return e=>e.pipe(serialize($))}()));return o.postMessage(n,t||[]),s.promise.then(e=>(te.delete(i),e))}async onMessageMainWorker(e){var t;const{id:o,data:i}=e;await async function actionsMain(e,t,o){var i;switch(o.type){case N.INIT:e.options.debug&&Q.withTag("Incoming").withTag("action").withTag(N.INIT).success(o);break;case N.SYNC_STATE:t.setState(o.payload);break;case N.UPDATE_BUFFER:console.log("[WorkerManager] BOOOOM",o);break;case N.RESIZE_CANVAS_SUCCESS:{const e=o.payload;null==(i=t.currentDocument)||i.setDimension(e.dimension)}break;default:e.options.debug&&Q.withTag("Incoming").withTag("main").withTag("action").warn("Action not handled in WorkerManager:",o)}}(this,this.app,i),null==(t=te.get(o))||t(i)}async onMessageDisplayWorker(e,t){var o;const{id:i,data:s}=e;await async function actionsDisplay(e,t,o,i){switch(i.type){case N.INIT_SUCCESS:e.config.get(L.WEB_PAINT_FIT_IMAGE_ACTIVE)?o.actions.fitZoom():o.actions.setPosition(r(0,0));break;case N.SET_ZOOM_SUCCESS:{const{currentZoomLevel:e}=i.payload;o.setCurrentZoomLevel(e),i.payload&&"position"in i.payload&&(o.options.position=r(i.payload.position.x,i.payload.position.y))}break;default:e.options.debug&&Q.withTag("Incoming").withTag("display").withTag("action").warn("Action not handled in WorkerManager:",i)}}(this,this.app,t,s),null==(o=te.get(i))||o(s)}}const te=new Map;class Document{constructor({name:e,meta:t,data:o}){__publicField(this,"name"),__publicField(this,"meta"),__publicField(this,"data"),this.name=e,this.meta=t,this.data=o||function createImageBitmap$1(e,t){const o=new OffscreenCanvas(e,t),i=o.getContext("2d");if(!i)throw new Error("Failed to get 2D context from OffscreenCanvas");return i.fillStyle="white",i.fillRect(0,0,e,t),o.transferToImageBitmap()}(t.dimension.x,t.dimension.y)}setDimension(e){this.meta.dimension=e}destroy(){this.data.close()}}async function getDocumentFromUrl(e){const t=await C(e),o={dimension:r(t.width,t.height)};return new Document({name:"Untitled Document",meta:o,data:t.transferToImageBitmap()})}function createBlankImageBitmap(e,t){const o=new OffscreenCanvas(e,t),i=o.getContext("2d");if(!i)throw new Error("Failed to get 2D context from OffscreenCanvas");return i.fillStyle="white",i.fillRect(0,0,e,t),o.transferToImageBitmap()}const oe=new Palette({locked:!0,id:"aap64-palette",name:"AAP-64",description:"A large, versatile palette with 64 colors that provides a wide range of tones for almost any type of scene or object. Ideal if you want a richer and more detailed color scheme without being overwhelmed.",colors:[{id:"aap64-c0",name:"Darkest Grey",color:"#161320"},{id:"aap64-c1",name:"Dark Grey",color:"#2a2139"},{id:"aap64-c2",name:"Medium Dark Grey",color:"#473b4f"},{id:"aap64-c3",name:"Medium Grey",color:"#63586f"},{id:"aap64-c4",name:"Light Grey",color:"#817b96"},{id:"aap64-c5",name:"Pale Grey",color:"#a8a8bb"},{id:"aap64-c6",name:"White",color:"#d0d2dd"},{id:"aap64-c7",name:"Bright White",color:"#f8f7f9"},{id:"aap64-c8",name:"Deep Red",color:"#330000"},{id:"aap64-c9",name:"Dark Red",color:"#680000"},{id:"aap64-c10",name:"Red",color:"#a20000"},{id:"aap64-c11",name:"Bright Red",color:"#d70000"},{id:"aap64-c12",name:"Light Red",color:"#ff3838"},{id:"aap64-c13",name:"Pink",color:"#ff7575"},{id:"aap64-c14",name:"Pale Pink",color:"#ffb2b2"},{id:"aap64-c15",name:"Lightest Pink",color:"#ffecec"},{id:"aap64-c16",name:"Dark Brown",color:"#3f1a00"},{id:"aap64-c17",name:"Brown",color:"#7e3300"},{id:"aap64-c18",name:"Orange Brown",color:"#bb4e00"},{id:"aap64-c19",name:"Dark Orange",color:"#ed6900"},{id:"aap64-c20",name:"Orange",color:"#ff9e3b"},{id:"aap64-c21",name:"Bright Orange",color:"#ffba78"},{id:"aap64-c22",name:"Light Orange",color:"#ffd7b5"},{id:"aap64-c23",name:"Pale Orange",color:"#ffefe6"},{id:"aap64-c24",name:"Dark Yellow",color:"#3f3000"},{id:"aap64-c25",name:"Yellow Brown",color:"#7e6000"},{id:"aap64-c26",name:"Mustard Yellow",color:"#bbaa00"},{id:"aap64-c27",name:"Bright Yellow",color:"#edde00"},{id:"aap64-c28",name:"Yellow",color:"#fff04d"},{id:"aap64-c29",name:"Light Yellow",color:"#fff68b"},{id:"aap64-c30",name:"Pale Yellow",color:"#fffcc8"},{id:"aap64-c31",name:"Lightest Yellow",color:"#fffee0"},{id:"aap64-c32",name:"Dark Green Blue",color:"#002a20"},{id:"aap64-c33",name:"Green Blue",color:"#005540"},{id:"aap64-c34",name:"Teal",color:"#008060"},{id:"aap64-c35",name:"Bright Teal",color:"#00aa80"},{id:"aap64-c36",name:"Cyan",color:"#00ffc0"},{id:"aap64-c37",name:"Light Cyan",color:"#4dffdb"},{id:"aap64-c38",name:"Pale Cyan",color:"#80ffe6"},{id:"aap64-c39",name:"Lightest Cyan",color:"#e6fff4"},{id:"aap64-c40",name:"Dark Blue Green",color:"#001a2f"},{id:"aap64-c41",name:"Blue Green",color:"#00335f"},{id:"aap64-c42",name:"Medium Blue Green",color:"#004d8e"},{id:"aap64-c43",name:"Bright Blue Green",color:"#0066bd"},{id:"aap64-c44",name:"Blue",color:"#0088ff"},{id:"aap64-c45",name:"Light Blue",color:"#4daaff"},{id:"aap64-c46",name:"Pale Blue",color:"#80ccff"},{id:"aap64-c47",name:"Lightest Blue",color:"#e6f4ff"},{id:"aap64-c48",name:"Dark Violet",color:"#0a0026"},{id:"aap64-c49",name:"Violet",color:"#14004c"},{id:"aap64-c50",name:"Medium Violet",color:"#230075"},{id:"aap64-c51",name:"Bright Violet",color:"#330099"},{id:"aap64-c52",name:"Purple",color:"#5e00ff"},{id:"aap64-c53",name:"Light Purple",color:"#8f4dff"},{id:"aap64-c54",name:"Pale Purple",color:"#bf80ff"},{id:"aap64-c55",name:"Lightest Purple",color:"#f2e6ff"},{id:"aap64-c56",name:"Dark Magenta",color:"#260026"},{id:"aap64-c57",name:"Magenta",color:"#4c004c"},{id:"aap64-c58",name:"Medium Magenta",color:"#750075"},{id:"aap64-c59",name:"Bright Magenta",color:"#990099"},{id:"aap64-c60",name:"Fuchsia",color:"#ff00ff"},{id:"aap64-c61",name:"Light Fuchsia",color:"#ff4dff"},{id:"aap64-c62",name:"Pale Fuchsia",color:"#ff80ff"},{id:"aap64-c63",name:"Lightest Fuchsia",color:"#ffe6ff"}]}),ie=new Palette({locked:!0,name:"Apple II High-Res Palette",description:"The characteristic colors of the Apple II High-Resolution graphics mode.",colors:[{id:"apple2-0",color:"#000000"},{id:"apple2-1",color:"#FFFFFF"},{id:"apple2-2",color:"#00FF00"},{id:"apple2-3",color:"#FF00FF"},{id:"apple2-4",color:"#FFA500"},{id:"apple2-5",color:"#0000FF"}]}),se=new Palette({locked:!0,id:"arne-16",name:"Arne16",description:"Another well-known 16-color palette by Arne Niklas Jansson (Skeddles), often with a slightly cooler color scheme than DB16, but also very versatile and balanced for various pixel art projects.",colors:[{id:"arne16-c0",name:"Deep Blue",color:"#1a1c2c"},{id:"arne16-c1",name:"Dark Purple",color:"#43283c"},{id:"arne16-c2",name:"Dark Green",color:"#4a444a"},{id:"arne16-c3",name:"Dark Cyan",color:"#633c58"},{id:"arne16-c4",name:"Dark Brown",color:"#76425a"},{id:"arne16-c5",name:"Forest Green",color:"#945c56"},{id:"arne16-c6",name:"Gray Blue",color:"#bc4a4a"},{id:"arne16-c7",name:"Light Brown",color:"#de7b72"},{id:"arne16-c8",name:"Orange Red",color:"#efb28e"},{id:"arne16-c9",name:"Pale Yellow",color:"#fecf65"},{id:"arne16-c10",name:"Bright Yellow",color:"#fff79c"},{id:"arne16-c11",name:"Light Green",color:"#227772"},{id:"arne16-c12",name:"Medium Green",color:"#28a773"},{id:"arne16-c13",name:"Teal",color:"#54d3ed"},{id:"arne16-c14",name:"Sky Blue",color:"#80f0c0"},{id:"arne16-c15",name:"White",color:"#b8f7ed"}]}),ne=new Palette({locked:!0,id:"bob-ross-palette",name:"Bob Ross Inspired",description:"A color palette inspired by the typical colors Bob Ross used in his 'The Joy of Painting' shows. Ideal for serene nature landscapes with mountains, trees, and water.",colors:[{id:"br-c0",name:"Midnight Black (Alizarin Crimson/Prussian Blue-like)",color:"#140c1c"},{id:"br-c1",name:"Dark Umber (Dark Sienna/Van Dyke Brown-like)",color:"#2a1e1b"},{id:"br-c2",name:"Forest Green (Dark Phthalo Green-like)",color:"#1f3a2c"},{id:"br-c3",name:"Mountain Blue (Prussian Blue-like)",color:"#2c2a3f"},{id:"br-c4",name:"Deep Red (Alizarin Crimson-like)",color:"#5b1e2c"},{id:"br-c5",name:"Warm Brown (Burnt Umber-like)",color:"#6d372c"},{id:"br-c6",name:"Moss Green (Sap Green-like)",color:"#4a6d38"},{id:"br-c7",name:"Sky Blue (Phthalo Blue-like)",color:"#4b6c8d"},{id:"br-c8",name:"Bright Red (Cadmium Red Light-like)",color:"#9b3c4f"},{id:"br-c9",name:"Golden Yellow (Cadmium Yellow-like)",color:"#e0a656"},{id:"br-c10",name:"Bright Green (Bright Sap Green-like)",color:"#76c04f"},{id:"br-c11",name:"Soft Blue (Light Phthalo Blue-like)",color:"#81a2cc"},{id:"br-c12",name:"Cream (Titanium White with a hint of color)",color:"#d6cec2"},{id:"br-c13",name:"Off-White (Liquid White-like)",color:"#f0f0e8"},{id:"br-c14",name:"Cloud Grey (Grey Mix-like)",color:"#b0b0b0"},{id:"br-c15",name:"Pure White (Titanium White-like)",color:"#ffffff"}]}),ae=new Palette({locked:!0,id:"bubblegum-16",name:"Bubblegum 16",description:"A vibrant and cheerful 16-color palette, well-suited for bright, friendly, or 'cute' aesthetics. Ideal for characters, UI elements, or colorful environments.",colors:[{id:"bubblegum-c0",name:"Dark Purple",color:"#2e203c"},{id:"bubblegum-c1",name:"Dark Blue",color:"#4b3064"},{id:"bubblegum-c2",name:"Medium Blue",color:"#6d5494"},{id:"bubblegum-c3",name:"Light Blue",color:"#8a7ba7"},{id:"bubblegum-c4",name:"Dark Pink",color:"#a75276"},{id:"bubblegum-c5",name:"Pink",color:"#d284ae"},{id:"bubblegum-c6",name:"Pale Pink",color:"#ffadd8"},{id:"bubblegum-c7",name:"Light Yellow",color:"#fffefb"},{id:"bubblegum-c8",name:"Dark Green",color:"#366e44"},{id:"bubblegum-c9",name:"Green",color:"#5cb064"},{id:"bubblegum-c10",name:"Lime Green",color:"#94d682"},{id:"bubblegum-c11",name:"Yellow Green",color:"#d2f7ae"},{id:"bubblegum-c12",name:"Orange",color:"#de7061"},{id:"bubblegum-c13",name:"Red Orange",color:"#ff9e7f"},{id:"bubblegum-c14",name:"Light Orange",color:"#ffbe9c"},{id:"bubblegum-c15",name:"Cream",color:"#ffe8c6"}]}),re=new Palette({locked:!0,name:"Commodore 64 (C64) Palette",description:"The characteristic 16 colors of the C64, generated by the VIC-II chip.",colors:[{id:"c64-0",color:"#000000"},{id:"c64-1",color:"#FFFFFF"},{id:"c64-2",color:"#68372B"},{id:"c64-3",color:"#70A4B2"},{id:"c64-4",color:"#6F3D86"},{id:"c64-5",color:"#588D43"},{id:"c64-6",color:"#352879"},{id:"c64-7",color:"#B8C76F"},{id:"c64-8",color:"#6F4F25"},{id:"c64-9",color:"#433900"},{id:"c64-10",color:"#9A6759"},{id:"c64-11",color:"#444444"},{id:"c64-12",color:"#6F6F6F"},{id:"c64-13",color:"#9AD284"},{id:"c64-14",color:"#6565EB"},{id:"c64-15",color:"#787878"}]}),ce=new Palette({locked:!0,name:"CGA 0 (High Intensity)",description:"The most well-known 4-color palette of the IBM PC Color Graphics Adapter.",colors:[{id:"cga-p0-0",color:"#000000"},{id:"cga-p0-1",color:"#00AA00"},{id:"cga-p0-2",color:"#AA0000"},{id:"cga-p0-3",color:"#AA5500"}]}),le=new Palette({locked:!0,name:"CGA 1 (High Intensity)",description:"Another iconic 4-color palette of the CGA, often responsible for the cyan-magenta look.",colors:[{id:"cga-p1-0",color:"#000000"},{id:"cga-p1-1",color:"#00AAAA"},{id:"cga-p1-2",color:"#AA00AA"},{id:"cga-p1-3",color:"#AAAAAA"}]}),pe=new Palette({locked:!0,id:"cga-palette",name:"CGA Palette (Mode 4 High Intensity)",description:"A historical 16-color palette inspired by the IBM CGA graphics standard. Known for its bright, sometimes unsaturated colors and distinctive retro computer look. Challenging but very characteristic.",colors:[{id:"cga-c0",name:"Black",color:"#000000"},{id:"cga-c1",name:"Dark Blue",color:"#0000aa"},{id:"cga-c2",name:"Dark Green",color:"#00aa00"},{id:"cga-c3",name:"Dark Cyan",color:"#00aaaa"},{id:"cga-c4",name:"Dark Red",color:"#aa0000"},{id:"cga-c5",name:"Dark Magenta",color:"#aa00aa"},{id:"cga-c6",name:"Brown",color:"#aa5500"},{id:"cga-c7",name:"Light Gray",color:"#aaaaaa"},{id:"cga-c8",name:"Dark Gray",color:"#555555"},{id:"cga-c9",name:"Blue",color:"#5555ff"},{id:"cga-c10",name:"Green",color:"#55ff55"},{id:"cga-c11",name:"Cyan",color:"#55ffff"},{id:"cga-c12",name:"Red",color:"#ff5555"},{id:"cga-c13",name:"Magenta",color:"#ff55ff"},{id:"cga-c14",name:"Yellow",color:"#ffff55"},{id:"cga-c15",name:"White",color:"#ffffff"}]}),de=new Palette({locked:!0,id:"db16-palette",name:"Dawnbringer 16 (DB16)",description:"A versatile and balanced palette by Arne Niklas Jansson, ideal for various moods and scenarios. Known for its earthy and muted tones.",colors:[{id:"db16-c0",name:"Dark Plum",color:"#140c1c"},{id:"db16-c1",name:"Dark Blue",color:"#442434"},{id:"db16-c2",name:"Dark Green",color:"#30346d"},{id:"db16-c3",name:"Brown",color:"#4e4a68"},{id:"db16-c4",name:"Dark Red",color:"#69512c"},{id:"db16-c5",name:"Dark Orange",color:"#636357"},{id:"db16-c6",name:"Gray Blue",color:"#6f6451"},{id:"db16-c7",name:"Light Brown",color:"#76864d"},{id:"db16-c8",name:"Red Orange",color:"#816d56"},{id:"db16-c9",name:"Light Green",color:"#7b707c"},{id:"db16-c10",name:"Light Blue",color:"#80a254"},{id:"db16-c11",name:"Sand",color:"#a8b97d"},{id:"db16-c12",name:"Light Yellow",color:"#a2d28f"},{id:"db16-c13",name:"Pale Yellow",color:"#c6f5d0"},{id:"db16-c14",name:"Sky Blue",color:"#e0f6ee"},{id:"db16-c15",name:"White",color:"#f8f8f8"}]}),he=new Palette({locked:!0,id:"edg20-palette",name:"EDG20",description:"An Endesga-created 20-color palette. It offers a good selection of rich colors with various ramps for lights and shadows, ideal for more detailed scenes and illustrations.",colors:[{id:"edg20-c0",name:"Dark Grey",color:"#181425"},{id:"edg20-c1",name:"Deep Violet",color:"#241d3b"},{id:"edg20-c2",name:"Dark Violet",color:"#382552"},{id:"edg20-c3",name:"Medium Violet",color:"#5b3164"},{id:"edg20-c4",name:"Bright Violet",color:"#81396f"},{id:"edg20-c5",name:"Dark Blue",color:"#114c62"},{id:"edg20-c6",name:"Medium Blue",color:"#316f7c"},{id:"edg20-c7",name:"Light Blue",color:"#5e9a93"},{id:"edg20-c8",name:"Cyan",color:"#85c596"},{id:"edg20-c9",name:"Light Green",color:"#a8eb9b"},{id:"edg20-c10",name:"Dark Green",color:"#2c726f"},{id:"edg20-c11",name:"Olive Green",color:"#58916d"},{id:"edg20-c12",name:"Yellow Green",color:"#90c57c"},{id:"edg20-c13",name:"Dark Brown",color:"#4a2a4f"},{id:"edg20-c14",name:"Brown",color:"#793c66"},{id:"edg20-c15",name:"Light Brown",color:"#ae4f6b"},{id:"edg20-c16",name:"Dark Red",color:"#dd6e6c"},{id:"edg20-c17",name:"Red",color:"#ff9a8a"},{id:"edg20-c18",name:"Orange",color:"#ffca9a"},{id:"edg20-c19",name:"White",color:"#fff5ea"}]}),me=new Palette({locked:!0,id:"gameboy-palette",name:"Game Boy (Original)",description:"The iconic 4-color palette of the classic Game Boy. Perfect for an authentic retro monochrome look with greenish tones.",colors:[{id:"gb-c0",name:"Darkest Green",color:"#0f380f"},{id:"gb-c1",name:"Dark Green",color:"#306230"},{id:"gb-c2",name:"Light Green",color:"#8bed81"},{id:"gb-c3",name:"Pale Green",color:"#9bbc0f"}]}),ue=new Palette({locked:!0,id:"lospec500-palette",name:"LoSpec500",description:"A compact 5-color palette created by LoSpec. Perfect for a very limited, highly stylized look, ideal for small icons, simple sprites, or monochrome game concepts.",colors:[{id:"lospec500-c0",name:"Dark Grey",color:"#242424"},{id:"lospec500-c1",name:"Medium Grey",color:"#5b5b5b"},{id:"lospec500-c2",name:"Light Grey",color:"#939393"},{id:"lospec500-c3",name:"Lighter Grey",color:"#c4c4c4"},{id:"lospec500-c4",name:"White",color:"#fcfcfc"}]}),ge=new Palette({locked:!0,name:"NES",description:"A selection of the fixed colors from the Nintendo Entertainment System.",colors:[{id:"nes-0",color:"#6F6F6F"},{id:"nes-1",color:"#000080"},{id:"nes-2",color:"#20008E"},{id:"nes-3",color:"#400078"},{id:"nes-4",color:"#800000"},{id:"nes-5",color:"#A00000"},{id:"nes-6",color:"#881400"},{id:"nes-7",color:"#604000"},{id:"nes-8",color:"#206000"},{id:"nes-9",color:"#007400"},{id:"nes-10",color:"#006C20"},{id:"nes-11",color:"#006464"},{id:"nes-12",color:"#004080"},{id:"nes-13",color:"#000000"},{id:"nes-14",color:"#000000"},{id:"nes-15",color:"#000000"}]}),fe=new Palette({locked:!0,id:"pico8-palette",name:"PICO-8",description:"The classic 16-color palette of the PICO-8 Fantasy Console. Known for its vibrant and slightly 'retro' Lo-Fi look, ideal for stylized games.",colors:[{id:"pico8-c0",name:"Black",color:"#000000"},{id:"pico8-c1",name:"Dark Blue",color:"#1d2b53"},{id:"pico8-c2",name:"Dark Purple",color:"#7e2553"},{id:"pico8-c3",name:"Dark Green",color:"#008751"},{id:"pico8-c4",name:"Brown",color:"#ab5236"},{id:"pico8-c5",name:"Dark Gray",color:"#5f574f"},{id:"pico8-c6",name:"Light Gray",color:"#c2c3c7"},{id:"pico8-c7",name:"White",color:"#fff1e8"},{id:"pico8-c8",name:"Red",color:"#ff004d"},{id:"pico8-c9",name:"Orange",color:"#ffa300"},{id:"pico8-c10",name:"Yellow",color:"#ffec27"},{id:"pico8-c11",name:"Green",color:"#00e436"},{id:"pico8-c12",name:"Blue",color:"#29adff"},{id:"pico8-c13",name:"Indigo",color:"#83769c"},{id:"pico8-c14",name:"Pink",color:"#ff77a8"},{id:"pico8-c15",name:"Peach",color:"#ffccaa"}]});const Ae=new Palette({locked:!0,name:"Windows 256 Color",description:"A palette inspired by the classic Windows 256 color set, including VGA colors, web-safe colors, and grayscale.",colors:function generateWindows98_256ColorPalette(){const e=[];e.push([0,0,0],[128,0,0],[0,128,0],[128,128,0],[0,0,128],[128,0,128],[0,128,128],[192,192,192],[128,128,128],[255,0,0],[0,255,0],[255,255,0],[0,0,255],[255,0,255],[0,255,255],[255,255,255],[0,0,0,0],[0,0,0,0]);const t=[0,51,102,153,204,255];for(let o=0;o<6;o++)for(let i=0;i<6;i++)for(let s=0;s<6;s++){const n=t[o],a=t[i],r=t[s];e.push([n,a,r])}for(let o=0;o<24;o++){const t=8+10*o;e.push([t,t,t])}return e.map(e=>new Color(e[0],e[1],e[2]))}().map(e=>new PaletteColor({color:e}))}),ye=new Palette({locked:!0,name:"ZX Spectrum Palette",description:"The 15 colors of the ZX Spectrum, including bright variants.",colors:[{id:"zx-0",color:"#000000"},{id:"zx-1",color:"#0000D7"},{id:"zx-2",color:"#D70000"},{id:"zx-3",color:"#D700D7"},{id:"zx-4",color:"#00D700"},{id:"zx-5",color:"#00D7D7"},{id:"zx-6",color:"#D7D700"},{id:"zx-7",color:"#D7D7D7"},{id:"zx-8",color:"#000000"},{id:"zx-9",color:"#0000FF"},{id:"zx-10",color:"#FF0000"},{id:"zx-11",color:"#FF00FF"},{id:"zx-12",color:"#00FF00"},{id:"zx-13",color:"#00FFFF"},{id:"zx-14",color:"#FFFF00"},{id:"zx-15",color:"#FFFFFF"}]});var we=(e=>(e.AAP_64="aap_64",e.APPLE_2="apple_2",e.ARNE_16="arne_16",e.BOB_ROSS="bob_ross",e.BUBBLEGUM_16="bubblegum_16",e.C64="c64",e.CGA_0="cga_0",e.CGA_1="cga_1",e.CGA_2="cga_2",e.DB_16="db_16",e.EDG_20="edg_20",e.GAME_BOY="game_boy",e.LOSPEC_500="lospec_500",e.NES="nes",e.PICO_8="pico_8",e.WIN_256="win_256",e.ZX_SPECTRUM="zx_spectrum",e))(we||{});const Ce={aap_64:oe,apple_2:ie,arne_16:se,bob_ross:ne,bubblegum_16:ae,c64:re,cga_0:ce,cga_1:le,cga_2:pe,db_16:de,edg_20:he,game_boy:me,lospec_500:ue,nes:ge,pico_8:fe,win_256:Ae,zx_spectrum:ye};function getPalettes(){return Object.values(Ce)}function getPalette(e){if(!e||"string"!=typeof e)throw new Error("Invalid palette name");return Ce[e]}function getDefaultBrushSelect(){return{type:X.CIRCLE,size:1}}function getDefaultToolSelect(){return{shapeStyle:Z.STROKED_FILLED,value:q.NONE,segmentLength:1,gapLength:0,interpolateSegments:!1,airBrushStrength:50,airBrushWeight:1}}function getDefaultColorSelect(){return{primaryColor:new PaletteColor({color:new Color(0,0,0)}),secondaryColor:new PaletteColor({color:new Color(255,0,0)}),palette:getPalette("aap_64")}}function getBrushSelectOptions(){return[{value:{type:X.CIRCLE,size:1},title:"Small Circle"},{value:{type:X.CIRCLE,size:3},title:"Medium Circle"},{value:{type:X.CIRCLE,size:5},title:"Large Circle"},{value:{type:X.CIRCLE,size:7},title:"Extra Large Circle"},{value:{type:X.SQUARE,size:5},title:"Extra Large Square"},{value:{type:X.SQUARE,size:4},title:"Large Square"},{value:{type:X.SQUARE,size:3},title:"Medium Square"},{value:{type:X.SQUARE,size:2},title:"Small Square"},{value:{type:X.DOTS,size:4},title:"Small Dots"},{value:{type:X.DOTS,size:8},title:"Medium Dots"}]}function getToolSelectOptions({shiftActive:e,canRedo:t,canUndo:o}){return[{value:q.DOTTED_FREEHAND,title:"Dotted Freehand",hotKey:{shift:!0,code:I.KEY_D,title:"D"}},{value:q.CONTINUOUS_FREEHAND,title:"Continuous Freehand",hotKey:{shift:!0,code:I.KEY_B,title:"B"}},{value:q.STRAIGHT_LINE,title:"Straight Line"},{value:q.CURVE_LINE,title:"Curve"},{value:q.FILL_TOOL,title:"Fill Tool"},{value:q.AIR_BRUSH,title:"Air Brush"},{value:q.RECTANGLE,title:"Rectangle"},{value:q.CIRCLE,title:"Circle"},{value:q.ELLIPSE,title:"Ellipse"},{value:q.POLYGON,title:"Polygon"},{value:q.CROP,title:"Brush Selector"},{passive:!0,value:q.SPLIT_SCREEN,title:"Split Screen"},{value:q.COLOR_PICKER,title:"Color Picker",hotKey:{code:I.KEY_I,title:"I"}},{passive:!0,value:q.ZOOM_FIT,title:"Fit to Screen"},{value:q.MAGNIFY,title:"Magnify"},{value:q.ZOOM,title:"Zoom"},...e?[{disabled:!t,value:q.STACK_REDO,passive:!0,title:"Redo"}]:[{disabled:!o,value:q.STACK_UNDO,passive:!0,title:"Undo"}],{value:q.CLEAR,passive:!0,title:"Clear"}]}var Ee=(e=>(e.START="start",e.STOP="stop",e.FORWARD="forward",e.BACKWARD="backward",e))(Ee||{});class AppActions{constructor(e){this.app=e}startStack(){return this.app.workerManager.action({type:N.STACK,payload:{action:Ee.START}})}stopStack(){return this.app.workerManager.action({type:N.STACK,payload:{action:Ee.STOP}})}stackUndo(){return this.app.workerManager.action({type:N.STACK,payload:{action:Ee.BACKWARD}})}stackRedo(){return this.app.workerManager.action({type:N.STACK,payload:{action:Ee.FORWARD}})}setSelectOptions(e){return this.app.workerManager.action({type:N.SET_SELECT_OPTIONS,payload:e})}getData(e={}){return this.app.workerManager.action({type:N.GET_DATA,payload:e})}resize(e){return this.app.workerManager.action({type:N.RESIZE,payload:e})}resizeCanvas(e){return this.app.workerManager.action({type:N.RESIZE_CANVAS,payload:e})}async getColors(){return await this.app.workerManager.action({type:N.GET_COLORS,payload:{}})}}class AppOptions{constructor(e){__publicField(this,"select"),__publicField(this,"display"),__publicField(this,"zoomStep");const{select:t,display:o,zoomStep:i}=e||{};this.select=t||{brush:getDefaultBrushSelect(),tool:getDefaultToolSelect(),color:getDefaultColorSelect()},this.display=o||{colors:{background:new Color(255,255,255),foreground:new Color(0,0,0)},grid:{color:new Color(0,0,0,.2),lineWidth:1,visibleCount:10}},this.zoomStep=i||.2}}class App{constructor({options:e},t){__publicField(this,"actions",new AppActions(this)),__publicField(this,"state",{stackCount:0,stackIndex:-1,stackMaxSize:0}),__publicField(this,"workerManager"),__publicField(this,"currentDocument"),__publicField(this,"currentDisplay"),__publicField(this,"canvas"),__publicField(this,"options"),__publicField(this,"displays",[]),this.options=new AppOptions(e),this.workerManager=new WorkerManager(this,t),this.setDisplay(this.addDisplay())}async setup(){await this.workerManager.setup(),this.setDocument(function getBlankDocument(e=r(300,240)){return new Document({name:"Blank Document",meta:{dimension:e},data:createBlankImageBitmap(e.x,e.y)})}())}closeDocument(){this.currentDocument=void 0}addDisplay(e){const t=new Display(this,{colors:this.options.display.colors,grid:this.options.display.grid,...e||{}});return this.displays.push(t),t}setDisplays(e){if(e<1||e>4)throw new Error("Display count must be between 1 and 4");const t=e-this.displays.length;for(let o=0;o<Math.abs(t);o++)t<0?this.removeDisplay(this.displays[this.displays.length-1]):this.addDisplay()}setDisplayColors(e){this.displays.forEach(t=>{t.setColors(e)})}setDisplayGrid(e){this.displays.forEach(t=>{t.setGrid(e)})}get hasMaxDisplays(){return this.displays.length>=4}async setDisplayCanvas(e,t){await this.workerManager.addDisplay(e,t)}removeDisplayCanvas(e){this.workerManager.removeDisplay(e)}removeDisplay(e){this.workerManager.removeDisplay(e),this.displays=this.displays.filter(t=>t!==e)}removeDisplays(){return Promise.all(this.displays.map(e=>this.workerManager.removeDisplay(e)))}async setDocument(e){this.currentDocument&&this.currentDocument.destroy();const t=e.data;this.currentDocument=e;const o={type:N.LOAD_IMAGE,payload:{imageBitmap:t}};await this.workerManager.action(o,[t])}setDisplay(e){"string"==typeof e&&(e=this.displays.find(t=>t.id===e)),this.currentDisplay=e}actionDisplay(e,t,o){return this.workerManager.action(t,o,e.worker)}get ready(){return Promise.all([this.workerManager.ready])}setState(e){this.state={...this.state,...e}}setBrush(e){this.options.select.brush=e}setSelectOptions(e,t,o=!1){let i;o&&(i={...this.options.select[e],...t}),this.options.select={...this.options.select,[e]:i||t},this.actions.setSelectOptions(this.options.select)}setColor(e){this.options.select.color=e}setColorPalette(e){this.options.select.color.palette=e}async getImageData(){const{payload:e}=await this.actions.getData(),{buffer:t,dimension:o}=e,i=new Uint8ClampedArray(t.length);return i.set(t),new ImageData(i,o.x,o.y)}}function getDefaultThemeColors(e=["#FFF","#000","#FFAA55","#0055AA"]){return{originSelect:{background:e[2],foreground:e[0],selected:{background:e[1],foreground:e[0]}},aspectRatioPreview:{background:e[3],foreground:e[0],filled:{background:e[0],foreground:e[3]}},colorSelect:{border:e[3],selcted:{border:e[0]},filled:{border:e[0],selected:{border:e[3]}}},iconButton:{background:e[1],foreground:e[0],hover:{background:e[1],foreground:e[0]},filled:{background:e[3],foreground:e[0],hover:{background:e[2],foreground:e[3]}}},sidebar:{background:{primary:e[2],secondary:e[0]},border:e[2],brushSelect:{background:e[0],item:{foreground:e[2],selected:{foreground:e[3]}}},toolSelect:{background:e[2],item:{background:e[0],foreground:e[3],selected:{background:e[2],foreground:e[3]}}},colorSelect:{background:"#000",item:{selected:{border:"#fff"}}}}}}const be=new P({name:"Pastel Beige",colorOptions:{layout:{primary:"#F5F5DC",secondary:"#000000",tertiary:"#D2B48C",quaternary:"#6B4226",invert:{primary:"#6B4226",secondary:"#D2B48C",tertiary:"#000000",quaternary:"#F5F5DC"}},content:{primary:"#F5F5DC",secondary:"#000000",tertiary:"#D2B48C",quaternary:"#6B4226",invert:{primary:"#F5F5DC",secondary:"#6B4226",tertiary:"#000000",quaternary:"#F5F5DC"}}}}).extend({name:"Web Painting",colors:{disks:{webPaint:getDefaultThemeColors(["#F5F5DC","#6B4226","#D2B48C","#000000"])}}});class Tool{constructor({type:e,app:t,actions:o,domEvents:i,options:s}){__publicField(this,"type"),__publicField(this,"app"),__publicField(this,"actions"),__publicField(this,"options"),__publicField(this,"domEvents"),this.type=e,this.app=t,this.actions=o,this.options=s||{},this.domEvents=i}destroy(){}getDisplay(){return this.app.currentDisplay}action(e={},t){}}class InteractionTool extends Tool{constructor({domEvents:e,interactingMove:t,...o}){super({...o}),__publicField(this,"interactingMove",!1),this.interactingMove=t??!0,this.domEvents=e}click(e,t){}async pointerDown(e){}async pointerUp(e){}pointerMove(e){}contextMenu(e){}pointerCancel(e){}cancel(e){}reset(e){e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height)}action(e={},{event:{dimension:t,normalizedPosition:o}}){const i={...this.options,...e},s=this.app.workerManager,n=this.getDisplay();return s.action({type:N.USE_TOOL,payload:{tool:this.type,toolOptions:i,meta:{dimension:t,displayPosition:n.options.position,position:o,zoomLevel:n.options.zoomLevel}}})}}class Brush extends InteractionTool{constructor(e){super({...e,options:{...e.options,stackable:!0}})}pointerMove(e){super.pointerMove(e),this.action({},{event:e})}async pointerDown(e){await super.pointerDown(e),await this.app.actions.startStack(),this.action({},{event:e})}async pointerUp(e){await super.pointerUp(e),await this.app.actions.stopStack()}}class DottedFreehand extends Brush{constructor(e){var t;super({...e,type:e.type||q.DOTTED_FREEHAND,options:{...e.options,holdInterval:(null==(t=e.options)?void 0:t.holdInterval)||20}}),__publicField(this,"timer"),__publicField(this,"canPressHold"),__publicField(this,"holdEvent"),this.canPressHold=!1}async pointerDown(e){if(await super.pointerDown(e),this.canPressHold){if(!this.options.holdInterval)throw new Error("Hold interval must be defined for DottedFreehand tool.");this.timer=R(0,this.options.holdInterval).subscribe(()=>{this.pointerMove({...e,...this.holdEvent})})}}pointerMove(e){this.canPressHold&&(this.holdEvent=e),super.pointerMove(e)}async pointerUp(e){return this.timer&&(this.timer.unsubscribe(),this.timer=void 0,this.holdEvent=void 0),super.pointerUp(e)}}class Anchor{constructor(e){__publicField(this,"dimension",r(11,11)),__publicField(this,"position",r(0,0)),__publicField(this,"intersectMap"),__publicField(this,"selected",!1),this.position=r(e.x,e.y)}intersect(e){const t=e.x<this.position.x+this.dimension.x&&e.x+this.dimension.x>this.position.x,o=e.y<this.position.y+this.dimension.y&&e.y+this.dimension.y>this.position.y;return t&&o}}var _e=(e=>(e.START="start",e.MOVE="move",e.STOP="stop",e))(_e||{});class GeometryLine extends InteractionTool{constructor(e){super({...e,options:{...e.options,stackable:!0}}),__publicField(this,"startEvent"),__publicField(this,"selectedAnchor"),__publicField(this,"anchors"),this.selectedAnchor=void 0,this.anchors=[]}async pointerDown(e){await super.pointerDown(e),this.startEvent=e}cancel(e){super.cancel(e),this.reset(e)}drawAnchors(e,t={stroke:!0}){this.anchors.forEach(o=>{this.drawAnchor(e,o,t)})}drawAnchor(e,t,{stroke:o}={stroke:!0}){e.ctx.lineWidth=1,e.ctx.fillStyle=this.app.options.select.color.secondaryColor.color.toHex(),t!==this.selectedAnchor&&o||(e.ctx.fillStyle=this.app.options.select.color.primaryColor.color.toInverted().toHex()),e.ctx.strokeStyle=this.app.options.select.color.primaryColor.color.toHex();const i=r(()=>Math.round(t.position-t.dimension/2));e.ctx.fillRect(i.x,i.y,t.dimension.x,t.dimension.y),e.ctx.strokeRect(i.x,i.y,t.dimension.x,t.dimension.y)}getAnchorByPosition(e){return this.anchors.find(t=>!!t.intersect(e)&&t)}addAnchor(e){const t=new Anchor(e);return this.anchors.push(t),t}reset(e){super.reset(e),this.anchors=[],this.selectedAnchor=void 0}}function getAnchorHelperPosition(e,t){const o=function getLinePoints(e,t,o,i,s=0){const n=Math.abs(o-e),a=e<o?1:-1,r=Math.abs(i-t),c=t<i?1:-1;let l=(n>r?n:-r)/2;const p=[];let d=0;for(;0===s||d>=1?(p.push([e,t]),d=0):d+=1/s,e!==o||t!==i;){const o=l;o>-n&&(l-=r,e+=a),o<r&&(l+=n,t+=c)}return p}(Math.round(e.position.x),Math.round(e.position.y),Math.round(t.position.x),Math.round(t.position.y));return o[Math.floor(o.length/4)]}class Ellipse extends InteractionTool{constructor(e){super({...e,type:q.ELLIPSE,options:{...e.options,position:r(0,0),dimension:r(0,0)}}),__publicField(this,"bounds",{position:r(0,0),dimension:r(0,0)}),__publicField(this,"startEvent"),__publicField(this,"actionTimeout")}async pointerUp(e){const{normalizePosition:t,normalizeDimension:o}=e;if(!this.startEvent)return;const i=this.bounds;this.startEvent=void 0,await this.app.actions.startStack(),await this.action({state:"STOP",position:t(i.position),dimension:o(i.dimension)},{event:e}),await this.app.actions.stopStack(),this.reset(e)}async pointerDown(e){this.startEvent=e;const{ctx:t,normalizePosition:o,normalizeDimension:i}=e;t.beginPath(),this.action({state:"START",stackable:!1,position:o(this.bounds.position),dimension:i(this.bounds.dimension)},{event:e})}pointerMove(e){const{position:t,normalizePosition:o,normalizeDimension:i}=e;if(!this.startEvent)return;let s=r(()=>t-this.startEvent.position);this.options.square&&(s=r(s.x,Math.abs(s.x)*(s.y<0?-1:1))),this.bounds={position:this.startEvent.position,dimension:s},window.clearTimeout(this.actionTimeout),this.actionTimeout=window.setTimeout(()=>{this.action({state:"MOVE",stackable:!1,position:o(this.bounds.position),dimension:i(this.bounds.dimension)},{event:e})},1e3/60)}reset(e){super.reset(e);const{ctx:t}=e;t.clearRect(0,0,t.canvas.width,t.canvas.height)}}class AbstractTool extends Tool{constructor(e){super({...e,options:{...e.options,abstract:!0}})}async execute(e){this.options.stackable&&await this.app.actions.startStack(),await this.app.workerManager.action({type:N.USE_TOOL,payload:{tool:this.type,toolOptions:{...this.options,...e}}}),this.options.stackable&&await this.app.actions.stopStack()}action(e={}){const t={...this.options,...e};this.app.workerManager.action({type:N.USE_TOOL,payload:{tool:this.type,toolOptions:t}})}}const ve={[q.NONE]:class None extends InteractionTool{},[q.ZOOM]:class Zoom extends InteractionTool{constructor(e){super({...e,type:q.ZOOM,options:{}})}async pointerUp({normalizedPosition:e}){var t;const o=this.getDisplay(),i=this.app.options.zoomStep,s=1+((null==(t=this.domEvents)?void 0:t.shiftLeftActive)?-i:i);o.options.zoomLevel=s,await o.action({type:N.SET_ZOOM,payload:{zoomLevel:s,position:e}})}},[q.MAGNIFY]:class Magnify extends InteractionTool{constructor(e){super({...e,type:q.MAGNIFY,options:{}}),__publicField(this,"bounds"),__publicField(this,"startPosition"),__publicField(this,"color",new Color(255,170,85,1))}async pointerUp({dimension:e,ctx:t,normalizePosition:o}){var i;if(t.clearRect(0,0,t.canvas.width,t.canvas.height),!this.startPosition||!this.bounds)return;const s=this.bounds,n=this.getDisplay(),a=r(()=>Math.abs(e/s.dimension*n.app.options.zoomStep));if(a.x===1/0||a.y===1/0)return;const c=o(r(()=>s.position+s.dimension/2)),l=1+((null==(i=this.domEvents)?void 0:i.shiftLeftActive)?-1:1)*Math.max(a.x,a.y);this.startPosition=void 0,await n.action({type:N.SET_ZOOM,payload:{zoomLevel:l,position:c}})}async pointerDown({position:e,ctx:t}){this.startPosition=e,t.beginPath()}pointerMove({position:e,ctx:t}){this.startPosition&&(t.clearRect(0,0,t.canvas.width,t.canvas.height),t.strokeStyle=`2px ${this.color.toHex()}`,t.lineWidth=2,this.bounds={position:this.startPosition,dimension:r(()=>e-this.startPosition)},t.strokeRect(this.bounds.position.x,this.bounds.position.y,this.bounds.dimension.x,this.bounds.dimension.y))}},[q.CONTINUOUS_FREEHAND]:class ContinuousFreehand extends DottedFreehand{constructor(e){super({...e,type:q.CONTINUOUS_FREEHAND,options:{lastPosition:r(0,0)}})}async pointerDown(e){this.options.lastPosition=e.normalizedPosition,await super.pointerDown(e)}pointerMove(e){super.pointerMove(e),this.options.lastPosition=e.normalizedPosition}async pointerUp(e){return this.options.lastPosition=e.normalizedPosition,super.pointerUp(e)}},[q.STRAIGHT_LINE]:class StraightLine extends GeometryLine{constructor(e){super({...e,type:q.STRAIGHT_LINE}),__publicField(this,"lineWidth",2),__publicField(this,"started",!1)}async pointerDown(e){if(await super.pointerDown(e),this.selectedAnchor){const t=this.getAnchorByPosition(e.position);t?this.selectedAnchor=t:(await this.app.actions.startStack(),await this.action({state:_e.STOP,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(t=>e.normalizePosition(t.position))},{event:e}),await this.app.actions.stopStack(),this.reset(e))}else this.action({state:_e.START,stackable:!1},{event:e}),this.started=!0;this.render(e)}async pointerMove(e){var t;this.started&&(await super.pointerMove(e),(null==(t=this.domEvents)?void 0:t.pointerActive)&&(this.anchors.length<1&&(this.addAnchor(e.position),this.selectedAnchor=this.addAnchor(e.position)),this.selectedAnchor&&(this.selectedAnchor.position=e.position),this.render(e),this.action({stackable:!1,state:_e.MOVE,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(t=>e.normalizePosition(t.position))},{event:e})))}reset(e){super.reset(e),this.started=!1}render(e){e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),this.anchors.length>1&&this.drawAnchors(e)}},[q.CURVE_LINE]:class CurveLine extends GeometryLine{constructor(e){super({...e,type:q.CURVE_LINE}),__publicField(this,"lineWidth",2),__publicField(this,"started",!1),__publicField(this,"primaryHelperOffset"),__publicField(this,"secondaryHelperOffset")}async pointerUp(e){await super.pointerUp(e),this.anchors.length>1&&4!==this.anchors.length&&this.createHelpers(e),this.selectedAnchor=void 0}async pointerDown(e){await super.pointerDown(e);const t=this.getAnchorByPosition(e.position);if(t&&this.selectedAnchor!==t)this.selectedAnchor=t;else{if(4===this.anchors.length&&!t)return await this.app.actions.startStack(),await this.action({state:_e.STOP,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(t=>e.normalizePosition(t.position))},{event:e}),await this.app.actions.stopStack(),void this.reset(e);this.anchors.length>1&&4!==this.anchors.length?this.createHelpers(e):this.selectedAnchor||(this.addAnchor(e.position),this.selectedAnchor=this.addAnchor(e.position),this.action({state:_e.START,stackable:!1},{event:e}),this.started=!0)}this.render(e)}async pointerMove(e){var t;if(this.started&&(await super.pointerMove(e),null==(t=this.domEvents)?void 0:t.pointerActive)){if(this.anchors.length<2&&(this.addAnchor(e.position),this.selectedAnchor=this.addAnchor(e.position)),this.selectedAnchor){let t=e.position;t=e.position,this.selectedAnchor.position=t,this.selectedAnchor===this.primaryAnchor&&this.primaryHelper?this.primaryHelper.position=this.primaryHelperOffset:this.selectedAnchor===this.secondaryAnchor&&this.secondaryHelper?this.secondaryHelper.position=r(()=>this.selectedAnchor.position+this.secondaryHelperOffset):this.selectedAnchor!==this.primaryHelper&&this.selectedAnchor!==this.secondaryHelper||this.refreshHelperOffset()}this.render(e),this.action({state:_e.MOVE,stackable:!1,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(t=>e.normalizePosition(t.position))},{event:e})}}reset(e){super.reset(e),this.started=!1,this.primaryHelperOffset=void 0,this.secondaryHelperOffset=void 0}get primaryAnchor(){return this.anchors[0]}get secondaryAnchor(){return this.anchors[1]}get primaryHelper(){return this.anchors[2]}get secondaryHelper(){return this.anchors[3]}refreshHelperOffset(){this.primaryHelper&&(this.primaryHelperOffset=r(()=>this.primaryHelper.position-this.primaryAnchor.position)),this.secondaryHelper&&(this.secondaryHelperOffset=r(()=>this.secondaryHelper.position-this.secondaryAnchor.position))}createHelpers(e){let t=getAnchorHelperPosition(this.primaryAnchor,this.secondaryAnchor);this.addAnchor(r(t[0],t[1])),t=getAnchorHelperPosition(this.secondaryAnchor,this.primaryAnchor),this.addAnchor(r(t[0],t[1])),this.refreshHelperOffset(),this.render(e)}render(e){if(e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),this.anchors.length>1){const t=new Path2D;this.anchors.length>2?(t.moveTo(this.primaryAnchor.position.x,this.primaryAnchor.position.y),t.bezierCurveTo(this.primaryHelper.position.x,this.primaryHelper.position.y,this.secondaryHelper.position.x,this.secondaryHelper.position.y,this.secondaryAnchor.position.x,this.secondaryAnchor.position.y)):(t.moveTo(this.primaryAnchor.position.x,this.primaryAnchor.position.y),t.lineTo(this.secondaryAnchor.position.x,this.secondaryAnchor.position.y)),e.ctx.strokeStyle=this.app.options.select.color.primaryColor.color.toInverted().toHex(),e.ctx.lineWidth=this.lineWidth,e.ctx.stroke(t)}this.drawAnchors(e,{stroke:!1})}},[q.DOTTED_FREEHAND]:DottedFreehand,[q.AIR_BRUSH]:class AirBrush extends InteractionTool{constructor(e){var t;super({...e,type:q.AIR_BRUSH,options:{...e.options,stackable:!0,holdInterval:(null==(t=e.options)?void 0:t.holdInterval)||10,round:!0}}),__publicField(this,"timer"),__publicField(this,"holdEvent")}pointerMove(e){super.pointerMove(e),this.holdEvent=e,this.action(this.options,{event:e})}async pointerDown(e){if(await super.pointerDown(e),await this.app.actions.startStack(),!this.options.holdInterval)throw new Error("Hold interval must be defined for DottedFreehand tool.");this.timer=R(0,this.options.holdInterval).subscribe(()=>{this.pointerMove({...e,...this.holdEvent})})}async pointerUp(e){this.timer&&(this.timer.unsubscribe(),this.timer=void 0,this.holdEvent=void 0),await super.pointerUp(e),await this.app.actions.stopStack()}},[q.RECTANGLE]:class Rectangle extends InteractionTool{constructor(e){super({...e,type:q.RECTANGLE,options:{...e.options,position:r(0,0),dimension:r(0,0)}}),__publicField(this,"startEvent"),__publicField(this,"bounds",{position:r(0,0),dimension:r(0,0)})}async pointerUp(e){const{normalizePosition:t,normalizeDimension:o}=e;if(!this.startEvent)return;const i=this.bounds;this.startEvent=void 0,await this.app.actions.startStack(),await this.action({state:"STOP",position:t(i.position),dimension:o(i.dimension)},{event:e}),await this.app.actions.stopStack(),this.reset(e)}async pointerDown(e){await super.pointerDown(e),this.startEvent=e;const{ctx:t,normalizePosition:o,normalizeDimension:i}=e;t.beginPath(),this.action({state:"START",stackable:!1,position:o(this.bounds.position),dimension:i(this.bounds.dimension)},{event:e})}pointerMove(e){const{position:t,normalizePosition:o,normalizeDimension:i}=e;this.startEvent&&(this.bounds={position:this.startEvent.position,dimension:r(()=>t-this.startEvent.position)},this.action({state:"MOVE",stackable:!1,position:o(this.bounds.position),dimension:i(this.bounds.dimension)},{event:e}))}reset(e){super.reset(e);const{ctx:t}=e;t.clearRect(0,0,t.canvas.width,t.canvas.height)}},[q.CIRCLE]:class Circle extends Ellipse{constructor(e){super({...e,type:q.CIRCLE,options:{...e.options,square:!0}})}},[q.ELLIPSE]:Ellipse,[q.POLYGON]:class Polygon extends GeometryLine{constructor(e){var t;super({...e,type:q.POLYGON}),__publicField(this,"lineWidth",2),__publicField(this,"subscription",new w),__publicField(this,"started",!1),__publicField(this,"preComplete",!1),__publicField(this,"complete",!1),this.subscription.add(null==(t=this.domEvents)?void 0:t.keyDown.subscribe(async e=>{!this.startEvent||e.key!==T.BACKSPACE&&e.key!==T.DELETE||(this.anchors=this.anchors.filter(e=>e!==this.selectedAnchor),this.render(this.startEvent))}))}destroy(){super.destroy(),this.subscription.unsubscribe()}async pointerDown(e){await super.pointerDown(e);const t=this.getAnchorByPosition(e.position);this.selectedAnchor?t?t!==this.selectedAnchor?(this.preComplete=!1,this.selectedAnchor=t):this.preComplete?(this.complete=!0,this.selectedAnchor=void 0,await this.app.actions.startStack(),await this.action({state:_e.STOP,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(t=>e.normalizePosition(t.position)),complete:!0},{event:e}),await this.app.actions.stopStack(),this.reset(e)):t==t&&(this.preComplete=!0):this.complete||(this.selectedAnchor=this.addAnchor(e.position),this.action({stackable:!1,state:_e.MOVE,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(t=>e.normalizePosition(t.position))},{event:e})):t?(this.preComplete=!1,this.selectedAnchor=t):(this.action({state:_e.START,stackable:!1},{event:e}),this.selectedAnchor=this.addAnchor(e.position),this.started=!0),this.render(e)}async pointerMove(e){var t;this.started&&(await super.pointerMove(e),(null==(t=this.domEvents)?void 0:t.pointerActive)&&(this.selectedAnchor&&(this.selectedAnchor.position=e.position),this.render(e),this.action({stackable:!1,state:_e.MOVE,anchorDimension:e.normalizeDimension(this.anchors[0].dimension),anchorPositions:this.anchors.map(t=>e.normalizePosition(t.position))},{event:e})))}reset(e){super.reset(e),this.started=!1,this.complete=!1,this.preComplete=!1}render(e){this.anchors.forEach(e=>{e.selected=this.selectedAnchor===e}),e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),this.drawAnchors(e,{stroke:!this.preComplete})}},[q.STACK_REDO]:class StackRedo extends InteractionTool{constructor(e){super({...e,type:q.STACK_REDO,options:{}})}click(e,t){super.click(e,t),this.app.actions.stackRedo()}},[q.STACK_UNDO]:class StackUndo extends InteractionTool{constructor(e){super({...e,type:q.STACK_UNDO,options:{}})}click(e,t){super.click(e,t),this.app.actions.stackUndo()}},[q.FILL_TOOL]:class Fill extends InteractionTool{constructor(e){super({...e,type:q.FILL_TOOL,options:{...e.options,stackable:!0}})}async pointerDown(e){await super.pointerDown(e),await this.app.actions.startStack(),await this.action({},{event:e}),await this.app.actions.stopStack()}},[q.CROP]:class Crop extends InteractionTool{constructor(e){super({...e,type:q.CROP,options:{...e.options,stackable:!0}}),__publicField(this,"bounds"),__publicField(this,"color",new Color(255,0,0,255)),__publicField(this,"moving",!1),__publicField(this,"startEvent"),__publicField(this,"lastEvent"),__publicField(this,"moveOffset")}cancel(e){this.reset(e)}async pointerDown(e){const t=this.bounds&&function boundsIntersect(e,t){const o=r(()=>Math.min(t.dimension,0)),i=r(()=>Math.round(t.position+o));return e.x>=i.x&&e.x<=i.x+Math.abs(t.dimension.x)&&e.y>=i.y&&e.y<=i.y+Math.abs(t.dimension.y)}(e.position,this.bounds)||!1;this.moving&&this.bounds&&!t?(await this.app.actions.startStack(),this.action({state:"STOP",stackable:!0},{event:e}),await this.app.actions.stopStack(),this.reset(e)):this.bounds&&!this.moving&&t&&(this.moving=!0,this.action({state:"START",stackable:!1},{event:e})),this.moving?this.moveOffset=r(()=>e.position-this.bounds.position):(this.startEvent=e,this.lastEvent=void 0,await super.pointerDown(e)),this.render(e)}action(e,{event:t}){var o;const i=r(()=>Math.min(this.bounds.dimension,0)),s=r(()=>this.bounds.position+i);return super.action({position:t.normalizePosition(s),dimension:t.normalizeDimension(r(()=>Math.abs(this.bounds.dimension))),copy:(null==(o=this.domEvents)?void 0:o.shiftActive)||!1,...e},{event:t})}pointerMove(e){this.startEvent&&(this.moving?this.bounds.position=e.unnormalizePosition(e.fixedPosition(r(()=>e.position-this.moveOffset))):(this.bounds={position:e.unnormalizePosition(e.fixedPosition(this.startEvent.position)),dimension:e.unnormalizeDimension(e.fixedDimension(r(()=>e.position-this.startEvent.position)))},this.lastEvent=e),this.render(e),this.action({state:"MOVE",stackable:!1},{event:e}))}render(e){if(!this.bounds)return;const t=e.ctx;t.clearRect(0,0,t.canvas.width,t.canvas.height),t.strokeStyle=`dotted ${this.color.toHex()}`,t.lineWidth=1,t.setLineDash([6]),t.strokeRect(this.bounds.position.x,this.bounds.position.y,this.bounds.dimension.x,this.bounds.dimension.y)}reset(e){super.reset(e),this.bounds=void 0,this.moving=!1,this.startEvent=void 0,this.lastEvent=void 0,this.moveOffset=void 0}},[q.CLEAR]:class Clear extends InteractionTool{constructor(e){super({...e,type:q.CLEAR,options:{stackable:!0,passive:!0}})}async click(e,t){super.click(e,t),await this.app.actions.startStack(),await this.app.workerManager.action({type:N.USE_TOOL,payload:{tool:this.type,toolOptions:this.options}}),await this.app.actions.stopStack()}},[q.ZOOM_FIT]:class FitZoom extends InteractionTool{constructor(e){super({...e,type:q.ZOOM,options:{passive:!0}})}async click(){const e=this.getDisplay();e&&(await e.actions.setPosition(r(0,0)),await e.actions.setZoom(r(0,0),0),await e.action({type:N.ZOOM_FIT,payload:{}}))}},[q.COLOR_PICKER]:class ColorPicker extends InteractionTool{constructor(e){super({...e,interactingMove:!1,type:q.COLOR_PICKER,options:{}}),__publicField(this,"lastColor")}cancel(e){this.reset(e)}async pointerDown(e){await super.pointerDown(e),this.lastColor&&this.app.options.select.color.primaryColor.setColor(this.lastColor)}async pointerMove(e){if(this.getDisplay()){const{payload:t}=await this.action({},{event:e}),o=e.ctx;o.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height);const{color:i,position:s}=t;t.color&&(this.lastColor=i,function drawColorPickerInfo(e,t,o){e.fillStyle="#000",e.fillRect(t.x,t.y,188,32),e.fillStyle=o.color.toHex(),e.fillRect(t.x+6,t.y+6,20,20),e.fillStyle="#fff";const i=10,s=r(()=>t+r(32,4+i));e.font=`${i}px "BitFontCanvas"`,e.fontKerning="normal",e.letterSpacing="0px",e.fillText(`Color   : ${o.color.toHex()}`,s.x,s.y),e.fillText(`Position: ${o.position.x},${o.position.y}`,s.x,s.y+i+4)}(o,r(10,10),{color:i,position:s}))}}reset(e){e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),this.lastColor=void 0,super.reset(e)}},[q.SPLIT_SCREEN]:class SplitScreen extends InteractionTool{constructor(e){super({...e,type:q.SPLIT_SCREEN,options:{}})}async click(e,t){super.click(e,t);const{value:o}=await this.actions.prompt({type:"number",text:"Screen Count? (1-4)",value:1,min:1,max:4,size:1,step:1,required:!0});this.app.setDisplays(o)}}},Se={[q.IMAGE_OPERATION]:class ImageOperation extends AbstractTool{constructor(e){super({...e,type:q.IMAGE_OPERATION,options:{stackable:!0}})}}};function getTool(e){switch(e){case q.NONE:return ve[q.NONE];case q.ZOOM:return ve[q.ZOOM];case q.MAGNIFY:return ve[q.MAGNIFY];case q.CONTINUOUS_FREEHAND:return ve[q.CONTINUOUS_FREEHAND];case q.DOTTED_FREEHAND:return ve[q.DOTTED_FREEHAND];case q.STRAIGHT_LINE:return ve[q.STRAIGHT_LINE];case q.CURVE_LINE:return ve[q.CURVE_LINE];case q.AIR_BRUSH:return ve[q.AIR_BRUSH];case q.RECTANGLE:return ve[q.RECTANGLE];case q.CIRCLE:return ve[q.CIRCLE];case q.ELLIPSE:return ve[q.ELLIPSE];case q.POLYGON:return ve[q.POLYGON];case q.FILL_TOOL:return ve[q.FILL_TOOL];case q.CROP:return ve[q.CROP];case q.STACK_REDO:return ve[q.STACK_REDO];case q.STACK_UNDO:return ve[q.STACK_UNDO];case q.CLEAR:return ve[q.CLEAR];case q.ZOOM_FIT:return ve[q.ZOOM_FIT];case q.COLOR_PICKER:return ve[q.COLOR_PICKER];case q.SPLIT_SCREEN:return ve[q.SPLIT_SCREEN];default:throw new Error(`Tool ${e} is not implemented.`)}}const Ie=[{group:"Web & Screen",formats:[{name:"Default",dimension:{x:800,y:600}},{name:"VGA",dimension:{x:640,y:480}},{name:"SVGA",dimension:{x:800,y:600}},{name:"XGA",dimension:{x:1024,y:768}},{name:"HD (720p)",dimension:{x:1280,y:720}},{name:"Full HD (1080p)",dimension:{x:1920,y:1080}},{name:"QHD (1440p)",dimension:{x:2560,y:1440}},{name:"2K (DCI)",dimension:{x:2048,y:1080}},{name:"4K (UHD)",dimension:{x:3840,y:2160}},{name:"4K (DCI)",dimension:{x:4096,y:2160}},{name:"5K",dimension:{x:5120,y:2880}},{name:"8K (UHD)",dimension:{x:7680,y:4320}},{name:"WUXGA",dimension:{x:1920,y:1200}},{name:"Ultrawide (21:9)",dimension:{x:2560,y:1080}},{name:"Ultrawide+ (21:9)",dimension:{x:3440,y:1440}}]},{group:"Web Banners (Common Sizes)",formats:[{name:"Full x Hero",dimension:{x:1920,y:600}},{name:"Large Leaderboard",dimension:{x:970,y:250}},{name:"Leaderboard",dimension:{x:728,y:90}},{name:"Billboard",dimension:{x:800,y:250}},{name:"Medium Rectangle",dimension:{x:300,y:250}},{name:"Large Rectangle",dimension:{x:336,y:280}},{name:"Skyscraper",dimension:{x:120,y:600}},{name:"Wide Skyscraper",dimension:{x:160,y:600}},{name:"Half Page Ad",dimension:{x:300,y:600}},{name:"Mobile Leaderboard",dimension:{x:320,y:50}}]},{group:"Icons & Favicons",formats:[{name:"Small Icon (16x16)",dimension:{x:16,y:16}},{name:"Favicon (32x32)",dimension:{x:32,y:32}},{name:"Standard Icon (48x48)",dimension:{x:48,y:48}},{name:"Large Icon (64x64)",dimension:{x:64,y:64}},{name:"App Icon (128x128)",dimension:{x:128,y:128}},{name:"High-Res Icon (256x256)",dimension:{x:256,y:256}},{name:"Social Profile (512x512)",dimension:{x:512,y:512}}]},{group:"Retro Gaming (Nintendo Game Boy)",formats:[{name:"Game Boy / GBC",dimension:{x:160,y:144}},{name:"Game Boy Advance",dimension:{x:240,y:160}}]},{group:"Pixel Art",formats:[{name:"Tiny Sprite (8x8)",dimension:{x:8,y:8}},{name:"Small Sprite (16x16)",dimension:{x:16,y:16}},{name:"Medium Sprite (32x32)",dimension:{x:32,y:32}},{name:"Large Sprite (64x64)",dimension:{x:64,y:64}},{name:"Small Scene (128x128)",dimension:{x:128,y:128}},{name:"Medium Scene (256x256)",dimension:{x:256,y:256}}]},{group:"Print (ISO 216 / A-Serie)",formats:[{name:"A0",dimension:{x:841,y:1189}},{name:"A1",dimension:{x:594,y:841}},{name:"A2",dimension:{x:420,y:594}},{name:"A3",dimension:{x:297,y:420}},{name:"A4",dimension:{x:210,y:297}},{name:"A5",dimension:{x:148,y:210}}]},{group:"Print (US Standard)",formats:[{name:"Letter",dimension:{x:216,y:279}},{name:"Legal",dimension:{x:216,y:356}},{name:"Tabloid",dimension:{x:279,y:432}}]},{group:"Common Aspect Ratios & Custom",formats:[{name:"Square (1:1)",dimension:{x:1e3,y:1e3}},{name:"Custom",dimension:{x:800,y:600}}]}],Te=Ie[0].formats[0],Oe=i(({core:e})=>{let i,n,a,c,l,p,d,h;return[{meta:[[s.SYMBOL,F.WEB_PAINT]],id:"WebPaint.app",name:"Web Paint",createdDate:new Date(2017,7,5).getTime(),editedDate:new Date(2025,5,29).getTime(),async action(){var s,h;if(!(null==(s=e.modules.screen)?void 0:s.contentLayout))throw new Error("Content layout not found");const m=new App({options:{select:{brush:getDefaultBrushSelect(),tool:getDefaultToolSelect(),color:getDefaultColorSelect()},display:{colors:{background:Color.fromHex(e.config.get(L.WEB_PAINT_DISPLAY_BACKGROUND)),foreground:Color.fromHex(e.config.get(L.WEB_PAINT_DISPLAY_FOREGROUND))},grid:{color:Color.fromHex(e.config.get(L.WEB_PAINT_GRID_COLOR)),lineWidth:e.config.get(L.WEB_PAINT_GRID_LINE_WIDTH),visibleCount:e.config.get(L.WEB_PAINT_GRID_VISIBLE_COUNT)}}}},e.config),u=t({fsItem:void 0,app:m,actions:function getActions(t){const s={setTheme:t=>{var o,i;e.config.get(L.WEB_PAINT_NATIVE_THEME)&&(null==(o=e.modules.screen)?void 0:o.currentTheme)?e.modules.screen.setTheme(function getTheme(e){if(!e.colorOptions)throw new Error("Theme must have colorOptions defined");return e.extend({name:"Web Paint",colors:{disks:{webPaint:getDefaultThemeColors(k(e.colorOptions))}}})}(e.modules.screen.currentTheme)):null==(i=e.modules.screen)||i.setTheme(t)},import:async e=>{t.setDocument(await async function getDocumentFromFile(e){const t=await E(await createImageBitmap(e)),o={dimension:r(t.width,t.height)};return new Document({name:e.name||"Untitled Document",meta:o,data:t.transferToImageBitmap()})}(e))},export:async e=>{const i=await o(()=>import("./DrLItpjK.js").then(e=>e.F),__vite__mapDeps([0,1]),import.meta.url).then(e=>e.default);try{const o=await t.getImageData();let s=await _(o);e.resize&&(s=await v(s,e.resize.x,e.resize.y));const n=await s.convertToBlob({type:e.type,quality:e.quality}),a=e.type.split("/")[1]||"png",r=(e.filename||`webpainting_${Date.now()}`)+`.${a}`;await i.saveAs(n,r)}catch(s){console.error("An error occurred during export.",s)}},useAbstractTool:(e,o)=>{const i=function getAbstractTool(e){if(e===q.IMAGE_OPERATION)return Se[q.IMAGE_OPERATION];throw new Error(`Tool ${e} is not implemented.`)}(e);if(!i)throw new Error(`Tool ${e} is not implemented`);return new i({app:t,actions:s}).execute(o)},openValueInput:e=>openValueInput(e),prompt:async e=>(await openValueInput(e)).awaitClose(),openInfo:()=>async function openInfo(t){var s;if(i)return i;return i=null==(s=e.modules.windows)?void 0:s.addWindow({component:await o(()=>import("./DS57oB6w.js"),__vite__mapDeps([2,3,4,5,6,7,8,9]),import.meta.url).then(e=>e.default),componentData:{model:t},options:{title:"Info"}},{group:"extras13WebPaint"}),null==i||i.awaitClose().then(()=>{i=void 0}),i}(u),openNew:()=>async function openNew(t){var i;if(n)return n;return n=null==(i=e.modules.windows)?void 0:i.addWindow({component:await o(()=>import("./BoPkp3Jd.js"),__vite__mapDeps([10,11,5,12,13,14,15,16,17,18,19,20,21,22,3,4,6,7,8,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,1,42,43,44,45,46,47,48,49,50]),import.meta.url).then(e=>e.default),componentData:{model:t},options:{title:"New"}},{group:"extras13WebPaint"}),null==n||n.awaitClose().then(()=>{n=void 0}),n}(u),openSettings:()=>async function openSettings(t){var i;if(c)return c;return c=null==(i=e.modules.windows)?void 0:i.addWindow({component:await o(()=>import("./WX6nxCVc.js"),__vite__mapDeps([51,11,5,12,52,18,19,53,54,55,56,4,6,7,57,21,22,58,59,13,14,15,16,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,1,42,43,44,45,46,47,48,49,60]),import.meta.url).then(e=>e.default),componentData:{model:t},options:{title:"Settings"}},{group:"extras13WebPaint"}),null==c||c.awaitClose().then(()=>{c=void 0}),c}(u),openExport:()=>async function openExport(t){var i;if(a)return a;return a=null==(i=e.modules.windows)?void 0:i.addWindow({component:await o(()=>import("./CVDnhf5e.js"),__vite__mapDeps([61,23,11,5,12,21,18,19,22,17,20,13,14,15,16,62]),import.meta.url).then(e=>e.default),componentData:{model:t},options:{title:"Export"}},{group:"extras13WebPaint"}),null==a||a.awaitClose().then(()=>{a=void 0}),a}(u),close:()=>{null==f||f.close()},focus:()=>{null==f||f.focus()},newDocument:async e=>{u.fsItem=void 0,await t.setDocument(new Document({name:(null==e?void 0:e.name)||"New Document",meta:{dimension:(null==e?void 0:e.dimension)||r(640,480)}}))},openDocument:async()=>{await async function open(e,t){const o=await e.executeCommand("openFileDialog");if(o){if(!(B.CONTENT in o.value))throw new Error("Can't read file content");t.app.setDocument(await async function getDocumentFromImage(e){const t=await b(e),o={dimension:r(t.width,t.height)};return new Document({name:"Untitled Document",meta:o,data:t.transferToImageBitmap()})}(await function createImageFromBase64(e){return new Promise(t=>{const o=new Image;o.src=e,o.onload=()=>t(o)})}(o.value[B.CONTENT]))),t.fsItem=o.fsItem}}(e,u)},saveDocument:async()=>{await save(e,u)},saveAsDocument:async()=>{await save(e,u,!0)},documentResize:async e=>{await t.actions.resize(e)},documentResizeCanvas:async e=>{await t.actions.resizeCanvas(e)},openResize:()=>async function documentResize(e,t,i=!1){var s;const n=null==(s=e.modules.windows)?void 0:s.addWindow({component:await o(()=>import("./CdaMbG_B.js"),__vite__mapDeps([63,23,11,5,12,21,18,19,22,17,20,13,14,15,16,64,65]),import.meta.url).then(e=>e.default),componentData:{model:t},options:{title:"Document Resize"}},{group:"extras13WebPaint"});return i?n:null==n?void 0:n.awaitClose()}(e,u,!0),openResizeCanvas:()=>async function documentResizeCanvas(e,t,i=!1){var s;const n=null==(s=e.modules.windows)?void 0:s.addWindow({component:await o(()=>import("./CWuLX2Uz.js"),__vite__mapDeps([66,23,11,5,12,21,18,19,22,13,14,15,16,4,6,7,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,1,42,43,44,45,46,47,48,49,67]),import.meta.url).then(e=>e.default),componentData:{model:t},options:{title:"Document Resize Canvas"}},{group:"extras13WebPaint"});return i?n:null==n?void 0:n.awaitClose()}(e,u,!0),openColorPalette:()=>async function openColorPalette(e,t){if(l)return l;return l=e.modules.windows.addWindow({component:await o(()=>import("./B-pwzKj4.js"),__vite__mapDeps([68,5,11,12,13,14,15,16,17,18,19,20,56,4,6,7,57,69,70,23,38,71,25,26,27,28,44,24,29,72,30,31,32,33,34,35,36,37,39,40,41,1,42,43,45,46,47,48,49,73]),import.meta.url).then(e=>e.default),componentData:{core:e,model:t},options:{title:"Color Palette",filled:!0}},{group:"extras13WebPaint"}),l.awaitClose().then(()=>{l=void 0}),l}(e,u),openColorPicker:t=>async function openColorPicker(t){if(l)return l;return l=e.modules.windows.addWindow({component:await o(()=>import("./Bsj8ZD74.js"),__vite__mapDeps([74,75,23,5,76,17,18,19,20,21,22,11,12,13,14,15,16,4,6,7,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,1,42,43,44,45,46,47,48,49,77]),import.meta.url).then(e=>e.default),componentData:{color:t},options:{title:"Color Picker",filled:!0}},{group:"extras13WebPaint"}),l.awaitClose().then(()=>{l=void 0}),l}(t),openDebugColorPickers:()=>async function openDebugColorPickers(){if(p)return p;return p=e.modules.windows.addWindow({component:await o(()=>import("./jToR-qje.js"),__vite__mapDeps([78,75,23,5,76,21,18,19,22,4,6,7,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,1,42,43,44,45,46,47,48,49,79]),import.meta.url).then(e=>e.default),componentData:{},options:{title:"Debug Color Pickers",scrollY:!0}},{group:"extras13WebPaint"}),null==p||p.awaitClose().then(()=>{p=void 0}),p}(),openDebugColorPicker:()=>async function openDebugcolorPaletteWindow(){if(d)return d;return d=e.modules.windows.addWindow({component:await o(()=>import("./Bsj8ZD74.js"),__vite__mapDeps([74,75,23,5,76,17,18,19,20,21,22,11,12,13,14,15,16,4,6,7,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,1,42,43,44,45,46,47,48,49,77]),import.meta.url).then(e=>e.default),componentData:{},options:{title:"Debug Color Picker",filled:!0}},{group:"extras13WebPaint"}),d.awaitClose().then(()=>{d=void 0}),d}()};return s}(m)}),g=u.app;await g.setup(),g.workerManager.ready.then(async()=>{g.setDocument(function getDocumentByFormat(e){return new Document({name:"Blank Document",meta:{dimension:r(e.dimension.x,e.dimension.y)},data:createBlankImageBitmap(e.dimension.x,e.dimension.y)})}(Ie[4].formats[2]))});const f=null==(h=e.modules.windows)?void 0:h.addWindow({component:await o(()=>import("./Bez2b_CZ.js"),__vite__mapDeps([80,4,5,6,7,81,82,38,23,64,83,70,27,25,24,26,28,29,69,71,44,72,11,12,56,57,84,41,30,31,32,33,34,35,36,37,39,40,1,42,43,45,46,47,48,49,85]),import.meta.url).then(e=>e.default),componentData:{core:e,model:u},options:{title:"Web Paint",embed:!0,borderless:!0}},{group:"extras13WebPaint",full:!0});u.actions.setTheme(be),null==f||f.awaitClose().then(()=>{var t;[i,n,a,c,l,p].forEach(e=>null==e?void 0:e.close()),null==(t=e.modules.screen)||t.setTheme(void 0)})}}];async function openValueInput(t){var i;return h||(h=null==(i=e.modules.windows)?void 0:i.addWindow({component:await o(()=>import("./fyetJ82d.js"),__vite__mapDeps([86,11,5,12,21,18,19,22,87]),import.meta.url).then(e=>e.default),componentData:{...t},options:{title:"Value Input",embed:!0,center:!0,borderless:!0,filled:!0}},{group:"extras13WebPaint"}),null==h||h.awaitClose().then(()=>{h=void 0}),h)}});async function save(e,t,o=!1){const i=await t.app.getImageData(),s=await S(i);console.log("Saving content:",s);let n,a=Object.assign({[B.OUTPUT_TYPE]:"image",[B.CONTENT]:s});return a=await btoa(JSON.stringify(a)),!o&&t.fsItem?(n=await O(e,{path:t.fsItem.getPath(),data:a}),n?await e.executeCommand('openDialog "File saved."'):await e.executeCommand('openDialog "File could not be saved."'),n):(t.fsItem=await D(e,{data:a,extension:"img"}),t.fsItem)}const De=n(async({core:e})=>{var t;const[i]=(await Promise.all([o(()=>import("./DVkZsXLP.js"),[],import.meta.url)])).map(e=>e.default||e);return e.config.setDefaults(getDefaultConfig()),null==(t=e.modules.symbols)||t.addSymbols([{key:F.WEB_PAINT,component:await o(()=>import("./BkgtTaLw.js"),__vite__mapDeps([88,5]),import.meta.url).then(e=>e.default),group:"disk_web_paint"}]),{meta:[[s.SYMBOL,a.DISK_2],[s.WINDOW_SYMBOL_REARRANGE,!0],[s.VISIBLE,!0]],name:"Web Paint",items:[{id:"Readme.md",name:"Readme",data:{type:"markdown",content:i,fontSize:16},meta:[[s.POSITION,{x:90,y:5}],[s.IGNORE_SYMBOL_REARRANGE,!0],[s.SYMBOL,a.LARGE_NOTE_RICH]]},...await Oe({core:e})]}}),Pe=Object.freeze(Object.defineProperty({__proto__:null,default:De},Symbol.toStringTag,{value:"Module"}));export{X as B,L as C,M as D,x as O,Palette as P,Z as S,q as T,N as W,getToolSelectOptions as a,getDocumentFromUrl as b,getPalettes as c,Color as d,getTool as e,getDefaultConfig as f,getBrushSelectOptions as g,Te as h,Ie as i,getPalette as j,we as k,PaletteColor as l,hslToRgb as m,Pe as n,be as t};
