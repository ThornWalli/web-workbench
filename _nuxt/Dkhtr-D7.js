var e=Object.defineProperty,__publicField=(t,s,n)=>((t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n)(t,"symbol"!=typeof s?s+"":s,n);import{p as t}from"./D1WZfvAb.js";import{r as s,k as n,a0 as o,o as i,a1 as u,W as r,a7 as a,G as l}from"./BfpYGSxR.js";class ContextMenuItems{constructor(e,s){__publicField(this,"id",crypto.randomUUID()),__publicField(this,"items",[]),e&&s&&(this.items=t(e(s)))}add(e){e instanceof ContextMenuItems&&this.items.push(...e.items)}}function useWindow(){const e=s(!1),t=a("core"),d=a("window");if(!t||!d)throw new Error("Core or Window not found");const c=a("window:refresh"),h=n(()=>d.id),w=n(()=>d.layout),p=n(()=>d.options.focused||!1),v=n(()=>d.parentWindow),x=s(),M=s(),C=n(()=>d.options.embed),m=s(!1),preserveContextMenu=(e=!0)=>{m.value=e},changeFocus=e=>{var s,n,o;M.value&&(e?x.value=null==(s=t.modules.windows)?void 0:s.setActiveContextMenu(M.value):m.value||(null==(n=t.modules.windows)?void 0:n.getActiveContextMenu())!==x.value||C.value||null==(o=t.modules.windows)||o.setActiveContextMenu(null))};o(p,e=>changeFocus(e)),o(M,e=>{var s;x.value=null==(s=t.modules.windows)?void 0:s.setActiveContextMenu(e)}),i(()=>{u(()=>{e.value=!0,changeFocus(!0)})}),r(()=>{var e,s;M.value&&(null==(e=t.modules.windows)?void 0:e.isContextMenu(x.value))&&(null==(s=t.modules.windows)||s.setActiveContextMenu(null))});const f=n(()=>e.value);let y;let T=0;return new WindowDescription({isReady:f,id:h,parentFocused:p,parentLayout:w,core:t,window:d,setContextMenu:(e,s={})=>{M.value=new ContextMenuItems(e,{core:t,mainWindow:l(d),parentWindow:l(v),preserveContextMenu:preserveContextMenu,...s})},preserveContextMenu:preserveContextMenu,contextMenu:M,currentContextMenu:x,refresh:c,close:()=>{d.close()},setTitle:e=>{d.options.title!==e&&(y=d.options.title,d.options.title=e)},setTitleStatus:e=>{1===T&&0===e?d.options.title=y:0===T&&1===e&&(y=d.options.title,d.options.title=`${d.options.title} (unsaved)`),T=e}})}var d=(e=>(e[e.NONE=0]="NONE",e[e.EDIT=1]="EDIT",e))(d||{});class WindowDescription{constructor(e){__publicField(this,"isReady"),__publicField(this,"id"),__publicField(this,"parentFocused"),__publicField(this,"parentLayout"),__publicField(this,"core"),__publicField(this,"window"),__publicField(this,"setContextMenu"),__publicField(this,"preserveContextMenu"),__publicField(this,"contextMenu"),__publicField(this,"currentContextMenu"),__publicField(this,"refresh"),__publicField(this,"close"),__publicField(this,"setTitle"),__publicField(this,"setTitleStatus");const{isReady:t,id:s,parentFocused:n,parentLayout:o,core:i,window:u,setContextMenu:r,preserveContextMenu:a,contextMenu:l,currentContextMenu:d,refresh:c,close:h,setTitle:w,setTitleStatus:p}=e;this.isReady=t,this.id=s,this.parentFocused=n,this.parentLayout=o,this.core=i,this.window=u,this.setContextMenu=r,this.preserveContextMenu=a,this.contextMenu=l,this.currentContextMenu=d,this.refresh=c,this.close=h,this.setTitle=w,this.setTitleStatus=p}}export{ContextMenuItems as C,d as W,useWindow as u};
