


import{g as C,w as f,j as O,k as A,u as x,C as D,r as M,q as d}from"./index.7c17a2aa.js";import{N as w,j as U,g as H,C as s,k as Y,I as N,l as V,m as Z,M as L}from"./index.7fd70862.js";import{W as K}from"./ContextMenu.c9077db7.js";import{_ as S,f as p,k as i,l as c,m,q as k,N as I,O as g,L as E,M as T,t as b,C as _,S as $,a0 as B,W as P,E as z,I as v,z as W,H as R,a5 as F}from"./entry.0f459a47.js";import{N as j,T as G,u as q,c as X}from"./Navigation.69bd3066.js";import{T as J}from"./TimelineCanvas.3c29d824.js";import"./index.bce42005.js";import"./viewport.caa1073f.js";import"./math.40e5f1d4.js";import"./async.d9ddb331.js";const Q={components:{WbEnvMoleculeContextMenu:K},props:{parentLayout:{type:Object,default(){return{size:C(window.innerWidth,window.innerHeight)}}},title:{type:String,default:"Web-Workbench release. Version 1.3"},items:{type:Array,default(){return f.modules.windows.contextMenu.activeItems.items}}},emits:["inputContextMenu"],data(){return{cover:!1}},methods:{onUpdateModelValueContextMenu(...e){this.$emit("inputContextMenu",...e)}}},ee={class:"wb-env-molecule-footer"},te={ref:"menu",class:"menu"};function se(e,a,n,r,o,t){const l=p("wb-env-molecule-context-menu");return i(),c("footer",ee,[m("nav",te,[k(l,{direction:"top",items:n.items,"parent-layout":n.parentLayout,"onUpdate:modelValue":t.onUpdateModelValueContextMenu},null,8,["items","parent-layout","onUpdate:modelValue"])],512)])}const ae=S(Q,[["render",se],["__scopeId","data-v-f49caf4e"]]);const ne=9,oe={props:{selectedNote:{type:w,default:null},size:{type:String,validator:e=>["small","medium","large"].includes(e),default:"large"},showNoteLabels:{type:Boolean,default:!1},startOctave:{type:Number,default:4},octaveCount:{type:Number,default:6}},emits:["down","up"],data:function(){return{keys:[],dimension:C()}},computed:{selectedNotes(){var e;return this.selectedNote&&U((e=this.selectedNote)==null?void 0:e.name)||[]},height(){return{small:140,medium:210,large:280}[this.size]},octaveRange(){const e=[],a=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];for(let n=0;n<this.octaveCount;n++)e.push(...a.map(r=>{const o=`${r}${this.startOctave+n}`;return{note:o,black:this.isBlackKey(o)}}));return this.startOctave+this.octaveCount<=ne&&e.push({note:a[0]+(this.startOctave+this.octaveCount),black:!1}),e},styleClasses(){return{...this.dimension.toCSSVars("dimension"),"--height":this.height,"--keys":this.octaveRange.filter(({black:e})=>!e).length,"--white-keys":this.octaveRange.filter(({black:e})=>!e).length,"--black-keys":this.octaveRange.filter(({black:e})=>e).length}}},mounted(){this.dimension=C(this.$el.offsetWidth,0)},methods:{isBlackKey(e){return/^[a-zA-Z]{2}\d+/.test(e)},onPointerDown(e){this.$emit("down",e)},onPointerUp(e){this.$emit("up",e)}}},re={class:"keys white"},ie=["onPointerdown","onPointerup"],le={key:0},ce={key:0},de={class:"keys black"},ue=["onPointerdown","onPointerup"],me={key:0},he={key:0};function _e(e,a,n,r,o,t){return i(),c("div",{style:T(t.styleClasses),class:"wb-disks-debug-synthesizer-keyboard"},[m("div",null,[m("div",re,[(i(!0),c(I,null,g(t.octaveRange,({note:l,black:u},h)=>(i(),c("div",{key:h,class:E(["key",{black:u,white:!u,selected:t.selectedNotes.includes(l)}]),style:T({"--index":h}),onPointerdown:y=>t.onPointerDown(l),onPointerup:y=>t.onPointerUp(l)},[u?_("",!0):(i(),c("span",le,[n.showNoteLabels?(i(),c("i",ce,b(l),1)):_("",!0)]))],46,ie))),128))]),m("div",de,[(i(!0),c(I,null,g(t.octaveRange,({note:l,black:u},h)=>(i(),c("div",{key:h,class:E(["key",{black:u,white:!u,selected:t.selectedNotes.includes(l)}]),style:T({"--index":h}),onPointerdown:y=>t.onPointerDown(l),onPointerup:y=>t.onPointerUp(l)},[u?(i(),c("span",me,[n.showNoteLabels?(i(),c("i",he,b(l),1)):_("",!0)])):_("",!0)],46,ue))),128))])])],4)}const ye=S(oe,[["render",_e],["__scopeId","data-v-4e246311"]]);const pe={components:{WbEnvMoleculeFooter:ae,Navigation:j,Keyboard:ye,SynthesizerTimelineCanvas:J},props:{...O,model:{type:Object,default:H()},toneDestination:{type:Object,default:null}},emits:[...A],setup(e,a){const n=$(e,"model"),r=x(e,a);B(n,()=>{r.setContextMenu(X,{model:n.value,preserveContextMenu:r.preserveContextMenu})},{immediate:!0,deep:!0});const o=P(n.value[s.SYNTHESIZER_TRACK]),t=P(new G(o));return{...r,...q(),track:o,trackPlayer:t}},data(){return{CONFIG_NAMES:s,currentSequence:null,synth:null,maxLength:11,playing:!1,footerModel:{},windowsModule:z(this.core.modules.windows)}},computed:{selectedNoteIndex(){return this.track.selectedIndex},styleClasses(){return{[`keyboard-alignment-${this.model[s.SYNTHESIZER_KEYBOARD_ALIGNMENT]}`]:!0}},notes:{get(){return this.track.notes},set(e){this.track.notes=e}},showKeyboard(){return this.model[s.SYNTHESIZER_SHOW_KEYBOARD]},keybordData(){return{size:this.model[s.SYNTHESIZER_KEYBOARD_SIZE],showNoteLabels:this.model[s.SYNTHESIZER_SHOW_NOTE_LABELS],selectedNote:this.notes[this.selectedNoteIndex],startOctave:this.model[s.SYNTHESIZER_START_OCTAVE],octaveCount:this.model[s.SYNTHESIZER_OCTAVE_COUNT]}},bpm(){return Number(this.model[s.SYNTHESIZER_BPM])},masterVolume(){return this.core.config.observable[D.SCREEN_CONFIG].soundVolume},decibelValue(){return Y(this.masterVolume)},isMaxLength(){return this.track.octaveCount>=this.maxLength},duration(){return this.model[s.SYNTHESIZER_DURATION]},noteDiagramControlNavigation(){var e,a;return{model:this.model,items:[[this.trackPlayer.playing?{selected:!0,title:"Pause",disabled:!this.trackPlayer.currentSequence||!this.trackPlayer.playing,onClick:()=>this.onClickPlause()}:{title:"Play",disabled:this.trackPlayer.playing,onClick:()=>this.onClickPlay()},{title:"Stop",disabled:!this.trackPlayer.currentSequence,onClick:()=>this.onClickStop()},{title:"Restart",disabled:this.selectedNoteIndex<0,onClick:()=>this.onClickRestart()},{title:"Reset",onClick:()=>this.onClickReset()}],[{disabled:!((a=(e=this.trackPlayer)==null?void 0:e.getCurrentNote())!=null&&a.isPaused()),title:"Duration",onClick:async()=>{var t;const n=(t=this.trackPlayer)==null?void 0:t.getCurrentNote();this.preserveContextMenu(!0);const r="Set Duration:",o=await this.core.executeCommand(`openDialog -title="${r}" -prompt -prompt-type=number -prompt-step=0.01 -prompt-value="${n.duration}" -apply="Save" -abort="Cancel"`);o&&(console.log(n),console.log(o),n.duration=Number(o)),this.preserveContextMenu(!1),this.window.focus()}},{disabled:this.selectedNoteIndex===-1,title:"Replace",name:s.SYNTHESIZER_INPUT_OPERATION,value:N.REPLACE},{disabled:this.selectedNoteIndex===-1,title:"Add",name:s.SYNTHESIZER_INPUT_OPERATION,value:N.ADD},{disabled:this.selectedNoteIndex===-1,title:"Remove",onClick:()=>{this.track.removeNote(this.selectedNoteIndex)}},{spacer:!0},{title:"Prev",disabled:this.selectedNoteIndex<0,onClick:()=>{this.track.selectPrevNote()}},{title:"Next",disabled:this.selectedNoteIndex>=this.track.notes.length-1,onClick:()=>{this.track.selectNextNote()}}]]}},footer(){const e=this.track,a=this.model,n=e.getDuration();return{items:M([{type:d.TEXT,text:`${this.track.selectedIndex}/${this.notes.length}`},{type:d.DEFAULT,title:`Instrument: ${this.track.type}`,items:Object.entries(V()).map(([r,o])=>({type:d.RADIO,title:o,model:e,name:"type",value:r}))},{type:d.SEPARATOR},{title:`Octave: ${a[s.SYNTHESIZER_START_OCTAVE]}-${a[s.SYNTHESIZER_START_OCTAVE]+a[s.SYNTHESIZER_OCTAVE_COUNT]-1}`,items:[{type:d.DEFAULT,title:"Start Octave",items:Array(9).fill({}).map((r,o)=>({type:d.RADIO,title:String(o+1),model:a,name:s.SYNTHESIZER_START_OCTAVE,value:o+1,action(t){if(t=Number(t),t+a[s.SYNTHESIZER_OCTAVE_COUNT]>9){debugger;a[s.SYNTHESIZER_OCTAVE_COUNT]=10-t}}}))},{type:d.DEFAULT,title:"Octave Count",items:Array(10-a[s.SYNTHESIZER_START_OCTAVE]).fill({}).map((r,o)=>({type:d.RADIO,title:String(o+1),model:a,name:s.SYNTHESIZER_OCTAVE_COUNT,value:o+1}))}]},{type:d.SPACER},{type:d.TEXT,text:`Dur.: ${n}`},{type:d.TEXT,text:`BPM: ${this.bpm}`},{type:d.TEXT,text:`${this.decibelValue.toFixed(2)} db`}])}},noteNavigation(){return{model:this.model,items:[[{fill:!0,title:"Pause",onClick:()=>this.addPause()},...Object.entries(Z(!0)).map(([e,a])=>({title:`${a} Note`,name:s.SYNTHESIZER_DURATION,value:e}))],[{fill:!0,title:"Dot",name:s.SYNTHESIZER_INPUT_DOT},{fill:!0,title:"Triplet",name:s.SYNTHESIZER_INPUT_TRIPLET}]]}}},watch:{"trackPlayer.noteIndex"(e){this.track.selectedIndex=e},bpm(){var e;(e=this.trackPlayer)==null||e.stop()},masterVolume:{handler(){L.volume.value=this.decibelValue},immediate:!0},"track.type":{handler(){this.trackPlayer.createInstrument(this.track.type)},immediate:!0}},mounted(){console.log("TRACK",this.track)},unmounted(){this.trackPlayer.destroy()},methods:{async setup(){this.tone.ready||(await this.tone.start(),this.trackPlayer.createInstrument(this.track.type))},onClickReset(){this.trackPlayer.reset()},async onClickPlay(){await this.setup(),this.trackPlayer.play(this.selectedNoteIndex)},onClickPlause(){this.trackPlayer.pause()},onClickStop(){this.trackPlayer.stop()},onClickRestart(){this.trackPlayer.restart()},async onClickNote({note:e,selected:a}){await this.setup(),a&&e.name&&this.trackPlayer.instrument.triggerAttackRelease(e.name,e.time)},addPause(){this.noteInput()},noteInput(e,a){const n=new w({name:a,time:this.duration,dot:this.model[s.SYNTHESIZER_INPUT_DOT],triplet:this.model[s.SYNTHESIZER_INPUT_TRIPLET]});console.log(n.notation.toString());const r=this.track.selectedIndex;if(r>-1)switch(e){case N.ADD:return this.track.addNoteTo(r,n);case N.REPLACE:return this.track.replaceNote(r,n)}return this.track.addNote(n)},async onDownKeyboard(e){await this.setup(),this.noteInput(this.model[s.SYNTHESIZER_INPUT_OPERATION],e),this.trackPlayer.instrument.triggerAttack(e)},async onUpKeyboard(){await this.tone.awaitReady,this.trackPlayer.instrument.triggerRelease()}}},ke={key:0,class:"keyboard"},Ne={class:"panel"},Ee={key:0,class:"test"},Te={class:"sheet"};function ve(e,a,n,r,o,t){const l=p("keyboard"),u=p("navigation"),h=p("synthesizer-timeline-canvas"),y=p("wb-env-molecule-footer");return i(),c("div",{class:E(["wb-disks-extras13-synthesizer-track",t.styleClasses])},[m("div",null,[m("div",null,[t.showKeyboard?(i(),c("div",ke,[k(l,v(t.keybordData,{onDown:t.onDownKeyboard,onUp:t.onUpKeyboard}),null,16,["onDown","onUp"]),m("span",{class:E(["message",{show:t.isMaxLength}])},"Octave length is to large…",2)])):_("",!0),t.showKeyboard?(i(),W(u,R(v({key:1},t.noteNavigation)),null,16)):_("",!0)]),m("div",Ne,[t.showKeyboard?(i(),c("div",Ee)):_("",!0),k(u,R(F(t.noteDiagramControlNavigation)),null,16),m("div",Te,[m("div",null,[k(h,{clickable:"",track:r.trackPlayer.track,"onNote:click":t.onClickNote},null,8,["track","onNote:click"])])])])]),k(y,v(t.footer,{"parent-layout":o.windowsModule.contentWrapper.layout}),null,16,["parent-layout"])],2)}const Ae=S(pe,[["render",ve],["__scopeId","data-v-83e01943"]]);export{Ae as default};
