var G=Object.defineProperty;var L=(o,t,e)=>t in o?G(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var s=(o,t,e)=>L(o,typeof t!="symbol"?t+"":t,e);import{p as N}from"./DcvgOCRL.js";import{r as p,k as a,a0 as k,o as $,a1 as q,W as z,a7 as R,G as A}from"./BUU1NkbK.js";class W{constructor(t,e){s(this,"id",crypto.randomUUID());s(this,"items",[]);t&&e&&(this.items=N(t(e)))}add(t){t instanceof W&&this.items.push(...t.items)}}function Q(){const o=p(!1),t=R("core"),e=R("window");if(!t||!e)throw new Error("Core or Window not found");const f=R("window:refresh"),h=a(()=>e.id),v=a(()=>e.layout),c=a(()=>e.options.focused||!1),M=a(()=>e.parentWindow),r=p(),u=p(),x=a(()=>e.options.embed),l=p(!1),d=(n=!0)=>{l.value=n},C=(n,i={})=>{u.value=new W(n,{core:t,mainWindow:A(e),parentWindow:A(M),preserveContextMenu:d,...i})},w=n=>{var i,g,b;u.value&&(n?r.value=(i=t.modules.windows)==null?void 0:i.setActiveContextMenu(u.value):!l.value&&((g=t.modules.windows)==null?void 0:g.getActiveContextMenu())===r.value&&!x.value&&((b=t.modules.windows)==null||b.setActiveContextMenu(null)))};k(c,n=>w(n)),k(u,n=>{var i;r.value=(i=t.modules.windows)==null?void 0:i.setActiveContextMenu(n)}),$(()=>{q(()=>{o.value=!0,w(!0)})}),z(()=>{var n,i;u.value&&((n=t.modules.windows)!=null&&n.isContextMenu(r.value))&&((i=t.modules.windows)==null||i.setActiveContextMenu(null))});const m=a(()=>o.value),E=()=>{e.close()};let y;const j=n=>{e.options.title!==n&&(y=e.options.title,e.options.title=n)};let F=0;const D=n=>{F===1&&n===0?e.options.title=y:F===0&&n===1&&(y=e.options.title,e.options.title=`${e.options.title} (unsaved)`),F=n};return new H({isReady:m,id:h,parentFocused:c,parentLayout:v,core:t,window:e,setContextMenu:C,preserveContextMenu:d,contextMenu:u,currentContextMenu:r,refresh:f,close:E,setTitle:j,setTitleStatus:D})}var B=(o=>(o[o.NONE=0]="NONE",o[o.EDIT=1]="EDIT",o))(B||{});class H{constructor(t){s(this,"isReady");s(this,"id");s(this,"parentFocused");s(this,"parentLayout");s(this,"core");s(this,"window");s(this,"setContextMenu");s(this,"preserveContextMenu");s(this,"contextMenu");s(this,"currentContextMenu");s(this,"refresh");s(this,"close");s(this,"setTitle");s(this,"setTitleStatus");const{isReady:e,id:f,parentFocused:h,parentLayout:v,core:c,window:M,setContextMenu:r,preserveContextMenu:u,contextMenu:x,currentContextMenu:l,refresh:d,close:C,setTitle:w,setTitleStatus:m}=t;this.isReady=e,this.id=f,this.parentFocused=h,this.parentLayout=v,this.core=c,this.window=M,this.setContextMenu=r,this.preserveContextMenu=u,this.contextMenu=x,this.currentContextMenu=l,this.refresh=d,this.close=C,this.setTitle=w,this.setTitleStatus=m}}export{W as C,B as W,Q as u};
