var N=Object.defineProperty;var Y=(o,t,e)=>t in o?N(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var s=(o,t,e)=>Y(o,typeof t!="symbol"?t+"":t,e);import{m as $}from"./Dhinf-AH.js";import{v as q}from"./BYXSjlja.js";import{r as p,k as a,a2 as b,o as z,a3 as B,Y as D,W as R,E as k}from"./BHV1diwp.js";class W{constructor(t,e){s(this,"id",q());s(this,"items",[]);t&&e&&(this.items=$(t(e)))}add(t){t instanceof W&&this.items.push(...t.items)}}function T(){const o=p(!1),t=R("core"),e=R("window");if(!t||!e)throw new Error("Core or Window not found");const v=R("window:refresh"),f=a(()=>e.id),h=a(()=>e.layout),c=a(()=>e.options.focused||!1),M=a(()=>e.parentWindow),r=p(),u=p(),x=a(()=>e.options.embed),l=p(!1),d=(n=!0)=>{l.value=n},m=(n,i={})=>{u.value=new W(n,{core:t,mainWindow:k(e),parentWindow:k(M),preserveContextMenu:d,...i})},w=n=>{var i,g,E;u.value&&(n?r.value=(i=t.modules.windows)==null?void 0:i.setActiveContextMenu(u.value):!l.value&&((g=t.modules.windows)==null?void 0:g.getActiveContextMenu())===r.value&&!x.value&&((E=t.modules.windows)==null||E.setActiveContextMenu(null)))};b(c,n=>w(n)),b(u,n=>{var i;r.value=(i=t.modules.windows)==null?void 0:i.setActiveContextMenu(n)}),z(()=>{B(()=>{o.value=!0,w(!0)})}),D(()=>{var n,i;u.value&&((n=t.modules.windows)!=null&&n.isContextMenu(r.value))&&((i=t.modules.windows)==null||i.setActiveContextMenu(null))});const C=a(()=>o.value),A=()=>{e.close()};let y;const j=n=>{e.options.title!==n&&(y=e.options.title,e.options.title=n)};let F=0;const L=n=>{F===1&&n===0?e.options.title=y:F===0&&n===1&&(y=e.options.title,e.options.title=`${e.options.title} (unsaved)`),F=n};return new H({isReady:C,id:f,parentFocused:c,parentLayout:h,core:t,window:e,setContextMenu:m,preserveContextMenu:d,contextMenu:u,currentContextMenu:r,refresh:v,close:A,setTitle:j,setTitleStatus:L})}var G=(o=>(o[o.NONE=0]="NONE",o[o.EDIT=1]="EDIT",o))(G||{});class H{constructor(t){s(this,"isReady");s(this,"id");s(this,"parentFocused");s(this,"parentLayout");s(this,"core");s(this,"window");s(this,"setContextMenu");s(this,"preserveContextMenu");s(this,"contextMenu");s(this,"currentContextMenu");s(this,"refresh");s(this,"close");s(this,"setTitle");s(this,"setTitleStatus");const{isReady:e,id:v,parentFocused:f,parentLayout:h,core:c,window:M,setContextMenu:r,preserveContextMenu:u,contextMenu:x,currentContextMenu:l,refresh:d,close:m,setTitle:w,setTitleStatus:C}=t;this.isReady=e,this.id=v,this.parentFocused=f,this.parentLayout=h,this.core=c,this.window=M,this.setContextMenu=r,this.preserveContextMenu=u,this.contextMenu=x,this.currentContextMenu=l,this.refresh=d,this.close=m,this.setTitle=w,this.setTitleStatus=C}}export{W as C,G as W,T as u};
