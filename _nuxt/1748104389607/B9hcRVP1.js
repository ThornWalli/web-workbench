var q=Object.defineProperty;var b=(r,e,a)=>e in r?q(r,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[e]=a;var u=(r,e,a)=>b(r,typeof e!="symbol"?e+"":e,a);import{S as D,P as k,b as P,c as K,d as B,e as Y,F as j,D as C,A as H,V as L,a as M,n as Z,f as z,N as U}from"./BtMqbO0Q.js";import{D as $}from"./RfKXynV2.js";import{T as x,a as F}from"./D7vRPbLd.js";import{I as m,C as p,r as _,K as G,a as V,b as X}from"./DeMeSnuU.js";import{M as R,d as J,r as W,v,x as Q,A as ee,_ as te}from"./BHV1diwp.js";import{c as se}from"./Cn-aGPUZ.js";import{A as ne}from"./Do8_-Ux3.js";import{d as ae,a as n,b as w}from"./Dhinf-AH.js";import{U as ie}from"./BlnwQcI7.js";import{S as f}from"./B5gsEXs2.js";const oe={[m.AM]:H,[m.DUO]:C,[m.FM]:j,[m.MEMBRANE]:Y,[m.METAL]:B,[m.MONO]:K,[m.PLUCK]:P,[m.POLY]:k,[m.SYNTH]:D};function re(r=m.SYNTH){return oe[r]}class Ae{constructor(e,a){u(this,"track");u(this,"playing",!1);u(this,"currentSequence");u(this,"autoplay");u(this,"instrument");u(this,"instruments",[]);u(this,"sequenceNoteIndex",{});u(this,"instrumentIndex",-1);const{autoplay:s}=a||{};if(!(e instanceof x))throw new Error("TrackPlayer requires a Track");this.track=e,this.autoplay=s!==void 0?s:!0}createInstrument(){var e;(e=this.instrument)==null||e.dispose(),this.instrument=O(this.track.type)}refresh(){const e=this.track.notes;return this.createSequence(e,()=>{console.log("complete"),this.clearSequence(),this.playing=!1}),e}play(){if(!this.track.type)throw new Error("TrackPlayer requires an instrument");if(this.refresh(),!this.currentSequence)throw new Error("TrackPlayer requires a sequence");return this.autoplay&&(this.currentSequence.start(0),this.playing=!0),this.currentSequence}pause(){this.instruments.forEach(e=>e.context.transport.pause()),this.playing=!1}stop(){this.clearSequence(),this.playing=!1}restart(){this.stop(),this.play()}reset(){this.clearSequence(),this.stop(),this.track.notes=[]}destroy(){var e;(e=this.instrument)==null||e.dispose(),this.instruments.forEach(a=>a.dispose()),this.clearSequence()}triggerAttack(e){this.instrumentIndex++,this.getInstrument().triggerAttack(e)}triggerRelease(){this.getInstrument().triggerRelease(),this.instrumentIndex--}triggerAttackRelease(e){this.instrumentIndex++,console.log("triggerAttackRelease",this.instrumentIndex,e.getName(),e.getTime(),e.delay,(e.delay+e.toSeconds())*1e3),window.setTimeout(()=>{console.log("fertig"),this.instrumentIndex--},(e.delay+e.toSeconds())*1e3);const a=e.getName(),s=e.getTime();if(!a)throw new Error("Note name is required");if(!s)throw new Error("Note time is required");this.getInstrument().triggerAttackRelease(a,s,e.delay)}getInstrument(){return this.instrumentIndex>this.instruments.length-1&&this.instruments.push(O(this.track.type)),this.instruments[this.instrumentIndex]}createSequence(e,a){if(!this.currentSequence)this.currentSequence=R(new ce(e,(s,i,c,h)=>{console.log(s),this.triggerAttackRelease(s),this.sequenceNoteIndex={...this.sequenceNoteIndex,[Number(i)]:h[c].index},c===h.length-1&&Reflect.deleteProperty(this.sequenceNoteIndex,i)},a!==void 0?a:void 0));else throw new Error("TrackPlayer already has a sequence")}clearSequence(){var e;(e=this.currentSequence)==null||e.dispose(),this.currentSequence=void 0}}class ce{constructor(e,a,s){u(this,"startTime",0);u(this,"sequenceMap",new Map);u(this,"onTick");u(this,"onComplete");u(this,"notes");this.onTick=a,this.onComplete=s,this.notes=e}async start(e=0){var c;const a=M;a.stop(),a.seconds=0,a.start(),this.startTime=Z();const s=this.sequenceMap,i=Promise.all(Object.entries(le(this.notes)).map(([,h])=>{const y=h.map((l,t)=>{const o=`${t}_${l.getTime()}`,{notes:d,part:S,complete:E}=s.get(o)||(()=>{const T=[];let g=0;const I=new $,N=new z((...A)=>{this.onTick(new U({delay:A[0],note:A[1],time:l.getTime()}),t,g,T),g++,g>N.length-1&&I.resolve()},[]);return{notes:T,part:N,complete:I.promise}})();return s.set(o,{notes:d,part:S,complete:E}),S.add(l.delay,l.getName()),d.push(l),{notes:d,part:S,complete:E}});return Promise.all(y.map(({complete:l})=>l))}));return Array.from(s.values()).forEach(({part:h})=>{h.start(e)}),await i,(c=this.onComplete)==null||c.call(this),i}pause(){Array.from(this.sequenceMap.values()).forEach(({part:e})=>{e.pause()})}cancel(){Array.from(this.sequenceMap.values()).forEach(({part:e})=>{e.cancel()})}stop(){Array.from(this.sequenceMap.values()).forEach(({part:e})=>{e.stop()})}dispose(){Array.from(this.sequenceMap.values()).forEach(({part:e})=>{e.dispose()})}}function O(r){const e=re(r),a=new L(-100).toDestination(),s=new e().connect(a).toDestination();return R(s)}function le(r){return r.reduce((e,a)=>(e[a.delay]=e[a.delay]||[],e[a.delay].push(a),e),{})}const ue={class:"wb-disks-debug-synthesizer-info"},me=J({__name:"Info",setup(r){const e=W(["# Synthesizer","Simple synthesizer with notes view and midi api support.","",`Version: **0.1**  
Created by **Thorn-Welf Walli**`,"","Thanks to:","- [Tone.js](https://tonejs.github.io/)","- [WEBMIDI.js](https://webmidijs.org/)"].join(`
`));return(a,s)=>(Q(),v("div",ue,[ee(ne,{content:e.value},null,8,["content"])]))}}),he=te(me,[["__scopeId","data-v-0dc90f0c"]]),_e=ae(({core:r,mainWindow:e,parentWindow:a,preserveContextMenu:s,model:i,trackModel:c})=>{function h(){return(a||e).close()}const y=i[p.SYNTHESIZER_PROJECT],l=c&&c[p.SYNTHESIZER_TRACK];return[new n({title:"Synthesizer",items:[new n({hotKey:{alt:!0,code:"KeyI",title:"I"},title:"Info",async action(){if(!r.modules.windows)throw new Error("Windows module not found");s(!0),await r.modules.windows.addWindow({component:he,componentData:{model:i},options:{title:"Info",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}},{group:"extras13Synthesizer"}).awaitClose(),s(!1),e.focus()}}),new f,new n({title:"Debug",items:[new n({title:"Notes",async action(){var t;if((t=i.actions)!=null&&t.openDebugNotes){s(!0);const{window:o}=i.actions.openDebugNotes();await o.awaitClose(),s(!1),e.focus()}}}),new n({title:"Midi",async action(){var t;if((t=i.actions)!=null&&t.openDebugMidi){s(!0);const{window:o}=i.actions.openDebugMidi();await o.awaitClose(),s(!1),e.focus()}}}),new n({title:"Timeline",async action(){var t;if((t=i.actions)!=null&&t.openDebugTimeline){s(!0);const{window:o}=i.actions.openDebugTimeline();await o.awaitClose(),s(!1),e.focus()}}})]}),new f,new n({title:"Close",action:h})]}),...c?[]:[{title:"Project",items:[new n({title:"New…",action:async()=>{i.actions&&(s(!0),await i.actions.newProject(),s(!1),e.focus())}}),new n({title:"Edit Name…",action:async()=>{s(!0);const t=await _(r,"Project renaming:",y.name);t&&(y.name=t),s(!1),e.focus()}}),new n({title:"Open…",hotKey:{alt:!0,code:"KeyO",title:"O"},action:async()=>{var t;await((t=i.actions)==null?void 0:t.openProject())}}),new n({title:"Save…",hotKey:{alt:!0,code:"KeyS",title:"S"},action:async()=>{var t;return await((t=i.actions)==null?void 0:t.saveProject())}}),new f,new ie({title:"Import… (JSON)",hotKey:{alt:!0,shift:!0,code:"KeyI",title:"I"},async action(t){var o;return await((o=i.actions)==null?void 0:o.importProject(t[0]))}}),new n({title:"Export (JSON)",action:async()=>{var t;return await((t=i.actions)==null?void 0:t.exportProject())}})]},new n({title:"Track",items:[new n({title:"New…",action:async()=>{i.actions&&(s(!0),await i.actions.newTrack(),s(!1),e.focus())}}),new f,new n({title:"Clear",async action(){i.actions&&(s(!0),await i.actions.clearTracks(),s(!1),e.focus())}})]})],...c&&[new n({title:"Track Options",items:[new n({type:w.CHECKBOX,title:"Show Note Labels",name:p.SYNTHESIZER_TRACK_SHOW_NOTE_LABELS,model:c}),new n({type:w.CHECKBOX,title:"Show Keyboard",name:p.SYNTHESIZER_TRACK_SHOW_KEYBOARD,model:c}),new n({title:"Keyboard Size",items:Object.entries(G).map(([t,o])=>new n({type:w.RADIO,title:o,model:c,name:p.SYNTHESIZER_TRACK_KEYBOARD_SIZE,value:t}))}),new n({title:"Keyboard Alignment",items:Object.entries(V).map(([t,o])=>new n({type:w.RADIO,title:o,model:c,name:p.SYNTHESIZER_TRACK_KEYBOARD_ALIGN,value:t}))}),new f,new n({title:"Edit Name…",action:async()=>{s(!0);const t=await _(r,"Track renaming:",l.name);t&&(l.name=t,e.options.title=l.name),s(!1),e.focus()}}),new n({title:"Note Count",items:Object.entries(X).map(([t,o])=>new n({type:w.RADIO,title:`${t} (${o})`,model:l,name:"noteCount",value:o}))}),new n({title:"Base Note",items:Object.entries(F()).map(([t,o])=>new n({type:w.RADIO,title:t,model:l,name:"baseNote",value:o}))}),new f,new n({title:"Beat Count",items:Array(9).fill({}).map((t,o)=>new n({type:w.RADIO,title:String(o+1),model:l,name:"beatCount",value:o+1}))})]})]||[],new n({title:"Options",items:[new n({title:`BPM (${i[p.SYNTHESIZER_BPM]})`,items:[30,60,120,240,480].map(t=>new n({type:w.RADIO,title:String(t),model:i,name:p.SYNTHESIZER_BPM,value:t}))})]}),...se({core:r})].filter(Boolean)});export{Ae as T,_e as c};
