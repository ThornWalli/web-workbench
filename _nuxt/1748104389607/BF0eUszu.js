import{a as h,M as k}from"./BtMqbO0Q.js";import{C as f}from"./BJmh0rUk.js";import{C as c}from"./DeMeSnuU.js";import{T as v,g as _}from"./D7vRPbLd.js";import{T as y,c as C}from"./B9hcRVP1.js";import{N as T,u as g}from"./RfKXynV2.js";import{T as b}from"./zsr9g00h.js";import{u as N}from"./CuqlnsaG.js";import{_ as x,g as l,v as n,x as o,A as p,y as u,Q as E,ab as w,G as $,a0 as M,a1 as P,N as R,D as V,ag as S,a2 as j}from"./BHV1diwp.js";import"./D4lI5vpz.js";import"./Dhinf-AH.js";import"./BYXSjlja.js";import"./CEMoWgfm.js";import"./CaAbksje.js";import"./9V19AFUE.js";import"./Cn-aGPUZ.js";import"./CxKYomUj.js";import"./B5gsEXs2.js";import"./Cw6MfX_O.js";import"./BGIFtisS.js";import"./RAasLaaH.js";import"./DdQrQ7-5.js";import"./6C4StZv5.js";import"./CSlkdJUE.js";import"./Do8_-Ux3.js";import"./BlnwQcI7.js";import"./BG0OyHeb.js";import"./CNkvSXuu.js";import"./CzBXAPyu.js";const D={components:{Navigation:T,SynthesizerTimelineCanvas:b},props:{model:{type:Object,required:!0}},emits:["refresh"],async setup(t){const e=S(t,"model"),s=N();return j(e,()=>{s.setContextMenu(C,{model:e.value,preserveContextMenu:s.preserveContextMenu})},{immediate:!0,deep:!0}),{...s,...await g()}},data:function(){return{toneDestination:null,tracksEdit:{}}},computed:{timelineRefreshKey(){return`timeline-${this.bpm}`},project(){return this.model[c.SYNTHESIZER_PROJECT]},tracks:{get(){return this.project.tracks},set(t){this.project.tracks=t}},bpm(){return Number(this.model[c.SYNTHESIZER_BPM])},controlsNavigation(){return{model:this.model,items:[[{text:`Project: ${this.project.name} | Tracks: ${this.tracks.length}`}]]}},masterVolume(){return this.core.config.observable[f.SCREEN_CONFIG].soundVolume},decibelValue(){return _(this.masterVolume)}},watch:{masterVolume:{handler(){k.volume.value=this.decibelValue},immediate:!0},tracks(){this.$nextTick(()=>{this.$emit("refresh")})},bpm:{handler(t){const e=this.tone.transport;e.stop(),e.bpm.value=120,e.seconds=0,e.bpm.value=t,e.start()}}},mounted(){this.$nextTick(()=>{this.$emit("refresh")})},unmounted(){this.model.actions.closeTracks()},methods:{async onClickPlay(){await this.tone.start(),this.players=this.tracks.map(s=>{const r=new y(s,{autoplay:!1});return r.createInstrument("Synth"),r});const t=h;t.stop(),t.seconds=0,t.start(),this.players.map(s=>s.play()).map(s=>s.start(0))},getControls(t){const e=t.getDuration();return{items:[{text:t.name},{spacer:!0},{text:` ${e}`},{label:"Edit",onClick:async()=>{console.log("Edit track",t),await this.tone.start(),this.editTrack(new v(t),{toneDestination:this.toneDestination})}},{label:"Remove",onClick:async()=>{this.preserveContextMenu(!0),await this.model.actions.removeTrack(t),this.preserveContextMenu(!1),this.$emit("refresh")}}]}},async editTrack(t){this.tracksEdit[t.id]=!0;const{close:e}=this.model.actions.editTrack(t),s=await e;this.tracks=this.tracks.map(r=>r.id===s.id?s:r),this.tracksEdit[t.id]=!1,this.$nextTick(()=>{this.$emit("refresh")})}}},I={class:"wb-disks-extras13-synthesizer-project"},z={class:"tracks"},B={key:0,class:"no-tracks"},F={class:"sheet"};function O(t,e,s,r,G,a){const m=l("navigation"),d=l("synthesizer-timeline-canvas");return o(),n("div",I,[p(m,E(w(a.controlsNavigation)),null,16),u("div",z,[a.tracks.length<1?(o(),n("div",B,"No tracks availableâ€¦")):$("",!0),(o(!0),n(M,null,P(a.tracks,i=>(o(),n("div",{key:i.id,class:"track"},[p(m,R({ref_for:!0},a.getControls(i)),null,16),u("div",F,[(o(),V(d,{key:a.timelineRefreshKey,track:i,static:t.tracksEdit[i.id],onRefresh:e[0]||(e[0]=q=>t.$emit("refresh"))},null,8,["track","static"]))])]))),128))])])}const _t=x(D,[["render",O],["__scopeId","data-v-5a4b88fd"]]);export{_t as default};
