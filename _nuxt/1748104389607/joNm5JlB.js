const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CDdIG0_q.js","./BGIFtisS.js","./DXnSAPcy.js","./wjpmATP-.js","./DSfxGD0e.js","./9V19AFUE.js","./BHV1diwp.js","./Dhinf-AH.js","./BYXSjlja.js","./CEMoWgfm.js","./CXbNF4JJ.css","./B5gsEXs2.js","./eltv5oFB.js","./C3zvzGZe.css","./B3mcEltb.js","./DN3eHOnZ.js","./D4lI5vpz.js","./Ce6njBYG.js","./6C4StZv5.js","./DdQrQ7-5.js","./CSlkdJUE.js","./nufkX4jA.js","./RAasLaaH.js","./CuqlnsaG.js","./DxlUA0M_.css","./B-R150Ne.js","./YBsQ7fUL.js","./DG6QdPnO.js","./Cdv5LwuB.js","./CGDfseBP.js","./WL2z-xAH.js","./C6BPC0dl.css","./Cw6MfX_O.js","./Do8_-Ux3.js","./c1FWBGi4.css","./CxKYomUj.js","./DwXabkis.js","./BVsX1iIx.js","./CVMiNqhH.js","./C6SzTwG0.js","./CJLX7oOC.js","./WGsTKhbz.js","./BbB_XbY8.js","./CaAbksje.js","./DvFw39FR.js","./Cq5IZgAT.css","./BLSAOoF6.js","./DkCGi0kC.css","./DMjBHk4w.js","./H0f0oqeM.js","./uFB7pO-1.js","./C1HOdXVC.css","./dNcQboSW.css","./CpzMNbG5.js","./iKMg5t-_.css","./C0ysoPKq.css","./CshrRwMP.js","./Cpj98o6Y.js","./tGj6k1aL.js","./9cQIbzVl.js","./BlnwQcI7.js","./Dl3IKoTu.js","./xGJLO1N2.css","./Deg3GZZB.js","./D4zXtHPg.js","./DFgZNMrK.js","./CPO2zzvS.css","./uQ6c-LRa.css","./BqjXW8nl.js","./Dma58osz.css","./COjWThCl.js","./C68VET03.js","./Btge7-2g.css","./Cr3TGnXF.css","./BsCJS5O6.js","./CINvwvLw.js","./DbNc_bDN.js","./DWpE5pJp.js"])))=>i.map(i=>d[i]);
var gt=Object.defineProperty;var bt=(n,t,e)=>t in n?gt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var h=(n,t,e)=>bt(n,typeof t!="symbol"?t+"":t,e);import{J as V,M as j,I as R}from"./BHV1diwp.js";import{i as m,o as J,p as yt}from"./BGIFtisS.js";import{c as Z,I as v,l as M,S as I,h as vt}from"./Dhinf-AH.js";import{E as H,b as st,s as q}from"./Cw6MfX_O.js";import{v as Tt}from"./DwXabkis.js";import{c as A}from"./CVMiNqhH.js";import{d as C}from"./B3mcEltb.js";import{K as W}from"./DXnSAPcy.js";import{o as Et,S as ot}from"./6C4StZv5.js";import{a as wt}from"./WL2z-xAH.js";import{c as rt,f as It}from"./CSlkdJUE.js";import{i as At}from"./Ce6njBYG.js";import{t as Dt}from"./C6SzTwG0.js";import{v as Nt}from"./BYXSjlja.js";import{S as ht}from"./RAasLaaH.js";import{t as Pt}from"./WGsTKhbz.js";import{C as N}from"./CxKYomUj.js";import{f as xt}from"./CaAbksje.js";import{f as St}from"./DvFw39FR.js";function _t(n,t){return Et(function(e,s){var r=t??{},i=r.leading,a=i===void 0?!0:i,l=r.trailing,c=l===void 0?!1:l,o=!1,d=null,p=null,u=!1,g=function(){p==null||p.unsubscribe(),p=null,c&&(D(),u&&s.complete())},E=function(){p=null,u&&s.complete()},S=function(f){return p=At(n(f)).subscribe(rt(s,g,E))},D=function(){if(o){o=!1;var f=d;d=null,s.next(f),!u&&S(f)}};e.subscribe(rt(s,function(f){o=!0,d=f,!(p&&!p.closed)&&(a?D():S(f))},function(){u=!0,!(c&&o&&p&&!p.closed)&&s.complete()}))})}function Ct(n,t,e){t===void 0&&(t=wt);var s=Dt(n,t);return _t(function(){return s},e)}class w{constructor(t=0,e=0,s=0,r=255){h(this,"_red",0);h(this,"_green",0);h(this,"_blue",0);h(this,"_alpha",255);this.set(t,e,s,r)}set(t=0,e=0,s=0,r=255){Array.isArray(t)&&(r=t[3],s=t[2],e=t[1],t=t[0]),this.red=Number(t),this.green=e,this.blue=s,this.alpha=r===void 0?255:r}get r(){return this._red}get red(){return this._red}set red(t){this._red=A(t,0,255)}get g(){return this._green}get green(){return this._green}set green(t){this._green=A(t,0,255)}get blue(){return this._blue}get b(){return this._blue}set blue(t){this._blue=A(t,0,255)}get a(){return this._alpha}get alpha(){return this._alpha}set alpha(t){this._alpha=A(t,0,255)}get sum(){return this._red+this._blue+this._green+this._alpha}toRGB(){return`rgb(${this._red},${this._green},${this._blue})`}toRGBA(){return`rgba(${this._red},${this._green},${this._blue},${this._alpha/255})`}toJSON(){return{red:this.red,green:this.green,blue:this.blue,alpha:this.alpha}}is(t){return this.red===t.red&&this.blue===t.blue&&this.green===t.green&&this.alpha===t.alpha}invert(){return this._red=255-this._red,this._green=255-this._green,this._blue=255-this._blue,this}add(t){this.red=A(this.red+t.red,0,255),this.green=A(this.green+t.green,0,255),this.blue=A(this.blue+t.blue,0,255)}subtract(t){this.red=A(this.red-t.red,0,255),this.green=A(this.green-t.green,0,255),this.blue=A(this.blue-t.blue,0,255)}multiply(t){this.red=A(this.red*t.red,0,255),this.green=A(this.green*t.green,0,255),this.blue=A(this.blue*t.blue,0,255)}divide(t){this.red=A(this.red/t.red,0,255),this.green=A(this.green/t.green,0,255),this.blue=A(this.blue/t.blue,0,255)}}class Q{constructor(t,e){h(this,"dimension",m(0,0));this.dimension=m(t,e)}get width(){return this.dimension.x}get height(){return this.dimension.y}get size(){return this.dimension}toPoint(){return this.dimension}}class O{constructor(t){h(this,"app");h(this,"bitmapData");h(this,"renderActions");h(this,"passiveRenderActions");h(this,"stacks",[]);h(this,"renderImageData");h(this,"renderWaitDisplays");h(this,"renderWait");h(this,"animationFrame",-1);this.app=t;const e=t.options.size;this.bitmapData=new Q(e.width,e.height),this.renderActions=[],this.passiveRenderActions=[],this.clearStack()}static invertImageData(t){let e=0;for(let s=0;s<t.width;s++)for(let r=0;r<t.height;r++)e=(s+r*t.width)*4,t.data[Number(e)]=255-t.data[Number(e)],t.data[e+1]=255-t.data[e+1],t.data[e+2]=255-t.data[e+2]}static createImageData(t,e,s){let r;return s?r=new window.Uint8ClampedArray(s):r=new window.Uint8ClampedArray(4*t*e),new window.ImageData(r,t,e)}static resizeImageData(t,e=1){const s=t.data,r=t.width,i=t.height,a=r*e,l=i*e,c=Array(a*l*4),o=m(Number((r<<16)/a)+1,Number((i<<16)/l)+1);let d,p;for(let u=0;u<l;u++)for(let g=0;g<a;g++)d=g*o.x>>16,p=u*o.y>>16,tt((p*r+d)*4,s,(u*a+g)*4,c);return O.createImageData(a,l,c)}static cropImageData(t,e,s,r,i){const a=t.data,l=Array(r*i*4);for(let c=0;c<r;c++)for(let o=0;o<i;o++){const d=(s*t.width+e)*4+(o*t.width+c)*4;tt(d,a,(o*r+c)*4,l)}return O.createImageData(r,i,l)}getActiveContext(){var t;return(t=this.app.display)==null?void 0:t.context}getDisplayContexts(){return this.app.displays.map(t=>t.context)}setSize(t,e){this.bitmapData=new Q(t,e),this.clearStack(),this.render(),this.app.refresh()}loadImage(t){const e=this.getImageDataFromImage(t);this.bitmapData=new Q(e.width,e.height),this.clearStack(),this.stacks.push(e),this.render(),this.app.refresh()}getImageDataFromImage(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");if(!s)throw new Error("Failed to get canvas context");s.drawImage(t,0,0);const r=O.createImageData(t.width,t.height),{data:i}=s.getImageData(0,0,e.width,e.height);for(let a=0;a<r.data.length;a++)r.data[Number(a)]=i[a];return r}getColorFromPixel(t,e,s=!1){const r=s?this.renderImageData:this.stacks[this.stacks.length-1||0];if(!r)throw new Error("ImageData not found");const i=r.data,a=e*(r.width*4)+t*4;return new w(i[Number(a)],i[a+1],i[a+2],i[a+3])}getPixel(t,e,s=!1){const r=s?this.renderImageData:this.stacks[this.stacks.length-1||0];if(!r)throw new Error("ImageData not found");const i=r.data,a=e*(r.width*4)+t*4;return i[Number(a)]+i[a+1]+i[a+2]+i[a+3]}setPixel(t,e,s){if(!this.renderImageData)throw new Error("RenderImageData not found");s=s||this.app.colorSelect.primaryColor;const r=(t+e*this.renderImageData.width)*4;this.renderImageData.data[r+0]=s.red,this.renderImageData.data[r+1]=s.green,this.renderImageData.data[r+2]=s.blue,this.renderImageData.data[r+3]=s.alpha>=0?s.alpha:255}putImageData(t,e,s){if(!this.renderImageData)throw new Error("RenderImageData not found");let r,i;for(let a=0;a<t.width;a++)for(let l=0;l<t.height;l++)r=(l*t.width+a)*4,i=((s+l)*this.renderImageData.width+(e+a))*4,tt(r,t.data,i,this.renderImageData.data)}fillPixels(t,e,s,r,i){if(!this.renderImageData)throw new Error("RenderImageData not found");for(let a=e;a<Math.min(e+r,this.renderImageData.width);a++)for(let l=s;l<Math.min(s+i,this.renderImageData.height);l++)this.setPixel(a,l,t)}addRenderAction(t){this.renderActions.push(t)}addPassiveRenderAction(t){this.passiveRenderActions.push(t)}cleanPassiveRenderActions(){this.passiveRenderActions=[]}getTmpStack(){return O.createImageData(this.stacks[this.stacks.length-1].width,this.stacks[this.stacks.length-1].height,this.stacks[this.stacks.length-1].data)}render(){window.clearTimeout(this.renderWait),this.renderWait=window.setTimeout(()=>{this.renderImageData=this.getTmpStack(),et(this.renderActions),et(this.passiveRenderActions,!0),window.cancelAnimationFrame(this.animationFrame),this.animationFrame=window.requestAnimationFrame(()=>{this.renderDisplays(!0)})},1e3/60/2),window.clearTimeout(this.renderWaitDisplays),this.renderWaitDisplays=window.setTimeout(()=>{this.renderDisplays()},300)}get size(){var t,e;return m(((t=this.renderImageData)==null?void 0:t.width)||0,((e=this.renderImageData)==null?void 0:e.height)||0)}get width(){var t;return((t=this.renderImageData)==null?void 0:t.width)||0}get height(){var t;return((t=this.renderImageData)==null?void 0:t.height)||0}clearStack(){var t,e;this.renderImageData=O.createImageData((t=this.bitmapData)==null?void 0:t.width,(e=this.bitmapData)==null?void 0:e.height),this.stacks=[this.renderImageData],this.render()}saveStack(){if(!this.renderActions)throw new Error("RenderActions not found");this.renderImageData=this.getTmpStack(),et(this.renderActions,!0),this.stacks.push(this.renderImageData),this.render()}revertStack(){this.stacks.length>1&&(this.renderImageData=this.stacks.pop(),this.render())}toBlob(){return new Promise(t=>{if(!this.renderImageData)throw new Error("RenderImageData not found");it(this.renderImageData).toBlob(t)})}toBase64(){return new Promise(t=>{if(!this.renderImageData)throw new Error("RenderImageData not found");t(it(this.renderImageData).toDataURL())})}renderDisplays(t=!1){if(!this.renderImageData)throw new Error("RenderImageData not found");const e=this.renderImageData;t?this.app.display&&e&&this.app.display.setImageData(e):this.app.displays.forEach(s=>{s.setImageData(e)})}}function tt(n,t,e,s){s[Number(e)]=t[Number(n)],s[e+1]=t[n+1],s[e+2]=t[n+2],s[e+3]=t[n+3]}function it(n){var e;const t=document.createElement("canvas");return t.width=n.width,t.height=n.height,(e=t.getContext("2d"))==null||e.putImageData(n,0,0),t}function et(n,t=!1){if(t){let e;for(;n.length>0;)e=n.shift(),e&&e()}else n.forEach(e=>{e()})}class Ot{constructor(t){h(this,"app");h(this,"subscription",new ot);h(this,"holdCrtl",!1);h(this,"holdAlt",!1);this.app=t}register(){this.subscription.add(C.keyDown.pipe(Ct(200)).subscribe(this.onKeyDown)),this.subscription.add(this.subscription.add(C.keyUp.subscribe(this.onKeyUp)))}unregister(){this.subscription.unsubscribe()}registerDisplay(t){console.warn("registerDisplay not implemented",t)}unregisterDisplay(t){console.warn("unregisterDisplay not implemented",t)}onKeyUp(t){switch(t.key){case W.CONTROL:t.preventDefault(),this.holdCrtl=!1;break;case W.ALT:t.preventDefault(),this.holdAlt=!1;break}}onKeyDown(t){if(this.app.display){let e=1;switch(this.holdAlt&&(e*=10),t.key){case W.CONTROL:t.preventDefault(),this.holdCrtl=!0;break;case W.ALT:t.preventDefault(),this.holdAlt=!0;break;case W.ARROW_LEFT:t.preventDefault(),this.app.display.offset.x-=e;break;case W.ARROW_UP:t.preventDefault(),this.app.display.offset.y-=e;break;case W.ARROW_RIGHT:t.preventDefault(),this.app.display.offset.x+=e;break;case W.ARROW_DOWN:t.preventDefault(),this.app.display.offset.y+=e;break}const s=this.app.display;this.app.display.offset=m(()=>A(s.offset,-s.zoomBounds.min,s.canvasLayout.naturalSize-s.zoomBounds.max)),this.app.display.renderImageData()}}}class Rt{constructor({position:t,origin:e,app:s,x:r,y:i,originX:a,originY:l,leftClick:c,rightClick:o,holdAlt:d,holdCtrl:p}){h(this,"position");h(this,"origin");h(this,"app");h(this,"x");h(this,"y");h(this,"originX");h(this,"originY");h(this,"leftClick");h(this,"rightClick");h(this,"holdAlt");h(this,"holdCtrl");this.position=t,this.origin=e,this.app=s,this.x=r,this.y=i,this.originX=a,this.originY=l,this.leftClick=c,this.rightClick=o,this.holdAlt=d,this.holdCtrl=p}}const Bt=20;class Lt{constructor(t){h(this,"app");h(this,"pressed");h(this,"pointerEvent");h(this,"subscriptions",[]);h(this,"displaySubscriptions",new Map);h(this,"runSubscriptions",[]);this.app=t,this.pressed=!1}registerDisplay(t){this.displaySubscriptions.set(t,[C.get("pointerdown",t.canvas).subscribe(this.onPointerDown(t)),C.get("pointerup",t.canvas).subscribe(this.onPointerEnter(t))])}unregisterDisplay(t){var e;this.displaySubscriptions.has(t)&&((e=this.displaySubscriptions.get(t))==null||e.forEach(s=>s==null?void 0:s.unsubscribe()),this.displaySubscriptions.delete(t))}register(){}unregister(){}onContextMenu(t){return e=>{this.runActionResult(this.contextMenu(e,t),e,t)}}onPointerEnter(t){return e=>{if(e.target instanceof HTMLElement){this.app.setDisplay(t);const s=C.get("pointerleave",e.target).subscribe(r=>{s.unsubscribe(),this.onPointerLeave(t)(r)})}}}onPointerLeave(t){return e=>{}}onPointerDown(t){return e=>{var s;this.app.setDisplay(t),this.pointerEvent=this.getPointerEvent(e,t),this.pressed=!0,this.runActionResult(this.pointerDown(e,t),e,t),(s=this.app.display)==null||s.renderCanvas()}}onPointerLeaveAndUp(t){return e=>{ct(),this.runActionResult(this.pointerLeaveAndUp(e,t),e,t)}}onPointerMove(t){return e=>{this.runActionResult(this.pointerMove(e,t),e,t)}}runActionResult(t,e,s){var r,i,a;t&&(t.events&&e.target instanceof HTMLElement&&(this.runSubscriptions=[C.get("contextmenu",e.target).subscribe(this.onContextMenu(s)),C.get("pointerleave",e.target).subscribe(this.onPointerLeaveAndUp(s)),C.get("pointermove",e.target).subscribe(this.onPointerMove(s)),C.get("pointerup",e.target).subscribe(this.onPointerLeaveAndUp(s))]),t.save&&((r=this.app.canvas)==null||r.saveStack()),t.revert&&((i=this.app.canvas)==null||i.revertStack()),t.render&&((a=this.app.canvas)==null||a.render()))}unsubscribeRun(){this.runSubscriptions.forEach(t=>t.unsubscribe()),this.runSubscriptions=[]}getPointerEvent(t,e){const s=e.canvasLayout;let r=m(t.clientX-e.bounds.min.x,t.clientY-e.bounds.min.y),i=m(()=>r-s.position);this.app.globalBounds&&(r=m(()=>r-this.app.globalBounds.min),i=m(()=>i-this.app.globalBounds.min));const a=m(()=>Math.round(i)),l=m(()=>Math.round(i/e.zoomFactor+e.zoomBounds.min));return new Rt({position:l,origin:a,app:this.app,x:l.x,y:l.y,originX:a.x,originY:a.y,leftClick:t.button!==2,rightClick:t.button===2,holdAlt:C.altActive,holdCtrl:C.cmdActive})}pointerDown(t,e){const s={events:!0};if(!this.app.tool||!this.app.canvas)throw new Error("Tool or Canvas not found");const r=this.app.tool,i=this.app.canvas;if(r.pointerDownHold)Ut(()=>{this.runActionResult(r.onPointerDown(this.pointerEvent,{mouse:this}),t,e),i.render()});else return Object.assign(s,r.onPointerDown(this.pointerEvent,{mouse:this}));return s}pointerLeaveAndUp(t,e){if(!this.app.tool)throw new Error("Tool not found");return this.pressed=!1,this.pointerEvent=void 0,this.unsubscribeRun(),this.app.tool.onPointerUp(this.getPointerEvent(t,e),{mouse:this})}pointerMove(t,e){if(!this.app.tool)throw new Error("Tool not found");return this.pointerEvent=this.getPointerEvent(t,e),this.app.tool.onPointerMove(this.pointerEvent,{mouse:this})}contextMenu(t,e){var s;if(t.preventDefault(),t.stopPropagation(),!this.app.tool)throw new Error("Tool not found");return(s=this.app.tool)==null?void 0:s.onContextMenu(t,{mouse:this,display:e})}}let lt;function ct(){window.clearInterval(lt)}function Ut(n){ct(),lt=window.setInterval(n,Bt)}class k{constructor({app:t,passive:e,pointerDownHold:s}){h(this,"app");h(this,"passive");h(this,"pointerDownHold",!1);this.app=t,this.passive=e||!1,this.pointerDownHold=s||!1}onPointerDown(t,e){throw new Error('Method "onPointerDown" not implemented.')}onPointerUp(t,e){throw new Error('Method "onPointerUp" not implemented.')}onPointerMove(t,e){throw new Error('Method "onPointerMove" not implemented.')}onContextMenu(t,e){throw new Error('Method "onContextMenu" not implemented.')}deconstructor(){}onActive(){}setPixel(t,e,s){var r;return(r=this.app.canvas)==null?void 0:r.setPixel(t,e,s)}}class P extends k{constructor({brush:e,...s}){super(s);h(this,"brush");this.brush=e}static drawBrush({x:e,y:s,data:r,app:i,color:a}){var c,o;e=Math.floor(e-r[0].length/2+1),s=Math.floor(s-r.length/2);const l=[];for(let d=0;d<r[0].length;d++)for(let p=0;p<r.length;p++)r[Number(p)][Number(d)]>0&&a.alpha?((c=i.canvas)==null||c.setPixel(e+d,s+p,a),l.push([e+d,s+p])):r[Number(p)][Number(d)]<0&&((o=i.canvas)==null||o.setPixel(e+d,s+p,a));return l}}class ut extends P{onPointerDown(t){var i;const e=t.x,s=t.y,r=[...this.brush.data];return(i=this.app.canvas)==null||i.addRenderAction(()=>{P.drawBrush({color:this.brush.primaryColor,x:e,y:s,data:r,app:this.app})}),{save:!0,render:!0}}}function dt(n,t,e,s,r=0){const i=Math.abs(e-n),a=n<e?1:-1,l=Math.abs(s-t),c=t<s?1:-1;let o=(i>l?i:-l)/2;const d=[];let p=0;for(;r===0||p>=1?(d.push([n,t]),p=0):p+=1/r,!(n===e&&t===s);){const u=o;u>-i&&(o-=l,n+=a),u<l&&(o+=i,t+=c)}return d}function L(n,t,e,s,r,{density:i=0}){dt(t,e,s,r,i).forEach(a=>{n(a[0],a[1])})}function Wt(n,t,e,s,r,i,a,l,c,o=.001){let d=0,p=0,u=0;for(u=0;u<=1;u+=o)d=(1-u)**3*t+3*u*(1-u)**2*s+3*u**2*(1-u)*i+u**3*l,p=(1-u)**3*e+3*u*(1-u)**2*r+3*u**2*(1-u)*a+u**3*c,n(d,p)}function z(n,t,e,s,r,{strokeSize:i=0,filled:a=!1,density:l}){if(a){const c=(o,d)=>n(o,d,!0);for(let o=(r<0,e);r<0?o>=e+r:o<=e+r;r<0?o--:o++)L(c,(s<0,t),o,t+s,o,{density:l})}if(i>0){i=Math.floor(i/2);const c=[s<0?-i:i,r<0?-i:i];let o=[t-c[0],e-c[1]];[[t-c[0],e-c[1]],[t-c[0],e+r+c[1]],[t+s+c[0],e+r+c[1]],[t+s+c[0],e-c[1]],o].forEach(d=>{L(n,o[0],o[1],d[0],d[1],{density:l}),o=d})}}function $(n,t,e,s,r,{filled:i=!1,density:a=0}){s<0&&(s=Math.abs(s)),r<0&&(r=Math.abs(r));const l=s*s,c=r*r,o=4*l,d=4*c;let p,u,g,E=0;const S=(f,y)=>n(f,y,!0),D=[];for(p=0,u=r,g=2*c+l*(1-2*r);c*p<=l*u;p++)!a||E>=1?(D.push([t+p,e+u]),D.push([t-p,e-u]),D.push([t-p,e+u]),D.push([t+p,e-u]),E=0):E+=1/a,g>=0&&(g+=o*(1-u),u--),g+=c*(4*p+6);for(E=0,p=s,u=0,g=2*l+c*(1-2*s);l*u<=c*p;u++)!a||E>=1?(D.push([t+p,e+u]),D.push([t-p,e+u]),D.push([t+p,e-u]),D.push([t-p,e-u]),E=0):E+=1/a,g>=0&&(g+=d*(1-p),p--),g+=l*(4*u+6);if(i)for(let f=-r;f<=r;f++)for(let y=-s;y<=s;y++)y*y*r*r+f*f*s*s<=r*r*s*s&&S(t+y,e+f);D.forEach(f=>{n(f[0],f[1],!1)})}function Mt(n,t,e,{filled:s=!1,density:r=0}){let i,a=Number.MAX_VALUE,l=Number.MAX_VALUE,c=Number.MIN_VALUE,o=Number.MIN_VALUE;if(t.forEach(d=>{i&&(d.x>c&&(c=d.x),d.y>o&&(o=d.y),d.x<a&&(a=d.x),d.y<l&&(l=d.y),L(n,i.x,i.y,d.x,d.y,{density:r})),i=d}),e){const d=t[0];i&&(d.x>c&&(c=d.x),d.y>o&&(o=d.y),d.x<a&&(a=d.x),d.y<l&&(l=d.y),L(n,i.x,i.y,d.x,d.y,{density:r}))}s&&Ft((p,u)=>n(p,u,!0),t,{IMAGE_LEFT:a,IMAGE_TOP:l,IMAGE_RIGHT:c,IMAGE_BOTTOM:o})}function Ft(n,t,{IMAGE_LEFT:e=0,IMAGE_TOP:s=0,IMAGE_RIGHT:r,IMAGE_BOTTOM:i}){const a=[],l=[];t.forEach(S=>{a.push(S.y),l.push(S.x)});let c;const o=Array(t.length);let d,p,u,g,E;for(p=s;p<i;p++){for(c=0,g=t.length-1,u=0;u<t.length;u++)(a[Number(u)]<p&&a[Number(g)]>=p||a[Number(g)]<p&&a[Number(u)]>=p)&&(o[c++]=Math.round(l[Number(u)]+(p-a[Number(u)])/(a[Number(g)]-a[Number(u)])*(l[Number(g)]-l[Number(u)]))),g=u;for(u=0;u<c-1;)o[Number(u)]>o[u+1]?(E=o[Number(u)],o[Number(u)]=o[u+1],o[u+1]=E,u&&u--):u++;for(u=0;u<c&&!(o[Number(u)]>=r);u+=2)if(o[u+1]>e)for(o[Number(u)]<e&&(o[Number(u)]=e),o[u+1]>r&&(o[u+1]=r),d=o[Number(u)];d<o[u+1];d++)n(d,p)}}class kt extends P{constructor(){super(...arguments);h(this,"last")}onPointerDown(e){return this.draw(e)}onPointerMove(e){return this.draw(e)}onPointerUp(){return this.last=void 0,{save:!0}}draw(e){const s=(this.last||e).x,r=(this.last||e).y;return L((i,a)=>{var c;const l=[...this.brush.data];(c=this.app.canvas)==null||c.addRenderAction(()=>{P.drawBrush({color:this.brush.primaryColor,data:l,x:i,y:a,app:this.app})})},s,r,e.x,e.y,{}),this.last=e,{render:!0}}}var x=(n=>(n.BLACK="BLACK",n.WHITE="WHITE",n.TRANSPARENT="TRANSPARENT",n))(x||{});const _={BLACK:[0,0,0,255],WHITE:[255,255,255,255],TRANSPARENT:[0,0,0,0]};class Y{constructor({app:t,size:e,lowres:s,primaryColor:r,secondaryColor:i}){h(this,"app");h(this,"_size");h(this,"lowres");h(this,"_primaryColor");h(this,"_secondaryColor");h(this,"_data");this.app=t,this._size=e!==void 0?e:1,this.lowres=s!==void 0?s:!0,this._data=this.getScaledData(this._size),this._primaryColor=r||new w(_[x.BLACK]),this._secondaryColor=i||new w(_[x.WHITE])}get size(){return this._size}set size(t){this._size=t,this._data=this.getScaledData(this._size)}get data(){return this._data}set data(t){this._data=t}get primaryColor(){return this._primaryColor||this.app.colorSelect.primaryColor}get secondaryColor(){return this._secondaryColor||this.app.colorSelect.secondaryColor}getData(t){return Y.scale([],t)}getScaledData(t=1){return Y.scale(this.getData(t),this.app.density)}static scale(t,e){const s=[];for(let r=0;r<t.length*e;r++){s.push([]);for(let i=0;i<t[0].length*e;i++)s[Number(r)].push(t[Math.floor(r/e)][Math.floor(i/e)])}return s}static scaleAsCopy(t,e){const s=[];for(let r=0;r<t.length*e;r++){s.push([]);for(let i=0;i<t[0].length*e;i++)s[Number(r)].push(t[r%t.length][i%t[0].length])}return s}}class Ht extends Y{getData(t){return t>1?pt(t):t?[[1]]:[]}}function pt(n){n=(n-1)*2;const t=Array(n+1);for(let e=0;e<n+1;e++)t[Number(e)]=Array(n+1).fill(0);return $((e,s)=>{t[Math.round(e)][Math.round(s)]=1},n/2,n/2,n/2,n/2,{filled:!0}),t}function zt(n){const t=pt(n+2);for(let e=0;e<t.length;e++)for(let s=0;s<t[Number(e)].length;s++)t[Number(e)][Number(s)]>0&&Math.random()<.15/n?t[Number(e)][Number(s)]=1:t[Number(e)][Number(s)]=0;return t}function Yt(n){const t=Array(n+1);for(let e=0;e<n+1;e++)t[Number(e)]=Array(n+1).fill(0);return z((e,s)=>{t[Math.round(e)][Math.round(s)]=1},0,0,n,n,{filled:!0}),t}class Gt extends Y{getData(t){return Yt(t)}}class Xt extends Y{getData(t){return zt(t)}get data(){return this._data=this.getScaledData(this._size),this._data}}function K(n){return[Ht,Gt,Xt][Number(n)]}class B extends P{constructor(e){super(e);h(this,"COLOR_TRANSPARENT");h(this,"filled");h(this,"selectedAnchor");h(this,"anchors");h(this,"anchorBrush");h(this,"startEvent");this.COLOR_TRANSPARENT=new w(_[x.TRANSPARENT]),this.filled=!1,this.selectedAnchor=void 0,this.anchors=[];const s=K(0);this.anchorBrush=new s({app:this.app,lowres:!0,size:1,primaryColor:new w(_[x.BLACK]),secondaryColor:new w(_[x.WHITE])})}onPointerDown(e){return this.startEvent=e,{}}drawAnchors(){const e=[...this.anchorBrush.data];this.anchors.forEach(s=>{this.drawAnchor(s,e)})}drawAnchor(e,s){e.intersectMap=[],z((r,i,a)=>{var o;let l=((o=this.app.canvas)==null?void 0:o.getColorFromPixel(r,i))||new w;l.alpha===0?l=a?this.anchorBrush.secondaryColor:this.anchorBrush.primaryColor:l.invert();const c=e.intersectMap;c&&(c[Number(r)]=c[Number(r)]||[],c[Number(r)][Number(i)]=!0,P.drawBrush({color:l,data:s,x:r,y:i,app:this.app}))},e.x-5,e.y-5,10,10,{strokeSize:1,filled:!0})}getAnchorByPosition(e,s){return this.anchors.find(r=>r.intersectAnchor(e,s)?r:!1)}addAnchor(e,s){const r=new jt(e,s,this.anchorBrush);return this.anchors.push(r),r}reset(){this.anchors=[],this.selectedAnchor=void 0}}class jt{constructor(t,e,s){h(this,"x");h(this,"y");h(this,"brush");h(this,"intersectMap");this.x=t,this.y=e,this.brush=s}intersectAnchor(t,e){return this.intersectMap&&this.intersectMap[Number(t)]&&this.intersectMap[Number(t)][Number(e)]}}class $t extends B{onPointerDown(t){var e,s;if(this.selectedAnchor){const r=this.getAnchorByPosition(t.x,t.y);if(r)this.selectedAnchor=r;else return(e=this.app.canvas)==null||e.addRenderAction(()=>{this.render(!1),this.reset()}),{save:!0,render:!0};(s=this.app.canvas)==null||s.addPassiveRenderAction(()=>{this.render(!0)})}return{render:!0}}onPointerMove(t,{mouse:e}){var s;return e!=null&&e.pressed&&(this.anchors.length<1&&(this.addAnchor(t.x,t.y),this.selectedAnchor=this.addAnchor(t.x,t.y)),this.selectedAnchor&&(this.selectedAnchor.x=t.x,this.selectedAnchor.y=t.y),(s=this.app.canvas)==null||s.addPassiveRenderAction(()=>{this.render(!0)})),{render:!0}}render(t=!1){this.anchors.length&&(L((e,s)=>{const r=[...this.brush.data];B.drawBrush({color:this.brush.primaryColor,data:r,x:e,y:s,app:this.app})},this.anchors[0].x,this.anchors[0].y,this.anchors[1].x,this.anchors[1].y,{}),t&&this.drawAnchors())}}class Vt extends B{constructor(e){super(e);h(this,"status");h(this,"locked");h(this,"moved");h(this,"points");h(this,"primaryHelperOffset");h(this,"secondaryHelperOffset");this.status=0,this.locked=!1}refreshHelperOffset(){this.primaryHelper&&(this.primaryHelperOffset=[this.primaryHelper.x-this.primaryAnchor.x,this.primaryHelper.y-this.primaryAnchor.y]),this.secondaryHelper&&(this.secondaryHelperOffset=[this.secondaryHelper.x-this.secondaryAnchor.x,this.secondaryHelper.y-this.secondaryAnchor.y])}onPointerDown(e){var r;if(this.moved||this.reset(),this.locked)return{};this.locked=!0,this.anchors.length===1&&this.reset();const s=this.getAnchorByPosition(e.x,e.y);if(s&&this.selectedAnchor!==s)this.selectedAnchor=s;else{if(this.status===2&&!s)return this.onPointerDownSave();this.status===1?this.onPointerDownCreateHelpers():this.selectedAnchor||(this.addAnchor(e.x,e.y),this.selectedAnchor=this.addAnchor(e.x,e.y))}return(r=this.app.canvas)==null||r.addPassiveRenderAction(()=>{this.render(!0),this.locked=!1}),{render:!0}}get primaryAnchor(){return this.anchors[0]}get secondaryAnchor(){return this.anchors[1]}get primaryHelper(){return this.anchors[2]}get secondaryHelper(){return this.anchors[3]}onPointerUp(){var e;return this.status<3&&this.status===0?(this.selectedAnchor=void 0,this.status++,(e=this.app.canvas)==null||e.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}):{}}onPointerMove(e,{mouse:s}){var r;return s!=null&&s.pressed&&this.selectedAnchor&&this.primaryHelperOffset&&this.secondaryHelperOffset?(this.moved=!0,this.selectedAnchor.x=e.x,this.selectedAnchor.y=e.y,this.selectedAnchor===this.primaryAnchor&&this.primaryHelper?(this.primaryHelper.x=this.selectedAnchor.x+this.primaryHelperOffset[0],this.primaryHelper.y=this.selectedAnchor.y+this.primaryHelperOffset[1]):this.selectedAnchor===this.secondaryAnchor&&this.secondaryHelper?(this.secondaryHelper.x=this.selectedAnchor.x+this.secondaryHelperOffset[0],this.secondaryHelper.y=this.selectedAnchor.y+this.secondaryHelperOffset[1]):(this.selectedAnchor===this.primaryHelper||this.selectedAnchor===this.secondaryHelper)&&this.refreshHelperOffset(),(r=this.app.canvas)==null||r.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}):{}}addPoints(e){if(!this.app.canvas)throw new Error("Canvas not defined");const s=this.app.canvas;if(Array.isArray(this.points)){const r=this.points;e.forEach(i=>{r[A(i[0]-1,0,s.width-1)][A(i[1]-1,0,s.height-1)]=!0})}else throw new Error("Points not defined")}render(e=!1){this.status>1?Wt((s,r)=>{const i=[...this.brush.data];P.drawBrush({color:this.brush.primaryColor,data:i,x:s,y:r,app:this.app})},this.primaryAnchor.x,this.primaryAnchor.y,this.primaryHelper.x,this.primaryHelper.y,this.secondaryHelper.x,this.secondaryHelper.y,this.secondaryAnchor.x,this.secondaryAnchor.y):L((s,r)=>{const i=[...this.brush.data];B.drawBrush({color:this.brush.primaryColor,data:i,x:s,y:r,app:this.app})},this.primaryAnchor.x,this.primaryAnchor.y,this.secondaryAnchor.x,this.secondaryAnchor.y,{}),e&&(this.primaryHelper&&L((s,r)=>{var l;let i=((l=this.app.canvas)==null?void 0:l.getColorFromPixel(s,r))||new w;i.alpha===0?i=this.anchorBrush.primaryColor:i.invert();const a=[...this.anchorBrush.data];B.drawBrush({color:i,data:a,x:s,y:r,app:this.app})},this.primaryAnchor.x,this.primaryAnchor.y,this.primaryHelper.x,this.primaryHelper.y,{}),this.secondaryHelper&&L((s,r)=>{var l;let i=((l=this.app.canvas)==null?void 0:l.getColorFromPixel(s,r))||new w;i.alpha===0?i=this.anchorBrush.primaryColor:i.invert();const a=[...this.anchorBrush.data];B.drawBrush({color:i,data:a,x:s,y:r,app:this.app})},this.secondaryAnchor.x,this.secondaryAnchor.y,this.secondaryHelper.x,this.secondaryHelper.y,{}),this.drawAnchors())}reset(){super.reset(),this.status=0,this.locked=!1}intersect(e,s){const r=[[0,0],[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]];if(this.points){const i=this.points;for(let a=0;a<r.length;a++)if(i[e+r[Number(a)][0]][s+r[Number(a)][1]])return!0}return!1}onPointerDownCreateHelpers(){var s;let e=at(this.primaryAnchor,this.secondaryAnchor);this.addAnchor(e[0],e[1]),e=at(this.secondaryAnchor,this.primaryAnchor),this.addAnchor(e[0],e[1]),this.refreshHelperOffset(),(s=this.app.canvas)==null||s.addPassiveRenderAction(()=>{this.render(!0),this.locked=!1}),this.status++}onPointerDownSave(){var e;return(e=this.app.canvas)==null||e.addRenderAction(()=>{this.render(!1),this.reset()}),{events:!1,save:!0,render:!0}}}function at(n,t){const e=dt(n.x,n.y,t.x,t.y);return e[Math.floor(e.length/4)]}class Zt extends k{constructor(){super(...arguments);h(this,"filling",!1)}fill(e,s,r){var E,S,D,f,y;if(!this.app.canvas)throw new Error("Canvas not found");const i=[[e,s]];let a=0,l,c,o,d,p;const u=(E=this.app.canvas)==null?void 0:E.getColorFromPixel(e,s,!0),g=[[-1,0],[1,0],[0,-1],[0,1]];for(;i.length;){if(a>2e6)throw new Error("FILL OVERFLOW");if(l=i.pop(),!l)throw new Error("FILL OVERFLOW");for(e=l[0],s=l[1],(S=this.app.canvas)==null||S.setPixel(e,s,r),c=0;c<g.length;c++)o=e+g[Number(c)][0],d=s+g[Number(c)][1],o>=0&&o<((D=this.app.canvas)==null?void 0:D.width)&&d>=0&&d<((f=this.app.canvas)==null?void 0:f.height)&&(p=(y=this.app.canvas)==null?void 0:y.getColorFromPixel(o,d,!0),p.is(u)&&!r.is(p)&&i.push([o,d]));a++}}onPointerDown(e){var s;if(!this.filling){this.filling=!0;const r=e.x,i=e.y,a=this.app.colorSelect.primaryColor;return(s=this.app.canvas)==null||s.addRenderAction(()=>{this.fill(r,i,a),this.filling=!1}),{save:!0,render:!0}}return{events:!1}}}class Kt extends ut{constructor(t){super({pointerDownHold:!0,...t})}}class Jt extends B{onPointerMove(t){var i;const e=this.startEvent||m(0,0),s=t.x-e.x,r=t.y-e.y;return(i=this.app.canvas)==null||i.addPassiveRenderAction(()=>{z((a,l,c)=>{const o=[...this.brush.data];P.drawBrush({color:c?this.brush.secondaryColor:this.brush.primaryColor,data:o,x:a,y:l,app:this.app})},e.x,e.y,s,r,{strokeSize:this.filled?0:this.brush.data.length,filled:this.filled})}),{render:!0}}onPointerUp(t){var i;const e=this.startEvent||m(0,0),s=t.x-e.x,r=t.y-e.y;return(i=this.app.canvas)==null||i.addRenderAction(()=>{z((a,l,c)=>{const o=[...this.brush.data];P.drawBrush({color:c?this.brush.secondaryColor:this.brush.primaryColor,data:o,x:a,y:l,app:this.app})},e.x,e.y,s,r,{strokeSize:this.filled?0:this.brush.data.length,filled:this.filled})}),{save:!0,render:!0}}}class mt extends B{constructor({proportinalScale:e,...s}){super(s);h(this,"proportinalScale",!1);this.proportinalScale=e||!1}onPointerMove(e){var a;const s=this.startEvent||m(0,0),r=(e.x-s.x)/2;let i=(e.y-s.y)/2;return this.proportinalScale&&(r<0&&i>0||r>0&&i<0?i=r*-1:i=r),r!==0&&i!==0?((a=this.app.canvas)==null||a.addPassiveRenderAction(()=>{$((l,c,o)=>{const d=[...this.brush.data];P.drawBrush({color:o?this.brush.secondaryColor:this.brush.primaryColor,data:d,x:l,y:c,app:this.app})},Math.floor(s.x+r),Math.floor(s.y+i),r,i,{filled:this.filled})}),{render:!0}):{}}onPointerUp(e){var a;const s=this.startEvent||m(0,0),r=(e.x-s.x)/2;let i=(e.y-s.y)/2;return this.proportinalScale&&(r<0&&i>0||r>0&&i<0?i=r*-1:i=r),r!==0&&i!==0?((a=this.app.canvas)==null||a.addRenderAction(()=>{$((l,c,o)=>{const d=[...this.brush.data];P.drawBrush({color:o?this.brush.secondaryColor:this.brush.primaryColor,data:d,x:l,y:c,app:this.app})},Math.floor(s.x+r),Math.floor(s.y+i),r,i,{filled:this.filled})}),{save:!0,render:!0}):{}}}class qt extends mt{constructor(e){super({...e,proportinalScale:!0});h(this,"func");this.func=$}}class Qt extends B{constructor(e){super(e);h(this,"status");this.status=0}onPointerMove(e,{mouse:s}){var r;return s!=null&&s.pressed&&this.selectedAnchor?(this.selectedAnchor.x=e.x,this.selectedAnchor.y=e.y,(r=this.app.canvas)==null||r.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}):{}}onPointerDown(e){var r,i;const s=this.getAnchorByPosition(e.x,e.y);switch(this.status){case 1:if(s)this.selectedAnchor=s;else return this.status=2,(r=this.app.canvas)==null||r.addRenderAction(()=>{this.render(!1),this.reset()}),{save:!0,render:!0};break;default:s&&this.anchors[0]===s?(this.status=1,this.selectedAnchor=s):this.selectedAnchor=s||this.addAnchor(e.x,e.y)}return(i=this.app.canvas)==null||i.addPassiveRenderAction(()=>{this.render(this.status<2)}),{render:!0}}isClosed(){return this.status>0}render(e=!1){Mt((r,i)=>{const a=[...this.brush.data];P.drawBrush({color:this.brush.primaryColor,data:a,x:r,y:i,app:this.app})},this.anchors,this.status>0,{filled:this.filled}),e&&this.drawAnchors()}reset(){super.reset(),this.status=0}}class F{constructor(t,e){h(this,"min",m(0,0));h(this,"max",m(0,0));this.min=t||this.min,this.max=e||this.max}}class te extends B{constructor(e){super(e);h(this,"brushPrimaryColor");h(this,"brushSecondaryColor");h(this,"bounds");h(this,"status");h(this,"croppedImageData");h(this,"intersectedStartEvent");this.brushPrimaryColor=new w(_[x.BLACK]),this.brushSecondaryColor=new w(_[x.WHITE]),this.brush=new(K(0))({app:this.app,size:1,lowres:!0,primaryColor:this.brushPrimaryColor,secondaryColor:this.brushSecondaryColor}),this.reset()}intersect(e){return this.bounds?e.x>this.bounds.min.x&&e.x<this.bounds.max.x&&e.y>this.bounds.min.y&&e.y<this.bounds.max.y:!1}reset(){this.status=0,this.bounds=void 0,this.intersectedStartEvent=void 0,this.croppedImageData=void 0,this.startEvent=void 0}onPointerDown(e){var r,i;let s;switch(this.status){case 3:break;case 2:if(this.croppedImageData&&(this.intersectedStartEvent||this.intersect(e)))if(this.intersectedStartEvent=e,e.rightClick)this.status++;else return{events:!0,render:!1};break;case 1:if(!this.bounds)throw new Error("Bounds not defined");if(s=m(this.bounds.max-this.bounds.min),this.status++,e.rightClick){const a=this.bounds.min.x,l=this.bounds.min.y;(r=this.app.canvas)==null||r.addRenderAction(()=>{var c;(c=this.app.canvas)==null||c.fillPixels(this.brush.secondaryColor,a,l,s.x,s.y)})}return(i=this.app.canvas)==null||i.addPassiveRenderAction(()=>{this.startEvent&&this.render(this.startEvent.x,this.startEvent.y,!0)}),{events:!0,render:!0};default:return super.onPointerDown(e)}return{}}onPointerMove(e,{mouse:s}){var r,i;if(this.intersectedStartEvent&&(s!=null&&s.pressed)){const a=this.getRectInfo(e);return(r=this.app.canvas)==null||r.addPassiveRenderAction(()=>{this.render(a.x,a.y,!0)}),{render:!0}}else if(this.status===0)return(i=this.app.canvas)==null||i.addPassiveRenderAction(()=>{this.render(e.x,e.y,!0)}),{render:!0};return{}}getRectInfo(e){if(!this.bounds||!this.startEvent||!this.intersectedStartEvent)throw new Error("Bounds, startEvent or intersectedStartEvent not defined");return{width:this.bounds.max.x-this.bounds.min.x,height:this.bounds.max.y-this.bounds.min.y,x:this.startEvent.x+e.x-this.intersectedStartEvent.x,y:this.startEvent.y+e.y-this.intersectedStartEvent.y}}onPointerUp(e){var s,r,i;if(this.status===3)return(s=this.app.canvas)==null||s.addRenderAction(()=>{const a=this.getRectInfo(e);if(!this.croppedImageData)throw new Error("Cropped image data not defined");O.invertImageData(this.croppedImageData),this.render(a.x,a.y,!1),this.reset()}),{save:!0,render:!0};if(this.intersectedStartEvent&&this.status===2){const a=this.getRectInfo(e);if(this.startEvent)this.startEvent.x=a.x,this.startEvent.y=a.y;else throw new Error("Start event not defined");return this.bounds=new F(m(a.x,a.y),m(a.x+a.width,a.y+a.height)),(r=this.app.canvas)==null||r.addPassiveRenderAction(()=>{this.render(a.x,a.y,!0)}),{render:!0}}else if(this.startEvent&&this.status===0){const a=e.x-this.startEvent.x,l=e.y-this.startEvent.y;return a>0&&l>0&&(this.bounds=new F(m(this.startEvent.x,this.startEvent.y),m(e.x,e.y)),this.status++,(i=this.app.canvas)==null||i.addPassiveRenderAction(()=>{var c,o;this.bounds&&this.startEvent&&((c=this.app.canvas)!=null&&c.renderImageData)&&(this.croppedImageData=O.cropImageData((o=this.app.canvas)==null?void 0:o.renderImageData,this.bounds.min.x,this.bounds.min.y,a,l),O.invertImageData(this.croppedImageData),this.render(this.startEvent.x,this.startEvent.y,!0))})),{render:!0}}return{}}render(e,s,r){var l;let i=m(0,0),a=m(e,s);if(this.bounds){const c=this.bounds;i=m(()=>c.max-c.min)}else this.startEvent&&(a=this.startEvent.position,i=m(()=>a-a));this.croppedImageData&&((l=this.app.canvas)==null||l.putImageData(this.croppedImageData,a.x,a.y)),r&&z((c,o)=>{var u;const d=[...this.brush.data];let p=((u=this.app.canvas)==null?void 0:u.getColorFromPixel(c,o))||new w;p.alpha===0?p=this.brushPrimaryColor:p.invert(),P.drawBrush({color:p,data:d,x:c,y:o,app:this.app})},a.x,a.y,i.x,i.y,{strokeSize:this.brush.data.length,filled:this.filled,density:3})}}class ee extends B{constructor(e){super(e);h(this,"brushPrimaryColor");h(this,"brushSecondaryColor");h(this,"moving");this.brushPrimaryColor=new w(_[x.BLACK]),this.brushSecondaryColor=new w(_[x.WHITE]),this.brush=new(K(0))({app:this.app,size:1,lowres:!0,primaryColor:this.brushPrimaryColor,secondaryColor:this.brushSecondaryColor}),this.moving=!1}onPointerMove(e){var s;if(this.startEvent){const r=this.startEvent.x,i=this.startEvent.y,a=e.x-r,l=e.y-i;this.moving||(this.moving=!0,(s=this.app.canvas)==null||s.addPassiveRenderAction(()=>{z((c,o)=>{var u;const d=[...this.brush.data];let p=((u=this.app.canvas)==null?void 0:u.getColorFromPixel(c,o))||new w;p.alpha===0?p=this.brushPrimaryColor:p.invert(),P.drawBrush({color:p,data:d,x:c,y:o,app:this.app})},r,i,a,l,{strokeSize:this.brush.data.length,filled:!1}),this.moving=!1}))}return{render:!0}}onPointerUp(e){var s;if(this.startEvent){(s=this.app.canvas)==null||s.cleanPassiveRenderActions();const r=m(e.x,e.y),i=m(this.startEvent.x,this.startEvent.y),a=J(()=>Math.floor(r-i));if(a.x>0&&a.y>0){const l=new F(i,r),c=this.app.display;if(c){const o=J(()=>Math.floor(c.canvasLayout.naturalSize/a*c.zoomFactor)),d=J(()=>l.min+a/2);c.setZoom(o.x>o.y?o.x:o.y,d)}}}return{render:!0}}}class se extends k{onPointerDown(t){const e=this.app.display;if(!e)throw new Error("Display not found");let s=2;return e.maxZoomFactor-5<e.zoomFactor&&(s=1),s=C.altActive?-s:s,e.zoom(s,m(t.x,t.y)),{events:!1}}}class re extends k{constructor(t){super(t),this.passive=!0}onActive(){var t;(t=this.app.canvas)==null||t.revertStack()}}class ie extends k{constructor(t){super(t),this.passive=!0}onActive(){var t;(t=this.app.canvas)==null||t.clearStack()}}function ae(n){return[ut,kt,$t,Vt,Zt,Kt,Jt,qt,mt,Qt,te,k,k,k,ee,se,re,ie][n]}class ne{constructor(t){h(this,"app");h(this,"id",Nt());h(this,"events",new ht);h(this,"bounds",new F);h(this,"size",m(0,0));h(this,"_cursorColor",new w(_[x.TRANSPARENT]));h(this,"_cursorColorRGBA","rgba(0, 0, 0, 0)");h(this,"canvasLayout",V({size:j(m(0,0)),naturalSize:j(m(0,0)),position:j(m(0,0))}));h(this,"imageData");h(this,"tmpImageData");h(this,"el");h(this,"canvas");h(this,"context",null);h(this,"zoomFactor",1);h(this,"maxZoomFactor",20);h(this,"zoomPosition",m(.5,.5));h(this,"zoomBounds",new F);h(this,"offset",m(0,0));h(this,"cursorVisible",!1);this.app=t,this.cursorColor=new w(_[x.BLACK]),this.resetZoom()}showCursor(){this.cursorVisible=!0}hideCursor(){this.cursorVisible=!1,this.renderImageData()}setElement(t){this.el=t}setCanvas(t){this.canvas=t,this.context=t.getContext("2d"),Object.values(this.app.inputs).forEach(e=>{e.registerDisplay(this)})}destroy(){this.events.next(new H({name:"destroy"})),Object.values(this.app.inputs).forEach(t=>{t.unregisterDisplay(this)})}setImageData(t){this.tmpImageData=this.imageData=t,this.maxZoomFactor=20,this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.renderImageData()}get canvasSize(){if(!this.canvas)throw new Error("Canvas not set");return m(this.canvas.width,this.canvas.height)}get naturalSize(){if(!this.canvas)throw new Error("Canvas not set");return m(this.canvas.width,this.canvas.height)}get naturalWidth(){if(!this.imageData)throw new Error("Image data not set");return this.imageData.width}get naturalHeight(){if(!this.imageData)throw new Error("Image data not set");return this.imageData.height}get width(){return this.zoomBounds.max.x-this.zoomBounds.min.x}get height(){return this.zoomBounds.max.y-this.zoomBounds.min.y}get zoomFactorWidth(){if(!this.canvas)throw new Error("Canvas not set");return this.canvas.width/this.zoomFactor}setSize(t,e){let s;typeof t=="object"&&"x"in t?s=t:s=m(t,e),this.size=s,this.events.next(new H({name:"change:size",value:s})),this.canvasAdjustment()}canvasAdjustment(){if(!this.app.canvas)throw new Error("Canvas not set");const t=this.app.canvas;this.canvasLayout.size=m(()=>Math.min(Math.max(t.size*this.zoomFactor,0),this.size)),this.canvasLayout.naturalSize=this.app.canvas.size,this.canvasLayout.position=m(0,0)}setZoom(t=1,e=m(0,0)){t=Math.min(t,this.maxZoomFactor),t>=0&&(this.zoomFactor=t,this.canvasAdjustment(),this.zoomPosition=m(()=>e/this.canvasLayout.naturalSize),this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.resetOffset(),window.requestAnimationFrame(()=>{this.renderImageData(),this.events.next(new H({name:"change:zoomFactor",value:{factor:t}}))}))}zoom(t=1,e=m(0,0)){this.zoomFactor+t>=0&&this.setZoom(this.zoomFactor+t,e)}renderImageData(){this.tmpImageData=this.imageData;const t=m(()=>this.zoomBounds.max-this.zoomBounds.min),e=m(()=>m(this.offset)+this.zoomBounds.min);if(!this.tmpImageData)throw new Error("Image data not set");this.tmpImageData=O.cropImageData(this.tmpImageData,e.x,e.y,t.x,t.y),this.tmpImageData=O.resizeImageData(this.tmpImageData,this.zoomFactor),this.renderCanvas()}get cursorColor(){return this._cursorColor}set cursorColor(t){this._cursorColorRGBA=t.toRGBA(),this._cursorColor=t}renderCanvas(){var t;this.tmpImageData&&((t=this.context)==null||t.putImageData(this.tmpImageData,-this.offset.x,-this.offset.y),this.renderRaster())}reset(){this.resetZoom(),this.resetOffset(),this.renderCanvas()}resetOffset(){this.offset=m(0,0)}resetZoom(){this.imageData&&this.setZoom(1)}renderRaster(){const t=[];this.zoomFactor>this.maxZoomFactor-3&&t.push({size:m(1,1),width:1,color:"#CCCCCC"});const e=this.canvas,s=this.context;if(!e||!s)throw new Error("Canvas or context not set");s.globalCompositeOperation="destination-over",t.forEach(r=>{const i=m(()=>this.canvasLayout.naturalSize/r.size);s.lineWidth=r.width,s.beginPath();for(let a=0;a<i.x+1;a++){const l=Math.floor(a*r.size.x*this.zoomFactor)+r.width/2;s.moveTo(l,0),s.lineTo(l,e.height);for(let c=0;c<i.y+1;c++){const o=Math.floor(c*r.size.y*this.zoomFactor)+r.width/2;s.moveTo(0,o),s.lineTo(e.width,o)}}s.strokeStyle=r.color,s.stroke()})}refresh(){if(this.el&&this.canvas){const t={left:this.canvas.offsetLeft+this.el.offsetLeft,top:this.canvas.offsetTop+this.el.offsetTop,width:this.canvas.offsetWidth,height:this.canvas.offsetHeight};this.bounds=new F(m(t.left,t.top),m(t.left+t.width,t.top+t.height)),this.imageData&&this.renderImageData()}}setOffset(t){this.offset=t}calculateZoomBounds(t,e){if(!this.app.canvas)throw new Error("Canvas not set");e=e||1;const s=this.app.canvas.size;t=m(()=>Math.floor(t*s));const r=m(()=>this.size/s),i=m(()=>Math.ceil(Math.min(r/e*s,s))),a=m(()=>Math.min(Math.max(t-Math.ceil(i/2),0),s-i)),l=m(()=>a+i);return new F(a,l)}}const oe={FULL:0,HALF:1,THIRD:2,QUARTER:3};class he{constructor(t){h(this,"subscription",new ot);h(this,"events",new ht);h(this,"globalBounds");h(this,"fsItem");h(this,"options",{size:{width:300,height:200},display:{foreground:"#FFFFFF",background:"#000000"}});h(this,"density",1);h(this,"displaySplit",oe.FULL);h(this,"displays",[]);h(this,"displaysEl");h(this,"displaysLayout",{size:m(0,0)});h(this,"display");h(this,"canvas");h(this,"inputs");h(this,"brush");h(this,"brushSelect",{size:1,index:0});h(this,"colorSelect",{primaryColor:new w(_[x.BLACK]),secondaryColor:new w(_[x.WHITE]),paletteSteps:new w(2,1,1)});h(this,"tool");h(this,"toolSelect",{value:"",index:1,filled:!1});h(this,"cursorCanvas",null);this.globalBounds=t,this.canvas=new O(this),this.setBrush(this.brushSelect),this.setTool(this.toolSelect),this.subscription.add(Tt.resize.subscribe(this.onViewportRefresh.bind(this))),this.inputs={keyboard:new Ot(this),mouse:new Lt(this)},Object.values(this.inputs).forEach(e=>{e.register()})}setColorSelect(t){this.colorSelect={...this.colorSelect,...t}}setBrushSelect(t){this.brushSelect={...this.brushSelect,...t}}setToolSelect(t){this.toolSelect={...this.toolSelect,...t}}setDisplaysElement(t){this.displaysEl=t}refresh(){this.displaysEl&&(this.displaysLayout={size:m(this.displaysEl.offsetWidth,this.displaysEl.offsetHeight)},this.refreshDisplayPositions(),this.refreshDisplays())}setDisplay(t){this.display&&this.display.hideCursor(),this.display=t,this.display.showCursor()}updateGlobalBounds(t){this.globalBounds=t}reset(){var t;(t=this.canvas)==null||t.clearStack(),this.displays.forEach(e=>e.reset())}destroy(){this.subscription.unsubscribe()}refreshDisplays(){this.displays.forEach(t=>{t.refresh()})}onViewportRefresh(){this.refreshDisplays()}addDisplay(t){var e;return t=j(t||new ne(this)),this.displays.push(t),t.app=this,this.events.next(new H({name:"addDisplay",value:t,scope:this})),(e=this.canvas)==null||e.render(),t}clearDisplays(){this.displays.forEach(t=>{t.destroy(),this.events.next(new H({name:"removeDisplay",value:t,scope:this}))}),this.displays=[]}getDisplay(t){return this.displays.find(e=>e.id===t?e:!1)}setBrush({index:t,size:e}){const s=K(t||0);this.brush=new s({app:this,size:e}),this.tool&&this.tool instanceof P&&(this.tool.brush=this.brush),this.events.next(new H({name:"change:brush",value:this.brush,scope:this}))}setBrushSize(t){this.brush&&(this.brush.size=t)}setTool({index:t}){if(!this.brush)throw new Error("Brush not found");const e=new(ae(Number(t)))({app:this,brush:this.brush});this.tool=e,this.tool.onActive(),this.events.next(new H({name:"change:tool",value:this.tool,scope:this}))}get paletteSteps(){return this.colorSelect.paletteSteps}set paletteSteps(t){this.colorSelect.paletteSteps=t}refreshDisplayPositions(){const t=this.displaysLayout.size.x,e=this.displaysLayout.size.y,r=[[[1,1]],[[.5,1],[.5,1]],[[1,.5],[1,.5]],[[1,.5],[.5,.5],[.5,.5]],[[.5,.5],[.5,.5],[1,.5]],[[.5,.5],[.5,.5],[.5,.5],[.5,.5]]].filter(i=>i.length===this.displays.length?i:!1)[0];this.displays.forEach((i,a)=>{i.setSize(yt(Math.floor(t*r[Number(a)][0]),Math.floor(e*r[Number(a)][1]))),r[Number(a)][0]<1,r[Number(a)][1]<1})}}var le=(n=>(n.CONTENT="content",n.OUTPUT_TYPE="type",n))(le||{}),G=(n=>(n.WEB_PAINTING_DISPLAY_BACKGROUND="extras13_web_painting_display_background",n.WEB_PAINTING_DISPLAY_FOREGROUND="extras13_web_painting_display_foreground",n))(G||{});const ce=Z(({core:n})=>[{meta:[[v.SYMBOL,M.WEB_PAINTING]],id:"WebPainting.app",name:"WebPainting",createdDate:new Date(2017,7,5).getTime(),editedDate:new Date(2020,3,14).getTime(),async action(){var l,c;const t=n.addExecution(),e=await R(()=>import("./CDdIG0_q.js").then(o=>o.W),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url).then(o=>o.default),s=(l=n.modules.screen)==null?void 0:l.contentLayout;if(!s)throw new Error("Content layout not found");const r=new he(new F(s.position,m(()=>s.position+s.size)));r.options.display.background=n.config.get(G.WEB_PAINTING_DISPLAY_BACKGROUND),r.options.display.foreground=n.config.get(G.WEB_PAINTING_DISPLAY_FOREGROUND);const i=V({fsItem:void 0,app:r}),a=(c=n.modules.windows)==null?void 0:c.addWindow({component:e,componentData:{model:i,setApp:o=>{i.app=o}},options:{title:"WebPainting - Extras 1.3",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1,embed:!0}},{group:"extras13WebPainting",full:!0});i.actions={close:()=>{a==null||a.close()},focus:()=>{a==null||a.focus()}},t()}}]);function ue(){return{[G.WEB_PAINTING_DISPLAY_BACKGROUND]:"#CCCCCC",[G.WEB_PAINTING_DISPLAY_FOREGROUND]:"#FFFFFF"}}var ft=(n=>(n.WEB_BASIC_SHOW_PREVIEW="extras13_web_basic_show_preview",n))(ft||{}),b=(n=>(n.CONTENT="content",n.OUTPUT_TYPE="type",n))(b||{});function de(){return{[ft.WEB_BASIC_SHOW_PREVIEW]:"extras13_web_basic_show_preview"}}function nt(){return{[N.HAS_WINDOW_OUTPUT]:!1,[b.CONTENT]:"",[b.OUTPUT_TYPE]:"basic"}}const pe=Z(({core:n})=>[{meta:[[v.SYMBOL,M.WEB_BASIC],[v.WINDOW_SIZE,m(360,200)]],id:"WebBasic.app",name:"WebBasic",createdDate:new Date(2017,7,5).getTime(),editedDate:new Date(2020,3,14).getTime(),async action({modules:t},e){var p,u;if(!t.windows)throw new Error("Windows module not found");const s=t.windows,r=n.addExecution();let i;const a=V({value:nt(),fsItem:void 0,output:[],openValue:void 0});if(e)if(i=await((p=t.files)==null?void 0:p.fs.get(e)),i&&b.CONTENT in i.data){const g={...i.data,[b.CONTENT]:[].concat(i.data[b.CONTENT]).join(`
`)};a.fsItem=i,a.value=g}else throw new Error("Can't read file content");const[l,c]=await Promise.all([R(()=>import("./B-R150Ne.js"),__vite__mapDeps([25,26,6,27,14,2,1,15,16,17,18,19,20,21,22,28,29,30,31,32,8,7,9,10,33,34,35,11,23,36,37,38,39,40,41,42,5,43,44,45]),import.meta.url).then(g=>g.default),R(()=>import("./BLSAOoF6.js"),__vite__mapDeps([46,6,47]),import.meta.url).then(g=>g.default)]),o=s.addWindow({component:l,componentData:{model:a,"onUpdate:value":g=>{a.value=g}},options:{title:"WebBasic - Extras 1.3",scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0,center:!1,embed:!1,borderless:!0},layout:{size:m(540,360)}},{group:"extras13WebBasic"});let d;a.actions={close:()=>{o==null||o.close()},focus:()=>{o==null||o.focus()},reset:()=>{a.value=nt(),a.fsItem=void 0,a.output=[],a.openValue=void 0},togglePreview:(g=!0)=>{g?(d=s.addWindow({component:c,componentData:{model:a},options:{title:"Preview - WebBasic - Extras 1.3",scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0,center:!1,close:!1,embed:!1,borderless:!0},layout:{size:m(540,360)}},{group:"extras13WebBasic",active:!1}),window.requestAnimationFrame(()=>{s.contentWrapper.setWindowPositions(st.SPLIT_HORIZONTAL,[o,d],{embed:!0})})):d&&(o==null||o.unfocus(),d.close(),window.requestAnimationFrame(()=>{s.contentWrapper.setWindowPositions(st.SPLIT_HORIZONTAL,[o],{embed:!0}),o==null||o.focus()}))}},(u=n.modules.screen)==null||u.setTheme(Pt),r(),o==null||o.events.pipe(It(({name:g})=>g==="close")).subscribe(()=>{var g;d&&d.close(),(g=n.modules.screen)==null||g.setTheme(void 0)})}}]);function me(n){return async({modules:t})=>{var r;const e=n.addExecution(),[s]=await Promise.all([R(()=>import("./DMjBHk4w.js").then(i=>i.B),__vite__mapDeps([48,6,7,8,9,10,23,12,13,49,50,51,52,53,54,55]),import.meta.url).then(i=>i.default)]);(r=t.windows)==null||r.addWindow({component:s,componentData:{},options:{title:"Base64 Converter",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}},{group:"extras13Base64Converter"}),e()}}const fe=Z(()=>[{meta:[[v.SYMBOL,I.DIRECTORY],[v.WINDOW_SIZE,m(380,200)],[v.WINDOW_SYMBOL_REARRANGE,!0]],id:"BasicDemos",name:"Basic Demos",createdDate:new Date(2017,7,5).getTime(),editedDate:new Date(2020,3,14).getTime(),items:[{meta:[[v.SYMBOL,I.BASIC]],id:"TEST.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:['PRINT USING "# #"; 1,2']}},{meta:[[v.SYMBOL,I.BASIC]],id:"FunctionTest.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:['PRINT USING "LEN(\\"ABC\\") #"; LEN("ABC")','PRINT USING "ASC(\\"D\\") ##"; ASC("D")','PRINT USING "CHR$(68) ##"; CHR$(68)','PRINT USING "LEFT$(\\"XYZ\\", LEN(\\"XYZ\\")-1) #"; LEFT$("XYZ", LEN("XYZ")-1)','PRINT USING "RIGHT$(\\"XYZ\\", LEN(\\"XYZ\\")-1) #"; RIGHT$("XYZ", LEN("XYZ")-1)']}},{meta:[[v.SYMBOL,I.BASIC]],id:"Fibonacci.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["CLS","READ max","DIM fib%(max)","LET fib(1) = 1","LET fib(2) = 2","FOR i=3 TO max","LET fib(i) = fib(i - 2) + fib(i -1)","NEXT i","FOR i=1 TO max","PRINT fib(i)","NEXT i","DATA 10","END"]}},{meta:[[v.SYMBOL,I.BASIC]],id:"Area.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["CLS","DIM w%,h%,a%","LET w%=12","LET h%=4","LET a%=w%*h%",'PRINT "With the width " + w%','PRINT " and the height " + h%','PRINT " you have the area " + a%']}},{meta:[[v.SYMBOL,I.BASIC]],id:"Circle.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["CLS","DIM r,a","LET r=5","READ pi","LET a=r*r*pi",'PRINT USING "With the radius ##.##"; r','PRINT USING "we have the area ##.##"; a',"DATA 3.14","END"]}},{meta:[[v.SYMBOL,I.BASIC]],id:"Your_Name.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["CLS",'PRINT "What is your name?"',"INPUT n$",'PRINT "What is your shoe size?"',"INPUT size",'PRINT "Hello "; n$','PRINT USING "your shoe size is ##.##"; size',"END"]}},{meta:[[v.SYMBOL,I.BASIC]],id:"GuessTheNumber.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["GuessTheNumber","CLS","READ max%","DIM number%, guess%, guesses%, message$",'LET message$ =  ""','PRINT "The number is between 1-1000."',"LET number% = INT(RND * max%) + 1","LET guess% = 1","LET guesses% = 0","WHILE guess%<>number%",'PRINT "Guess the number"',"PRINT message$","INPUT message$ guess%","IF (guess%<>number%) THEN","IF (guess%>number%) THEN",'LET message$ = "Your guess was too high"',"ELSE",'LET message$ =  "Your guess was too low"',"ENDIF","ENDIF","LET guesses% = guesses% + 1","WEND",'PRINT USING "You found the number in # tries"; guesses%',"DATA 1000","END"]}},{meta:[[v.SYMBOL,I.BASIC]],id:"Factorial.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["DIM result, n",'PRINT "Calculate the factorial of"',"INPUT n","LET result = 1","FOR i = n TO 1 STEP -1","LET result = result * i","NEXT i",'PRINT USING "#! = #"; n, result',"END"]}},{meta:[[v.SYMBOL,I.BASIC]],id:"Pyramid.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["CLS","DIM stars$",'PRINT "Enter the height of the pyramid"',"INPUT height",'LET stars$ = ""',"FOR i = 1 TO height",'LET stars$ = ""',"FOR j = 1 TO (i+i-1)",'LET stars$ = stars$ + "*"',"NEXT j","PRINT SPC(height - i) + stars","NEXT i","END"]}},{meta:[[v.SYMBOL,I.BASIC]],id:"Bubble_Sort.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["CLS","READ max","DIM SHARED numbers(max)","SUB CreateList(max) STATIC","FOR i=1 TO max","LET numbers(i) = INT(RND * 100)","NEXT i","END SUB","SUB PrintList(max) STATIC","FOR i=1 TO max","PRINT numbers(i)","NEXT i","END SUB","SUB SwapValues(i%, j%) STATIC","LET numbers(i%) = numbers(i%) XOR numbers(j%)","LET numbers(j%) = numbers(i%) XOR numbers(j%)","LET numbers(i%) = numbers(i%) XOR numbers(j%)","END SUB","SUB Sort(max) STATIC","FOR i%=1 TO (max - 1)","FOR j%=i% TO max","IF numbers(i%)>numbers(j%) THEN","CALL SwapValues(i, j)","END IF","NEXT j%","NEXT i%","END SUB","CreateList(max)","Sort(max)","PrintList(max)","DATA 10","END"]}},{meta:[[v.SYMBOL,I.BASIC]],id:"Goto.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:['PRINT "Step 1"','PRINT "Step 2"','PRINT "Step 3"',"GOTO ignore",'PRINT "Step 4"',"ignore:",'PRINT "Step 5"']}},{meta:[[v.SYMBOL,I.BASIC]],id:"Vars.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["DIM A, B","LET A = 2000",'LET B = "Hello World"','PRINT USING "A: #"; A','PRINT USING "B: #"; B']}},{meta:[[v.SYMBOL,I.BASIC]],id:"If.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["DIM A, B","LET A = 1","LET B = 2","IF A == B THEN",'PRINT "true"',"ELSE",'PRINT "false"',"END","IF (A < B) THEN",'PRINT "true"',"END"]}},{meta:[[v.SYMBOL,I.BASIC]],id:"For.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["DIM i%","FOR i% = 1 TO 5",'PRINT USING "For Number #"; i%',"NEXT i%"]}},{meta:[[v.SYMBOL,I.BASIC]],id:"For_Step.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["CLS","FOR i% = 0 TO 6 STEP 2",'PRINT "For Step Number #"; i%',"NEXT i%"]}},{meta:[[v.SYMBOL,I.BASIC]],id:"While.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["DIM i%","LET i%=0","WHILE i% < 5",'PRINT USING "While Number #"; i%',"LET i% = i% + 1","WEND"]}},{meta:[[v.SYMBOL,I.BASIC]],id:"Pause.bas",data:{[N.HAS_WINDOW_OUTPUT]:!0,[b.OUTPUT_TYPE]:"basic",[b.CONTENT]:["DIM duration","LET duration = 2500",'PRINT USING "Start with Pause #ms"; duration',"PAUSE duration",'PRINT "End Pause"','PRINT USING "Start with Sleep #ms"; duration',"PAUSE duration",'PRINT "End Sleep"']}}]}]),ge=Z(({core:n})=>{let t,e;return[{meta:[[v.SYMBOL,M.GUEST_BOOK]],id:"GuestBook.app",name:"GuestBook",createdDate:new Date(2025,5,17).getTime(),editedDate:new Date(2025,5,17).getTime(),async action(){var S,D;const i=n.addExecution(),a=`# Guest Book
Feel free to leave a message, share your thoughts, or just say hello.
Your words mean a lot and help make this space more personal and memorable.
Thanks for stopping by!`,l="## A collection of entries left by our visitors.",o=V({isLocked:!1,options:{fileItemPath:"CDGUESTBOOK:data.json"},entries:[],selectedEntries:[]});let d;try{d=await p()}catch(f){throw console.error(f),new Error("GuestBook file not found. Please setup storage first.")}o.isLocked=d.isLocked();async function p(){var y;const f=await((y=n.modules.files)==null?void 0:y.fs.get(o.options.fileItemPath));if(!f)throw new Error("File not found");return f}async function u(){return d.data.content}async function g(){const f=n.addExecution(),y=await u();o.entries=y,f()}o.actions={close:()=>{E==null||E.close()},openInfo:()=>s(o),setOptions:f=>{Object.assign(o.options,f)},setupStorage:be(n,o),updateStorage:async()=>{var y;const f=n.addExecution();try{const T=await((y=n.modules.files)==null?void 0:y.fs.get(o.options.fileItemPath));T&&(T.data={type:"json",content:o.entries},await q(T),await g(),f())}catch(T){throw f(),T}},import:async f=>{var T;const y=n.addExecution();try{const U=JSON.parse(await f.text()),X=await((T=n.modules.files)==null?void 0:T.fs.get(o.options.fileItemPath));X&&(X.data={type:"json",content:U},await q(X),await g()),y()}catch(U){throw y(),U}},export:async()=>{const f=n.addExecution(),y=await R(()=>import("./CshrRwMP.js").then(T=>T.F),__vite__mapDeps([56,57]),import.meta.url).then(T=>T.default);try{const T=new Blob([JSON.stringify(o.entries)],{type:"application/json;charset=utf-8"});await y.saveAs(T,`${xt(new Date)}_guest_book.json`),f()}catch(T){throw f(),T}},writeEntry:async()=>{r(o)},addEntry:async f=>{const y=n.addExecution(),T=await(await St.getFunction("guestBookAdd"))({entry:f}),U=T.data.entry;if(T.data.error)throw y(),new Error(T.data.error);U&&(o.entries.push(U),y(),await n.executeCommand(`openDialog "Thank you for your entry!
Your message has been successfully submitted and will appear in the guestbook shortly."`)),e==null||e.close()},editEntry:async()=>{},setSelectedEntries:f=>{o.selectedEntries=f},publishEntries:(f,y)=>{f.forEach(T=>{o.entries.find(U=>U.id===T).published=y}),o.selectedEntries=[]},removeEntries(f){o.entries=o.entries.filter(y=>!f.includes(y.id)),o.selectedEntries=[]},truncate:async()=>{var f;if(await n.executeCommand('openDialog --confirm "Really empty the guestbook?"')){const y=n.addExecution();o.entries=[],o.selectedEntries=[];const T=await((f=n.modules.files)==null?void 0:f.fs.get(o.options.fileItemPath));T&&(T.data={type:"json",content:[]},await q(T)),y()}}},await g();const E=(S=n.modules.windows)==null?void 0:S.addWindow({layout:{size:m(480,320),position:m(0,0)},component:await R(()=>import("./tGj6k1aL.js"),__vite__mapDeps([58,59,7,6,8,9,10,60,11,23,33,34,61,62,53,54,27,63,50,51,64,65,66,67]),import.meta.url).then(f=>f.default),componentData:{model:o,introContent:a,listContent:l},options:{title:"GuestBook",scale:!0,scrollX:!1,scrollY:!0,filled:!0}},{group:"extras13GuestBook"});E&&((D=n.modules.windows)==null||D.contentWrapper.setWindowPositions(st.FULL,[E],{embed:!0}),focus(),E.awaitClose().then(()=>{})),i()}}];async function s(i){var a;return t||(t=(a=n.modules.windows)==null?void 0:a.addWindow({component:await R(()=>import("./BqjXW8nl.js"),__vite__mapDeps([68,33,7,6,8,9,10,34,59,60,11,23,69]),import.meta.url).then(async l=>l.default),componentData:{model:i},options:{title:"Info",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}},{group:"extras13GuestBook"}),t==null||t.awaitClose().then(()=>{t=void 0}),t)}async function r(i){var a;return e||(e=(a=n.modules.windows)==null?void 0:a.addWindow({layout:{size:m(480,320)},component:await R(()=>import("./COjWThCl.js"),__vite__mapDeps([70,59,7,6,8,9,10,60,11,23,12,13,71,50,51,72,49,52,61,62,53,54,33,34,73]),import.meta.url).then(async l=>l.default),componentData:{model:i},options:{title:"Entry",scale:!0,scroll:!1}},{group:"extras13GuestBook"}),e==null||e.awaitClose().then(()=>{e=void 0}),e)}});function be(n,t){return async()=>{const e=t.options.fileItemPath,s=await n.executeCommand(`exist "${e}"`),r=window.btoa(JSON.stringify({type:"json",content:[]}));let i=!1;if(s&&(i=await n.executeCommand('openDialog "File exist, overwrite?" --confirm')),!s||i){const a=[`makefile "${e}"`];return r&&a.push(`--data="${r}"`),i&&a.push("--override"),n.executeCommand(a.join(" "))}}}const ye=vt(async({core:n})=>{var t;return n.config.setDefaults(ue()),n.config.setDefaults(de()),(t=n.modules.symbols)==null||t.addSymbols([{key:M.DISK_EXTRAS13,component:await R(()=>import("./BsCJS5O6.js"),__vite__mapDeps([74,6]),import.meta.url).then(e=>e.default),group:"disk_extras13"},{key:M.WEB_BASIC,component:await R(()=>import("./CINvwvLw.js"),__vite__mapDeps([75,6]),import.meta.url).then(e=>e.default),group:"disk_extras13"},{key:M.WEB_PAINTING,component:await R(()=>import("./DbNc_bDN.js"),__vite__mapDeps([76,6]),import.meta.url).then(e=>e.default),group:"disk_extras13"},{key:M.GUEST_BOOK,component:await R(()=>import("./DWpE5pJp.js"),__vite__mapDeps([77,6]),import.meta.url).then(e=>e.default),group:"disk_extras13"}]),{locked:!0,meta:[[v.SYMBOL,M.DISK_EXTRAS13],[v.WINDOW_SIZE,m(320,220)],[v.WINDOW_POSITION,m(310,10)],[v.WINDOW_SYMBOL_REARRANGE,!0]],name:"Extras 1.3",items:[{id:"Tools",name:"Tools",meta:[[v.WINDOW_SIZE,m(160,120)],[v.WINDOW_SYMBOL_REARRANGE,!0]],createdDate:new Date(2024,8,9).getTime(),editedDate:new Date(2024,8,9).getTime(),items:[{meta:[[v.SYMBOL,I.DEFAULT]],id:"Base64Converter.app",name:"Base64Converter",createdDate:new Date(2023,8,4).getTime(),editedDate:new Date(2023,8,4).getTime(),action:me(n)}]},...await ce({core:n}),...await pe({core:n}),...await fe({core:n}),...await ge({core:n})]}}),Fe=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"}));export{F as B,w as C,oe as D,le as P,G as a,ft as b,b as c,Fe as i};
