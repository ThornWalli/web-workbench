var e,t=Object.defineProperty,__typeError=e=>{throw TypeError(e)},__publicField=(e,n,o)=>((e,n,o)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o)(e,"symbol"!=typeof n?n+"":n,o),__privateGet=(e,t,n)=>(((e,t,n)=>{t.has(e)||__typeError("Cannot "+n)})(e,t,"read from private field"),n?n.call(e):t.get(e));import{i as n,o}from"./BHmTNEz3.js";import{R as i}from"./D6fwdpc8.js";import{d as a}from"./DdO-3S9B.js";import{S as s,a as l,b as r,c as u,d as c,W as m}from"./KaHav87i.js";import{S as v}from"./DDPzVXKz.js";import{y as f,z as p,A as d,d as h,r as y,a7 as w,k as b,o as k,a1 as x,W as g,a0 as j,F as C,D as M,I,R as z,P as T,G as O,C as S,B as E,$ as _,_ as R}from"./BfpYGSxR.js";import{i as H}from"./BSzGBLGV.js";import{b as D,a as F,p as K}from"./D1WZfvAb.js";import{S as L}from"./BB6FUOrg.js";import{S as W}from"./v8FPNFzi.js";import{i as A}from"./B1k18Rg6.js";import{S as B}from"./CrNGlbV0.js";import{f as V}from"./D3xLGof4.js";import"./B-meQdOw.js";import"./D3MPJlJW.js";import"./D7Us3e3D.js";import"./CV0dHcg-.js";import"./Cy0zoxeo.js";import"./CIasQYz1.js";import"./Caivkp23.js";import"./DL1FsYWj.js";import"./tbUmQ5LT.js";import"./BfgCdWpr.js";import"./jSR9Z_uS.js";let P;e=new WeakMap;const $=P||(P=new class Viewport{constructor(){var t,o,a;__publicField(this,"screenSize",n(0,0)),t=this,o=e,a=new i(0),o.has(t)?__typeError("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(t):o.set(t,a),window.addEventListener("resize",this.onResize.bind(this),!1)}destroy(){window.removeEventListener("resize",this.onResize.bind(this),!1)}onResize(){this.screenSize=n(window.innerWidth,window.innerHeight)}getElementSize(e){return n(e.offsetWidth,e.offsetHeight)}get resize(){return __privateGet(this,e)}}),G={xmlns:"http://www.w3.org/2000/svg",width:"6",height:"10"};const U={render:function render(e,t){return p(),f("svg",G,t[0]||(t[0]=[d("path",{d:"M0 0h2v2h2v2h2v2H4v2H2v2H0z",class:"svg-primary"},null,-1)]))}},N=["type","name","value","checked"],X={key:1,class:"checkbox"},q={class:"title"},J={key:2,class:"hotkey"},Q={key:3,class:"indicator-context"},Y=R(h({__name:"MenuItem",props:{item:{},parentLayout:{},tag:{},direction:{},core:{}},emits:["click","update:model-value"],setup(e,{expose:t,emit:i}){const h=y(A()),R=w("closeContextMenu",()=>{});t({closeContextMenu:R});const P={size:$.screenSize};const G=b(()=>{const e=Z.item;return e.type===D.CUSTOM?e.options.checked:pe.value?e.getValue()===e.value:!!e.getValue()}),Y=b(()=>Z.item.items.filter(e=>!(e instanceof L||e instanceof W||e.options.disabled)).length>0),Z=e,ee=i,te=y(),ne=y(),oe=y(),ie=y(!1),ae=y(!1),se=y(!1),le=y(n(2,3)),re=new B,ue=b(()=>Z.item instanceof F&&Z.item.type===D.RADIO?"radio":"checkbox"),ce=b(()=>{if(Z.item instanceof F){const e=Z.item.type;return void 0!==e&&[D.CUSTOM,D.CHECKBOX,D.RADIO].includes(e)}return!1}),me=b(()=>Z.item instanceof F&&void 0!==Z.item.name&&Z.item.name.length>0),ve=b(()=>{if(Z.item instanceof F)return Z.item.title||""}),fe=b(()=>{if(Z.item instanceof F)return Z.item.hotKey}),pe=b(()=>Z.item instanceof F&&Z.item.type===D.RADIO),de=b(()=>me.value?"label":Z.item instanceof F&&Z.item.url?"a":"button"),he=b(()=>{const e={class:"inner",is:void 0};return me.value?e.is="label":Z.item instanceof F&&Z.item.url&&(e.is="a",e.href=Z.item.url),e}),ye=b(()=>({focused:ie.value,"force-visible":ae.value,"context-ready":se.value,"context-halign-left":0===le.value.x,"context-halign-right":2===le.value.x,"context-valign-top":1===le.value.y,"context-valign-bottom":3===le.value.y,disabled:we.value})),we=b(()=>Z.item instanceof F&&(!Z.item.action&&(!Y.value&&oe.value||be.value.disabled)||Z.item.action&&be.value.disabled)),be=b(()=>Z.item.options);function onInputContextMenu(e,t){ee("update:model-value",e,t)}function onInput(e){if(!(Z.item instanceof F))return;let t;const n=e.target;t=pe.value?null==n?void 0:n.value:null==n?void 0:n.checked,H(t)?Z.item.setValue(Number(t)):Z.item.setValue(t),ee("update:model-value",Z.item.name||"",t),"function"==typeof Z.item.action&&Promise.resolve(Z.item.action({closeContextMenu:R,value:t})).catch(e=>{throw e})}async function onClick(e){var t;if(""===e.pointerType&&oe.value&&Y.value&&!se.value&&ie.value)onTouchstart();else if(Z.item instanceof F&&!me.value&&"function"==typeof Z.item.action)try{await Z.item.action({closeContextMenu:R})}catch(n){console.error(n),null==(t=Z.core)||t.errorObserver.next(n)}else ee("click",e)}async function onClickInput(e){var t;if(Z.item instanceof F&&!ce.value&&"function"==typeof Z.item.action)try{await Z.item.action({closeContextMenu:R})}catch(n){console.error(n),null==(t=Z.core)||t.errorObserver.next(n)}else ee("click",e)}function onTouchstart(){se.value||(ae.value=!0),onMouseOver()}function onMouseOver(){se.value||(se.value=!0,x(()=>{window.setTimeout(()=>{if(oe.value&&oe.value.$el instanceof HTMLElement){const e=oe.value.$el.getBoundingClientRect(),{size:t,position:i}=Z.parentLayout||P,a=o(()=>n(e.left,e.top)-(i.x>0?i:0)+n(e.width,e.height)),s="bottom"===(Z.direction||"bottom");le.value=n(t.x<a.x?0:2,t.y-2<=a.y?s?1:3:s?3:1)}ae.value=!1},0)}))}k(()=>{x(()=>{Z.item instanceof F&&Z.item.hotKey&&re.add(a.keyDown.pipe(V(e=>!!(Z.item instanceof F&&Z.item.hotKey&&a.resolveHotKey(Z.item.hotKey,e)))).subscribe(e=>{e.preventDefault(),async function executeAction(){var e;if(Z.item instanceof F&&"function"==typeof Z.item.action)try{await Z.item.action({closeContextMenu:R})}catch(t){console.error(t),null==(e=Z.core)||e.errorObserver.next(t)}else te.value.click()}()}))})}),g(()=>{re.unsubscribe()});const ke=w("addItemFocus"),xe=w("removeItemFocus"),onFocus=()=>{ie.value=!0,ke&&ke(Z.item.id)},ge=b(()=>{var e;return(null==(e=oe.value)?void 0:e.hasFocusedItem)||!1});let je=-1;j(()=>ge.value,e=>{window.clearTimeout(je),je=window.setTimeout(()=>{e||onBlur()},0)});let Ce=-1;const onBlur=()=>{window.clearTimeout(Ce),Ce=window.setTimeout(()=>{ge.value||(ie.value=!1,xe&&xe(Z.item.id))})};return(e,t)=>(p(),C(z(e.tag),{class:_(["wb-env-element-context-menu-item",ye.value])},{default:M(()=>[(p(),C(z(de.value),T({ref_key:"clickEl",ref:te,disabled:we.value},he.value,{onFocus:onFocus,onBlur:onBlur,onClick:onClick,onPointerover:onMouseOver,onTouchstart:onTouchstart}),{default:M(()=>[e.item instanceof O(F)&&ce.value?(p(),f("input",{key:0,ref_key:"inputEl",ref:ne,type:ue.value,name:e.item.name,value:e.item.value,checked:G.value,onFocus:onFocus,onBlur:onBlur,onClick:onClickInput,onInput:onInput},null,40,N)):I("",!0),ce.value?(p(),f("span",X,[S(O(v))])):I("",!0),d("span",q,E(ve.value),1),fe.value?(p(),f("span",J,[fe.value.shift?(p(),C(O(s),{key:0})):I("",!0),!h.value&&fe.value.alt?(p(),C(O(l),{key:1})):fe.value.alt?(p(),C(O(r),{key:2})):I("",!0),h.value&&(fe.value.ctrl||fe.value.cmd)?(p(),C(O(u),{key:3})):fe.value.ctrl||fe.value.cmd?(p(),C(O(c),{key:4})):I("",!0),d("span",null,E(fe.value.title),1)])):I("",!0),e.item.items.length>0?(p(),f("span",Q,[S(O(U))])):I("",!0)]),_:1},16,["disabled"])),e.item.items.length>0?(p(),C(m,{key:0,ref_key:"contextMenuEl",ref:oe,core:e.core,items:O(K)(e.item.items),"parent-layout":e.parentLayout,onInput:onInputContextMenu},null,8,["core","items","parent-layout"])):I("",!0)]),_:1},8,["class"]))}}),[["__scopeId","data-v-2f960c16"]]);export{Y as default};
