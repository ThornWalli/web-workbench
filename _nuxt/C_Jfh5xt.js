import{j as v,k as f,u as _,C as T}from"./Du0A51LY.js";import{N as y,M as C,a as N}from"./CeSWKK91.js";import{g as w,T as g}from"./DQ4Ydzfo.js";import{T as x,c as E}from"./D7TN0DGP.js";import{C as m}from"./DpxbTjKm.js";import{N as b,u as $}from"./D8G6shPs.js";import{T as M}from"./jnGIE6hS.js";import{_ as P,a5 as R,S,i as l,t as i,v as n,z as u,N as d,ae as h,x as p,I as V,$ as j,a0 as D,E as I}from"./W6mklecM.js";import"./CTgiTu_k.js";import"./BQKrHkZO.js";import"./B3RG9ns7.js";import"./5AlEq6BG.js";import"./CwtkfxaN.js";window.NoteDescription=y;const z={components:{Navigation:b,SynthesizerTimelineCanvas:M},props:{...v,model:{type:Object,required:!0}},emits:[...f,"refresh"],async setup(e,t){const s=R(e,"model"),r=_(e,t);return S(s,()=>{r.setContextMenu(E,{model:s.value,preserveContextMenu:r.preserveContextMenu})},{immediate:!0,deep:!0}),{...r,...await $()}},data:function(){return{toneDestination:null,tracksEdit:{}}},computed:{timelineRefreshKey(){return`timeline-${this.bpm}`},project(){return this.model[m.SYNTHESIZER_PROJECT]},tracks:{get(){return this.project.tracks},set(e){this.project.tracks=e}},bpm(){return Number(this.model[m.SYNTHESIZER_BPM])},controlsNavigation(){return{model:this.model,items:[[{text:`Project: ${this.project.name} | Tracks: ${this.tracks.length}`}]]}},masterVolume(){return this.core.config.observable[T.SCREEN_CONFIG].soundVolume},decibelValue(){return w(this.masterVolume)}},watch:{masterVolume:{handler(){C.volume.value=this.decibelValue},immediate:!0},tracks(){this.$nextTick(()=>{this.$emit("refresh")})},bpm:{handler(e){const t=this.tone.transport;t.stop(),t.bpm.value=120,t.seconds=0,t.bpm.value=e,t.start()}}},mounted(){this.$nextTick(()=>{console.log(this.tracks),this.editTrack(this.tracks[0],{})}),this.$nextTick(()=>{this.$emit("refresh")})},unmounted(){this.model.actions.closeTracks()},methods:{async onClickPlay(){await this.tone.start(),this.players=this.tracks.map(s=>{const r=new x(s,{autoplay:!1});return r.createInstrument("Synth"),r});const e=N;e.stop(),e.seconds=0,e.start(),this.players.map(s=>s.play()).map(s=>s.start(0))},getControls(e){const t=e.getDuration();return{items:[{text:e.name},{spacer:!0},{text:` ${t}`},{label:"Edit",onClick:async()=>{await this.tone.start(),this.editTrack(new g(e),{toneDestination:this.toneDestination})}},{label:"Remove",onClick:async()=>{this.preserveContextMenu(!0),await this.model.actions.removeTrack(e),this.preserveContextMenu(!1),this.$emit("refresh")}}]}},async editTrack(e){this.tracksEdit[e.id]=!0;const{close:t}=this.model.actions.editTrack(e),s=await t;this.tracks=this.tracks.map(r=>r.id===s.id?s:r),this.tracksEdit[e.id]=!1,this.$nextTick(()=>{this.$emit("refresh")})}}},B={class:"wb-disks-extras13-synthesizer-project"},F={class:"tracks"},O={key:0,class:"no-tracks"},q={class:"sheet"};function G(e,t,s,r,A,a){const c=l("navigation"),k=l("synthesizer-timeline-canvas");return i(),n("div",B,[u(c,d(h(a.controlsNavigation)),null,16),p("div",F,[a.tracks.length<1?(i(),n("div",O,"No tracks availableâ€¦")):V("",!0),(i(!0),n(j,null,D(a.tracks,o=>(i(),n("div",{key:o.id,class:"track"},[u(c,d(h(a.getControls(o))),null,16),p("div",q,[(i(),I(k,{key:a.timelineRefreshKey,track:o,static:e.tracksEdit[o.id],onRefresh:t[0]||(t[0]=H=>e.$emit("refresh"))},null,8,["track","static"]))])]))),128))])])}const ae=P(z,[["render",G],["__scopeId","data-v-ada6e466"]]);export{ae as default};
