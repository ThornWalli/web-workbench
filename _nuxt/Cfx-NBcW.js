const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DaABP5qE.js","./CUBEHUBp.js","./DJKZOqNp.js","./BxO05Tpb.js","./DxhK5Oma.js"])))=>i.map(i=>d[i]);
var Zn=Object.defineProperty;var tn=r=>{throw TypeError(r)};var Gn=(r,e,t)=>e in r?Zn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var p=(r,e,t)=>Gn(r,typeof e!="symbol"?e+"":e,t),nn=(r,e,t)=>e.has(r)||tn("Cannot "+t);var m=(r,e,t)=>(nn(r,e,"read from private field"),t?t.call(r):e.get(r)),_=(r,e,t)=>e.has(r)?tn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),A=(r,e,t,n)=>(nn(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);import{a as Xn,o as Kn,i as kn,b as Qn,d as Jn,g as P,f as sn}from"./BxO05Tpb.js";import{a as nt,E as F,I as y,e as w,b as U,k as ei,d as Tt,g as ti,r as vn,f as _n,h as ni,S as K,j as _t,l as Y,m as Re,C as ii,n as si,o as ie,s as J,p as ri,q as ai,t as oi,u as jt,v as li,c as ci,w as ui}from"./DwAjpAW9.js";import{v as In,C as hi,u as Ee,M as ot}from"./CnA96g1w.js";import{V as Ae,I as R,r as It,a8 as Sn,_ as ce,t as I,v as O,x as $,G as di,Y as fi,g as C,z as E,A as oe,C as ne,F as H,L as q,i as pi,$ as Ot,a0 as Ft,y as $t,H as St}from"./DnjntUSc.js";import{c as mi,a as An}from"./C5mdboMC.js";import{W as it,a as gi,b as wt,c as yt,d as En,e as xi}from"./uH2aNKgc.js";import{a as Cn,m as At,f as bi}from"./PIkGlXJS.js";var Dn={now:function(){return(Dn.delegate||Date).now()},delegate:void 0},Kr=function(r){Xn(e,r);function e(t,n,i){t===void 0&&(t=1/0),n===void 0&&(n=1/0),i===void 0&&(i=Dn);var s=r.call(this)||this;return s._bufferSize=t,s._windowTime=n,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,t),s._windowTime=Math.max(1,n),s}return e.prototype.next=function(t){var n=this,i=n.isStopped,s=n._buffer,a=n._infiniteTimeWindow,l=n._timestampProvider,o=n._windowTime;i||(s.push(t),!a&&s.push(l.now()+o)),this._trimBuffer(),r.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(t),i=this,s=i._infiniteTimeWindow,a=i._buffer,l=a.slice(),o=0;o<l.length&&!t.closed;o+=s?1:2)t.next(l[o]);return this._checkFinalizedStatuses(t),n},e.prototype._trimBuffer=function(){var t=this,n=t._bufferSize,i=t._timestampProvider,s=t._buffer,a=t._infiniteTimeWindow,l=(a?1:2)*n;if(n<1/0&&l<s.length&&s.splice(0,s.length-l),!a){for(var o=i.now(),c=0,u=1;u<s.length&&s[u]<=o;u+=2)c=u;c&&s.splice(0,c+1)}},e}(nt);function fe(r){r===void 0&&(r={});var e=r.connector,t=e===void 0?function(){return new nt}:e,n=r.resetOnError,i=n===void 0?!0:n,s=r.resetOnComplete,a=s===void 0?!0:s,l=r.resetOnRefCountZero,o=l===void 0?!0:l;return function(c){var u,h,d,f=0,g=!1,k=!1,b=function(){h==null||h.unsubscribe(),h=void 0},N=function(){b(),u=d=void 0,g=k=!1},D=function(){var M=u;N(),M==null||M.unsubscribe()};return Kn(function(M,ue){f++,!k&&!g&&b();var Q=d=d??t();ue.add(function(){f--,f===0&&!k&&!g&&(h=Et(D,o))}),Q.subscribe(ue),!u&&f>0&&(u=new kn({next:function(V){return Q.next(V)},error:function(V){k=!0,b(),h=Et(N,i,V),Q.error(V)},complete:function(){g=!0,b(),h=Et(N,a),Q.complete()}}),Cn(M).subscribe(u))})(c)}}function Et(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];if(e===!0){r();return}if(e!==!1){var i=new kn({next:function(){i.unsubscribe(),r()}});return Cn(e.apply(void 0,Qn([],Jn(t)))).subscribe(i)}}const wi=P(0,0);class rn{constructor({title:e,sidebarComponent:t,sidebarComponentData:n,component:i,componentData:s,options:a,symbolWrapper:l,wrapper:o,layout:c,parentWindow:u}){p(this,"events",new nt);p(this,"id",In());p(this,"component");p(this,"componentData");p(this,"sidebarComponent");p(this,"sidebarComponentData");p(this,"parentWindow");p(this,"options",Ae({title:"Unnamed",scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0,clampX:!0,clampY:!1,freeze:!1,focused:!1,center:!0,close:!0,overlay:!0,embed:!1,borderless:!1,hideRootHeader:!1,sidebar:!0}));p(this,"symbolWrapper",null);p(this,"group",null);p(this,"wrapper",null);p(this,"layout",Ae({focused:!1,position:P(0,0),size:wi,scrollOffset:P(0,0)}));this.options.title=e,this.parentWindow=u,t&&(this.sidebarComponent=R(t)),n&&(this.sidebarComponentData=R(n)),this.component=R(i),this.componentData={...s,window:this},l&&(this.symbolWrapper=R(l)),o&&(this.wrapper=R(o)),this.options=Object.assign(this.options,a),this.layout=Object.assign(this.layout,c)}ready(){this.options.ready=!0,this.events.next(new F("ready"))}focus(){this.options.focused=!0,this.events.next(new F("focus"))}unfocus(){this.options.focused=!1,this.events.next(new F("unfocus"))}close(e){this.wrapper&&(this.events.next(new F("close",e)),this.wrapper.remove(this.id),this.wrapper=null)}setWrapper(e){this.wrapper=R(e)}setGroup(e){this.group=e}awaitClose(){return new Promise(e=>{const t=this.events.pipe(sn(({name:n})=>n==="close")).subscribe((...n)=>{t.unsubscribe(),e(...n)})})}awaitReady(){return new Promise(e=>{if(this.options.ready)e();else{const t=this.events.pipe(sn(({name:n})=>n==="ready")).subscribe((...n)=>{t.unsubscribe(),e(...n)})}})}}const he={CENTER:0,ORDER_HORIZONTAL:1,ORDER_VERTICAL:2,ORDER_DIAGONAL_LEFT:3,ORDER_DIAGONAL_RIGHT:4,SPLIT_HORIZONTAL:5,SPLIT_VERTICAL:6,FULL:7};class Qr{constructor(e,t=[]){p(this,"events",new nt);p(this,"id",In());p(this,"core");p(this,"layout",{size:P(0,0),position:P(0,0)});p(this,"groups",new Map);p(this,"modelMap",new Map);p(this,"models",It([]));p(this,"activeWindow",It(null));this.core=e,t.forEach(n=>this.add(n))}getActiveWindow(){return this.models.value.find(e=>e.options.focused)}setActiveWindow(e){this.models.value.forEach(t=>{t.options.focused=e===t.id,e===t.id&&(this.activeWindow.value=t,this.events.next(new F("setActiveWindow",t)))})}hasEmbbedWindow(){return!!this.models.value.find(e=>e.options.embed)}isHeaderVsible(){return!this.models.value.find(e=>e.options.embed&&e.options.hideRootHeader)}add(e,t){const{full:n,active:i,group:s}={full:!1,active:!0,group:null,...t};if(e instanceof rn||(e=new rn(e)),e.setWrapper(this),n&&(e.layout.size=this.layout.size),s){let a;this.groups.has(s)?(a=this.groups.get(s),a.windows.push(e)):(a={primary:e,windows:[],name:s},this.groups.set(s,a)),e.setGroup(a)}return e.layout.zIndex=this.models.value.length,this.models.value.push(e),this.events.next(new F("add",e)),this.modelMap.set(e.id,e),i&&this.setActiveWindow(e.id),e}remove(e){typeof e=="string"&&(e=this.get(e)),e.group&&(e.group.primary===e?(e.group.windows.forEach(t=>t.close()),this.groups.delete(e.group.name)):e.group.primary.focus()),this.models.value.splice(this.models.value.indexOf(e),1),this.modelMap.delete(e.id)}get(e){return this.modelMap.get(e)}clear(){this.models=It([].splice(0,this.models.value.length)),this.modelMap.clear()}setWindowUpDown(e,t){const n=this.models.value,i=Array.from(n).filter(o=>!o.options.embed).sort((o,c)=>o.layout.zIndex-c.layout.zIndex).map(Sn),s=this.get(e),a=i.indexOf(s),l=i[t?a-1:a+1];if(l){const o=s.layout.zIndex;s.layout.zIndex=l.layout.zIndex,l.layout.zIndex=o}}centerWindow(e){typeof e=="string"&&(e=this.get(e)),Pt(e,this.layout)}setWindowPositions(e,t=[],n){const{embed:i}={embed:!1,...n};switch(t.length<1&&t.push(...this.models.value),i||(t=t.filter(s=>!s.options.embed)),e){case he.FULL:t.forEach(s=>{yi(s,this.layout)});break;case he.CENTER:t.forEach(s=>{Pt(s,this.layout)});break;case he.ORDER_DIAGONAL_LEFT:case he.ORDER_DIAGONAL_RIGHT:ki(t,this.layout,he.ORDER_DIAGONAL_RIGHT===e);break;case he.SPLIT_HORIZONTAL:case he.SPLIT_VERTICAL:vi(t,this.layout,he.SPLIT_VERTICAL===e);break}}saveSize(e,t){if(this.get(e).symbolWrapper&&this.get(e).symbolWrapper.fsItem){const n=this.get(e).symbolWrapper.fsItem;n.meta.set(y.WINDOW_SIZE,t),this.core.modules.files.fs.saveItem(n)}}savePosition(e,t){if(this.get(e).symbolWrapper&&this.get(e).symbolWrapper.fsItem){const n=this.get(e).symbolWrapper.fsItem;n.meta.set(y.WINDOW_POSITION,t),this.core.modules.files.fs.saveItem(n)}}}function yi(r,e){r.layout.size=e.size}function Pt(r,e){r.layout.position=P(()=>(e.size-r.layout.size)/2)}function ki(r,e,t){const n=1/r.length;r.forEach((i,s)=>{Pt(i,e),s=-Math.floor(r.length/2)+s;const a=P(i.layout.position.x+(t?-1:1)*(n*i.layout.size.x)*s,i.layout.position.y+n*i.layout.size.y*s),l=P(()=>e.size-i.layout.size);i.layout.position=P(()=>Math.max(Math.min(a,l),0))})}function vi(r,e,t){let n;const i=r.length;t?(n=P(e.size.x,e.size.y/i),r.forEach((s,a)=>{s.layout.position=P(0,a*n.y),s.layout.size=n})):(n=P(e.size.x/i,e.size.y),r.forEach((s,a)=>{s.layout.position=P(a*n.x,0),s.layout.size=n}))}class _i{constructor(e){p(this,"items",[]);p(this,"itemsMapping",new Map);p(this,"key");this.key=e}add(e){e.forEach(t=>{[].concat(t[this.key]).forEach(n=>{this.itemsMapping.set(n,t)})}),this.items.push(...e)}remove(e){e.forEach(t=>{this.items.splice(this.items.indexOf(t),1)})}has(e){return this.itemsMapping.has(e)}get(e){return this.itemsMapping.get(e)}}class Ii extends _i{constructor(){super("name")}}const Si=new Ii;var ze,Ne,ke,je;class Ai{constructor({name:e,description:t,args:n,action:i}){_(this,ze);_(this,Ne);_(this,ke,[]);_(this,je);A(this,ze,[].concat(e)),A(this,Ne,t),A(this,ke,n||m(this,ke)),A(this,je,i)}action(...e){return m(this,je).call(this,...e)}get description(){return m(this,Ne)}get name(){return m(this,ze)}get args(){return m(this,ke)}}ze=new WeakMap,Ne=new WeakMap,ke=new WeakMap,je=new WeakMap;function Ei(r){return r.map(e=>new Ai(e))}function Jr(r,e){return r.args.reduce((t,n)=>{const i=[].concat(n.name);i.length<1&&(i.push=`argument-${n.index}`);const s=mi(n.name[0]);if("index"in n&&n.index!==void 0&&Number(n.index)in e.args){const a=n.index;let l=e.args[Number(a)];l=l===void 0?!0:l,t[Number(a)]=l,t.unresolved[Number(a)]=e.unresolved.args[Number(a)],t[String(s)]=l,t.unresolved[String(s)]=e.unresolved.args[Number(a)]}return i.forEach(a=>{if(a in e.kwargs){const l=e.kwargs[String(a)];t[String(s)]=l===void 0?!0:l,t.unresolved[String(s)]=e.kwargs[String(a)]===void 0?!0:l}}),t},{unresolved:{}})}var Ue,He,Ve,Ye;class x{constructor({name:e,index:t,flag:n,description:i}){_(this,Ue);_(this,He);_(this,Ve);_(this,Ye);A(this,Ue,[].concat(e)),A(this,He,t),A(this,Ve,n),A(this,Ye,i)}get name(){return m(this,Ue)}get index(){return m(this,He)}get flag(){return m(this,Ve)}get description(){return m(this,Ye)}}Ue=new WeakMap,He=new WeakMap,Ve=new WeakMap,Ye=new WeakMap;class Ci{constructor({config:e={},commands:t,contextMenu:n=null,core:i}){p(this,"commands",[]);p(this,"contextMenu",[]);p(this,"config",{});p(this,"core");this.core=i,this.config=e,this.commands=t,this.contextMenu=n}beforeSetup(){const e=this.core;e.config.setDefaults(this.config),typeof this.commands=="function"&&(this.commands=Ei(this.commands({core:e,module:this})),Si.add(this.commands)),typeof this.contextMenu=="function"&&(this.contextMenu=new hi(this.contextMenu,{core:e,module:this}),this.core.modules.windows.contextMenu.addDefaultItems(this.contextMenu))}setup(){this.log(this.name)}destroy(){this.core.removeCommands(this.commands)}log(e){this.core.logger.add(e,{namespace:this.constructor.NAME})}get name(){return this.constructor.NAME}}var ve,pe,qe,se,wn;let Ut=(wn=class{constructor(e){_(this,ve,!1);_(this,pe);_(this,qe);_(this,se,{});e=Object.assign({locked:m(this,ve),storage:void 0,name:void 0},e),A(this,ve,e.locked),A(this,pe,e.storage),A(this,qe,e.name)}get locked(){return m(this,ve)}get name(){return m(this,qe)}get storage(){return m(this,pe)}get data(){return m(this,se)}set data(e){A(this,se,e)}mount(){return new Promise(e=>{e(this)})}unmount(){return new Promise(e=>{e(this)})}load(){if(!m(this,pe))throw new Error("no storage");return Promise.resolve(m(this,se))}save(e){if(!m(this,pe))throw new Error("no storage");return A(this,se,e||m(this,se)),Promise.resolve(m(this,se))}},ve=new WeakMap,pe=new WeakMap,qe=new WeakMap,se=new WeakMap,wn);var me;class Rn{constructor(){_(this,me,new Map)}getItem(e){return m(this,me).get(e)}setItem(e,t){m(this,me).set(e,t)}removeItem(e){m(this,me).delete(e)}clear(){m(this,me).clear()}}me=new WeakMap;class Di extends Ut{constructor(e){e=Object.assign({storage:new Rn},e),super(e)}}class Ln extends Ut{mount(){return new Promise(e=>{try{let t;try{if(t=this.storage.getItem(this.name),t){if(t=JSON.parse(t),!t||!(t instanceof Object))throw new Error("json invalid")}else throw new Error("json invalid")}catch(n){console.error(n),t={}}this.storage.setItem(this.name,JSON.stringify(t)),e(this)}catch(t){throw new Error(t)}})}load(){return new Promise(e=>{if(this.storage)try{this.data=JSON.parse(this.storage.getItem(this.name)),e(this.data)}catch(t){throw new Error(t)}})}save(e){return new Promise(t=>{if(this.storage)try{this.data=e||this.data,this.storage.setItem(this.name,JSON.stringify(this.data)),t(this.data)}catch(n){throw new Error(n)}})}}class Ri extends Ln{constructor(e){e=Object.assign({storage:window.localStorage},e),super(e)}}class Li extends Ln{constructor(e){e=Object.assign({storage:window.sessionStorage||new Rn},e),super(e)}}class Mn extends Ut{}const z={NONE:0,AUTO:1,TEMP:3,LOCAL:4,SESSION:5,CLOUD:6};function Mi(r){switch(r){case z.TEMP:return Di;case z.LOCAL:return Ri;case z.SESSION:return Li;case z.CLOUD:return Mn;default:return Storage}}var B,ge;const bt=class bt extends U{constructor(t){t=Object.assign({},t);super(t);_(this,B,new Map);_(this,ge,ei(1));this.addItems(t.items||m(this,B)),A(this,ge,t.maxSize||m(this,ge))}async export(...t){const n=await U.prototype.export.apply(this,...t);return delete n.data,n.items=await Promise.all(Array.from(m(this,B).values()).map(i=>i.export())),n}async addItems(t,n=!1){return t instanceof Map&&(t=Array.from(t.values())),t=t.map(i=>(typeof i.data=="string"&&(i.data=Tt(i.data)),i)),t=this.parseItems(t),Promise.all(t.map(i=>this.addItem(i,n)))}static normalizeItemData(t){const n=[];return"items"in t&&!(t.items instanceof Map)&&(t.items=new Map(t.items.map(i=>[i.id,i]))),"info"in t&&(t.meta=[t.info],delete t.info,n.push("info")),"extension"in t&&(t.id+="."+t.extension,delete t.extension,n.push("extension")),"createTime"in t&&(t.createdDate=t.createTime,delete t.createTime,n.push("createTime")),"editTime"in t&&(t.editedDate=t.editTime,delete t.editTime,n.push("editTime")),"icon"in t&&(delete t.icon,n.push("icon")),n.length&&console.warn("@deprecated TODO: muss weg, hier werden die alten Items angepasst.",t,n),t}parseItems(t){return t.map(n=>{n=bt.normalizeItemData(n);let i;return n.type?i=Ct(n.type):n.items?i=Ct("Directory"):i=Ct(),new i(n)})}async addItem(t,n=!1){const i=t.parent;if(!n&&this.hasItem(t.id))throw new Error(`File ${t.id} exists`);if(i&&await i.removeItem(t),n){const s=ti(t.id),a=vn(t.id);t.setId(_n(ni(a,this,s),s))}return m(this,B).set(t.id,t),t.setParent(this),t.events.next(new F("move",{item:t,lastParent:i})),this.events.next(new F("addItem",t)),t}removeItem(t){return t.setParent(null),m(this,B).delete(t.id),this.events.next(new F("removeItem",t)),Promise.resolve()}async remove(t){const{recursive:n}=Object.assign({recursive:!1},t);if(n){let i=await this.getItems();return i=await Promise.all(Array.from(i.values()).map(s=>s.remove(t))),i=i.reduce((s,a)=>s.concat(a),[]),i.push(await U.prototype.remove.apply(this,[t])),i}else{if((await this.getItems()).size>0)throw new Error(w.get("FileSystemItem_itemContainerNotEmpty",await this.getPath()));return[await U.prototype.remove.apply(this,arguments)]}}changeItemId(t,n,i){m(this,B).delete(n),m(this,B).set(i,t),this.parent&&console.log("changeItemId by parent",n,i,this.parent.items)}getItems(){return Promise.resolve(m(this,B))}getItem(t){return m(this,B).get(t)}hasItem(t){return m(this,B).has(t)}get items(){return m(this,B)}get size(){return Array.from(m(this,B).values()).reduce(function(t,n){return n instanceof bt||(t+=n.size),t},0)}get maxSize(){return t(this);function t(n){return n.parent&&m(n,ge)?t(n.parent):m(n,ge)}}};B=new WeakMap,ge=new WeakMap;let L=bt;w.add([["FileSystemItem_itemContainerNotEmpty",["ItemWrapp Not Empty","ItemContainer not empty… %1"]]]);class Ht extends L{constructor(e){e=Object.assign({},e,{locked:!0,id:"ROOT"}),super(e)}}p(Ht,"NAME","Root");var Mt,re;let le=(Mt=class extends L{constructor(t){t=Object.assign({storage:null},t,{locked:!0});super(t);_(this,re);A(this,re,t.storage)}get storage(){return m(this,re)}get locked(){return m(this,re).locked}mount(...t){return m(this,re).mount(...t)}unmount(...t){return m(this,re).unmount(...t)}async save(){return m(this,re).save(await this.export())}},re=new WeakMap,p(Mt,"NAME","Storage"),Mt);class ut extends le{constructor(...e){super(...e),this.meta.set(y.VISIBLE,!1)}}p(ut,"NAME","TmpDisk"),p(ut,"SYMBOL",K.TMP_DISK);class ht extends le{}p(ht,"NAME","RamDisk"),p(ht,"SYMBOL",K.RAM_DISK);class Vt extends L{}p(Vt,"NAME","FloppyDisk");class dt extends le{}p(dt,"NAME","HardDisk"),p(dt,"SYMBOL",K.HARD_DISK);class ft extends le{isLogged(){return this.storage.storage.isLogged()}}p(ft,"NAME","CloudDisk"),p(ft,"SYMBOL",K.CLOUD_DISK);class xe extends L{constructor(...e){super(...e),[y.WINDOW_SCALE,y.WINDOW_SCROLL_X,y.WINDOW_SCROLL_Y].forEach(t=>{this.meta.has(t,!0)||this.meta.set(t,!0)})}}p(xe,"NAME","Directory"),p(xe,"SYMBOL",K.DIRECTORY);class Z extends L{}p(Z,"NAME","Trashcan"),p(Z,"SYMBOL",K.TRASHCAN);class kt extends U{}p(kt,"NAME","File");var _e;class Yt extends U{constructor(t){t=Object.assign({refPath:null},t);super(t);_(this,_e);A(this,_e,t.refPath)}get refPath(){return m(this,_e)}set refPath(t){A(this,_e,t)}}_e=new WeakMap,p(Yt,"NAME","Link");var Ze,te,j,Ge,Ie;const T=class T{constructor(e){_(this,Ze);_(this,te);_(this,j);_(this,Ge,new Map);_(this,Ie,new nt);A(this,Ze,e),this.setup()}get root(){return m(this,te)}setup(){A(this,te,new Ht),A(this,j,m(this,te));const e=[this.addStorage(T.RAM_DISK_TITLE,z.SESSION,{id:T.RAM_DISK_NAME}),this.addStorage(T.HARD_DISK_NAME,z.LOCAL,{trashcan:!0}),this.addStorage(T.TMP_DISK_TITLE,z.TEMP,{id:T.TMP_DISK_NAME,trashcan:!1})];return Promise.all(e).catch(t=>{throw t})}createTmpFile(e,t,n,i){return this.createRootFile(`TMP:${e}`,t,n,i)}createRootDir(e,t,n){const i=`${e}`;return this.makedir(i,t,Object.assign({},n,{override:!0}))}createRootFile(e,t,n,i){typeof t=="object"&&(n=t,t=null);const s=`${e}`;return this.makefile(s,t,n,Object.assign({},i,{override:!0}))}async get(e,t){if(e instanceof U)return e;if(_t(e))try{return await this.parsePath(e)}catch(n){if(t)return new U({name:Y(e)});throw n}else throw w.get("FileSystem_pathInvalid",Y(e),Re(e))}async parsePath(e){let t=e,n=m(this,j);const i=e.match(/^([^:\\/]+):(.*)$/);if(i?(n=m(this,te).getItem(i[1]),t=i[2]):t[0]==="/"?(t=t.slice(1),n=m(this,j).getStorageItem()):t==="ROOT"&&(n=m(this,te),t=""),t&&t.length>0&&(n=Bt(t.split("/"),n)),n)return n;throw w.get("FileSystem_pathInvalid",e,await m(this,j).getBase())}async addFloppyDisk(e){typeof e=="function"&&(e=e());const t=await e;return this.addStorage(t)}async removeFloppyDisk(e){await e.remove(!0)}async addStorage(e,t=z.NONE,n){n=Object.assign({id:null},n);let i;typeof t=="function"&&(i=t,t=z.CLOUD);const s={id:this.getFreeSlot(T.PREFIX.FLOPPY_DISK),itemClass:Vt};let a={};if(typeof e=="object"){const l=e;s.name=l.name,s.items=l.items,s.meta=Array.from(new Map([[y.SYMBOL,K.DISK_1]].concat(l.meta||[])))}else{switch(t){case z.SESSION:s.id=T.PREFIX.RAM,s.itemClass=ht;break;case z.TEMP:s.id=T.PREFIX.TMP,s.itemClass=ut;break;case z.LOCAL:s.id=this.getFreeSlot(T.PREFIX.HARD_DISK),s.itemClass=dt;break;case z.CLOUD:s.id=this.getFreeSlot(T.PREFIX.CLOUD_DISK),s.itemClass=ft;break}s.id=n.id||s.id,i=await this.registerStorage(s.id,i||t).mount(n);const l=await i.load();a=L.normalizeItemData(l),s.storage=i,z.NONE!==t&&(s.name=a.name||e)}return(s.meta=s.meta||[]).push(...a.meta||[]),this.addDisk(Object.assign(a,s),n)}removeStorage(e){return e.unmount().then(()=>(m(this,Ie).next(new F("removeStorage",{itemStorage:e})),e))}registerStorage(e,t){let n;typeof t=="function"?n=t:n=Mi(t);const i=`${m(this,Ze)}_${e}`,s=new n({id:e,name:i});return m(this,Ge).set(i,s),s}connect(e,t){return this.addStorage(ii,e,t).then(n=>n).catch(n=>{throw n})}async disconnect(e){return e=await this.removeStorage(e),e.remove({silent:!0,recursive:!0}),e}addDisk({id:e,name:t,meta:n,items:i,itemClass:s,storage:a},l){l=Object.assign({trashcan:!1},l),l.trashcan&&(!i||i&&!i.has(Z.NAME))&&(i=i||new Map,i.set(Z.NAME,{type:Z.NAME,id:Z.NAME,name:Z.NAME}));const o=s;if(!o)throw new Error("ItemClass is empty!");const c=new o({id:e,name:t,meta:n,items:i,storage:a});return m(this,te).addItem(c),m(this,Ie).next(new F("addDisk",{id:e,item:c})),c}get currentItem(){return m(this,j)}get events(){return m(this,Ie)}get storages(){return m(this,Ge)}getFreeSlot(e){let t=0;for(;m(this,te).hasItem(`${e}${t}`);)t++;return`${e}${t}`}async exist(e){try{return!!await this.get(e)}catch(t){return console.error(t),!1}}async changeDirectory(e){const t=await this.get(e);return A(this,j,t),this.events.next(new F("changeDirectory",t)),t}async makedir(e,t,n){const{ignore:i,meta:s}=Object.assign({ignore:!1,override:!1,meta:[]},n);let a;e&&si(e)&&e!==t?a=await this.get(Re(e)):a=m(this,j);const l=new xe({id:Y(e),name:t||"",createdDate:Date.now(),meta:s});if(await ie(a),i||!a.getItem(l.id))a.addItem(l,i),this.events.next(new F("writeItem",l));else throw w.get("FileSystem_fileExist",l.id);return await J(a),l}async makefile(e,t,n,i){const{override:s,meta:a}=Object.assign({override:!1,meta:[]},i),l=new kt({id:Y(e),name:t,data:n,meta:a,createdDate:Date.now()});if(!_t(e))throw w.get("FileSystem_invalidPath",e);let o=ri(e);const c=ai(e);o===c&&(o=".");let u;if(oi(o)?u=await this.get(o):m(this,j).id!=="ROOT"?u=await this.get(jt(await m(this,j).getPath(),o)):u=await this.get(o),u.hasItem(c))if(s)await u.getItem(c).remove(),u.addItem(l);else throw w.get("FileSystem_fileExist",l.id);else u.addItem(l),this.events.next(new F("writeItem",l));return await J(u),l}async editfile(e,t){const n=await this.get(e).then(ie);return await ie(n),n.data=t,J(n)}async editfileMeta(e,t,n){const i=await this.get(e);return Array.isArray(t)?t.map(s=>({name:s[0],value:s[1]})):i.meta.set(t,n),J(i)}async saveItem(e){const t=await this.get(e);return J(t)}async makelink(e,t=null){const n=await this.get(e);await ie(n);const i=m(this,j),s=new Yt({id:vn(n.id)+".ref",name:`${t||n.name}`,refPath:await n.getPath(),createdDate:Date.now()});return await i.addItem(s),await J(n),s}async editlink(e,t){const n=await this.get(e);await ie(n);const i=await this.get(t);return n.refPath=await i.getPath(),J(n)}async rename(e,t,{name:n=!1,removeName:i=!1}){let s;if(e instanceof U)s=e;else if(_t(e)||typeof e=="string")s=await this.get(e);else throw w.get("FileSystem_pathInvalid",Re(e),e);return await ie(s),i&&(n=!0,t=null),await s.rename(t,{ignore:!0,name:n}),J(s)}async copy(e,t,n){const{ignore:i}=Object.assign({ignore:!1},n);let s,a,l;if(e instanceof U?(a=e,s=e.id):(a=await this.get(e),s=Y(e)),t instanceof U)t instanceof L||(t=t.parent),l=t;else{s=Y(t);const c=await this.get(t,!0);if(c instanceof L?s=Y(e):c.parent?l=c.parent:l=await this.get(Re(t)),!(l instanceof L))throw new TypeError("no ItemContainer")}await ie(a);const o=await a.copy();if(i||!l.getItem(s))o.rename(s),l.addItem(o,i),this.events.next(new F("copyItem",o));else throw w.get("FileSystem_fileExist",s);return J(o)}async move(e,t,{override:n=!1}){let i,s,a;if(e instanceof U)s=e,i=e.id;else{if(s=await this.get(e),s instanceof le)throw w.get("FileSystem_cantMoveStorage",s.displayName);i=Y(e)}if(t instanceof U)t instanceof L||(t=t.parent),a=t;else{if(i=Y(t),a=await this.get(t),a instanceof L)i=Y(e);else return this.get(Re(t));if(!(a instanceof L))throw new TypeError("no ItemContainer")}let l;if(await ie(s),n||!await a.getItem(i))l=s.getStorageItem(),await s.rename(i),await a.addItem(s,n),this.events.next(new F("moveItem",s));else throw w.get("FileSystem_fileExist",s.id,i);return await J(s),l?l.save().then(()=>s):s}async remove(e,t,n){const{ignore:i}=Object.assign({ignore:!1},n),s=await this.get(e);await ie(s);try{const a=await li(t,s);return a[a.length-1].storage&&await a[a.length-1].storage.save(),a}catch(a){if(!i)throw new Error(a)}}};Ze=new WeakMap,te=new WeakMap,j=new WeakMap,Ge=new WeakMap,Ie=new WeakMap,p(T,"PREFIX",{FLOPPY_DISK:"DF",TMP:"TMP",RAM:"RAM",HARD_DISK:"HD",CLOUD_DISK:"CD"}),p(T,"TMP_DISK_NAME","TMP"),p(T,"TMP_DISK_TITLE","TMP DISK"),p(T,"RAM_DISK_NAME","RAM"),p(T,"RAM_DISK_TITLE","RAM DISK"),p(T,"HARD_DISK_NAME","HARD DISK");let Wt=T;function Bt(r,e){const t=r.shift();if(t===void 0)return e;if(t===".."){if(e.parent)return e.parent}else if(t==="."||t==="")return Bt(r,e);if(e){const n=e.getItem(t);return r.length>0&&n instanceof L?Bt(r,n):n}}const Ti=[xe,Z,le,ut,ht,dt,Vt,ft,Yt,kt].reduce((r,e)=>(r[e.NAME]=e,r),{});function Ct(r){return Ti[String(r)]||kt}w.add([["FileSystem_invalidPath",["Invalid File",'Invalid path "%1"']],["FileSystem_invalidFile",["Invalid File",'Invalid file… "%1"']],["FileSystem_fileExist",["File Ready",'File already exists… "%1"']],["FileSystem_pathInvalid",["Path Invalid",'Path invalid… "%1"; base: "%2"']],["FileSystem_itemInvalid",["Item Invalid",'Item id invalid… "%1" from "%2"']],["FileSystem_cantMoveStorage",["Can't Move",`Can't move Storage "%1"`]],["FileSystem_permissionsNeeded",["Permissions needed","Permissions needed"]]]);var na=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Oi(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Fi=({onlyFirst:r=!1}={})=>{const e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,r?void 0:"g")};const $i=Fi;var Pi=r=>typeof r=="string"?r.replace($i(),""):r,qt={exports:{}},Tn={exports:{}};(function(r){var e=function(){function t(o,c,u,h){typeof c=="object"&&(u=c.depth,h=c.prototype,c.filter,c=c.circular);var d=[],f=[],g=typeof Buffer<"u";typeof c>"u"&&(c=!0),typeof u>"u"&&(u=1/0);function k(b,N){if(b===null)return null;if(N==0)return b;var D,M;if(typeof b!="object")return b;if(t.__isArray(b))D=[];else if(t.__isRegExp(b))D=new RegExp(b.source,l(b)),b.lastIndex&&(D.lastIndex=b.lastIndex);else if(t.__isDate(b))D=new Date(b.getTime());else{if(g&&Buffer.isBuffer(b))return Buffer.allocUnsafe?D=Buffer.allocUnsafe(b.length):D=new Buffer(b.length),b.copy(D),D;typeof h>"u"?(M=Object.getPrototypeOf(b),D=Object.create(M)):(D=Object.create(h),M=h)}if(c){var ue=d.indexOf(b);if(ue!=-1)return f[ue];d.push(b),f.push(D)}for(var Q in b){var V;M&&(V=Object.getOwnPropertyDescriptor(M,Q)),!(V&&V.set==null)&&(D[Q]=k(b[Q],N-1))}return D}return k(o,u)}t.clonePrototype=function(c){if(c===null)return null;var u=function(){};return u.prototype=c,new u};function n(o){return Object.prototype.toString.call(o)}t.__objToStr=n;function i(o){return typeof o=="object"&&n(o)==="[object Date]"}t.__isDate=i;function s(o){return typeof o=="object"&&n(o)==="[object Array]"}t.__isArray=s;function a(o){return typeof o=="object"&&n(o)==="[object RegExp]"}t.__isRegExp=a;function l(o){var c="";return o.global&&(c+="g"),o.ignoreCase&&(c+="i"),o.multiline&&(c+="m"),c}return t.__getRegExpFlags=l,t}();r.exports&&(r.exports=e)})(Tn);var Wi=Tn.exports,Bi=Wi,zi=function(r,e){return r=r||{},Object.keys(e).forEach(function(t){typeof r[t]>"u"&&(r[t]=Bi(e[t]))}),r},Ni=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],ji=zi,Le=Ni,On={nul:0,control:0};qt.exports=function(e){return Fn(e,On)};qt.exports.config=function(r){return r=ji(r||{},On),function(t){return Fn(t,r)}};function Fn(r,e){if(typeof r!="string")return an(r,e);for(var t=0,n=0;n<r.length;n++){var i=an(r.charCodeAt(n),e);if(i<0)return-1;t+=i}return t}function an(r,e){return r===0?e.nul:r<32||r>=127&&r<160?e.control:Ui(r)?0:1+(r>=4352&&(r<=4447||r==9001||r==9002||r>=11904&&r<=42191&&r!=12351||r>=44032&&r<=55203||r>=63744&&r<=64255||r>=65040&&r<=65049||r>=65072&&r<=65135||r>=65280&&r<=65376||r>=65504&&r<=65510||r>=131072&&r<=196605||r>=196608&&r<=262141))}function Ui(r){var e=0,t=Le.length-1,n;if(r<Le[0][0]||r>Le[t][1])return!1;for(;t>=e;)if(n=Math.floor((e+t)/2),r>Le[n][1])e=n+1;else if(r<Le[n][0])t=n-1;else return!0;return!1}var Hi=qt.exports,Vi=Pi,Yi=Hi,$n=function(r){return Yi(Vi(r))},we={},ae=$n;function pt(r,e){return Array.apply(null,{length:e+1}).join(r).slice(0,e)}function qi(r,e,t){r=r??"",r=String(r);var n=e-ae(r);return n<=0?r:r+pt(t||" ",n)}function Zi(r,e,t){r=r??"",r=String(r);var n=e-ae(r);if(n<=0)return r;var i=Math.floor(n/2),s=n-i;return pt(t||" ",i)+r+pt(t||" ",s)}function Gi(r,e,t){r=r??"",r=String(r);var n=e-ae(r);return n<=0?r:pt(t||" ",n)+r}function Xi(r,e){function t(n,i){return n.trim().split(" ").reduce(function(s,a){var l=s[s.length-1];return l&&ae(l.join(" "))+ae(a)<i?s[s.length-1].push(a):s.push([a]),s},[]).map(function(s){return s.join(" ")})}return r.split(`
`).map(function(n){return t(n,e)}).reduce(function(n,i){return n.concat(i)},[])}function Ki(r,e,t){r=r.trim();for(var n=[],i=r.split(" "),s="",a=ae(t);s||i.length;){if(s){var l=s;s=""}else var l=i.shift();if(ae(l)>e){for(var o=0,c=0,u=e-a;o<l.length;){var h=ae(l.charAt(o));if(h+c>u)break;c+=h,++o}s=l.slice(o),l=l.slice(0,o),l+=t}n.push(l)}return n.join(" ")}function Qi(r,e){if(r=r??"",r=String(r),e==1/0)return r;for(var t=0,n=0;t<r.length;){var i=ae(r.charAt(t));if(i+n>e)break;n+=i,++t}return r.slice(0,t)}we.padRight=qi;we.padCenter=Zi;we.padLeft=Gi;we.splitIntoLines=Xi;we.splitLongWords=Ki;we.truncateString=Qi;var Dt=$n,Ce=we,Ji=Ce.padRight,es=Ce.padCenter,ts=Ce.padLeft,on=Ce.splitIntoLines,ns=Ce.splitLongWords,is=Ce.truncateString,Pn=function(e){return e.toUpperCase()},ss=function(e,t,n){return e},rs=Object.freeze({maxWidth:1/0,minWidth:0,columnSplitter:" ",truncate:!1,truncateMarker:"…",preserveNewLines:!1,paddingChr:" ",showHeaders:!0,headingTransform:Pn,dataTransform:ss}),as=function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.config||{};delete e.config;var n=e.maxLineWidth||1/0;n==="auto"&&(n=process.stdout.columns||1/0),delete e.maxLineWidth,e=ln({},rs,e),e.config=e.config||Object.create(null),e.spacing=e.spacing||`
`,e.preserveNewLines=!!e.preserveNewLines,e.showHeaders=!!e.showHeaders,e.columns=e.columns||e.include;var i=e.columns||[];r=us(r,i),i.length||r.forEach(function(o){for(var c in o)i.indexOf(c)===-1&&i.push(c)});var s=i.reduce(function(o,c){var u=Object.create(e);return o[c]=ln(u,t[c]),o},Object.create(null));i.forEach(function(o){var c=s[o];c.name=o,c.maxWidth=Math.ceil(c.maxWidth),c.minWidth=Math.ceil(c.minWidth),c.truncate=!!c.truncate,c.align=c.align||"left"}),r=r.map(function(o){var c=Object.create(null);return i.forEach(function(u){c[u]=o[u]!=null?o[u]:"",c[u]=""+c[u],s[u].preserveNewLines?c[u]=c[u].replace(/[^\S\n]/gmi," "):c[u]=c[u].replace(/\s/gmi," ")}),c}),i.forEach(function(o){var c=s[o];r=r.map(function(u,h){var d=Object.create(c);u[o]=c.dataTransform(u[o],d,h);var f=Object.keys(d);if(f.indexOf("name")!==-1){if(c.headingTransform!==Pn)return;c.headingTransform=function(g){return g}}return f.forEach(function(g){return c[g]=d[g]}),u})});var a={};e.showHeaders&&(i.forEach(function(o){var c=s[o];if(!c.showHeaders){a[o]="";return}a[o]=c.headingTransform(c.name)}),r.unshift(a)),i.forEach(function(o){var c=s[o];c.width=r.map(function(u){return u[o]}).reduce(function(u,h){return u>=c.maxWidth?u:Math.max(u,Math.min(c.maxWidth,Math.max(c.minWidth,Dt(h))))},0)}),i.forEach(function(o){var c=s[o];r=r.map(function(u){return u[o]=ns(u[o],c.width,c.truncateMarker),u})}),i.forEach(function(o){var c=s[o];r=r.map(function(u,h){var d=u[o];if(u[o]=on(d,c.width),c.truncate&&u[o].length>1){u[o]=on(d,c.width-Dt(c.truncateMarker));var f=u[o][0];cs(f,c.truncateMarker)||(u[o][0]+=c.truncateMarker),u[o]=u[o].slice(0,1)}return u})}),i.forEach(function(o){var c=s[o];c.width=r.map(function(u){return u[o].reduce(function(h,d){return h>=c.maxWidth?h:Math.max(h,Math.min(c.maxWidth,Math.max(c.minWidth,Dt(d))))},0)}).reduce(function(u,h){return u>=c.maxWidth?u:Math.max(u,Math.min(c.maxWidth,Math.max(c.minWidth,h)))},0)});var l=os(r,s,i,e.paddingChr);return l.reduce(function(o,c){return o.concat(c.reduce(function(u,h){return u.concat(h.join(e.columnSplitter))},[]))},[]).map(function(o){return is(o,n)}).join(e.spacing)};function os(r,e,t,n){return r.map(function(i){var s=[],a=0;t.forEach(function(c){a=Math.max(a,i[c].length)});for(var l=function(u){s[u]=s[u]||[],t.forEach(function(h){var d=e[h],f=i[h][u]||"";d.align==="right"?s[u].push(ts(f,d.width,n)):d.align==="center"||d.align==="centre"?s[u].push(es(f,d.width,n)):s[u].push(Ji(f,d.width,n))})},o=0;o<a;o++)l(o);return s})}function ln(){return Object.assign?Object.assign.apply(Object,arguments):ls.apply(void 0,arguments)}function ls(r,e){if(r==null)throw new TypeError("Cannot convert first argument to object");for(var t=Object(r),n=!1,i,s=1;s<arguments.length;s++){var a=arguments[s];if(a!=null){for(var l=Object.keys(Object(a)),o=0,c=l.length;o<c;o++){var u=l[o];try{var h=Object.getOwnPropertyDescriptor(a,u);h!==void 0&&h.enumerable&&(t[u]=a[u])}catch(d){n||(n=!0,i=d)}}if(n)throw i}}return t}function cs(r,e,t){t=t||r.length,t=t-e.length;var n=r.lastIndexOf(e);return n!==-1&&n===t}function us(r,e){if(Array.isArray(r))return r;var t=[];for(var n in r){var i={};i[e[0]||"key"]=n,i[e[1]||"value"]=r[n],t.push(i)}return t}const hs=Oi(as);var Xe,Ke,Qe,Se;class ct{constructor(e){_(this,Xe,0);_(this,Ke,!0);_(this,Qe,[]);_(this,Se,[]);const{showHeader:t,headerPadding:n,columns:i}=Object.assign({showHeader:!0,headerPadding:0,columns:[]},e);A(this,Ke,t),A(this,Xe,n),this.addColumn(i)}addColumn(e){Array.isArray(e)?m(this,Se).push(...[].concat(e)):m(this,Se).push(Object.assign({value:null,align:"left",minWidth:0,maxWidth:0,spacerChar:" "},e))}addRow(e){m(this,Qe).push(...[].concat(e))}static createSpacer(e,t,n){if(e.length<t){t=t-e.length;for(let i=0;i<t;i++)e+=n}return e}get columns(){return m(this,Se)}get rows(){return m(this,Qe)}get showHeader(){return m(this,Ke)}get headerPadding(){return m(this,Xe)}toColumnify(){const e=this.columns.map(i=>i.value),t=this.rows.reduce((i,s,a)=>(a<1&&this.showHeader&&this.headerPadding&&i.push(...Array(this.headerPadding).fill("")),i.push(this.columns.reduce((l,o,c)=>(l[o.value]=s[Number(c)],l),{})),i),[]),n=this.columns.reduce((i,s)=>(i[s.value]={},s.align&&(i[s.value].align=s.align),s.minWidth&&(i[s.value].minWidth=s.minWidth),s.maxWidth&&(i[s.value].maxWidth=s.maxWidth),i[s.value].headingTransform=a=>a,i),{});return hs(t,{showHeaders:this.showHeader,preserveNewLines:!0,config:n,columns:e}).replace(/\xC2/g," ")}}Xe=new WeakMap,Ke=new WeakMap,Qe=new WeakMap,Se=new WeakMap;function ia(r){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","\n":`&nbsp;
`," ":"&nbsp;"};return r.replace(/[&<>"'\n ]/g,function(t){return e[String(t)]})}function ds(r,e,t,n=" "){if(r.length<e)for(let i=r.length;i<=e-1;i++)t?r=n+r:r=r+n;return r}function Pe(r){return r>2e3?(r=parseInt(r/1e3),r>1e3?(r=parseInt(r/1e3),r>1e3?(r=parseInt(r/1e3),`${r}g`):`${r}m`):`${r}k`):`${r}b`}function zt(r,e){const t=new Date(e),n=[[/y/g,`${t.getFullYear()}`.slice(2)],[/Y/g,t.getFullYear()],[/dd/g,cn(t.getDate())],[/d/g,t.getDate()],[/DD/g,cn(t.getDate())],[/D/g,Me(t.getDate())],[/mm/g,un(t.getMonth(),!0)],[/m/g,t.getMonth()+1],[/MM/g,un(t.getMonth()+1,!1)],[/M/g,Me(t.getMonth()+1)],[/h/g,t.getHours()],[/H/g,Me(t.getHours())],[/i/g,t.getMinutes()],[/I/g,Me(t.getMinutes())],[/s/g,t.getSeconds()],[/S/g,Me(t.getSeconds())]];return n.forEach((i,s)=>{r=r.replace(i[0],`%${s}%`)}),n.forEach((i,s)=>{r=r.replace(`%${s}%`,i[1])}),r}const fs=[["Sunday","Sun"],["Monday","Mon"],["Tuesday","Tue"],["Wednesday","Wed"],["Thursday","Thu"],["Friday","Fri"],["Saturday","Sat"]];function cn(r){return fs[String(r)]}const ps=[["Januar","Jan"],["February","Feb"],["March","Mar"],["April","Apr"],["May"],["June"],["July"],["August","Aug"],["September","Sept"],["October","Oct"],["November","Nov"],["December","Dec"]];function un(r,e){return r=ps[r-1],r.length>1?e?r[1]:r[0]:r}function Me(r){return r=String(r),r.length<2?`0${r}`:r}function sa(r,e){return e<=0?"":e>String(r).length?r:String(r).substring(0,e)}function ra(r,e){if(e<=0)return"";if(e>String(r).length)return r;{const t=String(r).length;return String(r).substring(t,t-e)}}function aa(r,e=" "){return Array(parseInt(r)).fill(e).join("")}const ms={props:{full:{type:Boolean,required:!1,default:!1},align:{type:String,required:!1,validate:r=>["center","left","right","outer"].includes(r),default:"left"},direction:{type:String,required:!1,validate:r=>["horizontal","vertical"].includes(r),default:"horizontal"}},computed:{styleClasses(){return{[`direction-${this.direction}`]:!0,[`align-${this.align}`]:!0,full:this.full}}}};function gs(r,e,t,n,i,s){return I(),O("div",{class:fi(["wb-env-molecule-button-wrapper",s.styleClasses])},[$("div",null,[di(r.$slots,"default",{},void 0,!0)])],2)}const st=ce(ms,[["render",gs],["__scopeId","data-v-13c4bed6"]]),xs={components:{WbButton:it,WbButtonWrapper:st,WbItemSelect:gi},props:{fileSystem:{type:Object,default(){return null}},fsItem:{type:Object,default(){return null}},name:{type:String,default(){return"fsItem"}},model:{type:Object,default(){return{fsItem:null}}},backLabel:{type:String,default(){return"../"}},upLabel:{type:String,default(){return"Up"}},downLabel:{type:String,default(){return"Down"}},maxVisibleItems:{type:Number,default(){return 5}}},emits:["select","refresh"],data(){return{currentFsItem:this.fsItem||R(this.fileSystem.root),fsItems:[],currentIndex:0}},computed:{disableds(){return{back:!this.currentFsItem.parent,up:this.currentIndex-1<0,down:this.currentIndex+1>this.fsItems.length-this.maxVisibleItems}},currentPath(){return this.model[this.name]},items(){const r=this.fsItems.slice(this.currentIndex,this.currentIndex+this.maxVisibleItems).map(e=>({label:e.id,value:e.getPath()})).concat(Array(Math.max(this.maxVisibleItems-this.fsItems.length,0)).fill({label:"&nbsp;",disabled:!0}));return this.fsItems.length<1&&(r[Math.floor(r.length/2)]={label:"Empty",disabled:!0}),r}},watch:{async currentPath(){this.currentFsItem=R(await this.fileSystem.get(this.model[this.name])),this.currentFsItem instanceof L&&(this.fsItems=Array.from((await this.currentFsItem.getItems()).values()).map(R),this.currentIndex=0),this.$emit("select",this.currentFsItem)}},async mounted(){this.fsItems=Array.from((await this.currentFsItem.getItems()).values()).map(R),this.$nextTick(()=>{this.$emit("refresh",{reset:!0,resize:!1,scroll:!1})})},methods:{onClicBack(){this.currentFsItem instanceof L?this.model[this.name]=this.currentFsItem.parent.getPath():this.model[this.name]=this.currentFsItem.parent.parent.getPath()},onClickUp(){this.currentIndex=Math.max(this.currentIndex-1,0)},onClickDown(){this.currentIndex=Math.min(this.currentIndex+1,this.fsItems.length-this.maxVisibleItems)}}},bs={class:"wb-module-files-atoms-file-select"};function ws(r,e,t,n,i,s){const a=C("wb-item-select"),l=C("wb-button"),o=C("wb-button-wrapper");return I(),O("div",bs,[$("div",null,[E(a,{title:null,items:s.items,name:t.name,model:t.model},null,8,["items","name","model"])]),$("div",null,[E(o,{align:"outer",full:"",direction:"vertical"},{default:oe(()=>[E(l,{"style-type":"secondary",label:t.backLabel,disabled:s.disableds.back,onClick:s.onClicBack},null,8,["label","disabled","onClick"]),E(l,{"style-type":"secondary",label:t.upLabel,disabled:s.disableds.up,onClick:s.onClickUp},null,8,["label","disabled","onClick"]),t.downLabel?(I(),ne(l,{key:0,"style-type":"secondary",label:t.downLabel,disabled:s.disableds.down,onClick:s.onClickDown},null,8,["label","disabled","onClick"])):H("",!0)]),_:1})])])}const Wn=ce(xs,[["render",ws],["__scopeId","data-v-456ecefa"]]),ys={components:{WbForm:wt,WbButton:it,WbButtonWrapper:st,WbFormFieldTextbox:yt,WbFileSelect:Wn},props:{fsItem:{type:Object,default(){return null}},id:{type:String,default(){return null}},model:{type:Object,default(){return Ae({path:null,filename:null,file:null})}}},emits:["close"],setup(){return Ee()},data(){return{currentModel:{...this.model},filesModule:R(this.core.modules.files),cancelLabel:"Cancel",saveLabel:"Save",fields:{path:{label:null,placeholder:"Path…"},filename:{label:null,placeholder:"Filename…"}},currentFsItem:this.fsItem||R(this.core.modules.files.fs.root)}},computed:{fileSelectFsItem(){return this.fsItem||R(this.core.modules.files.fs.root)},isLocked(){return this.currentFsItem?this.currentFsItem.locked:!1},saveDisabled(){return!this.currentModel.filename}},mounted(){this.id&&(this.currentModel.filename=this.id)},methods:{onSelect(r){this.currentFsItem=r,r instanceof L?this.currentModel.path=r.getPath():(this.currentModel.path=r.getBase(),this.currentModel.filename=r.id)},onClickCancel(){this.$emit("close")},onSubmit(){const r=jt(this.currentModel.path,this.currentModel.filename);this.$emit("close",r)}}},ks={class:"wb-module-files-save"};function vs(r,e,t,n,i,s){const a=C("wb-form-field-textbox"),l=C("wb-file-select"),o=C("wb-button"),c=C("wb-button-wrapper"),u=C("wb-form");return I(),O("div",ks,[E(u,{onSubmit:s.onSubmit},{default:oe(()=>[E(a,q(i.fields.path,{modelValue:i.currentModel.path,"onUpdate:modelValue":e[0]||(e[0]=h=>i.currentModel.path=h),readonly:""}),null,16,["modelValue"]),E(l,{"file-system":i.filesModule.fileSystem,"fs-item":s.fileSelectFsItem,model:t.model,name:"file",onSelect:s.onSelect},null,8,["file-system","fs-item","model","onSelect"]),E(a,q(i.fields.filename,{modelValue:i.currentModel.filename,"onUpdate:modelValue":e[1]||(e[1]=h=>i.currentModel.filename=h)}),null,16,["modelValue"]),E(c,{align:"outer",full:""},{default:oe(()=>[i.cancelLabel?(I(),ne(o,{key:0,"style-type":"secondary",label:i.cancelLabel,onClick:s.onClickCancel},null,8,["label","onClick"])):H("",!0),i.saveLabel?(I(),ne(o,{key:1,"style-type":"primary",label:i.saveLabel,type:"submit",disabled:s.isLocked||s.saveDisabled},null,8,["label","disabled"])):H("",!0)]),_:1})]),_:1},8,["onSubmit"])])}const _s=ce(ys,[["render",vs],["__scopeId","data-v-370a57da"]]),Is={components:{WbForm:wt,WbButton:it,WbButtonWrapper:st,WbFormFieldTextbox:yt,WbFileSelect:Wn},props:{fsItem:{type:Object,default(){return null}},model:{type:Object,default(){return Ae({path:null})}}},emits:["close"],setup(){return Ee()},data(){return{currentModel:{...this.model,path:this.model.path||this.fsItem.getPath()},filesModule:R(this.core.modules.files),cancelLabel:"Cancel",openLabel:"Open",fields:{path:{label:null,placeholder:"Path…"},fileSelect:{name:"path"},filename:{name:"filename",label:null,placeholder:"Filename…"}},currentFsItem:this.fsItem||R(this.core.modules.files.fs.root)}},computed:{isItemContainer(){return this.currentFsItem instanceof L},fileSelectFsItem(){return this.fsItem||R(this.core.modules.files.fs.root)}},methods:{onSelect(r){this.currentFsItem=R(r),r instanceof L&&(this.currentModel.path=r.getPath())},onClickCancel(){this.$emit("close")},onSubmit(){this.$emit("close",this.currentModel.path)}}},Ss={class:"wb-module-files-open"};function As(r,e,t,n,i,s){const a=C("wb-form-field-textbox"),l=C("wb-file-select"),o=C("wb-button"),c=C("wb-button-wrapper"),u=C("wb-form");return I(),O("div",Ss,[E(u,{onSubmit:s.onSubmit},{default:oe(()=>[E(a,q(i.fields.path,{modelValue:i.currentModel.path,"onUpdate:modelValue":e[0]||(e[0]=h=>i.currentModel.path=h),readonly:""}),null,16,["modelValue"]),E(l,q(i.fields.fileSelect,{"file-system":i.filesModule.fileSystem,"fs-item":s.fileSelectFsItem,model:t.model,onSelect:s.onSelect}),null,16,["file-system","fs-item","model","onSelect"]),E(c,{align:"outer",full:""},{default:oe(()=>[i.cancelLabel?(I(),ne(o,{key:0,"style-type":"secondary",label:i.cancelLabel,onClick:s.onClickCancel},null,8,["label","onClick"])):H("",!0),i.openLabel?(I(),ne(o,{key:1,"style-type":"primary",label:i.openLabel,type:"submit",disabled:s.isItemContainer},null,8,["label","disabled"])):H("",!0)]),_:1})]),_:1},8,["onSubmit"])])}const Es=ce(Is,[["render",As],["__scopeId","data-v-03ef60e0"]]);function Zt(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let ye=Zt();function Bn(r){ye=r}const We={exec:()=>null};function S(r,e=""){let t=typeof r=="string"?r:r.source;const n={replace:(i,s)=>{let a=typeof s=="string"?s:s.source;return a=a.replace(W.caret,"$1"),t=t.replace(i,a),n},getRegex:()=>new RegExp(t,e)};return n}const W={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:r=>new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}#`),htmlBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}<(?:[a-z].*>|!--)`,"i")},Cs=/^(?:[ \t]*(?:\n|$))+/,Ds=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Rs=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,rt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Ls=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,zn=/(?:[*+-]|\d{1,9}[.)])/,Nn=S(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,zn).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),Gt=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Ms=/^[^\n]+/,Xt=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Ts=S(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Xt).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Os=S(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,zn).getRegex(),vt="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Kt=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Fs=S("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Kt).replace("tag",vt).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),jn=S(Gt).replace("hr",rt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",vt).getRegex(),$s=S(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",jn).getRegex(),Qt={blockquote:$s,code:Ds,def:Ts,fences:Rs,heading:Ls,hr:rt,html:Fs,lheading:Nn,list:Os,newline:Cs,paragraph:jn,table:We,text:Ms},hn=S("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",rt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",vt).getRegex(),Ps={...Qt,table:hn,paragraph:S(Gt).replace("hr",rt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",hn).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",vt).getRegex()},Ws={...Qt,html:S(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Kt).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:We,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:S(Gt).replace("hr",rt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Nn).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Un=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Bs=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Hn=/^( {2,}|\\)\n(?!\s*$)/,zs=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,at="\\p{P}\\p{S}",Ns=S(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,at).getRegex(),js=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Us=S(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,at).getRegex(),Hs=S("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,at).getRegex(),Vs=S("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,at).getRegex(),Ys=S(/\\([punct])/,"gu").replace(/punct/g,at).getRegex(),qs=S(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Zs=S(Kt).replace("(?:-->|$)","-->").getRegex(),Gs=S("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Zs).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),mt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Xs=S(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",mt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Vn=S(/^!?\[(label)\]\[(ref)\]/).replace("label",mt).replace("ref",Xt).getRegex(),Yn=S(/^!?\[(ref)\](?:\[\])?/).replace("ref",Xt).getRegex(),Ks=S("reflink|nolink(?!\\()","g").replace("reflink",Vn).replace("nolink",Yn).getRegex(),Jt={_backpedal:We,anyPunctuation:Ys,autolink:qs,blockSkip:js,br:Hn,code:Bs,del:We,emStrongLDelim:Us,emStrongRDelimAst:Hs,emStrongRDelimUnd:Vs,escape:Un,link:Xs,nolink:Yn,punctuation:Ns,reflink:Vn,reflinkSearch:Ks,tag:Gs,text:zs,url:We},Qs={...Jt,link:S(/^!?\[(label)\]\((.*?)\)/).replace("label",mt).getRegex(),reflink:S(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",mt).getRegex()},Nt={...Jt,escape:S(Un).replace("])","~|])").getRegex(),url:S(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Js={...Nt,br:S(Hn).replace("{2,}","*").getRegex(),text:S(Nt.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},lt={normal:Qt,gfm:Ps,pedantic:Ws},Te={normal:Jt,gfm:Nt,breaks:Js,pedantic:Qs},er={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},dn=r=>er[r];function ee(r,e){if(e){if(W.escapeTest.test(r))return r.replace(W.escapeReplace,dn)}else if(W.escapeTestNoEncode.test(r))return r.replace(W.escapeReplaceNoEncode,dn);return r}function fn(r){try{r=encodeURI(r).replace(W.percentDecode,"%")}catch{return null}return r}function pn(r,e){const t=r.replace(W.findPipe,(s,a,l)=>{let o=!1,c=a;for(;--c>=0&&l[c]==="\\";)o=!o;return o?"|":" |"}),n=t.split(W.splitPipe);let i=0;if(n[0].trim()||n.shift(),n.length>0&&!n[n.length-1].trim()&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(W.slashPipe,"|");return n}function Oe(r,e,t){const n=r.length;if(n===0)return"";let i=0;for(;i<n;){const s=r.charAt(n-i-1);if(s===e&&!t)i++;else if(s!==e&&t)i++;else break}return r.slice(0,n-i)}function tr(r,e){if(r.indexOf(e[1])===-1)return-1;let t=0;for(let n=0;n<r.length;n++)if(r[n]==="\\")n++;else if(r[n]===e[0])t++;else if(r[n]===e[1]&&(t--,t<0))return n;return-1}function mn(r,e,t,n,i){const s=e.href,a=e.title||null,l=r[1].replace(i.other.outputLinkReplace,"$1");if(r[0].charAt(0)!=="!"){n.state.inLink=!0;const o={type:"link",raw:t,href:s,title:a,text:l,tokens:n.inlineTokens(l)};return n.state.inLink=!1,o}return{type:"image",raw:t,href:s,title:a,text:l}}function nr(r,e,t){const n=r.match(t.other.indentCodeCompensation);if(n===null)return e;const i=n[1];return e.split(`
`).map(s=>{const a=s.match(t.other.beginningSpace);if(a===null)return s;const[l]=a;return l.length>=i.length?s.slice(i.length):s}).join(`
`)}class gt{constructor(e){p(this,"options");p(this,"rules");p(this,"lexer");this.options=e||ye}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Oe(n,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],i=nr(n,t[3]||"",this.rules);return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:i}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){const i=Oe(n,"#");(this.options.pedantic||!i||this.rules.other.endingSpaceChar.test(i))&&(n=i.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:Oe(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let n=Oe(t[0],`
`).split(`
`),i="",s="";const a=[];for(;n.length>0;){let l=!1;const o=[];let c;for(c=0;c<n.length;c++)if(this.rules.other.blockquoteStart.test(n[c]))o.push(n[c]),l=!0;else if(!l)o.push(n[c]);else break;n=n.slice(c);const u=o.join(`
`),h=u.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");i=i?`${i}
${u}`:u,s=s?`${s}
${h}`:h;const d=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(h,a,!0),this.lexer.state.top=d,n.length===0)break;const f=a[a.length-1];if((f==null?void 0:f.type)==="code")break;if((f==null?void 0:f.type)==="blockquote"){const g=f,k=g.raw+`
`+n.join(`
`),b=this.blockquote(k);a[a.length-1]=b,i=i.substring(0,i.length-g.raw.length)+b.raw,s=s.substring(0,s.length-g.text.length)+b.text;break}else if((f==null?void 0:f.type)==="list"){const g=f,k=g.raw+`
`+n.join(`
`),b=this.list(k);a[a.length-1]=b,i=i.substring(0,i.length-f.raw.length)+b.raw,s=s.substring(0,s.length-g.raw.length)+b.raw,n=k.substring(a[a.length-1].raw.length).split(`
`);continue}}return{type:"blockquote",raw:i,tokens:a,text:s}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const i=n.length>1,s={type:"list",raw:"",ordered:i,start:i?+n.slice(0,-1):"",loose:!1,items:[]};n=i?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=i?n:"[*+-]");const a=this.rules.other.listItemRegex(n);let l=!1;for(;e;){let o=!1,c="",u="";if(!(t=a.exec(e))||this.rules.block.hr.test(e))break;c=t[0],e=e.substring(c.length);let h=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,N=>" ".repeat(3*N.length)),d=e.split(`
`,1)[0],f=!h.trim(),g=0;if(this.options.pedantic?(g=2,u=h.trimStart()):f?g=t[1].length+1:(g=t[2].search(this.rules.other.nonSpaceChar),g=g>4?1:g,u=h.slice(g),g+=t[1].length),f&&this.rules.other.blankLine.test(d)&&(c+=d+`
`,e=e.substring(d.length+1),o=!0),!o){const N=this.rules.other.nextBulletRegex(g),D=this.rules.other.hrRegex(g),M=this.rules.other.fencesBeginRegex(g),ue=this.rules.other.headingBeginRegex(g),Q=this.rules.other.htmlBeginRegex(g);for(;e;){const V=e.split(`
`,1)[0];let De;if(d=V,this.options.pedantic?(d=d.replace(this.rules.other.listReplaceNesting,"  "),De=d):De=d.replace(this.rules.other.tabCharGlobal,"    "),M.test(d)||ue.test(d)||Q.test(d)||N.test(d)||D.test(d))break;if(De.search(this.rules.other.nonSpaceChar)>=g||!d.trim())u+=`
`+De.slice(g);else{if(f||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||M.test(h)||ue.test(h)||D.test(h))break;u+=`
`+d}!f&&!d.trim()&&(f=!0),c+=V+`
`,e=e.substring(V.length+1),h=De.slice(g)}}s.loose||(l?s.loose=!0:this.rules.other.doubleBlankLine.test(c)&&(l=!0));let k=null,b;this.options.gfm&&(k=this.rules.other.listIsTask.exec(u),k&&(b=k[0]!=="[ ] ",u=u.replace(this.rules.other.listReplaceTask,""))),s.items.push({type:"list_item",raw:c,task:!!k,checked:b,loose:!1,text:u,tokens:[]}),s.raw+=c}s.items[s.items.length-1].raw=s.items[s.items.length-1].raw.trimEnd(),s.items[s.items.length-1].text=s.items[s.items.length-1].text.trimEnd(),s.raw=s.raw.trimEnd();for(let o=0;o<s.items.length;o++)if(this.lexer.state.top=!1,s.items[o].tokens=this.lexer.blockTokens(s.items[o].text,[]),!s.loose){const c=s.items[o].tokens.filter(h=>h.type==="space"),u=c.length>0&&c.some(h=>this.rules.other.anyLine.test(h.raw));s.loose=u}if(s.loose)for(let o=0;o<s.items.length;o++)s.items[o].loose=!0;return s}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),i=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:i,title:s}}}table(e){const t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;const n=pn(t[1]),i=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=t[3]&&t[3].trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===i.length){for(const l of i)this.rules.other.tableAlignRight.test(l)?a.align.push("right"):this.rules.other.tableAlignCenter.test(l)?a.align.push("center"):this.rules.other.tableAlignLeft.test(l)?a.align.push("left"):a.align.push(null);for(let l=0;l<n.length;l++)a.header.push({text:n[l],tokens:this.lexer.inline(n[l]),header:!0,align:a.align[l]});for(const l of s)a.rows.push(pn(l,a.header.length).map((o,c)=>({text:o,tokens:this.lexer.inline(o),header:!1,align:a.align[c]})));return a}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;const a=Oe(n.slice(0,-1),"\\");if((n.length-a.length)%2===0)return}else{const a=tr(t[2],"()");if(a>-1){const o=(t[0].indexOf("!")===0?5:4)+t[1].length+a;t[2]=t[2].substring(0,a),t[0]=t[0].substring(0,o).trim(),t[3]=""}}let i=t[2],s="";if(this.options.pedantic){const a=this.rules.other.pedanticHrefTitle.exec(i);a&&(i=a[1],s=a[3])}else s=t[3]?t[3].slice(1,-1):"";return i=i.trim(),this.rules.other.startAngleBracket.test(i)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?i=i.slice(1):i=i.slice(1,-1)),mn(t,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const i=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=t[i.toLowerCase()];if(!s){const a=n[0].charAt(0);return{type:"text",raw:a,text:a}}return mn(n,s,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let i=this.rules.inline.emStrongLDelim.exec(e);if(!i||i[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(i[1]||i[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const a=[...i[0]].length-1;let l,o,c=a,u=0;const h=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(h.lastIndex=0,t=t.slice(-1*e.length+a);(i=h.exec(t))!=null;){if(l=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!l)continue;if(o=[...l].length,i[3]||i[4]){c+=o;continue}else if((i[5]||i[6])&&a%3&&!((a+o)%3)){u+=o;continue}if(c-=o,c>0)continue;o=Math.min(o,o+c+u);const d=[...i[0]][0].length,f=e.slice(0,a+i.index+d+o);if(Math.min(a,o)%2){const k=f.slice(1,-1);return{type:"em",raw:f,text:k,tokens:this.lexer.inlineTokens(k)}}const g=f.slice(2,-2);return{type:"strong",raw:f,text:g,tokens:this.lexer.inlineTokens(g)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal," ");const i=this.rules.other.nonSpaceChar.test(n),s=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return i&&s&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:t[0],text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let n,i;return t[2]==="@"?(n=t[1],i="mailto:"+n):(n=t[1],i=n),{type:"link",raw:t[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}url(e){var n;let t;if(t=this.rules.inline.url.exec(e)){let i,s;if(t[2]==="@")i=t[0],s="mailto:"+i;else{let a;do a=t[0],t[0]=((n=this.rules.inline._backpedal.exec(t[0]))==null?void 0:n[0])??"";while(a!==t[0]);i=t[0],t[1]==="www."?s="http://"+t[0]:s=t[0]}return{type:"link",raw:t[0],text:i,href:s,tokens:[{type:"text",raw:i,text:i}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const n=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:n}}}}class G{constructor(e){p(this,"tokens");p(this,"options");p(this,"state");p(this,"tokenizer");p(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||ye,this.options.tokenizer=this.options.tokenizer||new gt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:W,block:lt.normal,inline:Te.normal};this.options.pedantic?(t.block=lt.pedantic,t.inline=Te.pedantic):this.options.gfm&&(t.block=lt.gfm,this.options.breaks?t.inline=Te.breaks:t.inline=Te.gfm),this.tokenizer.rules=t}static get rules(){return{block:lt,inline:Te}}static lex(e,t){return new G(t).lex(e)}static lexInline(e,t){return new G(t).inlineTokens(e)}lex(e){e=e.replace(W.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const n=this.inlineQueue[t];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){this.options.pedantic&&(e=e.replace(W.tabCharGlobal,"    ").replace(W.spaceLine,""));let i,s,a;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(l=>(i=l.call({lexer:this},e,t))?(e=e.substring(i.raw.length),t.push(i),!0):!1))){if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length),i.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length),s=t[t.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+i.raw,s.text+=`
`+i.text,this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length),s=t[t.length-1],s&&(s.type==="paragraph"||s.type==="text")?(s.raw+=`
`+i.raw,s.text+=`
`+i.raw,this.inlineQueue[this.inlineQueue.length-1].src=s.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title});continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(a=e,this.options.extensions&&this.options.extensions.startBlock){let l=1/0;const o=e.slice(1);let c;this.options.extensions.startBlock.forEach(u=>{c=u.call({lexer:this},o),typeof c=="number"&&c>=0&&(l=Math.min(l,c))}),l<1/0&&l>=0&&(a=e.substring(0,l+1))}if(this.state.top&&(i=this.tokenizer.paragraph(a))){s=t[t.length-1],n&&(s==null?void 0:s.type)==="paragraph"?(s.raw+=`
`+i.raw,s.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(i),n=a.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length),s=t[t.length-1],s&&s.type==="text"?(s.raw+=`
`+i.raw,s.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=s.text):t.push(i);continue}if(e){const l="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n,i,s,a=e,l,o,c;if(this.tokens.links){const u=Object.keys(this.tokens.links);if(u.length>0)for(;(l=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)u.includes(l[0].slice(l[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,l.index)+"["+"a".repeat(l[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(l=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)a=a.slice(0,l.index)+"["+"a".repeat(l[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(l=this.tokenizer.rules.inline.anyPunctuation.exec(a))!=null;)a=a.slice(0,l.index)+"++"+a.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(o||(c=""),o=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(u=>(n=u.call({lexer:this},e,t))?(e=e.substring(n.raw.length),t.push(n),!0):!1))){if(n=this.tokenizer.escape(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.tag(e)){e=e.substring(n.raw.length),i=t[t.length-1],t.push(n);continue}if(n=this.tokenizer.link(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(n.raw.length),i=t[t.length-1],i&&n.type==="text"&&i.type==="text"?(i.raw+=n.raw,i.text+=n.text):t.push(n);continue}if(n=this.tokenizer.emStrong(e,a,c)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.codespan(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.br(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.del(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.autolink(e)){e=e.substring(n.raw.length),t.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(e))){e=e.substring(n.raw.length),t.push(n);continue}if(s=e,this.options.extensions&&this.options.extensions.startInline){let u=1/0;const h=e.slice(1);let d;this.options.extensions.startInline.forEach(f=>{d=f.call({lexer:this},h),typeof d=="number"&&d>=0&&(u=Math.min(u,d))}),u<1/0&&u>=0&&(s=e.substring(0,u+1))}if(n=this.tokenizer.inlineText(s)){e=e.substring(n.raw.length),n.raw.slice(-1)!=="_"&&(c=n.raw.slice(-1)),o=!0,i=t[t.length-1],i&&i.type==="text"?(i.raw+=n.raw,i.text+=n.text):t.push(n);continue}if(e){const u="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return t}}class xt{constructor(e){p(this,"options");p(this,"parser");this.options=e||ye}space(e){return""}code({text:e,lang:t,escaped:n}){var a;const i=(a=(t||"").match(W.notSpaceStart))==null?void 0:a[0],s=e.replace(W.endingNewline,"")+`
`;return i?'<pre><code class="language-'+ee(i)+'">'+(n?s:ee(s,!0))+`</code></pre>
`:"<pre><code>"+(n?s:ee(s,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,n=e.start;let i="";for(let l=0;l<e.items.length;l++){const o=e.items[l];i+=this.listitem(o)}const s=t?"ol":"ul",a=t&&n!==1?' start="'+n+'"':"";return"<"+s+a+`>
`+i+"</"+s+`>
`}listitem(e){let t="";if(e.task){const n=this.checkbox({checked:!!e.checked});e.loose?e.tokens.length>0&&e.tokens[0].type==="paragraph"?(e.tokens[0].text=n+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=n+" "+ee(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:n+" ",text:n+" ",escaped:!0}):t+=n+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",n="";for(let s=0;s<e.header.length;s++)n+=this.tablecell(e.header[s]);t+=this.tablerow({text:n});let i="";for(let s=0;s<e.rows.length;s++){const a=e.rows[s];n="";for(let l=0;l<a.length;l++)n+=this.tablecell(a[l]);i+=this.tablerow({text:n})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+i+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${ee(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){const i=this.parser.parseInline(n),s=fn(e);if(s===null)return i;e=s;let a='<a href="'+e+'"';return t&&(a+=' title="'+ee(t)+'"'),a+=">"+i+"</a>",a}image({href:e,title:t,text:n}){const i=fn(e);if(i===null)return ee(n);e=i;let s=`<img src="${e}" alt="${n}"`;return t&&(s+=` title="${ee(t)}"`),s+=">",s}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:ee(e.text)}}class en{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class X{constructor(e){p(this,"options");p(this,"renderer");p(this,"textRenderer");this.options=e||ye,this.options.renderer=this.options.renderer||new xt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new en}static parse(e,t){return new X(t).parse(e)}static parseInline(e,t){return new X(t).parseInline(e)}parse(e,t=!0){let n="";for(let i=0;i<e.length;i++){const s=e[i];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]){const l=s,o=this.options.extensions.renderers[l.type].call({parser:this},l);if(o!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(l.type)){n+=o||"";continue}}const a=s;switch(a.type){case"space":{n+=this.renderer.space(a);continue}case"hr":{n+=this.renderer.hr(a);continue}case"heading":{n+=this.renderer.heading(a);continue}case"code":{n+=this.renderer.code(a);continue}case"table":{n+=this.renderer.table(a);continue}case"blockquote":{n+=this.renderer.blockquote(a);continue}case"list":{n+=this.renderer.list(a);continue}case"html":{n+=this.renderer.html(a);continue}case"paragraph":{n+=this.renderer.paragraph(a);continue}case"text":{let l=a,o=this.renderer.text(l);for(;i+1<e.length&&e[i+1].type==="text";)l=e[++i],o+=`
`+this.renderer.text(l);t?n+=this.renderer.paragraph({type:"paragraph",raw:o,text:o,tokens:[{type:"text",raw:o,text:o,escaped:!0}]}):n+=o;continue}default:{const l='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return n}parseInline(e,t){t=t||this.renderer;let n="";for(let i=0;i<e.length;i++){const s=e[i];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]){const l=this.options.extensions.renderers[s.type].call({parser:this},s);if(l!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){n+=l||"";continue}}const a=s;switch(a.type){case"escape":{n+=t.text(a);break}case"html":{n+=t.html(a);break}case"link":{n+=t.link(a);break}case"image":{n+=t.image(a);break}case"strong":{n+=t.strong(a);break}case"em":{n+=t.em(a);break}case"codespan":{n+=t.codespan(a);break}case"br":{n+=t.br(a);break}case"del":{n+=t.del(a);break}case"text":{n+=t.text(a);break}default:{const l='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return n}}class Be{constructor(e){p(this,"options");p(this,"block");this.options=e||ye}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?G.lex:G.lexInline}provideParser(){return this.block?X.parse:X.parseInline}}p(Be,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class ir{constructor(...e){p(this,"defaults",Zt());p(this,"options",this.setOptions);p(this,"parse",this.parseMarkdown(!0));p(this,"parseInline",this.parseMarkdown(!1));p(this,"Parser",X);p(this,"Renderer",xt);p(this,"TextRenderer",en);p(this,"Lexer",G);p(this,"Tokenizer",gt);p(this,"Hooks",Be);this.use(...e)}walkTokens(e,t){var i,s;let n=[];for(const a of e)switch(n=n.concat(t.call(this,a)),a.type){case"table":{const l=a;for(const o of l.header)n=n.concat(this.walkTokens(o.tokens,t));for(const o of l.rows)for(const c of o)n=n.concat(this.walkTokens(c.tokens,t));break}case"list":{const l=a;n=n.concat(this.walkTokens(l.items,t));break}default:{const l=a;(s=(i=this.defaults.extensions)==null?void 0:i.childTokens)!=null&&s[l.type]?this.defaults.extensions.childTokens[l.type].forEach(o=>{const c=l[o].flat(1/0);n=n.concat(this.walkTokens(c,t))}):l.tokens&&(n=n.concat(this.walkTokens(l.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{const i={...n};if(i.async=this.defaults.async||i.async||!1,n.extensions&&(n.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){const a=t.renderers[s.name];a?t.renderers[s.name]=function(...l){let o=s.renderer.apply(this,l);return o===!1&&(o=a.apply(this,l)),o}:t.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const a=t[s.level];a?a.unshift(s.tokenizer):t[s.level]=[s.tokenizer],s.start&&(s.level==="block"?t.startBlock?t.startBlock.push(s.start):t.startBlock=[s.start]:s.level==="inline"&&(t.startInline?t.startInline.push(s.start):t.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(t.childTokens[s.name]=s.childTokens)}),i.extensions=t),n.renderer){const s=this.defaults.renderer||new xt(this.defaults);for(const a in n.renderer){if(!(a in s))throw new Error(`renderer '${a}' does not exist`);if(["options","parser"].includes(a))continue;const l=a,o=n.renderer[l],c=s[l];s[l]=(...u)=>{let h=o.apply(s,u);return h===!1&&(h=c.apply(s,u)),h||""}}i.renderer=s}if(n.tokenizer){const s=this.defaults.tokenizer||new gt(this.defaults);for(const a in n.tokenizer){if(!(a in s))throw new Error(`tokenizer '${a}' does not exist`);if(["options","rules","lexer"].includes(a))continue;const l=a,o=n.tokenizer[l],c=s[l];s[l]=(...u)=>{let h=o.apply(s,u);return h===!1&&(h=c.apply(s,u)),h}}i.tokenizer=s}if(n.hooks){const s=this.defaults.hooks||new Be;for(const a in n.hooks){if(!(a in s))throw new Error(`hook '${a}' does not exist`);if(["options","block"].includes(a))continue;const l=a,o=n.hooks[l],c=s[l];Be.passThroughHooks.has(a)?s[l]=u=>{if(this.defaults.async)return Promise.resolve(o.call(s,u)).then(d=>c.call(s,d));const h=o.call(s,u);return c.call(s,h)}:s[l]=(...u)=>{let h=o.apply(s,u);return h===!1&&(h=c.apply(s,u)),h}}i.hooks=s}if(n.walkTokens){const s=this.defaults.walkTokens,a=n.walkTokens;i.walkTokens=function(l){let o=[];return o.push(a.call(this,l)),s&&(o=o.concat(s.call(this,l))),o}}this.defaults={...this.defaults,...i}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return G.lex(e,t??this.defaults)}parser(e,t){return X.parse(e,t??this.defaults)}parseMarkdown(e){return(n,i)=>{const s={...i},a={...this.defaults,...s},l=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&s.async===!1)return l(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof n>"u"||n===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));a.hooks&&(a.hooks.options=a,a.hooks.block=e);const o=a.hooks?a.hooks.provideLexer():e?G.lex:G.lexInline,c=a.hooks?a.hooks.provideParser():e?X.parse:X.parseInline;if(a.async)return Promise.resolve(a.hooks?a.hooks.preprocess(n):n).then(u=>o(u,a)).then(u=>a.hooks?a.hooks.processAllTokens(u):u).then(u=>a.walkTokens?Promise.all(this.walkTokens(u,a.walkTokens)).then(()=>u):u).then(u=>c(u,a)).then(u=>a.hooks?a.hooks.postprocess(u):u).catch(l);try{a.hooks&&(n=a.hooks.preprocess(n));let u=o(n,a);a.hooks&&(u=a.hooks.processAllTokens(u)),a.walkTokens&&this.walkTokens(u,a.walkTokens);let h=c(u,a);return a.hooks&&(h=a.hooks.postprocess(h)),h}catch(u){return l(u)}}}onError(e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const i="<p>An error occurred:</p><pre>"+ee(n.message+"",!0)+"</pre>";return t?Promise.resolve(i):i}if(t)return Promise.reject(n);throw n}}}const be=new ir;function v(r,e){return be.parse(r,e)}v.options=v.setOptions=function(r){return be.setOptions(r),v.defaults=be.defaults,Bn(v.defaults),v};v.getDefaults=Zt;v.defaults=ye;v.use=function(...r){return be.use(...r),v.defaults=be.defaults,Bn(v.defaults),v};v.walkTokens=function(r,e){return be.walkTokens(r,e)};v.parseInline=be.parseInline;v.Parser=X;v.parser=X.parse;v.Renderer=xt;v.TextRenderer=en;v.Lexer=G;v.lexer=G.lex;v.Tokenizer=gt;v.Hooks=Be;v.parse=v;v.options;v.setOptions;v.use;v.walkTokens;v.parseInline;X.parse;G.lex;const sr=["innerHTML"],rr={__name:"Markdown",props:{content:{type:String,required:!1,default:"# Headline  <p>Hello World</p>"},fontFamily:{type:String,required:!1,default:null}},setup(r){const e=new v.Renderer;e.link=function(){return v.Renderer.prototype.link.apply(this,arguments).replace("<a","<a target='_blank'")},v.setOptions({renderer:e}),v.use({mangle:!1});const t=r,n=pi(()=>v(t.content));return(i,s)=>(I(),O("div",{class:"wb-env-atom-markdown",innerHTML:n.value},null,8,sr))}},ar=ce(rr,[["__scopeId","data-v-1eaeaa29"]]),or={components:{WbMarkdown:ar},props:{type:{type:String,default:null},content:{type:[String,Array],default:null}},setup(){return Ee()},data(){return{lines:[]}},mounted(){this.type==="basic"&&window.requestAnimationFrame(()=>{this.lines=[],this.core.modules.parser.parseBasic(this.content,async(r,e)=>{const t=await this.core.executeCommand(r,e);return e.message&&this.lines.push(ci(e.message)),t})})}},lr={class:"wb-module-files-preview"},cr={key:0,class:"basic"},ur=["innerHTML"],hr=["src"];function dr(r,e,t,n,i,s){const a=C("wb-markdown");return I(),O("div",lr,[t.type==="basic"?(I(),O("ul",cr,[(I(!0),O(Ot,null,Ft(i.lines,(l,o)=>(I(),O("li",{key:o},$t(l),1))),128))])):H("",!0),t.type==="markdown"?(I(),ne(a,{key:1,content:t.content},null,8,["content"])):H("",!0),t.type==="html"?(I(),O("div",{key:2,innerHTML:t.content},null,8,ur)):H("",!0),t.type==="image"?(I(),O("img",{key:3,src:t.content},null,8,hr)):H("",!0)])}const fr=ce(or,[["render",dr],["__scopeId","data-v-bc8c72b8"]]),pr={HAS_WINDOW_OUTPUT:"has_window_output"};async function mr(r,e,t){const n=await r.executeCommand(`exist "${e}"`);let i=!1;n&&(i=await r.executeCommand('openDialog "File exist, overwrite?" --confirm'));const s=[`makefile "${e}"`];return t&&s.push(`--data="${t}"`),i?s.push("--override"):s.push("--ignore"),r.executeCommand(s.join(" "))}const gr=({module:r,core:e})=>{const t=e.modules.windows,{fileSystem:n}=r;return[{name:"openPreview",args:[new x({index:0,name:"path",description:"Path to the file"}),new x({name:"maximized",description:"If set, window is maximized."})],async action({path:i,maximized:s}){const a=await n.get(i),{type:l,content:o,openMaximized:c}=a.data;l==="basic"&&!a.data[pr.HAS_WINDOW_OUTPUT]?await e.modules.parser.parseBasic(o,async(u,h)=>await e.executeCommand(u,h)):t.addWindow({title:a.name,component:fr,componentData:{type:l,content:o},options:{scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0},layout:{size:P(420,360)}},{full:c||s||!1})}},{name:"saveFileDialog",args:[new x({index:0,name:"data",description:"File Content"}),new x({index:1,name:"id",description:"File Id"}),new x({index:2,name:"extension",description:"File Extension"})],async action({data:i,id:s,extension:a}){const l=t.addWindow({title:"Save File",component:_s,componentData:{fsItem:R(n.root),id:s},options:{scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}),{value:o}=await l.awaitClose();if(o){const c=_n(o,a),u=await mr(e,c,i);if(u)return R(Sn(u))}}},{name:"openFileDialog",args:[],async action(){await t.addWindow({title:"Open File",component:Es,componentData:{fsItem:R(n.root)},options:{scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}},{name:"fileinfo",description:"Get info from File or Directory",args:[new x({index:0,name:"path",description:"Path to the file"}),new x({index:1,name:"name",description:"Name from the Info"}),new x({index:2,name:["list","ls"],flag:!0,description:"List all Infos"})],async action({path:i,name:s,list:a},l){const o=await n.itemMeta(i,s,a);if(Array.isArray(o)){const c=new ct;c.addColumn({value:"Name",align:"left",minWidth:20}),c.addColumn({value:"Value",align:"left",minWidth:20}),c.addRow(o.map(u=>{let h=u.value;return Array.isArray(h)&&(h=h.join(" ")),[u.name,h]})),l.message([c])}return o}},{name:["info","i"],args:[new x({index:0,name:"path",description:"Path to the file"})],async action({path:i},s){let a=n.root;i&&(a=await n.get(i)),a instanceof L||(a=a.parent);let l=await a.getItems();const o=new ct;o.addColumn([{value:"Unit",align:"left",minWidth:8},{value:"Size",align:"right",minWidth:6},{value:"Used",align:"right",minWidth:6},{value:"Free",align:"right",minWidth:6},{value:"Full",minWidth:4},{value:"Errs",align:"center",minWidth:4},{value:"Status",align:"center",minWidth:10},{value:"Name",align:"right",minWidth:14}]),l=Array.from(l.values()).filter(u=>u instanceof le),o.addRow(l.map(u=>{let h=0;return(u.size>0||u.maxSize>0)&&(h=parseInt(u.size/u.maxSize*100)),[`${u.id}:`,Pe(u.maxSize),Pe(u.size),Pe(u.maxSize-u.size),`${h}%`,"0",u.locked?"Read":"Read/Write",`${u.name||""}`]}));const c=["","Mounted disks:",o,"","Volumes available:"];l.forEach(u=>{c.push(`${u.name}: [Mounted]`)}),c.push(""),s.message(c)}},{name:["list","ls"],args:[new x({index:0,name:"path",description:"Path to the file"}),new x({name:"dir-size",flag:!0,description:"Show Directory Size."})],async action({path:i,dirSize:s},a){let l=n.currentItem;i&&(l=await n.get(i));const o=Array.from((await l.getItems()).values()),c=new ct;c.addColumn({value:"Name",align:"left",minWidth:13}),c.addColumn({value:"Size",align:"right",minWidth:8}),c.addColumn({value:"Access",align:"center",minWidth:12}),c.addColumn({value:"Date / Time",align:"center",minWidth:18}),c.addRow(o.reduce((d,f)=>{let g;f instanceof L&&!s?g="DIR":g=ds(Pe(f.size),8,!0,"0");const k=f.isLocked()?"Read":"Read/Write";return d.push([`${f.id}:`,g,k,f.createdDate?zt("D-mm-y H:I:S",f.createdDate):""]),d},[]));const u=o.reduce((d,f)=>(f instanceof xe&&d++,d),0),h=o.reduce((d,f)=>(d+=f.size,d),0);return a.message([c,`${o.length} files - ${u} directories - ${h} blocks used`]),Promise.resolve()}}]},xr={components:{WbForm:wt,WbButton:it,WbButtonWrapper:st,WbFormFieldTextbox:yt,WbFormFieldDropdown:En,WbFormFieldCheckboxGroup:xi},props:{fsItem:{type:Object,default(){return null}},model:{type:Object,default(){return{actions:{save(){}},id:null,name:null,symbol:null,visible:!1}}}},emits:["close"],setup(){return Ee()},data(){const r=this.fsItem.locked;return{currentModel:{...this.model},cancelLabel:"Cancel",saveLabel:"Save",fields:{id:{disabled:r,label:"Id",name:"id"},name:{disabled:r,label:"Name",name:"name"},checkboxes:{disabled:r,label:"Others",name:null,items:[{label:"Symbol Visible",name:y.VISIBLE},{label:"Ignore Symbol Rearrange ",name:y.IGNORE_SYMBOL_REARRANGE}]},windowSettings:{disabled:r,label:"Window Settings",name:null,items:[{label:"Has Scale ?",name:y.WINDOW_SCALE},{label:"Has Scroll-X ?",name:y.WINDOW_SCROLL_X},{label:"Has Scroll-Y ?",name:y.WINDOW_SCROLL_Y},{label:"Is Full-Size ?",name:y.WINDOW_FULL_SIZE},{label:"Sort Symbols (Directory)",name:y.WINDOW_SYMBOL_REARRANGE},{label:"Has Sidebar?",name:y.WINDOW_SIDEBAR}]},symbol:{disabled:r,label:"Symbol",name:"symbol",options:Object.keys(K).map(e=>({title:An(e),value:K[String(e)]}))}}}},methods:{onClickCancel(){this.$emit("close")},async onSubmit(){this.locked||await this.model.actions.save(this.currentModel,this.fsItem),this.$emit("close")}}},br={class:"wb-module-files-edit"},wr={class:"cols"},yr={class:"col-2"},kr={class:"col-2"};function vr(r,e,t,n,i,s){const a=C("wb-form-field-textbox"),l=C("wb-form-field-dropdown"),o=C("wb-form-field-checkbox-group"),c=C("wb-button"),u=C("wb-button-wrapper"),h=C("wb-form");return I(),O("div",br,[E(h,{class:"form",onSubmit:s.onSubmit},{default:oe(()=>[$("div",null,[E(a,q(i.fields.id,{modelValue:i.currentModel.id,"onUpdate:modelValue":e[0]||(e[0]=d=>i.currentModel.id=d)}),null,16,["modelValue"]),E(a,q(i.fields.name,{modelValue:i.currentModel.name,"onUpdate:modelValue":e[1]||(e[1]=d=>i.currentModel.name=d)}),null,16,["modelValue"]),E(l,q(i.fields.symbol,{modelValue:i.currentModel.symbol,"onUpdate:modelValue":e[2]||(e[2]=d=>i.currentModel.symbol=d)}),null,16,["modelValue"]),$("div",wr,[$("div",yr,[E(o,q(i.fields.checkboxes,{model:i.currentModel}),null,16,["model"])]),$("div",kr,[E(o,q(i.fields.windowSettings,{modelValue:i.currentModel.windowSettings,"onUpdate:modelValue":e[3]||(e[3]=d=>i.currentModel.windowSettings=d)}),null,16,["modelValue"])])])]),E(u,{align:"outer",full:""},{default:oe(()=>[i.cancelLabel?(I(),ne(c,{key:0,"style-type":"secondary",label:i.cancelLabel,onClick:s.onClickCancel},null,8,["label","onClick"])):H("",!0),i.saveLabel?(I(),ne(c,{key:1,"style-type":"primary",label:i.saveLabel,type:"submit"},null,8,["label"])):H("",!0)]),_:1})]),_:1},8,["onSubmit"])])}const _r=ce(xr,[["render",vr],["__scopeId","data-v-43900761"]]),Ir={components:{WbForm:wt,WbButton:it,WbButtonWrapper:st,WbFormFieldTextbox:yt,WbFormFieldDropdown:En},props:{fsItem:{type:Object,default(){return null}},model:{type:Object,default(){return{actions:{save:()=>{}},name:null,url:null,symbol:null}}}},emits:["close"],setup(){return Ee()},data(){const r=(this.fsItem||{}).locked;return{currentModel:{...this.model},cancelLabel:"Cancel",saveLabel:"Save",fields:{name:{disabled:r,placeholder:"Name",label:"Name"},url:{disabled:r,placeholder:"http://…",label:"Url"},symbol:{disabled:r,label:"Symbol",options:Object.keys(K).map(e=>({title:An(e),value:K[String(e)]}))}}}},computed:{disabledSave(){return!this.currentModel.name||!this.currentModel.url||!this.currentModel.symbol}},methods:{onClickCancel(){this.$emit("close")},async onSubmit(){await this.model.actions.save(this.currentModel,this.fsItem)&&this.$emit("close")}}},Sr={class:"wb-module-files-web-link"};function Ar(r,e,t,n,i,s){const a=C("wb-form-field-textbox"),l=C("wb-form-field-dropdown"),o=C("wb-button"),c=C("wb-button-wrapper"),u=C("wb-form");return I(),O("div",Sr,[E(u,{onSubmit:s.onSubmit},{default:oe(()=>[E(a,q(i.fields.name,{modelValue:i.currentModel.name,"onUpdate:modelValue":e[0]||(e[0]=h=>i.currentModel.name=h)}),null,16,["modelValue"]),E(a,q(i.fields.url,{modelValue:i.currentModel.url,"onUpdate:modelValue":e[1]||(e[1]=h=>i.currentModel.url=h),type:"url"}),null,16,["modelValue"]),E(l,q(i.fields.symbol,{modelValue:i.currentModel.symbol,"onUpdate:modelValue":e[2]||(e[2]=h=>i.currentModel.symbol=h)}),null,16,["modelValue"]),E(c,{align:"outer",full:""},{default:oe(()=>[i.cancelLabel?(I(),ne(o,{key:0,"style-type":"secondary",label:i.cancelLabel,onClick:s.onClickCancel},null,8,["label","onClick"])):H("",!0),i.saveLabel?(I(),ne(o,{key:1,"style-type":"primary",label:i.saveLabel,type:"submit",disabled:s.disabledSave},null,8,["label","disabled"])):H("",!0)]),_:1})]),_:1},8,["onSubmit"])])}const gn=ce(Ir,[["render",Ar],["__scopeId","data-v-26955dd6"]]),Er={components:{},props:{fsItem:{type:Object,default(){return null}}},setup(){return Ee()},computed:{meta(){return Array.from(this.fsItem.meta).map(([r,e])=>{if(typeof e=="object")try{e=JSON.stringify(e)}catch(t){console.error(t)}return{title:r,value:e}})},items(){return[{title:"Id",value:this.fsItem.id},{title:"Name",value:this.fsItem.name},{title:"Type",value:this.fsItem.constructor.NAME},{title:"Path",value:this.fsItem.getPath()},{title:"Size",value:Pe(this.fsItem.size)},{title:"Locked",value:this.fsItem.locked?"Yes":"No"},{title:"Created Date",value:`<nobr>${zt("H:I:S D.M.Y",this.fsItem.createdDate)}</nobr>`},{title:"Modified Date",value:`<nobr>${zt("H:I:S D.M.Y",this.fsItem.editedDate)}</nobr>`}]}}},Cr={class:"wb-module-files-info"},Dr=["innerHTML"],Rr=["innerHTML"];function Lr(r,e,t,n,i,s){return I(),O("div",Cr,[$("table",null,[(I(!0),O(Ot,null,Ft(s.items,({title:a,value:l},o)=>(I(),O("tr",{key:o},[$("td",null,$t(a)+":",1),$("td",{innerHTML:l},null,8,Dr)]))),128))]),$("fieldset",null,[e[0]||(e[0]=$("legend",null,"Meta:",-1)),$("table",null,[(I(!0),O(Ot,null,Ft(s.meta,({title:a,value:l},o)=>(I(),O("tr",{key:o},[$("td",null,$t(a)+":",1),$("td",{innerHTML:l},null,8,Rr)]))),128))])])])}const Mr=ce(Er,[["render",Lr],["__scopeId","data-v-85b541a0"]]),Tr=({core:r})=>{const{windows:e,symbols:t}=r.modules,n=Ae({open:{disabled:!1},edit:{disabled:!1},duplicate:{disabled:!1},container:{disabled:!1},emptyTrashcan:{disabled:!1},discard:{disabled:!1},info:{disabled:!1},webLink:{disabled:!1},webLinkNew:{disabled:!1},webLinkEdit:{disabled:!1}});function i(){const h=t.getSelectedItems(),d=t.getPrimaryWrapper();n.info.disabled=h.length<1,n.open.disabled=h.length<1,n.edit.disabled=h.length<1||h.find(f=>f.locked||f instanceof Z),n.duplicate.disabled=h.length<1||h.find(({fsItem:f})=>f.locked||f instanceof Z||f instanceof le),n.container.disabled=!n.open.disabled||d&&d.fsItem&&(d.fsItem instanceof Ht||d.fsItem.locked)||!d,n.webLinkEdit.disabled=h.length<1||h.find(f=>!f.fsItem.meta.get(y.WEB_URL)),n.webLinkNew.disabled=n.container.disabled,n.webLink.disabled=n.webLinkNew.disabled&&n.webLinkEdit.disabled,n.emptyTrashcan.disabled=h.length<1||h.find(f=>!(f.fsItem instanceof Z)),n.discard.disabled=h.length<1||h.find(({fsItem:f})=>f.locked||f instanceof Z||f instanceof le)}return t.events.subscribe(()=>i()),i(),[{order:1,title:"File",items:[{title:"Open",options:n.open,action:s},{title:"Edit",options:n.edit,action:c},{type:ot.SEPARATOR},{title:"Web Link",options:n.webLink,items:[{title:"New",options:n.webLinkNew,action:l},{title:"Edit",options:n.webLinkEdit,action:o}]},{type:ot.SEPARATOR},{title:"Duplicate",options:n.duplicate,action(){const h=t.getSelectedItems();return Promise.all(h.filter(d=>d.fsItem).map(async({fsItem:d})=>{const f=await d.getPath();return r.executeCommand(`copy "${f}" "${f}" -ignore`)}))}},{title:"Make Dir",options:n.container,async action(){const h=t.getPrimaryWrapper().fsItem,d=jt(await h.getPath(),"Directory");return console.log(`makedir "${d}" -ignore`),r.executeCommand(`makedir "${d}" -ignore`)}},{type:ot.SEPARATOR},{title:"Discard",options:n.discard,action(){const h=t.getSelectedItems();return Promise.all(h.filter(d=>d.fsItem).map(async({fsItem:d})=>{const f=await d.getPath();return r.executeCommand(`remove "${f}" -r`)}))}},{title:"Empty Trashcan",options:n.emptyTrashcan,action(){const h=t.getSelectedItems();return Promise.all(h.filter(d=>d.fsItem).map(async({fsItem:d})=>Promise.all(Array.from((await d.getItems()).values()).map(async f=>{const g=await f.getPath();return r.executeCommand(`remove "${g}" -r -ignore`)}))))}},{type:ot.SEPARATOR},{title:"Info",options:n.info,action(){t.getSelectedItems().filter(d=>d.fsItem).forEach(d=>{e.addWindow({title:`Info File ${d.fsItem.name}`,component:Mr,componentData:{fsItem:R(d.fsItem)},layout:{size:P(460,280)},options:{scaleX:!0,scaleY:!0,prompt:!1,scrollX:!0,scrollY:!0}})})}}]}];function s(){t.getSelectedItems().filter(d=>d.fsItem).forEach(d=>{if(d.command){const f={showCommand:!1,show:!0};return r.executeCommand(d.command,f)}})}async function a({name:h,url:d,symbol:f},g){if(g||(g=await r.executeCommand(`saveFileDialog --id="${ui(h)}"`)),g){const k=r.addExecution();try{const b=g.getPath();await r.executeCommand(`rename "${b}" "${h}" -n`),await r.executeCommand(`editfilemeta "${b}" "${y.WEB_URL}" "${d}"`),await r.executeCommand(`editfilemeta "${b}" "${y.SYMBOL}" "${f}"`)}catch(b){throw k(),new Error(b)}return k(),!0}return!1}function l(){return e.addWindow({title:"Make Link",component:gn,componentData:{model:{actions:{save:a},name:null,url:null,symbol:"default"}},options:{prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}function o(){t.getSelectedItems().filter(d=>d.fsItem).forEach(d=>{const f=d.fsItem;e.addWindow({title:"Edit Link",component:gn,componentData:{fsItem:R(f),model:{actions:{save:a},name:f.name,url:f.meta.get(y.WEB_URL),symbol:f.meta.get(y.SYMBOL)}},options:{prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})})}function c(){t.getSelectedItems().filter(d=>d.fsItem).forEach(d=>{const f=d.fsItem,g=Ae({actions:{save:u},id:f.id,name:f.name});[y.SYMBOL,y.VISIBLE,y.IGNORE_SYMBOL_REARRANGE,y.WINDOW_SCALE,y.WINDOW_SCROLL_X,y.WINDOW_SCROLL_Y,y.WINDOW_FULL_SIZE,y.WINDOW_SYMBOL_REARRANGE,y.WINDOW_SIDEBAR].forEach(k=>{g[String(k)]=f.meta.has(k)?f.meta.get(k):!1}),e.addWindow({title:`Edit File ${f.name}`,component:_r,componentData:{fsItem:R(f),model:g},options:{prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})})}async function u(h,d){const{id:f,name:g}=h,k=d.getPath();if(!f)throw new Error("Id is emoty!");let b;const N=r.addExecution();try{await Promise.all([y.SYMBOL,y.VISIBLE,y.IGNORE_SYMBOL_REARRANGE,y.WINDOW_SCALE,y.WINDOW_SCROLL_X,y.WINDOW_SCROLL_Y,y.WINDOW_FULL_SIZE,y.WINDOW_SYMBOL_REARRANGE,y.WINDOW_SIDEBAR].map(D=>{let M=h[String(D)];return typeof M=="string"&&(M=`"${M}"`),r.executeCommand(`editfilemeta "${k}" "${D}" ${M}`)})),g&&f!==g?await r.executeCommand(`rename "${k}" "${g}" -n`):b=r.executeCommand(`rename "${k}" "${f}" -rn`),b=r.executeCommand(`rename "${k}" "${f}"`)}catch(D){throw N(),new Error(D)}return N(),b}},Or=({module:r})=>{const{fileSystem:e,core:t,disks:n}=r;return[{name:["mountDisk"],description:"Mount Disk",args:[new x({index:0,name:"id",description:"Disk ID"})],async action({id:i},s){const a=t.addExecution(),l=await n[String(i)]();try{const o=await e.addFloppyDisk(l({core:t}));s.message(`Mount Disk <strong>${o.name}</strong> <strong>(${o.id})</strong> successful!`),a()}catch(o){throw console.error(o),w.get("cant_find_disk",i)}}},{name:["changeDirectory","cd"],description:"cd %path%",args:[new x({index:0,name:"path",description:"Directory path"})],async action({path:i}){if(!i)throw w.get("bad_args");try{await e.changeDirectory(i)}catch(s){throw console.error(s),w.get("cant_find",i)}}},{name:["exist"],description:"Check if file exists.",args:[new x({index:0,name:"path",description:"Filename"})],async action({path:i},s){if(!i)throw w.get("bad_args");const a=Y(i),l=await e.exist(i);return l?s.message(`File ${a} exists`):s.message(`File ${a} does not exist`),l}},{name:["makedir","mkdir"],args:[new x({index:0,name:"path",description:"Filename"}),new x({index:1,name:"name",description:"Name"}),new x({name:"ignore",flag:!0,description:"Ignore file exist."})],async action({path:i,name:s,ignore:a},l){if(!i)throw w.get("bad_args");const o=await e.makedir(i,s||Y(i),{ignore:a});return l.message(`Directory "${o.name}" created`),o}},{name:["remove","rm"],args:[new x({index:0,name:"path",description:"Filename"}),new x({name:["recursive","r"],flag:!0,description:"Remove Directory Items and Directories."}),new x({name:["ignore"],flag:!0,description:"Ignore the specified file is deleted."})],async action({path:i,recursive:s,ignore:a},l){if(!i)throw w.get("bad_args");const o=await e.remove(i,s,{ignore:a});return[].concat(o).map(c=>{const u=c.type===xe.NAME?"Directory":"File";return l.message(`Removed ${u}: ${c.name}`),c})}},{name:["readfile","getfile"],description:"Get file content",args:[new x({index:0,name:"path",description:"Filename"})],async action({path:i}){if(!i)throw w.get("bad_args");return(await e.get(i)).data}},{name:["makefile","mkfile"],description:"Creates a file with the specified attributes.",args:[new x({index:0,name:"path",description:"Filename"}),new x({index:1,name:"name",description:"Name"}),new x({index:3,name:"data",description:"Data"}),new x({name:"override",flag:!0,description:"Deletes existing file and recreates."})],async action({path:i,name:s,data:a,override:l=!1},o){if(!i)throw w.get("bad_args");typeof a=="string"&&(a=Tt(a));const c=await e.makefile(i,s,a,{override:l});return o.message(`File "${c.name}" created`),c}},{name:["editfile"],description:"Edits file with specified attributes.",args:[new x({index:0,name:"path",description:"Filename"}),new x({index:1,name:"data",description:"Data"})],async action({path:i,data:s},a){if(!i)throw w.get("bad_args");typeof s=="string"&&(s=Tt(s));const l=await e.editfile(i,s);return a.message(`File "${l.name}" edited`),l}},{name:["editfilemeta"],description:"Edits file with specified attributes.",args:[new x({index:0,name:"path",description:"Filename"}),new x({index:1,name:"name",description:"Name"}),new x({index:2,name:"value",description:"Value"})],async action({path:i,name:s,value:a},l){if(!i)throw w.get("bad_args");const o=await e.editfileMeta(i,s,a);return l.message(`File  "${o.name}" Meta edited`),o}},{name:["makelink","mklink"],description:"Creates a link to the specified path.",args:[new x({index:0,name:"ref",description:"Reference path with id (example.ext)."}),new x({index:1,name:"name",description:"Displayed Name"}),new x({index:2,name:"dest",description:"Destination directory."})],async action({ref:i,name:s,dest:a},l){if(!i)throw w.get("bad_args");a=a||".";const o=await e.get(i),c=await e.makelink(o,s);return await e.get(a)!==e.currentItem&&await e.move(c,a,{ignore:!0}),l.message(`Created link "${s}" with "${await o.getPath()}"`),c}},{name:["editlink"],description:"",args:[new x({index:0,name:"path",description:"Reference filepath with id (example.ext)."}),new x({index:1,name:"ref",description:"Destination directory."})],async action({path:i,ref:s},a){if(!(i&&s))throw w.get("bad_args");const l=await e.get(s),o=await e.editlink(i,l);return a.message(`Edited link "${name}" with "${await l.getPath()}"`),o}},{name:"rename",description:"Renamed a file",args:[new x({index:0,name:"path",description:"Filepath with id (example.ext)."}),new x({index:1,name:"value",description:"Value for id or displayed name."}),new x({name:["name","n"],flag:!0,description:"When set, changes the display name."}),new x({name:["removeName","rn"],flag:!0,description:"When set, removes the display name."})],async action({path:i,value:s,name:a,removeName:l},o){if(!l&&(!i||!s))throw w.get("bad_args");const c=await e.get(i),u=a?c.name:c.id;return await e.rename(i,s,{name:a,removeName:l}),o.message(`Renamed from "${u}" to "${s}"`),c}},{name:["cp","copy"],args:[new x({index:0,name:"from",description:"Source Filepath with id (example.ext)."}),new x({index:1,name:"dest",description:"Destination Filepath with id (example.ext)."}),new x({name:["ignore","i"],flag:!0,description:"When sets, creates a new file if exists."})],async action({from:i,dest:s,ignore:a},l){let o=s;if(!o&&a&&(o=i),!o||!i)throw w.get("bad_args");const c=await e.copy(i,o,{ignore:a});return l.message(`Copied from "${i}" to "${o}"`),c}},{name:["mv","move"],description:"move %from% %to%",args:[new x({index:0,name:"from",description:"From path"}),new x({index:1,name:"to",description:"To path"}),new x({index:2,name:"item-position",description:"Sets the position in the Icon view. (x,y)"})],async action({from:i,to:s,itemPosition:a},l){if(!s||!i)throw w.get("bad_args");const o=new Map;a&&o.set("itemPosition",[0,0].map((h,d)=>{const f=a.split(",");return parseInt(f[Number(d)]||0)}));const c=await e.move(i,s,{meta:o});let u;return c instanceof xe?u="Directory":u="File",l.message(`${u} moved ${c.name}`),c}},{name:["executeFile"],description:"Execute file.",args:[new x({index:0,name:"path",description:"Path to the file"})],async action({path:i}){if(!i)throw w.get("bad_args");const s=await e.get(i);if(typeof s.action=="function")return s.action(t);throw w.get("cant_find_action",i)}}]};w.add("cant_find_action","Can't find action %1");w.add("cant_find_disk","Can't find disk %1");var Je,yn;const Fr=new(yn=class{constructor(){_(this,Je)}get(){return m(this,Je)||A(this,Je,this.getImports())}getImports(){return Promise.all([St(()=>import("./DaABP5qE.js"),__vite__mapDeps([0,1]),import.meta.url),St(()=>import("./DJKZOqNp.js"),__vite__mapDeps([2,1,3]),import.meta.url),St(()=>import("./DxhK5Oma.js"),__vite__mapDeps([4,1]),import.meta.url)]).then(([e,t,n])=>({app:e.default||e,auth:t.default||t,database:n.default||n}))}},Je=new WeakMap,yn),Rt=new Map;class $r{constructor(){p(this,"services");p(this,"app");p(this,"firebase")}get name(){return this.app.name}async connect(e,{apiKey:t,url:n}){if(this.services=await Fr.get(),this.firebase=this.services.app,this.app)Rt.has(e)&&(this.app=Rt.get(e));else{const i=this.services.app.initializeApp({apiKey:t,databaseURL:n},e);Rt.set(i.name,i),this.app=i}return this.app}async disconnect(){if(!this.app)throw w.get("FirebaseWrapper_noApp");Fe(this),await this.logout(),await this.services.app.deleteApp(this.app),this.app=null}get locked(){return!!this.app&&!this.isLogged()}get currentUser(){const{getAuth:e}=this.services.auth;return e(this.app).currentUser}isLogged(){return!!this.app&&!!this.currentUser}login(e,t){const{getAuth:n,signInWithEmailAndPassword:i}=this.services.auth,s=n(this.app);return Fe(this),i(s,e,t)}logout(){if(this.app){const{getAuth:e,signOut:t}=this.services.auth,n=e(this.app);return t(n)}else throw w.get("FirebaseWrapper_notConnected")}remove(e){Fe(this);const{remove:t,ref:n,getDatabase:i}=this.services.database,s=i(this.app),a=n(s,e);return t(a)}get(e){Fe(this);const{ref:t,onValue:n,getDatabase:i}=this.services.database,s=i(this.app),a=t(s,e);return new Promise(l=>{n(a,o=>l(o.val()))})}async set(e,t){Fe(this);const{ref:n,set:i,getDatabase:s}=this.services.database,a=s(this.app),l=n(a,e);return await i(l,t),t}}function Fe(r){if(!r.app)throw w.get("FirebaseWrapper_notConnected")}w.add([["FirebaseWrapper_notConnected",["Not connected","Not connected"]],["FirebaseWrapper_noApp",["No app available","No app available"]],["FirebaseWrapper_hasApp",["App already available",'App "%1" already available']]]);class Pr extends Mn{constructor(e){e=Object.assign({storage:new $r},e),super(e)}mount(e){return e.onDisconnect=()=>{this.unmount()},this.storage.connect(e.id,e).then(()=>this)}unmount(){return this.storage.disconnect().then(()=>this)}async load(){try{let e=await this.storage.get(this.name);return!e&&(e={},!this.storage.locked)?this.storage.set(this.name,e).then(t=>t):(this.data=e,e)}catch(e){throw new Error(e)}}save(e){return e=qn(e),this.data=e||this.data,this.storage.set(this.name,e).then(()=>this.data)}get locked(){return this.storage.locked}}function qn(r){return Object.keys(r).reduce((e,t)=>{const n=e[String(t)];return n&&typeof n=="object"&&qn(n),(n==null||n==="")&&delete e[String(t)],e},r)}const $e=new Map,Wr=({module:r,core:e})=>{const{fileSystem:t}=r;return[{name:"cloudList",args:[new x({name:"json",flag:!0,description:"Get JSON Export"})],action({json:n},i){const s=Array.from($e.values());if(n)return Promise.resolve(s);{const a=new ct;return a.addColumn({value:"Storage (Id)",align:"left",minWidth:15}),a.addColumn({value:"Name",align:"left",minWidth:15}),a.addColumn({value:"Logged In",align:"center",minWidth:9}),a.addRow(s.reduce((l,o)=>(l.push([o.id,o.name,o.storage.storage.isLogged()?"yes":"no"]),l),[])),i.message([a]),Promise.resolve()}}},{name:"cloudMount",args:[new x({index:0,name:"id",flag:!0,description:"Id from Storage."}),new x({index:1,name:"apiKey",description:"Firebase Api-Key."}),new x({index:2,name:"url",description:"Firebase Database-Url."})],async action({id:n,apiKey:i,url:s},a){if(!i||!s)throw w.get("bad_args");const l=e.addExecution(),o=await t.connect(Pr,{id:n,apiKey:i,url:s});return $e.set(o.id,o),a.message(`Mount <strong>${o.name}</strong> <strong>(${o.id})</strong> successful!`),l(),o}},{name:"cloudUnmount",args:[new x({index:0,name:"id",flag:!0,description:"Id from Storage."})],async action({id:n},i){if(!n)throw w.get("bad_args");const s=e.addExecution();try{const a=$e.get(n);await t.disconnect(a),$e.delete(a.id),i.message(`Unmount "${a.name}" successful!`),s()}catch(a){throw s(),new Error(a)}}},{name:"cloudAuth",args:[new x({name:"login",flag:!0,description:"Storage Login"}),new x({name:"logout",flag:!0,description:"Logout from Storage."}),new x({name:"email",description:"Email for Login."}),new x({name:"password",description:"Password for Login."}),new x({name:"storage",description:"Specifies which drive is logged on."})],async action({email:n,password:i,storage:s,login:a,logout:l},o){const c=s;if(!c)throw w.get("bad_args");const u=e.addExecution(),h=$e.get(c);let d;if(h)try{if(a){if(!n||!i)throw w.get("bad_args");d=await h.storage.storage.login(n,i),o.message(`Login with ${h.id} (${h.id}) successful!`)}else l&&(d=await h.storage.storage.logout(),o.message(`Logout from ${h.id} (${h.id}) successful!`))}catch(f){switch(u(),f.code){case"auth/user-not-found":case"auth/wrong-password":return f}throw new Error(f)}else throw new Error(`${c} is not mounted.`);return u(),d}}]},xn=new Wt("web_workbench_FS");var et;class Br extends Ci{constructor({core:t}){super({commands:(...n)=>[...gr(...n),...Or(...n),...Wr(...n)],contextMenu:Tr,core:t});_(this,et,{})}get disks(){return m(this,et)}async addDisks(t){Object.entries(t).forEach(([n,i])=>{m(this,et)[String(n)]=i})}get fileSystem(){return xn}get fs(){return xn}}et=new WeakMap,p(Br,"NAME","Files");const la=new Promise(r=>{/complete|interactive|loaded/.test(document.readyState)?r():document.addEventListener("DOMContentLoaded",r,!1)});var tt;class zr{constructor(){_(this,tt);window.requestAnimationFrame(()=>{document.documentElement.style.overflowY="scroll",A(this,tt,window.innerWidth-document.body.offsetWidth),document.documentElement.style.overflowY=null})}get size(){return m(this,tt)}}tt=new WeakMap;const ca=new zr;function Nr(r,e){return r===e?!0:r.parentElement?r.parentElement!==e?Nr(r.parentElement,e):!0:!1}window.requestAnimationFrame(()=>{document.documentElement.style.overflowY="scroll",window.innerWidth-document.body.offsetWidth,document.documentElement.style.overflowY=null});function Lt(r){if(r.touches&&r.touches.length>0){const e=r.touches[0];r.clientX=e.clientX,r.clientY=e.clientY}return"x"in r||(r.x=r.clientX,r.y=r.clientY),r}var de;class jr{constructor(){_(this,de,new Map);p(this,"capsLockActive",!1);p(this,"shiftLeftActive",!1);p(this,"shiftRightActive",!1);p(this,"cmdLeftActive",!1);p(this,"cmdRightActive",!1);p(this,"altLeftActive",!1);p(this,"altRightActive",!1);p(this,"pointerDown",null);p(this,"pointerUp",null);p(this,"pointerMove",null);p(this,"keyDown",null);p(this,"keyUp",null);this.resize=this.get("resize",window).pipe(fe()),this.pointerDown=this.getPointerDown(),this.pointerUp=this.getPointerUp(),this.pointerMove=this.getPointerMove(),this.keypress=this.get("keypress").pipe(fe()),this.keydown=this.keyDown=this.get("keydown").pipe(fe()),this.keyup=this.keyUp=this.get("keyup").pipe(fe()),this.keyDown.subscribe(({keyCode:e,location:t})=>{switch(e){case 91:this.cmdLeftActive=!0;break;case 93:this.cmdRightActive=!0;break;case 16:t===2?this.shiftRightActive=!0:this.shiftLeftActive=!0;break;case 18:t===2?this.altRightActive=!0:this.altLeftActive=!0;break;case 20:this.capsLockActive=!this.capsLockActive;break}}),this.keyUp.subscribe(({keyCode:e,location:t})=>{switch(e){case 91:this.cmdLeftActive=!1;break;case 93:this.cmdRightActive=!1;break;case 16:t===2?this.shiftRightActive=!1:this.shiftLeftActive=!1;break;case 18:t===2?this.altRightActive=!1:this.altLeftActive=!1;break}})}getPointerDown(e){return this.get("pointerdown",e).pipe(At(t=>Lt(t))).pipe(fe())}getPointerUp(e){return this.get("pointerup",e).pipe(At(t=>Lt(t))).pipe(fe())}getPointerMove(e){return this.get("pointermove",e).pipe(At(t=>Lt(t))).pipe(fe())}get(e,t){t=t||document,m(this,de).has(t)||m(this,de).set(t,new Map);const n=m(this,de).get(t);if(!n.has(e)){const i={passive:!0,capture:!1};n.set(e,bi(t,e,i))}return n.get(e)}reset(){Array.from(m(this,de).values).forEach(e=>e.unsubscribe()),m(this,de).reset()}get cmdActive(){return this.cmdLeftActive||this.cmdRightActive}get altActive(){return this.altLeftActive||this.altRightActive}get shiftActive(){return this.shiftLeftActive||this.shiftRightActive}}de=new WeakMap;let bn;const ua=bn||(bn=new jr);export{x as A,Ii as C,xe as D,kt as F,L as I,Ci as M,pr as P,Kr as R,ct as T,he as W,la as a,Qr as b,Nr as c,ua as d,Ai as e,Dn as f,Mi as g,z as h,st as i,Si as j,hs as k,Ei as l,sa as m,ds as n,aa as o,Jr as p,ar as q,ra as r,ca as s,Lt as t,rn as u,Br as v,fe as w,Oi as x,na as y,ia as z};
