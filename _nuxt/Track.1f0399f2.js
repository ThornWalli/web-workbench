import{g as C,w as f,j as O,k as A,u as x,C as D,r as M,q as d}from"./index.84956bef.js";import{N as w,j as U,g as H,C as n,k as Y,I as N,l as V,m as Z,M as L}from"./index.3dbe7353.js";import{W as K}from"./ContextMenu.48b9e38a.js";import{_ as S,f as y,k as i,l as c,m as h,q as k,N as g,O as I,L as E,M as T,t as b,C as _,S as $,Z as B,W as P,E as z,I as v,z as W,H as R,a3 as F}from"./entry.252f118a.js";import{N as j,T as G,u as q,c as X}from"./Navigation.b9a6ecdc.js";import{T as J}from"./TimelineCanvas.2d445437.js";import"./index.56665add.js";import"./viewport.200bc23a.js";import"./math.2fb9fb52.js";import"./async.6f889d9a.js";const Q={components:{WbEnvMoleculeContextMenu:K},props:{parentLayout:{type:Object,default(){return{size:C(window.innerWidth,window.innerHeight)}}},title:{type:String,default:"Web-Workbench release. Version 1.3"},items:{type:Array,default(){return f.modules.windows.contextMenu.activeItems.items}}},emits:["inputContextMenu"],data(){return{cover:!1}},methods:{onUpdateModelValueContextMenu(...e){this.$emit("inputContextMenu",...e)}}},ee={class:"wb-env-molecule-footer"},te={ref:"menu",class:"menu"};function se(e,s,a,o,r,t){const l=y("wb-env-molecule-context-menu");return i(),c("footer",ee,[h("nav",te,[k(l,{direction:"top",items:a.items,"parent-layout":a.parentLayout,"onUpdate:modelValue":t.onUpdateModelValueContextMenu},null,8,["items","parent-layout","onUpdate:modelValue"])],512)])}const ne=S(Q,[["render",se],["__scopeId","data-v-f49caf4e"]]);const ae=9,oe={props:{selectedNote:{type:w,default:null},size:{type:String,validator:e=>["small","medium","large"].includes(e),default:"large"},showNoteLabels:{type:Boolean,default:!1},startOctave:{type:Number,default:4},octaveCount:{type:Number,default:6}},emits:["down","up"],data:function(){return{keys:[],dimension:C()}},computed:{selectedNotes(){var e;return this.selectedNote&&U((e=this.selectedNote)==null?void 0:e.name)||[]},height(){return{small:140,medium:210,large:280}[this.size]},octaveRange(){const e=[],s=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];for(let a=0;a<this.octaveCount;a++)e.push(...s.map(o=>{const r=`${o}${this.startOctave+a}`;return{note:r,black:this.isBlackKey(r)}}));return this.startOctave+this.octaveCount<=ae&&e.push({note:s[0]+(this.startOctave+this.octaveCount),black:!1}),e},styleClasses(){return{...this.dimension.toCSSVars("dimension"),"--height":this.height,"--keys":this.octaveRange.filter(({black:e})=>!e).length,"--white-keys":this.octaveRange.filter(({black:e})=>!e).length,"--black-keys":this.octaveRange.filter(({black:e})=>e).length}}},mounted(){this.dimension=C(this.$el.offsetWidth,0)},methods:{isBlackKey(e){return/^[a-zA-Z]{2}\d+/.test(e)},onPointerDown(e){this.$emit("down",e)},onPointerUp(e){this.$emit("up",e)}}},re={class:"keys white"},ie=["onPointerdown","onPointerup"],le={key:0},ce={key:0},de={class:"keys black"},ue=["onPointerdown","onPointerup"],he={key:0},me={key:0};function _e(e,s,a,o,r,t){return i(),c("div",{style:T(t.styleClasses),class:"wb-disks-debug-synthesizer-keyboard"},[h("div",null,[h("div",re,[(i(!0),c(g,null,I(t.octaveRange,({note:l,black:u},m)=>(i(),c("div",{key:m,class:E(["key",{black:u,white:!u,selected:t.selectedNotes.includes(l)}]),style:T({"--index":m}),onPointerdown:p=>t.onPointerDown(l),onPointerup:p=>t.onPointerUp(l)},[u?_("",!0):(i(),c("span",le,[a.showNoteLabels?(i(),c("i",ce,b(l),1)):_("",!0)]))],46,ie))),128))]),h("div",de,[(i(!0),c(g,null,I(t.octaveRange,({note:l,black:u},m)=>(i(),c("div",{key:m,class:E(["key",{black:u,white:!u,selected:t.selectedNotes.includes(l)}]),style:T({"--index":m}),onPointerdown:p=>t.onPointerDown(l),onPointerup:p=>t.onPointerUp(l)},[u?(i(),c("span",he,[a.showNoteLabels?(i(),c("i",me,b(l),1)):_("",!0)])):_("",!0)],46,ue))),128))])])],4)}const pe=S(oe,[["render",_e],["__scopeId","data-v-4e246311"]]);const ye={components:{WbEnvMoleculeFooter:ne,Navigation:j,Keyboard:pe,SynthesizerTimelineCanvas:J},props:{...O,model:{type:Object,default:H()},toneDestination:{type:Object,default:null}},emits:[...A],setup(e,s){const a=$(e,"model"),o=x(e,s);B(a,()=>{o.setContextMenu(X,{model:a.value,preserveContextMenu:o.preserveContextMenu})},{immediate:!0,deep:!0});const r=P(a.value[n.SYNTHESIZER_TRACK]),t=P(new G(r));return{...o,...q(),track:r,trackPlayer:t}},data(){return{CONFIG_NAMES:n,currentSequence:null,synth:null,maxLength:11,playing:!1,footerModel:{},windowsModule:z(this.core.modules.windows)}},computed:{selectedNoteIndex(){return this.track.selectedIndex},styleClasses(){return{[`keyboard-alignment-${this.model[n.SYNTHESIZER_KEYBOARD_ALIGNMENT]}`]:!0}},notes:{get(){return this.track.notes},set(e){this.track.notes=e}},showKeyboard(){return this.model[n.SYNTHESIZER_SHOW_KEYBOARD]},keybordData(){return{size:this.model[n.SYNTHESIZER_KEYBOARD_SIZE],showNoteLabels:this.model[n.SYNTHESIZER_SHOW_NOTE_LABELS],selectedNote:this.notes[this.selectedNoteIndex],startOctave:this.model[n.SYNTHESIZER_START_OCTAVE],octaveCount:this.model[n.SYNTHESIZER_OCTAVE_COUNT]}},bpm(){return Number(this.model[n.SYNTHESIZER_BPM])},masterVolume(){return this.core.config.observable[D.SCREEN_CONFIG].soundVolume},decibelValue(){return Y(this.masterVolume)},isMaxLength(){return this.track.octaveCount>=this.maxLength},duration(){return this.model[n.SYNTHESIZER_DURATION]},noteDiagramControlNavigation(){var e;return{model:this.model,items:[[this.trackPlayer.playing?{selected:!0,title:"Pause",disabled:!this.trackPlayer.currentSequence||!this.trackPlayer.playing,onClick:()=>this.onClickPlause()}:{title:"Play",disabled:this.trackPlayer.playing||this.track.notes.length===0,onClick:()=>this.onClickPlay()},{title:"Stop",disabled:!this.trackPlayer.currentSequence,onClick:()=>this.onClickStop()},{title:"Restart",disabled:this.selectedNoteIndex<0,onClick:()=>this.onClickRestart()},{title:"Reset",disabled:this.track.notes.length===0,onClick:()=>this.onClickReset()}],[{disabled:!((e=this.track.getCurrentNote())!=null&&e.isPaused()),title:"Duration",onClick:async()=>{const s=this.track.getCurrentNote();this.preserveContextMenu(!0);const a="Set Duration:",o=await this.core.executeCommand(`openDialog -title="${a}" -prompt -prompt-type=number -prompt-step=0.01 -prompt-value="${s.toSeconds()/2}" -apply="Save" -abort="Cancel"`);o&&(console.log(s),console.log(o),s.duration=Number(o*2),s.time=null),this.preserveContextMenu(!1),this.window.focus()}},{disabled:this.selectedNoteIndex===-1,title:"Replace",name:n.SYNTHESIZER_INPUT_OPERATION,value:N.REPLACE},{disabled:this.selectedNoteIndex===-1,title:"Add",name:n.SYNTHESIZER_INPUT_OPERATION,value:N.ADD},{disabled:this.selectedNoteIndex===-1,title:"Remove",onClick:()=>{this.track.removeNote(this.selectedNoteIndex)}},{spacer:!0},{title:"Prev",disabled:this.selectedNoteIndex<0,onClick:()=>{this.track.selectPrevNote()}},{title:"Next",disabled:this.selectedNoteIndex>=this.track.notes.length-1,onClick:()=>{this.track.selectNextNote()}}]]}},footer(){const e=this.track,s=this.model,a=e.getDuration();return{items:M([{type:d.TEXT,text:`${this.track.selectedIndex}/${this.notes.length}`},{type:d.DEFAULT,title:`Instrument: ${this.track.type}`,items:Object.entries(V()).map(([o,r])=>({type:d.RADIO,title:r,model:e,name:"type",value:o}))},{type:d.SEPARATOR},{title:`Octave: ${s[n.SYNTHESIZER_START_OCTAVE]}-${s[n.SYNTHESIZER_START_OCTAVE]+s[n.SYNTHESIZER_OCTAVE_COUNT]-1}`,items:[{type:d.DEFAULT,title:"Start Octave",items:Array(9).fill({}).map((o,r)=>({type:d.RADIO,title:String(r+1),model:s,name:n.SYNTHESIZER_START_OCTAVE,value:r+1,action(t){if(t=Number(t),t+s[n.SYNTHESIZER_OCTAVE_COUNT]>9){debugger;s[n.SYNTHESIZER_OCTAVE_COUNT]=10-t}}}))},{type:d.DEFAULT,title:"Octave Count",items:Array(10-s[n.SYNTHESIZER_START_OCTAVE]).fill({}).map((o,r)=>({type:d.RADIO,title:String(r+1),model:s,name:n.SYNTHESIZER_OCTAVE_COUNT,value:r+1}))}]},{type:d.SPACER},{type:d.TEXT,text:`Dur.: ${a}`},{type:d.TEXT,text:`BPM: ${this.bpm}`},{type:d.TEXT,text:`${this.decibelValue.toFixed(2)} db`}])}},noteNavigation(){return{model:this.model,items:[[{fill:!0,title:"Pause",onClick:()=>this.addPause()},...Object.entries(Z(!0)).map(([e,s])=>({title:`${s} Note`,name:n.SYNTHESIZER_DURATION,value:e}))],[{fill:!0,title:"Dot",name:n.SYNTHESIZER_INPUT_DOT},{fill:!0,title:"Triplet",name:n.SYNTHESIZER_INPUT_TRIPLET}]]}}},watch:{"trackPlayer.noteIndex"(e){this.track.selectedIndex=e},bpm(){var e;(e=this.trackPlayer)==null||e.stop()},masterVolume:{handler(){L.volume.value=this.decibelValue},immediate:!0},"track.type":{handler(){this.trackPlayer.createInstrument(this.track.type)},immediate:!0}},mounted(){console.log("TRACK",this.track)},unmounted(){this.trackPlayer.destroy()},methods:{async setup(){this.tone.ready||(await this.tone.start(),this.trackPlayer.createInstrument(this.track.type))},onClickReset(){this.trackPlayer.reset(),this.track.selectedIndex=-1},async onClickPlay(){await this.setup(),this.trackPlayer.play(this.selectedNoteIndex)},onClickPlause(){this.trackPlayer.pause()},onClickStop(){this.trackPlayer.stop()},onClickRestart(){this.trackPlayer.restart()},async onClickNote({note:e,selected:s}){await this.setup(),s&&e.name&&this.trackPlayer.instrument.triggerAttackRelease(e.name,e.time)},addPause(){this.noteInput()},noteInput(e,s){const a=new w({name:s,time:this.duration,dot:this.model[n.SYNTHESIZER_INPUT_DOT],triplet:this.model[n.SYNTHESIZER_INPUT_TRIPLET]});console.log(a.notation.toString());const o=this.track.selectedIndex;if(o>-1)switch(e){case N.ADD:return this.track.addNoteTo(o,a);case N.REPLACE:return this.track.replaceNote(o,a)}return this.track.addNote(a)},async onDownKeyboard(e){await this.setup(),this.noteInput(this.model[n.SYNTHESIZER_INPUT_OPERATION],e),this.trackPlayer.instrument.triggerAttack(e)},async onUpKeyboard(){await this.tone.awaitReady,this.trackPlayer.instrument.triggerRelease()}}},ke={key:0,class:"keyboard"},Ne={class:"panel"},Ee={key:0,class:"test"},Te={class:"sheet"};function ve(e,s,a,o,r,t){const l=y("keyboard"),u=y("navigation"),m=y("synthesizer-timeline-canvas"),p=y("wb-env-molecule-footer");return i(),c("div",{class:E(["wb-disks-extras13-synthesizer-track",t.styleClasses])},[h("div",null,[h("div",null,[t.showKeyboard?(i(),c("div",ke,[k(l,v(t.keybordData,{onDown:t.onDownKeyboard,onUp:t.onUpKeyboard}),null,16,["onDown","onUp"]),h("span",{class:E(["message",{show:t.isMaxLength}])},"Octave length is to large…",2)])):_("",!0),t.showKeyboard?(i(),W(u,R(v({key:1},t.noteNavigation)),null,16)):_("",!0)]),h("div",Ne,[t.showKeyboard?(i(),c("div",Ee)):_("",!0),k(u,R(F(t.noteDiagramControlNavigation)),null,16),h("div",Te,[h("div",null,[k(m,{clickable:"",track:o.trackPlayer.track,"onNote:click":t.onClickNote},null,8,["track","onNote:click"])])])])]),k(p,v(t.footer,{"parent-layout":r.windowsModule.contentWrapper.layout}),null,16,["parent-layout"])],2)}const Ae=S(ye,[["render",ve],["__scopeId","data-v-92901258"]]);export{Ae as default};
