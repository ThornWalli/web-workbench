import{E as S}from"./BCPdcavz.js";import{q as h,u as T}from"./BnQx2YJv.js";import{C as x}from"./CxKYomUj.js";import{C as I,P as p}from"./el8-mXfX.js";import{d as y,a as n,b as N,u as B}from"./DcvgOCRL.js";import{S as W}from"./D1A-NVwd.js";import{K as f}from"./B2exwp0w.js";import{O as b,d as K,r as R,k as g,a0 as _,o as P,a1 as C,y as A,z as V,C as D,G as M,_ as Y}from"./BUU1NkbK.js";import{u as F}from"./Xupdrwif.js";import"./DG6QdPnO.js";import"./On0xenC3.js";import"./CZZPvNTk.js";import"./CpIyErmU.js";import"./djI3_XgP.js";import"./D4lI5vpz.js";import"./Ce6njBYG.js";import"./6C4StZv5.js";import"./DdQrQ7-5.js";import"./RAasLaaH.js";import"./BE-N3i2n.js";import"./6jpuwjT2.js";import"./DNvW6rqi.js";import"./DI3A0fxi.js";import"./BlhZwPhK.js";import"./DLyaWjaL.js";import"./BWR5uye1.js";import"./CV0dHcg-.js";import"./BGsde7CB.js";import"./BC_yceLI.js";import"./CHpeLE9u.js";import"./9V19AFUE.js";import"./CaAbksje.js";import"./dQFVkrwK.js";import"./Cc_Og2B_.js";import"./7MFW2ODw.js";const H=y(({core:a,model:t})=>{return[new n({order:0,title:"Editor",items:[new n({title:"New",hotKey:{alt:!0,code:f.KEY_N,title:"N"},action:v}),new n({title:"Open…",hotKey:{alt:!0,code:f.KEY_O,title:"O"},action:w}),new n({title:"Save",hotKey:{alt:!0,code:f.KEY_S,title:"S"},action:l}),new n({title:"Save As…",action:r}),new W,new n({hotKey:{alt:!0,code:f.KEY_I,title:"I"},title:"Info",action(){var e;return(e=t.actions)==null?void 0:e.openInfo()}}),new n({title:"Close",action(){var e;return(e=t.actions)==null?void 0:e.close()}})]}),new n({order:1,title:"Document Settings",items:[new n({title:"Has Window Output",type:N.CHECKBOX,name:x.HAS_WINDOW_OUTPUT,model:t.value})]}),new n({order:1,title:"Run",hotKey:{code:f.KEY_R,title:"R"},action:E}),new n({order:2,title:"Preview",type:N.CHECKBOX,name:I.WEB_BASIC_SHOW_PREVIEW,model:a.config.observable,action({checked:e}){return a.config.set(I.WEB_BASIC_SHOW_PREVIEW,e)}})];function v(){var e;(e=t.actions)==null||e.reset()}function l(){return d()}function r(){return d(!0)}async function d(e=!1){const u={...t.value,content:t.value[p.CONTENT].split(/\n/g)},s=await h(JSON.stringify(u));let i;if(!e&&t.fsItem)return i=await a.executeCommand(`editfile "${t.fsItem.getPath()}" --data="${s}"`),i?a.executeCommand('openDialog "File saved."'):a.executeCommand('openDialog "File could not be saved."');{const c=await a.executeCommand(`saveFileDialog --data="${s}" --extension="bs"`);return c?(t.fsItem=b(c),t.fsItem):null}}async function w(){const e=await a.executeCommand("openFileDialog");if(e)if(p.CONTENT in e.value){const u={...e.value,[p.CONTENT]:[].concat(e.value[p.CONTENT]).join(`
`)};t.fsItem=e.fsItem,t.value=u}else throw new Error("Can't read file content")}async function E(){var u;const e=[];await((u=a.modules.parser)==null?void 0:u.parseBasic(t.value[p.CONTENT].split(/\n/),async(s,i)=>{const c=await a.executeCommand(s,i);return i.message&&(Array.isArray(i.message)?e.push(...i.message):e.push(i.message)),c})),t.output=e.map(s=>T(s))}}),k={class:"wb-disks-extras13-web-basic"},$=K({__name:"WebBasic",props:{model:{}},emits:["refresh","update:value"],setup(a,{emit:t}){const v=R(null),l=t,r=a,{core:d}=B(),{setContextMenu:w,preserveContextMenu:E,parentFocused:e}=F();w(H,{model:r.model}),E();const u=g(()=>r.model.value.content),s=g(()=>{var o;return!!((o=d.value)!=null&&o.config.observable[I.WEB_BASIC_SHOW_PREVIEW])});_(()=>r.model.value,()=>{O()}),_(()=>u.value,o=>{o&&(l("update:value",{...r.model.value,content:o}),C(()=>{var m;(m=v.value)==null||m.resetSelection(),l("refresh",{scroll:!0})}))}),_(()=>s.value,o=>{var m;(m=r.model.actions)==null||m.togglePreview(o)}),P(()=>{s.value&&C(()=>{var o;(o=r.model.actions)==null||o.togglePreview()})});function i(o){l("update:value",{...r.model.value,content:o})}function c(){O()}function O(){C(()=>{l("refresh",{scroll:!0})})}return(o,m)=>(V(),A("div",k,[D(S,{ref:"input","override-focused":M(e)||!1,"model-value":o.model.value.content,"onUpdate:modelValue":i,onRefresh:c},null,8,["override-focused","model-value"])]))}}),he=Y($,[["__scopeId","data-v-9b45f472"]]);export{he as default};
