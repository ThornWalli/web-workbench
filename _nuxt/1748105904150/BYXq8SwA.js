import{i as x,o as ce}from"./BGIFtisS.js";import{v as le}from"./DwXabkis.js";import{d as z}from"./B3mcEltb.js";import{S as ue,a as me,W as fe}from"./DgzoIZwp.js";import{S as pe}from"./BGP_vLXd.js";import{v as y,x as s,y as _,d as ve,k as a,r as c,o as de,a3 as $,Y as ye,W as L,a2 as he,D as d,B as W,G as l,P as Y,N as ke,E as m,A as j,z as G,$ as be,_ as ge}from"./CFj-hhFp.js";import{i as xe}from"./DUL3j0kc.js";import{a as i,b as I,m as Ie}from"./udq3idvc.js";import{S as we}from"./DgH9W2OI.js";import{S as Ce}from"./bZewggTK.js";import{S as _e}from"./6C4StZv5.js";import"./BVsX1iIx.js";import"./D4lI5vpz.js";import"./RAasLaaH.js";import"./DdQrQ7-5.js";import"./nufkX4jA.js";import"./Ce6njBYG.js";import"./DXnSAPcy.js";import"./DN3eHOnZ.js";import"./CSlkdJUE.js";import"./voM2OHtl.js";import"./Lxd48n3n.js";import"./BhtCLcUc.js";const Se={xmlns:"http://www.w3.org/2000/svg",width:"6",height:"10"};function Te(S,h){return s(),y("svg",Se,h[0]||(h[0]=[_("path",{d:"M0 0h2v2h2v2h2v2H4v2H2v2H0z",class:"svg-primary"},null,-1)]))}const Ee={render:Te},Me=["type","name","value","checked"],De={key:1,class:"checkbox"},Oe={class:"title"},Ae={key:2,class:"hotkey"},Be={key:3,class:"indicator-context"},Ne=ve({__name:"MenuItem",props:{item:{},parentLayout:{},tag:{},direction:{},core:{}},emits:["click","update:model-value"],setup(S,{emit:h}){const U="bottom",X={size:le.screenSize},T=a(()=>t.item.items.filter(e=>!(e instanceof we||e instanceof Ce)&&!e.options.disabled).length>0),t=S,k=h,E=c(),q=c(),r=c(),b=c(!1),w=c(!1),f=c(!1),p=c(x(2,3)),M=new _e,J=a(()=>t.item instanceof i&&t.item.type===I.RADIO?"radio":"checkbox"),u=a(()=>{if(t.item instanceof i){const e=t.item.type;return e!==void 0&&[I.CHECKBOX,I.RADIO].includes(e)}return!1}),Q=a(()=>{if(t.item instanceof i)return t.item.title||""}),g=a(()=>{if(t.item instanceof i)return t.item.hotKey}),D=a(()=>t.item instanceof i&&t.item.type===I.RADIO),Z=a(()=>u.value?"label":t.item instanceof i&&t.item.url?"a":"button"),ee=a(()=>{const e={class:"inner",is:void 0};return u.value?e.is="label":t.item instanceof i&&t.item.url&&(e.is="a",e.href=t.item.url),e}),te=a(()=>({focused:b.value,"force-visible":w.value,"context-ready":f.value,"context-halign-left":p.value.x===0,"context-halign-right":p.value.x===2,"context-valign-top":p.value.y===1,"context-valign-bottom":p.value.y===3,disabled:O.value})),O=a(()=>!T.value&&r.value||oe.value.disabled),oe=a(()=>t.item.options);de(()=>{$(()=>{t.item instanceof i&&t.item.hotKey&&M.add(z.keyDown.subscribe(e=>{t.item instanceof i&&t.item.hotKey&&z.resolveHotKey(t.item.hotKey,e)&&ie()}))})}),ye(()=>{M.unsubscribe()});function ne(e,o){k("update:model-value",e,o)}async function ie(){var e;if(t.item instanceof i&&typeof t.item.action=="function")try{await t.item.action()}catch(o){console.error(o),(e=t.core)==null||e.errorObserver.next(o)}else E.value.click()}function ae(e){if(!(t.item instanceof i))return;let o;const n=e.target;D.value?o=n==null?void 0:n.value:o=n==null?void 0:n.checked,xe(o)?t.item.setValue(Number(o)):t.item.setValue(o),k("update:model-value",t.item.name||"",o),typeof t.item.action=="function"&&Promise.resolve(t.item.action(o)).catch(v=>{throw v})}async function se(e){var o;if(e.pointerType===""&&r.value&&T.value&&!f.value&&b.value)A();else if(t.item instanceof i&&!u.value&&typeof t.item.action=="function")try{await t.item.action()}catch(n){console.error(n),(o=t.core)==null||o.errorObserver.next(n)}else k("click",e)}async function re(e){var o;if(t.item instanceof i&&!u.value&&typeof t.item.action=="function")try{await t.item.action()}catch(n){console.error(n),(o=t.core)==null||o.errorObserver.next(n)}else k("click",e)}function A(){f.value||(w.value=!0),B()}function B(){f.value||(f.value=!0,$(()=>{window.setTimeout(()=>{if(r.value&&r.value.$el instanceof HTMLElement){const e=r.value.$el.getBoundingClientRect(),{size:o,position:n}=t.parentLayout||X,v=ce(()=>x(e.left,e.top)-(n.x>0?n:0)+x(e.width,e.height)),R=(t.direction||U)==="bottom";console.log("position.x",v.x),p.value=x(o.x<v.x?0:2,o.y-2<=v.y?R?1:3:R?3:1)}w.value=!1},0)}))}const N=L("addItemFocus"),V=L("removeItemFocus"),F=()=>{b.value=!0,N&&N(t.item.id)},H=a(()=>{var e;return((e=r.value)==null?void 0:e.hasFocusedItem)||!1});let K=-1;he(()=>H.value,e=>{window.clearTimeout(K),K=window.setTimeout(()=>{e||C()},0)});let P=-1;const C=()=>{window.clearTimeout(P),P=window.setTimeout(()=>{H.value||(b.value=!1,V&&V(t.item.id))})};return(e,o)=>(s(),d(Y(e.tag),{class:be(["wb-env-atom-context-menu-item",te.value])},{default:W(()=>[(s(),d(Y(Z.value),ke({ref_key:"clickEl",ref:E,disabled:O.value},ee.value,{onFocus:F,onBlur:C,onClick:se,onPointerover:B,onTouchstart:A}),{default:W(()=>[e.item instanceof m(i)&&u.value?(s(),y("input",{key:0,ref_key:"inputEl",ref:q,type:J.value,name:e.item.name,value:e.item.value,checked:D.value?e.item.getValue()===e.item.value:!!e.item.getValue(),onFocus:F,onBlur:C,onClick:re,onInput:ae},null,40,Me)):l("",!0),u.value?(s(),y("span",De,[j(m(pe))])):l("",!0),_("span",Oe,G(Q.value),1),g.value?(s(),y("span",Ae,[g.value.alt?(s(),d(m(ue),{key:0})):l("",!0),g.value.shift?(s(),d(m(me),{key:1})):l("",!0),_("span",null,G(g.value.title),1)])):l("",!0),e.item.items.length>0?(s(),y("span",Be,[j(m(Ee))])):l("",!0)]),_:1},16,["disabled"])),e.item.items.length>0?(s(),d(fe,{key:0,ref_key:"contextMenuEl",ref:r,core:e.core,items:m(Ie)(e.item.items),"parent-layout":e.parentLayout,onInput:ne},null,8,["core","items","parent-layout"])):l("",!0)]),_:1},8,["class"]))}}),it=ge(Ne,[["__scopeId","data-v-377c9095"]]);export{it as default};
