var he=Object.defineProperty;var ye=(i,n,e)=>n in i?he(i,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[n]=e;var v=(i,n,e)=>ye(i,typeof n!="symbol"?n+"":n,e);import{P as ce,D as me,a as we}from"./BbB_XbY8.js";import{C}from"./BJmh0rUk.js";import{i as t,p as be}from"./BGIFtisS.js";import{v as ge,j as Ee,I as Q,r as Se}from"./DUL3j0kc.js";import{d as X}from"./B3mcEltb.js";import{n as Ie,d as Ce}from"./DXnSAPcy.js";import _e from"./y5SQqNZ3.js";import{u as xe,S as re}from"./udq3idvc.js";import{S as Te}from"./6C4StZv5.js";import{f as ze}from"./Cdv5LwuB.js";import{d as pe,k as m,r as E,J as Oe,a2 as k,o as de,Y as fe,D as ee,x as H,P as ae,N as Me,B as We,y as V,aa as Pe,_ as ve,W as J,M as Fe,a3 as ie,v as le,a0 as Re,a1 as Ne,Z as Ae,$ as Be,E as Le}from"./CFj-hhFp.js";import{g as De,c as ue,d as ke,A as Z}from"./CI_-y7vV.js";import{C as He}from"./DOQHPoIb.js";import{C as N,a as Ve,W as $e,b as Ue,P as Ge}from"./DSfxGD0e.js";const wt=2e3;function bt(){return{[C.SCREEN_1084_FRAME]:!0,[C.SCREEN_REAL_LOOK]:!0,[C.SCREEN_SCAN_LINES]:!0,[C.SCREEN_ACTIVE_ANIMATION]:!0,[C.BOOT_WITH_SEQUENCE]:!0,[C.BOOT_WITH_WEBDOS]:!0,[C.THEME]:ce[me],[C.FILE_EXTENSION_ASSIGNMENT]:[["md","DF0:DocumentReader.app"],["bas","DF1:WebBasic.app"],["basic","DF1:WebBasic.app"]],[C.SCREEN_CONFIG]:{contrast:.5,brightness:.5,color:.5,sharpness:0,horizontalCentering:.5,soundVolume:.5}}}const gt="web_workbench_CONFIG";class je{constructor({name:n,core:e,config:p={},commands:d,contextMenu:b}){v(this,"config");v(this,"commands");v(this,"name");v(this,"core");v(this,"contextMenu");this.name=n||"Module",this.core=e,this.config=p,this.commands=d,this.contextMenu=b}beforeSetup(){var e,p;const n=this.core;n.config.setDefaults(this.config),typeof this.commands=="function"&&(this.commands=De(this.commands({core:n,module:this})),ue.add(this.commands)),typeof this.contextMenu=="function"&&(this.contextMenu=new He(this.contextMenu,{core:n,module:this}),(p=(e=this.core.modules.windows)==null?void 0:e.contextMenu)==null||p.addDefaultItems(this.contextMenu))}setup(){this.log(this.name)}destroy(){Array.isArray(this.commands)&&ue.remove(this.commands)}log(n){this.core.logger.add(n,{namespace:this.name})}}const Ye=["innerHTML"],qe=pe({__name:"Item",props:{parentLayout:{type:Object,default(){return null}},clampGlobal:{type:Boolean,default:!1},container:{type:Boolean,default(){return!1}},item:{type:ge,default(){return{id:null,command:null,model:{title:"Item Title",url:null,symbol:_e,used:!1,visible:!0},layout:{position:t(0,0),size:t(50,50)}}}},scrollOffset:{type:Object,default(){return t(0,0)}},wrapper:{type:Object,default:null}},emits:["click"],setup(i,{emit:n}){var D,se;const e=i,p=m(()=>{var a,c;const r=((a=h==null?void 0:h.symbols.get(y.value.symbol||re.DEFAULT))==null?void 0:a.component)||((c=h==null?void 0:h.symbols.get(re.DEFAULT))==null?void 0:c.component);return r?Pe(r):void 0}),{core:d}=xe(),b=n,O=E(e.wrapper.selectedItems),W=E(!1),l=E(null),M=E(!1),o=Oe({start:t(0,0),move:t(0,0),lastPosition:t(0,0),offset:t(0,0),scrollOffset:t(0,0)}),f=new Te,P=E(null),F=E(null),A=(D=d.value)==null?void 0:D.modules.screen,h=(se=d.value)==null?void 0:se.modules.symbols,B=m(()=>e.item.command),I=m(()=>e.item.id),y=m(()=>e.item.model),g=m(()=>e.item.layout),$=m(()=>y.value.url?"a":"button"),U=m(()=>y.value.url?{href:y.value.url,target:y.value.url?"_blank":null,title:y.value.title}:{}),G=m(()=>(A==null?void 0:A.contentLayout)||{position:t(0,0),size:t(0,0)}),L=m(()=>O.value.includes(I.value)),j=m(()=>({moving:M.value,selected:L.value||W.value,"symbol-used":y.value.used}));k(()=>y.value,()=>{q()},{deep:!0}),de(()=>{var r;F.value=(r=P.value)==null?void 0:r.parentElement,q()}),fe(()=>{f.unsubscribe(),e.wrapper.unselectItem(I)});function _(r){e.item.setLayout(r)}let Y;function q(){_({size:t(200,200)}),window.cancelAnimationFrame(Y),Y=window.requestAnimationFrame(()=>{var a;const r=(a=P.value)==null?void 0:a.children[0];r&&r instanceof HTMLElement&&_({size:t(r.offsetWidth||0,r.offsetHeight||0)})})}function K(r){const{width:a,height:c,left:S,top:w}=r.getBoundingClientRect();return{position:t(S,w),size:t(a,c)}}let z=!1;function s(r){var a;if(!z){const c=I.value;if(y.value.url&&L.value||(r.preventDefault(),y.value.used))return!0;if(B.value&&L.value){const S={showCommand:!1,show:!0};return e.wrapper.unselectItem(c),y.value.used=!0,(a=d.value)==null?void 0:a.executeCommand(B.value,S).then(()=>y.value.used=!1)}X.shiftActive?e.wrapper.isSelectedItem(c)?e.wrapper.unselectItem(c):e.wrapper.selectItem(c):(h&&h.getSelectedItems().length>0&&h.clearSelectedItems(),e.wrapper.selectItem(c)),b("click")}z=!1}function u(r){if(r=Ie(r),z=!1,s(r)){z=!0;return}z=!0,T(t(r.x,r.y))}function x(){if(h){const r=h.getSelectedItems().filter(c=>c.id!==I.value),a=e.wrapper.get(I.value);r.length>0&&a.fsItem instanceof Ee&&r.forEach(c=>e.wrapper.moveItemToItem(c.fsItem,a.fsItem))}}function T(r){if(F.value){const a=K(F.value);o.lastPosition=t(g.value.position.x,g.value.position.y),o.scrollOffset=t(e.scrollOffset.x,e.scrollOffset.y),o.start=r,o.offset=t(()=>o.start-g.value.position),R(r,a,!0),M.value=!0;let c=r;const S=X.pointerMove.subscribe(w=>{c=t(w.x,w.y),R(t(w.x,w.y),a,!0)});f.add(X.pointerUp.pipe(ze()).subscribe(()=>{if(S.unsubscribe(),h&&h.getSecondaryWrapper().id!==e.wrapper.id)return e.wrapper.moveItem(I.value,h.getSecondaryWrapper()).then(w=>{var oe,ne;return w||_({position:t((oe=o.lastPosition)==null?void 0:oe.x,(ne=o.lastPosition)==null?void 0:ne.y)}),l.value=null,M.value=!1,w});if(M.value=!1,R(c,a),!g.value.position.equals(t(()=>o.start-o.offset)))return e.wrapper.savePosition(I.value,g.value.position)}))}}function R(r,a,c=!1){const S={min:t(0,0),max:t(()=>a.size-g.value.size)};o.move=t(()=>r-o.start);let w=t(()=>Math.round(o.start+o.move-o.offset));c?(S.min=a.position,S.max=t(()=>S.max+G.value.position),w=t(()=>Math.round(w+S.min)),e.clampGlobal?l.value=t(()=>Math.max(Math.min(w,G.value.position+e.wrapper.size-g.value.size),S.min)):l.value=w):(e.wrapper.root?_({position:t(()=>Math.max(Math.min(w,e.wrapper.size-g.value.size),0))}):_({position:t(()=>Math.max(w,0))}),l.value=null)}return(r,a)=>(H(),ee(ae($.value),Me(U.value,{ref_key:"rootEl",ref:P,"data-id":I.value,class:["wb-env-atom-symbol-wrapper-item",j.value],style:[g.value.size.toCSSVars("item-size"),(l.value||g.value.position).toCSSVars("item-position")],"touch-action":"none",onFocus:a[0]||(a[0]=c=>W.value=!0),onBlur:a[1]||(a[1]=c=>W.value=!1),onClick:s,onPointerdown:u,onPointerup:x}),{default:We(()=>[V("div",null,[V("i",null,[(H(),ee(ae(p.value)))]),V("span",{class:"label",innerHTML:y.value.title},null,8,Ye)])]),_:1},16,["data-id","class","style"]))}}),Je=ve(qe,[["__scopeId","data-v-d66ba25a"]]),Ke=pe({__name:"SymbolWrapper",props:{clampSymbols:{type:Boolean},wrapperId:{}},emits:["ready","refresh"],setup(i,{emit:n}){var z;const e=E(null),p=E(null),d=E(null),b=i,O=J("window",void 0),W=m(()=>!!O),l=J("parentLayout",m(()=>({position:t(0,0),size:t(window==null?void 0:window.innerWidth,window==null?void 0:window.innerHeight)}))),M=J("parentFocused",!1),o=J("core");if(!o)throw new Error("Core not found");const f=E((z=o==null?void 0:o.modules.symbols)==null?void 0:z.get(b.wrapperId))||E(new Q(o)),P=n,F=m(()=>f.value.items.value),A=E(f.value.selectedItems),h=Fe(o.config.observable),B=m(()=>f.value.layout),I=m(()=>{var s;return{"parent-scrollable":W.value,active:(((s=o.modules.symbols)==null?void 0:s.primaryWrapper)||{}).id===f.value.id}}),y=m(()=>l!=null&&l.value&&"scrollOffset"in l.value?l==null?void 0:l.value.scrollOffset:t(0,0)),g=m(()=>{var u;const s=[(u=y.value)==null?void 0:u.toCSSVars("symbol-wrapper-scroll-offset")];return W.value?s.push($.value.toCSSVars("symbol-wrapper-size")):s.push(B.value.size.toCSSVars("symbol-wrapper-size")),s}),$=m(()=>F.value.map(s=>({item:s,index:A.value.indexOf(s.id)+1})).sort((s,u)=>s.index>u.index?1:s.index<u.index?-1:0).reduce((s,{item:u})=>{const x=u.layout.position.x+u.layout.size.x,T=u.layout.position.y+u.layout.size.y;return s.x=s.x<x?x:s.x,s.y=s.y<T?T:s.y,s},be(0,0))),U=m(()=>h[Se.SHOW_INVISIBLE_SYMBOLS]),G=m(()=>F.value.filter(Y)),L=m(()=>{var s;return((s=l==null?void 0:l.value)==null?void 0:s.size)||t(0,0)});k(()=>M,s=>{j(s)}),k(()=>b.wrapperId,s=>{var u;(u=o.modules.symbols)==null||u.get(s),_()}),k(()=>L,()=>{_()}),k(()=>$,()=>{ie(()=>{P("refresh",{scroll:!0})})}),de(()=>{ie(()=>{_(),j(M),P("ready")})}),fe(()=>{var s,u,x,T,R,D;(s=o.modules.symbols)!=null&&s.getPrimaryWrapper()&&((u=o.modules.symbols)==null?void 0:u.getPrimaryWrapper().id)===f.value.id&&((x=o.modules.symbols)==null||x.setPrimaryWrapper(null)),(T=o.modules.symbols)!=null&&T.getSecondaryWrapper()&&((R=o.modules.symbols)==null?void 0:R.getSecondaryWrapper().id)===f.value.id&&((D=o.modules.symbols)==null||D.setSecondaryWrapper(null))});function j(s=!1){o&&o.modules.symbols&&(s?f.value instanceof Q&&o.modules.symbols.setPrimaryWrapper(f.value):o.modules.symbols.getPrimaryWrapper()&&o.modules.symbols.getPrimaryWrapper().id===f.value.id&&o.modules.symbols.setPrimaryWrapper(null))}function _(){if(e.value&&(l!=null&&l.value)){const{left:s,top:u}=e.value.getBoundingClientRect();f.value.setLayout({position:t(s,u),size:l.value.size}),f.value.setSize(t(e.value.offsetWidth,e.value.offsetHeight)),f.value.setParentSize(l.value.size)}}function Y(s){return U.value||!U.value&&s.model.visible}function q(){var s;f.value instanceof Q&&((s=o==null?void 0:o.modules.symbols)==null||s.setSecondaryWrapper(f.value))}function K(s){(s.target===p.value||s.target===d.value)&&f.value.clearSelectedItems()}return(s,u)=>(H(),le("div",{ref_key:"rootEl",ref:e,class:Be(["wb-env-symbol-wrapper",I.value]),style:Ae(g.value),onPointerdown:K,onPointermove:q},[V("div",{ref_key:"helperEl",ref:p,class:"helper"},null,512),V("div",{ref_key:"itemsEl",ref:d,class:"items"},[(H(!0),le(Re,null,Ne(G.value,(x,T)=>(H(),ee(Je,{key:T,item:x,"clamp-global":s.clampSymbols,wrapper:Le(f),"parent-layout":B.value,"scroll-offset":y.value},null,8,["item","clamp-global","wrapper","parent-layout","scroll-offset"]))),128))],512)],38))}}),Et=ve(Ke,[["__scopeId","data-v-314dd04d"]]);function Qe(i){i=i||document.body,i.requestFullscreen()}function Xe(){document.exitFullscreen()}function Ze(i,n=void 0){i=i||document.body,n||n===void 0&&!te()?Qe(i):Xe()}function te(){return!!document.fullscreenElement}const et=ke(({core:i})=>[{name:["fullscreen"],description:"Toggle Fullscreen",args:[new Z({name:"set",description:"Set Fullscreen"}),new Z({name:"toggle",description:"Toggle Fullscreen",flag:!0}),new Z({name:"is",description:"check fullscreen",flag:!0})],async action({is:n,fullscreen:e,toggle:p}){if(n)return te();if(e||p){let d="Enter Fullscreen?";te()&&(d="Leave Fullscreen?"),await i.executeCommand(`openDialog "${d}" -confirm`)&&Ze(document.body)}}}]);class tt{constructor(){v(this,"cursors");v(this,"current");this.cursors={wait:this.getCursor(N.WAIT),default:this.getCursor(N.POINTER_1)},this.current=this.cursors.default}setWait(n){n?this.current=this.cursors.wait:this.current=this.cursors.default}getCursor(n){return new{[N.POINTER_1]:Ge,[N.POINTER_MOONCITY]:Ue,[N.WAIT]:$e,[N.CROSSHAIR]:Ve}[n]}setCurrent(n){n?this.current=this.getCursor(n):this.current=this.cursors.default}}class st extends je{constructor(e){const{core:p,contentEl:d}={contentEl:void 0,...e};super({name:"Screen",commands:et,core:p});v(this,"defaultTheme");v(this,"currentTheme");v(this,"cursor",new tt);v(this,"contentEl");v(this,"sizes",{content:t(0,0)});v(this,"positions",{content:t(0,0)});v(this,"screenLayout",{size:t(0,0),position:t(0,0)});v(this,"contentLayout",{size:t(0,0),position:t(0,0)});if(this.contentEl=d,this.defaultTheme=this.currentTheme=this.getDefaultTheme(),window===void 0)throw new Error("ScreenControl is only for Browser");Ce.then(this.onReady.bind(this)).catch(b=>{throw b}),p.executionCounter>0&&this.cursor.setWait(!0)}destroy(){window.removeEventListener("resize",this.onResize.bind(this),!1)}updateContentLayout(e){const{x:p,y:d,width:b,height:O}=e.getBoundingClientRect();this.contentLayout={size:t(b,O),position:t(p,d)}}updateScreenLayout(e){const{x:p,y:d,width:b,height:O}=e.getBoundingClientRect();this.screenLayout={size:t(b,O),position:t(p,d)}}getDefaultTheme(){const e=this.core.config.get(C.THEME)||ce[me];return new we("current",e)}setTheme(e){return this.currentTheme=e||this.getDefaultTheme()}onReady(){window.addEventListener("resize",this.onResize.bind(this),!1),this.onResize()}onResize(){if(this.contentEl){const{x:e,y:p,width:d,height:b}=this.contentEl.getBoundingClientRect();this.positions.content=t(e,p),this.sizes.content=t(d,b)}}}v(st,"NAME","Screen");window.oncontextmenu=i=>{i.preventDefault()};export{wt as B,tt as C,je as M,st as S,Et as W,gt as a,bt as g};
