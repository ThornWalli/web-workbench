const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./gQB62WbB.js","./CFj-hhFp.js","./CNkvSXuu.js","./BbB_XbY8.js","./9V19AFUE.js","./BJmh0rUk.js","./KAnfGcyY.js","./C3zvzGZe.css","./BsR3Ui5S.js","./C1HOdXVC.css","./D9g3vngM.js","./B_usvsmx.css","./CKZLeFMq.js","./DL4sgZkQ.css","./ChVszp-0.js","./iKMg5t-_.css","./oJ72Ou0G.js","./xGJLO1N2.css","./DOQHPoIb.js","./udq3idvc.js","./Lxd48n3n.js","./BhtCLcUc.js","./CXbNF4JJ.css","./CL53rMPt.css","./CsXg1R1D.js","./CsMnM4jG.js","./BGP_vLXd.js","./CrXmaguu.js","./F0FTRF2A.css","./DF6iRslq.js","./Btge7-2g.css","./DI8iZKd3.css","./B0AUwh1y.js","./DUL3j0kc.js","./BGIFtisS.js","./RAasLaaH.js","./D4lI5vpz.js","./DdQrQ7-5.js","./6C4StZv5.js","./CSlkdJUE.js","./Cex6JBLo.js","./c1FWBGi4.css","./DSaillMt.css","./BdHpG-VC.js","./CWB9ZL9E.js","./dNcQboSW.css","./CI_-y7vV.js","./Cpj98o6Y.js","./nRhUiaEk.js","./BOg1SlEe.js","./B3mcEltb.js","./DXnSAPcy.js","./DN3eHOnZ.js","./Ce6njBYG.js","./nufkX4jA.js","./y5SQqNZ3.js","./Cdv5LwuB.js","./CGDfseBP.js","./DSfxGD0e.js","./C2mNPf75.css","./BVsX1iIx.js","./DG6QdPnO.js","./CxKYomUj.js","./DgH9W2OI.js","./D0epPD73.js","./BSpeqbCM.css","./RYa94fR2.js","./CdaKXK36.js","./DMzq3-W3.js","./CJLX7oOC.js","./CgK9jdZb.css","./DwvfqCzY.js","./D_5YSAaF.css","./CHFSAOxE.js","./BIzvQSzn.css","./CyKfYv3L.js","./CSWG0BcY.js","./C89Kyn0n.css","./BxFBrjqh.js","./amXuO7Ct.css","./BJWMlV6Z.js","./DyW6dpiX.css","./BLpvwVxa.js","./CXIFHnCy.css"])))=>i.map(i=>d[i]);
var Xt=Object.defineProperty;var wt=n=>{throw TypeError(n)};var Gt=(n,e,t)=>e in n?Xt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var g=(n,e,t)=>Gt(n,typeof e!="symbol"?e+"":e,t),bt=(n,e,t)=>e.has(n)||wt("Cannot "+t);var u=(n,e,t)=>(bt(n,e,"read from private field"),t?t.call(n):e.get(n)),A=(n,e,t)=>e.has(n)?wt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),k=(n,e,t,a)=>(bt(n,e,"write to private field"),a?a.call(n,t):e.set(n,t),t);var K=(n,e,t,a)=>({set _(r){k(n,e,r,t)},get _(){return u(n,e,a)}});import{c as ut}from"./9V19AFUE.js";import{C as jt,d as Ne,A as p,T as Ee,c as be,a as yt,L as et,g as zt,p as Ht}from"./CI_-y7vV.js";import{f as Ct}from"./nRhUiaEk.js";import{g as Kt,T as Wt,u as T,e as $,c as Et,i as q,d as tt,w as Fe,f as Zt,h as at,j as he,D as st,k as Qt,p as qt,l as Me,F as Pe,R as Jt,m as St,n as vt,o as It,S as ea,C as ta,q as aa,a as rt,W as $t,r as C,s as Ue,O as te,t as Re,I as Qe,E as Be}from"./DUL3j0kc.js";import{g as Nt,a as sa,M as Ke,W as ra,S as na}from"./BOg1SlEe.js";import{J as we,I as z,n as ia,M as D,aa as oa,d as Ze,k as O,r as Se,a2 as la,o as ca,a3 as ma,v as ie,x as H,y as J,A as Y,Q as ua,ab as da,B as Ye,D as Xe,G as ue,_ as dt,N as xt,E as Ge,Z as pa}from"./CFj-hhFp.js";import{C as fa}from"./BJmh0rUk.js";import{I as S,u as ha,d as pt,a as N,b as ce,g as ga}from"./udq3idvc.js";import{S as nt}from"./RAasLaaH.js";import{R as wa}from"./BVsX1iIx.js";import{f as it,a as At,l as ba,r as ya,s as Ve,b as Ea}from"./DG6QdPnO.js";import{i as ft}from"./BGIFtisS.js";import{C as Sa,a as va}from"./CxKYomUj.js";import{S as ye}from"./DgH9W2OI.js";import{W as Ia}from"./KAnfGcyY.js";import{W as ge}from"./ChVszp-0.js";import{W as ht}from"./oJ72Ou0G.js";import{W as $a}from"./D0epPD73.js";import{W as Lt}from"./CWB9ZL9E.js";import{u as Na,C as ot}from"./DOQHPoIb.js";import{c as xa}from"./RYa94fR2.js";import{O as Aa,i as Ot}from"./DdQrQ7-5.js";import{f as _t}from"./CdaKXK36.js";import{m as Da,e as Ra}from"./DN3eHOnZ.js";import{p as Ta,a as Pa}from"./DMzq3-W3.js";import{c as Ca}from"./CSlkdJUE.js";var Wa=Array.isArray,La=Object.getPrototypeOf,Oa=Object.prototype,_a=Object.keys;function ka(n){if(n.length===1){var e=n[0];if(Wa(e))return{args:e,keys:null};if(Fa(e)){var t=_a(e);return{args:t.map(function(a){return e[a]}),keys:t}}}return{args:n,keys:null}}function Fa(n){return n&&typeof n=="object"&&La(n)===Oa}function Ma(n,e){return n.reduce(function(t,a,r){return t[a]=e[r],t},{})}function Va(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ta(n),a=Pa(n),r=ka(n),s=r.args,i=r.keys;if(s.length===0)return _t([],t);var o=new Aa(Ba(s,t,i?function(l){return Ma(i,l)}:Ot));return a?o.pipe(Da(a)):o}function Ba(n,e,t){return t===void 0&&(t=Ot),function(a){Dt(e,function(){for(var r=n.length,s=new Array(r),i=r,o=r,l=function(m){Dt(e,function(){var f=_t(n[m],e),y=!1;f.subscribe(Ca(a,function(I){s[m]=I,y||(y=!0,o--),o||a.next(t(s.slice()))},function(){--i||a.complete()}))},a)},c=0;c<r;c++)l(c)},a)}}function Dt(n,e,t){n?Ra(t,n,e):e()}class Ua{constructor(e,t){g(this,"entries",new Map(Object.entries(Nt())));g(this,"observable",we(Nt()));g(this,"storage");g(this,"ready");const a=Kt(t||Wt.NONE);this.storage=new a({name:e}),this.ready=this.storage.load().then(r=>(this.entries=new Map([...this.entries,...r]),Object.assign(this.observable,Object.fromEntries(this.entries)),this)).catch(r=>{throw r})}setDefaults(e){return Promise.all(Object.keys(e).map(t=>{this.has(t)||this.set(t,e[String(t)])}))}get(e){return this.entries.get(e)}has(e){return this.entries.has(e)}set(e,t){return typeof e=="string"?(this.entries.set(e,t),this.observable[String(e)]=t):e&&typeof e=="object"&&!(e instanceof Map)&&Object.keys(e).forEach(a=>{t=e[a],this.entries.set(a,t),this.observable[a]=t}),this.storage.save(Array.from(this.entries))}}class Ya extends jt{constructor(t){super();g(this,"core");this.core=t}prompt(t){const a=["openDialog","--prompt"];return t&&a.push(`--message="${T(t)}"`),this.core.executeCommand(a.join(" "))}confirm(t){const a=["openDialog","--confirm"];return t&&a.push(`--message="${T(t)}"`),this.core.executeCommand(a.join(" "))}}var Ce,We;class Xa{constructor(e){A(this,Ce);A(this,We,[]);k(this,Ce,e)}command(e,t){u(this,We).push({value:e,targetValue:t})}run(){return Promise.all(u(this,We).map(({value:e,targetValue:t})=>u(this,Ce).executeCommand(e).then(a=>{const r=a===t;return r||console.warn(`[ ${e} ]; ${a} === ${t}`),{value:e,targetValue:t,result:a,success:r}})))}async start(){const e=await this.run();return[[e.length,"Tests processed"],[e.filter(t=>t.success).length,"Tests success"],[e.filter(t=>!t.success).length,"Tests failed"]]}}Ce=new WeakMap,We=new WeakMap;const Ga=Ne(({core:n})=>[{name:["execute"],description:"Execute file.",args:[new p({index:0,name:"path",description:"Path to the file"})],async action({path:e}){var s,i;let t=e;const a=new Map(n.config.get(fa.FILE_EXTENSION_ASSIGNMENT));if(!t)throw $.get("bad_args");let r;if(a.has(Et(t))?r=await((s=n.modules.files)==null?void 0:s.fs.get(a.get(Et(t)))):(r=await((i=n.modules.files)==null?void 0:i.fs.get(t)),t=void 0),typeof(r==null?void 0:r.action)=="function")return r.action(n,t);if(r!=null&&r.data&&typeof(r==null?void 0:r.data)=="object"&&"type"in r.data){const o=r.data,l=[`openPreview "${r.getPath()}"`];return o.openMaximized&&l.push("-maximized"),n.executeCommand(l.join(" "))}}},{name:["openColorSettings"],async action(){var t;const e=await z(()=>import("./gQB62WbB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]),import.meta.url).then(a=>a.default);(t=n.modules.windows)==null||t.addWindow({component:e,componentData:{},options:{title:"Color Settings",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}},{name:["openSettings"],async action(){var t;const e=await z(()=>import("./CsXg1R1D.js"),__vite__mapDeps([24,5,6,1,7,14,15,16,17,25,8,9,26,27,28,29,30,19,20,21,22,31]),import.meta.url).then(a=>a.default);(t=n.modules.windows)==null||t.addWindow({component:e,componentData:{},options:{title:"Settings",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1,filled:!0}})}},{name:["echo","print"],args:[new p({name:["newline","n"],flag:!0})],async action({newline:e},t){const a=r=>T(r).replace(/\\"/g,'"').replace(/\\n/g,`
`);if(e)t.message(t.commandArgs.map(r=>a(r)));else{let r=await t.core.executeCommand(t.commandValue);typeof r=="object"&&(r=JSON.stringify(r)),t.message(`${T(a(r))}`)}}},{name:"commands",action(e,t){const a=new Ee({headerPadding:1});return a.addColumns([{value:"Command(s)",align:"left",maxWidth:20},{value:"Description/Arguments",align:"left",maxWidth:60}]),a.addRows(be.items.reduce((r,s)=>{const i=s.args||[],o=[];s.description&&(o.push(s.description),o.push("")),i.length&&(o.push("Arguments:"),o.push(""));const{flagNames:l,kwargNames:c}=i.reduce((f,y)=>{const I=y.name.join(", ");return y.flag?f.flagNames.push({name:`-${I}`,description:y.description}):f.kwargNames.push({name:`--${I}`,description:y.description}),f},{flagNames:[],kwargNames:[]}),m={paddingChr:"Â",showHeaders:!1,config:{name:{minWidth:15},description:{minWidth:10,maxWidth:30}}};return o.push(yt(l,Object.assign({},m))),l.length>0&&c.length>0&&o.push(""),o.push(yt(c,Object.assign({},m))),r.push([s.name.join(", "),o.join(`
`)]),r},[])),t.message(["Commands:",a]),Promise.resolve()}},{name:["CLS","CLEAR"],async action(){n.consoleInterface.clear()}},{name:["prompt","input","PROMPT","INPUT"],args:[new p({index:0,name:"text",description:"Text from prompt."}),new p({index:1,name:"variable",description:"Variable"})],action:({text:e,variable:t,unresolved:a})=>(a.text&&!a.variable?(t=a.text,e=void 0):t=a.variable,n.consoleInterface.prompt(e).then(r=>{var s;return q(r)&&(r=Number(r)),t&&((s=n.modules.parser)==null||s.memory.set(t,r)),r}))},{name:["confirm","CONFIRM"],args:[new p({index:0,name:"text",description:"Text from confirm."})],action({text:e}){return n.consoleInterface.confirm(e)}},{name:["selfCheck"],async action(e,t){const a=new Ee;a.addColumns([{value:"Count",align:"left",minWidth:8},{value:"Description",align:"left",minWidth:15}]),a.addRows(await ja(n)),t.message(['"Command Tests:"',a,'"For failures, look in the web console of the browser."'])}}]);function ja(n){const e=new Xa(n);return e.command('"foo" +"bar"','"foobar"'),e.command("(-3+-6)+1",-8),e.command("(-3-+6)+1",-8),e.command("(-3*-6)+1",-3*-6+1),e.command("(-3/-6)+1",-3/-6+1),e.command("(-3+6)+1",4),e.command("(-3-6)+1",-8),e.command("(-3*6) + 1",-3*6+1),e.command("(-3/6)+1",-3/6+1),e.command("INT(PI)",3),e.command("(POW(2,2)+1)",5),e.command('ASC("D")',68),e.command("CHR$(68)",'"D"'),e.command('LEN("ABC")',3),e.command('"a" + "b"','"ab"'),e.command("STRING$(3,0)",'"000"'),e.command("SQRT(2,2)",Math.sqrt(2)),e.command("128 >> (256 + 5)",4),e.command("-2+4+SQRT(2,2)",2+Math.sqrt(2)),e.command("-2- 2 * 2",-2-2*2),e.command("(1+1)",2),e.command("2*2",2*2),e.command("1+2+3+(POW(2,2)+1)+5*8-(50/2)",6+(2**2+1)+5*8-50/2),e.start()}const{version:za}=ia().public,me=class me{constructor(){g(this,"setupComplete",!1);g(this,"events",D(new nt));g(this,"errorObserver",D(new nt));g(this,"ready",D(new wa(0)));g(this,"modules",{});g(this,"consoleInterface",new Ya(this));g(this,"logger",new et({core:this,debug:!1,consoleInterface:this.consoleInterface}));g(this,"executionCounter",0);g(this,"config",new Ua(sa,Wt.SESSION));this.log(`${me.NAME}; ${me.VERSION}`)}get version(){return me.VERSION}addExecution(){return this.executionCounter++,()=>{this.executionCounter--}}async setup({firebase:e,symbols:t,disks:a}={}){var s,i;if(this.setupComplete)return console.warn("Setup is complete!"),this;this.setupComplete=!0,be.add(zt(Ga({core:this}))),await this.config.ready;const r=Object.values(this.modules);return await Promise.all(r.map(o=>Promise.resolve(o==null?void 0:o.beforeSetup()))),await Promise.all(r.map(o=>Promise.resolve(o==null?void 0:o.setup()))),a&&((s=this.modules.files)==null||s.addDisks(a)),t&&((i=this.modules.symbols)==null||i.addSymbols(t)),e&&await Ct.initApp(e),this.ready.next(this),this}destroy(){be.clear()}addModule(e,t){const a=new e({core:this,...t});this.modules[ut(a.name)]=a}async removeModule(e){await e.destroy(),Reflect.deleteProperty(this.modules,e.name)}executeCommands(e){const t=e.shift();if(t)return this.executeCommand(t).then(()=>this.executeCommands(e))}async executeCommand(e,t){var o,l,c;typeof e=="string"&&(e=e.replace(/(.*[^\\])\n(\S*)/gm,"$1\\n$2"));const a=(t==null?void 0:t.show)||!1,r=[];(Array.isArray(t==null?void 0:t.message)||typeof(t==null?void 0:t.message)=="string")&&r.push(...r.concat(t==null?void 0:t.message));const s={commandBucket:be,core:this,logger:this.logger,show:a,...t,message:m=>{if(a){let f=m;typeof m=="string"&&(m=m.replace(/\\n/g,`
`),f=`"${m}"`),r.push(...[].concat(f))}}};let i;try{if(e){const m=await((o=this.modules.parser)==null?void 0:o.parseCommand(e));m?(l=s.commandBucket)!=null&&l.has(m.command)?i=await Rt(e,m,s.commandBucket,s):be.has(m.command)?i=await Rt(e,m,be,s):(c=this.modules.parser)!=null&&c.mathParser.validInput(e)?i=await this.modules.parser.mathParser.parse(e):/^\w+$/.test(e)&&console.warn(`can\\'t use variable or method "${e}"`):console.warn(`can\\'t parse command "${e}"`)}}catch(m){let f=m;Array.isArray(m)&&(f=new Error(m[m.length-1])),this.errorObserver.next(f)}return i!==void 0&&i!=="undefined"&&typeof i=="string"&&s.show&&r.length<1&&r.push(i),r.forEach(m=>{var f;return(f=s.logger)==null?void 0:f.add(m,{type:et.TYPE.OUTPUT})}),i}addRootItems(e){var a;const t=(a=this.modules.files)==null?void 0:a.fileSystem;return Promise.all(e.map(async({id:r,name:s,data:i,meta:o,items:l})=>{if(l&&l.length){const c=await(t==null?void 0:t.createRootDir("Press","Press",{meta:[[S.WINDOW_SIDEBAR,!1],[S.WINDOW_SCALE,!1],[S.WINDOW_SCROLL_X,!1],[S.WINDOW_SCROLL_Y,!1],[S.POSITION,{x:80,y:320}],[S.WINDOW_SIZE,{x:120,y:120}],[S.IGNORE_SYMBOL_REARRANGE,!0]]}));return c==null||c.addItems(l),c}else return t==null?void 0:t.createRootFile(r,s,i,{meta:o||[]})})).catch(r=>{throw new Error(r)})}log(e){this.logger.add(e,{namespace:"Core"})}};g(me,"VERSION",za||"0.0.0"),g(me,"NAME","web-workbench");let lt=me;async function Rt(n,e,t,a){var s;const r=t.get(e.command);if(r){const i=a.show,o=Ht(r,e),l=await r.action(o,Object.assign({command:e.command,commandValue:e.commandValue,commandArgs:e.args},a));return i&&a.showCommand&&((s=a.logger)==null||s.add("> "+n,{type:et.TYPE.OUTPUT})),l}}function Te(n,e){return n.separator===e}function Ha(n){return{rawCommand:"",mergeArgs:!1,mergeArgsBy:/^[+,]$/,hasProgram:!1,activeArgument:void 0,isLongArgument:!1,isKeyWordArgument:!1,isString:!1,stringTmpValue:void 0,additionSpecial:!1,specialChar:["+",";",","],isBufferWrite:!1,isBufferValue:!1,isBufferString:!1,rawBuffer:void 0,lastChar:void 0,isSeparating:!1,escaped:!1,currentTick:Mt,isClamp:!1,...n,separator:n.separator||kt}}const je="[COMMAND_PARSER_NEW_LINE]";function de(n,{separator:e,forceProgram:t,mergeArgs:a,mergeArgsBy:r}={}){var o,l;const s=Ha({separator:e||kt});n=n.replace("\\n",je),n=`${String(n).trim()}${s.separator}`,s.rawCommand=n,s.mergeArgs=a||!1,s.mergeArgsBy=r||s.mergeArgsBy;const i=[];for(;s.rawCommand.length;){const c=s.rawCommand[0];s.rawCommand=s.rawCommand.slice(1);const m=s.rawCommand[0];if(Te(s,m)){if(s.isSeparating&&Te(s,c))s.isSeparating=!1;else if(!s.isBufferWrite&&Te(s,c)){s.isSeparating=!0;continue}}else s.isSeparating=!1;if((Te(s,c)&&!s.isClamp||s.rawCommand.length<1)&&(!s.escaped&&s.isBufferValue&&!s.isBufferString&&(s.isBufferWrite=!1),!s.isBufferWrite&&(s.isBufferValue&&is(s),s.activeArgument))){ns(s,i);continue}if(c===Ft&&s.activeArgument){s.isKeyWordArgument=!0;continue}else if((c===qe&&(/[ +a-zA-Z]/.test(m)||m===qe)||s.activeArgument&&!s.isKeyWordArgument)&&!s.isBufferWrite&&!s.specialChar.includes(c))if(s.activeArgument){!((l=(o=s.activeArgument)==null?void 0:o.name)!=null&&l.length)&&c===qe?s.isLongArgument=!0:s.activeArgument.name+=c;continue}else{s.activeArgument={name:oe},s.isLongArgument&&(s.activeArgument.long=s.isLongArgument);continue}ss(s,c)}return Ja(i,{forceProgram:t,mergeArgs:a,mergeArgsBy:r})}function Ka(n){var e,t,a;return((e=n.value)==null?void 0:e.type)==="any"&&!n.name&&((t=n.value)==null?void 0:t.raw)&&/^[a-zA-Z]+$/.test((a=n.value)==null?void 0:a.raw)||!1}function Za(n){var e;return((e=n.value)==null?void 0:e.raw)==="+"}function Qa(n,e=/^[+]$/){return n.reduce((t,a)=>{var i,o,l,c,m,f;const r=(o=(i=t[t.length-1])==null?void 0:i.value)==null?void 0:o.raw,s=r&&r[String(r).length-1];if(typeof e=="string"&&(String((l=a.value)==null?void 0:l.raw)===e||String(s)===e)||e instanceof RegExp&&(e.test(String((c=a.value)==null?void 0:c.raw))||e.test(String(s)))){const y=t[t.length-1].value;y&&y.raw&&typeof y.value=="string"&&(y.raw+=(m=a.value)==null?void 0:m.raw,y.value+=((f=a.value)==null?void 0:f.value)||"",y.type="any")}else t.push(a);return t},Array())}function qa(n,e){const t=[];return n&&t.push(n),t.push(...e.map(a=>{var r,s;if(a.plain)return((r=a.value)==null?void 0:r.raw)||a.name||oe;{const i=a.long?"--":"-",o=a.name||oe,l=((s=a.value)==null?void 0:s.raw)||oe,c=a.value?Ft:"";return`${i}${o}${c}${l}`}})),t}function Ja(n,{forceProgram:e,mergeArgs:t,mergeArgsBy:a}={}){var c;const r=n[0],s=n[1];let i;(!s||!Za(s))&&r&&(Ka(r)||e)&&(n=n.filter(m=>m!==r),i=(c=r.value)==null?void 0:c.raw);let o=n;t&&(o=Qa(n,a));const l=qa(i,o);return{program:i==null?void 0:i.replace(je,`
`),args:o,rawArgs:l}}const es="\\",oe="",kt=" ",qe="-",Ft="=",Mt='"',ts="'";function as(n){return n===es}function ss(n,e){as(e)?n.escaped=!0:(!n.escaped&&!n.isBufferValue&&!Te(n,e)?(n.isBufferWrite=!0,n.isBufferValue=!0,(e===ts||e===Mt)&&!n.isClamp&&(n.currentTick=e,n.isBufferString=!0),n.isBufferString=e===n.currentTick,n.rawBuffer=void 0,n.activeArgument=n.activeArgument||{value:void 0,plain:!0}):e===n.currentTick&&n.isBufferString&&!n.escaped&&!n.isClamp&&(n.isBufferWrite=!1),(e!==n.currentTick||n.isClamp||n.escaped&&e===n.currentTick)&&((!n.isBufferWrite&&n.isBufferString||n.isBufferWrite&&!n.isBufferString)&&!n.isClamp&&n.specialChar.includes(e)&&!n.additionSpecial?(n.rawCommand=" "+e+" "+n.rawCommand,n.additionSpecial=!0):(n.additionSpecial=!1,n.rawBuffer=(n.rawBuffer||"")+e)),n.escaped=!1),n.isBufferWrite&&(e==="("?n.isClamp=!0:e===")"&&(n.isClamp=!1)),n.lastChar=e}function rs(n){var e,t,a;return n.plain&&!n.name&&((e=n.value)==null?void 0:e.type)==="any"&&(((t=n.value)==null?void 0:t.raw)===void 0||((a=n.value)==null?void 0:a.raw)===oe)}function ns(n,e){n.activeArgument&&(n.isLongArgument&&(n.activeArgument.long=n.isLongArgument),rs(n.activeArgument)||e.push(n.activeArgument)),n.activeArgument=void 0,n.isLongArgument=!1,n.isKeyWordArgument=!1}function is(n){var t,a;const e=n.rawBuffer||oe;if(n.isBufferString)n.activeArgument.value={type:"string",value:(t=n.rawBuffer)==null?void 0:t.replace(je,`
`),raw:`${n.currentTick}${((a=n.rawBuffer)==null?void 0:a.replace(je,`
`))||""}${n.currentTick}`};else{let r="any",s=e;/^[+-]?\d+$/.test(e)?(r="integer",s=Math.round(Number(e))):/^[+-]?(?:\d+\.?\d*|\.\d+)$/.test(e)?(r="double",s=Number(e)):/^true|false$/.test(e)?(r="boolean",s=e==="true"):/^[a-zA-Z$]+$/.test(e)?(r="any",s=String(e).replace(/ /g,oe)):/^[\d+\-*./a-zA-Z$]+$/.test(e)&&(r="term",s=String(e).replace(/ /g,oe)),n.activeArgument.value={type:r,value:s,raw:n.rawBuffer}}n.rawBuffer=void 0,n.isBufferValue=!1,n.isBufferString=!1}const G=class G{async parse(e){const t=de(e,{forceProgram:!0}),a=await this.getArguments(t);return{origin:e,unresolved:ls(t),args:a.args,kwargs:a.kwargs,command:t.program||"",commandValue:e}}getArguments(e){return{args:e.args.filter(t=>t.plain).map(t=>{if(t.value)return t.value.value}),kwargs:Object.fromEntries(e.args.filter(t=>!t.plain).map(t=>[ut(t.name||""),t.value!==void 0?t.value.value:void 0]))}}static extractStrings(e){let t=!1,a=0;const r=[];let s=!1;for(let o=e.length-1;o>=0;o--){const l=e[Number(o)],c=e[o-1];!s&&l==='"'&&c!=="\\"?t?(t=!1,r.push(e.slice(o,a+1))):(s=!1,t=!0,a=o):(!t&&s||s)&&l==="'"&&c!=="\\"&&(t?(s=!1,t=!1,r.push(e.slice(o,a+1))):(s=!0,t=!0,a=o))}if(t)throw new Error("can't extract values; "+e);return{result:r.reduce((o,l,c)=>o.replace(l,G.resolveKey(c)),e),values:r}}static extractValues(e,t=" "){let a=!1,r=0;const s=[];let i=!1;for(let l=e.length-1;l>=0;l--){const c=e[Number(l)],m=e[l-1];!i&&c==='"'&&m!=="\\"?a?(a=!1,s.push(e.slice(l,r+1))):(i=!1,a=!0,r=l):(!a&&i||i)&&c==="'"&&m!=="\\"&&(a?(i=!1,a=!1,s.push(e.slice(l,r+1))):(i=!0,a=!0,r=l))}if(a)throw new Error("can't extract values; "+e);return s.forEach((l,c)=>{e=e.replace(l,G.resolveKey(c))}),{params:e.split(t).filter(l=>l),values:s}}static resolveKey(e){return`$$$$$$${e}`}static resolveValues({params:e,values:t}){return e.map(a=>G.resolveValue(a,t))}static valueUnresolved(e){return typeof e=="string"&&G.REGEX_VALUE_RESOLVE.test(e)}static resolveValue(e,t){var r;let a=e;if(G.valueUnresolved(e)){if(a=(r=String(e).match(/[$]{3}(\d+)/g))==null?void 0:r.reduce((s,i)=>s.replace(i,t[Number(i.replace(G.REGEX_VALUE_RESOLVE,"$1"))]),String(e)),/[\w]+[$%]?[ ]*\(/.test(a||""))return a;if(typeof a=="string"){if(a==="undefined")return;if(os(a))return Number(a);if(!a.startsWith('"'))return a}}return a}};g(G,"REGEX_VALUE_RESOLVE",/[$]{3}(\d+)/),g(G,"REGEX_COMMAND_REPLACE",/^([a-zA-Z]+[a-zA-Z0-9_]+) (.*)$/),g(G,"REGEX_PARAM_KWARG",/^[-]{0,2}([\\-\w]+)=(.*)$/),g(G,"REGEX_PARAM_ARG",/^[-]{1,2}([\\-\w]+)$/);let U=G;function os(n){return!isNaN(Number(n))}function ls(n){return{args:n.args.filter(e=>e.plain).map(e=>{var t;return((t=e.value)==null?void 0:t.raw)||""}),kwargs:Object.fromEntries(n.args.filter(e=>!e.plain).map(e=>{var t;return[ut(e.name||""),((t=e.value)==null?void 0:t.raw)||""]}))}}var ve;class Vt{constructor(e,t,a,r){g(this,"name");A(this,ve);g(this,"global",!1);g(this,"readonly",!1);this.name=e,k(this,ve,t),this.global=a||this.global,this.readonly=r||this.readonly}get value(){return u(this,ve)}set value(e){this.readonly||k(this,ve,e)}}ve=new WeakMap;class cs extends Vt{constructor(e,t,a=!1){super(e,t,a,!0)}async execute(...e){if(typeof this.value=="function")return this.value(...e)}}class ct extends Vt{}var W,re,M;class gt{constructor(){A(this,W,new Map);A(this,re,new Map);A(this,M,[])}reset(){this.resetPrefixStack(),u(this,W).clear(),u(this,re).clear()}resetPrefixStack(){k(this,M,[])}get prefixStack(){return u(this,M)}get currentPrefixStack(){return u(this,M)[u(this,M).length-1]}has(e){var t;return e=e.replace(/(.*[^ ])[ ]+$/,"$1"),e=e.replace(/[$%]$/,""),(!u(this,W).get(e)||u(this,W).get(e)&&!((t=u(this,W).get(e))!=null&&t.global))&&(e=this.prepareName(e)),u(this,W).has(e)}add(e,t,a=!1,r=!1){e=e.replace(/(.*[^ ])[ ]+$/,"$1"),/\$$/.test(e)?t===void 0&&(t=""):/\\%$/.test(e)&&t===void 0&&(t=0),e=e.replace(/[$%]$/,""),e=this.prepareName(e),this.has(e)||u(this,W).set(e,new ct(e,t,a,r))}get(e){var r;e=e.replace(/(.*[^ ])[ ]+$/,"$1");const t=e;e=e.replace(/[$%]$/,""),(!u(this,W).get(e)||u(this,W).get(e)&&!((r=u(this,W).get(e))!=null&&r.global))&&(e=this.prepareName(e));const a=u(this,W).get(e);if(a){let s=a.value;return s&&typeof s=="string"&&(/\$$/.test(t)?s=String(s):/\\%$/.test(t)||/^\d+$/.test(s)?s=parseInt(s):/^[\d.]+$/.test(s)&&(s=parseFloat(s))),s}}set(e,t,a=!1,r=!1){if(e=e.replace(/(.*[^ ])[ ]+$/,"$1"),typeof t=="string"&&(/[$]$/.test(e)?t===void 0?t="":t=String(t):/[%]$/.test(e)&&(t===void 0?t=0:t=parseInt(t))),e=e.replace(/[$%]$/,""),e=this.prepareName(e),this.has(e)){const s=u(this,W).get(e);s instanceof ct&&s&&(s.value=t)}else this.add(e,t,a,r)}addSub(e,t){e=this.prepareName(e,!1),this.has(e)||u(this,re).set(e,new cs(e,t))}async executeSub(e,t=[],a=!1){t=t||[],e=this.prepareName(e,!1),u(this,M).push({name:`${Math.round(Math.random()*1e4)}`,global:a});const r=u(this,re).get(e);return r==null?void 0:r.execute(...t).then(s=>(u(this,W).forEach(i=>{RegExp(`[$]{3}${u(this,M)[u(this,M).length-1].name}$`).test(i.name)&&u(this,W).delete(i.name)}),u(this,M).pop(),s))}hasSub(e){return e=this.prepareName(e,!1),u(this,re).has(e)}prepareName(e,t=!0){return typeof e=="string"&&(e=e.replace(/ /g,"")),t&&u(this,M).length&&!/[$]{3}/.test(e)&&(e=`${e}$$$${u(this,M)[u(this,M).length-1].name}`),e}get dims(){return u(this,W)}get subs(){return u(this,re)}}W=new WeakMap,re=new WeakMap,M=new WeakMap;var pe,Le,P,j,ae,Oe,_e,B,ke,fe,se,V,ne,Z,Q,Pt;let ms=(Pt=class{constructor(e,t,a,r,s,i){g(this,"debug",!1);A(this,pe);A(this,Le);A(this,P);A(this,j);A(this,ae);A(this,Oe,9999999999);A(this,_e,0);A(this,B);A(this,ke,[]);A(this,fe,0);A(this,se,[]);A(this,V,-1);A(this,ne,[]);A(this,Z,[]);A(this,Q,-1);k(this,ae,e),k(this,j,t||(()=>Promise.resolve(void 0))),k(this,P,a||new gt),k(this,pe,r),k(this,Le,s),this.debug=i!==void 0?i:this.debug}get memory(){return u(this,P)}get lines(){return u(this,ae)}parse(e){var a;e=e||Array().concat(u(this,ae));const t=(a=e.shift())==null?void 0:a.trim();return new Promise(r=>{if(u(this,B)&&t!=="END SUB"){t&&u(this,B).lines.push(t),r(void 0);return}if(u(this,Oe)>0&&u(this,_e)>u(this,Oe))throw new Error("BASIC INTERPRETER OVERFLOW");if(K(this,_e)._++,u(this,Q)>=0){const s=u(this,Z)[u(this,Q)];if(s){if(u(this,Z).forEach(i=>{s.count===0&&i&&t&&i.count===0&&i.lines.push(t)}),t&&(t==="WEND"||/NEXT /.test(t)))return s.condition().then(async i=>{if(s.tmpLines=s.tmpLines||e,i){const o=s.lines;return s.count++,s&&typeof s.step=="function"&&await s.step(),o.length>0?this.parse(Array().concat(o)):(u(this,Z)[u(this,Q)]=!1,K(this,Q)._--,u(this,Z).pop(),null)}else return u(this,Z)[u(this,Q)]=!1,K(this,Q)._--,u(this,Z).pop(),null}).then(r);r(void 0)}else r(void 0)}else r(void 0)}).then(()=>{if(!u(this,B)&&u(this,V)>=-1&&(u(this,ne)[u(this,V)]!==void 0&&u(this,se)[u(this,V)]===void 0&&u(this,se).push(!u(this,ne)[u(this,V)]),t==="ELSE"&&u(this,fe)<1&&(u(this,se)[u(this,V)]=!u(this,se)[u(this,V)])),u(this,se)[u(this,V)])t&&/^IF (\((.*)\)|(.*)) THEN$/.test(t)&&K(this,fe)._++;else return this.parseLine(t,e);return null}).then(()=>(u(this,V)>-1&&(t==="ENDIF"||t==="END IF")&&(u(this,fe)<1?(K(this,V)._--,u(this,ne).pop(),u(this,se).pop()):K(this,fe)._--),e.length?this.parse(e):u(this,ke)))}parseLine(e,t){return new Promise((a,r)=>{if(e=(e||"").replace(/^[ \t]+/g,""),/^ *[#/]+/.test(e)){a(void 0);return}if(/^GOTO +([\w\d]+)$/.test(e)){const s=e.match(/^GOTO +([\w\d]+)$/)||[];this.commandGoto(t,s[1]),e=""}if(/^SUB (.*) STATIC$/.test(e)){const s=e.match(/^SUB (.*) STATIC$/)||[];return this.commandSubStatic(s[1]).then(a)}else{if(e==="END SUB")return this.commandEndSub().then(a);if(u(this,B)){a(void 0);return}}if(/^IF (\((.*)\)|(.*)) THEN$/.test(e)){const s=e.match(/^IF (\((.*)\)|(.*)) THEN$/)||[],i=s[3]||s[2];return this.commandIfThen(i).then(a)}else if(e==="ELSE"||e==="ENDIF"||e==="END IF"){a(void 0);return}if(/^WHILE (.*)$/.test(e)){const s=e.match(/^WHILE (.*)$/)||[];return this.commandWhile(s[1]).then(a)}else if(e==="WEND"){a(void 0);return}if(/^FOR (.*)$/.test(e)){const s=e.match(/^FOR (.*)$/)||[];return this.commandFor(s[1]).then(a)}else if(e.startsWith("NEXT ")){a(void 0);return}if(/^([\w\d]+):$/.test(e)){a(void 0);return}if(/^DIM( SHARED)? +(.*)$/.test(e)){const s=e.match(/^DIM( SHARED)? +(.*)$/)||[];return this.commandDimShared(s[2],!!s[1]).then(a)}if(/^LET +([\w,$%]+)(\((.*)\))? *= *(.*)$/.test(e)){const s=e.match(/^LET +([\w,$%]+)(\((.*)\))? *= *(.*)$/)||[];return this.commandLet(s[1],s[4],s[3]).then(()=>a(void 0))}if(/^READ +([\w, $%]+)$/.test(e)){const s=e.match(/^READ +([\w, $%]+)$/)||[];return this.commandRead(s[1]).then(a)}if(/^END[ ]*$/.test(e))return this.commandEnd().then(a);if(/^(PAUSE|SLEEP) +(.+)/.test(e)){const i=(e.match(/^(PAUSE|SLEEP) +(.+)/)||[])[2];return this.commandPause(i).then(a)}if(/^CALL *(.*)/.test(e)){const s=e.match(/^CALL *(.*)/)||[];return this.commandCall(s[1],t).then(a)}if(/^EXECUTE *(FILE|EVAL) *(.*)/.test(e)){const s=e.match(/^EXECUTE *(FILE|EVAL) *(.*)/)||[];return this.commandExecute(s[1],s[2]).then(a).catch(r)}if(/^PRINT +USING +.*$/.test(e)){const s=e.match(/^PRINT +USING +(.*)$/)||[];return this.commandPrintUsing(s[1]).then(a)}if(/^PRINT +(.*)$/.test(e)){const s=e.match(/^PRINT +(.*)$/)||[];return console.debug("PRINT",s),this.commandPrint(s[1]).then(a)}if(/^DATA +(.*)$/.test(e)){const s=e.match(/^DATA +(.*)$/)||[];return this.commandDataVar(s[1]).then(a)}u(this,j).call(this,e,{show:!0}).then(s=>{s!==void 0&&u(this,ke).push(s)}).then(a).catch(r)})}async setReadStack(e,t){let a=await this.parseValue(t,!0);return typeof a=="string"&&q(a)&&(a=parseFloat(a)),u(this,P).set(e,a,!0)}async addDataStack(e){let t=await this.parseValue(e,!0);return typeof t=="string"&&q(t)&&(t=parseFloat(t)),u(this,pe).push(t)}async setStack({name:e,value:t,index:a,global:r}){let s=await this.parseValue(t,!0);if(typeof s=="string"&&q(s)&&(s=parseFloat(s)),a!==void 0){a=Number(await this.parseValue(a,!0));const i=u(this,P).get(e);if(typeof i=="object")return i[a-1]=s,s;throw new Error(`Index ${a} out of range`)}else return u(this,P).set(e,s,r)}async setGotoMarkStack(e,t){u(this,Le).set(e,await this.parseValue(t,!0))}async parseValue(e,t=!0,a=!1){if(e===void 0)return e;if(Array.isArray(e))return e;if(typeof e=="boolean")return e;if(typeof e=="number")return Number(e);if(typeof e=="string"){if(/^ *(true|false|TRUE|FALSE) *$/.test(e))return e.toLowerCase()==="true";if(/^[\d]+$/.test(e.trim())||/^ *([\\-]?[\d.]+(e[-+]?\d+)?) *$/.test(e.trim()))return parseFloat(e);if(/^ *@"((.|\n)*)" *$/.test(e.trim()))return e.replace(/^ *@"((.|\n)*)" *$/,'"$1"');if(/^"((\\"|[^"])+)"$/.test(e.trim()))return e.trim().replace(/^"((\\"|[^"])+)"$/,'"$1"');if(/^[^"]?(.+)[^"]? *$/.test(e.replace(/ /g,""))){if(e=e.replace(/^ */g,""),u(this,P).has(e.replace(/ /g,"")))return e=e.replace(/ /g,""),this.parseValue(u(this,P).get(e),!0);if(a)throw new Error(`Value processing continues: ${e.slice(0,20)}…'`);return u(this,j).call(this,e,{message:t?void 0:e})}}}async executeCondition(e,t,a){const r=await this.parseValue(e,!0),s=await this.parseValue(a,!0);return/^[=]?==$/.test(t)?r===s:t==="<>"?r!==s:/^([<>][=]|[<>])?$/.test(t)?us(r,t,s):/^!=[=]?$/.test(t)?r!==s:!1}commandIfThen(e){const t=e.match(/([^<>]*) *(<>|<=|>=|<|>|[=!]{2,3}) *([^<>].*)/);return t?this.executeCondition(t[1],t[2],t[3]).then(a=>(u(this,ne).push(a),K(this,V)._++,a)):this.parseValue(e[1],!0).then(a=>{let r=a;return a instanceof ct&&(r=a.value),u(this,ne).push(!!r),K(this,V)._++,r})}commandWhile(e){const t=e.match(/([^<>]*) *(<>|<=|>=|<|>|[=!]{2,3}) *([^<>].*)/);return t?this.executeCondition(t[1],t[2],t[3]).then(a=>{if(a)return u(this,Z).push({count:0,lines:[],condition:()=>this.executeCondition(t[1],t[2],t[3])}),K(this,Q)._++,a}):Promise.resolve(void 0)}async commandFor(e){const t=e.match(/(.*) *= *(.*) +TO +(.*) +STEP[ ](.*)/)||e.match(/(.*) *= *(.*) +TO +(.*)/);if(t){const a=await this.parseValue(t[2],!0),r=await this.parseValue(t[3],!0);u(this,P).set(t[1],a),K(this,Q)._++;const s=async(i=!0)=>{let o=1;return t[4]&&(o=await this.parseValue(t[4],!0)),i&&u(this,P).set(t[1],Number(u(this,P).get(t[1]))+o),o};return u(this,Z).push({step:s,count:0,lines:[],condition:async()=>{const i=await s(!1);return i===0?!1:this.executeCondition(`(${t[1]}  )`,i<0?">":"<",String(r))}})}}commandSubStatic(e){const t=e.match(/^([\w,$%]+)(\((.*)\))?$/)||[],a=t[1],r=U.resolveValues(U.extractValues(t[3]||"",","));return k(this,B,{name:a,lines:[],args:r}),Promise.resolve(void 0)}commandEndSub(){if(u(this,B)){const e=u(this,B).lines,t=u(this,B).args;u(this,P).addSub(u(this,B).name,async(...a)=>{(await Promise.all(t.map((s,i)=>this.parseValue(a[Number(i)]).then(o=>({arg:s,value:o}))))).forEach(({arg:s,value:i})=>{s&&u(this,P).add(String(s),i)}),await this.parse(Array().concat(e))}),k(this,B,void 0)}else throw new Error("has no active SUB");return Promise.resolve(void 0)}commandGoto(e,t){return e.splice(0,e.length),this.parse(u(this,ae).slice(u(this,ae).indexOf(`${t}:`),u(this,ae).length))}commandDimShared(e,t){return U.resolveValues(U.extractValues(e,",")).reduce((r,s)=>{const i=String(s||"").match(/^([\w, $%]+)?(\((.*)\))?$/)||[];return u(this,P).has(i[1])||(i[3]&&(r=r.then(()=>this.parseValue(i[3],!0))),r=r.then(o=>(this.setStack({name:i[1],value:o?Array(o):void 0,global:t}),o))),r},Promise.resolve(void 0))}commandLet(e,t,a){if(u(this,P).has(e))return this.setStack({name:e,value:t,index:a});throw new Error(`Variable ${e} not defined`)}async commandPrintUsing(e){const t=de(e,{mergeArgs:!0,mergeArgsBy:/^[+,]$/}).rawArgs,a=de(t[2],{mergeArgs:!0}).rawArgs.filter(i=>i!==",").map(i=>this.parseValue(i)),r=await Promise.all(a);let s=T(t[0]);for(;s.includes("#");){const i=r.shift(),o=s.match(/(#+\.#+)|(#+)/);if(o&&/(#+\.#+)/.test(o[0])){const[l,c]=o[0].split("."),[m,f]=String(i).split("."),y=it(String(m||"").slice(0,l.length),l.length,!0," ")+"."+it(String(f||"").slice(0,c.length),c.length,!1,"0");s=s.replace(/(#+\.#+)/,T(String(y)))}else s=s.replace(/(#+|#+\.#+)/,T(String(i)))}return u(this,j).call(this,null,{message:`"${T(s)}"`})}commandDataVar(e){if(u(this,pe).length===0)return Promise.all(e.split(",").map(t=>this.addDataStack(t)));throw new Error("DATA has already been declared")}async commandPrint(e){if(/^((".*"|[^"]*);([^;]*))$/.test(e)){const t=e.match(/(.*);(.*)$/)||[],a=await this.parseValue(t[1],!0),{rawArgs:r}=de(String(t[2]),{mergeArgs:!0});let s=await Promise.all(r.map(o=>this.parseValue(o,!0)));s=s.map(o=>T(o));const i=s.map(o=>`${T(a)}${o}`).join(" ");return u(this,j).call(this,null,{message:tt(i)||q(i)?i:`"${i}"`})}else{let t=await this.parseValue(e);const{rawArgs:a}=de(String(t),{mergeArgs:!0});let r=await Promise.all(a.map(s=>this.parseValue(s,!0)));return r=r.map(s=>T(s)),r.length>1?t=r.join(""):t=r[0],u(this,j).call(this,null,{message:tt(t)||q(t)?t:`"${t}"`})}}commandEnd(){return Promise.resolve(void 0)}async commandPause(e){const t=Number(await this.parseValue(e));return new Promise(a=>window.setTimeout(()=>{a(void 0)},t))}commandRead(e){const t=e.split(",");return Promise.all(t.map(a=>{const r=u(this,pe).shift();return this.setReadStack(a,r),Promise.resolve(void 0)}))}commandCall(e,t){const r=(e.match(/([^(]+)\(.*\)/)||[])[1];if(u(this,P).hasSub(r))return this.parseLine(e,t);throw new Error(`SUB ${r} NOT FOUND`)}async commandExecute(e,t){if(!u(this,j))throw new Error("No callback available for readfile");let a;switch(e){case"FILE":if(a=await u(this,j).call(this,`readfile ${t}`,{show:!1}),a&&typeof a=="object"&&"content"in a)return u(this,j).call(this,a.content,{show:!0});throw new Error("File Content is empty");case"EVAL":return this.parseValue(t,!1)}}},pe=new WeakMap,Le=new WeakMap,P=new WeakMap,j=new WeakMap,ae=new WeakMap,Oe=new WeakMap,_e=new WeakMap,B=new WeakMap,ke=new WeakMap,fe=new WeakMap,se=new WeakMap,V=new WeakMap,ne=new WeakMap,Z=new WeakMap,Q=new WeakMap,Pt);function us(n,e,t){switch(n=String(n),t=String(t),(e.match(/^([<>][=]|[<>])$/)||[])[1]){case"<":return parseFloat(n)<parseFloat(t);case">":return parseFloat(n)>parseFloat(t);case"<=":return parseFloat(n)<=parseFloat(t);case">=":return parseFloat(n)>=parseFloat(t);default:return null}}var Ie,$e,ze,He;class ds{constructor(e,t){A(this,Ie);A(this,$e);A(this,ze,new Map);A(this,He,[]);k(this,$e,t),k(this,Ie,e)}get callback(){return u(this,$e)}get memory(){return u(this,Ie)}async parse(e,t,a){if(e.length===0)return;e.length>1&&await this.readData(e);const r=[];return new ms(e,async(i,o)=>{o={...o,...a};const l=await(t||u(this,$e)||(()=>{}))(i,o);return o.show&&l!==void 0&&r.push(l),l},u(this,Ie),u(this,He),u(this,ze)).parse().then(()=>r)}readData(e){const t=e.find(a=>/^[ ]*DATA[ +]/.test(a));if(t){const a=e.splice(e.indexOf(t),1);return this.parse(a)}return Promise.resolve(void 0)}}Ie=new WeakMap,$e=new WeakMap,ze=new WeakMap,He=new WeakMap;function X(...n){if(n.includes(void 0))throw new Error("invalid arguments")}const R={};try{R.brackets=/([^\w$%]?)\(([^\\(\\)]+)\)/,R.brackets_start=/^\((.*)\)$/,R.multiply=new RegExp("[^\\d$\\-\\w]?(?<a>([+-]?[\\w.]+e\\+\\d+)|([+-]?[\\w$%.]+)|(^[+-]?[\\w$%.]+)|([\\w$%.]+)|([$]{3}\\d+))[ ]*(?<operator>[\\^*%\\/]|MOD|XOR|AND|OR|<<|>>|>>>)[ ]*(?<b>([-]?[\\w.]+e\\+\\d+)|([-]?[\\w$%.]+)|(^[+-]?[\\w$%.]+)|([\\w$%.]+)|([$]{3}\\d+))"),R.add_subtract=/([+-]?[\w.]+e\+\d+|[+-]?[\w$%.]+|[$]{3}\d+)[ ]*([+-])[ ]*([+-]?[\w.]+e\+\d+|[+-]?[\w$%.]+|[$]{3}\d+)/,R.function=/([\w]+[a-zA-Z0-9_.]+[$%]?)[ ]*\(([^\\(\\)]*)\)/,R.function_start=/^([\w]+[a-zA-Z0-9_.]+[$%]?)[ ]*\(([^\\(\\)]*)\)/,R.variable=/^([\w]+[a-zA-Z0-9_.]?[$%]?)/,R.number=/^([+-]?[\d.]+e\+\d+|[+-]?[\d.])+($|$)/}catch(n){console.error(n)}class ps{constructor(e,t){g(this,"debug",!1);g(this,"memory");this.memory=this.createMemory(e),this.debug=t!==void 0?t:this.debug}createMemory(e){const t=e||new gt;return t.addSub("RND",()=>Promise.resolve(Math.random())),t.addSub("PI",()=>Promise.resolve(Math.PI)),t.addSub("POW",(a,r)=>{if(X(a,r),typeof a=="string")throw new Error("Parameter is not a number");if(typeof r=="string")throw new Error("Parameter is not B number");return Promise.resolve(a**(r||2))}),t.addSub("SQRT",a=>{if(X(a),typeof a=="string")throw new Error("Parameter is not a number");return Promise.resolve(Math.sqrt(a))}),t.addSub("INT",async a=>(X(a),await parseInt(T(String(a))))),t.addSub("SPC",a=>{if(X(a),typeof a=="string")throw new Error("Parameter is not a number");return Promise.resolve(`"${At(a," ")}"`)}),t.addSub("LEN",a=>(X(a),Promise.resolve(T(String(a)).length))),t.addSub("ASC",a=>(X(a),Promise.resolve(String(T(a)).charCodeAt(0)))),t.addSub("CHR$",a=>{if(X(a),typeof a=="string")throw new Error("Parameter is not a number");return Promise.resolve(Fe(String.fromCharCode(a)))}),t.addSub("LEFT$",(a,r)=>{if(X(a,r),typeof r=="string")throw new Error("Parameter is not B number");return Promise.resolve(`"${ba(T(a),r)}"`)}),t.addSub("RIGHT$",(a,r)=>{if(X(a,r),typeof r=="string")throw new Error("Parameter is not B number");return Promise.resolve(Fe(ya(String(T(a)),r)))}),t.addSub("STRING$",(a,r)=>{if(X(a,r),typeof a=="string")throw new Error("Parameter is not a number");return Promise.resolve(Fe(At(a,String(T(r)))))}),t.addSub("TIME%",()=>Promise.resolve(Date.now())),t.addSub("HEX_ENC$",a=>(X(a),Promise.resolve(Fe(Number(T(a)).toString(16))))),t.addSub("HEX_DEC$",a=>(X(a),a=parseInt(String(T(a)),16),Promise.resolve(a))),t}async parse(e){const a=await new hs(this).parse(e);return this.debug&&console.debug("Result:",typeof a,a),a}validInput(e){return e&&/[/*\-+^()]?/.test(e)}}const fs=5e3;class hs{constructor(e,{debug:t}={}){g(this,"debug",!1);g(this,"parser");g(this,"parsedValues",[]);g(this,"timeout",0);this.parser=e,this.debug=t!==void 0?t:this.debug}async parse(e){if(this.debug&&console.debug("PARSE ".padEnd(20,"-")),this.timeout>fs)throw new Error(`Can't parse ${e}`);this.timeout++;const{result:t,values:a}=U.extractStrings(String(e));let r=de(t).rawArgs;this.parsedValues=this.parsedValues.concat(a),r=r.map(l=>/^MOD|XOR|AND|OR$/.test(l)?` ${l} `:l);let s=r.join("");q(s)?s=Number(s):tt(s)&&(s=!!s);const i=s,o=await this.action(s);if(this.debug&&console.debug("action:",typeof o,o),o!==void 0){let l;return typeof o=="string"&&o!==i&&!/^".*"$/.test(String(o))?(l=await this.parse(o),this.debug&&console.debug("parse:",typeof l,l),l):(l=await this.resolveValue(o),this.debug&&console.debug("$v:",typeof l,l),l)}}async action(e){var t,a,r,s,i,o;if(typeof e=="string"){if((t=R.brackets_start)!=null&&t.test(e)){const l=e.match(R.brackets_start);if(l){const[c,m]=l;e=e.replace(c,m)}else throw new Error("Invalid expression")}if((a=R.function)!=null&&a.test(e)){const l=e.match(R.function);if(l){const[c,m,f,y]=l,I=m||y;let L=de(f||"",{separator:","}).rawArgs;const b=f.includes(",")&&L.join("")!==f;b&&(L=f.split(","));let h=await Promise.all(L.map(d=>this.parse(d)));if(h=b?h:[await this.parse(h.join(""))],this.parser.memory.has(I))return e.replace(c,(r=this.parser.memory.get(I))==null?void 0:r[Number(h[0])-1]);if(this.parser.memory.hasSub(I))return e.replace(c,this.cacheValue(await this.parser.memory.executeSub(I,h)))}}if((s=R.brackets)!=null&&s.test(e)){const l=e.match(R.brackets);if(l){const[c,m,f]=l;return e.replace(c,m+await this.parse(f))}else throw new Error("Invalid expression")}if((i=R.multiply)!=null&&i.test(e))return this.operation(e,R.multiply);if((o=R.add_subtract)!=null&&o.test(e))return this.operation(e,R.add_subtract)}return this.resolveValue(e)}async operation(e,t){const a=e.match(t);if(a){let r,s,i;const o=a[0];"groups"in a&&a.groups?(r=a.groups.a,s=a.groups.b,i=a.groups.operator):(r=a[1],i=a[2],s=a[3]);let l=e,c=await this.parse(r);q(c)||(c=T(c));let m=await this.parse(s);switch(q(m)||(m=T(m)),this.debug&&console.debug({valueA:c,valueB:m}),c=c,m=m,i){case"+":l=c+m;break;case"-":l=c-m;break;case"*":l=c*m;break;case"/":l=c/m;break;case">":l=c>m;break;case"<":l=c<m;break;case"^":l=c^m;break;case"%":l=c%m;break;case"MOD":l=c%m;break;case"AND":l=c&m;break;case"OR":l=c|m;break;case"XOR":l=c^m;break;case"<<":l=c<<m;break;case">>":l=c>>m;break;case">>>":l=c>>>m;break}return q(l)||(l=`"${l}"`),e.replace(o,o.replace(RegExp(`[${r}]{${String(r).length}}[ ]*[${i}]{${String(i).length}}[ ]*[${s}]{${String(s).length}}`),"")+this.cacheValue(l))}else throw new Error("Invalid expression")}async resolveValue(e){var t,a,r;if(typeof e!="function"&&U.valueUnresolved(e))return U.resolveValue(e,this.parsedValues);if(typeof e=="string"){if(e=e.replace(/^[ ]*([^ ].*[^ ])[ ]*$/,"$1"),(t=R.number)!=null&&t.test(e)){if(q(e))return Number(e)}else if((a=R.function_start)!=null&&a.test(String(e))){const s=e.match(R.function_start);if(s){const[,i,o]=s;if(this.parser.memory.hasSub(i))return this.parser.memory.executeSub(i,U.resolveValues(U.extractValues(o,",")));throw new Error(`can't find sub "${i}" in memory`)}else throw new Error("Invalid expression")}else if((r=R.variable)!=null&&r.test(String(e))){const s=e.replace(R.variable,"$1");if(this.parser.memory.hasSub(s))return this.parser.memory.executeSub(s);if(this.parser.memory.has(s))return this.parser.memory.get(s)}}return e}cacheValue(e){return this.parsedValues.push(e),U.resolveKey(this.parsedValues.length-1)}}const gs=["CLS","READ max","DIM fib%(max)","LET fib(1) = 1","LET fib(2) = 2","FOR i=3 TO max","LET fib(i) = fib(i - 2) + fib(i -1)","NEXT i","FOR i=1 TO max","PRINT fib(i)","NEXT i","DATA 10","END"],ws=["CLS","DIM w%,h%,a%","LET w%=12","LET h%=4","LET a%=w%*h%",'PRINT "With the width " + w%','PRINT " and the height " + h%','PRINT " you have the area " + a%'],bs=["CLS","DIM r,a","LET r=5","READ pi","LET a=r*r*pi",'PRINT USING "With the radius ##.##"; r','PRINT USING "we have the area ##.##"; a',"DATA 3.14","END"],ys=["GuessTheNumber","CLS","READ max%","DIM number%, guess%, guesses%",'PRINT "The number is between 1-1000."',"LET number% = INT(RND * max%) + 1","LET guess% = 1","LET guesses% = 0","WHILE guess%<>number%",'PRINT "Guess the number"',"INPUT guess%","IF (guess%<>number%) THEN","IF (guess%>number%) THEN",'PRINT "Your guess was too high"',"ELSE",'PRINT "Your guess was too low"',"ENDIF","ENDIF","LET guesses% = guesses% + 1","WEND",'PRINT USING "You found the number in # tries"; guesses%',"DATA 1000","END"],Es=["DIM result",'PRINT "Calculate the factorial of"',"INPUT n","LET result = 1","FOR i = n TO 1 STEP -1","LET result = result * i","NEXT i",'PRINT USING "#! = #"; n, result',"END"],Ss=["CLS","DIM stars$",'PRINT "Enter the height of the pyramid"',"INPUT height",'LET stars$ = ""',"FOR i = 1 TO height",'LET stars$ = ""',"FOR j = 1 TO (i+i-1)",'LET stars$ = stars$ + "*"',"NEXT j","PRINT SPC(height - i) + stars","NEXT i","END"],vs=['PRINT "Step 1"','PRINT "Step 2"','PRINT "Step 3"',"GOTO ignore",'PRINT "Step 4"',"ignore:",'PRINT "Step 5"'],Is=["DIM A, B","LET A = 2000",'LET B = "Hello World"','PRINT USING "A: #"; A','PRINT USING "B: #"; B'],$s=["DIM A, B","LET A = 1","LET B = 2","IF A == B THEN",'PRINT "true"',"ELSE",'PRINT "false"',"END","IF (A < B) THEN",'PRINT "true"',"END"],Ns=["DIM i%","FOR i% = 1 TO 5",'PRINT USING "For Number #"; i%',"NEXT i%"],xs=["DIM i%","LET i%=0","WHILE i% < 5",'PRINT USING "While Number #"; i%',"LET i% = i% + 1","WEND"],As=["DIM duration","LET duration = 2500",'PRINT USING "Start with Pause #ms"; duration',"PAUSE duration",'PRINT "End Pause"','PRINT USING "Start with Sleep #ms"; duration',"PAUSE duration",'PRINT "End Sleep"'],Ds={Fibonacci:gs,Area:ws,Circle:bs,"Your Name":["CLS",'PRINT "What is your name?"',"INPUT n$",'PRINT "What is your shoe size?"',"INPUT size",'PRINT "Hello "; n$','PRINT USING "your shoe size is ##.##"; size',"END"],GuessTheNumber:ys,Factorial:Es,Pyramid:Ss,"Bubble Sort":["CLS","READ max","DIM SHARED numbers(max)","SUB CreateList(max) STATIC","FOR i=1 TO max","LET numbers(i) = INT(RND * 100)","NEXT i","END SUB","SUB PrintList(max) STATIC","FOR i=1 TO max","PRINT numbers(i)","NEXT i","END SUB","SUB SwapValues(i%, j%) STATIC","LET numbers(i%) = numbers(i%) XOR numbers(j%)","LET numbers(j%) = numbers(i%) XOR numbers(j%)","LET numbers(i%) = numbers(i%) XOR numbers(j%)","END SUB","SUB Sort(max) STATIC","FOR i%=1 TO (max - 1)","FOR j%=i% TO max","IF numbers(i%)>numbers(j%) THEN","CALL SwapValues(i%, j%)","END IF","NEXT j%","NEXT i%","END SUB","CreateList(max)","Sort(max)","PrintList(max)","DATA 10","END"],Goto:vs,Vars:Is,If:$s,For:Ns,"For Step":["CLS","FOR i% = 0 TO 6 STEP 2",'PRINT "For Step Number #"; i%',"NEXT i%"],While:xs,Pause:As},Rs=Ne(({module:n,core:e})=>[{name:["basic"],args:[new p({index:0,name:"path",description:"Path to basic script"})],async action({path:t},a){var s;if(!t)throw $.get("bad_args");const r=await((s=e.modules.files)==null?void 0:s.fileSystem.get(t));if(typeof(r==null?void 0:r.data)=="object"){const i=r.data;if(i.type==="basic"&&Array.isArray(i.content))return n.parseBasic(i.content,void 0,{logger:a.logger})}else throw new Error(`Can't read file ${t}`)}},{name:["basicExamples"],args:[new p({index:0,name:"name",description:"Name from example"})],action({name:t}){return n.parseBasic(Ds[String(t)])}}]);class Ts extends Ke{constructor({core:t}){super({name:"Parser",commands:a=>[...Rs(a)],core:t});g(this,"basicInterpreter");g(this,"memory",D(new gt));g(this,"mathParser",D(new ps(this.memory)));g(this,"commandParser",D(new U));this.basicInterpreter=D(new ds(this.memory,t.executeCommand.bind(t)))}parse(t,a,r){return this.basicInterpreter.parse(t,a,r)}parseBasic(t,a,r={}){let s=t;return Array.isArray(t)||(s=t.split(`
`)),this.basicInterpreter.parse(s,a,r)}async parseCommand(t){return this.commandParser.parse(t)}parseMath(t){return this.mathParser.parse(t)}isMathValue(t){return this.mathParser.validInput(t)}}async function Ps(n,e,t){const a=await n.executeCommand(`exist "${e}"`);let r=!1;a&&(r=await n.executeCommand('openDialog "File exist, overwrite?" --confirm'));const s=[`makefile "${e}"`];return t&&s.push(`--data="${t}"`),r?s.push("--override"):s.push("--ignore"),n.executeCommand(s.join(" "))}async function Cs(n,e){var r;const t=await((r=n.modules.files)==null?void 0:r.fs.get(e)),a=await n.executeCommand(`readfile "${e}"`);return{fsItem:t,value:a}}const Ws=Ne(({module:n,core:e})=>{const{fileSystem:t}=n;return[{name:"openPreview",args:[new p({index:0,name:"path",description:"Path to the file"}),new p({name:"maximized",description:"If set, window is maximized."})],async action({path:a,maximized:r}){var c,m;const s=await t.get(a),{type:i,content:o,openMaximized:l}=s.data;if(i==="basic"&&!s.data[Sa.HAS_WINDOW_OUTPUT])await((c=e.modules.parser)==null?void 0:c.parseBasic(o,async(f,y)=>await e.executeCommand(f,y)));else{const f=await z(()=>import("./B0AUwh1y.js"),__vite__mapDeps([32,33,34,35,36,37,38,20,1,39,19,21,22,40,41,18,42]),import.meta.url).then(y=>y.default);(m=e.modules.windows)==null||m.addWindow({component:f,componentData:{type:i,content:o},options:{title:s.name,scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0},layout:{size:ft(420,360)}},{full:l||r||!1})}}},{name:"saveFileDialog",args:[new p({index:0,name:"data",description:"File Content"}),new p({index:1,name:"id",description:"File Id"}),new p({index:2,name:"extension",description:"File Extension"})],async action({data:a,id:r,extension:s}){var l;const i=await z(()=>import("./BdHpG-VC.js"),__vite__mapDeps([43,6,1,7,14,15,16,17,44,8,9,45,33,34,35,36,37,38,20,39,19,21,22,4,46,47,48,49,3,5,50,51,52,53,54,55,56,57,18,58,59,60,61,62,63,64,65,66,67,68,69,70]),import.meta.url).then(c=>c.default),o=(l=e.modules.windows)==null?void 0:l.addWindow({component:i,componentData:{fsItem:t.root&&D(t.root),id:r},options:{title:"Save File",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}});if(o){const{value:c}=await o.awaitClose();if(c){const m=Zt(c,s),f=await Ps(e,m,a);if(f)return D(oa(f))}}}},{name:"openFileDialog",args:[new p({index:0,name:"type",description:"Type for File or Directory to open."})],async action({type:a}){var o;const r=we({}),s=await z(()=>import("./DwvfqCzY.js"),__vite__mapDeps([71,1,4,46,47,48,33,34,35,36,37,38,20,39,19,21,22,49,3,5,50,51,52,53,54,55,56,57,18,58,59,60,61,62,63,6,7,14,15,16,17,64,65,44,8,9,45,66,67,68,69,72]),import.meta.url).then(l=>l.default),i=(o=e.modules.windows)==null?void 0:o.addWindow({component:s,componentData:{type:a,model:r,fsItem:t.root&&D(t.root)},options:{title:"Open File",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}});if(i){const{value:l}=await i.awaitClose();return l&&Cs(e,l)}}},{name:"fileinfo",description:"Get info from File or Directory",args:[new p({index:0,name:"path",description:"Path to the file"}),new p({index:1,name:"name",description:"Name from the Info"}),new p({index:2,name:["list","ls"],flag:!0,description:"List all Infos"})],async action({path:a,name:r,list:s},i){const o=await t.getItemMetaList(a);if(s){const l=new Ee;l.addColumns([{value:"Name",align:"left",minWidth:20},{value:"Value",align:"left",minWidth:20}]),l.addRows(o.map(({name:c,value:m})=>{let f=m;return Array.isArray(m)&&(f=m.join(" ")),[c,f]})),i.message([l])}else return o.find(l=>l.name===r)}},{name:["info","i"],args:[new p({index:0,name:"path",description:"Path to the file"})],async action({path:a},r){let s=t.root;a&&(s=await t.get(a)),s!=null&&s.parent&&(s=s.parent);const i=await(s==null?void 0:s.getItems()),o=new Ee;o.addColumns([{value:"Unit",align:"left",minWidth:8},{value:"Size",align:"right",minWidth:6},{value:"Used",align:"right",minWidth:6},{value:"Free",align:"right",minWidth:6},{value:"Full",minWidth:4},{value:"Errs",align:"center",minWidth:4},{value:"Status",align:"center",minWidth:10},{value:"Name",align:"right",minWidth:14}]);const l=Array.from((i==null?void 0:i.values())||[]).filter(m=>m instanceof at);o.addRows(l.map(m=>{let f=0;return(m.size>0||m.maxSize>0)&&(f=m.size/m.maxSize*100),[`${m.id}:`,Ve(m.maxSize),Ve(m.size),Ve(m.maxSize-m.size),`${f}%`,"0",m.locked?"Read":"Read/Write",`${m.name||""}`]}));const c=["","Mounted disks:",o,"","Volumes available:"];l.forEach(m=>{c.push(`${m.name}: [Mounted]`)}),c.push(""),r.message(c)}},{name:["list","ls"],args:[new p({index:0,name:"path",description:"Path to the file"}),new p({name:"dir-size",flag:!0,description:"Show Directory Size."})],async action({path:a,dirSize:r},s){let i=t.currentItem;a&&(i=await t.get(a));const o=Array.from((await(i==null?void 0:i.getItems())||[]).values()),l=new Ee;l.addColumns([{value:"Name",align:"left",minWidth:26},{value:"Size",align:"right",minWidth:8},{value:"Access",align:"center",minWidth:12},{value:"Date / Time",align:"center",minWidth:18}]),l.addRows(o.reduce((f,y)=>{let I;y instanceof he&&!r?I="DIR":I=it(Ve(y.size),8,!0,"0");const L=y.isLocked()?"Read":"Read/Write";return f.push([`${y.id}:`,I,L,y.createdDate?Ea("D-mm-y H:I:S",y.createdDate):""]),f},[]));const c=o.reduce((f,y)=>(y instanceof st&&f++,f),0),m=o.reduce((f,y)=>(f+=y.size,f),0);return s.message([l,`${o.length} files - ${c} directories - ${m} blocks used`]),Promise.resolve()}}]}),Ls={class:"wb-module-files-atoms-file-select"},Os=Ze({__name:"FileSelect",props:{modelValue:{},fileSystem:{},fsItem:{},backLabel:{},upLabel:{},downLabel:{},maxVisibleItems:{}},emits:["update:model-value","select","refresh"],setup(n,{emit:e}){const t=e,a=n,r=O(()=>a.backLabel||"../"),s=O(()=>a.upLabel||"Up"),i=O(()=>a.downLabel||"Down"),o=O(()=>a.maxVisibleItems||5),l=O(()=>({title:"",items:L.value,modelValue:a.modelValue,"onUpdate:model-value":w=>{t("update:model-value",w)}})),c=Se(a.fsItem||D(a.fileSystem.root)),m=Se([]),f=Se(0),y=O(()=>({back:!c.value.parent,up:f.value-1<0,down:f.value+1>m.value.length-o.value})),I=O(()=>a.modelValue),L=O(()=>{const w=m.value.slice(f.value,f.value+o.value).map(E=>({label:E.id,value:E.getPath()})).concat(Array(Math.max(o.value-m.value.length,0)).fill({label:"&nbsp;",disabled:!0}));return m.value.length<1&&(w[Math.floor(w.length/2)]={label:"Empty",disabled:!0}),w});la(()=>I.value,async()=>{typeof a.modelValue=="string"&&(c.value=D(await a.fileSystem.get(a.modelValue)),c.value instanceof he&&(m.value=Array.from((await c.value.getItems()).values()).map(D),f.value=0),(c.value instanceof Qt||c.value instanceof he)&&t("select",c.value))}),ca(async()=>{var w;m.value=Array.from((await((w=c.value)==null?void 0:w.getItems())||[]).values()).map(E=>D(E)),ma(()=>{t("refresh",{reset:!0,resize:!1,scroll:!1})})});const b=()=>{var E,v,x,F,_,ee;let w;if(!(c.value instanceof he)&&((v=(E=c.value)==null?void 0:E.parent)!=null&&v.parent)?w=(_=(F=(x=c.value)==null?void 0:x.parent)==null?void 0:F.parent)==null?void 0:_.getPath():c.value.parent&&(w=(ee=c.value.parent)==null?void 0:ee.getPath()),w)t("update:model-value",w);else throw new Error("No parent found")},h=()=>{f.value=Math.max(f.value-1,0)},d=()=>{f.value=Math.min(f.value+1,m.value.length-o.value)};return(w,E)=>(H(),ie("div",Ls,[J("div",null,[Y($a,ua(da(l.value)),null,16)]),J("div",null,[Y(ht,{align:"outer",full:"",direction:"vertical"},{default:Ye(()=>[Y(ge,{"style-type":"secondary",label:r.value,disabled:y.value.back,onClick:b},null,8,["label","disabled"]),Y(ge,{"style-type":"secondary",label:s.value,disabled:y.value.up,onClick:h},null,8,["label","disabled"]),i.value?(H(),Xe(ge,{key:0,"style-type":"secondary",label:i.value,disabled:y.value.down,onClick:d},null,8,["label","disabled"])):ue("",!0)]),_:1})])]))}}),_s=dt(Os,[["__scopeId","data-v-d510f941"]]),ks={class:"wb-module-files-open"};var mt=(n=>(n.FILE="file",n.FOLDER="folder",n.BOTH="both",n))(mt||{});const Ur=Ze({__name:"Open",props:{type:{},fsItem:{},model:{}},emits:["close"],setup(n,{emit:e}){var d,w,E,v;const{core:t}=ha();if(!((d=t.value)!=null&&d.modules.files))throw new Error("Files module not found");Na();const a="file",r=n,s=e,i=Se({...r.model,path:((w=r.model)==null?void 0:w.path)||r.fsItem.getPath()}),o={cancel:"Cancel",open:"Open"},l=O(()=>({label:null,placeholder:"Path…",modelValue:i.value.path})),c=O(()=>({name:"path",modelValue:i.value.path,"onUpdate:model-value":x=>{i.value.path=x},onSelect:L})),m=Se(r.fsItem||((v=(E=t.value)==null?void 0:E.modules.files)==null?void 0:v.fs.root)),f=O(()=>m.value instanceof he),y=O(()=>{const x=r.type||a;return x==="both"||!f.value&&["file"].includes(x)||f.value&&["folder"].includes(x)}),I=O(()=>{var x,F,_;return r.fsItem?r.fsItem:(F=(x=t.value)==null?void 0:x.modules.files)!=null&&F.fs.root?(_=t.value)==null?void 0:_.modules.files.fs.root:null}),L=x=>{m.value=D(x),x instanceof he&&(i.value.path=x.getPath())},b=()=>{s("close")},h=()=>{s("close",i.value.path)};return(x,F)=>(H(),ie("div",ks,[Y(Ia,{onSubmit:h},{default:Ye(()=>{var _,ee,le;return[Y(Lt,xt(l.value,{readonly:""}),null,16),(ee=(_=Ge(t))==null?void 0:_.modules.files)!=null&&ee.fileSystem?(H(),Xe(_s,xt({key:0},c.value,{"file-system":(le=Ge(t))==null?void 0:le.modules.files.fileSystem,"fs-item":I.value}),null,16,["file-system","fs-item"])):ue("",!0),Y(ht,{align:"outer",full:""},{default:Ye(()=>[Y(ge,{"style-type":"secondary",label:o.cancel,onClick:b},null,8,["label"]),Y(ge,{"style-type":"primary",label:o.open,type:"submit",disabled:!y.value},null,8,["label","disabled"])]),_:1})]}),_:1})]))}}),Fs=pt(({core:n})=>{const e=n.modules.symbols||{},t=n.modules.windows||{},a=we({open:{disabled:!1},edit:{disabled:!1},duplicate:{disabled:!1},container:{disabled:!1},emptyTrashcan:{disabled:!1},discard:{disabled:!1},info:{disabled:!1},itemLink:{disabled:!1},itemLinkNew:{disabled:!1},itemLinkEdit:{disabled:!1},webLink:{disabled:!1},webLinkNew:{disabled:!1},webLinkEdit:{disabled:!1}});function r(){const b=e.getSelectedItems()||[],h=e.getPrimaryWrapper();a.info.disabled=b.length<1,a.open.disabled=b.length<1,a.edit.disabled=b.length<1||!!b.find(d=>(d==null?void 0:d.locked)||d instanceof Me),a.duplicate.disabled=b.length<1||!!b.find(({fsItem:d})=>(d==null?void 0:d.locked)||d instanceof Me||d instanceof at),a.container.disabled=!a.open.disabled||h instanceof Pe&&h.fsItem&&(h.fsItem instanceof Jt||h.fsItem.locked)||!h,a.itemLinkEdit.disabled=b.length<1||!!b.find(d=>{var w;return!((w=d==null?void 0:d.fsItem)!=null&&w.meta.get(S.REFERENCE))}),a.itemLinkNew.disabled=a.container.disabled,a.itemLink.disabled=a.itemLinkNew.disabled&&a.itemLinkEdit.disabled,a.webLinkEdit.disabled=b.length<1||!!b.find(d=>{var w;return!((w=d==null?void 0:d.fsItem)!=null&&w.meta.get(S.WEB_URL))}),a.webLinkNew.disabled=a.container.disabled,a.webLink.disabled=a.webLinkNew.disabled&&a.webLinkEdit.disabled,a.emptyTrashcan.disabled=b.length<1||!!b.find(d=>!((d==null?void 0:d.fsItem)instanceof Me)),a.discard.disabled=b.length<1||!!b.find(({fsItem:d})=>(d==null?void 0:d.locked)||d instanceof Me||d instanceof at)}return e.events.subscribe(()=>r()),r(),[new N({order:1,title:"File",items:[new N({title:"Open",options:a.open,action:s}),new N({title:"Edit",options:a.edit,action:y}),new ye,new N({title:"Link",options:a.itemLink,items:[new N({title:"New",options:a.itemLinkNew,action:l}),new N({title:"Edit",options:a.itemLinkEdit,action:c})]}),new N({title:"Web Link",options:a.webLink,items:[new N({title:"New",options:a.webLinkNew,action:m}),new N({title:"Edit",options:a.webLinkEdit,action:f})]}),new ye,new N({title:"Duplicate",options:a.duplicate,action(){const b=e.getSelectedItems()||[];return Promise.all(b.filter(h=>h.fsItem).map(async({fsItem:h})=>{const d=await(h==null?void 0:h.getPath());return n.executeCommand(`copy "${d}" "${d}" -ignore`)}))}}),new N({title:"Make Dir",options:a.container,async action(){var h;const b=(h=e.getPrimaryWrapper())==null?void 0:h.fsItem;if(b){const d=qt(await b.getPath(),"Directory");return console.log(`makedir "${d}" -ignore`),n.executeCommand(`makedir "${d}" -ignore`)}else throw new Error("No item found")}}),new ye,new N({title:"Discard",options:a.discard,action(){const b=e.getSelectedItems()||[];return Promise.all(b.filter(h=>h.fsItem).map(async({fsItem:h})=>{const d=await(h==null?void 0:h.getPath());return n.executeCommand(`remove "${d}" -r`)}))}}),new N({title:"Empty Trashcan",options:a.emptyTrashcan,action(){const b=e.getSelectedItems()||[];return Promise.all(b.filter(h=>h.fsItem).map(async({fsItem:h})=>{const d=await(h==null?void 0:h.getItems())||[];return Promise.all(Array.from(d.values()).map(async w=>{const E=await w.getPath();return n.executeCommand(`remove "${E}" -r -ignore`)}))}))}}),new ye,new N({title:"Info",options:a.info,async action(){const b=e.getSelectedItems()||[];await Promise.all(b.filter(h=>h.fsItem).map(async h=>{if(h.fsItem){const d=await z(()=>import("./CHFSAOxE.js"),__vite__mapDeps([73,61,18,19,1,20,21,22,74]),import.meta.url).then(w=>w.default);t.addWindow({component:d,componentData:{fsItem:D(h.fsItem)},layout:{size:ft(460,280)},options:{title:`Info File ${h.fsItem.name}`,scaleX:!0,scaleY:!0,prompt:!1,scrollX:!0,scrollY:!0}})}else throw new Error(`Item has no fsItem. ${h.id}`)}))}})]})];function s(){(e.getSelectedItems()||[]).filter(h=>h.fsItem).forEach(h=>{if(h.command){const d={showCommand:!1,show:!0};return n.executeCommand(h.command,d)}})}async function i({name:b,path:h,symbol:d},w){if(w||(w=await n.executeCommand(`saveFileDialog --id="${St(b)}"`)),w){const E=n.addExecution();try{const v=w.getPath();await n.executeCommand(`rename "${v}" "${b}" -n`),await n.executeCommand(`editfilemeta "${v}" "${S.REFERENCE}" "${h}"`),await n.executeCommand(`editfilemeta "${v}" "${S.SYMBOL}" "${d}"`)}catch(v){throw E(),v}return E(),!0}return!1}async function o({name:b,url:h,symbol:d},w){if(w||(w=await n.executeCommand(`saveFileDialog --id="${St(b)}"`)),w){const E=n.addExecution();try{const v=w.getPath();await n.executeCommand(`rename "${v}" "${b}" -n`),await n.executeCommand(`editfilemeta "${v}" "${S.WEB_URL}" "${h}"`),await n.executeCommand(`editfilemeta "${v}" "${S.SYMBOL}" "${d}"`)}catch(v){throw E(),v}return E(),!0}return!1}async function l(){const b=await z(()=>import("./CyKfYv3L.js"),__vite__mapDeps([75,6,1,7,14,15,16,17,44,8,9,45,76,12,13,4,18,19,20,21,22,77]),import.meta.url).then(d=>d.default);return t.addWindow({component:b,componentData:{model:{actions:{save:i,selectItem:()=>n.executeCommand(`openFileDialog --type=${mt.BOTH}`)},name:null,url:null,symbol:"default"}},options:{title:"Make Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}async function c(){const b=e.getSelectedItems();await Promise.all(b.filter(h=>h.fsItem).map(async h=>{const d=h.fsItem;if(d){const w=await z(()=>import("./CyKfYv3L.js"),__vite__mapDeps([75,6,1,7,14,15,16,17,44,8,9,45,76,12,13,4,18,19,20,21,22,77]),import.meta.url).then(E=>E.default);t.addWindow({component:w,componentData:{fsItem:D(d),model:{actions:{save:i,selectItem:()=>n.executeCommand(`openFileDialog --type=${mt.BOTH}`)},name:d.name,path:d.meta.get(S.REFERENCE),symbol:d.meta.get(S.SYMBOL)}},options:{title:"Edit Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}else throw new Error(`Item has no fsItem. ${h.id}`)}))}async function m(){const b=await z(()=>import("./BxFBrjqh.js"),__vite__mapDeps([78,6,1,7,14,15,16,17,44,8,9,45,76,12,13,4,18,19,20,21,22,79]),import.meta.url).then(d=>d.default);return t.addWindow({component:b,componentData:{model:{actions:{save:o},name:null,url:null,symbol:"default"}},options:{title:"Make Web Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}async function f(){const b=e.getSelectedItems();await Promise.all(b.filter(h=>h.fsItem).map(async h=>{const d=h.fsItem;if(d){const w=await z(()=>import("./BxFBrjqh.js"),__vite__mapDeps([78,6,1,7,14,15,16,17,44,8,9,45,76,12,13,4,18,19,20,21,22,79]),import.meta.url).then(E=>E.default);t.addWindow({component:w,componentData:{fsItem:D(d),model:{actions:{save:o},name:d.name,url:d.meta.get(S.WEB_URL),symbol:d.meta.get(S.SYMBOL)}},options:{title:"Edit Web Link",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}else throw new Error(`Item has no fsItem. ${h.id}`)}))}async function y(){const b=e.getSelectedItems();await Promise.all(b.filter(h=>h.fsItem).map(async h=>{const d=h.fsItem;if(d){const w=we({actions:{save:L},id:d.id,name:d.name});[S.SYMBOL,S.VISIBLE,S.IGNORE_SYMBOL_REARRANGE,S.WINDOW_SCALE,S.WINDOW_SCROLL_X,S.WINDOW_SCROLL_Y,S.WINDOW_FULL_SIZE,S.WINDOW_SYMBOL_REARRANGE,S.WINDOW_SIDEBAR].forEach(v=>{w[v]=d.meta.has(v)?d.meta.get(v):!1});const E=await z(()=>import("./BJWMlV6Z.js"),__vite__mapDeps([80,6,1,7,14,15,16,17,44,8,9,45,76,12,13,4,25,26,27,28,19,20,21,22,18,81]),import.meta.url).then(v=>v.default);t.addWindow({component:E,componentData:{fsItem:D(d),model:w},options:{title:`Edit File ${d.name}`,prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}else throw new Error(`Item has no fsItem. ${h.id}`)}))}function I(){return[S.SYMBOL,S.VISIBLE,S.IGNORE_SYMBOL_REARRANGE,S.WINDOW_SCALE,S.WINDOW_SCROLL_X,S.WINDOW_SCROLL_Y,S.WINDOW_FULL_SIZE,S.WINDOW_SYMBOL_REARRANGE,S.WINDOW_SIDEBAR]}async function L(b,h){const{id:d,name:w}=b,E=h.getPath();if(!d)throw new Error("Id is emoty!");let v;const x=n.addExecution();try{await Promise.all(I().map(F=>{let _=b[F];return typeof _=="string"&&(_=`"${_}"`),n.executeCommand(`editfilemeta "${E}" "${F}" ${_}`)})),w&&d!==w?v=await n.executeCommand(`rename "${E}" "${w}" -n`):v=await n.executeCommand(`rename "${E}" "${d}" -rn`),v=n.executeCommand(`rename "${E}" "${d}"`)}catch(F){throw x(),F}return x(),v}}),Ms=Ne(({module:n})=>{const{fileSystem:e,core:t,disks:a}=n;return[{name:["mountDisk"],description:"Mount Disk",args:[new p({index:0,name:"id",description:"Disk ID"})],async action({id:r},s){const i=t.addExecution();try{const o=await a[r].data(),l=await e.addFloppyDisk(()=>o({core:t}));a[r].hidden||s.message(`Mount Disk <strong>${l.name}</strong> <strong>(${l.id})</strong> successful!`),i()}catch(o){throw console.error(o),$.get("cant_find_disk",r)}}},{name:["changeDirectory","cd"],description:"cd %path%",args:[new p({index:0,name:"path",description:"Directory path"})],async action({path:r}){if(!r)throw $.get("bad_args");try{await e.changeDirectory(r)}catch(s){throw console.error(s),$.get("cant_find",r)}}},{name:["exist"],description:"Check if file exists.",args:[new p({index:0,name:"path",description:"Filename"})],async action({path:r},s){if(!r)throw $.get("bad_args");const i=vt(r),o=await e.exist(r);return o?s.message(`File ${i} exists`):s.message(`File ${i} does not exist`),o}},{name:["makedir","mkdir"],args:[new p({index:0,name:"path",description:"Filename"}),new p({index:1,name:"name",description:"Name"}),new p({name:"ignore",flag:!0,description:"Ignore file exist."})],async action({path:r,name:s,ignore:i},o){if(!r)throw $.get("bad_args");const l=await e.makedir(r,s||vt(r),{override:i});return o.message(`Directory "${l.name}" created`),l}},{name:["remove","rm"],args:[new p({index:0,name:"path",description:"Filename"}),new p({name:["recursive","r"],flag:!0,description:"Remove Directory Items and Directories."}),new p({name:["ignore"],flag:!0,description:"Ignore the specified file is deleted."})],async action({path:r,recursive:s,ignore:i},o){if(!r)throw $.get("bad_args");return(await e.remove(r,s,{ignore:i})||[]).map(c=>{const m=c.type===st.TYPE?"Directory":"File";return o.message(`Removed ${m}: ${c.name}`),c})}},{name:["readfile","getfile"],description:"Get file content",args:[new p({index:0,name:"path",description:"Filename"})],async action({path:r}){if(!r)throw $.get("bad_args");return(await e.get(r)).data}},{name:["makefile","mkfile"],description:"Creates a file with the specified attributes.",args:[new p({index:0,name:"path",description:"Filename"}),new p({index:1,name:"name",description:"Name"}),new p({index:3,name:"data",description:"Data"}),new p({name:"override",flag:!0,description:"Deletes existing file and recreates."})],async action({path:r,name:s,data:i,override:o=!1},l){if(!r)throw $.get("bad_args");typeof i=="string"&&(i=It(i));const c=await e.makefile(r,s,i,{override:o||!1,meta:[]});return l.message(`File "${c.name}" created`),c}},{name:["editfile"],description:"Edits file with specified attributes.",args:[new p({index:0,name:"path",description:"Filename"}),new p({index:1,name:"data",description:"Data"})],async action({path:r,data:s},i){if(!r)throw $.get("bad_args");typeof s=="string"&&(s=It(s));const o=await e.editfile(r,s);return i.message(`File "${o.name}" edited`),o}},{name:["editfilemeta"],description:"Edits file with specified attributes.",args:[new p({index:0,name:"path",description:"Filename"}),new p({index:1,name:"name",description:"Name"}),new p({index:2,name:"value",description:"Value"})],async action({path:r,name:s,value:i},o){if(!r)throw $.get("bad_args");const l=await e.editfileMeta(r,s,i);return o.message(`File  "${l.name}" Meta edited`),l}},{name:["makelink","mklink"],description:"Creates a link to the specified path.",args:[new p({index:0,name:"ref",description:"Reference path with id (example.ext)."}),new p({index:1,name:"name",description:"Displayed Name"}),new p({index:2,name:"dest",description:"Destination directory."})],async action({ref:r,name:s,dest:i},o){if(!r)throw $.get("bad_args");i=i||".";const l=await e.get(r),c=await e.makelink(l,s);return await e.get(i)!==e.currentItem&&await e.move(c,i,{override:!0}),o.message(`Created link "${s}" with "${await l.getPath()}"`),c}},{name:["editlink"],description:"",args:[new p({index:0,name:"path",description:"Reference filepath with id (example.ext)."}),new p({index:1,name:"ref",description:"Destination directory."})],async action({path:r,ref:s},i){if(!(r&&s))throw $.get("bad_args");const o=await e.get(s),l=await e.editlink(r,o);return i.message(`Edited link "${name}" with "${await o.getPath()}"`),l}},{name:"rename",description:"Renamed a file",args:[new p({index:0,name:"path",description:"Filepath with id (example.ext)."}),new p({index:1,name:"value",description:"Value for id or displayed name."}),new p({name:["name","n"],flag:!0,description:"When set, changes the display name."}),new p({name:["removeName","rn"],flag:!0,description:"When set, removes the display name."})],async action({path:r,value:s,name:i,removeName:o},l){if(!o&&(!r||!s))throw $.get("bad_args");const c=await e.get(r),m=i?c.name:c.id;return await e.rename(r,s,{name:i,removeName:o}),l.message(`Renamed from "${m}" to "${s}"`),c}},{name:["cp","copy"],args:[new p({index:0,name:"from",description:"Source Filepath with id (example.ext)."}),new p({index:1,name:"dest",description:"Destination Filepath with id (example.ext)."}),new p({name:["ignore","i"],flag:!0,description:"When sets, creates a new file if exists."})],async action({from:r,dest:s,ignore:i},o){let l=s;if(!l&&i&&(l=r),!l||!r)throw $.get("bad_args");const c=await e.copy(r,l,{ignore:i});return o.message(`Copied from "${r}" to "${l}"`),c}},{name:["mv","move"],description:"move %from% %to%",args:[new p({index:0,name:"from",description:"From path"}),new p({index:1,name:"to",description:"To path"}),new p({index:2,name:"item-position",description:"Sets the position in the Icon view. (x,y)"})],async action({from:r,to:s,itemPosition:i},o){if(!s||!r)throw $.get("bad_args");const l=await e.move(r,s);i&&l.meta.set(S.POSITION,[0,0].map((m,f)=>{const y=i.split(",");return parseInt(y[Number(f)]||"0")})),l.save();let c;return l instanceof st?c="Directory":c="File",o.message(`${c} moved ${l.name}`),l}},{name:["executeFile"],description:"Execute file.",args:[new p({index:0,name:"path",description:"Path to the file"})],async action({path:r}){if(!r)throw $.get("bad_args");const s=await e.get(r);if(typeof s.action=="function")return s.action(t);throw $.get("cant_find_action",r)}}]});$.add("cant_find_action","Can't find action %1");$.add("cant_find_disk","Can't find disk %1");const Je=new Map;class Vs extends ea{constructor(){super(...arguments);g(this,"modules");g(this,"services");g(this,"app")}get name(){var t;return(t=this.app)==null?void 0:t.name}async connect(t,{apiKey:a,url:r}){if(this.modules=await Ct.get(),this.app)Je.has(t)&&(this.app=Je.get(t));else{const s=this.modules.app.initializeApp({apiKey:a,databaseURL:r},t);Je.set(s.name,s),this.app=s}return this.app}async disconnect(){var t;if(!this.app)throw $.get("FirebaseWrapper_noApp");Ae(this),await this.logout(),await((t=this.modules)==null?void 0:t.app.deleteApp(this.app)),this.app=void 0}get locked(){return!!this.app&&!this.isLogged()}get currentUser(){var t;if((t=this.modules)!=null&&t.auth){const{getAuth:a}=this.modules.auth;return a(this.app).currentUser}}isLogged(){return!!this.app&&!!this.currentUser}login(t,a){var r;if((r=this.modules)!=null&&r.auth){const{getAuth:s,signInWithEmailAndPassword:i}=this.modules.auth,o=s(this.app);return Ae(this),i(o,t,a)}}logout(){var t;if(this.app&&((t=this.modules)!=null&&t.auth)){const{getAuth:a,signOut:r}=this.modules.auth,s=a(this.app);return r(s)}else throw $.get("FirebaseWrapper_notConnected")}remove(t){var a;if(Ae(this),(a=this.modules)!=null&&a.database){const{remove:r,ref:s,getDatabase:i}=this.modules.database,o=i(this.app),l=s(o,t);return r(l)}}get(t){var a;if(Ae(this),(a=this.modules)!=null&&a.database){const{ref:r,onValue:s,getDatabase:i}=this.modules.database,o=i(this.app),l=r(o,t);let c;return new Promise(m=>{c=s(l,f=>m(f.val()))}).then(m=>(c&&c(),m))}}async set(t,a){var r;if(Ae(this),(r=this.modules)!=null&&r.database){const{ref:s,set:i,getDatabase:o}=this.modules.database,l=o(this.app),c=s(l,t);return await i(c,a),a}}}function Ae(n){if(!n.app)throw $.get("FirebaseWrapper_notConnected")}$.add([["FirebaseWrapper_notConnected",["Not connected","Not connected"]],["FirebaseWrapper_noApp",["No app available","No app available"]],["FirebaseWrapper_hasApp",["App already available",'App "%1" already available']]]);class Bs extends ta{constructor(e){super({...e,storage:new Vs})}async mount(e){if(e.onDisconnect=()=>{this.unmount()},this.storage)return await this.storage.connect(e.id,{apiKey:e.apiKey,url:e.url}),this;throw new Error("no storage")}async unmount(){if(this.storage)return await this.storage.disconnect(),this;throw new Error("no storage")}async load(){if(this.storage){let e=await this.storage.get(this.name);return e||(e={},this.storage.locked||await this.storage.set(this.name,e)),this.data=e,e}else throw new Error("no storage")}async save(e){if(this.storage)return e=Bt(e),this.data=e||this.data,await this.storage.set(this.name,e),this.data;throw new Error("no storage")}get locked(){var e;return((e=this.storage)==null?void 0:e.locked)||!1}}function Bt(n){return Object.fromEntries(Object.entries(n).filter(([,e])=>e||typeof e=="number"||typeof e=="boolean").map(([e,t])=>(t&&typeof t=="object"&&(t=Bt(t)),[e,t])))}const De=new Map,Us=Ne(({module:n,core:e})=>{const{fileSystem:t}=n;return[{name:"cloudList",args:[new p({name:"json",flag:!0,description:"Get JSON Export"})],action({json:a},r){const s=Array.from(De.values());if(a)return Promise.resolve(s);{const i=new Ee;return i.addColumns([{value:"Storage (Id)",align:"left",minWidth:15},{value:"Name",align:"left",minWidth:15},{value:"Logged In",align:"center",minWidth:9}]),i.addRows(s.reduce((o,l)=>(o.push([l.id,l.name,l.storage.storage.isLogged()?"yes":"no"]),o),[])),r.message([i]),Promise.resolve()}}},{name:"cloudMountFirebase",args:[new p({index:0,name:"id",flag:!0,description:"Id from Storage."}),new p({index:1,name:"apiKey",description:"Firebase Api-Key."}),new p({index:2,name:"url",description:"Firebase Database-Url."})],async action({id:a,apiKey:r,url:s},i){if(!r||!s)throw $.get("bad_args");const o=e.addExecution(),l=await t.connect(Bs,{id:a,apiKey:r,url:s});return De.set(l.id,l),i.message(`Mount <strong>${l.name}</strong> <strong>(${l.id})</strong> successful!`),o(),l}},{name:"cloudUnmount",args:[new p({index:0,name:"id",flag:!0,description:"Id from Storage."})],async action({id:a},r){if(!a)throw $.get("bad_args");const s=e.addExecution();try{const i=De.get(a);await t.disconnect(i),De.delete(i.id),r.message(`Unmount "${i.name}" successful!`),s()}catch(i){throw s(),i}}},{name:"cloudAuth",args:[new p({name:"login",flag:!0,description:"Storage Login"}),new p({name:"logout",flag:!0,description:"Logout from Storage."}),new p({name:"email",description:"Email for Login."}),new p({name:"password",description:"Password for Login."}),new p({name:"storage",description:"Specifies which drive is logged on."})],async action({email:a,password:r,storage:s,login:i,logout:o},l){const c=s;if(!c)throw $.get("bad_args");const m=e.addExecution(),f=De.get(c);let y;if(f)try{if(i){if(!a||!r)throw $.get("bad_args");y=await f.storage.storage.login(a,r),l.message(`Login with ${f.id} (${f.id}) successful!`)}else o&&(y=await f.storage.storage.logout(),l.message(`Logout from ${f.id} (${f.id}) successful!`))}catch(I){if(m(),I instanceof Error&&"code"in I){switch(I.code){case"auth/user-not-found":case"auth/wrong-password":return I}throw I}}else throw new Error(`${c} is not mounted.`);return m(),y}}]}),Tt=D(new aa("web_workbench_FS"));class Ut extends Ke{constructor({core:t}){super({name:"Files",commands:({module:a,core:r})=>[...Ws({module:a,core:r}),...Ms({module:a}),...Us({module:a,core:r})],contextMenu:Fs,core:t});g(this,"fileSystem",Tt);g(this,"fs",Tt);g(this,"disks",{})}addDisks(t){[...t].sort((a,r)=>a.order>r.order?1:a.order<r.order?-1:0).forEach(a=>{this.disks[a.name]=a})}}g(Ut,"NAME","Files");class Ys{constructor(e){g(this,"defaultItems",new ot);g(this,"activeItems");g(this,"core");this.core=e,this.activeItems=this.defaultItems}addDefaultItems(e){this.defaultItems.add(e)}getActiveItems(){return this.activeItems}setActiveItems(e){return this.activeItems=e||this.defaultItems}}const Xs=pt(({core:n})=>{const{windows:e}=n.modules;return[new N({order:0,title:"Web-Workbench",items:[new N({title:"Settings",action(){return n.executeCommand("openSettings")}}),new ye,new N({hotKey:{alt:!0,code:"KeyI",title:"I"},title:"Info",async action(){const t=await z(()=>import("./BLpvwVxa.js"),__vite__mapDeps([82,40,19,1,20,21,22,41,18,83]),import.meta.url).then(a=>a.default);e==null||e.addWindow({component:t,componentData:{},options:{title:"Info",prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})}}),new ye,new N({title:"Imprint",action(){return n.executeCommand('execute "Imprint.md"')}}),new N({title:"Disclaimer",action(){return n.executeCommand('execute "Disclaimer.md"')}})]})]}),Gs={xmlns:"http://www.w3.org/2000/svg",width:"6",height:"10",viewBox:"0.5 50.5 6 10"};function js(n,e){return H(),ie("svg",Gs,e[0]||(e[0]=[J("path",{fill:"#020203",d:"M.5 50.5h6v2h-4v2h2v2h-2v4h-2z"},null,-1)]))}const zs={render:js},Hs={xmlns:"http://www.w3.org/2000/svg",width:"6",height:"10"};function Ks(n,e){return H(),ie("svg",Hs,e[0]||(e[0]=[J("path",{d:"M0 10h6V8H2V6h2V4H2V2h4V0H0z"},null,-1)]))}const Zs={render:Ks},Qs={class:"icon full"},qs={class:"icon empty"},Js=Ze({__name:"StorageBar",props:{visible:{type:Boolean,default:!0},value:{type:Number,default:.8}},setup(n){const e=n,t=O(()=>({"--bar-height":Math.min(e.value,1)}));return(a,r)=>n.visible?(H(),ie("div",{key:0,class:"wb-env-atom-storage-bar",style:pa(t.value)},[J("div",null,[J("div",Qs,[Y(Ge(zs))]),r[0]||(r[0]=J("span",{class:"size"},[J("span",{class:"helper"})],-1)),J("div",qs,[Y(Ge(Zs))])])],4)):ue("",!0)}}),er=dt(Js,[["__scopeId","data-v-3d4c6ce7"]]),tr={class:"wb-env-molecule-dialog-content"},ar=["innerHTML"],sr={key:1,class:"input"},rr=Ze({__name:"DialogContent",props:{message:{type:String,default(){return"Dialog Message"}},confirm:{type:Boolean,default:!1},prompt:{type:Boolean,default:!1},promptType:{type:String,default:"text"},promptStep:{type:Number,default:void 0},promptValue:{type:String,default:""},password:{type:Boolean,default:!1},apply:{type:Function,default(){return null}},abort:{type:Function,default(){return null}},applyLabel:{type:String,default(){return"Continue"}},abortLabel:{type:String,default(){return"Cancel"}},yesLabel:{type:String,default(){return"Yes"}},noLabel:{type:String,default(){return"No"}}},emits:["apply","abort"],setup(n,{emit:e}){const t=n,a=e,r=Se(t.promptValue),s=O(()=>t.password?"password":t.promptType),i=O(()=>t.message.replace(/\\n|\n/g,"<br>")),o=()=>{const c=r.value||!0;typeof t.apply=="function"?t.apply(c):a("apply",c)},l=()=>{typeof t.abort=="function"?t.abort():a("abort")};return(c,m)=>(H(),ie("div",tr,[J("div",null,[n.message?(H(),ie("p",{key:0,innerHTML:i.value},null,8,ar)):ue("",!0),n.prompt?(H(),ie("div",sr,[Y(Lt,{ref:"dialogInput",modelValue:r.value,"onUpdate:modelValue":m[0]||(m[0]=f=>r.value=f),step:n.promptStep,type:s.value,label:null},null,8,["modelValue","step","type"])])):ue("",!0),Y(ht,{align:n.abortLabel?"outer":"center",class:"buttons"},{default:Ye(()=>[n.applyLabel||n.confirm&&n.yesLabel?(H(),Xe(ge,{key:0,"style-type":"dialog",label:n.confirm?n.yesLabel:n.applyLabel,onClick:o},null,8,["label"])):ue("",!0),n.abortLabel||n.confirm&&n.noLabel?(H(),Xe(ge,{key:1,"style-type":"dialog",label:n.confirm?n.noLabel:n.abortLabel,onClick:l},null,8,["label"])):ue("",!0)]),_:1},8,["align"])])]))}}),nr=dt(rr,[["__scopeId","data-v-302c1124"]]),ir=Ne(({module:n,core:e})=>{var s;const t=(s=e.modules.files)==null?void 0:s.fs,a=e.modules.symbols,r=e.modules.windows;return[{name:["openDirectory","openDir"],description:"Opens the specified directory.",args:[new p({index:0,name:"path",description:"Path to the directory."}),new p({name:"sortSymbols",description:"Sort Symbols",flag:!0}),new p({name:"windowSize",description:"Window Size"}),new p({name:"windowPosition",description:"Window Position"}),new p({name:"windowScale",description:"Window Scale"}),new p({name:"windowScrollX",description:"Window Scroll-X"}),new p({name:"windowScrollY",description:"Window Scroll-Y"}),new p({name:"windowSidebar",description:"Window Sidebar"}),new p({name:"windowFullSize",description:"Window Full-Size"})],async action(i){const{path:o,sortSymbols:l,windowSize:c,windowPosition:m,windowScale:f,windowScrollX:y,windowScrollY:I,windowSidebar:L,windowFullSize:b}=i;if(!o)throw $.get("bad_args");const h=await(t==null?void 0:t.get(o));if(!h)throw $.get("FileSystemItem_itemNotFound",o);if(!(h instanceof he))throw $.get("FileSystemItem_itemNotContainer",o);const d=await(a==null?void 0:a.addFileSystemWrapper(h)),w=a==null?void 0:a.getWrapper(String(d)),E=we({value:h.size/h.maxSize}),v=ee=>{const[le,xe]=ee.split(",");return ft(Number(le),Number(xe))},x=r==null?void 0:r.addWindow({layout:{size:v(c||"400,200"),position:v(m||"0,0")},sidebarComponent:er,sidebarComponentData:E,component:ra,componentData:{wrapperId:d,parentScrollable:y||I},options:{title:h.name,sidebar:L!==void 0?L:!0,scale:f!==void 0?f:!0,scrollX:y!==void 0?y:!0,scrollY:I!==void 0?I:!0,center:!m}},{active:!0,full:b}),F=()=>{E.value=h.size/h.maxSize},_=[w==null?void 0:w.events.subscribe(F)];return new Promise(ee=>{x==null||x.events.subscribe(({name:le})=>{le==="ready"&&l?window.requestAnimationFrame(()=>{w==null||w.rearrangeIcons()}):le==="close"?(_.forEach(xe=>xe==null?void 0:xe.unsubscribe()),d&&(a==null||a.removeWrapper(d)),ee(!0)):F()})})}},{name:["openDialog"],description:"Open a Dialog.",args:[new p({index:0,name:["message"],description:"Message from Dialog."}),new p({index:1,name:["title"],description:"Title from Dialog."}),new p({name:["apply"],description:"Title from apply button."}),new p({name:["abort"],description:"Title from abort button."}),new p({name:["confirm"],flag:!0,description:"Defines the confirm dialog"}),new p({name:["prompt"],flag:!0,description:"Defines the prompt dialog"}),new p({name:["promptType"],description:"Type from prompt dialog (e.g. text, number, email). (Default: text)"}),new p({name:["promptStep"],description:"Step from prompt dialog (e.g. 1, 0.1, 0.01). (Default: 1)"}),new p({name:["promptValue"],description:"Default value from prompt dialog."}),new p({name:["secret"],flag:!1,description:"Input is illegible."})],action:i=>{const{title:o,message:l=null,apply:c=null,abort:m=null,confirm:f=!1,prompt:y=!1,promptType:I="text",promptStep:L=void 0,promptValue:b=null,secret:h=!1}=i;let d;const w=x=>{d(x)},E=()=>{d(!1)},v=n.addWindow(new rt({component:nr,componentData:{title:o,message:l,secret:h,confirm:f,prompt:y,promptType:I,promptStep:Number(L),promptValue:b,applyLabel:c||"Continue",abortLabel:m,apply:w,abort:E},options:{scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1,close:!1}}));return v.awaitClose().then(()=>E()),new Promise(x=>{d=x}).then(x=>(v.close(),x))}}]});class or extends Ke{constructor(t){super({config:va,commands:ir,...t,name:"Windows"});g(this,"wrappers",D(new Map));g(this,"contentWrapper");g(this,"globalWrapper");g(this,"contextMenu");this.contextMenu=we(new Ys(this.core));const a=this.getWrapper(this.addWrapper(new $t(this.core)));if(!a)throw new Error("Content wrapper not found");this.contentWrapper=a;const r=this.getWrapper(this.addWrapper(new $t(this.core)));if(!r)throw new Error("Global wrapper not found");this.globalWrapper=r,Va({contentWrapper:this.contentWrapper.events,globalWrapper:this.globalWrapper.events}).subscribe(s=>{console.log("event",s)})}addWindow(t,a={}){let r;return t instanceof rt?r=t:r=new rt(t),a={global:!1,...a},a.global?r=this.globalWrapper.add(r,a):r=this.contentWrapper.add(r,a),r}getWrapper(t){return this.wrappers.get(t)}getFocusedWrapper(){return Array.from(this.wrappers.values()).map(({models:t})=>{debugger;return t}).flat().find(t=>t.options.focused)}addWrapper(t){return this.wrappers.set(t.id,we(t)),t.id}removeWrapper(t){typeof t!="string"&&(t=t.id),this.wrappers.delete(t)}isContextMenu(t){return t.id===this.getActiveContextMenu().id}setup(){this.contextMenu.addDefaultItems(new ot(Xs,{core:this.core})),this.contextMenu.addDefaultItems(new ot(xa,{core:this.core}))}clear(){this.contentWrapper.clear(),this.globalWrapper.clear()}getActiveContextMenu(){return this.contextMenu.getActiveItems()}setActiveContextMenu(t){return this.contextMenu.setActiveItems(t)}}const lr=pt(({module:n,core:e})=>[new N({order:30,title:"Symbol",items:[new N({type:ce.CHECKBOX,title:"Show Invisible Symbols",model:e.config.observable,name:C.SHOW_INVISIBLE_SYMBOLS,action(t){return e.config.set(C.SHOW_INVISIBLE_SYMBOLS,t)}}),new N({title:"Rearrange Symbols",hotKey:{alt:!0,code:"KeyR",title:"R"},action(){const t=n.getDefaultWrapper(),a=n.getPrimaryWrapper();if(a instanceof Pe&&(a==null?void 0:a.id)!==(t==null?void 0:t.id)){if(a==null||a.rearrangeIcons(),a!=null&&a.fsItem)return Ue(a==null?void 0:a.fsItem);throw new Error("No fsItem found")}else if(t instanceof Pe){if(t==null||t.rearrangeIcons({root:!0}),t!=null&&t.fsItem)return Ue(t==null?void 0:t.fsItem);throw new Error("No fsItem found")}}}),new N({title:"Order Type",items:[new N({model:e.config.observable,type:ce.RADIO,name:C.ORDER_TYPE,value:te.NAME,title:"Name",action(){return e.config.set(C.ORDER_TYPE,te.NAME)}}),new N({model:e.config.observable,type:ce.RADIO,name:C.ORDER_TYPE,value:te.TYPE,title:"Type",action(){return e.config.set(C.ORDER_TYPE,te.TYPE)}}),new N({model:e.config.observable,type:ce.RADIO,name:C.ORDER_TYPE,value:te.CREATED_DATE,title:"Created Date",action(){return e.config.set(C.ORDER_TYPE,te.CREATED_DATE)}}),new N({model:e.config.observable,type:ce.RADIO,name:C.ORDER_TYPE,value:te.EDITED_DATE,title:"Edited Date",action(){return e.config.set(C.ORDER_TYPE,te.EDITED_DATE)}})]}),new N({title:"Order Direction",items:[new N({model:e.config.observable,type:ce.RADIO,name:C.ORDER_DIRECTION,value:Re.ASCENDING,title:"Ascending",action(){return e.config.set(C.ORDER_DIRECTION,Re.ASCENDING)}}),new N({model:e.config.observable,type:ce.RADIO,name:C.ORDER_DIRECTION,value:Re.DESCENDING,title:"Descending",action(){return e.config.set(C.ORDER_DIRECTION,Re.DESCENDING)}})]})]})]),cr=({module:n})=>[{name:["rearrangeIcons"],description:"Rearrange Icons",args:[new p({name:"id",description:"Wraper id"}),new p({name:"root",description:"Use root wrapper",flag:!0})],async action({id:e,root:t}){const a=n.getDefaultWrapper(),r=n.getPrimaryWrapper();if(await new Promise(s=>window.requestAnimationFrame(s)),t){if(a.fsItem)return a==null||a.rearrangeIcons({root:!0}),Ue(a.fsItem);throw new Error("No fsItem found")}else{let s=r;if(e&&(s=n.get(e),s instanceof Pe&&s.fsItem))return s.rearrangeIcons(),Ue(s.fsItem)}}}];function mr(){return{[C.SHOW_INVISIBLE_SYMBOLS]:!1,[C.ORDER_TYPE]:te.NAME,[C.ORDER_DIRECTION]:Re.ASCENDING}}class ur extends Be{}class Yt extends Ke{constructor(t){const{core:a}=Object.assign({core:null},t);super({name:"Symbols",config:mr(),commands:cr,contextMenu:lr,core:a});g(this,"events",D(new nt));g(this,"symbols",D(new Map));g(this,"wrappers",D(new Map));g(this,"wrappersObservable",{});g(this,"hasSelectedItems",!1);g(this,"_activeWrapper");g(this,"_defaultWrapper");g(this,"activeWrapper");g(this,"defaultWrapper");g(this,"primaryWrapper");g(this,"secondaryWrapper")}addWrapper(t){return t=D(t),this.wrappers.set(t.id,t),this.wrappersObservable[t.id]=t,t.events.subscribe(this.onEventWrapper.bind(this)),t.id}onEventWrapper({name:t,value:a}){var r;a!=null&&a.wrapper&&(t==="selectItem"||t==="unselectItem")&&(this.hasSelectedItems=((r=a==null?void 0:a.wrapper.selectedItems.value)==null?void 0:r.length)>0,this.events.next(new ur({name:"hasSelectedItems",value:this.hasSelectedItems})))}getWrapper(t){return typeof t!="string"&&(t=t.id),this.wrappers.get(t)}removeWrapper(t){typeof t!="string"&&(t=t.id),this.wrappers.delete(t),Reflect.deleteProperty(this.wrappersObservable,t)}getActiveWrapper(t=!1){var r,s,i;const a=(r=this.core.modules.windows)==null?void 0:r.contentWrapper.getActiveWindow();return a&&((s=a.componentData)!=null&&s.symbolWrapper)?(i=a.componentData)==null?void 0:i.symbolWrapper:t?null:this.activeWrapper}getSelectedItems(){return Array.from(this.wrappers.values()).reduce((t,a)=>(a.selectedItems.value.forEach(s=>{const i=a.get(s);i&&t.push(i)}),t),[])}clearSelectedItems(){return Array.from(this.wrappers.values()).forEach(t=>{t.clearSelectedItems()})}async addFileSystemWrapper(t,a=!1){const r=new Pe(this.core,void 0,a);return await r.setup(t),this.addWrapper(r)}async setup(){var a;const t=(a=this.core.modules.files)==null?void 0:a.fs.root;t&&(this.addSymbols(await ga()),this.setDefaultWrapper(await this.addFileSystemWrapper(t,!0)))}get(t){return this.wrappers.get(t)}setDefaultWrapper(t){this._defaultWrapper=t;const a=this.wrappers.get(t);a&&(this.primaryWrapper=a,this.secondaryWrapper=a,this.activeWrapper=a,this.defaultWrapper=a)}getDefaultWrapper(){return this.defaultWrapper}getPrimaryWrapper(){return this.primaryWrapper||this.defaultWrapper}getSecondaryWrapper(){return this.secondaryWrapper||this.defaultWrapper}setPrimaryWrapper(t){if(t){let a;t instanceof Qe?a=t.id:a=t,this.primaryWrapper=this.wrappers.get(a)}else this.primaryWrapper=void 0;this.events.next(new Be({name:"setPrimaryWrapper",value:this.getPrimaryWrapper()}))}setSecondaryWrapper(t){if(t){let a;t instanceof Qe?a=t.id:a=t,this.secondaryWrapper=this.wrappers.get(a)}else this.primaryWrapper=void 0;this.events.next(new Be({name:"setSecondaryWrapper",value:this.secondaryWrapper}))}setActiveWrapper(t){let a;t instanceof Qe?a=t.id:a=t;let r=this.wrappers.get(this._activeWrapper||"");return a!==this._activeWrapper&&(this._activeWrapper=a,this.activeWrapper=this.wrappers.get(this._activeWrapper),r=this.activeWrapper||this.wrappers.get(this._defaultWrapper||""),this.events.next(new Be({name:"setActiveWrapper",value:r}))),r}addSymbol(t){this.symbols.set(t.key,t)}addSymbols(t){t.forEach(a=>{this.addSymbol(a)})}removeSymbol(t){this.symbols.delete(t)}}g(Yt,"NAME","Symbols");function dr(){const n=new lt;return n.addModule(Ts),n.addModule(Ut),n.addModule(or),n.addModule(na),n.addModule(Yt),n}const pr=dr(),Yr=Object.freeze(Object.defineProperty({__proto__:null,default:pr},Symbol.toStringTag,{value:"Module"}));export{mt as S,_s as W,Ur as _,Yr as i};
