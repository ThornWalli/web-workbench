var ae=Object.defineProperty;var re=(a,r,n)=>r in a?ae(a,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[r]=n;var z=(a,r,n)=>re(a,typeof r!="symbol"?r+"":r,n);import{I as se,T as ue,b as ie,e as ce,C as fe}from"./CI_-y7vV.js";import{x as me,y as pe,u as de}from"./DUL3j0kc.js";import{A as ve}from"./B8TYuwZr.js";import{a as C}from"./DXnSAPcy.js";import{u as he}from"./DOQHPoIb.js";import{d as Ce,r as l,M as $,J as we,k as N,a2 as E,o as ye,R as ge,a3 as P,Y as Re,v as Se,x as Ee,y as _,A as _e,E as Ae,$ as Ie,_ as Oe}from"./CFj-hhFp.js";import"./9V19AFUE.js";import"./Cpj98o6Y.js";import"./BGIFtisS.js";import"./RAasLaaH.js";import"./D4lI5vpz.js";import"./DdQrQ7-5.js";import"./6C4StZv5.js";import"./Lxd48n3n.js";import"./CSlkdJUE.js";import"./udq3idvc.js";import"./BhtCLcUc.js";import"./DG6QdPnO.js";import"./B3mcEltb.js";import"./DN3eHOnZ.js";import"./Ce6njBYG.js";import"./nufkX4jA.js";import"./Cdv5LwuB.js";import"./CGDfseBP.js";import"./WL2z-xAH.js";class Te extends se{constructor(n={}){const{onAdd:i}={onAdd:null,...n};super(n);z(this,"onAdd");this.onAdd=i||(()=>{})}add(n,i){let f="",w=!1;typeof n=="string"&&me(n)?w=!0:(n instanceof ue&&(f=n.toColumnify().split(/\n/g)),typeof n=="string"&&pe(n)&&(f=de(n))),typeof n=="string"&&/^> \w+/.test(n)?this.onAdd(n,i):(w||f.length)&&this.onAdd(f,i)}}const xe={class:"wrapper"},be={class:"input"},Le=["innerHTML"],ke=Ce({__name:"Console",props:{rootElement:{type:HTMLElement,default(){return null}},showIntroduction:{type:Boolean,default(){return!1}},delimiterPrefix:{type:String,default:"1.SYS"},readonly:{type:Boolean,default:!1},startCommands:{type:[Array,String],default:null},preRows:{type:Array,default(){return[]}}},emits:["freeze","unfreeze","startCommandsComplete","refresh"],setup(a,{emit:r}){const{window:n,core:i,parentFocused:f,parentLayout:w}=he();let A=1;const I=l(null),y=l(null),V=l(null),O=l(null),m=a,g=r,U=$(new ie);U.add([new ce({name:["CLS","CLEAR"],action(){Z()}})]);const K=l($(new Te({core:i,consoleInterface:new fe,onAdd:W}))),d=l({value:"",focused:!1}),p=l([]),c=l(0),R=l(0),v=l([`[CLI ${A}]`]),s=l(-1),Y=l(18),S=l({value:m.delimiterPrefix,prompt:!1,confirm:!1}),j=l(null),B=l(null),T=l(null),x=l(!1),F=we({show:!0,logger:K,showCommand:!0,commandBucket:U}),J=N(()=>({"js--prompt":T.value,"js--focused":f.value})),q=N(()=>{let e=S.value.value;const{confirm:t,prompt:o}=S.value;return t?e="(y/n) ?":o?e="?":e&&(e=`${e}:&gt`),e&&(e=`${e}&nbsp;`),e}),G=N(()=>w.value.size);let D;E(()=>G.value,()=>{window.clearTimeout(D),D=window.setTimeout(()=>{h()},200)}),E(()=>j.value,()=>{k({value:""})}),E(()=>B.value,()=>{k({value:m.delimiterPrefix,confirm:B.value})}),E(()=>T.value,()=>{k({value:m.delimiterPrefix,prompt:T.value})}),v.value.unshift(...m.preRows),ye(async()=>{const e=ge();if(e&&e.parent&&"console"in e.parent&&(e.parent.console=this),A++,m.showIntroduction){const t=X();t&&await t.then(()=>b('basic "TMP:CONSOLE_INSTRUCTIONS.basic"',{showCommand:!1}))}P(async()=>{if(m.startCommands){const t=Array().concat(m.startCommands),o=u=>b(u.shift()||"",{showCommand:!1}).then(()=>{if(u.length>0)return o(u)});await o(t),g("startCommandsComplete")}})}),Re(()=>{A--});function Q(e){d.value.value=e}async function b(e,t){s.value=-1,c.value=0,R.value=0,g("freeze");const o=await i.executeCommand(e,{...F,...t});o&&(typeof o=="number"||typeof o=="string")&&W(o),g("unfreeze"),h(),L(!0)}function X(){var t;const e=["#basic","CLS",'PRINT "Scroll (Up/Down): <strong>Shift+Up</strong> / <strong>Shift+Down</strong>"','PRINT "Enter <strong>commands</strong> to show all commands."'];return(t=i.modules.files)==null?void 0:t.fs.createTmpFile("CONSOLE_INSTRUCTIONS.basic","CONSOLE_INSTRUCTIONS.basic",{type:"basic",content:e})}function Z(){R.value=v.value.length,h()}function h(){if(I.value&&y.value){y.value.innerHTML="";const e=Math.floor(I.value.offsetHeight/Y.value)-2;let t=0;for(;c.value+t<c.value+e;){const o=v.value[Math.max(v.value.length-e-c.value,0)+t];if(o!==void 0){const u=document.createElement("li");u.innerHTML=String(o).replace(/[\\]?\\n/,"<br>")+`
`,y.value.appendChild(u)}else break;t++}}}function L(e){P(()=>{e&&(x.value={scroll:!0},g("refresh",x.value),P(()=>{x.value=null}))})}function ee(e){let t=!1;e?R.value>0?(R.value=0,t=!0):c.value<v.value.length&&(c.value++,t=!0):c.value>0&&(c.value--,t=!0),t&&h()}function k(e,t=!1,o=!1){S.value={...S,value:e,prompt:t,confirm:o}}function W(e){const t=[];Array.isArray(e)?t.push(...e):t.push(String(e)),v.value.push(...t),h()}function te(){d.value.focused=!0}function ne(e){return p.value[p.value.length-1]!==e&&p.value.push(e),d.value.value="",b(e)}function oe(){d.value.focused=!1,L(),n.unfocus()}function le(e){var u,H;const t=e.code;let o=!1;if(((u=O.value)!=null&&u.controlCapsLockActive||(H=O.value)!=null&&H.controlShiftActive)&&(t===C.ARROW_UP||t===C.ARROW_DOWN))e.preventDefault(),ee(t===C.ARROW_UP);else{switch(t){case C.ARROW_UP:s.value++,s.value=Math.min(s.value,p.value.length-1),o=!0;break;case C.ARROW_DOWN:s.value--,s.value=Math.max(s.value,-1),o=!0;break}if(o&&p.value.length>0){let M;s.value<0?M="":M=p.value[p.value.length-1-s.value],d.value.value=M}L()}}return(e,t)=>(Ee(),Se("div",{ref_key:"rootEl",ref:I,class:Ie(["wb-env-console",J.value]),onClick:te},[_("div",xe,[_("ul",{ref_key:"consoleOutputEl",ref:y,class:"output typo-style"},null,512),_("div",be,[_("span",{ref_key:"consoleCommandDelimiterEl",ref:V,class:"prefix",innerHTML:q.value},null,8,Le),_e(ve,{ref_key:"inputEl",ref:O,"root-element":a.rootElement||e.$el,class:"element",multiline:!1,"override-focused":Ae(f),readonly:a.readonly,"model-value":d.value.value,onBlur:oe,"onUpdate:modelValue":Q,onEnter:ne,onKeydown:le},null,8,["root-element","override-focused","readonly","model-value"])])])],2))}}),at=Oe(ke,[["__scopeId","data-v-e540c4b7"]]);export{at as default};
