import{j as p,k,u as v,C as f}from"./BUHgHOJF.js";import{N as _,M as T,a as y}from"./CscqU0tM.js";import{g as C,T as N}from"./BcxMLWXC.js";import{T as w,c as g}from"./BOljFBsF.js";import{C as m}from"./CcARlDDi.js";import{N as x,u as E}from"./D5N9JB0T.js";import{T as b}from"./BB-Rk5Pc.js";import{_ as $,a5 as M,S as P,i as l,t as o,v as n,z as u,N as R,ae as S,x as d,I as V,$ as j,a0 as D,O as I,E as z}from"./DX0JcNNQ.js";import"./C5mdboMC.js";import"./lKcQ8Vj8.js";import"./vgA2FEhf.js";import"./DE3c2NbM.js";import"./IohJ6N0t.js";window.NoteDescription=_;const O={components:{Navigation:x,SynthesizerTimelineCanvas:b},props:{...p,model:{type:Object,required:!0}},emits:[...k,"refresh"],async setup(e,t){const s=M(e,"model"),r=v(e,t);return P(s,()=>{r.setContextMenu(g,{model:s.value,preserveContextMenu:r.preserveContextMenu})},{immediate:!0,deep:!0}),{...r,...await E()}},data:function(){return{toneDestination:null,tracksEdit:{}}},computed:{timelineRefreshKey(){return`timeline-${this.bpm}`},project(){return this.model[m.SYNTHESIZER_PROJECT]},tracks:{get(){return this.project.tracks},set(e){this.project.tracks=e}},bpm(){return Number(this.model[m.SYNTHESIZER_BPM])},controlsNavigation(){return{model:this.model,items:[[{text:`Project: ${this.project.name} | Tracks: ${this.tracks.length}`}]]}},masterVolume(){return this.core.config.observable[f.SCREEN_CONFIG].soundVolume},decibelValue(){return C(this.masterVolume)}},watch:{masterVolume:{handler(){T.volume.value=this.decibelValue},immediate:!0},tracks(){this.$nextTick(()=>{this.$emit("refresh")})},bpm:{handler(e){const t=this.tone.transport;t.stop(),t.bpm.value=120,t.seconds=0,t.bpm.value=e,t.start()}}},mounted(){this.$nextTick(()=>{console.log(this.tracks),this.editTrack(this.tracks[0],{})}),this.$nextTick(()=>{this.$emit("refresh")})},unmounted(){this.model.actions.closeTracks()},methods:{async onClickPlay(){await this.tone.start(),this.players=this.tracks.map(s=>{const r=new w(s,{autoplay:!1});return r.createInstrument("Synth"),r});const e=y;e.stop(),e.seconds=0,e.start(),this.players.map(s=>s.play()).map(s=>s.start(0))},getControls(e){const t=e.getDuration();return{items:[{text:e.name},{spacer:!0},{text:` ${t}`},{label:"Edit",onClick:async()=>{await this.tone.start(),this.editTrack(new N(e),{toneDestination:this.toneDestination})}},{label:"Remove",onClick:async()=>{this.preserveContextMenu(!0),await this.model.actions.removeTrack(e),this.preserveContextMenu(!1),this.$emit("refresh")}}]}},async editTrack(e){this.tracksEdit[e.id]=!0;const{close:t}=this.model.actions.editTrack(e),s=await t;this.tracks=this.tracks.map(r=>r.id===s.id?s:r),this.tracksEdit[e.id]=!1,this.$nextTick(()=>{this.$emit("refresh")})}}},B={class:"wb-disks-extras13-synthesizer-project"},F={class:"tracks"},q={key:0,class:"no-tracks"},G={class:"sheet"};function A(e,t,s,r,H,a){const c=l("navigation"),h=l("synthesizer-timeline-canvas");return o(),n("div",B,[u(c,R(S(a.controlsNavigation)),null,16),d("div",F,[a.tracks.length<1?(o(),n("div",q,"No tracks availableâ€¦")):V("",!0),(o(!0),n(j,null,D(a.tracks,i=>(o(),n("div",{key:i.id,class:"track"},[u(c,I({ref_for:!0},a.getControls(i)),null,16),d("div",G,[(o(),z(h,{key:a.timelineRefreshKey,track:i,static:e.tracksEdit[i.id],onRefresh:t[0]||(t[0]=K=>e.$emit("refresh"))},null,8,["track","static"]))])]))),128))])])}const oe=$(O,[["render",A],["__scopeId","data-v-ada6e466"]]);export{oe as default};
