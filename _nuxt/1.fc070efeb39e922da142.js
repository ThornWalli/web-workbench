(window.webpackJsonp=window.webpackJsonp||[]).push([[1,9,43,44],{105:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));var n=r(71);class o extends n.b{}},114:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return h}));var n=r(72),o=r(73);class h extends o.default{onPointerDown(t){return l.bind(this)(t)}onPointerMove(t){return l.bind(this)(t)}onPointerUp(){return this.last=null,{save:!0}}}function l(t){var e=(this.last||t).x,r=(this.last||t).y;return Object(n.line)((t,e)=>{var data=[].concat(this._brush.data);this._app.canvas.addRenderAction(()=>{o.default.drawBrush({color:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})})},e,r,t.x,t.y,{}),this.last=t,{render:!0}}},115:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return h}));var n=r(72),o=r(80);class h extends o.default{onPointerDown(t){if(this.selectedAnchor){var e=this.getAnchorByPosition(t.x,t.y);if(!e)return this._app.canvas.addRenderAction(()=>{this.render(!1),this.reset()}),{save:!0,render:!0};this.selectedAnchor=e,this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)})}return{render:!0}}onPointerMove(t,e){if(e.pressed)return this.anchors.length<1&&(this.addAnchor(t.x,t.y),this.selectedAnchor=this.addAnchor(t.x,t.y)),this.selectedAnchor.x=t.x,this.selectedAnchor.y=t.y,this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}}render(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.anchors.length&&(Object(n.line)((t,e)=>{var data=[].concat(this._brush.data);o.default.drawBrush({color:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})},this.anchors[0].x,this.anchors[0].y,this.anchors[1].x,this.anchors[1].y,{}),t&&this.drawAnchors())}}},116:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return c}));var n=r(72),o=r(73),h=r(80),l=r(77);class c extends h.default{constructor(t){super(t),this.status=0,this.locked=!1}refreshHelperOffset(){this.primaryHelper&&(this.primaryHelperOffset=[this.primaryHelper.x-this.primaryAnchor.x,this.primaryHelper.y-this.primaryAnchor.y]),this.secondaryHelper&&(this.secondaryHelperOffset=[this.secondaryHelper.x-this.secondaryAnchor.x,this.secondaryHelper.y-this.secondaryAnchor.y])}onPointerDown(t){if(this.moved||this.reset(),!this.locked){this.locked=!0,1===this.anchors.length&&this.reset();var e=this.getAnchorByPosition(t.x,t.y);if(e&&this.selectedAnchor!==e)this.selectedAnchor=e;else{if(2===this.status&&!e)return f.bind(this)();1===this.status?d.bind(this)():this.selectedAnchor||(this.addAnchor(t.x,t.y),this.selectedAnchor=this.addAnchor(t.x,t.y))}return this._app.canvas.addPassiveRenderAction(()=>{this.render(!0),this.locked=!1}),{render:!0}}}get primaryAnchor(){return this.anchors[0]}get secondaryAnchor(){return this.anchors[1]}get primaryHelper(){return this.anchors[2]}get secondaryHelper(){return this.anchors[3]}onPointerUp(){if(this.status<3&&0===this.status)return this.selectedAnchor=null,this.status++,this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}}onPointerMove(t,e){if(e.pressed&&this.selectedAnchor)return this.moved=!0,this.selectedAnchor.x=t.x,this.selectedAnchor.y=t.y,this.selectedAnchor===this.primaryAnchor&&this.primaryHelper?(this.primaryHelper.x=this.selectedAnchor.x+this.primaryHelperOffset[0],this.primaryHelper.y=this.selectedAnchor.y+this.primaryHelperOffset[1]):this.selectedAnchor===this.secondaryAnchor&&this.secondaryHelper?(this.secondaryHelper.x=this.selectedAnchor.x+this.secondaryHelperOffset[0],this.secondaryHelper.y=this.selectedAnchor.y+this.secondaryHelperOffset[1]):this.selectedAnchor!==this.primaryHelper&&this.selectedAnchor!==this.secondaryHelper||this.refreshHelperOffset(),this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}}addPoints(t){t.forEach(t=>{this.points[Object(l.b)(t[0]-1,0,this._app.canvas.width-1)][Object(l.b)(t[1]-1,0,this._app.canvas.height-1)]=!0})}render(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.status>1?Object(n.curve)((t,e)=>{var data=[].concat(this._brush.data);o.default.drawBrush({color:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})},this.primaryAnchor.x,this.primaryAnchor.y,this.primaryHelper.x,this.primaryHelper.y,this.secondaryHelper.x,this.secondaryHelper.y,this.secondaryAnchor.x,this.secondaryAnchor.y):Object(n.line)((t,e)=>{var data=[].concat(this._brush.data);h.default.drawBrush({color:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})},this.primaryAnchor.x,this.primaryAnchor.y,this.secondaryAnchor.x,this.secondaryAnchor.y,{}),t&&(this.primaryHelper&&Object(n.line)((t,e)=>{var r=this._app.canvas.getColorFromPixel(t,e);0===r.alpha?r=this.anchorBrush.primaryColor:r.invert();var data=[].concat(this.anchorBrush.data);h.default.drawBrush({color:r,data:data,x:t,y:e,app:this._app})},this.primaryAnchor.x,this.primaryAnchor.y,this.primaryHelper.x,this.primaryHelper.y,{}),this.secondaryHelper&&Object(n.line)((t,e)=>{var r=this._app.canvas.getColorFromPixel(t,e);0===r.alpha?r=this.anchorBrush.primaryColor:r.invert();var data=[].concat(this.anchorBrush.data);h.default.drawBrush({color:r,data:data,x:t,y:e,app:this._app})},this.secondaryAnchor.x,this.secondaryAnchor.y,this.secondaryHelper.x,this.secondaryHelper.y,{}),this.drawAnchors())}reset(){h.default.prototype.reset.apply(this,arguments),this.status=0,this.locked=!1}intersect(t,e){for(var r=[[0,0],[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]],i=0;i<r.length;i++)if(this.points[t+r[Number(i)][0]][e+r[Number(i)][1]])return!0;return!1}}function d(){var t=v(this.primaryAnchor,this.secondaryAnchor);this.addAnchor(t[0],t[1]),t=v(this.secondaryAnchor,this.primaryAnchor),this.addAnchor(t[0],t[1]),this.refreshHelperOffset(),this._app.canvas.addPassiveRenderAction(()=>{this.render(!0),this.locked=!1}),this.status++}function f(){return this._app.canvas.addRenderAction(()=>{this.render(!1),this.reset()}),{events:!1,save:!0,render:!0}}function v(t,e){var r=Object(n.getLinePoints)(t.x,t.y,e.x,e.y);return r[Math.floor(r.length/4)]}},117:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));var n=r(74);class o extends n.default{fill(t,e,r){for(var n,i,o,h,l,c=[[t,e]],d=0,f=this._app.canvas.getColorFromPixel(t,e,!0),a=[[-1,0],[1,0],[0,-1],[0,1]];c.length;){if(d>2e6)throw new Error("FILL OVERFLOW");for(t=(n=c.pop())[0],e=n[1],this._app.canvas.setPixel(t,e,r,!0),i=0;i<a.length;i++)o=t+a[Number(i)][0],h=e+a[Number(i)][1],o>=0&&o<this._app.canvas.width&&h>=0&&h<this._app.canvas.height&&(l=this._app.canvas.getColorFromPixel(o,h,!0)).is(f)&&!r.is(l)&&c.push([o,h]);d++}}onPointerDown(t){if(!this._filling){this._filling=!0;var e=t.x,r=t.y,n=this._app.primaryColor;return this._app.canvas.addRenderAction(()=>{this.fill(e,r,n),this._filling=!1}),{save:!0,render:!0}}return{events:!1}}}},118:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));var n=r(98);class o extends n.default{constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.pointerDownHold=!0,super(t)}}},119:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return l}));var n=r(72),o=r(73),h=r(80);class l extends h.default{onPointerMove(t){var e=t.x-this.startEvent.x,r=t.y-this.startEvent.y;return this._app.canvas.addPassiveRenderAction(()=>{Object(n.rectangle)((t,e,r)=>{var data=[].concat(this._brush.data);o.default.drawBrush({color:r?this._brush.secondaryColor:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})},this.startEvent.x,this.startEvent.y,e,r,{strokeSize:this.filled?0:this._brush.data.length,filled:this.filled})}),{render:!0}}onPointerUp(t){var e=t.x-this.startEvent.x,r=t.y-this.startEvent.y;return this._app.canvas.addRenderAction(()=>{Object(n.rectangle)((t,e,r)=>{var data=[].concat(this._brush.data);o.default.drawBrush({color:r?this._brush.secondaryColor:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})},this.startEvent.x,this.startEvent.y,e,r,{strokeSize:this.filled?0:this._brush.data.length,filled:this.filled})}),{save:!0,render:!0}}}},120:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return h}));var n=r(72),o=r(99);class h extends o.default{constructor(t){super(t),this._proportinalScale=!0,this._func=n.ellipse}}},121:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return l}));var n=r(72),o=r(73),h=r(80);class l extends h.default{constructor(t){super(t),this.status=0}onPointerMove(t,e){if(e.pressed&&this.selectedAnchor)return this.selectedAnchor.x=t.x,this.selectedAnchor.y=t.y,this._app.canvas.addPassiveRenderAction(()=>{this.render(!0)}),{render:!0}}onPointerDown(t){var e=this.getAnchorByPosition(t.x,t.y);switch(this.status){case 1:if(!e)return this.status=2,this._app.canvas.addRenderAction(()=>{this.render(!1),this.reset()}),{save:!0,render:!0};this.selectedAnchor=e;break;default:e&&this.anchors[0]===e?(this.status=1,this.selectedAnchor=e):this.selectedAnchor=e||this.addAnchor(t.x,t.y)}return this._app.canvas.addPassiveRenderAction(()=>{this.render(this.status<2)}),{render:!0}}isClosed(){return this.status>0}render(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(n.polygon)((t,e)=>{var data=[].concat(this._brush.data);o.default.drawBrush({color:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})},this.anchors,this.status>0,{filled:this.filled}),t&&this.drawAnchors()}reset(){h.default.prototype.reset.apply(this,arguments),this.status=0}}},122:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return v}));var n=r(71),o=r(72),h=r(76),l=r(81),c=r(95),d=r(80),f=r(73);class v extends d.default{constructor(t){super(t),this.brushPrimaryColor=new h.default(h.default.COLOR_BLACK),this.brushSecondaryColor=new h.default(h.default.COLOR_WHITE),this.brush=new(Object(l.getBrushByIndex)(0))({app:this.app,size:1,primaryColor:this.brushPrimaryColor,secondaryColor:this.brushSecondaryColor}),this._moving=!1}onPointerMove(t){var e=t.x-this.startEvent.x,r=t.y-this.startEvent.y;return this._moving||(this._moving=!0,this._app.canvas.addPassiveRenderAction(()=>{Object(o.rectangle)((t,e)=>{var data=[].concat(this._brush.data),r=this._app.canvas.getColorFromPixel(t,e);0===r.alpha?r=this.brushPrimaryColor:r.invert(),f.default.drawBrush({color:r,data:data,x:t,y:e,app:this._app})},this.startEvent.x,this.startEvent.y,e,r,{strokeSize:this._brush.data.length,filled:!1}),this._moving=!1})),{render:!0}}onPointerUp(t){this._app.canvas.cleanPassiveRenderActions();var e=Object(n.e)(t),r=Object(n.e)(this.startEvent),o=Object(n.d)(()=>Math.floor(e-r));if(o.x>0&&o.y>0){var h=new c.default(r,e),l=this.app.display,d=Object(n.d)(()=>Math.floor(l.canvasLayout.naturalSize/o*l.zoomFactor)),f=Object(n.d)(()=>h.min+o/2);this.app.display.setZoom(d.x>d.y?d.x:d.y,f)}return{render:!0}}}},123:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return l}));var n=r(105),o=r(74),h=r(82);class l extends o.default{onPointerDown(t){var e=this.app.display,r=2;return e.maxZoomFactor-5<e.zoomFactor&&(r=1),r=h.a.altActive?-r:r,this.app.display.zoom(r,new n.default(t.x,t.y)),{events:!1}}}},124:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));var n=r(74);class o extends n.default{constructor(t){super(t),this.passive=!0}onActive(){this.app.canvas.revertStack()}}},125:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));var n=r(74);class o extends n.default{constructor(t){super(t),this.passive=!0}onActive(){this.app.canvas.clearStack()}}},146:function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var n=r(191),o=new(r(190).a)(n.a)},147:function(t,e,r){"use strict";r.r(e),r.d(e,"DISPLAY_SPLIT_VALUES",(function(){return O})),r.d(e,"default",(function(){return B}));var n=r(197),o=r(71),h=r(112),l=r(76),c=r(183),d=r(177),f=r(178),v=r(81),y=r(163),m=r(246),x=r(108);function _(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var w=0;function A(t){return"__private_"+w+++"_"+t}var O={FULL:0,HALF:1,THIRD:2,QUARTER:3},j=A("globalBounds"),z=A("density"),P=A("canvas"),C=A("inputs");class B{setDisplaysElement(t){this.displaysEl=t}refresh(){this.displaysLayout={size:Object(o.e)(this.displaysEl.offsetWidth,this.displaysEl.offsetHeight)},this.refreshDisplayPositions(),this.refreshDisplays()}setDisplay(t){this.display&&this.display.hideCursor(),this.display=t,this.display.showCursor()}updateGlobalBounds(t){_(this,j)[j]=t}constructor(t){this.events=new n.a,Object.defineProperty(this,j,{writable:!0,value:void 0}),this.fsItem=void 0,this.options={size:{width:300,height:200},display:{foreground:"#FFFFFF",background:"#000000"}},Object.defineProperty(this,z,{writable:!0,value:1}),this.displaySplit=O.FULL,this.displays=[],this.displaysEl=void 0,this.displaysLayout={size:Object(o.e)()},this.display=void 0,Object.defineProperty(this,P,{writable:!0,value:void 0}),this.primaryColor=void 0,this.secondaryColor=void 0,Object.defineProperty(this,C,{writable:!0,value:void 0}),this.brush=void 0,this.brushSelect={size:1,index:0},this.colorSelect={index:0,primaryColor:new l.default(l.default.COLOR_BLACK),secondaryColor:new l.default(l.default.COLOR_WHITE),paletteSteps:new l.default(2,1,1)},this.tool=void 0,this.toolSelect={value:"",index:1,filled:!1},this.cursorCanvas=null,_(this,j)[j]=t,_(this,P)[P]=new h.default(this),this.primaryColor=this.colorSelect.primaryColor,this.secondaryColor=this.colorSelect.secondaryColor,this.setBrush(this.brushSelect),this.setTool(this.toolSelect),this.subscriptions=[m.a.resize.subscribe(this.onViewportRefresh.bind(this))],_(this,C)[C]={keyboard:new c.default(this),mouse:new d.default(this)},Object.values(_(this,C)[C]).forEach(input=>{input.register()})}reset(){this.canvas.clearStack(),this.displays.forEach(t=>t.reset())}destroy(){this.subscriptions.forEach(t=>t.unsubscribe())}refreshDisplays(){this.displays.forEach(t=>{t.refresh()})}onViewportRefresh(){this.refreshDisplays()}addDisplay(t){return t=t||new y.default(this),this.displays.push(t),t.app=this,this.events.next(new x.a("addDisplay",t,this)),this.canvas.render(),t}clearDisplays(){this.displays.forEach(t=>{t.destroy(),this.events.next(new x.a("removeDisplay",t,this))}),this.displays=[]}getDisplay(t){return this.displays.find(e=>{if(e.id===t)return e})}get inputs(){return _(this,C)[C]}get globalBounds(){return _(this,j)[j]}get canvas(){return _(this,P)[P]}get density(){return _(this,z)[z]}set density(t){_(this,z)[z]=t}setBrush(t){var{index:e,size:r}=t;this.brush=new(Object(v.getBrushByIndex)(e))({app:this,size:r}),this.tool&&(this.tool.brush=this.brush),this.events.next(new x.a("change:brush",this.brush,this))}setBrushSize(t){this.brush.size=t}setTool(t){var{index:e}=t,r=new(Object(f.getToolByIndex)(e))({app:this,brush:this.brush});this.tool=r,this.tool.onActive(),this.events.next(new x.a("change:tool",this.tool,this))}get paletteSteps(){return this.colorSelect.paletteSteps}set paletteSteps(t){this.colorSelect.paletteSteps=t}refreshDisplayPositions(){var t=this.displaysLayout.size.x,e=this.displaysLayout.size.y,r=[[[1,1]],[[.5,1],[.5,1]],[[1,.5],[1,.5]],[[1,.5],[.5,.5],[.5,.5]],[[.5,.5],[.5,.5],[1,.5]],[[.5,.5],[.5,.5],[.5,.5],[.5,.5]]].filter(t=>{if(t.length===this.displays.length)return t});r=r[0],this.displays.forEach((n,i)=>{n.setSize(Object(o.f)(Math.floor(t*r[Number(i)][0]),Math.floor(e*r[Number(i)][1]))),r[Number(i)][0],r[Number(i)][1]})}}},163:function(t,e,r){"use strict";r.r(e),function(t){r.d(e,"default",(function(){return C}));var n=r(675),o=r(197),h=r(71),l=r(112),c=r(76),d=r(95),f=r(108);function v(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var y=0;function m(t){return"__private_"+y+++"_"+t}var x=m("id"),_=m("bounds"),w=m("cropBounds"),A=m("imageData"),O=m("tmpImageData"),j=m("el"),z=m("canvas"),P=m("context");class C{constructor(t){Object.defineProperty(this,x,{writable:!0,value:Object(n.a)()}),this.events=new o.a,Object.defineProperty(this,_,{writable:!0,value:new d.default}),this.size=Object(h.e)(),this.canvasLayout={size:Object(h.e)(),naturalSize:Object(h.e)(),position:Object(h.e)()},Object.defineProperty(this,w,{writable:!0,value:new d.default}),Object.defineProperty(this,A,{writable:!0,value:null}),Object.defineProperty(this,O,{writable:!0,value:null}),Object.defineProperty(this,j,{writable:!0,value:void 0}),Object.defineProperty(this,z,{writable:!0,value:void 0}),Object.defineProperty(this,P,{writable:!0,value:void 0}),this.zoomFactor=1,this.zoomPosition=Object(h.e)(.5,.5),this.zoomBounds=new d.default,this.offset=Object(h.f)(),this.cursorVisible=!1,this.app=t,this.cursorColor=new c.default(c.default.COLOR_BLACK),this.resetZoom()}showCursor(){this.cursorVisible=!0}hideCursor(){this.cursorVisible=!1,this.renderImageData()}setElement(element){v(this,j)[j]=element}setCanvas(canvas){v(this,z)[z]=canvas,v(this,P)[P]=canvas.getContext("2d"),Object.values(this.app.inputs).forEach(input=>{input.registerDisplay(this)})}destroy(){this.events.next(new f.a("destroy")),Object.values(this.app.inputs).forEach(input=>{input.unregisterDisplay(this)})}get canvas(){return v(this,z)[z]}get id(){return v(this,x)[x]}get bounds(){return v(this,_)[_]}get imageData(){return v(this,A)[A]}set imageData(t){v(this,O)[O]=v(this,A)[A]=t,this.maxZoomFactor=20,this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.renderImageData()}get canvasSize(){return Object(h.e)(v(this,z)[z].width,v(this,z)[z].height)}get naturalSize(){return Object(h.e)(v(this,z)[z].width,v(this,z)[z].height)}get naturalWidth(){return v(this,A)[A].width}get naturalHeight(){return v(this,A)[A].height}get width(){return this.zoomBounds.max.x-this.zoomBounds.min.x}get height(){return this.zoomBounds.max.y-this.zoomBounds.min.y}get zoomFactorWidth(){return v(this,z)[z].width/this.zoomFactor}setSize(t,e){var r;r="object"==typeof t?t:Object(h.e)(t,e),this.size=r,this.events.next(new f.a("change:size",r)),this.canvasAdjustment()}canvasAdjustment(){this.canvasLayout.size=Object(h.e)(()=>Math.min(Math.max(this.app.canvas.size*this.zoomFactor,0),this.size)),this.canvasLayout.naturalSize=this.app.canvas.size,this.canvasLayout.position=Object(h.e)(0,0)}setZoom(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(h.e)();(e=Math.min(e,this.maxZoomFactor))>=0&&(this.zoomFactor=e,this.canvasAdjustment(),this.zoomPosition=Object(h.e)(()=>r/this.canvasLayout.naturalSize),this.zoomBounds=this.calculateZoomBounds(this.zoomPosition,this.zoomFactor),this.resetOffset(),t.requestAnimationFrame(()=>{this.renderImageData(),this.events.next(new f.a("change:zoomFactor",e))}))}zoom(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(h.e)();this.zoomFactor+t>=0&&this.setZoom(this.zoomFactor+t,e)}renderImageData(){v(this,O)[O]=v(this,A)[A];var t=Object(h.e)(()=>this.zoomBounds.max-this.zoomBounds.min),e=Object(h.e)(()=>Object(h.e)(this.offset)+this.zoomBounds.min);v(this,O)[O]=l.default.cropImageData(v(this,O)[O],e.x,e.y,t.x,t.y),v(this,O)[O]=l.default.resizeImageData(v(this,O)[O],this.zoomFactor),this.renderCanvas()}get cursorColor(){return this._cursorColor}set cursorColor(t){this._cursorColorRGBA=t.toRGBA(),this._cursorColor=t}renderCanvas(){v(this,O)[O]&&(v(this,P)[P].putImageData(v(this,O)[O],-this.offset.x,-this.offset.y),this.renderRaster())}reset(){this.resetZoom(),this.resetOffset(),this.renderCanvas()}resetOffset(){this.offset=Object(h.f)(0,0)}resetZoom(){v(this,A)[A]&&this.setZoom(1)}renderRaster(){var t=[];this.zoomFactor>this.maxZoomFactor-3&&t.push({size:Object(h.e)(1,1),width:1,color:"#CCCCCC"});var e=v(this,P)[P];e.globalCompositeOperation="destination-over",t.forEach(t=>{var r=Object(h.e)(()=>this.canvasLayout.naturalSize/t.size);e.lineWidth=t.width,e.beginPath();for(var n=0;n<r.x+1;n++){var o=Math.floor(n*t.size.x*this.zoomFactor)+t.width/2;e.moveTo(o,0),e.lineTo(o,v(this,z)[z].height);for(var l=0;l<r.y+1;l++){var c=Math.floor(l*t.size.y*this.zoomFactor)+t.width/2;e.moveTo(0,c),e.lineTo(v(this,z)[z].width,c)}}e.strokeStyle=t.color,e.stroke()})}refresh(){var rect={left:v(this,z)[z].offsetLeft+v(this,j)[j].offsetLeft,top:v(this,z)[z].offsetTop+v(this,j)[j].offsetTop,width:v(this,z)[z].offsetWidth,height:v(this,z)[z].offsetHeight};v(this,_)[_]=new d.default(Object(h.e)(rect.left,rect.top),Object(h.e)(rect.left+rect.width,rect.top+rect.height)),v(this,A)[A]&&this.renderImageData()}setOffset(t){this.offset=Object(h.f)(t.x,t.y)}calculateZoomBounds(t,e){e=e||1;var r=this.app.canvas.size;t=Object(h.e)(()=>Math.floor(t*r));var n=Object(h.e)(()=>this.size/r),o=Object(h.e)(()=>Math.ceil(Math.min(n/e*r,r))),l=Object(h.e)(()=>Math.min(Math.max(t-Math.ceil(o/2),0),r-o)),c=Object(h.e)(()=>l+o);return new d.default(l,c)}}}.call(this,r(7))},177:function(t,e,r){"use strict";r.r(e),function(t){r.d(e,"default",(function(){return l}));var n,o=r(71),h=r(82);class l{constructor(t){this.subscriptions=[],this.displaySubscriptions=new Map,this.runSubscriptions=[],this._app=t,this._pressed=!1}registerDisplay(t){this.displaySubscriptions.set(t,[h.a.get("mousedown",t.canvas).subscribe(this.onPointerDown(t).bind(this)),h.a.get("mouseenter",t.canvas).subscribe(this.onPointerEnter(t).bind(this))])}unregisterDisplay(t){this.displaySubscriptions.has(t)&&(this.displaySubscriptions.get(t).forEach(t=>t.unsubscribe()),this.displaySubscriptions.delete(t))}register(){}unregister(){}onContextMenu(t){return e=>{this.runActionResult(m.bind(this)(e,t))}}onPointerEnter(t){return e=>{this.app.setDisplay(t);var r=h.a.get("mouseleave",e.target).subscribe(e=>{r.unsubscribe(),this.onPointerLeave(t)(e)})}}onPointerLeave(t){return t=>{}}onPointerDown(t){return e=>{this.app.setDisplay(t),this._pointerEvent=d.bind(this)(e,t),this._pressed=!0,this.runActionResult(f.bind(this)(e,t),e,t),this.app.display.renderCanvas()}}onPointerLeaveAndUp(t){return e=>{c(),this.runActionResult(v.bind(this)(e,t))}}onPointerMove(t){return e=>{this.runActionResult(y.bind(this)(e,t))}}get app(){return this._app}get pressed(){return this._pressed}runActionResult(t,e,r){t&&(t.events&&(this.runSubscriptions=[h.a.get("contextmenu",e.target).subscribe(this.onContextMenu(r).bind(this)),h.a.get("mouseleave",e.target).subscribe(this.onPointerLeaveAndUp(r).bind(this)),h.a.get("mousemove",e.target).subscribe(this.onPointerMove(r).bind(this)),h.a.get("mouseup",e.target).subscribe(this.onPointerLeaveAndUp(r).bind(this))]),t.save&&this.app.canvas.saveStack(),t.revert&&this.app.canvas.revertStack(),t.render&&this.app.canvas.render())}unsubscribeRun(){this.runSubscriptions.filter(t=>!t.unsubscribe())}}function c(){t.clearInterval(n),n=null}function d(t,e){var r=e.canvasLayout,n=Object(o.e)(t.clientX-e.bounds.min.x,t.clientY-e.bounds.min.y),l=Object(o.e)(()=>n-r.position);this.app.globalBounds&&(console.log(this.app.globalBounds.min.toString()),n=Object(o.e)(()=>n-this.app.globalBounds.min),l=Object(o.e)(()=>l-this.app.globalBounds.min));var c=Object(o.e)(()=>Math.round(l)),d=Object(o.e)(()=>Math.round(l/e.zoomFactor+e.zoomBounds.min));return{position:d,origin:c,app:this.app,x:d.x,y:d.y,originX:c.x,originY:c.y,leftClick:2!==t.button,rightClick:2===t.button,holdAlt:h.a.altActive,holdCtrl:h.a.cmdActive}}function f(){var e,r={events:!0};return this.app.tool.pointerDownHold?(e=()=>{this.runActionResult(this.app.tool.onPointerDown(this._pointerEvent,this)),this.app.canvas.render()},c(),n=t.setInterval(e,20),r):Object.assign(r,this.app.tool.onPointerDown(this._pointerEvent,this))}function v(t,e){return this._pressed=!1,this._pointerEvent=null,this.unsubscribeRun(),this.app.tool.onPointerUp(d.bind(this)(t,e),this)}function y(t,e){return this._pointerEvent=d.bind(this)(t,e),this.app.tool.onPointerMove(this._pointerEvent,this)}function m(t,e){return t.preventDefault(),t.stopPropagation(),this.app.tool.onContextMenu(d.bind(this)(t,e),this)}}.call(this,r(7))},178:function(t,e,r){"use strict";r.r(e),r.d(e,"getToolByIndex",(function(){return P}));var n=r(74);r.d(e,"Tool",(function(){return n.default}));var o=r(73);r.d(e,"Brush",(function(){return o.default}));var h=r(98);r.d(e,"DottedFreehand",(function(){return h.default}));var l=r(114);r.d(e,"ContinuousFreehand",(function(){return l.default}));var c=r(115);r.d(e,"StraightLine",(function(){return c.default}));var d=r(116);r.d(e,"Curve",(function(){return d.default}));var f=r(117);r.d(e,"Fill",(function(){return f.default}));var v=r(118);r.d(e,"AirBrush",(function(){return v.default}));var y=r(119);r.d(e,"UnfilledFilledRectangle",(function(){return y.default}));var m=r(120);r.d(e,"UnfilledFilledCircle",(function(){return m.default}));var x=r(99);r.d(e,"UnfilledFilledEllipse",(function(){return x.default}));var _=r(121);r.d(e,"UnfilledFilledPolygon",(function(){return _.default}));var w=r(148);r.d(e,"BrushSelector",(function(){return w.default}));var A=r(122);r.d(e,"Magnifier",(function(){return A.default}));var O=r(123);r.d(e,"Zoom",(function(){return O.default}));var j=r(124);r.d(e,"Undo",(function(){return j.default}));var z=r(125);function P(t){return[h.default,l.default,c.default,d.default,f.default,v.default,y.default,m.default,x.default,_.default,w.default,n.default,n.default,n.default,A.default,O.default,j.default,z.default][Number(t)]}r.d(e,"Clear",(function(){return z.default}))},183:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return x}));var n=r(78),o=r(89),h=r(146);r(111),r(224),r(169);r(159);r(196),o.a,o.a,o.a,o.a;var l={leading:!0,trailing:!1};var c=function(){function t(t,e,r,n){this.duration=t,this.scheduler=e,this.leading=r,this.trailing=n}return t.prototype.call=function(t,source){return source.subscribe(new d(t,this.duration,this.scheduler,this.leading,this.trailing))},t}(),d=function(t){function e(e,r,n,o,h){var l=t.call(this,e)||this;return l.duration=r,l.scheduler=n,l.leading=o,l.trailing=h,l._hasTrailingValue=!1,l._trailingValue=null,l}return n.__extends(e,t),e.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(f,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))},e.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},e.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)},e}(o.a);function f(t){t.subscriber.clearThrottle()}var v=r(105),y=r(77),m=r(82);class x{constructor(t){this.subscriptions=[],this._app=t}register(){var t,e,r;this.subscriptions.push(m.a.keydown.pipe((t=200,void 0===e&&(e=h.a),void 0===r&&(r=l),function(source){return source.lift(new c(t,e,r.leading,r.trailing))})).subscribe(w.bind(this)),m.a.keyup.subscribe(_.bind(this)))}unregister(){this.subscriptions.forEach(t=>t.unsubscribe())}registerDisplay(t){}unregisterDisplay(t){}}function _(t){switch(t.keyCode){case 17:t.preventDefault(),this.holdCrtl=!1;break;case 18:t.preventDefault(),this.holdAlt=!1}}function w(t){if(this._app.display){var e=1;switch(this.holdAlt&&(e*=10),t.keyCode){case 17:t.preventDefault(),this.holdCrtl=!0;break;case 18:t.preventDefault(),this.holdAlt=!0;break;case 37:t.preventDefault(),this._app.display.offset.x-=e;break;case 38:t.preventDefault(),this._app.display.offset.y-=e;break;case 39:t.preventDefault(),this._app.display.offset.x+=e;break;case 40:t.preventDefault(),this._app.display.offset.y+=e}var r=this._app.display;this._app.display.offset=new v.default(Object(y.b)(r.offset.x,-r.zoomBounds.min.x,r.canvasLayout.naturalSize.x-r.zoomBounds.max.x),Object(y.b)(r.offset.y,-r.zoomBounds.min.y,r.canvasLayout.naturalSize.y-r.zoomBounds.max.y)),this._app.display.renderImageData()}}},246:function(t,e,r){"use strict";(function(t){var n=r(71),o=r(673);var h=0;var l,c="__private_"+h+++"_"+"resize";e.a=l||(l=new class{constructor(){this.screenSize=Object(n.e)(0,0),Object.defineProperty(this,c,{writable:!0,value:new o.a(0)}),t.addEventListener("resize",this.onResize.bind(this),!1)}destroy(){t.removeEventListener("resize",this.onResize.bind(this),!1)}onResize(){this.screenSize=Object(n.e)(window.innerWidth,window.innerHeight)}getElementSize(t){return Object(n.e)(t.offsetWidth,t.offsetHeight)}get resize(){return function(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}(this,c)[c]}})}).call(this,r(7))},98:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return o}));var n=r(73);class o extends n.default{onPointerDown(t){var e=t.x,r=t.y,data=[].concat(this._brush.data);return this._app.canvas.addRenderAction(()=>{n.default.drawBrush({color:this._brush.primaryColor,x:e,y:r,data:data,app:this._app})}),{save:!0,render:!0}}}},99:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return l}));var n=r(72),o=r(73),h=r(80);class l extends h.default{constructor(t){super(t),this._proportinalScale=!1}onPointerMove(t){var e=(t.x-this.startEvent.x)/2,r=(t.y-this.startEvent.y)/2;if(this._proportinalScale&&(r=e<0&&r>0||e>0&&r<0?-1*e:e),0!==e&&0!==r)return this._app.canvas.addPassiveRenderAction(()=>{Object(n.ellipse)((t,e,r)=>{var data=[].concat(this._brush.data);o.default.drawBrush({color:r?this._brush.secondaryColor:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})},Math.floor(this.startEvent.x+e),Math.floor(this.startEvent.y+r),e,r,{filled:this.filled})}),{render:!0}}onPointerUp(t){var e=(t.x-this.startEvent.x)/2,r=(t.y-this.startEvent.y)/2;if(this._proportinalScale&&(r=e<0&&r>0||e>0&&r<0?-1*e:e),0!==e&&0!==r)return this._app.canvas.addRenderAction(()=>{Object(n.ellipse)((t,e,r)=>{var data=[].concat(this._brush.data);o.default.drawBrush({color:r?this._brush.secondaryColor:this._brush.primaryColor,data:data,x:t,y:e,app:this._app})},Math.floor(this.startEvent.x+e),Math.floor(this.startEvent.y+r),e,r,{strokeSize:this._brush.data.length,filled:this.filled})}),{save:!0,render:!0}}}}}]);