(function(){"use strict";var kt=function(e,t){return kt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},kt(e,t)};function Dt(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");kt(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function Ke(e,t,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function a(l){try{c(n.next(l))}catch(h){s(h)}}function u(l){try{c(n.throw(l))}catch(h){s(h)}}function c(l){l.done?i(l.value):o(l.value).then(a,u)}c((n=n.apply(e,t||[])).next())})}function he(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(r=0)),r;)try{if(n=1,o&&(i=c[0]&2?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,o=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){r.label=c[1];break}if(c[0]===6&&r.label<i[1]){r.label=i[1],i=c;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(c);break}i[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(l){c=[6,l],o=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function lt(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ht(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],s;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(a){s={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i}function wt(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function X(e){return this instanceof X?(this.v=e,this):new X(e)}function tr(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(f){return function(b){return Promise.resolve(b).then(f,h)}}function a(f,b){n[f]&&(o[f]=function(d){return new Promise(function(N,G){i.push([f,d,N,G])>1||u(f,d)})},b&&(o[f]=b(o[f])))}function u(f,b){try{c(n[f](b))}catch(d){p(i[0][3],d)}}function c(f){f.value instanceof X?Promise.resolve(f.value.v).then(l,h):p(i[0][2],f)}function l(f){u("next",f)}function h(f){u("throw",f)}function p(f,b){f(b),i.shift(),i.length&&u(i[0][0],i[0][1])}}function er(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof lt=="function"?lt(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(s){return new Promise(function(a,u){s=e[i](s),o(a,u,s.done,s.value)})}}function o(i,s,a,u){Promise.resolve(u).then(function(c){i({value:c,done:a})},s)}}typeof SuppressedError=="function"&&SuppressedError;function m(e){return typeof e=="function"}function fe(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var Ot=fe(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function pe(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Ft=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,o,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=lt(s),u=a.next();!u.done;u=a.next()){var c=u.value;c.remove(this)}}catch(d){t={error:d}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}else s.remove(this);var l=this.initialTeardown;if(m(l))try{l()}catch(d){i=d instanceof Ot?d.errors:[d]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var p=lt(h),f=p.next();!f.done;f=p.next()){var b=f.value;try{de(b)}catch(d){i=i??[],d instanceof Ot?i=wt(wt([],ht(i)),ht(d.errors)):i.push(d)}}}catch(d){n={error:d}}finally{try{f&&!f.done&&(o=p.return)&&o.call(p)}finally{if(n)throw n.error}}}if(i)throw new Ot(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)de(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&pe(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&pe(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}();Ft.EMPTY;function ye(e){return e instanceof Ft||e&&"closed"in e&&m(e.remove)&&m(e.add)&&m(e.unsubscribe)}function de(e){m(e)?e():e.unsubscribe()}var rr={Promise:void 0},nr={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,wt([e,t],ht(r)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function me(e){nr.setTimeout(function(){throw e})}function Se(){}function or(e){e()}var It=function(e){Dt(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,ye(r)&&r.add(n)):n.destination=cr,n}return t.create=function(r,n,o){return new Gt(r,n,o)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Ft),ir=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){vt(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){vt(n)}else vt(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){vt(r)}},e}(),Gt=function(e){Dt(t,e);function t(r,n,o){var i=e.call(this)||this,s;return m(r)||!r?s={next:r??void 0,error:n??void 0,complete:o??void 0}:s=r,i.destination=new ir(s),i}return t}(It);function vt(e){me(e)}function sr(e){throw e}var cr={closed:!0,next:Se,error:sr,complete:Se},Vt=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function ge(e){return e}function ar(e){return e.length===0?ge:e.length===1?e[0]:function(r){return e.reduce(function(n,o){return o(n)},r)}}var A=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var o=this,i=lr(t)?t:new Gt(t,r,n);return or(function(){var s=o,a=s.operator,u=s.source;i.add(a?a.call(i,u):u?o._subscribe(i):o._trySubscribe(i))}),i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=we(r),new r(function(o,i){var s=new Gt({next:function(a){try{t(a)}catch(u){i(u),s.unsubscribe()}},error:i,complete:o});n.subscribe(s)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[Vt]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return ar(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=we(t),new t(function(n,o){var i;r.subscribe(function(s){return i=s},function(s){return o(s)},function(){return n(i)})})},e.create=function(t){return new e(t)},e}();function we(e){var t;return(t=e??rr.Promise)!==null&&t!==void 0?t:Promise}function ur(e){return e&&m(e.next)&&m(e.error)&&m(e.complete)}function lr(e){return e&&e instanceof It||ur(e)&&ye(e)}function hr(e){return m(e?.lift)}function Q(e){return function(t){if(hr(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function ft(e,t,r,n,o){return new fr(e,t,r,n,o)}var fr=function(e){Dt(t,e);function t(r,n,o,i,s,a){var u=e.call(this,r)||this;return u.onFinalize=s,u.shouldUnsubscribe=a,u._next=n?function(c){try{n(c)}catch(l){r.error(l)}}:e.prototype._next,u._error=i?function(c){try{i(c)}catch(l){r.error(l)}finally{this.unsubscribe()}}:e.prototype._error,u._complete=o?function(){try{o()}catch(c){r.error(c)}finally{this.unsubscribe()}}:e.prototype._complete,u}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t}(It);function pr(e){return e&&m(e.schedule)}function yr(e){return e[e.length-1]}function dr(e){return pr(yr(e))?e.pop():void 0}var Ht=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function ve(e){return m(e?.then)}function be(e){return m(e[Vt])}function Ee(e){return Symbol.asyncIterator&&m(e?.[Symbol.asyncIterator])}function Ce(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function mr(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Le=mr();function xe(e){return m(e?.[Le])}function ze(e){return tr(this,arguments,function(){var r,n,o,i;return he(this,function(s){switch(s.label){case 0:r=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,X(r.read())];case 3:return n=s.sent(),o=n.value,i=n.done,i?[4,X(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,X(o)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function _e(e){return m(e?.getReader)}function Y(e){if(e instanceof A)return e;if(e!=null){if(be(e))return Sr(e);if(Ht(e))return gr(e);if(ve(e))return wr(e);if(Ee(e))return Te(e);if(xe(e))return vr(e);if(_e(e))return br(e)}throw Ce(e)}function Sr(e){return new A(function(t){var r=e[Vt]();if(m(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function gr(e){return new A(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function wr(e){return new A(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,me)})}function vr(e){return new A(function(t){var r,n;try{for(var o=lt(e),i=o.next();!i.done;i=o.next()){var s=i.value;if(t.next(s),t.closed)return}}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}t.complete()})}function Te(e){return new A(function(t){Er(e,t).catch(function(r){return t.error(r)})})}function br(e){return Te(ze(e))}function Er(e,t){var r,n,o,i;return Ke(this,void 0,void 0,function(){var s,a;return he(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),r=er(e),u.label=1;case 1:return[4,r.next()];case 2:if(n=u.sent(),!!n.done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=u.sent(),o={error:a},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function $(e,t,r,n,o){n===void 0&&(n=0),o===void 0&&(o=!1);var i=t.schedule(function(){r(),o?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!o)return i}function Me(e,t){return t===void 0&&(t=0),Q(function(r,n){r.subscribe(ft(n,function(o){return $(n,e,function(){return n.next(o)},t)},function(){return $(n,e,function(){return n.complete()},t)},function(o){return $(n,e,function(){return n.error(o)},t)}))})}function Ae(e,t){return t===void 0&&(t=0),Q(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function Cr(e,t){return Y(e).pipe(Ae(t),Me(t))}function Lr(e,t){return Y(e).pipe(Ae(t),Me(t))}function xr(e,t){return new A(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function zr(e,t){return new A(function(r){var n;return $(r,t,function(){n=e[Le](),$(r,t,function(){var o,i,s;try{o=n.next(),i=o.value,s=o.done}catch(a){r.error(a);return}s?r.complete():r.next(i)},0,!0)}),function(){return m(n?.return)&&n.return()}})}function Ue(e,t){if(!e)throw new Error("Iterable cannot be null");return new A(function(r){$(r,t,function(){var n=e[Symbol.asyncIterator]();$(r,t,function(){n.next().then(function(o){o.done?r.complete():r.next(o.value)})},0,!0)})})}function _r(e,t){return Ue(ze(e),t)}function Tr(e,t){if(e!=null){if(be(e))return Cr(e,t);if(Ht(e))return xr(e,t);if(ve(e))return Lr(e,t);if(Ee(e))return Ue(e,t);if(xe(e))return zr(e,t);if(_e(e))return _r(e,t)}throw Ce(e)}function ke(e,t){return t?Tr(e,t):Y(e)}function bt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=dr(e);return ke(e,r)}var Mr=fe(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function Ar(e,t){return new Promise(function(r,n){var o=!1,i;e.subscribe({next:function(s){i=s,o=!0},error:n,complete:function(){o?r(i):n(new Mr)}})})}function E(e,t){return Q(function(r,n){var o=0;r.subscribe(ft(n,function(i){n.next(e.call(t,i,o++))}))})}var Ur=Array.isArray;function kr(e,t){return Ur(t)?e.apply(void 0,wt([],ht(t))):e(t)}function Dr(e){return E(function(t){return kr(e,t)})}function Or(e,t,r,n,o,i,s,a){var u=[],c=0,l=0,h=!1,p=function(){h&&!u.length&&!c&&t.complete()},f=function(d){return c<n?b(d):u.push(d)},b=function(d){c++;var N=!1;Y(r(d,l++)).subscribe(ft(t,function(G){t.next(G)},function(){N=!0},void 0,function(){if(N)try{c--;for(var G=function(){var L=u.shift();s||b(L)};u.length&&c<n;)G();p()}catch(L){t.error(L)}}))};return e.subscribe(ft(t,f,function(){h=!0,p()})),function(){}}function W(e,t,r){return r===void 0&&(r=1/0),m(t)?W(function(n,o){return E(function(i,s){return t(n,i,o,s)})(Y(e(n,o)))},r):(typeof t=="number"&&(r=t),Q(function(n,o){return Or(n,o,e,r)}))}function Fr(e){return W(ge,e)}function Ir(){return Fr(1)}var Gr=["addListener","removeListener"],Vr=["addEventListener","removeEventListener"],Hr=["on","off"];function Pt(e,t,r,n){if(m(r)&&(n=r,r=void 0),n)return Pt(e,t,r).pipe(Dr(n));var o=ht(qr(e)?Vr.map(function(a){return function(u){return e[a](t,u,r)}}):Pr(e)?Gr.map(De(e,t)):$r(e)?Hr.map(De(e,t)):[],2),i=o[0],s=o[1];if(!i&&Ht(e))return W(function(a){return Pt(a,t,r)})(Y(e));if(!i)throw new TypeError("Invalid event target");return new A(function(a){var u=function(){for(var c=[],l=0;l<arguments.length;l++)c[l]=arguments[l];return a.next(1<c.length?c:c[0])};return i(u),function(){return s(u)}})}function De(e,t){return function(r){return function(n){return e[r](t,n)}}}function Pr(e){return m(e.addListener)&&m(e.removeListener)}function $r(e){return m(e.on)&&m(e.off)}function qr(e){return m(e.addEventListener)&&m(e.removeEventListener)}function Jr(e,t,r,n,o){return function(i,s){var a=r,u=t,c=0;i.subscribe(ft(s,function(l){var h=c++;u=a?e(u,l,h):(a=!0,l)},function(){a&&s.next(u),s.complete()}))}}function Br(e,t){return Q(Jr(e,t,arguments.length>=2,!1,!0))}var jr=function(e,t){return e.push(t),e};function Zr(){return Q(function(e,t){Br(jr,[])(e).subscribe(t)})}function $t(e,t){return m(t)?W(e,t,1):W(e,1)}function Et(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function Oe(e,t){const{x:r,y:n,z:o}=t,{x:i,y:s,z:a,w:u}=e,c=u*r+s*o-a*n,l=u*n+a*r-i*o,h=u*o+i*n-s*r,p=-i*r-s*n-a*o,f=c*u+p*-i+l*-a-h*-s,b=l*u+p*-s+h*-i-c*-a,d=h*u+p*-a+c*-s-l*-i;return new t.constructor(f,b,d)}const qt=Math.PI,Jt=Math.PI*2;function pt(e){let t=e%Jt;return t<-qt?t+=Jt:t>qt&&(t-=Jt),t}function Nr(e){return e>-1?e<1?Math.acos(e):0:qt}function Rr(e,[t,r,n]){const[o,i,s]=e;return new e.constructor(new o.constructor(o.x*t.x+i.x*t.y+s.x*t.z,o.y*t.x+i.y*t.y+s.y*t.z,o.z*t.x+i.z*t.y+s.z*t.z),new o.constructor(o.x*r.x+i.x*r.y+s.x*r.z,o.y*r.x+i.y*r.y+s.y*r.z,o.z*r.x+i.z*r.y+s.z*r.z),new o.constructor(o.x*n.x+i.x*n.y+s.x*n.z,o.y*n.x+i.y*n.y+s.y*n.z,o.z*n.x+i.z*n.y+s.z*n.z))}function Xr(e,{x:t,y:r,z:n}){const[o,i,s]=e;return new o.constructor(o.x*t+i.x*r+s.x*n,o.y*t+i.y*r+s.y*n,o.z*t+i.z*r+s.z*n)}function Qr(e,[t,r,n]){return new e.constructor(e.dot(t),e.dot(r),e.dot(n))}function V(e){return typeof e=="number"||e?.constructor===Number}const Yr=e=>{try{tt(e),mt(e,4)}catch(t){console.error("error while hijackDOMPoint"),console.error(t)}},yt=0,Bt=1,jt=2,Zt=3,Ct=9999999999999,Lt=void 0,Fe=Symbol("vector length"),xt=Symbol("get source"),Ie=Symbol("checked");let M=Lt,H,K;const Wr=[0,1,2,6,24,120,720,5760,51840,518400,5702400,68428800,889574400,12454041600,186810624e3],Nt=[];let O=-1,Rt=!1;const zt=[];function Xt(e,t,r){M=e,O=-1,K=1;const n=t(r);if(!V(n))throw new Error(`
      your assigned progress did not not return a primitive!
      calc() does not support logical operators (|| && ==) directly

      instead of calc(() => v1 || v2);
      use        calc(() => +v1 || +v2);

      instead of calc(() => v1);
      use        calc(v1);
      `);return n}function _t(e){const t=e[xt];return t?t(e).length:e[Fe]||3}function Kr(e,t){return _t(e)>_t(t)?e:t}function tn(e,t){if(K+=1,t===Ct)return K;if(t>=_t(e))return 0;const r=e[xt];if(r)return 1*r(e)[t];if(t===yt)return 1*e.x;if(t===Bt)return 1*e.y;if(t===jt)return 1*e.z;if(t===Zt)return 1*e.w}function Ge(e,t,r){const n=e[xt];if(n){n(e)[t]=r;return}if(t===yt){e.x=r;return}if(t===Bt){e.y=r;return}t===jt&&(e.z=r),t===Zt&&(e.w=r)}function dt(e,t=void 0){if(typeof e!="function")throw new Error("no function assigned");if(M!==Lt)throw new Error("something wrong, do you use calc() inside calc?");try{const r=typeof t>"u",n=typeof t=="function",o=!n&&!r?t:void 0,i=Xt(yt,e,o);if(r&&typeof H>"u")return i;const s=H?_t(H):0;if(s===Ct){if(!e[Ie]){const l=Xt(Ct,e),h=Wr[K];if(Math.abs(l-h)>Number.EPSILON)throw new Error(`
            algebraic multiplication works only in calls with *

            calc(() => v * m);
            calc(() => m * v);
            calc(() => m * m);
            calc(() => m * m * v);

            `);e[Ie]=!0}let c=Nt[0];for(let l=1;l<K-1;l+=1){const h=Nt[l];if(!c.multiply)throw new Error(`cannot find method multiply() on ${c}`);c=c.multiply(h)}return c}let a=n?t.length:s;if(a||(a=s),a<s)throw new Error("Your assigned result Vector cant use higher space Operands than it has");const u=new Array(a);u[0]=i,o&&Ge(o,M,u[0]);for(let c=1;c<a;c+=1){const l=Xt(c,e,o);u[c]=l,o&&Ge(o,M,l)}return r?new H.constructor(...u):n?t(...u):o}finally{M=Lt,H=void 0}}function tt(e,t){const r=e.prototype;r[xt]=t;const n=r[Symbol.toPrimitive]||function(o){return o==="string"?this.toString():this.valueOf()};r[Symbol.toPrimitive]=function(o){return M===yt&&(H=H?Kr(H,this):this,Nt[K-1]=this),M===Lt?n.call(this,o):tn(this,M)}}function Qt(e){return function(...t){if(M===yt){if(Rt)return e.apply(this,t);try{Rt=!0,O+=1;const r=e.apply(this,t);return zt[O]=r,r}finally{Rt=!1}}return M===Bt||M===jt||M===Zt?(O+=1,zt[O]):e.apply(this,t)}}function x(e,t){const r=e.prototype,n=r[t];r[t]=Qt(n)}function Tt(e,t){const r=e.prototype,n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(r,t,{get:Qt(function(){return n.get.call(this)})})}function mt(e,t){const r=e.prototype;Object.defineProperty(r,Fe,{value:t})}function Ve(e){mt(e,Ct)}function Yt(e){return Qt(e)}typeof DOMPoint<"u"&&Yr(DOMPoint);function en(e){let t="";return e&&(t=`${e}-`),t}function St(e,t,r={}){const n=en(e);return Object.entries(t).forEach(([o,i])=>{r[`--${n}${o}`]=i}),r}const Wt=0,Kt=1,U=Symbol("axes");function rn(e,t,r,n){const o=Math.atan2(e,t),i=Math.atan2(r,n);return pt(o-i)}function He(e){return e*e}class k{constructor(...t){typeof t[0]=="function"?dt(t[0],(r,n)=>{this[U]=[r,n]}):Et(t[0])?this[U]=[...t[0]]:t[0]&&V(t[0].x)?this[U]=[t[0].x||0,t[0].y||0]:this[U]=[t[0]||0,t[1]||0]}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}normalize(){const{length:t}=this;return new this.constructor(this.x/t,this.y/t)}norm(){return this.normalize()}dot(t){return this.x*t.x+this.y*t.y}getRad(){return pt(Math.atan2(this.y,this.x))}angleTo(t){return rn(this.y,this.x,t.y,t.x)}rotate(t){const r=Math.sin(t),n=Math.cos(t),o=this.x*n-this.y*r,i=this.x*r+this.y*n;return new this.constructor(o,i)}distance(t){return Math.sqrt(He(this.x-t.x)+He(this.y-t.y))}dist(t){return this.distance(t)}toArray(){return[this.x,this.y]}calc(t){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(t){return this.x===t.x&&this.y===t.y}toJSON(){return{x:this.x,y:this.y}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,r={}){return St(t,this.toJSON(),r)}get lengthSq(){return this.dot(this)}get length(){return Math.sqrt(this.lengthSq)}get lensq(){return this.lengthSq}get len(){return this.length}get x(){return this[U][Wt]}set x(t){throw new Error("set x() not implemented")}get y(){return this[U][Kt]}set y(t){throw new Error("set y() not implemented")}get z(){throw new Error("get z() not implemented")}set z(t){throw new Error("set z() not implemented")}[Symbol.iterator](){return this[U].values()}}tt(k),mt(k,2),x(k,"dot"),x(k,"angleTo"),x(k,"distance"),x(k,"toArray"),x(k,"getRad"),Tt(k,"length"),Tt(k,"lengthSq");class te extends k{set x(t){this[U][Wt]=t}set y(t){this[U][Kt]=t}get x(){return this[U][Wt]}get y(){return this[U][Kt]}calc(t){return dt(t,this)}clone(){return new te(this.x,this.y)}}class et extends k{toPoint(){return new te(this.x,this.y)}}const nn=Yt((e,t)=>new et(e,t)),y=(e,t)=>nn(e,t);y(0,0),y(0,-1),y(-1,0);const rt=0,nt=1,ot=2,g=Symbol("axes");function ee(e){return e*e}class z{constructor(...t){typeof t[0]=="function"?dt(t[0],(r,n,o)=>{this[g]=[r,n,o]}):Et(t[0])?this[g]=[...t[0]]:t[0]&&V(t[0].x)?this[g]=[t[0].x||0,t[0].y||0,t[0].z||0]:this[g]=[t[0]||0,t[1]||0,t[2]||0]}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}normalize(){const{length:t}=this;return new this.constructor(this.x/t,this.y/t,this.z/t)}norm(){return this.normalize()}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new this.constructor(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossNormalize(t){const r=this.cross(t),{length:n}=r;return r[g][rt]/=n,r[g][nt]/=n,r[g][ot]/=n,r}cn(t){return this.crossNormalize(t)}toAngles(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length)}}angleTo(t){return pt(Nr(this.dot(t)/(this.length*t.length)))}multiply(t){return t.x===void 0?this.multiplyMat3(t):t.w===void 0?this.multiplyVec3(t):Oe(t,this)}multiplyMat3(t){return Qr(this,t)}multiplyVec3({x:t,y:r,z:n}){return new this.constructor(this.x*t,this.y*r,this.z*n)}distance(t){return Math.sqrt(ee(this.x-t.x)+ee(this.y-t.y)+ee(this.z-t.z))}dist(t){return this.distance(t)}toArray(){return[this.x,this.y,this.z]}swizzle(t){const r=t.split("").map(n=>this[n]);return r.length===2?new et(r[0],r[1]):new this.constructor(r[0],r[1],r[2])}calc(t){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}toJSON(){return{x:this.x,y:this.y,z:this.z}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,r={}){return St(t,this.toJSON(),r)}get lengthSq(){return this.dot(this)}set lengthSq(t){throw new Error("set lengthSq() not implemented")}get length(){return Math.sqrt(this.lengthSq)}set length(t){throw new Error("set length() not implemented")}get lensq(){return this.lengthSq}set lensq(t){throw new Error("set lensq() not implemented")}get len(){return this.length}set len(t){throw new Error("set len() not implemented")}get x(){return this[g][rt]}set x(t){throw new Error("set x() not implemented")}get y(){return this[g][nt]}set y(t){throw new Error("set y() not implemented")}get z(){return this[g][ot]}set z(t){throw new Error("set z() not implemented")}get xy(){return new et(this[g][rt],this[g][nt])}set xy(t){throw new Error("set xz() not implemented")}get xz(){return new et(this[g][rt],this[g][ot])}set xz(t){throw new Error("set xz() not implemented")}get yz(){return new et(this[g][nt],this[g][ot])}set yz(t){throw new Error("set yz() not implemented")}[Symbol.iterator](){return this[g].values()}}tt(z),mt(z,3),x(z,"dot"),x(z,"cross"),x(z,"crossNormalize"),x(z,"toAngles"),x(z,"angleTo"),x(z,"rotate"),x(z,"distance"),x(z,"toArray"),Tt(z,"length"),Tt(z,"lengthSq");class re extends z{set x(t){this[g][rt]=t}set y(t){this[g][nt]=t}set z(t){this[g][ot]=t}get x(){return this[g][rt]}get y(){return this[g][nt]}get z(){return this[g][ot]}calc(t){return dt(t,this)}clone(){return new re(this.x,this.y,this.z)}}class on extends z{toVector(){return new re(this.x,this.y,this.z)}clone(){return this}}const sn=Yt((e,t,r)=>new on(e,t,r)),P=(e,t,r)=>sn(e,t,r);P(0,0,0);const Pe=P(0,0,-1);P(0,0,1);const ne=P(-1,0,0);P(1,0,0);const $e=P(0,1,0);P(0,-1,0),P(1,1,1);const F=Symbol("angle rad"),qe=Math.PI/180;class it{constructor(t){t instanceof it?this[F]=t[F]:this[F]=pt(t*qe)}valueOf(){return this[F]}toJSON(){return{angle:this[F]}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,r={}){return St(t,this.toJSON(),r)}}class Je extends it{set(t){t instanceof it?this[F]=t[F]:this[F]=pt((t||0)*qe)}}class cn extends it{toDegree(){return new Je(this[F])}}new cn(0);function an(e){return new Je(e)}function un(e){return V(e)||e instanceof it}const q=0,J=1,B=2,j=3,st=Symbol("axes"),ln=Symbol("forward cache"),hn=Symbol("left cache"),fn=Symbol("up cache"),pn=Symbol("inverse cache");function yn([e,t,r,n]){return Math.sqrt(e*e+t*t+r*r+n*n)}function dn(e){const t=yn(e);e[q]/=t,e[J]/=t,e[B]/=t,e[j]/=t}function mn(e,t){const r=e.normalize(),n=t.crossNormalize(r),o=r.crossNormalize(n),i=n.x,s=n.y,a=n.z,u=o.x,c=o.y,l=o.z,h=r.x,p=r.y,f=r.z,b=i+c+f,d=new Array(4);if(b>0){let L=Math.sqrt(b+1);return d[j]=L*.5,L=.5/L,d[q]=(l-p)*L,d[J]=(h-a)*L,d[B]=(s-u)*L,d}if(i>=c&&i>=f){const L=Math.sqrt(1+i-c-f),R=.5/L;return d[q]=.5*L,d[J]=(s+u)*R,d[B]=(a+h)*R,d[j]=(l-p)*R,d}if(c>f){const L=Math.sqrt(1+c-i-f),R=.5/L;return d[q]=(u+s)*R,d[J]=.5*L,d[B]=(p+l)*R,d[j]=(h-a)*R,d}const N=Math.sqrt(1+f-i-c),G=.5/N;return d[q]=(h+a)*G,d[J]=(p+l)*G,d[B]=.5*N,d[j]=(s-u)*G,d}function Sn(e,t){const r=new Array(4),n=t*.5,o=Math.sin(n),i=Math.cos(n);return r[q]=o*e.x,r[J]=o*e.y,r[B]=o*e.z,r[j]=i,r}function oe(e,t,r,n){if(V(e))return[e,t,r,n];if(Et(e))return[...e];if(un(t))return Sn(e,t);if(e&&t)return mn(e,t)}function gn(e,t,r,n){return e&&V(e.w)?oe(e.x,e.y,e.z,e.w):oe(e,t,r,n)||[0,0,0,1]}class ie{constructor(t,r,n,o){this[st]=gn(t,r,n,o),dn(this[st])}set(t,r,n,o){throw new Error("set x() not implemented")}multiply(t,r,n,o){if(V(t.w))return this.multiplyQuaternion(t);const i=oe(t,r,n,o);return i?this.multiplyQuaternion(new this.constructor(i)):this.multiplyVector(t)}multiplyVector(t){return Oe(this,t)}multiplyQuaternion(t){const r=this.x,n=this.y,o=this.z,i=this.w,s=t.x,a=t.y,u=t.z,c=t.w,l=i*s+r*c+n*u-o*a,h=i*a+n*c+o*s-r*u,p=i*u+o*c+r*a-n*s,f=i*c-r*s-n*a-o*u;return new this.constructor(l,h,p,f)}mul(t,r,n,o){return this.multiply(t,r,n,o)}get inverse(){const{x:t,y:r,z:n,w:o}=this;return this.constructor(t*-1,r*-1,n*-1,o)}get inv(){return this.inverse}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}get left(){return this.multiplyVector(ne)}get dir(){return this.multiplyVector(Pe)}get up(){return this.multiplyVector($e)}get 0(){return this.left}get 1(){return this.dir}get 2(){return this.up}get x(){return this[st][q]}set x(t){throw new Error("set x() not implemented")}get y(){return this[st][J]}set y(t){throw new Error("set y() not implemented")}get z(){return this[st][B]}set z(t){throw new Error("set z() not implemented")}get w(){return this[st][j]}set w(t){throw new Error("set w() not implemented")}toJSON(){const{x:t,y:r,z:n,w:o}=this;return{x:t,y:r,z:n,w:o,a1:1-r*r*2-n*n*2,a2:t*r*2-n*o*2,a3:t*n*2+r*o*2,b1:t*r*2+n*o*2,b2:1-t*t*2-n*n*2,b3:r*n*2-t*o*2,c1:t*n*2-r*o*2,c2:r*n*2+t*o*2,c3:1-t*t*2-r*r*2}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,r={}){return St(t,this.toJSON(),r)}}tt(ie),Ve(ie);function Mt(e,t,r){let n=e[t];return n||(n=r(),e[t]=n),n}class Be extends ie{get left(){return Mt(this,hn,()=>this.multiplyVector(ne))}get dir(){return Mt(this,ln,()=>this.multiplyVector(Pe))}get up(){return Mt(this,fn,()=>this.multiplyVector($e))}get inverse(){return Mt(this,pn,()=>{const{x:t,y:r,z:n,w:o}=this;return this.constructor(t*-1,r*-1,n*-1,o)})}}const wn=Yt((e,t,r,n)=>new Be(e,t,r,n)),vn=(e,t,r,n)=>wn(e,t,r,n);new Be(ne,an(90)),vn(0,0,0,1);const bn=0,En=1,Cn=2,Ln=3,I=Symbol("axes");class se{constructor(t,r,n,o){typeof t=="function"?dt(t,(i,s,a,u)=>{this[I]=[i,s,a,u]}):Et(t)?this[I]=[...t]:t&&V(t.x)?this[I]=[t.x||0,t.y||0,t.z||0,t.w||0]:this[I]=[t||0,r||0,n||0,o||0]}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}valueOf(){throw new Error("valueOf() not implemented, looks like you try to calculate outside of calc")}toArray(){return[this.x,this.y,this.z,this.w]}calc(t){throw new Error("calc() not implemented")}clone(){throw new Error("clone() not implemented")}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}toJSON(){return{x:this.x,y:this.y,z:this.z,w:this.w}}toString(){return JSON.stringify(this.toJSON())}toCSSVars(t,r={}){return St(t,this.toJSON(),r)}get x(){return this[I][bn]}set x(t){throw new Error("set x() not implemented")}get y(){return this[I][En]}set y(t){throw new Error("set y() not implemented")}get z(){return this[I][Cn]}set z(t){throw new Error("set z() not implemented")}get w(){return this[I][Ln]}set w(t){throw new Error("set w() not implemented")}[Symbol.iterator](){return this[I].values()}}tt(se),mt(se,4),x(se,"toArray");const gt=Symbol("data");class At{constructor(...t){this[gt]=t}get 0(){return this[gt][0]}set 0(t){throw new Error("set [0] not implemented")}get 1(){return this[gt][1]}set 1(t){throw new Error("set [1] not implemented")}get 2(){return this[gt][2]}set 2(t){throw new Error("set [2] not implemented")}multiplyMat(t){return Rr(this,t)}multiplyVec(t){return Xr(this,t)}multiply(t){if(t instanceof At)return this.multiplyMat(t);const{x:r,y:n,z:o}=t;if(r===void 0||n===void 0||o===void 0)throw new Error(`multiply only works with mat3 and vec3, not supported ${t}`);return this.multiplyVec(t)}[Symbol.iterator](){return this[gt].values()}}tt(At),Ve(At);const xn=[{validator:()=>!0,handler:()=>e=>e.pipe(E(t=>t))}];class D{validator;handler;constructor(t,r){this.validator=t,this.handler=r}}const zn=(e=[])=>[...e,...xn],_n=[{validator:()=>!0,handler:()=>e=>e.pipe(E(t=>t))}],Tn=(e=[])=>[...e,..._n],je={[Object.prototype.constructor.name]:e=>t=>t.pipe(E(Object.entries),ct(e),E(Object.fromEntries)),[Array.prototype.constructor.name]:e=>t=>t.pipe(Ir(),ct(e),Zr()),[Promise.prototype.constructor.name]:e=>t=>t.pipe($t(r=>ke(r)),ct(e)),[A.prototype.constructor.name]:e=>t=>t.pipe($t(r=>r),ct(e)),[void 0]:()=>e=>e};function Mn(e=[]){return t=>t.pipe(ct(zn(e)))}function An(e=[]){return t=>t.pipe(ct(Tn(e)))}function ct(e){return t=>t.pipe(W(r=>{const n=Un(r),o=n&&je[n];return o?bt(r).pipe(o(e)):bt(r)}),kn(e))}function Un(e){if(e==null)return;const t=e.constructor;if(t){const r=t.name;if(Object.prototype.hasOwnProperty.call(je,r))return r}}function kn(e){return t=>t.pipe($t(r=>bt(r).pipe(Dn(e,r).handler())))}const Dn=(e,t)=>{const r=e.find(({validator:n})=>n(t));return r||{validator:()=>!0,handler:n=>n}};function On(e,t,r){let n,o,i;if(t===0)n=o=i=r;else{const s=(c,l,h)=>(h<0&&(h+=1),h>1&&(h-=1),h<.16666666666666666?c+(l-c)*6*h:h<.5?l:h<.6666666666666666?c+(l-c)*(.6666666666666666-h)*6:c),a=r<.5?r*(1+t):r+t-r*t,u=2*r-a;n=s(u,a,e/360+1/3),o=s(u,a,e/360),i=s(u,a,e/360-1/3)}return{r:Math.round(n*255),g:Math.round(o*255),b:Math.round(i*255)}}class S{constructor(t,r=0,n=0,o=255){if(this.g=r,this.b=n,this.a=o,Array.isArray(t))[this.r,this.g,this.b,this.a]=t;else if(typeof t=="string"){const i=S.fromHex(t);this.r=i.r,this.g=i.g,this.b=i.b,this.a=i.a}else typeof t=="object"?(this.r=t.r||0,this.g=t.g||0,this.b=t.b||0,this.a=t.a!==void 0?t.a:255):(this.r=t,this.g=r||0,this.b=n||0,this.a=o===void 0?255:o);this.r=Math.min(Math.max(this.r,0),255),this.g=Math.min(Math.max(this.g,0),255),this.b=Math.min(Math.max(this.b,0),255),this.a=Math.min(Math.max(this.a,0),255)}static TRANSPARENT=new S(0,0,0,0);static TYPE="Color";static fromHex(t){t.length===4&&(t=`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`);const r=parseInt(t.slice(1,3),16),n=parseInt(t.slice(3,5),16),o=parseInt(t.slice(5,7),16),i=parseInt(t.slice(7,9),16);return new S(r,n,o,isNaN(i)?255:i)}static fromHsl(t,r,n,o=255){const{r:i,g:s,b:a}=On(t,r,n);return new S(i,s,a,o)}static isValidHex(t){return/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(t)}r;toInverted(){return new S(255-this.r,255-this.g,255-this.b,this.a)}toJSON(){return{_type:S.TYPE,r:this.r,g:this.g,b:this.b,a:this.a}}toHex(){return`#${this.toRGBA().map(t=>t.toString(16).padStart(2,"0")).join("")}`}toRGB(){return[this.r,this.g,this.b]}toRGBA(){return[...this.toRGB(),this.a]}toCSSRGB(){return[...this.toRGB()]}toCSSRGBA(){return[...this.toRGB(),this.a/255]}toHsl(){const t=this.r/255,r=this.g/255,n=this.b/255,o=Math.max(t,r,n),i=Math.min(t,r,n);let s=0,a=0;const u=(o+i)/2;if(o===i)s=a=0;else{const c=o-i;switch(a=u>.5?c/(2-o-i):c/(o+i),o){case t:s=(r-n)/c+(r<n?6:0);break;case r:s=(n-t)/c+2;break;case n:s=(t-r)/c+4;break}s/=6}return[Math.round(s*360),a,u]}toHsla(){const[t,r,n]=this.toHsl();return[t,r,n,this.a]}toHsv(){const t=this.r/255,r=this.g/255,n=this.b/255,o=Math.max(t,r,n),i=Math.min(t,r,n);let s=0,a=0;const u=o,c=o-i;if(o!==0)a=c/o;else return[0,0,0];if(o===i)s=0;else{switch(o){case t:s=(r-n)/c+(r<n?6:0);break;case r:s=(n-t)/c+2;break;case n:s=(t-r)/c+4;break}s/=6}return[Math.round(s*360),a,u]}toHsva(){const[t,r,n]=this.toHsv();return[t,r,n,this.a]}getHslaHue(){const[t]=this.toHsl();return t}getHslaSaturation(){const[t]=this.toHsl();return t}getHslaLightness(){const[t]=this.toHsl();return t}setHslaHue(t){const[r,n,o]=this.toHsl();return S.fromHsl(r+t,n,o,this.a)}setHslaSaturation(t){const[r,n,o]=this.toHsl();return S.fromHsl(r,n+t,o,this.a)}setHslaLightness(t){const[r,n,o]=this.toHsl();return S.fromHsl(r,n,o+t,this.a)}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}clone(){return new S(this.r,this.g,this.b,this.a)}}var w=(e=>(e.TOP_LEFT="top_left",e.TOP_CENTER="top_center",e.TOP_RIGHT="top_right",e.CENTER_LEFT="center_left",e.CENTER="center",e.CENTER_RIGHT="center_right",e.BOTTOM_LEFT="bottom_left",e.BOTTOM_CENTER="bottom_center",e.BOTTOM_RIGHT="bottom_right",e))(w||{});class at{static TYPE="DisplayOptions";origin;position;colors;pixelGrid;grid;zoomLevel;precision;constructor(t){const{origin:r,position:n,colors:o,pixelGrid:i,grid:s,zoomLevel:a}=t||{};this.origin=r||w.CENTER,this.position=n?y(n.x,n.y):y(0,0),this.colors={background:o?.background?new S(o.background):new S(0,0,0),foreground:o?.foreground?new S(o.foreground):new S(255,255,255)},this.pixelGrid={color:i?.color?new S(i.color):new S(0,0,0,255*.2),lineWidth:i?.lineWidth??1,visibleCount:i?.visibleCount??10},this.grid={active:s?.active??!1,colors:{primary:s?.colors?new S(s.colors.primary):new S(0,221,204,255*.6),secondary:s?.colors?new S(s.colors.secondary):new S(0,221,204,255*.4)},position:s?.position?y(s.position.x,s.position.y):y(0,0),dimension:s?.dimension?y(s.dimension.x,s.dimension.y):y(1,1)},this.zoomLevel=a||1,this.precision=3}toJSON(){return{_type:at.TYPE,origin:this.origin,position:this.position.toJSON(),colors:{background:this.colors.background.toJSON(),foreground:this.colors.foreground.toJSON()},pixelGrid:{color:this.pixelGrid.color.toJSON(),lineWidth:this.pixelGrid.lineWidth,visibleCount:this.pixelGrid.visibleCount},grid:{active:this.grid.active,colors:{primary:this.grid.colors.primary.toJSON(),secondary:this.grid.colors.secondary.toJSON()},position:this.grid.position.toJSON(),dimension:this.grid.dimension.toJSON()},zoomLevel:this.zoomLevel,precision:this.precision}}}w.TOP_LEFT+"",y(-1,-1),w.TOP_CENTER+"",y(0,-1),w.TOP_RIGHT+"",y(1,-1),w.CENTER_LEFT+"",y(-1,0),w.CENTER+"",y(0,0),w.CENTER_RIGHT+"",y(1,0),w.BOTTOM_LEFT+"",y(-1,1),w.BOTTOM_CENTER+"",y(0,1),w.BOTTOM_RIGHT+"",y(1,1);class Z{static TYPE="PaletteColor";id;color;constructor(t){const{id:r,color:n}=t||{};this.id=r||crypto.randomUUID(),this.color=n?new S(n):new S(0,0,0)}setColor(t){this.color=t}equal(t){return this.id===t?.id}toJSON(){return{_type:Z.TYPE,id:this.id,color:this.color.toJSON()}}clone(){return new Z({id:this.id,color:this.color.clone()})}}class ut{static TYPE="Palette";id;name;description;colors;locked;constructor(t){const{id:r,name:n,description:o,colors:i,locked:s}=t||{};this.id=r||crypto.randomUUID(),this.name=n||"",this.description=o,this.colors=(i||[]).map(a=>new Z(a)),this.locked=s}clone(){return new ut({id:this.id,name:this.name,description:this.description,colors:this.colors.map(t=>t.clone()),locked:this.locked})}toJSON(){return{_type:ut.TYPE,id:this.id,name:this.name,description:this.description,colors:this.colors.map(t=>t.toJSON()),locked:this.locked}}}const Fn=[new D(e=>e&&e instanceof et,()=>e=>e.pipe(E(t=>({__type:"IPoint",...t.toJSON()})))),new D(e=>e&&e instanceof at,()=>e=>e.pipe(E(t=>t.toJSON()))),new D(e=>e&&e instanceof S,()=>e=>e.pipe(E(t=>t.toJSON()))),new D(e=>e&&e instanceof Z,()=>e=>e.pipe(E(t=>t.toJSON()))),new D(e=>e&&e instanceof ut,()=>e=>e.pipe(E(t=>t.toJSON())))],In=[new D(e=>typeof e=="object"&&"__type"in e&&e.__type==="IPoint",()=>e=>e.pipe(E(t=>y(t.x,t.y)))),new D(e=>e&&at.TYPE===e._type,()=>e=>e.pipe(E(t=>new at(t)))),new D(e=>e&&S.TYPE===e._type,()=>e=>e.pipe(E(t=>new S(t)))),new D(e=>e&&Z.TYPE===e._type,()=>e=>e.pipe(E(t=>new Z(t)))),new D(e=>e&&ut.TYPE===e._type,()=>e=>e.pipe(E(t=>new ut(t))))];function Gn(){return e=>e.pipe(Mn(Fn))}function Vn(){return e=>e.pipe(An(In))}const _={fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},Ze={silent:{level:-1},fatal:{level:_.fatal},error:{level:_.error},warn:{level:_.warn},log:{level:_.log},info:{level:_.info},success:{level:_.success},fail:{level:_.fail},ready:{level:_.info},start:{level:_.info},box:{level:_.info},debug:{level:_.debug},trace:{level:_.trace},verbose:{level:_.verbose}};function ce(e){if(e===null||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.iterator in e?!1:Symbol.toStringTag in e?Object.prototype.toString.call(e)==="[object Module]":!0}function ae(e,t,r=".",n){if(!ce(t))return ae(e,{},r);const o=Object.assign({},t);for(const i in e){if(i==="__proto__"||i==="constructor")continue;const s=e[i];s!=null&&(Array.isArray(s)&&Array.isArray(o[i])?o[i]=[...s,...o[i]]:ce(s)&&ce(o[i])?o[i]=ae(s,o[i],(r?`${r}.`:"")+i.toString()):o[i]=s)}return o}function Hn(e){return(...t)=>t.reduce((r,n)=>ae(r,n,""),{})}const Pn=Hn();function $n(e){return Object.prototype.toString.call(e)==="[object Object]"}function qn(e){return!(!$n(e)||!e.message&&!e.args||e.stack)}let ue=!1;const Ne=[];class C{options;_lastLog;_mockFn;constructor(t={}){const r=t.types||Ze;this.options=Pn({...t,defaults:{...t.defaults},level:le(t.level,r),reporters:[...t.reporters||[]]},{types:Ze,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const n in r){const o={type:n,...this.options.defaults,...r[n]};this[n]=this._wrapLogFn(o),this[n].raw=this._wrapLogFn(o,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(t){this.options.level=le(t,this.options.types,this.options.level)}prompt(t,r){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(t,r)}create(t){const r=new C({...this.options,...t});return this._mockFn&&r.mockTypes(this._mockFn),r}withDefaults(t){return this.create({...this.options,defaults:{...this.options.defaults,...t}})}withTag(t){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+t:t})}addReporter(t){return this.options.reporters.push(t),this}removeReporter(t){if(t){const r=this.options.reporters.indexOf(t);if(r!==-1)return this.options.reporters.splice(r,1)}else this.options.reporters.splice(0);return this}setReporters(t){return this.options.reporters=Array.isArray(t)?t:[t],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const t in this.options.types)console["__"+t]||(console["__"+t]=console[t]),console[t]=this[t].raw}restoreConsole(){for(const t in this.options.types)console["__"+t]&&(console[t]=console["__"+t],delete console["__"+t])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(t,r){t&&(t.__write||(t.__write=t.write),t.write=n=>{this[r].raw(String(n).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(t){t&&t.__write&&(t.write=t.__write,delete t.__write)}pauseLogs(){ue=!0}resumeLogs(){ue=!1;const t=Ne.splice(0);for(const r of t)r[0]._logFn(r[1],r[2])}mockTypes(t){const r=t||this.options.mockFn;if(this._mockFn=r,typeof r=="function")for(const n in this.options.types)this[n]=r(n,this.options.types[n])||this[n],this[n].raw=this[n]}_wrapLogFn(t,r){return(...n)=>{if(ue){Ne.push([this,t,n,r]);return}return this._logFn(t,n,r)}}_logFn(t,r,n){if((t.level||0)>this.level)return!1;const o={date:new Date,args:[],...t,level:le(t.level,this.options.types)};!n&&r.length===1&&qn(r[0])?Object.assign(o,r[0]):o.args=[...r],o.message&&(o.args.unshift(o.message),delete o.message),o.additional&&(Array.isArray(o.additional)||(o.additional=o.additional.split(`
`)),o.args.push(`
`+o.additional.join(`
`)),delete o.additional),o.type=typeof o.type=="string"?o.type.toLowerCase():"log",o.tag=typeof o.tag=="string"?o.tag:"";const i=(a=!1)=>{const u=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&u>0){const c=[...this._lastLog.object.args];u>1&&c.push(`(repeated ${u} times)`),this._log({...this._lastLog.object,args:c}),this._lastLog.count=1}a&&(this._lastLog.object=o,this._log(o))};clearTimeout(this._lastLog.timeout);const s=this._lastLog.time&&o.date?o.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=o.date,s<this.options.throttle)try{const a=JSON.stringify([o.type,o.tag,o.args]),u=this._lastLog.serialized===a;if(this._lastLog.serialized=a,u&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin)){this._lastLog.timeout=setTimeout(i,this.options.throttle);return}}catch{}i(!0)}_log(t){for(const r of this.options.reporters)r.log(t,{options:this.options})}}function le(e,t={},r=3){return e===void 0?r:typeof e=="number"?e:t[e]&&t[e].level!==void 0?t[e].level:r}C.prototype.add=C.prototype.addReporter,C.prototype.remove=C.prototype.removeReporter,C.prototype.clear=C.prototype.removeReporter,C.prototype.withScope=C.prototype.withTag,C.prototype.mock=C.prototype.mockTypes,C.prototype.pause=C.prototype.pauseLogs,C.prototype.resume=C.prototype.resumeLogs;function Jn(e={}){return new C(e)}class Bn{options;defaultColor;levelColorMap;typeColorMap;constructor(t){this.options={...t},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(t){return t<1?console.__error||console.error:t===1?console.__warn||console.warn:console.__log||console.log}log(t){const r=this._getLogFn(t.level),n=t.type==="log"?"":t.type,o=t.tag||"",s=`
      background: ${this.typeColorMap[t.type]||this.levelColorMap[t.level]||this.defaultColor};
      border-radius: 0.5em;
      color: white;
      font-weight: bold;
      padding: 2px 0.5em;
    `,a=`%c${[o,n].filter(Boolean).join(":")}`;typeof t.args[0]=="string"?r(`${a}%c ${t.args[0]}`,s,"",...t.args.slice(1)):r(a,s,...t.args)}}function jn(e={}){return Jn({reporters:e.reporters||[new Bn({})],prompt(r,n={}){return n.type==="confirm"?Promise.resolve(confirm(r)):Promise.resolve(prompt(r))},...e})}const Ut=jn().withTag("webPaint");Ut.withTag("workerManager");const Zn=Ut.withTag("display"),Re=Ut.withTag("worker");Re.withTag("main"),Re.withTag("display");var v=(e=>(e.DEFAULT="default",e.REFRESH="refresh",e.REFRESH_SUCCESS="refreshSuccess",e.DEBUG="debug",e.INIT="init",e.INIT_SUCCESS="initSuccess",e.SYNC_STATE="syncState",e.SYNC_STATE_SUCCESS="syncStateSuccess",e.ADD_RENDER_WORKER_PORT="addRenderWorkerPort",e.ADD_RENDER_WORKER_PORT_SUCCESS="addRenderWorkerPortSuccess",e.LOAD_IMAGE="loadImage",e.LOAD_IMAGE_SUCCESS="loadImageSuccess",e.UPDATE_CANVAS="updateCanvas",e.UPDATE_BUFFER="updateBuffer",e.UPDATE_BUFFER_SUCCESS="updateBufferSuccess",e.STACK="stack",e.STACK_SUCCESS="stackSuccess",e.UNDO_STACK="undoStack",e.UNDO_STACK_SUCCESS="undoStackSuccess",e.REDO_STACK="redoStack",e.REDO_STACK_SUCCESS="redoStackSuccess",e.CLEAR="clear",e.CLEAR_SUCCESS="clearSuccess",e.SET_ZOOM="setZoom",e.SET_ZOOM_SUCCESS="setZoomSuccess",e.ZOOM_FIT="zoomFit",e.ZOOM_FIT_SUCCESS="zoomFitSuccess",e.SET_POSITION="setPosition",e.SET_POSITION_SUCCESS="setPositionSuccess",e.USE_TOOL="useTool",e.USE_TOOL_SUCCESS="useToolSuccess",e.SET_SELECT_OPTIONS="setSelectOptions",e.SET_SELECT_OPTIONS_SUCCESS="setSelectOptionsSuccess",e.GET_DATA="getData",e.GET_DATA_SUCCESS="getDataSuccess",e.RESIZE="resize",e.RESIZE_SUCCESS="resizeSuccess",e.RESIZE_CANVAS="resizeCanvas",e.RESIZE_CANVAS_SUCCESS="resizeCanvasSuccess",e.GET_COLORS="getColors",e.GET_COLORS_SUCCESS="getColorsSuccess",e.IMAGE_OPERATION="imageOperation",e.IMAGE_OPERATION_SUCCESS="imageOperationSuccess",e.COLOR_PICKER="colorPicker",e.COLOR_PICKER_SUCCESS="colorPickerSuccess",e.SET_OPTIONS="setOptions",e.SET_OPTIONS_SUCCESS="setOptionsSuccess",e.INSERT_IMAGE="insertImage",e.INSERT_IMAGE_SUCCESS="insertImageSuccess",e.ROTATE="rotate",e.ROTATE_SUCCESS="rotateSuccess",e.FLIP="flip",e.FLIP_SUCCESS="flipSuccess",e.SELECT_LAYER="selectLayer",e.SELECT_CURRENT_SUCCESS="selectLayerSuccess",e.UPDATE_LAYER="updateLayer",e.UPDATE_LAYER_SUCCESS="updateLayerSuccess",e.ADD_LAYER="addLayer",e.ADD_LAYER_SUCCESS="addLayerSuccess",e.REMOVE_LAYER="removeLayer",e.REMOVE_LAYER_SUCCESS="removeLayerSuccess",e.MOVE_LAYERS="moveLayer",e.MOVE_LAYER_SUCCESS="moveLayerSuccess",e.GET_LAYERS="getLayers",e.GET_LAYERS_SUCCESS="getLayersSuccess",e.LOAD_DOCUMENT="loadDocument",e.LOAD_DOCUMENT_SUCCESS="loadDocumentSuccess",e.DUPLICATE_LAYER="duplicateLayer",e.DUPLICATE_LAYER_SUCCESS="duplicateLayerSuccess",e.MERGE_LAYERS="mergeLayers",e.MERGE_LAYERS_SUCCESS="mergeLayersSuccess",e.SET_LAYERS="setLayers",e.SET_LAYERS_SUCCESS="setLayersSuccess",e))(v||{});const Nn="[RenderWorker]";function Rn(e){throw e instanceof Error&&(e=e.message||e.toString()),new Error(`${Nn}: ${e}`)}async function Xn(e,t){const{debug:r,canvas:n,port:o,options:i}=t.payload;return e.debug=r,e.options=i,e.canvas=n,e.ctx=e.canvas.getContext("2d",{willReadFrequently:!0}),e.ctx.imageSmoothingEnabled=!1,e.mainWorkerPort=o,e.mainWorkerPort?e.mainWorkerPort.onmessage=Qn(e):Rn("mainWorkerPort not received in init message!"),{type:v.INIT_SUCCESS}}function Qn(e){return t=>{Xe(e,t.data.data)}}async function Yn(e,t){const{dimension:r}=t.payload;return e.isReady()&&e.canvas&&(e.canvas.width=r.x,e.canvas.height=r.y,e.ctx.imageSmoothingEnabled=!1,e.updateCanvas()),{type:v.REFRESH_SUCCESS}}function Wn(e,t){return e.canvas&&(e.canvas.height=405),e.draw(),console.log("DEBUG"),Promise.resolve({type:t.type})}async function Kn(e,t){const{sharedBuffer:r}=t.payload;return e.setSharedBuffer(r),e.updateCanvas(),{type:v.UPDATE_BUFFER_SUCCESS}}async function to(e,t){const{options:r}=t.payload;return e.options=r,e.updateCanvas(),{type:v.SET_OPTIONS_SUCCESS}}async function eo(e,t){return e.setZoom(t.payload.position,t.payload.zoomLevel,t.payload.replace),e.updateCanvas(),{type:v.SET_ZOOM_SUCCESS,payload:{position:e.options.position,currentZoomLevel:e.currentZoomLevel}}}async function ro(e,t){return no(e,e.getDimensionImageData(),t.payload.value),e.updateCanvas(),{type:v.ZOOM_FIT_SUCCESS}}function no(e,t,r=1){r<=0&&(r=1);const n=e.getDimensionOffscreenCanvas(),o=.1;let i=Math.min(n.x/t.x,n.y/t.y);i=i-Math.min(n.x/t.x,n.y/t.y)*o,i*=r,i!==1&&(e.setZoom(y(0,0),i,!0),e.updateCanvas(),e.action({id:crypto.randomUUID(),data:{type:v.SET_ZOOM_SUCCESS,payload:{position:e.options.position,currentZoomLevel:e.currentZoomLevel}}}))}function oo(e,t){return e.setPosition(t.payload.position),e.updateCanvas(),{type:v.SET_POSITION_SUCCESS,payload:{}}}async function io(e,t){return e.updateCanvas(),{type:t.type}}async function so(e,t){const{layers:r}=t.payload;return e.setLayers(r),e.updateCanvas(),{type:v.UPDATE_BUFFER_SUCCESS}}async function Xe(e,t){const{type:r}=t,n=Zn.withTag("Incoming").withTag("action");switch(e.debug&&n.withTag(r).start(t),r){case v.INIT:return Xn(e,t);case v.UPDATE_BUFFER:return Kn(e,t);case v.UPDATE_CANVAS:return io(e,t);case v.SET_LAYERS:return so(e,t);case v.REFRESH:return Yn(e,t);case v.SET_OPTIONS:return to(e,t);case v.SET_ZOOM:return eo(e,t);case v.ZOOM_FIT:return ro(e,t);case v.SET_POSITION:return oo(e,t);case v.DEBUG:return Wn(e,t);default:e.debug&&n.warn("Unknown message type from Creator Thread:",r)}}const co={[w.TOP_LEFT]:y(-.5,-.5),[w.TOP_CENTER]:y(0,-.5),[w.TOP_RIGHT]:y(.5,-.5),[w.CENTER_LEFT]:y(-.5,0),[w.CENTER]:y(0,0),[w.CENTER_RIGHT]:y(.5,0),[w.BOTTOM_LEFT]:y(-.5,.5),[w.BOTTOM_CENTER]:y(0,.5),[w.BOTTOM_RIGHT]:y(.5,.5)};function ao(e,t,r,n=new S(0,0,0,255*.2),o=1,i=10){const s=e.options.zoomLevel,a=e.getDimensionImageData(!0),u=y(()=>a/s),c=y(()=>a/u),l=y(()=>r.position*s*-1);if(t.lineWidth=o,t.strokeRect(l.x,l.y,a.x,a.y),c.x<i)return;const h=new Path2D;for(let p=0;p<=u.x;p++)h.moveTo(l.x+c.x*p,l.y),h.lineTo(l.x+c.x*p,l.y+a.y);for(let p=0;p<=u.y;p++)h.moveTo(l.x,l.y+c.y*p),h.lineTo(l.x+a.x,l.y+c.y*p);t.strokeStyle=`rgba(${n.toCSSRGBA()})`,t.stroke(h),t.globalCompositeOperation="source-over"}function uo(e,t,r,n){if(!n.active)return;const o=e.options.zoomLevel,i=e.getDimensionImageData(!0),s=n.dimension,a=y(()=>i/o/n.dimension*2);let u=y(()=>i/a);u=y(()=>u*a/(2*s));const c=y(()=>r.position*o*-1),l=y(()=>n.position*u),h=y(()=>i/u);let p=new Path2D;p.moveTo(l.x+c.x+i.x/2,c.y),p.lineTo(l.x+c.x+i.x/2,c.y+i.y),p.moveTo(c.x,l.y+c.y+i.y/2),p.lineTo(c.x+i.x,l.y+c.y+i.y/2),t.lineWidth=2,t.strokeStyle=`rgba(${n.colors.primary.toCSSRGBA()})`,t.stroke(p),p=new Path2D;for(let f=0;f<=h.x;f++)p.moveTo(c.x+u.x*f,c.y),p.lineTo(c.x+u.x*f,c.y+i.y);for(let f=0;f<=h.y;f++)p.moveTo(c.x,c.y+u.y*f),p.lineTo(c.x+i.x,c.y+u.y*f);t.lineWidth=1,t.strokeStyle=`rgba(${n.colors.secondary.toCSSRGBA()})`,t.stroke(p),t.globalCompositeOperation="source-over"}function Qe(e){const t=new OffscreenCanvas(e.width,e.height),r=t.getContext("2d",{willReadFrequently:!0});return r&&(r.imageSmoothingEnabled=!1,r.putImageData(e,0,0)),t}var T=(e=>(e.NORMAL="normal",e.MULTIPLY="multiply",e.SCREEN="screen",e.OVERLAY="overlay",e.DARKEN="darken",e.LIGHTEN="lighten",e.COLOR_DODGE="colorDodge",e.COLOR_BURN="colorBurn",e.HARD_LIGHT="hardLight",e.SOFT_LIGHT="softLight",e.DIFFERENCE="difference",e.EXCLUSION="exclusion",e))(T||{});function Ye(e,t=e.lastImageData){if(e.canvas&&e.ctx&&t){e.lastImageData=t;const r=Qe(t);e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height);const n=e.getDimensionOffscreenCanvas(),o=e.getDimensionImageData(),i=e.getDimensionImageData(!0),s=y(()=>((n-i)/2+(n-i)*co[e.options.origin])/i);let a=y(()=>o*s*-1);const u=y(()=>n/i*o),c=y(()=>e.options.position*o);a=y(()=>c+a);const l={position:a,dimension:u},h={position:y(0,0),dimension:n};e.layers.filter(p=>p.visible).forEach(p=>{if(e.ctx.globalCompositeOperation=lo(p.blendMode),e.ctx.globalAlpha=p.opacity,p.current)e.ctx.drawImage(r,l.position.x,l.position.y,l.dimension.x,l.dimension.y,h.position.x,h.position.y,h.dimension.x,h.dimension.y);else{const f=p.canvas;e.ctx.drawImage(f,l.position.x,l.position.y,l.dimension.x,l.dimension.y,h.position.x,h.position.y,h.dimension.x,h.dimension.y)}e.ctx.globalAlpha=1,e.ctx.globalCompositeOperation="source-over"}),ao(e,e.ctx,l,e.options.pixelGrid.color,e.options.pixelGrid.lineWidth,e.options.pixelGrid.visibleCount),uo(e,e.ctx,l,e.options.grid)}else throw new Error("Display render failed: Offscreen canvas or context is not available.")}function lo(e){switch(e){case T.NORMAL:return"source-over";case T.MULTIPLY:return"multiply";case T.SCREEN:return"screen";case T.OVERLAY:return"overlay";case T.DARKEN:return"darken";case T.LIGHTEN:return"lighten";case T.COLOR_DODGE:return"color-dodge";case T.COLOR_BURN:return"color-burn";case T.HARD_LIGHT:return"hard-light";case T.SOFT_LIGHT:return"soft-light";case T.DIFFERENCE:return"difference";case T.EXCLUSION:return"exclusion";default:return"source-over"}}function ho(e,t=2){const r=Math.pow(10,t);return Math.round(e*r)/r}class fo{layersViews;layersSharedBuffers;isReady(){return!!this.view}debug=!1;options=new at;currentZoomLevel;lastImageData;canvas;ctx;mainWorkerPort;view;bufferDescription;layers=[];setOptions(t){return this.options=t}setSharedBuffer(t){this.bufferDescription=t,this.view=new Uint8ClampedArray(t.buffer)}setLayers(t){const r=t.map(n=>{const o=n.buffer;delete n.buffer;let i;if(!n.current){const s=new Uint8ClampedArray(this.view.length);s.set(new Uint8ClampedArray(o.buffer)),i=Qe(new ImageData(s,o.dimension.x,o.dimension.y))}return{...n,canvas:i}});this.layers=r}setZoom(t,r,n=!1){let o;const i=this.options.zoomLevel;if(n?o=r:r===0?o=1:o=i*r,this.currentZoomLevel=o,this.canvas&&this.lastImageData){const s=this.getDimensionOffscreenCanvas(),a=this.getDimensionImageData(),u=y(()=>t/i*s/a/2);this.options.zoomLevel=o,this.options.position=y(()=>this.precisionNumber(this.options.position+u))}}setPosition(t){this.options.position=y(()=>this.precisionNumber(t))}getDimensionImageData(t){const r=t?this.options.zoomLevel:1;return y((this.lastImageData?.width||0)*r,(this.lastImageData?.height||0)*r)}getDimensionOffscreenCanvas(){return y(this.canvas?.width||0,this.canvas?.height||0)}precisionNumber(t){return ho(t,this.options.precision)}updateCanvas(){if(!this.view)throw new Error("View is not set.");const t=new Uint8ClampedArray(this.view.length);t.set(this.view);const r=new ImageData(t,this.bufferDescription.dimension.x,this.bufferDescription.dimension.y);Ye(this,r)}action(t,r){return this._action(self,t,r)}async _action(t,r,n){const o=await Ar(bt(r).pipe(Gn()));t.postMessage(o,n||[])}draw(t=this.lastImageData){Ye(this,t)}}const We=new fo;Pt(self,"message").pipe(E(e=>e.data),Vn()).subscribe(async({id:e,data:t})=>{try{const r=await Xe(We,t);r&&We.action({id:e,data:r})}catch(r){Ut.error("Error processing action:",r)}})})();
