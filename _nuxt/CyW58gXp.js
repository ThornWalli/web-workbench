const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CL5Hp3VC.js","./00wGeTvv.js","./CbHnZPLL.js","./BxO05Tpb.js","./D_5a1Xw6.js"])))=>i.map(i=>d[i]);
var Kn=Object.defineProperty;var sn=r=>{throw TypeError(r)};var Qn=(r,e,t)=>e in r?Kn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var p=(r,e,t)=>Qn(r,typeof e!="symbol"?e+"":e,t),rn=(r,e,t)=>e.has(r)||sn("Cannot "+t);var m=(r,e,t)=>(rn(r,e,"read from private field"),t?t.call(r):e.get(r)),_=(r,e,t)=>e.has(r)?sn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),A=(r,e,t,n)=>(rn(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);import{a as Jn,o as ei,i as _n,b as ti,d as ni,g as $,f as an}from"./BxO05Tpb.js";import{a as nt,E as T,I as k,e as y,b as j,k as ii,d as Ft,g as si,r as In,f as Sn,h as ri,S as K,j as It,l as V,m as Re,C as ai,n as oi,o as ie,s as J,p as li,q as ci,t as ui,u as Ut,v as di,c as hi,w as fi}from"./DwAjpAW9.js";import{v as An,C as pi,u as Ee,M as at}from"./CDQzZpOA.js";import{V as Ae,I as R,r as St,a8 as En,_ as ce,t as I,v as F,x as P,G as mi,Y as gi,g as C,z as E,A as oe,C as ne,F as U,L as Y,i as xi,$ as Tt,a0 as Pt,y as $t,H as At}from"./DZs2UsD3.js";import{c as bi,a as Cn}from"./C5mdboMC.js";import{W as it,a as wi,b as bt,c as wt,d as Dn,e as yi}from"./Dbq6TYXR.js";import{a as Rn,m as Et,f as ki}from"./PIkGlXJS.js";var Ln={now:function(){return(Ln.delegate||Date).now()},delegate:void 0},ea=function(r){Jn(e,r);function e(t,n,i){t===void 0&&(t=1/0),n===void 0&&(n=1/0),i===void 0&&(i=Ln);var s=r.call(this)||this;return s._bufferSize=t,s._windowTime=n,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,t),s._windowTime=Math.max(1,n),s}return e.prototype.next=function(t){var n=this,i=n.isStopped,s=n._buffer,a=n._infiniteTimeWindow,l=n._timestampProvider,o=n._windowTime;i||(s.push(t),!a&&s.push(l.now()+o)),this._trimBuffer(),r.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(t),i=this,s=i._infiniteTimeWindow,a=i._buffer,l=a.slice(),o=0;o<l.length&&!t.closed;o+=s?1:2)t.next(l[o]);return this._checkFinalizedStatuses(t),n},e.prototype._trimBuffer=function(){var t=this,n=t._bufferSize,i=t._timestampProvider,s=t._buffer,a=t._infiniteTimeWindow,l=(a?1:2)*n;if(n<1/0&&l<s.length&&s.splice(0,s.length-l),!a){for(var o=i.now(),c=0,u=1;u<s.length&&s[u]<=o;u+=2)c=u;c&&s.splice(0,c+1)}},e}(nt);function fe(r){r===void 0&&(r={});var e=r.connector,t=e===void 0?function(){return new nt}:e,n=r.resetOnError,i=n===void 0?!0:n,s=r.resetOnComplete,a=s===void 0?!0:s,l=r.resetOnRefCountZero,o=l===void 0?!0:l;return function(c){var u,d,h,f=0,x=!1,w=!1,b=function(){d==null||d.unsubscribe(),d=void 0},H=function(){b(),u=h=void 0,x=w=!1},D=function(){var M=u;H(),M==null||M.unsubscribe()};return ei(function(M,ue){f++,!w&&!x&&b();var X=h=h??t();ue.add(function(){f--,f===0&&!w&&!x&&(d=Ct(D,o))}),X.subscribe(ue),!u&&f>0&&(u=new _n({next:function(Q){return X.next(Q)},error:function(Q){w=!0,b(),d=Ct(H,i,Q),X.error(Q)},complete:function(){x=!0,b(),d=Ct(H,a),X.complete()}}),Rn(M).subscribe(u))})(c)}}function Ct(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];if(e===!0){r();return}if(e!==!1){var i=new _n({next:function(){i.unsubscribe(),r()}});return Rn(e.apply(void 0,ti([],ni(t)))).subscribe(i)}}const vi=$(0,0);class on{constructor({title:e,sidebarComponent:t,sidebarComponentData:n,component:i,componentData:s,options:a,symbolWrapper:l,wrapper:o,layout:c,parentWindow:u}){p(this,"events",new nt);p(this,"id",An());p(this,"component");p(this,"componentData");p(this,"sidebarComponent");p(this,"sidebarComponentData");p(this,"parentWindow");p(this,"options",Ae({title:"Unnamed",scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0,clampX:!0,clampY:!1,freeze:!1,focused:!1,center:!0,close:!0,overlay:!0,embed:!1,borderless:!1,hideRootHeader:!1,sidebar:!0}));p(this,"symbolWrapper",null);p(this,"group",null);p(this,"wrapper",null);p(this,"layout",Ae({focused:!1,position:$(0,0),size:vi,scrollOffset:$(0,0)}));this.options.title=e,this.parentWindow=u,t&&(this.sidebarComponent=R(t)),n&&(this.sidebarComponentData=R(n)),this.component=R(i),this.componentData={...s,window:this},l&&(this.symbolWrapper=R(l)),o&&(this.wrapper=R(o)),this.options=Object.assign(this.options,a),this.layout=Object.assign(this.layout,c)}ready(){this.options.ready=!0,this.events.next(new T("ready"))}focus(){this.options.focused=!0,this.events.next(new T("focus"))}unfocus(){this.options.focused=!1,this.events.next(new T("unfocus"))}close(e){this.wrapper&&(this.events.next(new T("close",e)),this.wrapper.remove(this.id),this.wrapper=null)}setWrapper(e){this.wrapper=R(e)}setGroup(e){this.group=e}awaitClose(){return new Promise(e=>{const t=this.events.pipe(an(({name:n})=>n==="close")).subscribe((...n)=>{t.unsubscribe(),e(...n)})})}awaitReady(){return new Promise(e=>{if(this.options.ready)e();else{const t=this.events.pipe(an(({name:n})=>n==="ready")).subscribe((...n)=>{t.unsubscribe(),e(...n)})}})}}const de={CENTER:0,ORDER_HORIZONTAL:1,ORDER_VERTICAL:2,ORDER_DIAGONAL_LEFT:3,ORDER_DIAGONAL_RIGHT:4,SPLIT_HORIZONTAL:5,SPLIT_VERTICAL:6,FULL:7};class ta{constructor(e,t=[]){p(this,"events",new nt);p(this,"id",An());p(this,"core");p(this,"layout",{size:$(0,0),position:$(0,0)});p(this,"groups",new Map);p(this,"modelMap",new Map);p(this,"models",St([]));p(this,"activeWindow",St(null));this.core=e,t.forEach(n=>this.add(n))}getActiveWindow(){return this.models.value.find(e=>e.options.focused)}setActiveWindow(e){this.models.value.forEach(t=>{t.options.focused=e===t.id,e===t.id&&(this.activeWindow.value=t,this.events.next(new T("setActiveWindow",t)))})}hasEmbbedWindow(){return!!this.models.value.find(e=>e.options.embed)}isHeaderVsible(){return!this.models.value.find(e=>e.options.embed&&e.options.hideRootHeader)}add(e,t){const{full:n,active:i,group:s}={full:!1,active:!0,group:null,...t};if(e instanceof on||(e=new on(e)),e.setWrapper(this),n&&(e.layout.size=this.layout.size),s){let a;this.groups.has(s)?(a=this.groups.get(s),a.windows.push(e)):(a={primary:e,windows:[],name:s},this.groups.set(s,a)),e.setGroup(a)}return e.layout.zIndex=this.models.value.length,this.models.value.push(e),this.events.next(new T("add",e)),this.modelMap.set(e.id,e),i&&this.setActiveWindow(e.id),e}remove(e){typeof e=="string"&&(e=this.get(e)),e.group&&(e.group.primary===e?(e.group.windows.forEach(t=>t.close()),this.groups.delete(e.group.name)):e.group.primary.focus()),this.models.value.splice(this.models.value.indexOf(e),1),this.modelMap.delete(e.id)}get(e){return this.modelMap.get(e)}clear(){this.models=St([].splice(0,this.models.value.length)),this.modelMap.clear()}setWindowUpDown(e,t){const n=this.models.value,i=Array.from(n).filter(o=>!o.options.embed).sort((o,c)=>o.layout.zIndex-c.layout.zIndex).map(En),s=this.get(e),a=i.indexOf(s),l=i[t?a-1:a+1];if(l){const o=s.layout.zIndex;s.layout.zIndex=l.layout.zIndex,l.layout.zIndex=o}}centerWindow(e){typeof e=="string"&&(e=this.get(e)),Wt(e,this.layout)}setWindowPositions(e,t=[],n){const{embed:i}={embed:!1,...n};switch(t.length<1&&t.push(...this.models.value),i||(t=t.filter(s=>!s.options.embed)),e){case de.FULL:t.forEach(s=>{_i(s,this.layout)});break;case de.CENTER:t.forEach(s=>{Wt(s,this.layout)});break;case de.ORDER_DIAGONAL_LEFT:case de.ORDER_DIAGONAL_RIGHT:Ii(t,this.layout,de.ORDER_DIAGONAL_RIGHT===e);break;case de.SPLIT_HORIZONTAL:case de.SPLIT_VERTICAL:Si(t,this.layout,de.SPLIT_VERTICAL===e);break}}saveSize(e,t){if(this.get(e).symbolWrapper&&this.get(e).symbolWrapper.fsItem){const n=this.get(e).symbolWrapper.fsItem;n.meta.set(k.WINDOW_SIZE,t),this.core.modules.files.fs.saveItem(n)}}savePosition(e,t){if(this.get(e).symbolWrapper&&this.get(e).symbolWrapper.fsItem){const n=this.get(e).symbolWrapper.fsItem;n.meta.set(k.WINDOW_POSITION,t),this.core.modules.files.fs.saveItem(n)}}}function _i(r,e){r.layout.size=e.size}function Wt(r,e){r.layout.position=$(()=>(e.size-r.layout.size)/2)}function Ii(r,e,t){const n=1/r.length;r.forEach((i,s)=>{Wt(i,e),s=-Math.floor(r.length/2)+s;const a=$(i.layout.position.x+(t?-1:1)*(n*i.layout.size.x)*s,i.layout.position.y+n*i.layout.size.y*s),l=$(()=>e.size-i.layout.size);i.layout.position=$(()=>Math.max(Math.min(a,l),0))})}function Si(r,e,t){let n;const i=r.length;t?(n=$(e.size.x,e.size.y/i),r.forEach((s,a)=>{s.layout.position=$(0,a*n.y),s.layout.size=n})):(n=$(e.size.x/i,e.size.y),r.forEach((s,a)=>{s.layout.position=$(a*n.x,0),s.layout.size=n}))}class Ai{constructor(e){p(this,"items",[]);p(this,"itemsMapping",new Map);p(this,"key");this.key=e}add(e){e.forEach(t=>{[].concat(t[this.key]).forEach(n=>{this.itemsMapping.set(n,t)})}),this.items.push(...e)}remove(e){e.forEach(t=>{this.items.splice(this.items.indexOf(t),1)})}has(e){return this.itemsMapping.has(e)}get(e){return this.itemsMapping.get(e)}}class Ei extends Ai{constructor(){super("name")}}const Ci=new Ei;var ze,Ne,ke,je;class Di{constructor({name:e,description:t,args:n,action:i}){_(this,ze);_(this,Ne);_(this,ke,[]);_(this,je);A(this,ze,[].concat(e)),A(this,Ne,t),A(this,ke,n||m(this,ke)),A(this,je,i)}action(...e){return m(this,je).call(this,...e)}get description(){return m(this,Ne)}get name(){return m(this,ze)}get args(){return m(this,ke)}}ze=new WeakMap,Ne=new WeakMap,ke=new WeakMap,je=new WeakMap;function Ri(r){return r.map(e=>new Di(e))}function na(r,e){return r.args.reduce((t,n)=>{const i=[].concat(n.name);i.length<1&&(i.push=`argument-${n.index}`);const s=bi(n.name[0]);if("index"in n&&n.index!==void 0&&Number(n.index)in e.args){const a=n.index;let l=e.args[Number(a)];l=l===void 0?!0:l,t[Number(a)]=l,t.unresolved[Number(a)]=e.unresolved.args[Number(a)],t[String(s)]=l,t.unresolved[String(s)]=e.unresolved.args[Number(a)]}return i.forEach(a=>{if(a in e.kwargs){const l=e.kwargs[String(a)];t[String(s)]=l===void 0?!0:l,t.unresolved[String(s)]=e.kwargs[String(a)]===void 0?!0:l}}),t},{unresolved:{}})}var Ue,He,Ve,Ye;class g{constructor({name:e,index:t,flag:n,description:i}){_(this,Ue);_(this,He);_(this,Ve);_(this,Ye);A(this,Ue,[].concat(e)),A(this,He,t),A(this,Ve,n),A(this,Ye,i)}get name(){return m(this,Ue)}get index(){return m(this,He)}get flag(){return m(this,Ve)}get description(){return m(this,Ye)}}Ue=new WeakMap,He=new WeakMap,Ve=new WeakMap,Ye=new WeakMap;class Li{constructor({config:e={},commands:t,contextMenu:n=null,core:i}){p(this,"commands",[]);p(this,"contextMenu",[]);p(this,"config",{});p(this,"core");this.core=i,this.config=e,this.commands=t,this.contextMenu=n}beforeSetup(){const e=this.core;e.config.setDefaults(this.config),typeof this.commands=="function"&&(this.commands=Ri(this.commands({core:e,module:this})),Ci.add(this.commands)),typeof this.contextMenu=="function"&&(this.contextMenu=new pi(this.contextMenu,{core:e,module:this}),this.core.modules.windows.contextMenu.addDefaultItems(this.contextMenu))}setup(){this.log(this.name)}destroy(){this.core.removeCommands(this.commands)}log(e){this.core.logger.add(e,{namespace:this.constructor.NAME})}get name(){return this.constructor.NAME}}var ve,pe,qe,se,kn;let Ht=(kn=class{constructor(e){_(this,ve,!1);_(this,pe);_(this,qe);_(this,se,{});e=Object.assign({locked:m(this,ve),storage:void 0,name:void 0},e),A(this,ve,e.locked),A(this,pe,e.storage),A(this,qe,e.name)}get locked(){return m(this,ve)}get name(){return m(this,qe)}get storage(){return m(this,pe)}get data(){return m(this,se)}set data(e){A(this,se,e)}mount(){return new Promise(e=>{e(this)})}unmount(){return new Promise(e=>{e(this)})}load(){if(!m(this,pe))throw new Error("no storage");return Promise.resolve(m(this,se))}save(e){if(!m(this,pe))throw new Error("no storage");return A(this,se,e||m(this,se)),Promise.resolve(m(this,se))}},ve=new WeakMap,pe=new WeakMap,qe=new WeakMap,se=new WeakMap,kn);var me;class Mn{constructor(){_(this,me,new Map)}getItem(e){return m(this,me).get(e)}setItem(e,t){m(this,me).set(e,t)}removeItem(e){m(this,me).delete(e)}clear(){m(this,me).clear()}}me=new WeakMap;class Mi extends Ht{constructor(e){e=Object.assign({storage:new Mn},e),super(e)}}class On extends Ht{mount(){return new Promise(e=>{try{let t;try{if(t=this.storage.getItem(this.name),t){if(t=JSON.parse(t),!t||!(t instanceof Object))throw new Error("json invalid")}else throw new Error("json invalid")}catch(n){console.error(n),t={}}this.storage.setItem(this.name,JSON.stringify(t)),e(this)}catch(t){throw new Error(t)}})}load(){return new Promise(e=>{if(this.storage)try{this.data=JSON.parse(this.storage.getItem(this.name)),e(this.data)}catch(t){throw new Error(t)}})}save(e){return new Promise(t=>{if(this.storage)try{this.data=e||this.data,this.storage.setItem(this.name,JSON.stringify(this.data)),t(this.data)}catch(n){throw new Error(n)}})}}class Oi extends On{constructor(e){e=Object.assign({storage:window.localStorage},e),super(e)}}class Fi extends On{constructor(e){e=Object.assign({storage:window.sessionStorage||new Mn},e),super(e)}}class Fn extends Ht{}const z={NONE:0,AUTO:1,TEMP:3,LOCAL:4,SESSION:5,CLOUD:6};function Ti(r){switch(r){case z.TEMP:return Mi;case z.LOCAL:return Oi;case z.SESSION:return Fi;case z.CLOUD:return Fn;default:return Storage}}var B,ge;const xt=class xt extends j{constructor(t){t=Object.assign({},t);super(t);_(this,B,new Map);_(this,ge,ii(1));this.addItems(t.items||m(this,B)),A(this,ge,t.maxSize||m(this,ge))}async export(...t){const n=await j.prototype.export.apply(this,...t);return delete n.data,n.items=await Promise.all(Array.from(m(this,B).values()).map(i=>i.export())),n}async addItems(t,n=!1){return t instanceof Map&&(t=Array.from(t.values())),t=t.map(i=>(typeof i.data=="string"&&(i.data=Ft(i.data)),i)),t=this.parseItems(t),Promise.all(t.map(i=>this.addItem(i,n)))}static normalizeItemData(t){const n=[];return"items"in t&&!(t.items instanceof Map)&&(t.items=new Map(t.items.map(i=>[i.id,i]))),"info"in t&&(t.meta=[t.info],delete t.info,n.push("info")),"extension"in t&&(t.id+="."+t.extension,delete t.extension,n.push("extension")),"createTime"in t&&(t.createdDate=t.createTime,delete t.createTime,n.push("createTime")),"editTime"in t&&(t.editedDate=t.editTime,delete t.editTime,n.push("editTime")),"icon"in t&&(delete t.icon,n.push("icon")),n.length&&console.warn("@deprecated TODO: muss weg, hier werden die alten Items angepasst.",t,n),t}parseItems(t){return t.map(n=>{n=xt.normalizeItemData(n);let i;return n.type?i=Dt(n.type):n.items?i=Dt("Directory"):i=Dt(),new i(n)})}async addItem(t,n=!1){const i=t.parent;if(!n&&this.hasItem(t.id))throw new Error(`File ${t.id} exists`);if(i&&await i.removeItem(t),n){const s=si(t.id),a=In(t.id);t.setId(Sn(ri(a,this,s),s))}return m(this,B).set(t.id,t),t.setParent(this),t.events.next(new T("move",{item:t,lastParent:i})),this.events.next(new T("addItem",t)),t}removeItem(t){return t.setParent(null),m(this,B).delete(t.id),this.events.next(new T("removeItem",t)),Promise.resolve()}async remove(t){const{recursive:n}=Object.assign({recursive:!1},t);if(n){let i=await this.getItems();return i=await Promise.all(Array.from(i.values()).map(s=>s.remove(t))),i=i.reduce((s,a)=>s.concat(a),[]),i.push(await j.prototype.remove.apply(this,[t])),i}else{if((await this.getItems()).size>0)throw new Error(y.get("FileSystemItem_itemContainerNotEmpty",await this.getPath()));return[await j.prototype.remove.apply(this,arguments)]}}changeItemId(t,n,i){m(this,B).delete(n),m(this,B).set(i,t),this.parent&&console.log("changeItemId by parent",n,i,this.parent.items)}getItems(){return Promise.resolve(m(this,B))}getItem(t){return m(this,B).get(t)}hasItem(t){return m(this,B).has(t)}get items(){return m(this,B)}get size(){return Array.from(m(this,B).values()).reduce(function(t,n){return n instanceof xt||(t+=n.size),t},0)}get maxSize(){return t(this);function t(n){return n.parent&&m(n,ge)?t(n.parent):m(n,ge)}}};B=new WeakMap,ge=new WeakMap;let L=xt;y.add([["FileSystemItem_itemContainerNotEmpty",["ItemWrapp Not Empty","ItemContainer not empty… %1"]]]);class Vt extends L{constructor(e){e=Object.assign({},e,{locked:!0,id:"ROOT"}),super(e)}}p(Vt,"NAME","Root");var Ot,re;let le=(Ot=class extends L{constructor(t){t=Object.assign({storage:null},t,{locked:!0});super(t);_(this,re);A(this,re,t.storage)}get storage(){return m(this,re)}get locked(){return m(this,re).locked}mount(...t){return m(this,re).mount(...t)}unmount(...t){return m(this,re).unmount(...t)}async save(){return m(this,re).save(await this.export())}},re=new WeakMap,p(Ot,"NAME","Storage"),Ot);class ct extends le{constructor(...e){super(...e),this.meta.set(k.VISIBLE,!1)}}p(ct,"NAME","TmpDisk"),p(ct,"SYMBOL",K.TMP_DISK);class ut extends le{}p(ut,"NAME","RamDisk"),p(ut,"SYMBOL",K.RAM_DISK);class Yt extends L{}p(Yt,"NAME","FloppyDisk");class dt extends le{}p(dt,"NAME","HardDisk"),p(dt,"SYMBOL",K.HARD_DISK);class ht extends le{isLogged(){return this.storage.storage.isLogged()}}p(ht,"NAME","CloudDisk"),p(ht,"SYMBOL",K.CLOUD_DISK);class xe extends L{constructor(...e){super(...e),[k.WINDOW_SCALE,k.WINDOW_SCROLL_X,k.WINDOW_SCROLL_Y].forEach(t=>{this.meta.has(t,!0)||this.meta.set(t,!0)})}}p(xe,"NAME","Directory"),p(xe,"SYMBOL",K.DIRECTORY);class q extends L{}p(q,"NAME","Trashcan"),p(q,"SYMBOL",K.TRASHCAN);class yt extends j{}p(yt,"NAME","File");var _e;class qt extends j{constructor(t){t=Object.assign({refPath:null},t);super(t);_(this,_e);A(this,_e,t.refPath)}get refPath(){return m(this,_e)}set refPath(t){A(this,_e,t)}}_e=new WeakMap,p(qt,"NAME","Link");var Ze,te,N,Ge,Ie;const O=class O{constructor(e){_(this,Ze);_(this,te);_(this,N);_(this,Ge,new Map);_(this,Ie,new nt);A(this,Ze,e),this.setup()}get root(){return m(this,te)}setup(){A(this,te,new Vt),A(this,N,m(this,te));const e=[this.addStorage(O.RAM_DISK_TITLE,z.SESSION,{id:O.RAM_DISK_NAME}),this.addStorage(O.HARD_DISK_NAME,z.LOCAL,{trashcan:!0}),this.addStorage(O.TMP_DISK_TITLE,z.TEMP,{id:O.TMP_DISK_NAME,trashcan:!1})];return Promise.all(e).catch(t=>{throw t})}createTmpFile(e,t,n,i){return this.createRootFile(`TMP:${e}`,t,n,i)}createRootDir(e,t,n){const i=`${e}`;return this.makedir(i,t,Object.assign({},n,{override:!0}))}createRootFile(e,t,n,i){typeof t=="object"&&(n=t,t=null);const s=`${e}`;return this.makefile(s,t,n,Object.assign({},i,{override:!0}))}async get(e,t){if(e instanceof j)return e;if(It(e))try{return await this.parsePath(e)}catch(n){if(t)return new j({name:V(e)});throw n}else throw y.get("FileSystem_pathInvalid",V(e),Re(e))}async parsePath(e){let t=e,n=m(this,N);const i=e.match(/^([^:\\/]+):(.*)$/);if(i?(n=m(this,te).getItem(i[1]),t=i[2]):t[0]==="/"?(t=t.slice(1),n=m(this,N).getStorageItem()):t==="ROOT"&&(n=m(this,te),t=""),t&&t.length>0&&(n=zt(t.split("/"),n)),n)return n;throw y.get("FileSystem_pathInvalid",e,await m(this,N).getBase())}async addFloppyDisk(e){typeof e=="function"&&(e=e());const t=await e;return this.addStorage(t)}async removeFloppyDisk(e){await e.remove(!0)}async addStorage(e,t=z.NONE,n){n=Object.assign({id:null},n);let i;typeof t=="function"&&(i=t,t=z.CLOUD);const s={id:this.getFreeSlot(O.PREFIX.FLOPPY_DISK),itemClass:Yt};let a={};if(typeof e=="object"){const l=e;s.name=l.name,s.items=l.items,s.meta=Array.from(new Map([[k.SYMBOL,K.DISK_1]].concat(l.meta||[])))}else{switch(t){case z.SESSION:s.id=O.PREFIX.RAM,s.itemClass=ut;break;case z.TEMP:s.id=O.PREFIX.TMP,s.itemClass=ct;break;case z.LOCAL:s.id=this.getFreeSlot(O.PREFIX.HARD_DISK),s.itemClass=dt;break;case z.CLOUD:s.id=this.getFreeSlot(O.PREFIX.CLOUD_DISK),s.itemClass=ht;break}s.id=n.id||s.id,i=await this.registerStorage(s.id,i||t).mount(n);const l=await i.load();a=L.normalizeItemData(l),s.storage=i,z.NONE!==t&&(s.name=a.name||e)}return(s.meta=s.meta||[]).push(...a.meta||[]),this.addDisk(Object.assign(a,s),n)}removeStorage(e){return e.unmount().then(()=>(m(this,Ie).next(new T("removeStorage",{itemStorage:e})),e))}registerStorage(e,t){let n;typeof t=="function"?n=t:n=Ti(t);const i=`${m(this,Ze)}_${e}`,s=new n({id:e,name:i});return m(this,Ge).set(i,s),s}connect(e,t){return this.addStorage(ai,e,t).then(n=>n).catch(n=>{throw n})}async disconnect(e){return e=await this.removeStorage(e),e.remove({silent:!0,recursive:!0}),e}addDisk({id:e,name:t,meta:n,items:i,itemClass:s,storage:a},l){l=Object.assign({trashcan:!1},l),l.trashcan&&(!i||i&&!i.has(q.NAME))&&(i=i||new Map,i.set(q.NAME,{type:q.NAME,id:q.NAME,name:q.NAME}));const o=s;if(!o)throw new Error("ItemClass is empty!");const c=new o({id:e,name:t,meta:n,items:i,storage:a});return m(this,te).addItem(c),m(this,Ie).next(new T("addDisk",{id:e,item:c})),c}get currentItem(){return m(this,N)}get events(){return m(this,Ie)}get storages(){return m(this,Ge)}getFreeSlot(e){let t=0;for(;m(this,te).hasItem(`${e}${t}`);)t++;return`${e}${t}`}async exist(e){try{return!!await this.get(e)}catch(t){return console.error(t),!1}}async changeDirectory(e){const t=await this.get(e);return A(this,N,t),this.events.next(new T("changeDirectory",t)),t}async makedir(e,t,n){const{ignore:i,meta:s}=Object.assign({ignore:!1,override:!1,meta:[]},n);let a;e&&oi(e)&&e!==t?a=await this.get(Re(e)):a=m(this,N);const l=new xe({id:V(e),name:t||"",createdDate:Date.now(),meta:s});if(await ie(a),i||!a.getItem(l.id))a.addItem(l,i),this.events.next(new T("writeItem",l));else throw y.get("FileSystem_fileExist",l.id);return await J(a),l}async makefile(e,t,n,i){const{override:s,meta:a}=Object.assign({override:!1,meta:[]},i),l=new yt({id:V(e),name:t,data:n,meta:a,createdDate:Date.now()});if(!It(e))throw y.get("FileSystem_invalidPath",e);let o=li(e);const c=ci(e);o===c&&(o=".");let u;if(ui(o)?u=await this.get(o):m(this,N).id!=="ROOT"?u=await this.get(Ut(await m(this,N).getPath(),o)):u=await this.get(o),u.hasItem(c))if(s)await u.getItem(c).remove(),u.addItem(l);else throw y.get("FileSystem_fileExist",l.id);else u.addItem(l),this.events.next(new T("writeItem",l));return await J(u),l}async editfile(e,t){const n=await this.get(e).then(ie);return await ie(n),n.data=t,J(n)}async editfileMeta(e,t,n){const i=await this.get(e);return Array.isArray(t)?t.map(s=>({name:s[0],value:s[1]})):i.meta.set(t,n),J(i)}async saveItem(e){const t=await this.get(e);return J(t)}async makelink(e,t=null){const n=await this.get(e);await ie(n);const i=m(this,N),s=new qt({id:In(n.id)+".ref",name:`${t||n.name}`,refPath:await n.getPath(),createdDate:Date.now()});return await i.addItem(s),await J(n),s}async editlink(e,t){const n=await this.get(e);await ie(n);const i=await this.get(t);return n.refPath=await i.getPath(),J(n)}async rename(e,t,{name:n=!1,removeName:i=!1}){let s;if(e instanceof j)s=e;else if(It(e)||typeof e=="string")s=await this.get(e);else throw y.get("FileSystem_pathInvalid",Re(e),e);return await ie(s),i&&(n=!0,t=null),await s.rename(t,{ignore:!0,name:n}),J(s)}async copy(e,t,n){const{ignore:i}=Object.assign({ignore:!1},n);let s,a,l;if(e instanceof j?(a=e,s=e.id):(a=await this.get(e),s=V(e)),t instanceof j)t instanceof L||(t=t.parent),l=t;else{s=V(t);const c=await this.get(t,!0);if(c instanceof L?s=V(e):c.parent?l=c.parent:l=await this.get(Re(t)),!(l instanceof L))throw new TypeError("no ItemContainer")}await ie(a);const o=await a.copy();if(i||!l.getItem(s))o.rename(s),l.addItem(o,i),this.events.next(new T("copyItem",o));else throw y.get("FileSystem_fileExist",s);return J(o)}async move(e,t,{override:n=!1}){let i,s,a;if(e instanceof j)s=e,i=e.id;else{if(s=await this.get(e),s instanceof le)throw y.get("FileSystem_cantMoveStorage",s.displayName);i=V(e)}if(t instanceof j)t instanceof L||(t=t.parent),a=t;else{if(i=V(t),a=await this.get(t),a instanceof L)i=V(e);else return this.get(Re(t));if(!(a instanceof L))throw new TypeError("no ItemContainer")}let l;if(await ie(s),n||!await a.getItem(i))l=s.getStorageItem(),await s.rename(i),await a.addItem(s,n),this.events.next(new T("moveItem",s));else throw y.get("FileSystem_fileExist",s.id,i);return await J(s),l?l.save().then(()=>s):s}async remove(e,t,n){const{ignore:i}=Object.assign({ignore:!1},n),s=await this.get(e);await ie(s);try{const a=await di(t,s);return a[a.length-1].storage&&await a[a.length-1].storage.save(),a}catch(a){if(!i)throw new Error(a)}}};Ze=new WeakMap,te=new WeakMap,N=new WeakMap,Ge=new WeakMap,Ie=new WeakMap,p(O,"PREFIX",{FLOPPY_DISK:"DF",TMP:"TMP",RAM:"RAM",HARD_DISK:"HD",CLOUD_DISK:"CD"}),p(O,"TMP_DISK_NAME","TMP"),p(O,"TMP_DISK_TITLE","TMP DISK"),p(O,"RAM_DISK_NAME","RAM"),p(O,"RAM_DISK_TITLE","RAM DISK"),p(O,"HARD_DISK_NAME","HARD DISK");let Bt=O;function zt(r,e){const t=r.shift();if(t===void 0)return e;if(t===".."){if(e.parent)return e.parent}else if(t==="."||t==="")return zt(r,e);if(e){const n=e.getItem(t);return r.length>0&&n instanceof L?zt(r,n):n}}const Pi=[xe,q,le,ct,ut,dt,Yt,ht,qt,yt].reduce((r,e)=>(r[e.NAME]=e,r),{});function Dt(r){return Pi[String(r)]||yt}y.add([["FileSystem_invalidPath",["Invalid File",'Invalid path "%1"']],["FileSystem_invalidFile",["Invalid File",'Invalid file… "%1"']],["FileSystem_fileExist",["File Ready",'File already exists… "%1"']],["FileSystem_pathInvalid",["Path Invalid",'Path invalid… "%1"; base: "%2"']],["FileSystem_itemInvalid",["Item Invalid",'Item id invalid… "%1" from "%2"']],["FileSystem_cantMoveStorage",["Can't Move",`Can't move Storage "%1"`]],["FileSystem_permissionsNeeded",["Permissions needed","Permissions needed"]]]);var ra=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $i(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Wi=({onlyFirst:r=!1}={})=>{const e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,r?void 0:"g")};const Bi=Wi;var zi=r=>typeof r=="string"?r.replace(Bi(),""):r,Zt={exports:{}},Tn={exports:{}};(function(r){var e=function(){function t(o,c,u,d){typeof c=="object"&&(u=c.depth,d=c.prototype,c.filter,c=c.circular);var h=[],f=[],x=typeof Buffer<"u";typeof c>"u"&&(c=!0),typeof u>"u"&&(u=1/0);function w(b,H){if(b===null)return null;if(H==0)return b;var D,M;if(typeof b!="object")return b;if(t.__isArray(b))D=[];else if(t.__isRegExp(b))D=new RegExp(b.source,l(b)),b.lastIndex&&(D.lastIndex=b.lastIndex);else if(t.__isDate(b))D=new Date(b.getTime());else{if(x&&Buffer.isBuffer(b))return Buffer.allocUnsafe?D=Buffer.allocUnsafe(b.length):D=new Buffer(b.length),b.copy(D),D;typeof d>"u"?(M=Object.getPrototypeOf(b),D=Object.create(M)):(D=Object.create(d),M=d)}if(c){var ue=h.indexOf(b);if(ue!=-1)return f[ue];h.push(b),f.push(D)}for(var X in b){var Q;M&&(Q=Object.getOwnPropertyDescriptor(M,X)),!(Q&&Q.set==null)&&(D[X]=w(b[X],H-1))}return D}return w(o,u)}t.clonePrototype=function(c){if(c===null)return null;var u=function(){};return u.prototype=c,new u};function n(o){return Object.prototype.toString.call(o)}t.__objToStr=n;function i(o){return typeof o=="object"&&n(o)==="[object Date]"}t.__isDate=i;function s(o){return typeof o=="object"&&n(o)==="[object Array]"}t.__isArray=s;function a(o){return typeof o=="object"&&n(o)==="[object RegExp]"}t.__isRegExp=a;function l(o){var c="";return o.global&&(c+="g"),o.ignoreCase&&(c+="i"),o.multiline&&(c+="m"),c}return t.__getRegExpFlags=l,t}();r.exports&&(r.exports=e)})(Tn);var Ni=Tn.exports,ji=Ni,Ui=function(r,e){return r=r||{},Object.keys(e).forEach(function(t){typeof r[t]>"u"&&(r[t]=ji(e[t]))}),r},Hi=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],Vi=Ui,Le=Hi,Pn={nul:0,control:0};Zt.exports=function(e){return $n(e,Pn)};Zt.exports.config=function(r){return r=Vi(r||{},Pn),function(t){return $n(t,r)}};function $n(r,e){if(typeof r!="string")return ln(r,e);for(var t=0,n=0;n<r.length;n++){var i=ln(r.charCodeAt(n),e);if(i<0)return-1;t+=i}return t}function ln(r,e){return r===0?e.nul:r<32||r>=127&&r<160?e.control:Yi(r)?0:1+(r>=4352&&(r<=4447||r==9001||r==9002||r>=11904&&r<=42191&&r!=12351||r>=44032&&r<=55203||r>=63744&&r<=64255||r>=65040&&r<=65049||r>=65072&&r<=65135||r>=65280&&r<=65376||r>=65504&&r<=65510||r>=131072&&r<=196605||r>=196608&&r<=262141))}function Yi(r){var e=0,t=Le.length-1,n;if(r<Le[0][0]||r>Le[t][1])return!1;for(;t>=e;)if(n=Math.floor((e+t)/2),r>Le[n][1])e=n+1;else if(r<Le[n][0])t=n-1;else return!0;return!1}var qi=Zt.exports,Zi=zi,Gi=qi,Wn=function(r){return Gi(Zi(r))},we={},ae=Wn;function ft(r,e){return Array.apply(null,{length:e+1}).join(r).slice(0,e)}function Xi(r,e,t){r=r??"",r=String(r);var n=e-ae(r);return n<=0?r:r+ft(t||" ",n)}function Ki(r,e,t){r=r??"",r=String(r);var n=e-ae(r);if(n<=0)return r;var i=Math.floor(n/2),s=n-i;return ft(t||" ",i)+r+ft(t||" ",s)}function Qi(r,e,t){r=r??"",r=String(r);var n=e-ae(r);return n<=0?r:ft(t||" ",n)+r}function Ji(r,e){function t(n,i){return n.trim().split(" ").reduce(function(s,a){var l=s[s.length-1];return l&&ae(l.join(" "))+ae(a)<i?s[s.length-1].push(a):s.push([a]),s},[]).map(function(s){return s.join(" ")})}return r.split(`
`).map(function(n){return t(n,e)}).reduce(function(n,i){return n.concat(i)},[])}function es(r,e,t){r=r.trim();for(var n=[],i=r.split(" "),s="",a=ae(t);s||i.length;){if(s){var l=s;s=""}else var l=i.shift();if(ae(l)>e){for(var o=0,c=0,u=e-a;o<l.length;){var d=ae(l.charAt(o));if(d+c>u)break;c+=d,++o}s=l.slice(o),l=l.slice(0,o),l+=t}n.push(l)}return n.join(" ")}function ts(r,e){if(r=r??"",r=String(r),e==1/0)return r;for(var t=0,n=0;t<r.length;){var i=ae(r.charAt(t));if(i+n>e)break;n+=i,++t}return r.slice(0,t)}we.padRight=Xi;we.padCenter=Ki;we.padLeft=Qi;we.splitIntoLines=Ji;we.splitLongWords=es;we.truncateString=ts;var Rt=Wn,Ce=we,ns=Ce.padRight,is=Ce.padCenter,ss=Ce.padLeft,cn=Ce.splitIntoLines,rs=Ce.splitLongWords,as=Ce.truncateString,Bn=function(e){return e.toUpperCase()},os=function(e,t,n){return e},ls=Object.freeze({maxWidth:1/0,minWidth:0,columnSplitter:" ",truncate:!1,truncateMarker:"…",preserveNewLines:!1,paddingChr:" ",showHeaders:!0,headingTransform:Bn,dataTransform:os}),cs=function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.config||{};delete e.config;var n=e.maxLineWidth||1/0;n==="auto"&&(n=process.stdout.columns||1/0),delete e.maxLineWidth,e=un({},ls,e),e.config=e.config||Object.create(null),e.spacing=e.spacing||`
`,e.preserveNewLines=!!e.preserveNewLines,e.showHeaders=!!e.showHeaders,e.columns=e.columns||e.include;var i=e.columns||[];r=fs(r,i),i.length||r.forEach(function(o){for(var c in o)i.indexOf(c)===-1&&i.push(c)});var s=i.reduce(function(o,c){var u=Object.create(e);return o[c]=un(u,t[c]),o},Object.create(null));i.forEach(function(o){var c=s[o];c.name=o,c.maxWidth=Math.ceil(c.maxWidth),c.minWidth=Math.ceil(c.minWidth),c.truncate=!!c.truncate,c.align=c.align||"left"}),r=r.map(function(o){var c=Object.create(null);return i.forEach(function(u){c[u]=o[u]!=null?o[u]:"",c[u]=""+c[u],s[u].preserveNewLines?c[u]=c[u].replace(/[^\S\n]/gmi," "):c[u]=c[u].replace(/\s/gmi," ")}),c}),i.forEach(function(o){var c=s[o];r=r.map(function(u,d){var h=Object.create(c);u[o]=c.dataTransform(u[o],h,d);var f=Object.keys(h);if(f.indexOf("name")!==-1){if(c.headingTransform!==Bn)return;c.headingTransform=function(x){return x}}return f.forEach(function(x){return c[x]=h[x]}),u})});var a={};e.showHeaders&&(i.forEach(function(o){var c=s[o];if(!c.showHeaders){a[o]="";return}a[o]=c.headingTransform(c.name)}),r.unshift(a)),i.forEach(function(o){var c=s[o];c.width=r.map(function(u){return u[o]}).reduce(function(u,d){return u>=c.maxWidth?u:Math.max(u,Math.min(c.maxWidth,Math.max(c.minWidth,Rt(d))))},0)}),i.forEach(function(o){var c=s[o];r=r.map(function(u){return u[o]=rs(u[o],c.width,c.truncateMarker),u})}),i.forEach(function(o){var c=s[o];r=r.map(function(u,d){var h=u[o];if(u[o]=cn(h,c.width),c.truncate&&u[o].length>1){u[o]=cn(h,c.width-Rt(c.truncateMarker));var f=u[o][0];hs(f,c.truncateMarker)||(u[o][0]+=c.truncateMarker),u[o]=u[o].slice(0,1)}return u})}),i.forEach(function(o){var c=s[o];c.width=r.map(function(u){return u[o].reduce(function(d,h){return d>=c.maxWidth?d:Math.max(d,Math.min(c.maxWidth,Math.max(c.minWidth,Rt(h))))},0)}).reduce(function(u,d){return u>=c.maxWidth?u:Math.max(u,Math.min(c.maxWidth,Math.max(c.minWidth,d)))},0)});var l=us(r,s,i,e.paddingChr);return l.reduce(function(o,c){return o.concat(c.reduce(function(u,d){return u.concat(d.join(e.columnSplitter))},[]))},[]).map(function(o){return as(o,n)}).join(e.spacing)};function us(r,e,t,n){return r.map(function(i){var s=[],a=0;t.forEach(function(c){a=Math.max(a,i[c].length)});for(var l=function(u){s[u]=s[u]||[],t.forEach(function(d){var h=e[d],f=i[d][u]||"";h.align==="right"?s[u].push(ss(f,h.width,n)):h.align==="center"||h.align==="centre"?s[u].push(is(f,h.width,n)):s[u].push(ns(f,h.width,n))})},o=0;o<a;o++)l(o);return s})}function un(){return Object.assign?Object.assign.apply(Object,arguments):ds.apply(void 0,arguments)}function ds(r,e){if(r==null)throw new TypeError("Cannot convert first argument to object");for(var t=Object(r),n=!1,i,s=1;s<arguments.length;s++){var a=arguments[s];if(a!=null){for(var l=Object.keys(Object(a)),o=0,c=l.length;o<c;o++){var u=l[o];try{var d=Object.getOwnPropertyDescriptor(a,u);d!==void 0&&d.enumerable&&(t[u]=a[u])}catch(h){n||(n=!0,i=h)}}if(n)throw i}}return t}function hs(r,e,t){t=t||r.length,t=t-e.length;var n=r.lastIndexOf(e);return n!==-1&&n===t}function fs(r,e){if(Array.isArray(r))return r;var t=[];for(var n in r){var i={};i[e[0]||"key"]=n,i[e[1]||"value"]=r[n],t.push(i)}return t}const ps=$i(cs);var Xe,Ke,Qe,Se;class lt{constructor(e){_(this,Xe,0);_(this,Ke,!0);_(this,Qe,[]);_(this,Se,[]);const{showHeader:t,headerPadding:n,columns:i}=Object.assign({showHeader:!0,headerPadding:0,columns:[]},e);A(this,Ke,t),A(this,Xe,n),this.addColumn(i)}addColumn(e){Array.isArray(e)?m(this,Se).push(...[].concat(e)):m(this,Se).push(Object.assign({value:null,align:"left",minWidth:0,maxWidth:0,spacerChar:" "},e))}addRow(e){m(this,Qe).push(...[].concat(e))}static createSpacer(e,t,n){if(e.length<t){t=t-e.length;for(let i=0;i<t;i++)e+=n}return e}get columns(){return m(this,Se)}get rows(){return m(this,Qe)}get showHeader(){return m(this,Ke)}get headerPadding(){return m(this,Xe)}toColumnify(){const e=this.columns.map(i=>i.value),t=this.rows.reduce((i,s,a)=>(a<1&&this.showHeader&&this.headerPadding&&i.push(...Array(this.headerPadding).fill("")),i.push(this.columns.reduce((l,o,c)=>(l[o.value]=s[Number(c)],l),{})),i),[]),n=this.columns.reduce((i,s)=>(i[s.value]={},s.align&&(i[s.value].align=s.align),s.minWidth&&(i[s.value].minWidth=s.minWidth),s.maxWidth&&(i[s.value].maxWidth=s.maxWidth),i[s.value].headingTransform=a=>a,i),{});return ps(t,{showHeaders:this.showHeader,preserveNewLines:!0,config:n,columns:e}).replace(/\xC2/g," ")}}Xe=new WeakMap,Ke=new WeakMap,Qe=new WeakMap,Se=new WeakMap;function aa(r){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","\n":`&nbsp;
`," ":"&nbsp;"};return r.replace(/[&<>"'\n ]/g,function(t){return e[String(t)]})}function ms(r,e,t,n=" "){if(r.length<e)for(let i=r.length;i<=e-1;i++)t?r=n+r:r=r+n;return r}function $e(r){return r>2e3?(r=parseInt(r/1e3),r>1e3?(r=parseInt(r/1e3),r>1e3?(r=parseInt(r/1e3),`${r}g`):`${r}m`):`${r}k`):`${r}b`}function Nt(r,e){const t=new Date(e),n=[[/y/g,`${t.getFullYear()}`.slice(2)],[/Y/g,t.getFullYear()],[/dd/g,dn(t.getDate())],[/d/g,t.getDate()],[/DD/g,dn(t.getDate())],[/D/g,Me(t.getDate())],[/mm/g,hn(t.getMonth(),!0)],[/m/g,t.getMonth()+1],[/MM/g,hn(t.getMonth()+1,!1)],[/M/g,Me(t.getMonth()+1)],[/h/g,t.getHours()],[/H/g,Me(t.getHours())],[/i/g,t.getMinutes()],[/I/g,Me(t.getMinutes())],[/s/g,t.getSeconds()],[/S/g,Me(t.getSeconds())]];return n.forEach((i,s)=>{r=r.replace(i[0],`%${s}%`)}),n.forEach((i,s)=>{r=r.replace(`%${s}%`,i[1])}),r}const gs=[["Sunday","Sun"],["Monday","Mon"],["Tuesday","Tue"],["Wednesday","Wed"],["Thursday","Thu"],["Friday","Fri"],["Saturday","Sat"]];function dn(r){return gs[String(r)]}const xs=[["Januar","Jan"],["February","Feb"],["March","Mar"],["April","Apr"],["May"],["June"],["July"],["August","Aug"],["September","Sept"],["October","Oct"],["November","Nov"],["December","Dec"]];function hn(r,e){return r=xs[r-1],r.length>1?e?r[1]:r[0]:r}function Me(r){return r=String(r),r.length<2?`0${r}`:r}function oa(r,e){return e<=0?"":e>String(r).length?r:String(r).substring(0,e)}function la(r,e){if(e<=0)return"";if(e>String(r).length)return r;{const t=String(r).length;return String(r).substring(t,t-e)}}function ca(r,e=" "){return Array(parseInt(r)).fill(e).join("")}const bs={props:{full:{type:Boolean,required:!1,default:!1},align:{type:String,required:!1,validate:r=>["center","left","right","outer"].includes(r),default:"left"},direction:{type:String,required:!1,validate:r=>["horizontal","vertical"].includes(r),default:"horizontal"}},computed:{styleClasses(){return{[`direction-${this.direction}`]:!0,[`align-${this.align}`]:!0,full:this.full}}}};function ws(r,e,t,n,i,s){return I(),F("div",{class:gi(["wb-env-molecule-button-wrapper",s.styleClasses])},[P("div",null,[mi(r.$slots,"default",{},void 0,!0)])],2)}const st=ce(bs,[["render",ws],["__scopeId","data-v-13c4bed6"]]),ys={components:{WbButton:it,WbButtonWrapper:st,WbItemSelect:wi},props:{fileSystem:{type:Object,default(){return null}},fsItem:{type:Object,default(){return null}},name:{type:String,default(){return"fsItem"}},model:{type:Object,default(){return{fsItem:null}}},backLabel:{type:String,default(){return"../"}},upLabel:{type:String,default(){return"Up"}},downLabel:{type:String,default(){return"Down"}},maxVisibleItems:{type:Number,default(){return 5}}},emits:["select","refresh"],data(){return{currentFsItem:this.fsItem||R(this.fileSystem.root),fsItems:[],currentIndex:0}},computed:{disableds(){return{back:!this.currentFsItem.parent,up:this.currentIndex-1<0,down:this.currentIndex+1>this.fsItems.length-this.maxVisibleItems}},currentPath(){return this.model[this.name]},items(){const r=this.fsItems.slice(this.currentIndex,this.currentIndex+this.maxVisibleItems).map(e=>({label:e.id,value:e.getPath()})).concat(Array(Math.max(this.maxVisibleItems-this.fsItems.length,0)).fill({label:"&nbsp;",disabled:!0}));return this.fsItems.length<1&&(r[Math.floor(r.length/2)]={label:"Empty",disabled:!0}),r}},watch:{async currentPath(){this.currentFsItem=R(await this.fileSystem.get(this.model[this.name])),this.currentFsItem instanceof L&&(this.fsItems=Array.from((await this.currentFsItem.getItems()).values()).map(R),this.currentIndex=0),this.$emit("select",this.currentFsItem)}},async mounted(){this.fsItems=Array.from((await this.currentFsItem.getItems()).values()).map(R),this.$nextTick(()=>{this.$emit("refresh",{reset:!0,resize:!1,scroll:!1})})},methods:{onClicBack(){this.currentFsItem instanceof L?this.model[this.name]=this.currentFsItem.parent.getPath():this.model[this.name]=this.currentFsItem.parent.parent.getPath()},onClickUp(){this.currentIndex=Math.max(this.currentIndex-1,0)},onClickDown(){this.currentIndex=Math.min(this.currentIndex+1,this.fsItems.length-this.maxVisibleItems)}}},ks={class:"wb-module-files-atoms-file-select"};function vs(r,e,t,n,i,s){const a=C("wb-item-select"),l=C("wb-button"),o=C("wb-button-wrapper");return I(),F("div",ks,[P("div",null,[E(a,{title:null,items:s.items,name:t.name,model:t.model},null,8,["items","name","model"])]),P("div",null,[E(o,{align:"outer",full:"",direction:"vertical"},{default:oe(()=>[E(l,{"style-type":"secondary",label:t.backLabel,disabled:s.disableds.back,onClick:s.onClicBack},null,8,["label","disabled","onClick"]),E(l,{"style-type":"secondary",label:t.upLabel,disabled:s.disableds.up,onClick:s.onClickUp},null,8,["label","disabled","onClick"]),t.downLabel?(I(),ne(l,{key:0,"style-type":"secondary",label:t.downLabel,disabled:s.disableds.down,onClick:s.onClickDown},null,8,["label","disabled","onClick"])):U("",!0)]),_:1})])])}const zn=ce(ys,[["render",vs],["__scopeId","data-v-456ecefa"]]),_s={components:{WbForm:bt,WbButton:it,WbButtonWrapper:st,WbFormFieldTextbox:wt,WbFileSelect:zn},props:{fsItem:{type:Object,default(){return null}},id:{type:String,default(){return null}},model:{type:Object,default(){return Ae({path:null,filename:null,file:null})}}},emits:["close"],setup(){return Ee()},data(){return{currentModel:{...this.model},filesModule:R(this.core.modules.files),cancelLabel:"Cancel",saveLabel:"Save",fields:{path:{label:null,placeholder:"Path…"},filename:{label:null,placeholder:"Filename…"}},currentFsItem:this.fsItem||R(this.core.modules.files.fs.root)}},computed:{fileSelectFsItem(){return this.fsItem||R(this.core.modules.files.fs.root)},isLocked(){return this.currentFsItem?this.currentFsItem.locked:!1},saveDisabled(){return!this.currentModel.filename}},mounted(){this.id&&(this.currentModel.filename=this.id)},methods:{onSelect(r){this.currentFsItem=r,r instanceof L?this.currentModel.path=r.getPath():(this.currentModel.path=r.getBase(),this.currentModel.filename=r.id)},onClickCancel(){this.$emit("close")},onSubmit(){const r=Ut(this.currentModel.path,this.currentModel.filename);this.$emit("close",r)}}},Is={class:"wb-module-files-save"};function Ss(r,e,t,n,i,s){const a=C("wb-form-field-textbox"),l=C("wb-file-select"),o=C("wb-button"),c=C("wb-button-wrapper"),u=C("wb-form");return I(),F("div",Is,[E(u,{onSubmit:s.onSubmit},{default:oe(()=>[E(a,Y(i.fields.path,{modelValue:i.currentModel.path,"onUpdate:modelValue":e[0]||(e[0]=d=>i.currentModel.path=d),readonly:""}),null,16,["modelValue"]),E(l,{"file-system":i.filesModule.fileSystem,"fs-item":s.fileSelectFsItem,model:t.model,name:"file",onSelect:s.onSelect},null,8,["file-system","fs-item","model","onSelect"]),E(a,Y(i.fields.filename,{modelValue:i.currentModel.filename,"onUpdate:modelValue":e[1]||(e[1]=d=>i.currentModel.filename=d)}),null,16,["modelValue"]),E(c,{align:"outer",full:""},{default:oe(()=>[i.cancelLabel?(I(),ne(o,{key:0,"style-type":"secondary",label:i.cancelLabel,onClick:s.onClickCancel},null,8,["label","onClick"])):U("",!0),i.saveLabel?(I(),ne(o,{key:1,"style-type":"primary",label:i.saveLabel,type:"submit",disabled:s.isLocked||s.saveDisabled},null,8,["label","disabled"])):U("",!0)]),_:1})]),_:1},8,["onSubmit"])])}const As=ce(_s,[["render",Ss],["__scopeId","data-v-370a57da"]]),Es={components:{WbForm:bt,WbButton:it,WbButtonWrapper:st,WbFormFieldTextbox:wt,WbFileSelect:zn},props:{fsItem:{type:Object,default(){return null}},model:{type:Object,default(){return Ae({path:null})}}},emits:["close"],setup(){return Ee()},data(){return{currentModel:{...this.model,path:this.model.path||this.fsItem.getPath()},filesModule:R(this.core.modules.files),cancelLabel:"Cancel",openLabel:"Open",fields:{path:{label:null,placeholder:"Path…"},fileSelect:{name:"path"},filename:{name:"filename",label:null,placeholder:"Filename…"}},currentFsItem:this.fsItem||R(this.core.modules.files.fs.root)}},computed:{isItemContainer(){return this.currentFsItem instanceof L},fileSelectFsItem(){return this.fsItem||R(this.core.modules.files.fs.root)}},methods:{onSelect(r){this.currentFsItem=R(r),r instanceof L&&(this.currentModel.path=r.getPath())},onClickCancel(){this.$emit("close")},onSubmit(){this.$emit("close",this.currentModel.path)}}},Cs={class:"wb-module-files-open"};function Ds(r,e,t,n,i,s){const a=C("wb-form-field-textbox"),l=C("wb-file-select"),o=C("wb-button"),c=C("wb-button-wrapper"),u=C("wb-form");return I(),F("div",Cs,[E(u,{onSubmit:s.onSubmit},{default:oe(()=>[E(a,Y(i.fields.path,{modelValue:i.currentModel.path,"onUpdate:modelValue":e[0]||(e[0]=d=>i.currentModel.path=d),readonly:""}),null,16,["modelValue"]),E(l,Y(i.fields.fileSelect,{"file-system":i.filesModule.fileSystem,"fs-item":s.fileSelectFsItem,model:t.model,onSelect:s.onSelect}),null,16,["file-system","fs-item","model","onSelect"]),E(c,{align:"outer",full:""},{default:oe(()=>[i.cancelLabel?(I(),ne(o,{key:0,"style-type":"secondary",label:i.cancelLabel,onClick:s.onClickCancel},null,8,["label","onClick"])):U("",!0),i.openLabel?(I(),ne(o,{key:1,"style-type":"primary",label:i.openLabel,type:"submit",disabled:s.isItemContainer},null,8,["label","disabled"])):U("",!0)]),_:1})]),_:1},8,["onSubmit"])])}const Rs=ce(Es,[["render",Ds],["__scopeId","data-v-03ef60e0"]]);function Gt(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let ye=Gt();function Nn(r){ye=r}const We={exec:()=>null};function S(r,e=""){let t=typeof r=="string"?r:r.source;const n={replace:(i,s)=>{let a=typeof s=="string"?s:s.source;return a=a.replace(W.caret,"$1"),t=t.replace(i,a),n},getRegex:()=>new RegExp(t,e)};return n}const W={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:r=>new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}#`),htmlBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}<(?:[a-z].*>|!--)`,"i")},Ls=/^(?:[ \t]*(?:\n|$))+/,Ms=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Os=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,rt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Fs=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,jn=/(?:[*+-]|\d{1,9}[.)])/,Un=S(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,jn).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),Xt=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Ts=/^[^\n]+/,Kt=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Ps=S(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Kt).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),$s=S(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,jn).getRegex(),kt="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Qt=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Ws=S("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Qt).replace("tag",kt).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Hn=S(Xt).replace("hr",rt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",kt).getRegex(),Bs=S(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Hn).getRegex(),Jt={blockquote:Bs,code:Ms,def:Ps,fences:Os,heading:Fs,hr:rt,html:Ws,lheading:Un,list:$s,newline:Ls,paragraph:Hn,table:We,text:Ts},fn=S("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",rt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",kt).getRegex(),zs={...Jt,table:fn,paragraph:S(Xt).replace("hr",rt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",fn).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",kt).getRegex()},Ns={...Jt,html:S(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Qt).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:We,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:S(Xt).replace("hr",rt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Un).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Vn=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,js=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Yn=/^( {2,}|\\)\n(?!\s*$)/,Us=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,vt=/[\p{P}\p{S}]/u,en=/[\s\p{P}\p{S}]/u,qn=/[^\s\p{P}\p{S}]/u,Hs=S(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,en).getRegex(),Vs=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Ys=S(/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,"u").replace(/punct/g,vt).getRegex(),qs=S("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)","gu").replace(/notPunctSpace/g,qn).replace(/punctSpace/g,en).replace(/punct/g,vt).getRegex(),Zs=S("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,qn).replace(/punctSpace/g,en).replace(/punct/g,vt).getRegex(),Gs=S(/\\(punct)/,"gu").replace(/punct/g,vt).getRegex(),Xs=S(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ks=S(Qt).replace("(?:-->|$)","-->").getRegex(),Qs=S("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ks).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),pt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Js=S(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",pt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Zn=S(/^!?\[(label)\]\[(ref)\]/).replace("label",pt).replace("ref",Kt).getRegex(),Gn=S(/^!?\[(ref)\](?:\[\])?/).replace("ref",Kt).getRegex(),er=S("reflink|nolink(?!\\()","g").replace("reflink",Zn).replace("nolink",Gn).getRegex(),tn={_backpedal:We,anyPunctuation:Gs,autolink:Xs,blockSkip:Vs,br:Yn,code:js,del:We,emStrongLDelim:Ys,emStrongRDelimAst:qs,emStrongRDelimUnd:Zs,escape:Vn,link:Js,nolink:Gn,punctuation:Hs,reflink:Zn,reflinkSearch:er,tag:Qs,text:Us,url:We},tr={...tn,link:S(/^!?\[(label)\]\((.*?)\)/).replace("label",pt).getRegex(),reflink:S(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",pt).getRegex()},jt={...tn,escape:S(Vn).replace("])","~|])").getRegex(),url:S(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},nr={...jt,br:S(Yn).replace("{2,}","*").getRegex(),text:S(jt.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ot={normal:Jt,gfm:zs,pedantic:Ns},Oe={normal:tn,gfm:jt,breaks:nr,pedantic:tr},ir={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},pn=r=>ir[r];function ee(r,e){if(e){if(W.escapeTest.test(r))return r.replace(W.escapeReplace,pn)}else if(W.escapeTestNoEncode.test(r))return r.replace(W.escapeReplaceNoEncode,pn);return r}function mn(r){try{r=encodeURI(r).replace(W.percentDecode,"%")}catch{return null}return r}function gn(r,e){var s;const t=r.replace(W.findPipe,(a,l,o)=>{let c=!1,u=l;for(;--u>=0&&o[u]==="\\";)c=!c;return c?"|":" |"}),n=t.split(W.splitPipe);let i=0;if(n[0].trim()||n.shift(),n.length>0&&!((s=n.at(-1))!=null&&s.trim())&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(W.slashPipe,"|");return n}function Fe(r,e,t){const n=r.length;if(n===0)return"";let i=0;for(;i<n;){const s=r.charAt(n-i-1);if(s===e&&!t)i++;else if(s!==e&&t)i++;else break}return r.slice(0,n-i)}function sr(r,e){if(r.indexOf(e[1])===-1)return-1;let t=0;for(let n=0;n<r.length;n++)if(r[n]==="\\")n++;else if(r[n]===e[0])t++;else if(r[n]===e[1]&&(t--,t<0))return n;return-1}function xn(r,e,t,n,i){const s=e.href,a=e.title||null,l=r[1].replace(i.other.outputLinkReplace,"$1");if(r[0].charAt(0)!=="!"){n.state.inLink=!0;const o={type:"link",raw:t,href:s,title:a,text:l,tokens:n.inlineTokens(l)};return n.state.inLink=!1,o}return{type:"image",raw:t,href:s,title:a,text:l}}function rr(r,e,t){const n=r.match(t.other.indentCodeCompensation);if(n===null)return e;const i=n[1];return e.split(`
`).map(s=>{const a=s.match(t.other.beginningSpace);if(a===null)return s;const[l]=a;return l.length>=i.length?s.slice(i.length):s}).join(`
`)}class mt{constructor(e){p(this,"options");p(this,"rules");p(this,"lexer");this.options=e||ye}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Fe(n,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],i=rr(n,t[3]||"",this.rules);return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:i}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){const i=Fe(n,"#");(this.options.pedantic||!i||this.rules.other.endingSpaceChar.test(i))&&(n=i.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:Fe(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let n=Fe(t[0],`
`).split(`
`),i="",s="";const a=[];for(;n.length>0;){let l=!1;const o=[];let c;for(c=0;c<n.length;c++)if(this.rules.other.blockquoteStart.test(n[c]))o.push(n[c]),l=!0;else if(!l)o.push(n[c]);else break;n=n.slice(c);const u=o.join(`
`),d=u.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");i=i?`${i}
${u}`:u,s=s?`${s}
${d}`:d;const h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(d,a,!0),this.lexer.state.top=h,n.length===0)break;const f=a.at(-1);if((f==null?void 0:f.type)==="code")break;if((f==null?void 0:f.type)==="blockquote"){const x=f,w=x.raw+`
`+n.join(`
`),b=this.blockquote(w);a[a.length-1]=b,i=i.substring(0,i.length-x.raw.length)+b.raw,s=s.substring(0,s.length-x.text.length)+b.text;break}else if((f==null?void 0:f.type)==="list"){const x=f,w=x.raw+`
`+n.join(`
`),b=this.list(w);a[a.length-1]=b,i=i.substring(0,i.length-f.raw.length)+b.raw,s=s.substring(0,s.length-x.raw.length)+b.raw,n=w.substring(a.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:i,tokens:a,text:s}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const i=n.length>1,s={type:"list",raw:"",ordered:i,start:i?+n.slice(0,-1):"",loose:!1,items:[]};n=i?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=i?n:"[*+-]");const a=this.rules.other.listItemRegex(n);let l=!1;for(;e;){let c=!1,u="",d="";if(!(t=a.exec(e))||this.rules.block.hr.test(e))break;u=t[0],e=e.substring(u.length);let h=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,D=>" ".repeat(3*D.length)),f=e.split(`
`,1)[0],x=!h.trim(),w=0;if(this.options.pedantic?(w=2,d=h.trimStart()):x?w=t[1].length+1:(w=t[2].search(this.rules.other.nonSpaceChar),w=w>4?1:w,d=h.slice(w),w+=t[1].length),x&&this.rules.other.blankLine.test(f)&&(u+=f+`
`,e=e.substring(f.length+1),c=!0),!c){const D=this.rules.other.nextBulletRegex(w),M=this.rules.other.hrRegex(w),ue=this.rules.other.fencesBeginRegex(w),X=this.rules.other.headingBeginRegex(w),Q=this.rules.other.htmlBeginRegex(w);for(;e;){const _t=e.split(`
`,1)[0];let De;if(f=_t,this.options.pedantic?(f=f.replace(this.rules.other.listReplaceNesting,"  "),De=f):De=f.replace(this.rules.other.tabCharGlobal,"    "),ue.test(f)||X.test(f)||Q.test(f)||D.test(f)||M.test(f))break;if(De.search(this.rules.other.nonSpaceChar)>=w||!f.trim())d+=`
`+De.slice(w);else{if(x||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||ue.test(h)||X.test(h)||M.test(h))break;d+=`
`+f}!x&&!f.trim()&&(x=!0),u+=_t+`
`,e=e.substring(_t.length+1),h=De.slice(w)}}s.loose||(l?s.loose=!0:this.rules.other.doubleBlankLine.test(u)&&(l=!0));let b=null,H;this.options.gfm&&(b=this.rules.other.listIsTask.exec(d),b&&(H=b[0]!=="[ ] ",d=d.replace(this.rules.other.listReplaceTask,""))),s.items.push({type:"list_item",raw:u,task:!!b,checked:H,loose:!1,text:d,tokens:[]}),s.raw+=u}const o=s.items.at(-1);o&&(o.raw=o.raw.trimEnd(),o.text=o.text.trimEnd()),s.raw=s.raw.trimEnd();for(let c=0;c<s.items.length;c++)if(this.lexer.state.top=!1,s.items[c].tokens=this.lexer.blockTokens(s.items[c].text,[]),!s.loose){const u=s.items[c].tokens.filter(h=>h.type==="space"),d=u.length>0&&u.some(h=>this.rules.other.anyLine.test(h.raw));s.loose=d}if(s.loose)for(let c=0;c<s.items.length;c++)s.items[c].loose=!0;return s}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),i=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:i,title:s}}}table(e){var l;const t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;const n=gn(t[1]),i=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=(l=t[3])!=null&&l.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===i.length){for(const o of i)this.rules.other.tableAlignRight.test(o)?a.align.push("right"):this.rules.other.tableAlignCenter.test(o)?a.align.push("center"):this.rules.other.tableAlignLeft.test(o)?a.align.push("left"):a.align.push(null);for(let o=0;o<n.length;o++)a.header.push({text:n[o],tokens:this.lexer.inline(n[o]),header:!0,align:a.align[o]});for(const o of s)a.rows.push(gn(o,a.header.length).map((c,u)=>({text:c,tokens:this.lexer.inline(c),header:!1,align:a.align[u]})));return a}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;const a=Fe(n.slice(0,-1),"\\");if((n.length-a.length)%2===0)return}else{const a=sr(t[2],"()");if(a>-1){const o=(t[0].indexOf("!")===0?5:4)+t[1].length+a;t[2]=t[2].substring(0,a),t[0]=t[0].substring(0,o).trim(),t[3]=""}}let i=t[2],s="";if(this.options.pedantic){const a=this.rules.other.pedanticHrefTitle.exec(i);a&&(i=a[1],s=a[3])}else s=t[3]?t[3].slice(1,-1):"";return i=i.trim(),this.rules.other.startAngleBracket.test(i)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?i=i.slice(1):i=i.slice(1,-1)),xn(t,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const i=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=t[i.toLowerCase()];if(!s){const a=n[0].charAt(0);return{type:"text",raw:a,text:a}}return xn(n,s,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let i=this.rules.inline.emStrongLDelim.exec(e);if(!i||i[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(i[1]||i[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const a=[...i[0]].length-1;let l,o,c=a,u=0;const d=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,t=t.slice(-1*e.length+a);(i=d.exec(t))!=null;){if(l=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!l)continue;if(o=[...l].length,i[3]||i[4]){c+=o;continue}else if((i[5]||i[6])&&a%3&&!((a+o)%3)){u+=o;continue}if(c-=o,c>0)continue;o=Math.min(o,o+c+u);const h=[...i[0]][0].length,f=e.slice(0,a+i.index+h+o);if(Math.min(a,o)%2){const w=f.slice(1,-1);return{type:"em",raw:f,text:w,tokens:this.lexer.inlineTokens(w)}}const x=f.slice(2,-2);return{type:"strong",raw:f,text:x,tokens:this.lexer.inlineTokens(x)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal," ");const i=this.rules.other.nonSpaceChar.test(n),s=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return i&&s&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:t[0],text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let n,i;return t[2]==="@"?(n=t[1],i="mailto:"+n):(n=t[1],i=n),{type:"link",raw:t[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}url(e){var n;let t;if(t=this.rules.inline.url.exec(e)){let i,s;if(t[2]==="@")i=t[0],s="mailto:"+i;else{let a;do a=t[0],t[0]=((n=this.rules.inline._backpedal.exec(t[0]))==null?void 0:n[0])??"";while(a!==t[0]);i=t[0],t[1]==="www."?s="http://"+t[0]:s=t[0]}return{type:"link",raw:t[0],text:i,href:s,tokens:[{type:"text",raw:i,text:i}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const n=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:n}}}}class Z{constructor(e){p(this,"tokens");p(this,"options");p(this,"state");p(this,"tokenizer");p(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||ye,this.options.tokenizer=this.options.tokenizer||new mt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:W,block:ot.normal,inline:Oe.normal};this.options.pedantic?(t.block=ot.pedantic,t.inline=Oe.pedantic):this.options.gfm&&(t.block=ot.gfm,this.options.breaks?t.inline=Oe.breaks:t.inline=Oe.gfm),this.tokenizer.rules=t}static get rules(){return{block:ot,inline:Oe}}static lex(e,t){return new Z(t).lex(e)}static lexInline(e,t){return new Z(t).inlineTokens(e)}lex(e){e=e.replace(W.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const n=this.inlineQueue[t];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){var i,s,a;for(this.options.pedantic&&(e=e.replace(W.tabCharGlobal,"    ").replace(W.spaceLine,""));e;){let l;if((s=(i=this.options.extensions)==null?void 0:i.block)!=null&&s.some(c=>(l=c.call({lexer:this},e,t))?(e=e.substring(l.raw.length),t.push(l),!0):!1))continue;if(l=this.tokenizer.space(e)){e=e.substring(l.raw.length);const c=t.at(-1);l.raw.length===1&&c!==void 0?c.raw+=`
`:t.push(l);continue}if(l=this.tokenizer.code(e)){e=e.substring(l.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=`
`+l.raw,c.text+=`
`+l.text,this.inlineQueue.at(-1).src=c.text):t.push(l);continue}if(l=this.tokenizer.fences(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.heading(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.hr(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.blockquote(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.list(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.html(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.def(e)){e=e.substring(l.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=`
`+l.raw,c.text+=`
`+l.raw,this.inlineQueue.at(-1).src=c.text):this.tokens.links[l.tag]||(this.tokens.links[l.tag]={href:l.href,title:l.title});continue}if(l=this.tokenizer.table(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.lheading(e)){e=e.substring(l.raw.length),t.push(l);continue}let o=e;if((a=this.options.extensions)!=null&&a.startBlock){let c=1/0;const u=e.slice(1);let d;this.options.extensions.startBlock.forEach(h=>{d=h.call({lexer:this},u),typeof d=="number"&&d>=0&&(c=Math.min(c,d))}),c<1/0&&c>=0&&(o=e.substring(0,c+1))}if(this.state.top&&(l=this.tokenizer.paragraph(o))){const c=t.at(-1);n&&(c==null?void 0:c.type)==="paragraph"?(c.raw+=`
`+l.raw,c.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):t.push(l),n=o.length!==e.length,e=e.substring(l.raw.length);continue}if(l=this.tokenizer.text(e)){e=e.substring(l.raw.length);const c=t.at(-1);(c==null?void 0:c.type)==="text"?(c.raw+=`
`+l.raw,c.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):t.push(l);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){var l,o,c;let n=e,i=null;if(this.tokens.links){const u=Object.keys(this.tokens.links);if(u.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)u.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,i.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let s=!1,a="";for(;e;){s||(a=""),s=!1;let u;if((o=(l=this.options.extensions)==null?void 0:l.inline)!=null&&o.some(h=>(u=h.call({lexer:this},e,t))?(e=e.substring(u.raw.length),t.push(u),!0):!1))continue;if(u=this.tokenizer.escape(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.tag(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.link(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(u.raw.length);const h=t.at(-1);u.type==="text"&&(h==null?void 0:h.type)==="text"?(h.raw+=u.raw,h.text+=u.text):t.push(u);continue}if(u=this.tokenizer.emStrong(e,n,a)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.codespan(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.br(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.del(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.autolink(e)){e=e.substring(u.raw.length),t.push(u);continue}if(!this.state.inLink&&(u=this.tokenizer.url(e))){e=e.substring(u.raw.length),t.push(u);continue}let d=e;if((c=this.options.extensions)!=null&&c.startInline){let h=1/0;const f=e.slice(1);let x;this.options.extensions.startInline.forEach(w=>{x=w.call({lexer:this},f),typeof x=="number"&&x>=0&&(h=Math.min(h,x))}),h<1/0&&h>=0&&(d=e.substring(0,h+1))}if(u=this.tokenizer.inlineText(d)){e=e.substring(u.raw.length),u.raw.slice(-1)!=="_"&&(a=u.raw.slice(-1)),s=!0;const h=t.at(-1);(h==null?void 0:h.type)==="text"?(h.raw+=u.raw,h.text+=u.text):t.push(u);continue}if(e){const h="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(h);break}else throw new Error(h)}}return t}}class gt{constructor(e){p(this,"options");p(this,"parser");this.options=e||ye}space(e){return""}code({text:e,lang:t,escaped:n}){var a;const i=(a=(t||"").match(W.notSpaceStart))==null?void 0:a[0],s=e.replace(W.endingNewline,"")+`
`;return i?'<pre><code class="language-'+ee(i)+'">'+(n?s:ee(s,!0))+`</code></pre>
`:"<pre><code>"+(n?s:ee(s,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,n=e.start;let i="";for(let l=0;l<e.items.length;l++){const o=e.items[l];i+=this.listitem(o)}const s=t?"ol":"ul",a=t&&n!==1?' start="'+n+'"':"";return"<"+s+a+`>
`+i+"</"+s+`>
`}listitem(e){var n;let t="";if(e.task){const i=this.checkbox({checked:!!e.checked});e.loose?((n=e.tokens[0])==null?void 0:n.type)==="paragraph"?(e.tokens[0].text=i+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=i+" "+ee(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:i+" ",text:i+" ",escaped:!0}):t+=i+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",n="";for(let s=0;s<e.header.length;s++)n+=this.tablecell(e.header[s]);t+=this.tablerow({text:n});let i="";for(let s=0;s<e.rows.length;s++){const a=e.rows[s];n="";for(let l=0;l<a.length;l++)n+=this.tablecell(a[l]);i+=this.tablerow({text:n})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+i+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${ee(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){const i=this.parser.parseInline(n),s=mn(e);if(s===null)return i;e=s;let a='<a href="'+e+'"';return t&&(a+=' title="'+ee(t)+'"'),a+=">"+i+"</a>",a}image({href:e,title:t,text:n}){const i=mn(e);if(i===null)return ee(n);e=i;let s=`<img src="${e}" alt="${n}"`;return t&&(s+=` title="${ee(t)}"`),s+=">",s}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:ee(e.text)}}class nn{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class G{constructor(e){p(this,"options");p(this,"renderer");p(this,"textRenderer");this.options=e||ye,this.options.renderer=this.options.renderer||new gt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new nn}static parse(e,t){return new G(t).parse(e)}static parseInline(e,t){return new G(t).parseInline(e)}parse(e,t=!0){var i,s;let n="";for(let a=0;a<e.length;a++){const l=e[a];if((s=(i=this.options.extensions)==null?void 0:i.renderers)!=null&&s[l.type]){const c=l,u=this.options.extensions.renderers[c.type].call({parser:this},c);if(u!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(c.type)){n+=u||"";continue}}const o=l;switch(o.type){case"space":{n+=this.renderer.space(o);continue}case"hr":{n+=this.renderer.hr(o);continue}case"heading":{n+=this.renderer.heading(o);continue}case"code":{n+=this.renderer.code(o);continue}case"table":{n+=this.renderer.table(o);continue}case"blockquote":{n+=this.renderer.blockquote(o);continue}case"list":{n+=this.renderer.list(o);continue}case"html":{n+=this.renderer.html(o);continue}case"paragraph":{n+=this.renderer.paragraph(o);continue}case"text":{let c=o,u=this.renderer.text(c);for(;a+1<e.length&&e[a+1].type==="text";)c=e[++a],u+=`
`+this.renderer.text(c);t?n+=this.renderer.paragraph({type:"paragraph",raw:u,text:u,tokens:[{type:"text",raw:u,text:u,escaped:!0}]}):n+=u;continue}default:{const c='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}parseInline(e,t=this.renderer){var i,s;let n="";for(let a=0;a<e.length;a++){const l=e[a];if((s=(i=this.options.extensions)==null?void 0:i.renderers)!=null&&s[l.type]){const c=this.options.extensions.renderers[l.type].call({parser:this},l);if(c!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){n+=c||"";continue}}const o=l;switch(o.type){case"escape":{n+=t.text(o);break}case"html":{n+=t.html(o);break}case"link":{n+=t.link(o);break}case"image":{n+=t.image(o);break}case"strong":{n+=t.strong(o);break}case"em":{n+=t.em(o);break}case"codespan":{n+=t.codespan(o);break}case"br":{n+=t.br(o);break}case"del":{n+=t.del(o);break}case"text":{n+=t.text(o);break}default:{const c='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}}class Be{constructor(e){p(this,"options");p(this,"block");this.options=e||ye}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?Z.lex:Z.lexInline}provideParser(){return this.block?G.parse:G.parseInline}}p(Be,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class ar{constructor(...e){p(this,"defaults",Gt());p(this,"options",this.setOptions);p(this,"parse",this.parseMarkdown(!0));p(this,"parseInline",this.parseMarkdown(!1));p(this,"Parser",G);p(this,"Renderer",gt);p(this,"TextRenderer",nn);p(this,"Lexer",Z);p(this,"Tokenizer",mt);p(this,"Hooks",Be);this.use(...e)}walkTokens(e,t){var i,s;let n=[];for(const a of e)switch(n=n.concat(t.call(this,a)),a.type){case"table":{const l=a;for(const o of l.header)n=n.concat(this.walkTokens(o.tokens,t));for(const o of l.rows)for(const c of o)n=n.concat(this.walkTokens(c.tokens,t));break}case"list":{const l=a;n=n.concat(this.walkTokens(l.items,t));break}default:{const l=a;(s=(i=this.defaults.extensions)==null?void 0:i.childTokens)!=null&&s[l.type]?this.defaults.extensions.childTokens[l.type].forEach(o=>{const c=l[o].flat(1/0);n=n.concat(this.walkTokens(c,t))}):l.tokens&&(n=n.concat(this.walkTokens(l.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{const i={...n};if(i.async=this.defaults.async||i.async||!1,n.extensions&&(n.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){const a=t.renderers[s.name];a?t.renderers[s.name]=function(...l){let o=s.renderer.apply(this,l);return o===!1&&(o=a.apply(this,l)),o}:t.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const a=t[s.level];a?a.unshift(s.tokenizer):t[s.level]=[s.tokenizer],s.start&&(s.level==="block"?t.startBlock?t.startBlock.push(s.start):t.startBlock=[s.start]:s.level==="inline"&&(t.startInline?t.startInline.push(s.start):t.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(t.childTokens[s.name]=s.childTokens)}),i.extensions=t),n.renderer){const s=this.defaults.renderer||new gt(this.defaults);for(const a in n.renderer){if(!(a in s))throw new Error(`renderer '${a}' does not exist`);if(["options","parser"].includes(a))continue;const l=a,o=n.renderer[l],c=s[l];s[l]=(...u)=>{let d=o.apply(s,u);return d===!1&&(d=c.apply(s,u)),d||""}}i.renderer=s}if(n.tokenizer){const s=this.defaults.tokenizer||new mt(this.defaults);for(const a in n.tokenizer){if(!(a in s))throw new Error(`tokenizer '${a}' does not exist`);if(["options","rules","lexer"].includes(a))continue;const l=a,o=n.tokenizer[l],c=s[l];s[l]=(...u)=>{let d=o.apply(s,u);return d===!1&&(d=c.apply(s,u)),d}}i.tokenizer=s}if(n.hooks){const s=this.defaults.hooks||new Be;for(const a in n.hooks){if(!(a in s))throw new Error(`hook '${a}' does not exist`);if(["options","block"].includes(a))continue;const l=a,o=n.hooks[l],c=s[l];Be.passThroughHooks.has(a)?s[l]=u=>{if(this.defaults.async)return Promise.resolve(o.call(s,u)).then(h=>c.call(s,h));const d=o.call(s,u);return c.call(s,d)}:s[l]=(...u)=>{let d=o.apply(s,u);return d===!1&&(d=c.apply(s,u)),d}}i.hooks=s}if(n.walkTokens){const s=this.defaults.walkTokens,a=n.walkTokens;i.walkTokens=function(l){let o=[];return o.push(a.call(this,l)),s&&(o=o.concat(s.call(this,l))),o}}this.defaults={...this.defaults,...i}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return Z.lex(e,t??this.defaults)}parser(e,t){return G.parse(e,t??this.defaults)}parseMarkdown(e){return(n,i)=>{const s={...i},a={...this.defaults,...s},l=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&s.async===!1)return l(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof n>"u"||n===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));a.hooks&&(a.hooks.options=a,a.hooks.block=e);const o=a.hooks?a.hooks.provideLexer():e?Z.lex:Z.lexInline,c=a.hooks?a.hooks.provideParser():e?G.parse:G.parseInline;if(a.async)return Promise.resolve(a.hooks?a.hooks.preprocess(n):n).then(u=>o(u,a)).then(u=>a.hooks?a.hooks.processAllTokens(u):u).then(u=>a.walkTokens?Promise.all(this.walkTokens(u,a.walkTokens)).then(()=>u):u).then(u=>c(u,a)).then(u=>a.hooks?a.hooks.postprocess(u):u).catch(l);try{a.hooks&&(n=a.hooks.preprocess(n));let u=o(n,a);a.hooks&&(u=a.hooks.processAllTokens(u)),a.walkTokens&&this.walkTokens(u,a.walkTokens);let d=c(u,a);return a.hooks&&(d=a.hooks.postprocess(d)),d}catch(u){return l(u)}}}onError(e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const i="<p>An error occurred:</p><pre>"+ee(n.message+"",!0)+"</pre>";return t?Promise.resolve(i):i}if(t)return Promise.reject(n);throw n}}}const be=new ar;function v(r,e){return be.parse(r,e)}v.options=v.setOptions=function(r){return be.setOptions(r),v.defaults=be.defaults,Nn(v.defaults),v};v.getDefaults=Gt;v.defaults=ye;v.use=function(...r){return be.use(...r),v.defaults=be.defaults,Nn(v.defaults),v};v.walkTokens=function(r,e){return be.walkTokens(r,e)};v.parseInline=be.parseInline;v.Parser=G;v.parser=G.parse;v.Renderer=gt;v.TextRenderer=nn;v.Lexer=Z;v.lexer=Z.lex;v.Tokenizer=mt;v.Hooks=Be;v.parse=v;v.options;v.setOptions;v.use;v.walkTokens;v.parseInline;G.parse;Z.lex;const or=["innerHTML"],lr={__name:"Markdown",props:{content:{type:String,required:!1,default:"# Headline  <p>Hello World</p>"},fontFamily:{type:String,required:!1,default:null}},setup(r){const e=new v.Renderer;e.link=function(){return v.Renderer.prototype.link.apply(this,arguments).replace("<a","<a target='_blank'")},v.setOptions({renderer:e}),v.use({mangle:!1});const t=r,n=xi(()=>v(t.content));return(i,s)=>(I(),F("div",{class:"wb-env-atom-markdown",innerHTML:n.value},null,8,or))}},cr=ce(lr,[["__scopeId","data-v-1eaeaa29"]]),ur={components:{WbMarkdown:cr},props:{type:{type:String,default:null},content:{type:[String,Array],default:null}},setup(){return Ee()},data(){return{lines:[]}},mounted(){this.type==="basic"&&window.requestAnimationFrame(()=>{this.lines=[],this.core.modules.parser.parseBasic(this.content,async(r,e)=>{const t=await this.core.executeCommand(r,e);return e.message&&this.lines.push(hi(e.message)),t})})}},dr={class:"wb-module-files-preview"},hr={key:0,class:"basic"},fr=["innerHTML"],pr=["src"];function mr(r,e,t,n,i,s){const a=C("wb-markdown");return I(),F("div",dr,[t.type==="basic"?(I(),F("ul",hr,[(I(!0),F(Tt,null,Pt(i.lines,(l,o)=>(I(),F("li",{key:o},$t(l),1))),128))])):U("",!0),t.type==="markdown"?(I(),ne(a,{key:1,content:t.content},null,8,["content"])):U("",!0),t.type==="html"?(I(),F("div",{key:2,innerHTML:t.content},null,8,fr)):U("",!0),t.type==="image"?(I(),F("img",{key:3,src:t.content},null,8,pr)):U("",!0)])}const gr=ce(ur,[["render",mr],["__scopeId","data-v-bc8c72b8"]]),xr={HAS_WINDOW_OUTPUT:"has_window_output"};async function br(r,e,t){const n=await r.executeCommand(`exist "${e}"`);let i=!1;n&&(i=await r.executeCommand('openDialog "File exist, overwrite?" --confirm'));const s=[`makefile "${e}"`];return t&&s.push(`--data="${t}"`),i?s.push("--override"):s.push("--ignore"),r.executeCommand(s.join(" "))}const wr=({module:r,core:e})=>{const t=e.modules.windows,{fileSystem:n}=r;return[{name:"openPreview",args:[new g({index:0,name:"path",description:"Path to the file"}),new g({name:"maximized",description:"If set, window is maximized."})],async action({path:i,maximized:s}){const a=await n.get(i),{type:l,content:o,openMaximized:c}=a.data;l==="basic"&&!a.data[xr.HAS_WINDOW_OUTPUT]?await e.modules.parser.parseBasic(o,async(u,d)=>await e.executeCommand(u,d)):t.addWindow({title:a.name,component:gr,componentData:{type:l,content:o},options:{scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0},layout:{size:$(420,360)}},{full:c||s||!1})}},{name:"saveFileDialog",args:[new g({index:0,name:"data",description:"File Content"}),new g({index:1,name:"id",description:"File Id"}),new g({index:2,name:"extension",description:"File Extension"})],async action({data:i,id:s,extension:a}){const l=t.addWindow({title:"Save File",component:As,componentData:{fsItem:R(n.root),id:s},options:{scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}),{value:o}=await l.awaitClose();if(o){const c=Sn(o,a),u=await br(e,c,i);if(u)return R(En(u))}}},{name:"openFileDialog",args:[],async action(){await t.addWindow({title:"Open File",component:Rs,componentData:{fsItem:R(n.root)},options:{scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}},{name:"fileinfo",description:"Get info from File or Directory",args:[new g({index:0,name:"path",description:"Path to the file"}),new g({index:1,name:"name",description:"Name from the Info"}),new g({index:2,name:["list","ls"],flag:!0,description:"List all Infos"})],async action({path:i,name:s,list:a},l){const o=await n.itemMeta(i,s,a);if(Array.isArray(o)){const c=new lt;c.addColumn({value:"Name",align:"left",minWidth:20}),c.addColumn({value:"Value",align:"left",minWidth:20}),c.addRow(o.map(u=>{let d=u.value;return Array.isArray(d)&&(d=d.join(" ")),[u.name,d]})),l.message([c])}return o}},{name:["info","i"],args:[new g({index:0,name:"path",description:"Path to the file"})],async action({path:i},s){let a=n.root;i&&(a=await n.get(i)),a instanceof L||(a=a.parent);let l=await a.getItems();const o=new lt;o.addColumn([{value:"Unit",align:"left",minWidth:8},{value:"Size",align:"right",minWidth:6},{value:"Used",align:"right",minWidth:6},{value:"Free",align:"right",minWidth:6},{value:"Full",minWidth:4},{value:"Errs",align:"center",minWidth:4},{value:"Status",align:"center",minWidth:10},{value:"Name",align:"right",minWidth:14}]),l=Array.from(l.values()).filter(u=>u instanceof le),o.addRow(l.map(u=>{let d=0;return(u.size>0||u.maxSize>0)&&(d=parseInt(u.size/u.maxSize*100)),[`${u.id}:`,$e(u.maxSize),$e(u.size),$e(u.maxSize-u.size),`${d}%`,"0",u.locked?"Read":"Read/Write",`${u.name||""}`]}));const c=["","Mounted disks:",o,"","Volumes available:"];l.forEach(u=>{c.push(`${u.name}: [Mounted]`)}),c.push(""),s.message(c)}},{name:["list","ls"],args:[new g({index:0,name:"path",description:"Path to the file"}),new g({name:"dir-size",flag:!0,description:"Show Directory Size."})],async action({path:i,dirSize:s},a){let l=n.currentItem;i&&(l=await n.get(i));const o=Array.from((await l.getItems()).values()),c=new lt;c.addColumn({value:"Name",align:"left",minWidth:13}),c.addColumn({value:"Size",align:"right",minWidth:8}),c.addColumn({value:"Access",align:"center",minWidth:12}),c.addColumn({value:"Date / Time",align:"center",minWidth:18}),c.addRow(o.reduce((h,f)=>{let x;f instanceof L&&!s?x="DIR":x=ms($e(f.size),8,!0,"0");const w=f.isLocked()?"Read":"Read/Write";return h.push([`${f.id}:`,x,w,f.createdDate?Nt("D-mm-y H:I:S",f.createdDate):""]),h},[]));const u=o.reduce((h,f)=>(f instanceof xe&&h++,h),0),d=o.reduce((h,f)=>(h+=f.size,h),0);return a.message([c,`${o.length} files - ${u} directories - ${d} blocks used`]),Promise.resolve()}}]},yr={components:{WbForm:bt,WbButton:it,WbButtonWrapper:st,WbFormFieldTextbox:wt,WbFormFieldDropdown:Dn,WbFormFieldCheckboxGroup:yi},props:{fsItem:{type:Object,default(){return null}},model:{type:Object,default(){return{actions:{save(){}},id:null,name:null,symbol:null,visible:!1}}}},emits:["close"],setup(){return Ee()},data(){const r=this.fsItem.locked;return{currentModel:{...this.model},cancelLabel:"Cancel",saveLabel:"Save",fields:{id:{disabled:r,label:"Id",name:"id"},name:{disabled:r,label:"Name",name:"name"},checkboxes:{disabled:r,label:"Others",name:null,items:[{label:"Symbol Visible",name:k.VISIBLE},{label:"Ignore Symbol Rearrange ",name:k.IGNORE_SYMBOL_REARRANGE}]},windowSettings:{disabled:r,label:"Window Settings",name:null,items:[{label:"Has Scale ?",name:k.WINDOW_SCALE},{label:"Has Scroll-X ?",name:k.WINDOW_SCROLL_X},{label:"Has Scroll-Y ?",name:k.WINDOW_SCROLL_Y},{label:"Is Full-Size ?",name:k.WINDOW_FULL_SIZE},{label:"Sort Symbols (Directory)",name:k.WINDOW_SYMBOL_REARRANGE},{label:"Has Sidebar?",name:k.WINDOW_SIDEBAR}]},symbol:{disabled:r,label:"Symbol",name:"symbol",options:Object.keys(K).map(e=>({title:Cn(e),value:K[String(e)]}))}}}},methods:{onClickCancel(){this.$emit("close")},async onSubmit(){this.locked||await this.model.actions.save(this.currentModel,this.fsItem),this.$emit("close")}}},kr={class:"wb-module-files-edit"},vr={class:"cols"},_r={class:"col-2"},Ir={class:"col-2"};function Sr(r,e,t,n,i,s){const a=C("wb-form-field-textbox"),l=C("wb-form-field-dropdown"),o=C("wb-form-field-checkbox-group"),c=C("wb-button"),u=C("wb-button-wrapper"),d=C("wb-form");return I(),F("div",kr,[E(d,{class:"form",onSubmit:s.onSubmit},{default:oe(()=>[P("div",null,[E(a,Y(i.fields.id,{modelValue:i.currentModel.id,"onUpdate:modelValue":e[0]||(e[0]=h=>i.currentModel.id=h)}),null,16,["modelValue"]),E(a,Y(i.fields.name,{modelValue:i.currentModel.name,"onUpdate:modelValue":e[1]||(e[1]=h=>i.currentModel.name=h)}),null,16,["modelValue"]),E(l,Y(i.fields.symbol,{modelValue:i.currentModel.symbol,"onUpdate:modelValue":e[2]||(e[2]=h=>i.currentModel.symbol=h)}),null,16,["modelValue"]),P("div",vr,[P("div",_r,[E(o,Y(i.fields.checkboxes,{model:i.currentModel}),null,16,["model"])]),P("div",Ir,[E(o,Y(i.fields.windowSettings,{modelValue:i.currentModel.windowSettings,"onUpdate:modelValue":e[3]||(e[3]=h=>i.currentModel.windowSettings=h)}),null,16,["modelValue"])])])]),E(u,{align:"outer",full:""},{default:oe(()=>[i.cancelLabel?(I(),ne(c,{key:0,"style-type":"secondary",label:i.cancelLabel,onClick:s.onClickCancel},null,8,["label","onClick"])):U("",!0),i.saveLabel?(I(),ne(c,{key:1,"style-type":"primary",label:i.saveLabel,type:"submit"},null,8,["label"])):U("",!0)]),_:1})]),_:1},8,["onSubmit"])])}const Ar=ce(yr,[["render",Sr],["__scopeId","data-v-43900761"]]),Er={components:{WbForm:bt,WbButton:it,WbButtonWrapper:st,WbFormFieldTextbox:wt,WbFormFieldDropdown:Dn},props:{fsItem:{type:Object,default(){return null}},model:{type:Object,default(){return{actions:{save:()=>{}},name:null,url:null,symbol:null}}}},emits:["close"],setup(){return Ee()},data(){const r=(this.fsItem||{}).locked;return{currentModel:{...this.model},cancelLabel:"Cancel",saveLabel:"Save",fields:{name:{disabled:r,placeholder:"Name",label:"Name"},url:{disabled:r,placeholder:"http://…",label:"Url"},symbol:{disabled:r,label:"Symbol",options:Object.keys(K).map(e=>({title:Cn(e),value:K[String(e)]}))}}}},computed:{disabledSave(){return!this.currentModel.name||!this.currentModel.url||!this.currentModel.symbol}},methods:{onClickCancel(){this.$emit("close")},async onSubmit(){await this.model.actions.save(this.currentModel,this.fsItem)&&this.$emit("close")}}},Cr={class:"wb-module-files-web-link"};function Dr(r,e,t,n,i,s){const a=C("wb-form-field-textbox"),l=C("wb-form-field-dropdown"),o=C("wb-button"),c=C("wb-button-wrapper"),u=C("wb-form");return I(),F("div",Cr,[E(u,{onSubmit:s.onSubmit},{default:oe(()=>[E(a,Y(i.fields.name,{modelValue:i.currentModel.name,"onUpdate:modelValue":e[0]||(e[0]=d=>i.currentModel.name=d)}),null,16,["modelValue"]),E(a,Y(i.fields.url,{modelValue:i.currentModel.url,"onUpdate:modelValue":e[1]||(e[1]=d=>i.currentModel.url=d),type:"url"}),null,16,["modelValue"]),E(l,Y(i.fields.symbol,{modelValue:i.currentModel.symbol,"onUpdate:modelValue":e[2]||(e[2]=d=>i.currentModel.symbol=d)}),null,16,["modelValue"]),E(c,{align:"outer",full:""},{default:oe(()=>[i.cancelLabel?(I(),ne(o,{key:0,"style-type":"secondary",label:i.cancelLabel,onClick:s.onClickCancel},null,8,["label","onClick"])):U("",!0),i.saveLabel?(I(),ne(o,{key:1,"style-type":"primary",label:i.saveLabel,type:"submit",disabled:s.disabledSave},null,8,["label","disabled"])):U("",!0)]),_:1})]),_:1},8,["onSubmit"])])}const bn=ce(Er,[["render",Dr],["__scopeId","data-v-26955dd6"]]),Rr={components:{},props:{fsItem:{type:Object,default(){return null}}},setup(){return Ee()},computed:{meta(){return Array.from(this.fsItem.meta).map(([r,e])=>{if(typeof e=="object")try{e=JSON.stringify(e)}catch(t){console.error(t)}return{title:r,value:e}})},items(){return[{title:"Id",value:this.fsItem.id},{title:"Name",value:this.fsItem.name},{title:"Type",value:this.fsItem.constructor.NAME},{title:"Path",value:this.fsItem.getPath()},{title:"Size",value:$e(this.fsItem.size)},{title:"Locked",value:this.fsItem.locked?"Yes":"No"},{title:"Created Date",value:`<nobr>${Nt("H:I:S D.M.Y",this.fsItem.createdDate)}</nobr>`},{title:"Modified Date",value:`<nobr>${Nt("H:I:S D.M.Y",this.fsItem.editedDate)}</nobr>`}]}}},Lr={class:"wb-module-files-info"},Mr=["innerHTML"],Or=["innerHTML"];function Fr(r,e,t,n,i,s){return I(),F("div",Lr,[P("table",null,[(I(!0),F(Tt,null,Pt(s.items,({title:a,value:l},o)=>(I(),F("tr",{key:o},[P("td",null,$t(a)+":",1),P("td",{innerHTML:l},null,8,Mr)]))),128))]),P("fieldset",null,[e[0]||(e[0]=P("legend",null,"Meta:",-1)),P("table",null,[(I(!0),F(Tt,null,Pt(s.meta,({title:a,value:l},o)=>(I(),F("tr",{key:o},[P("td",null,$t(a)+":",1),P("td",{innerHTML:l},null,8,Or)]))),128))])])])}const Tr=ce(Rr,[["render",Fr],["__scopeId","data-v-85b541a0"]]),Pr=({core:r})=>{const{windows:e,symbols:t}=r.modules,n=Ae({open:{disabled:!1},edit:{disabled:!1},duplicate:{disabled:!1},container:{disabled:!1},emptyTrashcan:{disabled:!1},discard:{disabled:!1},info:{disabled:!1},webLink:{disabled:!1},webLinkNew:{disabled:!1},webLinkEdit:{disabled:!1}});function i(){const d=t.getSelectedItems(),h=t.getPrimaryWrapper();n.info.disabled=d.length<1,n.open.disabled=d.length<1,n.edit.disabled=d.length<1||d.find(f=>f.locked||f instanceof q),n.duplicate.disabled=d.length<1||d.find(({fsItem:f})=>f.locked||f instanceof q||f instanceof le),n.container.disabled=!n.open.disabled||h&&h.fsItem&&(h.fsItem instanceof Vt||h.fsItem.locked)||!h,n.webLinkEdit.disabled=d.length<1||d.find(f=>!f.fsItem.meta.get(k.WEB_URL)),n.webLinkNew.disabled=n.container.disabled,n.webLink.disabled=n.webLinkNew.disabled&&n.webLinkEdit.disabled,n.emptyTrashcan.disabled=d.length<1||d.find(f=>!(f.fsItem instanceof q)),n.discard.disabled=d.length<1||d.find(({fsItem:f})=>f.locked||f instanceof q||f instanceof le)}return t.events.subscribe(()=>i()),i(),[{order:1,title:"File",items:[{title:"Open",options:n.open,action:s},{title:"Edit",options:n.edit,action:c},{type:at.SEPARATOR},{title:"Web Link",options:n.webLink,items:[{title:"New",options:n.webLinkNew,action:l},{title:"Edit",options:n.webLinkEdit,action:o}]},{type:at.SEPARATOR},{title:"Duplicate",options:n.duplicate,action(){const d=t.getSelectedItems();return Promise.all(d.filter(h=>h.fsItem).map(async({fsItem:h})=>{const f=await h.getPath();return r.executeCommand(`copy "${f}" "${f}" -ignore`)}))}},{title:"Make Dir",options:n.container,async action(){const d=t.getPrimaryWrapper().fsItem,h=Ut(await d.getPath(),"Directory");return console.log(`makedir "${h}" -ignore`),r.executeCommand(`makedir "${h}" -ignore`)}},{type:at.SEPARATOR},{title:"Discard",options:n.discard,action(){const d=t.getSelectedItems();return Promise.all(d.filter(h=>h.fsItem).map(async({fsItem:h})=>{const f=await h.getPath();return r.executeCommand(`remove "${f}" -r`)}))}},{title:"Empty Trashcan",options:n.emptyTrashcan,action(){const d=t.getSelectedItems();return Promise.all(d.filter(h=>h.fsItem).map(async({fsItem:h})=>Promise.all(Array.from((await h.getItems()).values()).map(async f=>{const x=await f.getPath();return r.executeCommand(`remove "${x}" -r -ignore`)}))))}},{type:at.SEPARATOR},{title:"Info",options:n.info,action(){t.getSelectedItems().filter(h=>h.fsItem).forEach(h=>{e.addWindow({title:`Info File ${h.fsItem.name}`,component:Tr,componentData:{fsItem:R(h.fsItem)},layout:{size:$(460,280)},options:{scaleX:!0,scaleY:!0,prompt:!1,scrollX:!0,scrollY:!0}})})}}]}];function s(){t.getSelectedItems().filter(h=>h.fsItem).forEach(h=>{if(h.command){const f={showCommand:!1,show:!0};return r.executeCommand(h.command,f)}})}async function a({name:d,url:h,symbol:f},x){if(x||(x=await r.executeCommand(`saveFileDialog --id="${fi(d)}"`)),x){const w=r.addExecution();try{const b=x.getPath();await r.executeCommand(`rename "${b}" "${d}" -n`),await r.executeCommand(`editfilemeta "${b}" "${k.WEB_URL}" "${h}"`),await r.executeCommand(`editfilemeta "${b}" "${k.SYMBOL}" "${f}"`)}catch(b){throw w(),new Error(b)}return w(),!0}return!1}function l(){return e.addWindow({title:"Make Link",component:bn,componentData:{model:{actions:{save:a},name:null,url:null,symbol:"default"}},options:{prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose()}function o(){t.getSelectedItems().filter(h=>h.fsItem).forEach(h=>{const f=h.fsItem;e.addWindow({title:"Edit Link",component:bn,componentData:{fsItem:R(f),model:{actions:{save:a},name:f.name,url:f.meta.get(k.WEB_URL),symbol:f.meta.get(k.SYMBOL)}},options:{prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})})}function c(){t.getSelectedItems().filter(h=>h.fsItem).forEach(h=>{const f=h.fsItem,x=Ae({actions:{save:u},id:f.id,name:f.name});[k.SYMBOL,k.VISIBLE,k.IGNORE_SYMBOL_REARRANGE,k.WINDOW_SCALE,k.WINDOW_SCROLL_X,k.WINDOW_SCROLL_Y,k.WINDOW_FULL_SIZE,k.WINDOW_SYMBOL_REARRANGE,k.WINDOW_SIDEBAR].forEach(w=>{x[String(w)]=f.meta.has(w)?f.meta.get(w):!1}),e.addWindow({title:`Edit File ${f.name}`,component:Ar,componentData:{fsItem:R(f),model:x},options:{prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}})})}async function u(d,h){const{id:f,name:x}=d,w=h.getPath();if(!f)throw new Error("Id is emoty!");let b;const H=r.addExecution();try{await Promise.all([k.SYMBOL,k.VISIBLE,k.IGNORE_SYMBOL_REARRANGE,k.WINDOW_SCALE,k.WINDOW_SCROLL_X,k.WINDOW_SCROLL_Y,k.WINDOW_FULL_SIZE,k.WINDOW_SYMBOL_REARRANGE,k.WINDOW_SIDEBAR].map(D=>{let M=d[String(D)];return typeof M=="string"&&(M=`"${M}"`),r.executeCommand(`editfilemeta "${w}" "${D}" ${M}`)})),x&&f!==x?await r.executeCommand(`rename "${w}" "${x}" -n`):b=r.executeCommand(`rename "${w}" "${f}" -rn`),b=r.executeCommand(`rename "${w}" "${f}"`)}catch(D){throw H(),new Error(D)}return H(),b}},$r=({module:r})=>{const{fileSystem:e,core:t,disks:n}=r;return[{name:["mountDisk"],description:"Mount Disk",args:[new g({index:0,name:"id",description:"Disk ID"})],async action({id:i},s){const a=t.addExecution(),l=await n[String(i)]();try{const o=await e.addFloppyDisk(l({core:t}));s.message(`Mount Disk <strong>${o.name}</strong> <strong>(${o.id})</strong> successful!`),a()}catch(o){throw console.error(o),y.get("cant_find_disk",i)}}},{name:["changeDirectory","cd"],description:"cd %path%",args:[new g({index:0,name:"path",description:"Directory path"})],async action({path:i}){if(!i)throw y.get("bad_args");try{await e.changeDirectory(i)}catch(s){throw console.error(s),y.get("cant_find",i)}}},{name:["exist"],description:"Check if file exists.",args:[new g({index:0,name:"path",description:"Filename"})],async action({path:i},s){if(!i)throw y.get("bad_args");const a=V(i),l=await e.exist(i);return l?s.message(`File ${a} exists`):s.message(`File ${a} does not exist`),l}},{name:["makedir","mkdir"],args:[new g({index:0,name:"path",description:"Filename"}),new g({index:1,name:"name",description:"Name"}),new g({name:"ignore",flag:!0,description:"Ignore file exist."})],async action({path:i,name:s,ignore:a},l){if(!i)throw y.get("bad_args");const o=await e.makedir(i,s||V(i),{ignore:a});return l.message(`Directory "${o.name}" created`),o}},{name:["remove","rm"],args:[new g({index:0,name:"path",description:"Filename"}),new g({name:["recursive","r"],flag:!0,description:"Remove Directory Items and Directories."}),new g({name:["ignore"],flag:!0,description:"Ignore the specified file is deleted."})],async action({path:i,recursive:s,ignore:a},l){if(!i)throw y.get("bad_args");const o=await e.remove(i,s,{ignore:a});return[].concat(o).map(c=>{const u=c.type===xe.NAME?"Directory":"File";return l.message(`Removed ${u}: ${c.name}`),c})}},{name:["readfile","getfile"],description:"Get file content",args:[new g({index:0,name:"path",description:"Filename"})],async action({path:i}){if(!i)throw y.get("bad_args");return(await e.get(i)).data}},{name:["makefile","mkfile"],description:"Creates a file with the specified attributes.",args:[new g({index:0,name:"path",description:"Filename"}),new g({index:1,name:"name",description:"Name"}),new g({index:3,name:"data",description:"Data"}),new g({name:"override",flag:!0,description:"Deletes existing file and recreates."})],async action({path:i,name:s,data:a,override:l=!1},o){if(!i)throw y.get("bad_args");typeof a=="string"&&(a=Ft(a));const c=await e.makefile(i,s,a,{override:l});return o.message(`File "${c.name}" created`),c}},{name:["editfile"],description:"Edits file with specified attributes.",args:[new g({index:0,name:"path",description:"Filename"}),new g({index:1,name:"data",description:"Data"})],async action({path:i,data:s},a){if(!i)throw y.get("bad_args");typeof s=="string"&&(s=Ft(s));const l=await e.editfile(i,s);return a.message(`File "${l.name}" edited`),l}},{name:["editfilemeta"],description:"Edits file with specified attributes.",args:[new g({index:0,name:"path",description:"Filename"}),new g({index:1,name:"name",description:"Name"}),new g({index:2,name:"value",description:"Value"})],async action({path:i,name:s,value:a},l){if(!i)throw y.get("bad_args");const o=await e.editfileMeta(i,s,a);return l.message(`File  "${o.name}" Meta edited`),o}},{name:["makelink","mklink"],description:"Creates a link to the specified path.",args:[new g({index:0,name:"ref",description:"Reference path with id (example.ext)."}),new g({index:1,name:"name",description:"Displayed Name"}),new g({index:2,name:"dest",description:"Destination directory."})],async action({ref:i,name:s,dest:a},l){if(!i)throw y.get("bad_args");a=a||".";const o=await e.get(i),c=await e.makelink(o,s);return await e.get(a)!==e.currentItem&&await e.move(c,a,{ignore:!0}),l.message(`Created link "${s}" with "${await o.getPath()}"`),c}},{name:["editlink"],description:"",args:[new g({index:0,name:"path",description:"Reference filepath with id (example.ext)."}),new g({index:1,name:"ref",description:"Destination directory."})],async action({path:i,ref:s},a){if(!(i&&s))throw y.get("bad_args");const l=await e.get(s),o=await e.editlink(i,l);return a.message(`Edited link "${name}" with "${await l.getPath()}"`),o}},{name:"rename",description:"Renamed a file",args:[new g({index:0,name:"path",description:"Filepath with id (example.ext)."}),new g({index:1,name:"value",description:"Value for id or displayed name."}),new g({name:["name","n"],flag:!0,description:"When set, changes the display name."}),new g({name:["removeName","rn"],flag:!0,description:"When set, removes the display name."})],async action({path:i,value:s,name:a,removeName:l},o){if(!l&&(!i||!s))throw y.get("bad_args");const c=await e.get(i),u=a?c.name:c.id;return await e.rename(i,s,{name:a,removeName:l}),o.message(`Renamed from "${u}" to "${s}"`),c}},{name:["cp","copy"],args:[new g({index:0,name:"from",description:"Source Filepath with id (example.ext)."}),new g({index:1,name:"dest",description:"Destination Filepath with id (example.ext)."}),new g({name:["ignore","i"],flag:!0,description:"When sets, creates a new file if exists."})],async action({from:i,dest:s,ignore:a},l){let o=s;if(!o&&a&&(o=i),!o||!i)throw y.get("bad_args");const c=await e.copy(i,o,{ignore:a});return l.message(`Copied from "${i}" to "${o}"`),c}},{name:["mv","move"],description:"move %from% %to%",args:[new g({index:0,name:"from",description:"From path"}),new g({index:1,name:"to",description:"To path"}),new g({index:2,name:"item-position",description:"Sets the position in the Icon view. (x,y)"})],async action({from:i,to:s,itemPosition:a},l){if(!s||!i)throw y.get("bad_args");const o=new Map;a&&o.set("itemPosition",[0,0].map((d,h)=>{const f=a.split(",");return parseInt(f[Number(h)]||0)}));const c=await e.move(i,s,{meta:o});let u;return c instanceof xe?u="Directory":u="File",l.message(`${u} moved ${c.name}`),c}},{name:["executeFile"],description:"Execute file.",args:[new g({index:0,name:"path",description:"Path to the file"})],async action({path:i}){if(!i)throw y.get("bad_args");const s=await e.get(i);if(typeof s.action=="function")return s.action(t);throw y.get("cant_find_action",i)}}]};y.add("cant_find_action","Can't find action %1");y.add("cant_find_disk","Can't find disk %1");var Je,vn;const Wr=new(vn=class{constructor(){_(this,Je)}get(){return m(this,Je)||A(this,Je,this.getImports())}getImports(){return Promise.all([At(()=>import("./CL5Hp3VC.js"),__vite__mapDeps([0,1]),import.meta.url),At(()=>import("./CbHnZPLL.js"),__vite__mapDeps([2,1,3]),import.meta.url),At(()=>import("./D_5a1Xw6.js"),__vite__mapDeps([4,1]),import.meta.url)]).then(([e,t,n])=>({app:e.default||e,auth:t.default||t,database:n.default||n}))}},Je=new WeakMap,vn),Lt=new Map;class Br{constructor(){p(this,"services");p(this,"app");p(this,"firebase")}get name(){return this.app.name}async connect(e,{apiKey:t,url:n}){if(this.services=await Wr.get(),this.firebase=this.services.app,this.app)Lt.has(e)&&(this.app=Lt.get(e));else{const i=this.services.app.initializeApp({apiKey:t,databaseURL:n},e);Lt.set(i.name,i),this.app=i}return this.app}async disconnect(){if(!this.app)throw y.get("FirebaseWrapper_noApp");Te(this),await this.logout(),await this.services.app.deleteApp(this.app),this.app=null}get locked(){return!!this.app&&!this.isLogged()}get currentUser(){const{getAuth:e}=this.services.auth;return e(this.app).currentUser}isLogged(){return!!this.app&&!!this.currentUser}login(e,t){const{getAuth:n,signInWithEmailAndPassword:i}=this.services.auth,s=n(this.app);return Te(this),i(s,e,t)}logout(){if(this.app){const{getAuth:e,signOut:t}=this.services.auth,n=e(this.app);return t(n)}else throw y.get("FirebaseWrapper_notConnected")}remove(e){Te(this);const{remove:t,ref:n,getDatabase:i}=this.services.database,s=i(this.app),a=n(s,e);return t(a)}get(e){Te(this);const{ref:t,onValue:n,getDatabase:i}=this.services.database,s=i(this.app),a=t(s,e);return new Promise(l=>{n(a,o=>l(o.val()))})}async set(e,t){Te(this);const{ref:n,set:i,getDatabase:s}=this.services.database,a=s(this.app),l=n(a,e);return await i(l,t),t}}function Te(r){if(!r.app)throw y.get("FirebaseWrapper_notConnected")}y.add([["FirebaseWrapper_notConnected",["Not connected","Not connected"]],["FirebaseWrapper_noApp",["No app available","No app available"]],["FirebaseWrapper_hasApp",["App already available",'App "%1" already available']]]);class zr extends Fn{constructor(e){e=Object.assign({storage:new Br},e),super(e)}mount(e){return e.onDisconnect=()=>{this.unmount()},this.storage.connect(e.id,e).then(()=>this)}unmount(){return this.storage.disconnect().then(()=>this)}async load(){try{let e=await this.storage.get(this.name);return!e&&(e={},!this.storage.locked)?this.storage.set(this.name,e).then(t=>t):(this.data=e,e)}catch(e){throw new Error(e)}}save(e){return e=Xn(e),this.data=e||this.data,this.storage.set(this.name,e).then(()=>this.data)}get locked(){return this.storage.locked}}function Xn(r){return Object.keys(r).reduce((e,t)=>{const n=e[String(t)];return n&&typeof n=="object"&&Xn(n),(n==null||n==="")&&delete e[String(t)],e},r)}const Pe=new Map,Nr=({module:r,core:e})=>{const{fileSystem:t}=r;return[{name:"cloudList",args:[new g({name:"json",flag:!0,description:"Get JSON Export"})],action({json:n},i){const s=Array.from(Pe.values());if(n)return Promise.resolve(s);{const a=new lt;return a.addColumn({value:"Storage (Id)",align:"left",minWidth:15}),a.addColumn({value:"Name",align:"left",minWidth:15}),a.addColumn({value:"Logged In",align:"center",minWidth:9}),a.addRow(s.reduce((l,o)=>(l.push([o.id,o.name,o.storage.storage.isLogged()?"yes":"no"]),l),[])),i.message([a]),Promise.resolve()}}},{name:"cloudMount",args:[new g({index:0,name:"id",flag:!0,description:"Id from Storage."}),new g({index:1,name:"apiKey",description:"Firebase Api-Key."}),new g({index:2,name:"url",description:"Firebase Database-Url."})],async action({id:n,apiKey:i,url:s},a){if(!i||!s)throw y.get("bad_args");const l=e.addExecution(),o=await t.connect(zr,{id:n,apiKey:i,url:s});return Pe.set(o.id,o),a.message(`Mount <strong>${o.name}</strong> <strong>(${o.id})</strong> successful!`),l(),o}},{name:"cloudUnmount",args:[new g({index:0,name:"id",flag:!0,description:"Id from Storage."})],async action({id:n},i){if(!n)throw y.get("bad_args");const s=e.addExecution();try{const a=Pe.get(n);await t.disconnect(a),Pe.delete(a.id),i.message(`Unmount "${a.name}" successful!`),s()}catch(a){throw s(),new Error(a)}}},{name:"cloudAuth",args:[new g({name:"login",flag:!0,description:"Storage Login"}),new g({name:"logout",flag:!0,description:"Logout from Storage."}),new g({name:"email",description:"Email for Login."}),new g({name:"password",description:"Password for Login."}),new g({name:"storage",description:"Specifies which drive is logged on."})],async action({email:n,password:i,storage:s,login:a,logout:l},o){const c=s;if(!c)throw y.get("bad_args");const u=e.addExecution(),d=Pe.get(c);let h;if(d)try{if(a){if(!n||!i)throw y.get("bad_args");h=await d.storage.storage.login(n,i),o.message(`Login with ${d.id} (${d.id}) successful!`)}else l&&(h=await d.storage.storage.logout(),o.message(`Logout from ${d.id} (${d.id}) successful!`))}catch(f){switch(u(),f.code){case"auth/user-not-found":case"auth/wrong-password":return f}throw new Error(f)}else throw new Error(`${c} is not mounted.`);return u(),h}}]},wn=new Bt("web_workbench_FS");var et;class jr extends Li{constructor({core:t}){super({commands:(...n)=>[...wr(...n),...$r(...n),...Nr(...n)],contextMenu:Pr,core:t});_(this,et,{})}get disks(){return m(this,et)}async addDisks(t){Object.entries(t).forEach(([n,i])=>{m(this,et)[String(n)]=i})}get fileSystem(){return wn}get fs(){return wn}}et=new WeakMap,p(jr,"NAME","Files");const da=new Promise(r=>{/complete|interactive|loaded/.test(document.readyState)?r():document.addEventListener("DOMContentLoaded",r,!1)});var tt;class Ur{constructor(){_(this,tt);window.requestAnimationFrame(()=>{document.documentElement.style.overflowY="scroll",A(this,tt,window.innerWidth-document.body.offsetWidth),document.documentElement.style.overflowY=null})}get size(){return m(this,tt)}}tt=new WeakMap;const ha=new Ur;function Hr(r,e){return r===e?!0:r.parentElement?r.parentElement!==e?Hr(r.parentElement,e):!0:!1}window.requestAnimationFrame(()=>{document.documentElement.style.overflowY="scroll",window.innerWidth-document.body.offsetWidth,document.documentElement.style.overflowY=null});function Mt(r){if(r.touches&&r.touches.length>0){const e=r.touches[0];r.clientX=e.clientX,r.clientY=e.clientY}return"x"in r||(r.x=r.clientX,r.y=r.clientY),r}var he;class Vr{constructor(){_(this,he,new Map);p(this,"capsLockActive",!1);p(this,"shiftLeftActive",!1);p(this,"shiftRightActive",!1);p(this,"cmdLeftActive",!1);p(this,"cmdRightActive",!1);p(this,"altLeftActive",!1);p(this,"altRightActive",!1);p(this,"pointerDown",null);p(this,"pointerUp",null);p(this,"pointerMove",null);p(this,"keyDown",null);p(this,"keyUp",null);this.resize=this.get("resize",window).pipe(fe()),this.pointerDown=this.getPointerDown(),this.pointerUp=this.getPointerUp(),this.pointerMove=this.getPointerMove(),this.keypress=this.get("keypress").pipe(fe()),this.keydown=this.keyDown=this.get("keydown").pipe(fe()),this.keyup=this.keyUp=this.get("keyup").pipe(fe()),this.keyDown.subscribe(({keyCode:e,location:t})=>{switch(e){case 91:this.cmdLeftActive=!0;break;case 93:this.cmdRightActive=!0;break;case 16:t===2?this.shiftRightActive=!0:this.shiftLeftActive=!0;break;case 18:t===2?this.altRightActive=!0:this.altLeftActive=!0;break;case 20:this.capsLockActive=!this.capsLockActive;break}}),this.keyUp.subscribe(({keyCode:e,location:t})=>{switch(e){case 91:this.cmdLeftActive=!1;break;case 93:this.cmdRightActive=!1;break;case 16:t===2?this.shiftRightActive=!1:this.shiftLeftActive=!1;break;case 18:t===2?this.altRightActive=!1:this.altLeftActive=!1;break}})}getPointerDown(e){return this.get("pointerdown",e).pipe(Et(t=>Mt(t))).pipe(fe())}getPointerUp(e){return this.get("pointerup",e).pipe(Et(t=>Mt(t))).pipe(fe())}getPointerMove(e){return this.get("pointermove",e).pipe(Et(t=>Mt(t))).pipe(fe())}get(e,t){t=t||document,m(this,he).has(t)||m(this,he).set(t,new Map);const n=m(this,he).get(t);if(!n.has(e)){const i={passive:!0,capture:!1};n.set(e,ki(t,e,i))}return n.get(e)}reset(){Array.from(m(this,he).values).forEach(e=>e.unsubscribe()),m(this,he).reset()}get cmdActive(){return this.cmdLeftActive||this.cmdRightActive}get altActive(){return this.altLeftActive||this.altRightActive}get shiftActive(){return this.shiftLeftActive||this.shiftRightActive}}he=new WeakMap;let yn;const fa=yn||(yn=new Vr);export{g as A,Ei as C,xe as D,yt as F,L as I,Li as M,xr as P,ea as R,lt as T,de as W,da as a,ta as b,Hr as c,fa as d,Di as e,Ln as f,Ti as g,z as h,st as i,Ci as j,ps as k,Ri as l,oa as m,ms as n,ca as o,na as p,cr as q,la as r,ha as s,Mt as t,on as u,jr as v,fe as w,$i as x,ra as y,aa as z};
