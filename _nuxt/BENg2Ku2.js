const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DtNAs-S_.js","./Dnkwg0NB.js","./BfpYGSxR.js","./CHLd88nu.css","./Caob76XJ.js","./CiACgkXc.css","./CnxF4DWy.js","./Bn0T8SwD.css","./ChU3mOMn.js","./BWKGU6Bw.js","./DEAznjDA.css","./BHmTNEz3.js","./DNMHntIy.css","./Hx5fWSap.js","./DDPzVXKz.js","./BEk8nzL5.js","./DRWqrzG7.css","./CP7cPb5u.js","./CuhyRvkQ.css","./Ce5YywOu.js","./C98WWl5r.js","./D1WZfvAb.js","./jSR9Z_uS.js","./CXbNF4JJ.css","./Dkhtr-D7.js","./CioGTNSL.css","./ua_6RltC.js","./CCnhm4BD.js","./DaDAJXAw.css","./QXLAWCbs.js","./4lgYwaTL.css","./DWp2AHFe.css","./BIE9sgTp.js","./BSzGBLGV.js","./D3MPJlJW.js","./B-meQdOw.js","./D7Us3e3D.js","./CrNGlbV0.js","./B2YYxTED.js","./CYV3YR6m.css","./B7W2-7rb.css","./BZV5d73l.js","./Ca1_6l_s.js","./BvY_9a4j.js","./CH0i9kLA.js","./C6OIF6Wx.css","./CsT4nFwb.css","./DiRiyE1W.css","./CNdulh4N.js","./CjMM_VZ7.css"])))=>i.map(i=>d[i]);
import{L as e,O as t,K as a,a9 as i}from"./BfpYGSxR.js";import{i as n}from"./BHmTNEz3.js";import{d as s,A as o,T as r}from"./CJFEEUyp.js";import{s as d,f as m,b as c}from"./CxZzHJhT.js";import{w as l,e as p,h as f,D as w,u as g,j as u,I as h,d as x,k as v}from"./BSzGBLGV.js";import{C as y}from"./GLWL0ZEA.js";import{I as _}from"./D1WZfvAb.js";async function openItemEdit(i,s){let o;const r=i.modules.symbols,d=i.modules.windows,m=s||r.getSelectedItems().filter(e=>{if(e.fsItem)return e.fsItem;throw new Error(`Item has no fsItem. ${e.id}`)}).map(e=>e.fsItem);await Promise.all(m.map(async s=>{const r=e({actions:{openItemMeta:()=>async function openItemMeta(e){const i=e.fsItem;return o=d.addWindow({component:await a(()=>import("./DtNAs-S_.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]),import.meta.url).then(e=>e.default),componentData:{fsItem:t(i),model:e},options:{title:`Item Meta ${i.name}`,scale:!0,scrollY:!0},layout:{size:n(420,360)}},{full:!0}),o.awaitClose().then(()=>{o=void 0})}(r),save:(e,t)=>async function saveFile$1(e,t,a){const{id:i,name:n}=a,s=t.getPath();if(!i)throw new Error("Id is emoty!");let o;const r=e.addExecution();try{await saveFileMeta(e,t,a),o=n&&i!==n?await e.executeCommand(`rename "${s}" "${n}" -n`):await e.executeCommand(`rename "${s}" "${i}" -rn`),o=e.executeCommand(`rename "${s}" "${i}"`)}catch(d){throw r(),d}return r(),o}(i,e,t),saveItemMeta:(e,t,a)=>saveFileMeta(i,e,t,a)},id:s.id,name:s.name,fsItem:s});[_.SYMBOL,_.VISIBLE,_.IGNORE_SYMBOL_REARRANGE,_.WINDOW_SCALE,_.WINDOW_SCROLL_X,_.WINDOW_SCROLL_Y,_.WINDOW_FULL_SIZE,_.WINDOW_SYMBOL_REARRANGE,_.WINDOW_SIDEBAR].forEach(e=>{r[e]=!!s.meta.has(e)&&s.meta.get(e)});d.addWindow({component:await a(()=>import("./ua_6RltC.js"),__vite__mapDeps([26,1,2,3,4,5,6,7,27,9,10,28,19,17,18,20,29,14,15,30,21,22,23,24,31]),import.meta.url).then(e=>e.default),componentData:{fsItem:t(s),model:r},options:{title:`Edit File ${s.name}`,prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}}).awaitClose().then(()=>{})}))}async function saveFileMeta(e,t,a,i=!1){const n=e.addExecution();await e.executeCommand(`cleanfilemeta "${t.getPath()}" ${i?"--force":""}`);const s=function getSaveFileMetaOptionList(){return Object.values(_)}().filter(e=>void 0!==a[e]);await s.reduce((i,n)=>i.then(async()=>{let i=a[n],s=!1;"string"==typeof i?i=`"${i}"`:"object"==typeof i&&(s=!0,i=l(encodeURIComponent(JSON.stringify(i)))),await e.executeCommand(`editfilemeta "${t.getPath()}" "${n}" ${i} ${s?"--json":""}`)}),Promise.resolve()),n()}const I=s(({module:e})=>{const{fileSystem:t,core:a,disks:i}=e;return[{name:["mountDisk"],description:"Mount Disk",args:[new o({index:0,name:"id",description:"Disk ID"})],async action({id:e},n){const s=a.addExecution();try{const o=await i[e].data(),r=await t.addFloppyDisk(()=>o({core:a}));i[e].hidden||n.message(`Mount Disk <strong>${r.name}</strong> <strong>(${r.id})</strong> successful!`),s()}catch(o){throw console.error(o),p.get("cant_find_disk",e)}}},{name:["changeDirectory","cd"],description:"cd %path%",args:[new o({index:0,name:"path",description:"Directory path"})],async action({path:e}){if(!e)throw p.get("bad_args");try{await t.changeDirectory(e)}catch(a){throw console.error(a),p.get("cant_find",e)}}},{name:["exist"],description:"Check if file exists.",args:[new o({index:0,name:"path",description:"Filename"})],async action({path:e},a){if(!e)throw p.get("bad_args");const i=f(e),n=await t.exist(e);return n?a.message(`File ${i} exists`):a.message(`File ${i} does not exist`),n}},{name:["makedir","mkdir"],args:[new o({index:0,name:"path",description:"Filename"}),new o({index:1,name:"name",description:"Name"}),new o({name:"ignore",flag:!0,description:"Ignore file exist."})],async action({path:e,name:a,ignore:i},n){if(!e)throw p.get("bad_args");const s=await t.makedir(e,a||f(e),{override:i});return n.message(`Directory "${s.name}" created`),s}},{name:["remove","rm"],args:[new o({index:0,name:"path",description:"Filename"}),new o({name:["recursive","r"],flag:!0,description:"Remove Directory Items and Directories."}),new o({name:["ignore"],flag:!0,description:"Ignore the specified file is deleted."})],async action({path:e,recursive:a,ignore:i},n){if(!e)throw p.get("bad_args");return(await t.remove(e,a,{ignore:i})||[]).map(e=>{const t=e.type===w.TYPE?"Directory":"File";return n.message(`Removed ${t}: ${e.name}`),e})}},{name:["readfile","getfile"],description:"Get file content",args:[new o({index:0,name:"path",description:"Filename"})],async action({path:e}){if(!e)throw p.get("bad_args");return(await t.get(e)).data}},{name:["makefile","mkfile"],description:"Creates a file with the specified attributes.",args:[new o({index:0,name:"path",description:"Filename"}),new o({index:1,name:"name",description:"Name"}),new o({index:3,name:"data",description:"Data"}),new o({name:"override",flag:!0,description:"Deletes existing file and recreates."})],action:async(e,t)=>{const i=await makeFile(a,e);return t.message(`File "${i.name}" created`),i}},{name:["editfile"],description:"Edits file with specified attributes.",args:[new o({index:0,name:"path",description:"Filename"}),new o({index:1,name:"data",description:"Data"})],action:async(e,t)=>{const i=await editfile(a,e);return t.message(`File "${i.name}" edited`),i}},{name:["openEditFileDialog"],description:"Opens a file dialog to edit the file.",args:[new o({index:0,name:"path",description:"Filename"})],async action({path:e}){if(!e)throw p.get("bad_args");const i=await t.get(e);return openItemEdit(a,[i])}},{name:["editfilemeta"],description:"Edits file with specified attributes.",args:[new o({index:0,name:"path",description:"Filename"}),new o({index:1,name:"name",description:"Name"}),new o({index:2,name:"value",description:"Value"}),new o({index:3,name:"json",description:"Is JSON value?",flag:!0})],async action({path:e,name:a,value:i,json:n},s){if(!e)throw p.get("bad_args");n&&(i=JSON.parse(decodeURIComponent(g(i))));const o=await t.editFileMeta(e,a,i);return s.message(`File  "${o.name}" Meta edited`),o}},{name:["cleanfilemeta"],description:"Removes all undefined meta values from the file.",args:[new o({index:0,name:"path",description:"Filename"}),new o({name:"force",flag:!0,description:"When set, forces the cleaning of meta values."})],async action({path:e,force:a},i){if(!e)throw p.get("bad_args");const n=await t.cleanFileMeta(e,{force:a});return i.message(`File  "${n.name}" Meta cleaned`),n}},{name:["makelink","mklink"],description:"Creates a link to the specified path.",args:[new o({index:0,name:"ref",description:"Reference path with id (example.ext)."}),new o({index:1,name:"name",description:"Displayed Name"}),new o({index:2,name:"dest",description:"Destination directory."})],async action({ref:e,name:a,dest:i},n){if(!e)throw p.get("bad_args");i=i||".";const s=await t.get(e),o=await t.makelink(s,a);return await t.get(i)!==t.currentItem&&await t.move(o,i,{override:!0}),n.message(`Created link "${a}" with "${await s.getPath()}"`),o}},{name:["editlink"],description:"",args:[new o({index:0,name:"path",description:"Reference filepath with id (example.ext)."}),new o({index:1,name:"ref",description:"Destination directory."})],async action({path:e,ref:a},i){if(!e||!a)throw p.get("bad_args");const n=await t.get(a),s=await t.editlink(e,n);return i.message(`Edited link "${name}" with "${await n.getPath()}"`),s}},{name:"rename",description:"Renamed a file",args:[new o({index:0,name:"path",description:"Filepath with id (example.ext)."}),new o({index:1,name:"value",description:"Value for id or displayed name."}),new o({name:["name","n"],flag:!0,description:"When set, changes the display name."}),new o({name:["removeName","rn"],flag:!0,description:"When set, removes the display name."})],async action({path:e,value:a,name:i,removeName:n},s){if(!(n||e&&a))throw p.get("bad_args");const o=await t.get(e),r=i?o.name:o.id;return await t.rename(e,a,{name:i,removeName:n}),s.message(`Renamed from "${r}" to "${a}"`),o}},{name:["cp","copy"],args:[new o({index:0,name:"from",description:"Source Filepath with id (example.ext)."}),new o({index:1,name:"dest",description:"Destination Filepath with id (example.ext)."}),new o({name:["ignore","i"],flag:!0,description:"When sets, creates a new file if exists."})],async action({from:e,dest:a,ignore:i},n){let s=a;if(!s&&i&&(s=e),!s||!e)throw p.get("bad_args");const o=await t.copy(e,s,{ignore:i});return n.message(`Copied from "${e}" to "${s}"`),o}},{name:["mv","move"],description:"move %from% %to%",args:[new o({index:0,name:"from",description:"From path"}),new o({index:1,name:"to",description:"To path"}),new o({index:2,name:"item-position",description:"Sets the position in the Icon view. (x,y)"})],async action({from:e,to:a,itemPosition:i},n){if(!a||!e)throw p.get("bad_args");const s=await t.move(e,a);let o;return i&&s.meta.set(_.POSITION,[0,0].map((e,t)=>{const a=i.split(",");return parseInt(a[Number(t)]||"0")})),s.save(),o=s instanceof w?"Directory":"File",n.message(`${o} moved ${s.name}`),s}},{name:["executeFile"],description:"Execute file.",args:[new o({index:0,name:"path",description:"Path to the file"})],async action({path:e}){if(!e)throw p.get("bad_args");const i=await t.get(e);if("function"==typeof i.action)return i.action(a);throw p.get("cant_find_action",e)}}]});async function makeFile(e,{path:t,name:a,data:i,override:n=!1}){if(!t)throw p.get("bad_args");"string"==typeof i&&(i=u(i));return await e.modules.files.fs.makeFile(t,a,i,{override:n||!1,meta:[]})}function editfile(e,{path:t,data:a}){if(!t)throw p.get("bad_args");return"string"==typeof a&&(a=u(a)),e.modules.files.fs.editFile(t,a)}p.add("cant_find_action","Can't find action %1"),p.add("cant_find_disk","Can't find disk %1");const D=s(({module:i,core:s})=>{const{fileSystem:l}=i;return[{name:"openPreview",args:[new o({index:0,name:"path",description:"Path to the file"}),new o({name:"maximized",description:"If set, window is maximized."})],async action({path:e,maximized:t}){var i,o;const r=await l.get(e),{type:d,content:m,openMaximized:c}=r.data;if("basic"!==d||r.data[y.HAS_WINDOW_OUTPUT]){const e=await a(()=>import("./BIE9sgTp.js"),__vite__mapDeps([32,33,21,2,22,23,11,34,35,36,37,38,39,24,40]),import.meta.url).then(e=>e.default);null==(o=s.modules.windows)||o.addWindow({component:e,componentData:{type:d,content:m},options:{title:r.name,scaleX:!0,scaleY:!0,scrollX:!0,scrollY:!0},layout:{size:n(420,360)}},{full:c||t||!1})}else await(null==(i=s.modules.parser)?void 0:i.parseBasic(m,async(e,t)=>await s.executeCommand(e,t)))}},{name:"saveFileDialog",args:[new o({index:0,name:"data",description:"File Content"}),new o({index:1,name:"id",description:"File Id"}),new o({index:2,name:"extension",description:"File Extension"})],action:e=>saveFileDialog(s,e)},{name:"openFileDialog",args:[new o({index:0,name:"type",description:"Type for File or Directory to open."})],async action({type:i}){var n;const o=e({}),r=await a(()=>import("./BZV5d73l.js"),__vite__mapDeps([41,42,1,2,3,4,5,6,7,43,44,45,33,21,22,23,11,34,35,36,37,46,27,9,10,28,24,47]),import.meta.url).then(e=>e.default),d=null==(n=s.modules.windows)?void 0:n.addWindow({component:r,componentData:{type:i,model:o,fsItem:l.root&&t(l.root)},options:{title:"Open File",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}});if(d){const{value:e}=await d.awaitClose();return e&&async function readFile(e,t){var a;return{fsItem:await(null==(a=e.modules.files)?void 0:a.fs.get(t)),value:await e.executeCommand(`readfile "${t}"`)}}(s,e)}}},{name:"fileinfo",description:"Get info from File or Directory",args:[new o({index:0,name:"path",description:"Path to the file"}),new o({index:1,name:"name",description:"Name from the Info"}),new o({index:2,name:["list","ls"],flag:!0,description:"List all Infos"})],async action({path:e,name:t,list:a},i){const n=await l.getItemMetaList(e);if(!a)return n.find(e=>e.name===t);{const e=new r;e.addColumns([{value:"Name",align:"left",minWidth:20},{value:"Value",align:"left",minWidth:20}]),e.addRows(n.map(({name:e,value:t})=>{let a=t;return Array.isArray(t)&&(a=t.join(" ")),[e,a]})),i.message([e])}}},{name:["info","i"],args:[new o({index:0,name:"path",description:"Path to the file"})],async action({path:e},t){let a=l.root;e&&(a=await l.get(e)),(null==a?void 0:a.parent)&&(a=a.parent);const i=await(null==a?void 0:a.getItems()),n=new r;n.addColumns([{value:"Unit",align:"left",minWidth:8},{value:"Size",align:"right",minWidth:6},{value:"Used",align:"right",minWidth:6},{value:"Free",align:"right",minWidth:6},{value:"Full",minWidth:4},{value:"Errs",align:"center",minWidth:4},{value:"Status",align:"center",minWidth:10},{value:"Name",align:"right",minWidth:14}]);const s=Array.from((null==i?void 0:i.values())||[]).filter(e=>e instanceof h);n.addRows(s.map(e=>{let t=0;return(e.size>0||e.maxSize>0)&&(t=e.size/e.maxSize*100),[`${e.id}:`,d(e.maxSize),d(e.size),d(e.maxSize-e.size),`${t}%`,"0",e.locked?"Read":"Read/Write",`${e.name||""}`]}));const o=["","Mounted disks:",n,"","Volumes available:"];s.forEach(e=>{o.push(`${e.name}: [Mounted]`)}),o.push(""),t.message(o)}},{name:["list","ls"],args:[new o({index:0,name:"path",description:"Path to the file"}),new o({name:"dir-size",flag:!0,description:"Show Directory Size."})],async action({path:e,dirSize:t},a){let i=l.currentItem;e&&(i=await l.get(e));const n=Array.from((await(null==i?void 0:i.getItems())||[]).values()),s=new r;s.addColumns([{value:"Name",align:"left",minWidth:26},{value:"Size",align:"right",minWidth:8},{value:"Access",align:"center",minWidth:12},{value:"Date / Time",align:"center",minWidth:18}]),s.addRows(n.reduce((e,a)=>{let i;i=a instanceof x&&!t?"DIR":m(d(a.size),8,!0,"0");const n=a.isLocked()?"Read":"Read/Write";return e.push([`${a.id}:`,i,n,a.createdDate?c("D-mm-y H:I:S",a.createdDate):""]),e},[]));const o=n.reduce((e,t)=>(t instanceof w&&e++,e),0),p=n.reduce((e,t)=>e+=t.size,0);return a.message([s,`${n.length} files - ${o} directories - ${p} blocks used`]),Promise.resolve()}}]});async function saveFileDialog(e,{data:n,id:s,extension:o}){var r,d;const m=await a(()=>import("./CNdulh4N.js"),__vite__mapDeps([48,1,2,3,4,5,6,7,43,44,45,33,21,22,23,11,34,35,36,37,46,27,9,10,28,49]),import.meta.url).then(e=>e.default),c=null==(d=e.modules.windows)?void 0:d.addWindow({component:m,componentData:{fsItem:(null==(r=e.modules.files)?void 0:r.fs.root)&&t(e.modules.files.fs.root),id:s},options:{title:"Save File",scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}});if(c){const{value:a}=await c.awaitClose();if(a){let s=a;o&&(s=v(a,o));const r=await async function saveFile(e,t,a){let i=!1;return await e.executeCommand(`exist "${t}"`)&&(i=await e.executeCommand('openDialog "File exist, overwrite?" --confirm')),makeFile(e,{path:t,data:a,override:i})}(e,s,n);if(r)return t(i(r))}}}export{I as a,D as c,editfile as e,openItemEdit as o,saveFileDialog as s};
