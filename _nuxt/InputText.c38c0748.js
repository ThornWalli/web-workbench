import{r as S,x as H,aa as L,b as f,h as w,f as v,t as y,i as T}from"./index.f331e757.js";import{_ as g,k as r,l as o,m as l,N as h,B as d,P as k,Y as b,K as M}from"./entry.8cd6c9a7.js";import{b as E}from"./async.5085d094.js";function C(i,t){return t===void 0&&(t=E),S(function(u,c){var n=null,e=null,s=null,p=function(){if(n){n.unsubscribe(),n=null;var a=e;e=null,c.next(a)}};function _(){var a=s+i,m=t.now();if(m<a){n=this.schedule(void 0,a-m),c.add(n);return}p()}u.subscribe(H(c,function(a){e=a,s=t.now(),n||(n=t.schedule(_,i),c.add(n))},function(){p(),c.complete()},void 0,function(){e=n=null}))})}const x={props:{rootElement:{type:HTMLElement,default(){return null}},options:{type:Object,default(){return{focused:!1}}},readonly:{type:Boolean,required:!1,default:!1},multiline:{type:Boolean,required:!1,default:!0},name:{type:String,default:"value"},model:{type:Object,required:!1,default(){return{value:"Input Value"}}}},emits:["input","refresh","keydown","keyup","enter"],data(){return{escapeHtml:L,selectionLength:null,selectionStart:null,selectionEnd:null,controlShiftActive:!1,controlCapsLockActive:!1,focusedSubscriptions:[],refreshFrame:null}},computed:{focused(){return this.options.focused},value:{get(){return this.model[this.name]},set(i){this.model[this.name]=i}},styleClasses(){return{"js--readonly":this.readonly,"js--multiline":this.multiline,"js--selection-empty":!this.selectionLength,"js--focused":this.focused,"js--shift-active":this.controlShiftActive,"js--caps-lock-active":this.controlCapsLockActive}}},watch:{focused(i){i?(this.focusedSubscriptions.push(f.get("click").pipe(w(({target:t})=>!T(t,this.rootElement||this.$parent.$el)),v()).subscribe(this.blur.bind(this)),f.get("keypress").subscribe(function(){this.$refs.input.focus()}.bind(this)),f.get("keydown").subscribe(({keyCode:t})=>{switch(t){case 16:this.controlShiftActive=!0;break;case 20:this.controlCapsLockActive=!this.controlCapsLockActive;break}}),f.get("keyup").subscribe(({keyCode:t})=>{switch(t){case 16:this.controlShiftActive=!1;break}this.$emit("keyup",t)})),this.$refs.input.focus()):(this.focusedSubscriptions.forEach(t=>t.unsubscribe()),this.focusedSubscriptions=[],this.$refs.input.blur())}},unmounted(){window.cancelAnimationFrame(this.refreshFrame),this.focusedSubscriptions.forEach(i=>i.unsubscribe())},mounted(){this.$refs.input.setSelectionRange(this.value.length,this.value.length),this.refresh(),this.focused&&this.$refs.input.focus()},methods:{focus(){this.setFocus(!0)},blur(){this.setFocus(!1)},resetSelection(){const i=this.$refs.input;this.selectionStart=i.selectionStart=0,this.selectionEnd=i.selectionEnd=0,this.selectionLength=0},refresh(){const i=this.$refs.input;this.selectionStart=i.selectionStart,this.selectionEnd=i.selectionEnd,this.selectionLength=this.selectionEnd-this.selectionStart,this.$emit("refresh")},setFocus(i){this.options.focused=i},onPointerDown(i){const t=f.pointerMove.pipe(C(128)).subscribe(u=>{y(u),this.refresh()});f.pointerUp.pipe(v()).subscribe(u=>{y(u),t.unsubscribe()})},onInput(){this.refresh(),this.$emit("input")},onClick(){this.focused?this.refresh():this.setFocus(!0)},onKeydown(i){!this.multiline&&i.keyCode===13?(i.preventDefault(),i.stopPropagation(),this.$emit("enter",this.model[this.name]),this.refresh()):(this.$emit("keydown",i),this.refresh())},onKeyup(i){this.$emit("keyup",i.keyCode),this.refresh()}}},K={class:"input-text__result"},I=["innerHTML"],A=["innerHTML"],F=["innerHTML"],P=["innerHTML"],j=["innerHTML"],D=["innerHTML"],B=["innerHTML"],V=["innerHTML"],q={key:1,class:"input-text__selected 5"},N=["innerHTML"],O=["innerHTML"],U={class:"input-text__input"},z=["readonly"],R=["readonly"];function W(i,t,u,c,n,e){return r(),o("div",{class:M(["wb-env-atom-input-text",e.styleClasses])},[l("div",null,[l("div",K,[e.value.length>0&&n.selectionEnd>0?(r(),o(h,{key:0},[n.selectionStart>=0&&n.selectionEnd===e.value.length?(r(),o(h,{key:0},[l("span",{innerHTML:n.escapeHtml(e.value.slice(0,n.selectionStart))},null,8,I),l("span",{class:"input-text__selected",innerHTML:n.escapeHtml(e.value.slice(n.selectionStart,n.selectionEnd+1))||" "},null,8,A)],64)):n.selectionStart&&n.selectionStart===n.selectionEnd?(r(),o(h,{key:1},[l("span",{innerHTML:n.escapeHtml(e.value.slice(0,n.selectionStart))},null,8,F),l("span",{class:"input-text__selected",innerHTML:n.escapeHtml(e.value.slice(n.selectionStart,n.selectionStart+1))||" "},null,8,P),l("span",{innerHTML:n.escapeHtml(e.value.slice(n.selectionStart+1,e.value.length))},null,8,j)],64)):(r(),o(h,{key:2},[l("span",{innerHTML:n.escapeHtml(e.value.slice(0,n.selectionStart))},null,8,D),l("span",{class:"input-text__selected",innerHTML:n.escapeHtml(e.value.slice(n.selectionStart,n.selectionEnd))},null,8,B),l("span",{innerHTML:n.escapeHtml(e.value.slice(n.selectionEnd,e.value.length))},null,8,V)],64))],64)):d("",!0),!n.selectionStart&&e.value===""?(r(),o("span",q," ")):e.value.length>0&&!n.selectionStart&&n.selectionStart===n.selectionEnd?(r(),o(h,{key:2},[l("span",{class:"input-text__selected",innerHTML:n.escapeHtml(e.value.slice(0,1))},null,8,N),l("span",{innerHTML:n.escapeHtml(e.value.slice(1,e.value.length))},null,8,O)],64)):d("",!0)]),l("div",U,[u.multiline?k((r(),o("textarea",{key:0,ref:"input","onUpdate:modelValue":t[0]||(t[0]=s=>e.value=s),readonly:u.readonly,onPointerdown:t[1]||(t[1]=(...s)=>e.onPointerDown&&e.onPointerDown(...s)),onInput:t[2]||(t[2]=(...s)=>e.onInput&&e.onInput(...s)),onClick:t[3]||(t[3]=(...s)=>e.onClick&&e.onClick(...s)),onKeydown:t[4]||(t[4]=(...s)=>e.onKeydown&&e.onKeydown(...s)),onKeyup:t[5]||(t[5]=(...s)=>e.onKeyup&&e.onKeyup(...s)),onFocus:t[6]||(t[6]=(...s)=>e.onClick&&e.onClick(...s))},null,40,z)),[[b,e.value]]):d("",!0),u.multiline?d("",!0):k((r(),o("input",{key:1,ref:"input","onUpdate:modelValue":t[7]||(t[7]=s=>e.value=s),type:"text",readonly:u.readonly,onPointerdown:t[8]||(t[8]=(...s)=>e.onPointerDown&&e.onPointerDown(...s)),onInput:t[9]||(t[9]=(...s)=>e.onInput&&e.onInput(...s)),onClick:t[10]||(t[10]=(...s)=>e.onClick&&e.onClick(...s)),onKeydown:t[11]||(t[11]=(...s)=>e.onKeydown&&e.onKeydown(...s)),onKeyup:t[12]||(t[12]=(...s)=>e.onKeyup&&e.onKeyup(...s)),onFocus:t[13]||(t[13]=(...s)=>e.onClick&&e.onClick(...s))},null,40,R)),[[b,e.value]])])])],2)}const Q=g(x,[["render",W],["__scopeId","data-v-adf85619"]]);export{Q as A};
