import{I as ne,a as oe,C as le}from"./DFR6kSAz.js";import{T as ae,C as re}from"./QwGUwJAP.js";import{m as se,n as ue,u as ie}from"./B3Wmi0DA.js";import{E as ce}from"./CN6qd5Iu.js";import{K as h}from"./B4rpyJsK.js";import{u as fe}from"./JsFOm8c5.js";import{d as me,r as o,O as B,L as pe,k as b,a0 as E,o as de,U as ve,a1 as M,W as he,y as Ce,z as we,A as S,C as ye,G as ge,$ as Re,_ as Ee}from"./BkRx7U8b.js";import"./BoZA8JgY.js";import"./Cpj98o6Y.js";import"./ClLpnmyR.js";import"./BTMT_sH9.js";import"./OlYXjGCK.js";import"./CtlMGvom.js";import"./D4lI5vpz.js";import"./D4b9WN8K.js";import"./Wv4Ty0OG.js";import"./DG6QdPnO.js";import"./DeEbP9sG.js";import"./Ds4KxLLa.js";import"./CL1V9BUB.js";import"./OAVrZOa6.js";import"./KQEr41HO.js";import"./CVx03s7S.js";import"./C723tzWh.js";import"./D53hIzv4.js";import"./CTpy3bpH.js";import"./DXGPjI4_.js";import"./Gl1UmUM-.js";import"./CV0dHcg-.js";class Se extends ne{onAdd;constructor(l={}){const{onAdd:f}={onAdd:null,...l};super(l),this.onAdd=f||(()=>{})}add(l,f){let s="",d=!1;typeof l=="string"&&se(l)?d=!0:(l instanceof ae&&(s=l.toColumnify().split(/\n/g)),typeof l=="string"&&ue(l)&&(s=ie(l))),typeof l=="string"&&/^> \w+/.test(l)?this.onAdd(l,f):(d||s.length)&&this.onAdd(s,f)}}const _e={class:"wrapper"},Ie={class:"input"},Oe=["innerHTML"],Ae=me({__name:"Console",props:{rootElement:{type:HTMLElement,default(){return null}},showIntroduction:{type:Boolean,default(){return!1}},delimiterPrefix:{type:String,default:"1.SYS"},readonly:{type:Boolean,default:!1},startCommands:{type:[Array,String],default:null},preRows:{type:Array,default(){return[]}}},emits:["freeze","unfreeze","startCommandsComplete","refresh"],setup(C,{emit:l}){const{window:f,core:s,parentFocused:d,parentLayout:D}=fe();let _=1;const I=o(null),w=o(null),z=o(null),O=o(null),i=C,y=l,N=B(new oe);N.add([new re({name:["CLS","CLEAR"],action(){J()}})]);const H=o(B(new Se({core:s,consoleInterface:new le,onAdd:W}))),m=o({value:"",focused:!1}),c=o([]),u=o(0),g=o(0),p=o([`[CLI ${_}]`]),r=o(-1),$=o(18),R=o({value:i.delimiterPrefix,prompt:!1,confirm:!1}),V=o(null),U=o(null),A=o(null),T=o(!1),K=pe({show:!0,logger:H,showCommand:!0,commandBucket:N}),j=b(()=>({"js--prompt":A.value,"js--focused":d.value})),F=b(()=>{let e=R.value.value;const{confirm:t,prompt:n}=R.value;return t?e="(y/n) ?":n?e="?":e&&(e=`${e}:&gt`),e&&(e=`${e}&nbsp;`),e}),Y=b(()=>D.value.size);let P;E(()=>Y.value,()=>{window.clearTimeout(P),P=window.setTimeout(()=>{v()},200)}),E(()=>V.value,()=>{x({value:""})}),E(()=>U.value,()=>{x({value:i.delimiterPrefix,confirm:U.value})}),E(()=>A.value,()=>{x({value:i.delimiterPrefix,prompt:A.value})}),p.value.unshift(...i.preRows),de(async()=>{const e=ve();if(e&&e.parent&&"console"in e.parent&&(e.parent.console=this),_++,i.showIntroduction){const t=q();t&&await t.then(()=>L('basic "TMP:CONSOLE_INSTRUCTIONS.basic"',{showCommand:!1}))}M(async()=>{if(i.startCommands){const t=Array().concat(i.startCommands),n=a=>L(a.shift()||"",{showCommand:!1}).then(()=>{if(a.length>0)return n(a)});await n(t),y("startCommandsComplete")}})}),he(()=>{_--});function G(e){m.value.value=e}async function L(e,t){r.value=-1,u.value=0,g.value=0,y("freeze");const n=await s.executeCommand(e,{...K,...t});n&&(typeof n=="number"||typeof n=="string")&&W(n),y("unfreeze"),v(),k(!0)}function q(){const e=["#basic","CLS",'PRINT "Scroll (Up/Down): <strong>Shift+Up</strong> / <strong>Shift+Down</strong>"','PRINT "Enter <strong>commands</strong> to show all commands."'];return s.modules.files?.fs.createTmpFile("CONSOLE_INSTRUCTIONS.basic","CONSOLE_INSTRUCTIONS.basic",{type:"basic",content:e})}function J(){g.value=p.value.length,v()}function v(){if(I.value&&w.value){w.value.innerHTML="";const e=Math.floor(I.value.offsetHeight/$.value)-2;let t=0;for(;u.value+t<u.value+e;){const n=p.value[Math.max(p.value.length-e-u.value,0)+t];if(n!==void 0){const a=document.createElement("li");a.innerHTML=String(n).replace(/[\\]?\\n/,"<br>")+`
`,w.value.appendChild(a)}else break;t++}}}function k(e){M(()=>{e&&(T.value={scroll:!0},y("refresh",T.value),M(()=>{T.value=null}))})}function Q(e){let t=!1;e?g.value>0?(g.value=0,t=!0):u.value<p.value.length&&(u.value++,t=!0):u.value>0&&(u.value--,t=!0),t&&v()}function x(e,t=!1,n=!1){R.value={...R,value:e,prompt:t,confirm:n}}function W(e){const t=[];Array.isArray(e)?t.push(...e):t.push(String(e)),p.value.push(...t),v()}function X(){m.value.focused=!0}function Z(e){return c.value[c.value.length-1]!==e&&c.value.push(e),m.value.value="",L(e)}function ee(){m.value.focused=!1,k(),f.unfocus()}function te(e){const t=e.code;let n=!1;if((O.value?.controlCapsLockActive||O.value?.controlShiftActive)&&(t===h.ARROW_UP||t===h.ARROW_DOWN))e.preventDefault(),Q(t===h.ARROW_UP);else{switch(t){case h.ARROW_UP:r.value++,r.value=Math.min(r.value,c.value.length-1),n=!0;break;case h.ARROW_DOWN:r.value--,r.value=Math.max(r.value,-1),n=!0;break}if(n&&c.value.length>0){let a;r.value<0?a="":a=c.value[c.value.length-1-r.value],m.value.value=a}k()}}return(e,t)=>(we(),Ce("div",{ref_key:"rootEl",ref:I,class:Re(["wb-env-console",j.value]),onClick:X},[S("div",_e,[S("ul",{ref_key:"consoleOutputEl",ref:w,class:"output typo-style"},null,512),S("div",Ie,[S("span",{ref_key:"consoleCommandDelimiterEl",ref:z,class:"prefix",innerHTML:F.value},null,8,Oe),ye(ce,{ref_key:"inputEl",ref:O,"root-element":C.rootElement||e.$el,class:"element",multiline:!1,"override-focused":ge(d),readonly:C.readonly,"model-value":m.value.value,onBlur:ee,"onUpdate:modelValue":G,onEnter:Z,onKeydown:te},null,8,["root-element","override-focused","readonly","model-value"])])])],2))}}),ot=Ee(Ae,[["__scopeId","data-v-d81a1fee"]]);export{ot as default};
