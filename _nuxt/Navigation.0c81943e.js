var k=Object.defineProperty;var D=(o,t,e)=>t in o?k(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var p=(o,t,e)=>(D(o,typeof t!="symbol"?t+"":t,e),e);import{g as P,V as v,P as j,D as B,b as N,c as q,d as K,e as L,f as Y,a as H,s as z}from"./Track.34d43f2d.js";import{E as I,_ as E,f as O,k as d,l as m,q as F,W as C,o as V,m as S,t as w,L as h,P as U,a5 as x,N as g,O as T,z as Z,I as W,C as J}from"./entry.9fb9bafb.js";import{Q as X,j as G,k as Q,u as $,q as l,ae as M}from"./index.0712caa6.js";import{C as y,r as A}from"./index.3998eac9.js";class gt{constructor(t,e){p(this,"track");p(this,"playing",!1);p(this,"noteIndex",-1);p(this,"currentSequence");p(this,"instrument");p(this,"autoplay");const{autoplay:s}=e||{};this.track=t,this.autoplay=s!==void 0?s:!0}refresh(){const t=P(this.track.notes);return this.createSequence(t,()=>{this.clearSequence(),this.playing=!1}),t}play(t){var s;if(!this.instrument)throw new Error("TrackPlayer requires an instrument");const e=this.refresh(t);if(e.length-1===this.noteIndex&&(this.noteIndex=-1),this.autoplay){const n=this.instrument.context.transport;n.stop(),n.seconds=t>-1&&((s=e[t+1])==null?void 0:s.time)||0,n.start(),this.currentSequence.start(0),this.playing=!0}return this.currentSequence}pause(){this.instrument.context.transport.pause(),this.playing=!1}stop(){this.clearSequence(),this.playing=!1,this.noteIndex=-1}restart(){this.stop(),this.play()}reset(){this.clearSequence(),this.stop(),this.track.notes=[]}destroy(){var t;(t=this.instrument)==null||t.dispose(),this.clearSequence()}createInstrument(t){var a;(a=this.instrument)==null||a.dispose();const e=N[String(t)],s=new v(-100).toDestination(),n=new e().connect(s).toDestination();this.instrument=I(n),console.log(" this.instrument",this.instrument)}createSequence(t,e){var s;if(!this.currentSequence){(s=this.currentSequence)==null||s.dispose();let n;this.currentSequence=I(new j((a,{name:r,time:_,velocity:f})=>{if(r)try{this.instrument.triggerAttackRelease(r,`${this.track.noteCount}n`,a,f),n={name:r,time:a}}catch{console.log(n)}B.schedule(()=>{this.noteIndex++,this.noteIndex===t.length-1&&e&&e()},a)},t))}}clearSequence(){var t;(t=this.currentSequence)==null||t.dispose(),this.currentSequence=null}}const tt={components:{AtomMarkdown:X},props:{...G,model:{type:Object,required:!0}},emits:[...Q],setup(o,t){return{windowContext:$(o,t)}},data(){return{content:["# Synthesizer","Simple synthesizer with notes view and midi api support.","",`Version: **0.1**  
Created by **Thorn-Welf Walli**`,"","Thanks to:","- [Tone.js](https://tonejs.github.io/)","- [WEBMIDI.js](https://webmidijs.org/)"].join(`
`)}}},et={class:"wb-disks-debug-synthesizer-info"};function st(o,t,e,s,n,a){const r=O("atom-markdown");return d(),m("div",et,[F(r,{content:n.content},null,8,["content"])])}const at=E(tt,[["render",st],["__scopeId","data-v-4615a7e8"]]),Tt=({core:o,mainWindow:t,parentWindow:e,preserveContextMenu:s,model:n,trackModel:a})=>{const{windows:r}=o.modules;function _(){return(e||t).close()}const f=n[y.SYNTHESIZER_PROJECT],c=a&&a[y.SYNTHESIZER_TRACK];return[{title:"Synthesizer",items:[{hotKey:"I",keyCode:73,title:"Info",async action(){s(!0),await r.addWindow({title:"Info",component:at,componentData:{model:n},options:{prompt:!1,scaleX:!1,scaleY:!1,scrollX:!1,scrollY:!1}},{group:"extras13Synthesizer"}).awaitClose(),s(!1),t.focus()}},{type:l.SEPARATOR},{title:"Debug",items:[{title:"Notes",async action(){s(!0);const{window:i}=n.actions.openDebugNotes();await i.awaitClose(),s(!1),t.focus()}},{title:"Midi",async action(){s(!0);const{window:i}=n.actions.openDebugMidi();await i.awaitClose(),s(!1),t.focus()}}]},{type:l.SEPARATOR},{title:"Close",action:_}]},...a?[]:[{title:"Project",items:[{title:"New…",action:async()=>{s(!0),await n.actions.newProject(),s(!1),t.focus()}},{title:"Edit Name…",action:async()=>{s(!0);const i=await A(o,"Project renaming:",f.name);i&&(f.name=i),s(!1),t.focus()}},{title:"Open…",hotKey:"O",keyCode:79,action:async()=>{await n.actions.openProject()}},{title:"Save…",hotKey:"S",keyCode:83,action:async()=>await n.actions.saveProject()},{type:l.SEPARATOR},{title:"Import… (JSON)",hotKey:"S",keyCode:83,type:l.UPLOAD,async action(i){return await n.actions.importProject(i[0])}},{title:"Export (JSON)",action:async()=>await n.actions.exportProject()}]},{title:"Track",items:[{title:"New…",action:async()=>{s(!0),await n.actions.newTrack(),s(!1),t.focus()}},{type:l.SEPARATOR},{title:"Clear",async action(){s(!0),await n.actions.clearTracks(),s(!1),t.focus()}}]}],...a&&[{title:"Track Options",items:[{type:l.CHECKBOX,title:"Show Note Labels",name:y.SYNTHESIZER_TRACK_SHOW_NOTE_LABELS,model:a},{type:l.CHECKBOX,title:"Show Keyboard",name:y.SYNTHESIZER_TRACK_SHOW_KEYBOARD,model:a},{type:l.DEFAULT,title:"Keyboard Size",items:Object.entries(q()).map(([i,u])=>({type:l.RADIO,title:u,model:a,name:y.SYNTHESIZER_TRACK_KEYBOARD_SIZE,value:i}))},{type:l.DEFAULT,title:"Keyboard Alignment",items:Object.entries(K()).map(([i,u])=>({type:l.RADIO,title:u,model:a,name:y.SYNTHESIZER_TRACK_KEYBOARD_ALIGN,value:i}))},{type:l.SEPARATOR},{title:"Edit Name…",action:async()=>{s(!0);const i=await A(o,"Track renaming:",c.name);i&&(c.name=i,t.options.title=c.name),s(!1),t.focus()}},{type:l.DEFAULT,title:"Note Count",items:Object.entries(L()).map(([i,u])=>({type:l.RADIO,title:`${i} (${u})`,model:c,name:"noteCount",value:u}))},{type:l.DEFAULT,title:"Base Note",items:Object.entries(Y()).map(([i,u])=>({type:l.RADIO,title:i,model:c,name:"baseNote",value:u}))},{type:l.SEPARATOR},{type:l.DEFAULT,title:"Beat Count",items:Array(9).fill({}).map((i,u)=>({type:l.RADIO,title:String(u+1),model:c,name:"beatCount",value:u+1}))}]}]||[],{title:"Options",items:[{type:l.DEFAULT,title:`BPM (${n[y.SYNTHESIZER_BPM]})`,items:[30,60,120,240,480].map(i=>({type:l.RADIO,title:String(i),model:n,name:y.SYNTHESIZER_BPM,value:i}))}]},...M({core:o})].filter(Boolean)},nt=Symbol("pending"),it=Symbol("fulfilled"),ot=Symbol("rejected");class lt{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e,this.state=nt}).then(t=>(this.state=it,t)).catch(t=>{throw this.state=ot,new Error(t)})}}const R=new lt;let b;function At(){return b=b||C({destination:null,transport:H,ready:!1,awaitReady:R.promise,async start(){await z(),this.ready=!0,R.resolve()},setBpm(o,t){const e=this.tone.transport;e.stop(),e.bpm.value=120,e.seconds=0,t(),e.bpm.value=o,e.start()}}),V(()=>{window.Tone=N}),{tone:b}}const rt={props:{selected:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},text:{type:String,default:null},title:{type:String,default:""},name:{type:String,default:""},value:{type:[String,Number],default:void 0},model:{type:Object,default(){return{}}},action:{type:Function,default:null}},computed:{styleClasses(){return{selected:this.selected}}},methods:{onClick(o){typeof this.action=="function"&&Promise.resolve(this.action(o)).catch(t=>{throw t})},onInput(){typeof this.action=="function"&&Promise.resolve(this.action(this.model[this.name])).catch(o=>{throw o})}}},ct=["disabled"],ut=["disabled","value","type"],dt=["disabled"];function mt(o,t,e,s,n,a){return e.text?(d(),m("div",{key:0,class:h(a.styleClasses)},[S("span",null,w(e.text),1)],2)):e.name?(d(),m("label",{key:1,class:h(a.styleClasses),disabled:e.disabled?!0:void 0},[U(S("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),disabled:e.disabled?!0:void 0,value:e.value,type:e.value===void 0?"checkbox":"radio",onInput:t[1]||(t[1]=(...r)=>a.onInput&&a.onInput(...r))},null,40,ut),[[x,e.model[e.name]]]),S("span",null,w(e.title),1)],10,ct)):(d(),m("button",{key:2,class:h(a.styleClasses),disabled:e.disabled,onClick:t[2]||(t[2]=(...r)=>a.onClick&&a.onClick(...r))},[S("span",null,w(e.title),1)],10,dt))}const yt=E(rt,[["render",mt],["__scopeId","data-v-b9f1e088"]]);const pt=C({}),ft={components:{NavigationItem:yt},props:{disabled:{type:Boolean,default:!1},direction:{type:String,default:"horizontal"},model:{type:Object,default(){return pt}},multline:{type:Boolean,default:!1},items:{type:Array,default(){return[{id:1,title:"Play"},{id:2,title:"Pause"},{id:2,title:"Stop"},{id:2,title:"Reset"},{id:1,title:"Item 1 R",value:"item-1",name:"test"},{id:2,title:"Item 2 R",value:"item-2",name:"test"},{id:2,title:"Item 3 R",value:"item-3",name:"test"},{id:2,title:"Item 4 R",value:"item-4",name:"test"},{id:1,title:"Item 1 C",name:"item1Value"},{id:2,title:"Item 2 C",name:"item2Value"},{id:2,title:"Item 3 C",name:"item3Value"},{id:2,title:"Item 4 C",name:"item4Value"}]}}},computed:{preparedItems(){return this.items.find(o=>Array.isArray(o))?this.items:[this.items]},styleClasses(){return{multline:this.multline,[`direction-${this.direction}`]:this.direction}}}},ht=["disabled"];function _t(o,t,e,s,n,a){const r=O("navigation-item");return d(),m("div",{class:h(a.styleClasses),disabled:e.disabled},[(d(!0),m(g,null,T(a.preparedItems,(_,f)=>(d(),m("ul",{key:f},[(d(!0),m(g,null,T(_,(c,i)=>(d(),m("li",{key:i,class:h({spacer:c.spacer,fill:c.fill})},[c.spacer?J("",!0):(d(),Z(r,W({key:0,disabled:e.disabled,model:e.model},c),null,16,["disabled","model"]))],2))),128))]))),128))],10,ht)}const Rt=E(ft,[["render",_t],["__scopeId","data-v-8df2c054"]]);export{Rt as N,gt as T,Tt as c,At as u};
